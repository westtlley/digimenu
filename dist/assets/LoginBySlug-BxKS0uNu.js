import{r as o,g as b,m as H,k as G,i as O,j as e,d as c,L as A,B as W,z as L}from"./main-BRmc9wuQ.js";import{L as $,I as P}from"./input-BSSWZZVM.js";import{S as I}from"./store-DD9u3xYC.js";import{A as M}from"./arrow-left-CctukX1s.js";import{E as J,a as K}from"./eye-C1POL9iN.js";import{L as Q}from"./log-in-V4EDTWPP.js";import"./index-DtU2aqBA.js";function X(a){const[r,l]=o.useState(null),[j,d]=o.useState(!!a),[g,s]=o.useState(null),i=o.useCallback(async x=>{if(!x||!String(x).trim()){l(null),d(!1);return}d(!0),s(null);try{const m=await b.get(`/public/login-info/${encodeURIComponent(x)}`);l(m)}catch(m){s(m?.message||"Erro ao carregar dados do estabelecimento"),l({found:!1,slug:x})}finally{d(!1)}},[]);return o.useEffect(()=>{i(a)},[a,i]),{data:r,loading:j,error:g,refetch:()=>i(a)}}const E={primary:"#ea580c",primaryHover:"#c2410c",secondary:"#f97316",accent:"#fb923c"};function Y(a){if(!a?.found)return E;const r=a.theme_primary_color||E.primary,l=a.theme_secondary_color||a.theme_primary_color||E.secondary;return{primary:r,primaryHover:r,secondary:l,accent:a.theme_accent_color||l}}function ne({type:a}){const{slug:r,type:l}=H(),[j]=G(),d=j.get("returnUrl")||"",g=a??(l==="cliente"||l==="colaborador"?l:"assinante"),s=O(),{data:i,loading:x}=X(r),[m,T]=o.useState(""),[N,U]=o.useState(""),[w,D]=o.useState(!1),[f,v]=o.useState(!1),[S,p]=o.useState(""),_=i?.found?i.name:"Estabelecimento",n=Y(i),y=r?`/s/${r}`:"";o.useEffect(()=>{r&&typeof localStorage<"u"&&localStorage.setItem("lastVisitedSlug",r)},[r]),o.useEffect(()=>{(async()=>{try{if(!await b.auth.isAuthenticated())return;const t=await b.auth.me();if(!t)return;if(t?.role==="customer"){s(r?`/s/${r}`:"/",{replace:!0});return}if((t?.profile_roles?.length?t.profile_roles:t?.profile_role?[t.profile_role]:[]).length>0){s("/colaborador",{replace:!0});return}if(t?.is_master){s("/Admin",{replace:!0});return}s(r?`/s/${r}/PainelAssinante`:"/PainelAssinante",{replace:!0})}catch{}})()},[r,s]);const F=async u=>{if(u.preventDefault(),p(""),v(!0),!m?.trim()||!N){p("Preencha email e senha"),v(!1);return}try{const h=await b.auth.login(m.trim(),N),t=h.user||h;if(h.token){L.success("Login realizado com sucesso!");const R=(t?.profile_roles?.length?t.profile_roles:t?.profile_role?[t.profile_role]:[]).length>0;if(t?.role==="customer"){const B=d&&d.startsWith("/")&&!d.startsWith("//")?d:r?`/s/${r}`:"/";s(B,{replace:!0})}else R?s("/colaborador",{replace:!0}):t?.is_master?s("/Admin",{replace:!0}):s(r?`/s/${r}/PainelAssinante`:"/PainelAssinante",{replace:!0})}else p("Erro ao fazer login. Tente novamente.")}catch(h){const t=h?.message||"Credenciais inválidas. Tente novamente.";p(t),L.error(t)}finally{v(!1)}};if(!r)return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-gray-100 dark:bg-gray-900",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"URL inválida."}),e.jsx(c,{to:"/",className:"text-orange-600 hover:underline mt-2 inline-block",children:"Voltar ao início"})]})});if(x)return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-gray-100 dark:bg-gray-900",children:e.jsx(A,{className:"w-10 h-10 animate-spin text-orange-500"})});if(!i?.found)return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-gray-100 dark:bg-gray-900",children:e.jsxs("div",{className:"max-w-sm w-full text-center p-8 bg-white dark:bg-gray-800 rounded-2xl shadow-lg",children:[e.jsx(I,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Estabelecimento não encontrado"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-6",children:"O link de acesso não existe ou foi alterado."}),e.jsx(c,{to:"/",className:"text-orange-600 hover:text-orange-700 font-medium",children:"Voltar ao início"})]})});const k=g==="assinante",C=g==="cliente",V=g==="colaborador",z=k?"Entrar — Dono, gerente, colaborador ou cliente":C?"Entrar como cliente":"Acesso colaborador — Entregador, Cozinha, PDV, Garçom ou Gerente";return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 transition-colors",style:{background:`linear-gradient(135deg, ${n.primary}22 0%, ${n.secondary}18 50%, ${n.accent}22 100%)`},children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs("div",{className:"rounded-2xl shadow-2xl overflow-hidden bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"p-6 text-white text-center",style:{background:`linear-gradient(135deg, ${n.primary} 0%, ${n.secondary} 100%)`},children:[e.jsxs(c,{to:y,className:"inline-flex items-center gap-2 text-white/90 hover:text-white text-sm mb-4",children:[e.jsx(M,{className:"w-4 h-4"})," Cardápio"]}),i.logo?e.jsx("div",{className:"w-20 h-20 rounded-2xl overflow-hidden border-2 border-white/30 mx-auto mb-3 shadow-lg bg-white",children:e.jsx("img",{src:i.logo,alt:_,className:"w-full h-full object-contain"})}):e.jsx("div",{className:"w-20 h-20 rounded-2xl flex items-center justify-center mx-auto mb-3 border-2 border-white/30 shadow-lg",style:{backgroundColor:"rgba(0,0,0,0.15)"},children:e.jsx(I,{className:"w-10 h-10"})}),e.jsx("h1",{className:"text-xl font-bold truncate",children:_}),e.jsx("p",{className:"text-sm text-white/90 mt-1",children:z})]}),e.jsxs("div",{className:"p-6",children:[k&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center mb-4",children:"Use seu e-mail e senha. Você será direcionado ao painel correto conforme seu perfil."}),e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"email",className:"text-gray-700 dark:text-gray-300",children:"Email"}),e.jsx(P,{id:"email",type:"email",placeholder:"seu@email.com",value:m,onChange:u=>T(u.target.value),disabled:f,className:"mt-1.5 h-11",required:!0,autoComplete:"email"})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"password",className:"text-gray-700 dark:text-gray-300",children:"Senha"}),e.jsxs("div",{className:"relative mt-1.5",children:[e.jsx(P,{id:"password",type:w?"text":"password",placeholder:"Sua senha",value:N,onChange:u=>U(u.target.value),disabled:f,className:"pr-10 h-11",required:!0,autoComplete:"current-password"}),e.jsx("button",{type:"button",onClick:()=>D(!w),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500",disabled:f,children:w?e.jsx(J,{className:"w-5 h-5"}):e.jsx(K,{className:"w-5 h-5"})})]})]}),S&&e.jsx("div",{className:"p-3 rounded-lg bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800",children:e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:S})}),e.jsx(W,{type:"submit",className:"w-full h-11 text-white font-semibold shadow-lg",style:{background:`linear-gradient(135deg, ${n.primary} 0%, ${n.secondary} 100%)`},disabled:f,children:f?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4 mr-2 animate-spin"})," Entrando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-4 h-4 mr-2"})," Entrar"]})})]}),e.jsxs("div",{className:"mt-6 space-y-3 text-center",children:[e.jsx(c,{to:"/esqueci-senha",className:"block text-sm text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200",children:"Esqueci minha senha"}),k&&e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(c,{to:`${y}/cadastro-cliente`,className:"text-sm font-medium",style:{color:n.primary},children:"Não tem conta? Cadastre-se (cliente)"})}),e.jsx("div",{children:e.jsx(c,{to:"/assinar",className:"text-sm font-medium",style:{color:n.primary},children:"Não tem conta? Assine agora (estabelecimento)"})})]}),C&&e.jsx("div",{children:e.jsx(c,{to:`${y}/cadastro-cliente`,className:"text-sm font-medium",style:{color:n.primary},children:"Não tem conta? Cadastre-se"})}),V&&e.jsx("div",{children:e.jsx(c,{to:"/assinar",className:"text-sm font-medium",style:{color:n.primary},children:"Não tem conta? Assine agora"})}),e.jsx("div",{children:e.jsx(c,{to:y||"/",className:"text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:"← Voltar ao cardápio"})})]})]})]})})})}export{ne as default};
