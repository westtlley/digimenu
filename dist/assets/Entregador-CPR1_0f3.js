const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/cloudinaryUpload-C-K8WG66.js","assets/main-BRmc9wuQ.js","assets/main-Gd1NmDy6.css"])))=>i.map(i=>d[i]);
import{c as Z,r as n,o as ht,j as e,P as U,B as _,u as we,X as V,g as ft,_ as pt,z as ee,T as te,L as tt,p as re,f as bt,d as Ke,e as Be,E as yt}from"./main-BRmc9wuQ.js";import{b as $}from"./base44Client-DNwoQjfp.js";import{u as oe}from"./useQuery-DECqmSjD.js";import{u as ce}from"./useMutation-7mrcm5kq.js";import{B as W}from"./badge-0XfQUglg.js";import{L as he,I as Ue}from"./input-BSSWZZVM.js";import{u as st}from"./useSlugContext-C_H0E5cf.js";import{O as z,R as Qe,D as Ge,V as jt}from"./constants-BZ6YHCOj.js";import{f as fe}from"./formatters-CvOEClq0.js";import{D as Ne,a as _e,b as $e,c as Ce}from"./dialog-DJhUD2H1.js";import{D as Se}from"./dollar-sign-Cy_CReDz.js";import{T as ve}from"./trending-up-DfwTY8KU.js";import{C as se}from"./clock-BVnf5BSk.js";import{D as vt}from"./download-BLDsYadX.js";import{T as Ee}from"./textarea-BVLzEUED.js";import{C as wt}from"./camera-BcwGIML-.js";import{C as at}from"./check-B8wFGgpR.js";import{S as Ve}from"./star-gxnzHQI6.js";import{C as Nt}from"./chevron-left-dEb2H1jL.js";import{C as _t}from"./chevron-right-nMC1nZWH.js";import{C as $t}from"./ColaboradorProfile-n7GwNNmH.js";import{S as pe}from"./switch-gnnivmk-.js";import{B as Ct}from"./bell-B_jl57AB.js";import{V as St}from"./volume-2-CZ76rO0d.js";import{P as Et}from"./play-BshYjaFQ.js";import{M as Rt,S as Ot}from"./sun-DyPTta9R.js";import{m as v}from"./proxy-UArsdzLI.js";import{M as B}from"./map-pin-C1grN2RK.js";import{Z as Pt}from"./zap-Cci-1Hlx.js";import{C as J}from"./circle-check-big-BgD3Vilh.js";import{N as ie}from"./navigation-DF2HYaFW.js";import{S as Me}from"./store-DD9u3xYC.js";import{A as Le}from"./index-POiUmsPA.js";import{P as rt}from"./phone-BNGqqYl8.js";import{M as Tt}from"./message-circle-BosG9deC.js";import{I as It}from"./InstallAppButton-D28BW715.js";import{C as kt}from"./index-Deio2Puc.js";import{C as Dt}from"./chevron-down-Br9th1QV.js";import"./card-Ctp-7rs8.js";import{P as Ye}from"./progress-D7YE5rXl.js";import{T as At}from"./target-DHqmp1St.js";import{U as Ae}from"./user-DROTyYEO.js";import{C as Je}from"./circle-help-wMU4n52T.js";import{S as We}from"./settings-DlQQnpge.js";import{L as Ze}from"./log-out-CDSnoSZk.js";import{M as qt}from"./menu-C4YDxp4T.js";import"./index-DtU2aqBA.js";import"./index-Cj8IEuVO.js";import"./index-Us3IJkK4.js";import"./save-CsDfwi79.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}],["line",{x1:"6",x2:"6",y1:"11",y2:"13",key:"1wd6dw"}]],Vt=Z("BatteryLow",zt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]],Ft=Z("Coffee",Lt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=[["line",{x1:"3",x2:"15",y1:"22",y2:"22",key:"xegly4"}],["line",{x1:"4",x2:"14",y1:"9",y2:"9",key:"xcnuvu"}],["path",{d:"M14 22V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v18",key:"16j0yd"}],["path",{d:"M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 0 2 2a2 2 0 0 0 2-2V9.83a2 2 0 0 0-.59-1.42L18 5",key:"7cu91f"}]],Kt=Z("Fuel",Ht);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=[["path",{d:"M12.75 7.09a3 3 0 0 1 2.16 2.16",key:"1d4wjd"}],["path",{d:"M17.072 17.072c-1.634 2.17-3.527 3.912-4.471 4.727a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 1.432-4.568",key:"12yil7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.475 2.818A8 8 0 0 1 20 10c0 1.183-.31 2.377-.81 3.533",key:"lhrkcz"}],["path",{d:"M9.13 9.13a3 3 0 0 0 3.74 3.74",key:"13wojd"}]],Ut=Z("MapPinOff",Bt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]],Gt=Z("PhoneOff",Qt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]],Yt=Z("Route",Mt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]],Wt=Z("Utensils",Jt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=[["path",{d:"m2 8 2 2-2 2 2 2-2 2",key:"sv1b1"}],["path",{d:"m22 8-2 2 2 2-2 2 2 2",key:"101i4y"}],["rect",{width:"8",height:"14",x:"8",y:"5",rx:"1",key:"1oyrl4"}]],Xt=Z("Vibrate",Zt);function es(){const[s,t]=n.useState(null),[r,l]=n.useState(null),[a,x]=n.useState(!0),{subscriberEmail:c,inSlugContext:u}=st();return n.useEffect(()=>{(async()=>{try{const h=await $.auth.me();t(h);const i=u&&h?.is_master&&c?c:void 0;try{const b=(await $.entities.Entregador.list(null,i?{as_subscriber:i}:{})).find(f=>f.email?.toLowerCase().trim()===h.email?.toLowerCase().trim());if(b)l(b);else if(h.is_master||h.profile_role==="entregador"){const f={id:h.is_master?"master-"+h.email:"user-"+h.email,name:h.full_name||h.email.split("@")[0],email:h.email,phone:h.phone||"(00) 00000-0000",photo:h.photo||h.google_photo,status:"available",total_deliveries:0,total_earnings:0,rating:5,dark_mode:!1,sound_enabled:!0,notifications_enabled:!0,vibration_enabled:!0,_isMaster:h.is_master,_isVirtual:!0,_subscriberEmail:h.subscriber_email||h.email};l(f)}}catch(m){console.warn("Erro ao buscar entregador (backend valida acesso):",m)}}catch(h){console.error("Erro de autentica√ß√£o:",h),$.auth.redirectToLogin("/Entregador")}finally{x(!1)}})()},[u,c]),{user:s,entregador:r,loading:a,asSubscriber:u&&s?.is_master&&c?c:void 0,isMaster:s?.is_master||!1}}function ts(s,t,r=!1){const{data:l=[]}=oe({queryKey:["deliveryOrders",s,t??"me"],queryFn:()=>$.entities.Order.filter({entregador_id:s,...t&&{as_subscriber:t}}),enabled:!!s&&!r,refetchInterval:Qe.ORDERS}),{data:a=[]}=oe({queryKey:["allDeliveryOrders",t??"me"],queryFn:async()=>(await $.entities.Order.list(null,t?{as_subscriber:t}:{})).filter(m=>[z.GOING_TO_STORE,z.ARRIVED_AT_STORE,z.PICKED_UP,z.OUT_FOR_DELIVERY,z.ARRIVED_AT_CUSTOMER].includes(m.status)),enabled:r,refetchInterval:Qe.ORDERS}),x=r?a:l,c=n.useMemo(()=>x.filter(i=>[z.GOING_TO_STORE,z.ARRIVED_AT_STORE,z.PICKED_UP,z.OUT_FOR_DELIVERY,z.ARRIVED_AT_CUSTOMER].includes(i.status)),[x]),u=n.useMemo(()=>x.filter(i=>i.status===z.DELIVERED),[x]),g=n.useMemo(()=>{const i=new Date;return i.setHours(0,0,0,0),u.filter(m=>{if(!m.delivered_at)return!1;const b=new Date(m.delivered_at);return b.setHours(0,0,0,0),b.getTime()===i.getTime()})},[u]),h=n.useMemo(()=>{const i=g.reduce((b,f)=>b+(f.delivery_fee||0),0),m=g.length>0?g.reduce((b,f)=>{if(!f.picked_up_at||!f.delivered_at)return b;const C=new Date(f.picked_up_at),j=new Date(f.delivered_at);return b+(j-C)/6e4},0)/g.length:0;return{active:c.length,completed:u.length,completedToday:g.length,todayEarnings:i,avgDeliveryTime:Math.round(m)}},[c,u,g]);return{orders:x,activeOrders:c,completedOrders:u,completedOrdersToday:g,stats:h}}function ss(s){const[t,r]=n.useState(null),[l,a]=n.useState(!1),[x,c]=n.useState(null),u=n.useCallback(async g=>{if(!g||!g.trim()){r(null);return}a(!0),c(null);try{const h=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(g)}&limit=1`,{headers:{"User-Agent":`${ht}/1.0`}});if(!h.ok)throw new Error("Erro ao buscar coordenadas");const i=await h.json();i&&i.length>0?r({lat:parseFloat(i[0].lat),lng:parseFloat(i[0].lon)}):(r(Ge),c("Endere√ßo n√£o encontrado"))}catch(h){console.error("Erro na geocodifica√ß√£o:",h),r(Ge),c(h.message||"Erro ao buscar coordenadas")}finally{a(!1)}},[]);return n.useEffect(()=>{s?u(s):r(null)},[s,u]),{coordinates:t,loading:l,error:x,geocode:u}}function qe(s,t){if(!s||!t)return 0;const r=(t.lng-s.lng)*Math.PI/180,l=s.lat*Math.PI/180,a=t.lat*Math.PI/180,x=Math.sin(r)*Math.cos(a),c=Math.cos(l)*Math.sin(a)-Math.sin(l)*Math.cos(a)*Math.cos(r);return(Math.atan2(x,c)*180/Math.PI+360)%360}function be(s=0,t=!1){const a=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 56 56">
    <defs>
      <linearGradient id="g" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#f97316"/><stop offset="100%" stop-color="#ea580c"/></linearGradient>
      <filter id="shadow">
        <feGaussianBlur in="SourceAlpha" stdDeviation="2"/>
        <feOffset dx="0" dy="2" result="offsetblur"/>
        <feComponentTransfer>
          <feFuncA type="linear" slope="0.3"/>
        </feComponentTransfer>
        <feMerge>
          <feMergeNode/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>
    </defs>
    <g transform="rotate(${s-90} 28 28)">
      <!-- Sombra animada (pulso) -->
      <circle cx="28" cy="28" r="20" fill="#000" opacity="${t?.3:.2}" filter="url(#shadow)"/>
      <!-- Moto -->
      <path d="M14 34 Q16 28 22 26 L34 26 Q40 26 44 28 L48 32 L46 34 L42 30 Q38 28 34 28 L22 28 Q18 30 16 34 Z" fill="url(#g)" stroke="#c2410c" stroke-width="1" filter="url(#shadow)"/>
      <ellipse cx="28" cy="26" rx="6" ry="2.5" fill="#fef3c7" stroke="#c2410c"/>
      <circle cx="48" cy="30" r="2" fill="#fef9c3"/>
      <circle cx="14" cy="40" r="6" fill="#475569" stroke="#1e293b" stroke-width="1"/>
      <circle cx="44" cy="40" r="6" fill="#475569" stroke="#1e293b" stroke-width="1"/>
    </g>
  </svg>`;return"data:image/svg+xml,"+encodeURIComponent(a)}function lt(s){return s<.5?4*s*s*s:1-Math.pow(-2*s+2,3)/2}function Xe(s,t,r,l=2e3,a,x=null){if(!s||!t||!r)return;let c;const u=performance.now(),g=()=>{c!=null&&(cancelAnimationFrame(c),c=null)};a&&(a.current=g);function h(i){const m=i-u,b=Math.min(m/l,1),f=lt(b),C=t.lat+(r.lat-t.lat)*f,j=t.lng+(r.lng-t.lng)*f;s.setPosition({lat:C,lng:j}),x&&x({progress:b,eased:f,position:{lat:C,lng:j}}),b<1&&(c=requestAnimationFrame(h))}c=requestAnimationFrame(h)}function as(s,t,r=3e3,l,a=null){if(!s||!t||t.length<2)return;let x;const c=performance.now(),u=()=>{x!=null&&(cancelAnimationFrame(x),x=null)};l&&(l.current=u);function g(h){const i=h-c,m=Math.min(i/r,1),b=lt(m),f=t.length-1,C=b*f,j=Math.floor(C),p=C-j;if(j>=f){s.setPosition(t[t.length-1]),a&&a({progress:1,eased:1,position:t[t.length-1]});return}const N=t[j],d=t[j+1],L=N.lat+(d.lat-N.lat)*p,D=N.lng+(d.lng-N.lng)*p;s.setPosition({lat:L,lng:D}),a&&a({progress:m,eased:b,position:{lat:L,lng:D},segmentIndex:j,segmentT:p}),m<1&&(x=requestAnimationFrame(g))}x=requestAnimationFrame(g)}const rs=[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]}];function ls({entregadorLocation:s,storeLocation:t,customerLocation:r,order:l,darkMode:a=!1,mode:x="entregador",onNavigate:c}){n.useRef(null);const u=n.useRef(null),g=n.useRef(null),h=n.useRef(null),i=n.useRef(null),m=n.useRef(null),b=n.useRef(null),f=n.useRef(null),C=n.useRef(null),j=n.useRef([]),p=n.useRef(null),[N,d]=n.useState(!1),[L,D]=n.useState(null),[E,le]=n.useState([]),[Re,de]=n.useState(null),[ne,Oe]=n.useState(!1),M="",Pe=!!(r||t);return n.useEffect(()=>{},[M,Pe,a]),n.useEffect(()=>{const S=u.current;S&&S.setOptions({styles:a?rs:void 0})},[N,a]),n.useEffect(()=>{if(!N)return;const S=g.current,P=h.current;t&&S?(S.setPosition(t),S.setVisible(!0)):S&&S.setVisible(!1),r&&P?(P.setPosition(r),P.setVisible(!0)):P&&P.setVisible(!1)},[N,t,r]),n.useEffect(()=>{if(!s||!r){le([]),de(null);return}{le([]),de(null),Oe(!1);return}},[s,r,t,l?.status,void 0]),n.useEffect(()=>{const S=m.current;if(!S||!E.length){S&&S.setPath([]);return}S.setPath(E.map(P=>({lat:P.lat,lng:P.lng})))},[N,E]),n.useEffect(()=>{if(!N||!i.current)return;const S=i.current,P=typeof google<"u"?google.maps:null;if(!P)return;if(!s){S.setVisible(!1),f.current=null,j.current=[],b.current&&b.current.setPath([]),p.current&&clearInterval(p.current);return}const q=f.current,I={lat:s.lat,lng:s.lng};if(!q){S.setPosition(I),S.setIcon({url:be(0,!1),scaledSize:new P.Size(48,48),anchor:new P.Point(24,24)}),S.setVisible(!0),f.current={...I},j.current=[{...I}],p.current&&clearInterval(p.current);let A=!1;p.current=setInterval(()=>{if(!S.getVisible())return;A=!A;const F=f.current?qe(f.current,I):0;S.setIcon({url:be(F,A),scaledSize:new P.Size(48,48),anchor:new P.Point(24,24)})},1e3);return}const xe=Math.hypot(I.lat-q.lat,I.lng-q.lng),Q=Math.min(3e3,Math.max(500,xe/1e-4)),R=qe(q,I);if(E.length>=2){let A=0,F=1/0;E.forEach((G,H)=>{const ae=Math.hypot(G.lat-I.lat,G.lng-I.lng);ae<F&&(F=ae,A=H)});const y=E.slice(Math.max(0,A-1),Math.min(E.length,A+3));y.length>=2?(C.current?.(),as(S,y,Q,C,({position:G})=>{if(j.current.push({...G}),j.current.length>20&&j.current.shift(),b.current&&j.current.length>=2&&b.current.setPath(j.current.map(H=>({lat:H.lat,lng:H.lng}))),j.current.length>=2){const H=j.current[j.current.length-2],O=qe(H,G);S.setIcon({url:be(O,!1),scaledSize:new P.Size(48,48),anchor:new P.Point(24,24)})}})):(C.current?.(),Xe(S,q,I,Q,C,({position:G})=>{j.current.push({...G}),j.current.length>20&&j.current.shift(),b.current&&j.current.length>=2&&b.current.setPath(j.current.map(H=>({lat:H.lat,lng:H.lng})))}))}else C.current?.(),Xe(S,q,I,Q,C,({position:A})=>{j.current.push({...A}),j.current.length>20&&j.current.shift(),b.current&&j.current.length>=2&&b.current.setPath(j.current.map(F=>({lat:F.lat,lng:F.lng})))});S.setIcon({url:be(R,!1),scaledSize:new P.Size(48,48),anchor:new P.Point(24,24)}),S.setVisible(!0),f.current={...I},j.current.push({...I}),j.current.length>20&&j.current.shift(),b.current&&j.current.length>=2&&b.current.setPath(j.current.map(A=>({lat:A.lat,lng:A.lng})))},[N,s,E]),n.useEffect(()=>{const S=u.current;!S||!s||S.panTo({lat:s.lat,lng:s.lng})},[N,s]),e.jsxs("div",{className:"h-full flex flex-col items-center justify-center bg-gray-100 dark:bg-gray-800 rounded-xl",children:[e.jsx("span",{className:"text-4xl mb-2",children:"üó∫Ô∏è"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm text-center px-4",children:"Configure VITE_GOOGLE_MAPS_KEY no .env para exibir o mapa."})]})}function ns({entregadorId:s,darkMode:t,isOpen:r,onClose:l}){const[a,x]=n.useState("today"),c=p=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(p||0),u=p=>new Date(p).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),{data:g=[],isLoading:h}=oe({queryKey:["delivery-earnings",s,a],queryFn:async()=>await $.get("/api/delivery-earnings",{params:{entregador_id:s,period:a}})||[],enabled:r&&!!s}),i=g.reduce((p,N)=>p+parseFloat(N.amount||0),0),m=g.length,b=m>0?i/m:0,f=g.filter(p=>p.paid).reduce((p,N)=>p+parseFloat(N.amount||0),0),C=i-f,j=()=>{const p=g.map(E=>({data:u(E.delivered_at),pedido:E.order_id||"N/A",valor:E.amount,tipo:E.calculation_type,distancia:E.distance_km?`${E.distance_km} km`:"N/A",pago:E.paid?"Sim":"N√£o"})),N=[["Data","Pedido","Valor","Tipo de C√°lculo","Dist√¢ncia","Pago"],...p.map(E=>[E.data,E.pedido,E.valor,E.tipo,E.distancia,E.pago])].map(E=>E.join(",")).join(`
`),d=new Blob([N],{type:"text/csv;charset=utf-8;"}),L=window.URL.createObjectURL(d),D=document.createElement("a");D.href=L,D.download=`ganhos-${a}-${new Date().toISOString().split("T")[0]}.csv`,D.click(),window.URL.revokeObjectURL(L)};return e.jsx(Ne,{open:r,onOpenChange:l,children:e.jsxs(_e,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx($e,{children:e.jsx(Ce,{className:"text-2xl font-bold",children:"Meus Ganhos"})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex gap-2 flex-wrap",children:["today","week","month","all"].map(p=>e.jsx("button",{onClick:()=>x(p),className:`px-4 py-2 rounded-lg text-sm font-medium transition ${a===p?"bg-orange-500 text-white":t?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:p==="today"?"Hoje":p==="week"?"7 Dias":p==="month"?"30 Dias":"Todos"},p))}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:`p-4 rounded-xl ${t?"bg-gray-800":"bg-green-50"} border ${t?"border-gray-700":"border-green-200"}`,children:[e.jsx(Se,{className:`w-6 h-6 mb-2 ${t?"text-green-400":"text-green-600"}`}),e.jsx("p",{className:`text-xs ${t?"text-gray-400":"text-gray-600"}`,children:"Total Ganho"}),e.jsx("p",{className:`font-bold text-xl ${t?"text-white":"text-green-700"}`,children:c(i)})]}),e.jsxs("div",{className:`p-4 rounded-xl ${t?"bg-gray-800":"bg-blue-50"} border ${t?"border-gray-700":"border-blue-200"}`,children:[e.jsx(U,{className:`w-6 h-6 mb-2 ${t?"text-blue-400":"text-blue-600"}`}),e.jsx("p",{className:`text-xs ${t?"text-gray-400":"text-gray-600"}`,children:"Entregas"}),e.jsx("p",{className:`font-bold text-xl ${t?"text-white":"text-blue-700"}`,children:m})]}),e.jsxs("div",{className:`p-4 rounded-xl ${t?"bg-gray-800":"bg-purple-50"} border ${t?"border-gray-700":"border-purple-200"}`,children:[e.jsx(ve,{className:`w-6 h-6 mb-2 ${t?"text-purple-400":"text-purple-600"}`}),e.jsx("p",{className:`text-xs ${t?"text-gray-400":"text-gray-600"}`,children:"M√©dia/Entrega"}),e.jsx("p",{className:`font-bold text-xl ${t?"text-white":"text-purple-700"}`,children:c(b)})]}),e.jsxs("div",{className:`p-4 rounded-xl ${t?"bg-gray-800":"bg-orange-50"} border ${t?"border-gray-700":"border-orange-200"}`,children:[e.jsx(se,{className:`w-6 h-6 mb-2 ${t?"text-orange-400":"text-orange-600"}`}),e.jsx("p",{className:`text-xs ${t?"text-gray-400":"text-gray-600"}`,children:"A Receber"}),e.jsx("p",{className:`font-bold text-xl ${t?"text-white":"text-orange-700"}`,children:c(C)})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(_,{onClick:j,variant:"outline",size:"sm",children:[e.jsx(vt,{className:"w-4 h-4 mr-2"}),"Exportar CSV"]})}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:h?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:t?"text-gray-400":"text-gray-600",children:"Carregando..."})}):g.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:t?"text-gray-400":"text-gray-600",children:"Nenhum ganho encontrado neste per√≠odo"})}):g.map(p=>e.jsx("div",{className:`p-4 rounded-lg border ${t?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("p",{className:`font-medium ${t?"text-white":"text-gray-900"}`,children:["Pedido #",p.order_id||"N/A"]}),p.paid&&e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-green-100 text-green-700",children:"Pago"})]}),e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:u(p.delivered_at)}),e.jsxs("div",{className:"flex gap-4 mt-2 text-xs",children:[e.jsxs("span",{className:t?"text-gray-400":"text-gray-600",children:["Tipo: ",p.calculation_type||"N/A"]}),p.distance_km&&e.jsxs("span",{className:t?"text-gray-400":"text-gray-600",children:["Dist√¢ncia: ",parseFloat(p.distance_km).toFixed(2)," km"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:`font-bold text-lg ${t?"text-green-400":"text-green-600"}`,children:c(p.amount)})})]})},p.id))})]})]})})}function is({order:s,entregador:t,onClose:r,onConfirm:l,darkMode:a}){const[x,c]=n.useState(""),[u,g]=n.useState(""),[h,i]=n.useState(!1),m=n.useRef(null),b=we(),f=ce({mutationFn:p=>ft.entities.DeliveryProof.create(p),onSuccess:()=>{b.invalidateQueries({queryKey:["deliveryOrders"]}),b.invalidateQueries({queryKey:["allDeliveryOrders"]}),l&&l(),r()}}),C=async p=>{const N=p.target.files[0];if(N){i(!0);try{const{uploadToCloudinary:d}=await pt(async()=>{const{uploadToCloudinary:D}=await import("./cloudinaryUpload-C-K8WG66.js");return{uploadToCloudinary:D}},__vite__mapDeps([0,1,2])),L=await d(N,"delivery-proofs");c(L)}catch{alert("Erro ao fazer upload da foto")}finally{i(!1)}}},j=()=>{f.mutate({order_id:s.id,entregador_id:t.id,photo_url:x,notes:u,delivered_at:new Date().toISOString()})};return e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:`${a?"bg-gray-800":"bg-white"} rounded-2xl max-w-lg w-full p-6`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:`text-xl font-bold ${a?"text-white":"text-gray-900"}`,children:"Comprovante de Entrega"}),e.jsx("button",{onClick:r,className:"p-2 rounded-lg hover:bg-gray-100",children:e.jsx(V,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Foto da Entrega (Opcional)"}),e.jsx("input",{ref:m,type:"file",accept:"image/*",capture:"environment",onChange:C,className:"hidden"}),x?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:x,alt:"Comprovante",className:"w-full h-48 object-cover rounded-lg"}),e.jsx("button",{onClick:()=>c(""),className:"absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full",children:e.jsx(V,{className:"w-4 h-4"})})]}):e.jsx("button",{onClick:()=>m.current?.click(),disabled:h,className:`w-full h-32 border-2 border-dashed rounded-lg flex flex-col items-center justify-center ${a?"border-gray-600 bg-gray-700":"border-gray-300 bg-gray-50"}`,children:h?e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}):e.jsxs(e.Fragment,{children:[e.jsx(wt,{className:"w-8 h-8 text-gray-400 mb-2"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Tirar foto"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Observa√ß√µes (Opcional)"}),e.jsx(Ee,{value:u,onChange:p=>g(p.target.value),placeholder:"Ex: Entregue na portaria, deixado com vizinho...",rows:3})]}),e.jsxs(_,{onClick:j,disabled:f.isPending,className:"w-full bg-green-500 hover:bg-green-600 text-white",children:[e.jsx(at,{className:"w-5 h-5 mr-2"}),"Confirmar Entrega"]})]})]})})}function os({order:s,entregador:t,onClose:r,darkMode:l}){const[a,x]=n.useState(5),[c,u]=n.useState(""),[g,h]=n.useState(0),i=we(),m=ce({mutationFn:f=>$.entities.DeliveryRating.create(f),onSuccess:()=>{i.invalidateQueries({queryKey:["deliveryOrders"]}),r()}}),b=()=>{m.mutate({order_id:s.id,entregador_id:t.id,rating:a,comment:c,rated_by:"entregador"})};return e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:`${l?"bg-gray-800":"bg-white"} rounded-2xl max-w-lg w-full p-6`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:`text-xl font-bold ${l?"text-white":"text-gray-900"}`,children:"Avaliar Cliente"}),e.jsx("button",{onClick:r,className:"p-2 rounded-lg hover:bg-gray-100",children:e.jsx(V,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:`text-sm mb-3 ${l?"text-gray-300":"text-gray-600"}`,children:"Como foi sua experi√™ncia com este cliente?"}),e.jsx("p",{className:"font-bold text-lg mb-4",children:s.customer_name}),e.jsx("div",{className:"flex justify-center gap-2 mb-2",children:[1,2,3,4,5].map(f=>e.jsx("button",{onClick:()=>x(f),onMouseEnter:()=>h(f),onMouseLeave:()=>h(0),className:"transition-transform hover:scale-110",children:e.jsx(Ve,{className:`w-10 h-10 ${(g||a)>=f?"fill-yellow-400 text-yellow-400":"text-gray-300"}`})},f))}),e.jsxs("p",{className:"text-sm text-gray-500",children:[a===1&&"Muito ruim",a===2&&"Ruim",a===3&&"Regular",a===4&&"Bom",a===5&&"Excelente"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Coment√°rio (Opcional)"}),e.jsx(Ee,{value:c,onChange:f=>u(f.target.value),placeholder:"Deixe um coment√°rio sobre o atendimento...",rows:3})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(_,{onClick:r,variant:"outline",className:"flex-1",children:"Pular"}),e.jsx(_,{onClick:b,disabled:m.isPending,className:"flex-1 bg-blue-500 hover:bg-blue-600 text-white",children:"Enviar Avalia√ß√£o"})]})]})]})})}const X=[{title:"Bem-vindo!",description:"Este √© o painel de entregas. Aqui voc√™ gerencia seus pedidos e acompanha seus ganhos.",icon:"üëã"},{title:"Status de Disponibilidade",description:"Ative/desative sua disponibilidade para receber novos pedidos. S√≥ receba quando estiver pronto!",icon:"üü¢"},{title:"Pedidos Ativos",description:"Veja todos os pedidos que voc√™ precisa entregar. Clique em um pedido para ver os detalhes completos.",icon:"üì¶"},{title:"Navega√ß√£o GPS",description:"Use o mapa para ver a rota e o bot√£o de navega√ß√£o para abrir no Google Maps ou Waze.",icon:"üó∫Ô∏è"},{title:"C√≥digo de Valida√ß√£o",description:"Cada entrega tem um c√≥digo de 4 d√≠gitos. O cliente ir√° fornecer este c√≥digo ao receber o pedido.",icon:"üî¢"},{title:"Comprovante de Entrega",description:"Tire uma foto e deixe observa√ß√µes para comprovar que a entrega foi realizada.",icon:"üì∏"},{title:"Relat√≥rio de Ganhos",description:"Acompanhe seus ganhos di√°rios, semanais e mensais. Exporte relat√≥rios quando precisar.",icon:"üí∞"}];function cs({onClose:s,darkMode:t}){const[r,l]=n.useState(0),[a,x]=n.useState(!1),c=()=>{r<X.length-1?l(r+1):(a&&localStorage.setItem("entregador_tutorial_never_show","true"),s())},u=()=>{r>0&&l(r-1)},g=X[r];return e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:`${t?"bg-gray-800":"bg-white"} rounded-2xl max-w-lg w-full p-6`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:`text-xl font-bold ${t?"text-white":"text-gray-900"}`,children:"Tutorial"}),e.jsx("button",{onClick:s,className:"p-2 rounded-lg hover:bg-gray-100",children:e.jsx(V,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex justify-between mb-2",children:X.map((h,i)=>e.jsx("div",{className:`h-1 flex-1 mx-1 rounded-full ${i<=r?"bg-blue-500":t?"bg-gray-700":"bg-gray-200"}`},i))}),e.jsxs("p",{className:"text-xs text-gray-500 text-center",children:[r+1," de ",X.length]})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:g.icon}),e.jsx("h3",{className:`text-2xl font-bold mb-3 ${t?"text-white":"text-gray-900"}`,children:g.title}),e.jsx("p",{className:`text-lg ${t?"text-gray-300":"text-gray-600"}`,children:g.description})]}),r===X.length-1&&e.jsx("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a,onChange:h=>x(h.target.checked),className:"w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"N√£o mostrar este tutorial novamente"})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(_,{onClick:u,disabled:r===0,variant:"outline",className:"flex-1",children:[e.jsx(Nt,{className:"w-5 h-5 mr-2"}),"Anterior"]}),e.jsxs(_,{onClick:c,className:"flex-1 bg-blue-500 hover:bg-blue-600 text-white",children:[r===X.length-1?"Finalizar":"Pr√≥ximo",r<X.length-1&&e.jsx(_t,{className:"w-5 h-5 ml-2"})]})]})]})})}function ds({entregador:s,onClose:t,onDarkModeChange:r}){const[l,a]=n.useState({notifications_enabled:s.notifications_enabled??!0,sound_enabled:s.sound_enabled??!0,vibration_enabled:s.vibration_enabled??!0,dark_mode:s.dark_mode??!1}),x=we(),c=ce({mutationFn:i=>s._isMaster?Promise.resolve(i):$.entities.Entregador.update(s.id,i),onSuccess:()=>{x.invalidateQueries({queryKey:["entregador"]}),t()}}),u=i=>{const m={...l,[i]:!l[i]};a(m),i==="dark_mode"&&r(m.dark_mode)},g=()=>{l.notifications_enabled&&"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission().then(i=>{i==="granted"?ee.success("Permiss√£o de notifica√ß√µes concedida!"):ee.error("Permiss√£o negada. Ative nas configura√ß√µes do navegador.")}),c.mutate({...s,...l})},h=()=>{const i=new Audio("https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3");i.volume=.8,i.play().catch(()=>ee.error("Erro ao reproduzir som")),l.vibration_enabled&&navigator.vibrate&&navigator.vibrate([300,100,300]),ee.success("Som de teste reproduzido!")};return e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:`${l.dark_mode?"bg-gray-800":"bg-white"} rounded-2xl max-w-lg w-full p-6`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:`text-xl font-bold ${l.dark_mode?"text-white":"text-gray-900"}`,children:"Configura√ß√µes"}),e.jsx("button",{onClick:t,className:"p-2 rounded-lg hover:bg-gray-100",children:e.jsx(V,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ct,{className:"w-5 h-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx(he,{children:"Notifica√ß√µes Push"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Receba alertas de novos pedidos"})]})]}),e.jsx(pe,{checked:l.notifications_enabled,onCheckedChange:()=>u("notifications_enabled")})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(St,{className:"w-5 h-5 text-green-500"}),e.jsxs("div",{children:[e.jsx(he,{children:"Som"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Alertas sonoros"})]})]}),e.jsx(pe,{checked:l.sound_enabled,onCheckedChange:()=>u("sound_enabled")})]}),l.sound_enabled&&e.jsxs("button",{onClick:h,className:"mt-2 ml-8 text-xs text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[e.jsx(Et,{className:"w-3 h-3"}),"Testar Som"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Xt,{className:"w-5 h-5 text-purple-500"}),e.jsxs("div",{children:[e.jsx(he,{children:"Vibra√ß√£o"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Vibrar ao receber pedidos"})]})]}),e.jsx(pe,{checked:l.vibration_enabled,onCheckedChange:()=>u("vibration_enabled")})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[l.dark_mode?e.jsx(Rt,{className:"w-5 h-5 text-indigo-500"}):e.jsx(Ot,{className:"w-5 h-5 text-yellow-500"}),e.jsxs("div",{children:[e.jsx(he,{children:"Modo Escuro"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Tema escuro para a noite"})]})]}),e.jsx(pe,{checked:l.dark_mode,onCheckedChange:()=>u("dark_mode")})]}),e.jsx(_,{onClick:g,disabled:c.isPending,className:"w-full bg-blue-500 hover:bg-blue-600 text-white",children:"Salvar Configura√ß√µes"})]})]})})}function xs({entregador:s,enabled:t}){const r=n.useRef(0),l=n.useRef(null),a=n.useRef(!1),{data:x=[]}=oe({queryKey:["availableOrdersNotif"],queryFn:async()=>(await $.entities.Order.filter({status:"ready",delivery_method:"delivery"})).filter(u=>!u.entregador_id),enabled:t&&s?.status==="available",refetchInterval:3e3});return n.useEffect(()=>{!t||a.current||"Notification"in window&&Notification.permission==="default"&&(Notification.requestPermission().then(c=>{c==="granted"&&ee.success("Notifica√ß√µes ativadas! ‚úÖ")}),a.current=!0)},[t]),n.useEffect(()=>(l.current=new Audio("https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"),l.current.volume=.8,l.current.load(),()=>{l.current&&(l.current.pause(),l.current=null)}),[]),n.useEffect(()=>{if(!t||!s)return;const c=x.length;if(c>r.current&&r.current>0){const u=c-r.current;if(s.sound_enabled!==!1&&l.current&&l.current.play().catch(g=>console.log("Audio play failed:",g)),s.vibration_enabled!==!1&&navigator.vibrate&&navigator.vibrate([300,100,300,100,300]),Notification.permission==="granted"){const g=new Notification("üö¥ Novo Pedido Dispon√≠vel!",{body:`${u} ${u===1?"pedido pronto":"pedidos prontos"} para entrega`,icon:"/icon.png",badge:"/badge.png",tag:"new-order",requireInteraction:!0,vibrate:[300,100,300]});g.onclick=()=>{window.focus(),g.close()},setTimeout(()=>g.close(),1e4)}ee.success(`üö¥ ${u} ${u===1?"Novo pedido":"Novos pedidos"} dispon√≠vel para entrega!`,{duration:5e3,style:{background:"#10b981",color:"white",fontWeight:"bold"}})}r.current=c},[x,t,s]),null}const ms=["Muito longe da minha localiza√ß√£o","Problema no ve√≠culo","Fora da minha rota atual","Hor√°rio de pausa/descanso","Outro motivo"];function us({order:s,onConfirm:t,onCancel:r}){const[l,a]=n.useState(""),[x,c]=n.useState(""),[u,g]=n.useState(!1),h=l&&(l!=="Outro motivo"||x.trim()),i=async()=>{if(!h)return;g(!0);const m=l==="Outro motivo"?x:l;try{await t(m)}catch(b){console.error("Erro ao rejeitar:",b),g(!1)}};return e.jsx("div",{className:"fixed inset-0 z-[110] flex items-center justify-center bg-black/90 backdrop-blur-sm",children:e.jsxs(v.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-amber-500 to-orange-500 p-4",children:e.jsxs("div",{className:"flex items-center gap-3 text-white",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx(te,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:"Rejeitar Pedido"}),e.jsx("p",{className:"text-xs text-orange-100",children:"Informe o motivo da recusa"})]})]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Pedido que ser√° rejeitado:"}),e.jsxs("p",{className:"font-semibold text-gray-900",children:["#",s.order_code]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:s.address})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Motivo da rejei√ß√£o *"}),e.jsx("div",{className:"space-y-2",children:ms.map(m=>e.jsx("button",{onClick:()=>a(m),className:`w-full text-left px-4 py-3 rounded-lg border-2 transition-all ${l===m?"border-red-500 bg-red-50 text-red-700":"border-gray-200 bg-white hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:m}),l===m&&e.jsx("div",{className:"w-5 h-5 bg-red-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs",children:"‚úì"})})]})},m))})]}),l==="Outro motivo"&&e.jsx(v.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},children:e.jsx(Ee,{value:x,onChange:m=>c(m.target.value),placeholder:"Descreva o motivo...",className:"min-h-[80px]"})}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:e.jsx("p",{className:"text-xs text-yellow-700 text-center",children:"‚ö†Ô∏è Este motivo ser√° registrado e enviado ao gestor"})})]}),e.jsxs("div",{className:"p-4 bg-gray-50 border-t space-y-2",children:[e.jsx(_,{onClick:i,disabled:!h||u,className:"w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-3",children:u?"Rejeitando...":"Confirmar Rejei√ß√£o"}),e.jsx(_,{onClick:r,disabled:u,variant:"outline",className:"w-full",children:"Voltar"})]})]})})}function gs({order:s,onAccept:t,onReject:r}){const[l,a]=n.useState(!1),[x,c]=n.useState(!1),u=i=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(i||0),g=async()=>{c(!0);try{await t(s.id)}catch(i){console.error("Erro ao aceitar:",i),c(!1)}},h=async i=>{c(!0);try{await r(s.id,i),a(!1)}catch(m){console.error("Erro ao rejeitar:",m),c(!1)}};return l?e.jsx(us,{order:s,onConfirm:h,onCancel:()=>a(!1)}):e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/90 backdrop-blur-sm",children:e.jsxs(v.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0,boxShadow:["0 0 0 0 rgba(239, 68, 68, 0)","0 0 0 20px rgba(239, 68, 68, 0.2)","0 0 0 0 rgba(239, 68, 68, 0)"]},transition:{boxShadow:{duration:2,repeat:1/0,ease:"easeInOut"}},className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-red-500 to-red-600 p-4",children:e.jsxs("div",{className:"flex items-center gap-3 text-white",children:[e.jsx(v.div,{animate:{rotate:[0,10,-10,0]},transition:{duration:.5,repeat:1/0,repeatDelay:1},className:"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx(U,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-lg",children:"üîî Novo Pedido Dispon√≠vel!"}),e.jsx("p",{className:"text-xs text-red-100",children:"Tome uma decis√£o agora"})]})]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Pedido"}),e.jsxs("span",{className:"font-bold text-gray-900",children:["#",s.order_code]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(B,{className:"w-4 h-4 text-red-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-0.5",children:"Entregar em:"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.address}),s.neighborhood&&e.jsx("p",{className:"text-xs text-gray-600 mt-0.5",children:s.neighborhood})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Valor"}),e.jsx("p",{className:"font-bold text-green-600",children:u(s.total)})]})]}),s.delivery_fee>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Taxa entrega"}),e.jsx("p",{className:"font-bold text-blue-600",children:u(s.delivery_fee)})]})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-blue-700 font-medium mb-1",children:"Cliente"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:s.customer_name}),e.jsx("p",{className:"text-xs text-gray-600",children:s.customer_phone})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:e.jsx("p",{className:"text-xs text-yellow-700 text-center",children:"‚è∞ Responda rapidamente para n√£o perder este pedido"})})]}),e.jsxs("div",{className:"p-4 bg-gray-50 border-t space-y-2",children:[e.jsxs(_,{onClick:g,disabled:x,className:"w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-3 text-base",children:[e.jsx(at,{className:"w-5 h-5 mr-2"}),x?"Aceitando...":"Aceitar Pedido"]}),e.jsxs(_,{onClick:()=>a(!0),disabled:x,variant:"outline",className:"w-full border-red-300 text-red-600 hover:bg-red-50 py-3",children:[e.jsx(V,{className:"w-5 h-5 mr-2"}),"Rejeitar Pedido"]})]})]})})}function hs({entregador:s,onLocationUpdate:t}){return n.useEffect(()=>{if(!s||s._isVirtual||!navigator.geolocation)return;const r=navigator.geolocation.watchPosition(async l=>{const{latitude:a,longitude:x}=l.coords;t({lat:a,lng:x});try{await $.entities.Entregador.update(s.id,{current_latitude:a,current_longitude:x})}catch(c){console.error("Erro ao atualizar localiza√ß√£o:",c)}},l=>{console.error("Erro ao obter localiza√ß√£o:",l)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:5e3});return()=>{navigator.geolocation.clearWatch(r)}},[s,t]),null}const ze="pending_messages";function fs(s){const[t,r]=n.useState([]),[l,a]=n.useState(!0);return n.useEffect(()=>{const c=localStorage.getItem(ze);if(c)try{r(JSON.parse(c))}catch(u){console.error("Erro ao carregar mensagens:",u)}},[]),n.useEffect(()=>{if(!s)return;const c=async()=>{try{const h=(await $.entities.DeliveryMessage.filter({entregador_id:s,status:"pending"},"-created_date")).filter(i=>!t.find(m=>m.id===i.id));if(h.length>0){const i=[...t,...h];r(i),localStorage.setItem(ze,JSON.stringify(i))}}catch(g){console.error("Erro ao buscar mensagens:",g)}finally{a(!1)}};c();const u=setInterval(c,5e3);return()=>clearInterval(u)},[s,t]),{pendingMessages:t,confirmMessage:async c=>{try{const u=typeof c=="string"?c:c?.id;if(!u){console.error("ID de mensagem inv√°lido:",c);return}await $.entities.DeliveryMessage.update(u,{status:"read",read_at:new Date().toISOString()});const g=t.filter(h=>h.id!==u);r(g),localStorage.setItem(ze,JSON.stringify(g))}catch(u){console.error("Erro ao confirmar mensagem:",u)}},loading:l}}function ps(){const s=n.useRef(null),t=n.useRef(!1);n.useEffect(()=>(s.current=new Audio("https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"),s.current.loop=!0,s.current.volume=1,()=>{s.current&&(s.current.pause(),s.current=null)}),[]);const r=n.useCallback(()=>{s.current&&!t.current&&(s.current.play().catch(()=>{}),t.current=!0)},[]),l=n.useCallback(()=>{s.current&&(s.current.pause(),s.current.currentTime=0,t.current=!1)},[]),a=n.useCallback(()=>t.current,[]);return{play:r,stop:l,isPlaying:a}}const ye="pending_orders";function bs(s){const[t,r]=n.useState([]),[l,a]=n.useState(!0),{play:x,stop:c}=ps();n.useEffect(()=>{const m=localStorage.getItem(ye);if(m)try{const b=JSON.parse(m);r(b),b.length>0&&(x(),u())}catch(b){console.error("Erro ao carregar pedidos:",b)}},[]),n.useEffect(()=>{if(!s)return;const m=async()=>{try{const C=(await $.entities.Order.filter({status:"ready",entregador_id:null,delivery_method:"delivery"},"-created_date",10)).filter(j=>!t.find(p=>p.id===j.id));if(C.length>0){const j=[...t,...C];r(j),localStorage.setItem(ye,JSON.stringify(j)),x(),u()}}catch(f){console.error("Erro ao buscar pedidos:",f)}finally{a(!1)}};m();const b=setInterval(m,3e3);return()=>clearInterval(b)},[s,t,x]);const u=n.useCallback(()=>{if(navigator.vibrate){const m=setInterval(()=>{navigator.vibrate([200,100,200])},1e3);window.orderVibrateInterval=m}},[]),g=n.useCallback(()=>{window.orderVibrateInterval&&(clearInterval(window.orderVibrateInterval),window.orderVibrateInterval=null),navigator.vibrate&&navigator.vibrate(0)},[]);return{pendingOrders:t,acceptOrder:async(m,b)=>{try{const C=(await $.entities.Store.list())[0];await $.entities.Order.update(m,{entregador_id:b,status:"going_to_store",store_latitude:C?.store_latitude||-5.0892,store_longitude:C?.store_longitude||-42.8019});const j=t.filter(p=>p.id!==m);return r(j),localStorage.setItem(ye,JSON.stringify(j)),j.length===0&&(c(),g()),!0}catch(f){throw console.error("Erro ao aceitar pedido:",f),f}},rejectOrder:async(m,b)=>{try{await $.entities.OrderLog.create({order_id:m,action:"delivery_rejected",details:`Entregador rejeitou: ${b}`});const f=t.filter(C=>C.id!==m);return r(f),localStorage.setItem(ye,JSON.stringify(f)),f.length===0&&(c(),g()),!0}catch(f){throw console.error("Erro ao rejeitar pedido:",f),f}},loading:l}}function ys(s){const t=fs(s),r=bs(s),l=t.pendingMessages.length>0||r.pendingOrders.length>0;return{messages:t,orders:r,hasCriticalAlerts:l,loading:t.loading||r.loading}}const js=(s,t)=>{if(s.length===0)return{optimizedOrders:[],totalDistance:0,estimatedTime:0};const r=[...s],l=[];let a=t,x=0;for(;r.length>0;){let u=0,g=et(a,r[0].coordinates);for(let i=1;i<r.length;i++){const m=et(a,r[i].coordinates);m<g&&(g=m,u=i)}const h=r.splice(u,1)[0];l.push(h),a=h.coordinates,x+=g}const c=Math.round(x/25*60+l.length*7);return{optimizedOrders:l,totalDistance:Math.round(x*10)/10,estimatedTime:c}},et=(s,t)=>{const l=je(t.lat-s.lat),a=je(t.lng-s.lng),x=je(s.lat),c=je(t.lat),u=Math.sin(l/2)*Math.sin(l/2)+Math.sin(a/2)*Math.sin(a/2)*Math.cos(x)*Math.cos(c);return 6371*(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)))},je=s=>s*(Math.PI/180),vs=async s=>{try{const r=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(s)}&limit=1`)).json();if(r&&r.length>0)return{lat:parseFloat(r[0].lat),lng:parseFloat(r[0].lon)}}catch(t){console.error("Erro ao geocodificar:",t)}return null};function ws({orders:s,currentLocation:t,onNavigate:r}){return re.useRef(null),re.useRef(null),re.useRef([]),re.useRef(null),re.useRef(null),re.useEffect(()=>{},["",t,s,r]),e.jsxs("div",{className:"h-[400px] flex flex-col items-center justify-center bg-gray-100 rounded-xl",children:[e.jsx(B,{className:"w-12 h-12 text-gray-400 mb-2"}),e.jsx("p",{className:"text-gray-500 text-sm text-center px-4",children:"Configure VITE_GOOGLE_MAPS_API_KEY no .env para exibir o mapa."})]})}function Ns({isOpen:s,onClose:t,orders:r,currentLocation:l,darkMode:a}){const[x,c]=n.useState(null),[u,g]=n.useState(!1),[h,i]=n.useState(!1),m=p=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(p||0),b=async()=>{if(!l){alert("N√£o foi poss√≠vel obter sua localiza√ß√£o atual");return}g(!0),i(!0);try{const p=await Promise.all(r.map(async N=>{const d=await vs(N.address);return{...N,coordinates:d||{lat:-5.0892+(Math.random()-.5)*.05,lng:-42.8019+(Math.random()-.5)*.05}}}));i(!1),setTimeout(()=>{const N=js(p,l);c(N),g(!1)},800)}catch(p){console.error("Erro ao otimizar rota:",p),g(!1),i(!1),alert("Erro ao otimizar rota")}},f=()=>{if(x&&x.optimizedOrders.length>0){const N=x.optimizedOrders[0].coordinates,d=`https://www.google.com/maps/dir/?api=1&destination=${N.lat},${N.lng}`;window.open(d,"_blank")}},C=p=>{const N=`https://www.google.com/maps/dir/?api=1&destination=${p.lat},${p.lng}`;window.open(N,"_blank")},j=r.reduce((p,N)=>p+(N.delivery_fee||0),0);return e.jsx(Ne,{open:s,onOpenChange:t,children:e.jsxs(_e,{className:`max-w-4xl max-h-[90vh] overflow-y-auto ${a?"bg-gray-800 text-white":""}`,children:[e.jsx($e,{children:e.jsxs(Ce,{className:"flex items-center gap-2",children:[e.jsx(Yt,{className:"w-5 h-5 text-blue-600"}),"Otimiza√ß√£o de Rota"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:`${a?"bg-gray-700":"bg-blue-50"} rounded-lg p-3 text-center border ${a?"border-gray-600":"border-blue-200"}`,children:[e.jsx(B,{className:"w-5 h-5 mx-auto mb-1 text-blue-600"}),e.jsx("p",{className:`text-2xl font-bold ${a?"text-white":"text-blue-900"}`,children:r.length}),e.jsx("p",{className:`text-xs ${a?"text-gray-300":"text-blue-700"}`,children:"Entregas"})]}),e.jsxs("div",{className:`${a?"bg-gray-700":"bg-green-50"} rounded-lg p-3 text-center border ${a?"border-gray-600":"border-green-200"}`,children:[e.jsx(ve,{className:"w-5 h-5 mx-auto mb-1 text-green-600"}),e.jsx("p",{className:`text-2xl font-bold ${a?"text-white":"text-green-900"}`,children:x?`${x.totalDistance}km`:"-"}),e.jsx("p",{className:`text-xs ${a?"text-gray-300":"text-green-700"}`,children:"Dist√¢ncia"})]}),e.jsxs("div",{className:`${a?"bg-gray-700":"bg-orange-50"} rounded-lg p-3 text-center border ${a?"border-gray-600":"border-orange-200"}`,children:[e.jsx(se,{className:"w-5 h-5 mx-auto mb-1 text-orange-600"}),e.jsx("p",{className:`text-2xl font-bold ${a?"text-white":"text-orange-900"}`,children:x?`${x.estimatedTime}min`:"-"}),e.jsx("p",{className:`text-xs ${a?"text-gray-300":"text-orange-700"}`,children:"Tempo Est."})]})]}),e.jsx("div",{className:`${a?"bg-gray-700":"bg-gradient-to-r from-green-50 to-emerald-50"} rounded-lg p-4 border ${a?"border-gray-600":"border-green-200"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${a?"text-gray-300":"text-gray-600"}`,children:"Ganho Total Estimado"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:m(j)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:`text-sm ${a?"text-gray-300":"text-gray-600"}`,children:"M√©dia por Entrega"}),e.jsx("p",{className:`text-xl font-bold ${a?"text-white":"text-gray-900"}`,children:m(j/r.length)})]})]})}),x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-xl overflow-hidden",children:e.jsx(ws,{orders:x.optimizedOrders,currentLocation:l,onNavigate:C})}),e.jsxs("div",{className:`${a?"bg-gray-700":"bg-gradient-to-r from-blue-50 to-indigo-50"} rounded-lg p-4 border ${a?"border-gray-600":"border-blue-200"}`,children:[e.jsxs("h3",{className:"font-bold text-lg mb-2 flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5 text-green-600"}),"Rota Otimizada"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:a?"text-gray-300":"text-gray-600",children:"Paradas"}),e.jsx("p",{className:`font-bold text-lg ${a?"text-white":"text-gray-900"}`,children:x.optimizedOrders.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:a?"text-gray-300":"text-gray-600",children:"Dist√¢ncia"}),e.jsxs("p",{className:`font-bold text-lg ${a?"text-white":"text-gray-900"}`,children:[x.totalDistance," km"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:a?"text-gray-300":"text-gray-600",children:"Tempo"}),e.jsxs("p",{className:`font-bold text-lg ${a?"text-white":"text-gray-900"}`,children:["~",x.estimatedTime," min"]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:`font-semibold text-sm mb-3 ${a?"text-gray-300":"text-gray-700"}`,children:"Sequ√™ncia Otimizada de Entrega:"}),e.jsx("div",{className:"space-y-2",children:x.optimizedOrders.map((p,N)=>e.jsxs("div",{className:`flex items-start gap-3 p-3 rounded-lg border ${N===0?a?"bg-blue-900/30 border-blue-600":"bg-blue-50 border-blue-300":a?"bg-gray-700 border-gray-600":"bg-white border-gray-200"}`,children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold text-sm",children:N+1}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("p",{className:`font-bold ${a?"text-white":"text-gray-900"}`,children:["#",p.order_code]}),e.jsx(W,{className:"text-xs bg-gray-500",children:p.customer_name}),N===0&&e.jsx(W,{className:"text-xs bg-green-500 animate-pulse",children:"Pr√≥xima"})]}),e.jsxs("p",{className:`text-xs ${a?"text-gray-400":"text-gray-600"} flex items-start gap-1`,children:[e.jsx(B,{className:"w-3 h-3 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:p.address})]})]}),e.jsx("p",{className:"text-sm font-semibold text-green-600",children:m(p.delivery_fee||0)})]},p.id))})]}),e.jsxs("div",{className:`${a?"bg-gray-700":"bg-yellow-50"} border ${a?"border-gray-600":"border-yellow-200"} rounded-lg p-3 text-sm`,children:[e.jsx("p",{className:`font-semibold ${a?"text-yellow-400":"text-yellow-900"} mb-1`,children:"üí° Dica Inteligente:"}),e.jsx("p",{className:a?"text-gray-300":"text-yellow-800",children:'Essa rota economiza tempo priorizando entregas mais pr√≥ximas. Clique em "Iniciar Navega√ß√£o" para come√ßar pela primeira parada.'})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(_,{variant:"outline",onClick:()=>c(null),className:"h-12",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Recalcular"]}),e.jsxs(_,{onClick:f,className:"bg-green-600 hover:bg-green-700 h-12 text-base font-bold",children:[e.jsx(ie,{className:"w-5 h-5 mr-2"}),"Iniciar Navega√ß√£o"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("h3",{className:`font-bold mb-3 ${a?"text-white":"text-gray-900"}`,children:["Suas Entregas Ativas (",r.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:r.map((p,N)=>e.jsx("div",{className:`p-3 rounded-lg border ${a?"bg-gray-700 border-gray-600":"bg-white border-gray-200"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"text-xs font-bold text-gray-400",children:["#",N+1]}),e.jsxs(W,{className:"bg-blue-500 text-white text-xs",children:["#",p.order_code]})]}),e.jsx("p",{className:`font-medium ${a?"text-white":"text-gray-900"}`,children:p.customer_name}),e.jsxs("p",{className:`text-xs ${a?"text-gray-400":"text-gray-500"} mt-1 flex items-start gap-1`,children:[e.jsx(B,{className:"w-3 h-3 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:p.address})]})]}),e.jsx("p",{className:"text-lg font-bold text-green-600",children:m(p.delivery_fee||0)})]})},p.id))})]}),e.jsx(_,{onClick:b,disabled:u||!l,className:"w-full bg-blue-600 hover:bg-blue-700 h-12 text-base font-bold",children:u?e.jsxs(e.Fragment,{children:[e.jsx(tt,{className:"w-5 h-5 mr-2 animate-spin"}),h?"Localizando endere√ßos...":"Otimizando rota..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Pt,{className:"w-5 h-5 mr-2"}),"Otimizar Rota Agora"]})}),!l&&e.jsx("p",{className:"text-xs text-amber-600 text-center",children:"‚ö†Ô∏è Aguardando localiza√ß√£o GPS..."})]})]})]})})}function _s({status:s,darkMode:t}){const r=[{key:"going_to_store",label:"Indo ao Restaurante",icon:Me,progress:20},{key:"arrived_at_store",label:"No Restaurante",icon:Me,progress:40},{key:"picked_up",label:"Pedido Coletado",icon:U,progress:60},{key:"out_for_delivery",label:"Indo ao Cliente",icon:U,progress:80},{key:"delivered",label:"Entregue",icon:J,progress:100}],a=r.find(c=>c.key===s)?.progress||0,x=r.findIndex(c=>c.key===s);return e.jsxs("div",{className:`${t?"bg-gray-800":"bg-white"} rounded-2xl p-4 shadow-lg`,children:[e.jsx("div",{className:"flex items-center justify-between mb-3 overflow-x-auto pb-2",children:r.map((c,u)=>{const g=c.icon,h=s===c.key,i=x>u;return e.jsxs("div",{className:"flex-1 flex flex-col items-center min-w-[60px]",children:[e.jsx(v.div,{animate:h?{scale:[1,1.1,1]}:{},transition:{repeat:1/0,duration:2},className:`w-8 h-8 md:w-10 md:h-10 rounded-full flex items-center justify-center mb-1 md:mb-2 ${i||h?"bg-gradient-to-br from-green-500 to-green-600":t?"bg-gray-700":"bg-gray-200"}`,children:e.jsx(g,{className:`w-4 h-4 md:w-5 md:h-5 ${i||h?"text-white":"text-gray-400"}`})}),e.jsx("p",{className:`text-[10px] md:text-xs text-center font-medium leading-tight ${h?"text-blue-600 font-bold":t?"text-gray-400":"text-gray-500"}`,children:c.label})]},c.key)})}),e.jsx("div",{className:`h-2 rounded-full overflow-hidden ${t?"bg-gray-700":"bg-gray-200"}`,children:e.jsx(v.div,{initial:{width:0},animate:{width:`${a}%`},transition:{duration:.5},className:"h-full bg-gradient-to-r from-green-500 to-green-600"})}),e.jsxs("p",{className:`text-center text-xs mt-2 font-semibold ${t?"text-green-400":"text-green-600"}`,children:[a,"% Conclu√≠do"]})]})}function $s({darkMode:s}){const[t,r]=n.useState(!1),l=[{label:"Ligar para Gestor",icon:rt,action:()=>window.location.href="tel:+5586999999999",color:"from-red-500 to-red-600"},{label:"WhatsApp Emerg√™ncia",icon:Tt,action:()=>window.open("https://wa.me/5586999999999?text=üö® EMERG√äNCIA - Preciso de ajuda urgente!","_blank"),color:"from-orange-500 to-orange-600"},{label:"Cancelar",icon:V,action:()=>r(!1),color:"from-gray-500 to-gray-600"}];return e.jsxs(e.Fragment,{children:[e.jsx(v.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>r(!0),className:"fixed bottom-24 right-6 z-40 w-14 h-14 bg-gradient-to-br from-red-500 to-red-600 rounded-full shadow-2xl flex items-center justify-center",children:e.jsx("div",{className:"flex items-center justify-center w-full h-full",children:e.jsx(te,{className:"w-7 h-7 text-white animate-pulse"})})}),e.jsx(Le,{children:t&&e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4",onClick:()=>r(!1),children:e.jsxs(v.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},onClick:a=>a.stopPropagation(),className:`${s?"bg-gray-800":"bg-white"} rounded-3xl p-6 max-w-sm w-full shadow-2xl`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-red-500 rounded-2xl flex items-center justify-center",children:e.jsx(te,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:`font-bold text-lg ${s?"text-white":"text-gray-900"}`,children:"Emerg√™ncia"}),e.jsx("p",{className:`text-xs ${s?"text-gray-400":"text-gray-600"}`,children:"Precisa de ajuda?"})]})]}),e.jsx("div",{className:"space-y-3",children:l.map((a,x)=>{const c=a.icon;return e.jsx(v.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(_,{onClick:a.action,className:`w-full h-14 bg-gradient-to-r ${a.color} text-white font-bold rounded-xl shadow-lg`,children:[e.jsx(c,{className:"w-5 h-5 mr-2"}),a.label]})},x)})})]})})})]})}function Cs({darkMode:s}){const[t,r]=n.useState(100),[l,a]=n.useState(!1),[x,c]=n.useState(!1);return n.useEffect(()=>{(async()=>{if("getBattery"in navigator)try{const g=await navigator.getBattery();r(Math.round(g.level*100)),a(g.charging),g.addEventListener("levelchange",()=>{r(Math.round(g.level*100))}),g.addEventListener("chargingchange",()=>{a(g.charging)})}catch{console.log("Battery API n√£o suportada")}})()},[]),n.useEffect(()=>{t<=20&&!l?c(!0):c(!1)},[t,l]),x?e.jsx(Le,{children:e.jsx(v.div,{initial:{y:-100,opacity:0},animate:{y:0,opacity:1},exit:{y:-100,opacity:0},className:`fixed top-20 left-4 right-4 z-50 ${s?"bg-gradient-to-r from-red-900 to-red-800":"bg-gradient-to-r from-red-500 to-red-600"} rounded-2xl p-4 shadow-2xl`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(v.div,{animate:{scale:[1,1.2,1]},transition:{repeat:1/0,duration:1.5},children:e.jsx(Vt,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-bold text-white text-sm",children:["‚ö†Ô∏è Bateria Baixa: ",t,"%"]}),e.jsx("p",{className:"text-xs text-white/90",children:"Carregue seu celular para n√£o perder o rastreamento GPS"})]}),e.jsx("button",{onClick:()=>c(!1),className:"w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center",children:e.jsx(te,{className:"w-4 h-4 text-white"})})]})})}):null}function Ss({isOpen:s,onClose:t,onPause:r,darkMode:l}){const[a,x]=n.useState(15),[c,u]=n.useState("break"),g=[{value:10,label:"10 min"},{value:15,label:"15 min"},{value:30,label:"30 min"},{value:60,label:"1 hora"}],h=[{key:"break",label:"Pausa R√°pida",icon:Ft},{key:"fuel",label:"Abastecimento",icon:Kt},{key:"meal",label:"Refei√ß√£o",icon:Wt}],i=[{name:"Posto BR - 500m",type:"Combust√≠vel",distance:"500m"},{name:"Caf√© Central - 300m",type:"Caf√©",distance:"300m"},{name:"Restaurante Popular - 800m",type:"Refei√ß√£o",distance:"800m"}],m=()=>{r(a,c),t()};return e.jsx(Ne,{open:s,onOpenChange:t,children:e.jsxs(_e,{className:`max-w-md ${l?"bg-gray-800 text-white":""}`,children:[e.jsx($e,{children:e.jsxs(Ce,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5 text-blue-600"}),"Pausa Inteligente"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-semibold mb-2 ${l?"text-gray-300":"text-gray-700"}`,children:"Por quanto tempo?"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:g.map(b=>e.jsx(v.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>x(b.value),className:`p-3 rounded-xl text-sm font-bold transition-all ${a===b.value?"bg-blue-600 text-white":l?"bg-gray-700 text-gray-300":"bg-gray-100 text-gray-700"}`,children:b.label},b.value))})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-semibold mb-2 ${l?"text-gray-300":"text-gray-700"}`,children:"Motivo da pausa:"}),e.jsx("div",{className:"space-y-2",children:h.map(b=>{const f=b.icon;return e.jsxs(v.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>u(b.key),className:`w-full flex items-center gap-3 p-3 rounded-xl transition-all ${c===b.key?"bg-blue-600 text-white":l?"bg-gray-700 text-gray-300":"bg-gray-100 text-gray-700"}`,children:[e.jsx(f,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:b.label})]},b.key)})})]}),e.jsxs("div",{className:`${l?"bg-gray-700":"bg-blue-50"} rounded-xl p-3`,children:[e.jsxs("p",{className:`text-xs font-semibold mb-2 flex items-center gap-1 ${l?"text-blue-400":"text-blue-700"}`,children:[e.jsx(B,{className:"w-3 h-3"}),"Locais pr√≥ximos sugeridos:"]}),e.jsx("div",{className:"space-y-1",children:i.map((b,f)=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:l?"text-gray-300":"text-gray-700",children:b.name}),e.jsx("span",{className:`${l?"text-blue-400":"text-blue-600"} font-semibold`,children:b.distance})]},f))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-2",children:[e.jsx(_,{variant:"outline",onClick:t,className:"h-12",children:"Cancelar"}),e.jsx(_,{onClick:m,className:"bg-blue-600 hover:bg-blue-700 h-12 font-bold",children:"Iniciar Pausa"})]}),e.jsx("p",{className:`text-xs text-center ${l?"text-gray-400":"text-gray-500"}`,children:"Voc√™ n√£o receber√° novos pedidos durante a pausa"})]})]})})}function Es({isOpen:s,onClose:t,order:r,entregador:l,darkMode:a}){const[x,c]=n.useState(null),[u,g]=n.useState(""),[h,i]=n.useState(!1),m=[{key:"no_answer",label:"Cliente n√£o atende",icon:Gt,color:"text-orange-600"},{key:"wrong_address",label:"Endere√ßo incorreto",icon:Ut,color:"text-red-600"},{key:"restaurant_delay",label:"Restaurante atrasado",icon:se,color:"text-yellow-600"},{key:"order_issue",label:"Problema com pedido",icon:U,color:"text-purple-600"}],b=async()=>{if(x){i(!0);try{const f=m.find(C=>C.key===x);await $.entities.DeliveryMessage.create({entregador_id:l.id,order_id:r?.id,title:"‚ö†Ô∏è Problema Reportado",message:`${f.label}

Detalhes: ${u||"Nenhum detalhe adicional"}`,priority:"urgent",type:"alert"}),alert("Problema reportado com sucesso! O gestor foi notificado."),t()}catch{alert("Erro ao reportar problema")}finally{i(!1)}}};return e.jsx(Ne,{open:s,onOpenChange:t,children:e.jsxs(_e,{className:`max-w-md ${a?"bg-gray-800 text-white":""}`,children:[e.jsx($e,{children:e.jsxs(Ce,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5 text-orange-600"}),"Reportar Problema"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-semibold mb-3 ${a?"text-gray-300":"text-gray-700"}`,children:"Qual √© o problema?"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:m.map(f=>{const C=f.icon;return e.jsxs(v.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>c(f.key),className:`p-3 rounded-xl transition-all border-2 ${x===f.key?"bg-blue-600 text-white border-blue-600":a?"bg-gray-700 text-gray-300 border-gray-600":"bg-white text-gray-700 border-gray-200"}`,children:[e.jsx(C,{className:`w-6 h-6 mx-auto mb-1 ${x===f.key?"text-white":f.color}`}),e.jsx("p",{className:"text-xs font-medium",children:f.label})]},f.key)})})]}),x&&e.jsxs(v.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:[e.jsx("p",{className:`text-sm font-semibold mb-2 ${a?"text-gray-300":"text-gray-700"}`,children:"Detalhes adicionais (opcional):"}),e.jsx(Ee,{value:u,onChange:f=>g(f.target.value),placeholder:"Descreva o problema com mais detalhes...",className:`h-24 ${a?"bg-gray-700 border-gray-600":""}`})]}),r&&e.jsxs("div",{className:`${a?"bg-gray-700":"bg-gray-50"} rounded-xl p-3`,children:[e.jsx("p",{className:`text-xs font-semibold mb-1 ${a?"text-gray-400":"text-gray-600"}`,children:"Pedido Relacionado:"}),e.jsxs("p",{className:`text-sm font-bold ${a?"text-white":"text-gray-900"}`,children:["#",r.order_code," - ",r.customer_name]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-2",children:[e.jsx(_,{variant:"outline",onClick:t,disabled:h,className:"h-12",children:"Cancelar"}),e.jsx(_,{onClick:b,disabled:!x||h,className:"bg-orange-600 hover:bg-orange-700 h-12 font-bold",children:h?"Enviando...":"Reportar"})]}),e.jsx("p",{className:`text-xs text-center ${a?"text-gray-400":"text-gray-500"}`,children:"O gestor ser√° notificado imediatamente sobre o problema"})]})]})})}function Rs({order:s,darkMode:t}){const[r,l]=n.useState(!1);if(!s||!s.items||s.items.length===0)return null;const a=x=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(x||0);return e.jsxs("div",{className:`${t?"bg-gray-700 border-gray-600":"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200"} rounded-2xl border-2 overflow-hidden shadow-md`,children:[e.jsxs("button",{onClick:()=>l(!r),className:"w-full p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 ${t?"bg-blue-900":"bg-blue-600"} rounded-xl flex items-center justify-center`,children:e.jsx(U,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"text-left",children:[e.jsxs("p",{className:`font-bold ${t?"text-white":"text-gray-900"}`,children:["Itens do Pedido (",s.items.length,")"]}),e.jsxs("p",{className:`text-xs ${t?"text-gray-400":"text-gray-600"}`,children:["Toque para ",r?"ocultar":"visualizar"," detalhes"]})]})]}),r?e.jsx(kt,{className:`w-5 h-5 ${t?"text-gray-400":"text-gray-600"}`}):e.jsx(Dt,{className:`w-5 h-5 ${t?"text-gray-400":"text-gray-600"}`})]}),e.jsx(Le,{children:r&&e.jsxs(v.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:`${t?"bg-gray-800":"bg-white"} px-4 pb-4`,children:[e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:s.items.map((x,c)=>e.jsx(v.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:c*.05},className:`p-3 rounded-xl ${t?"bg-gray-700":"bg-gray-50"} border ${t?"border-gray-600":"border-gray-200"}`,children:e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-bold ${t?"text-white":"text-gray-900"}`,children:[x.quantity,"x"]}),e.jsx("p",{className:`font-semibold ${t?"text-white":"text-gray-900"}`,children:x.name})]}),x.complements&&x.complements.length>0&&e.jsx("div",{className:"mt-1 ml-6",children:x.complements.map((u,g)=>e.jsxs("p",{className:`text-xs ${t?"text-gray-400":"text-gray-600"}`,children:["+ ",u.name]},g))}),x.notes&&e.jsxs("p",{className:`text-xs mt-1 italic ${t?"text-gray-400":"text-gray-600"}`,children:["Obs: ",x.notes]})]}),e.jsx("p",{className:`font-bold ${t?"text-green-400":"text-green-600"} ml-2`,children:a(x.total_price)})]})},c))}),e.jsx("div",{className:`mt-3 pt-3 border-t ${t?"border-gray-700":"border-gray-200"}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:`font-semibold ${t?"text-gray-300":"text-gray-700"}`,children:"Total do Pedido:"}),e.jsx("p",{className:`text-xl font-bold ${t?"text-green-400":"text-green-600"}`,children:a(s.total)})]})})]})})]})}function Os({entregador:s,activeOrders:t=[],completedOrdersToday:r=[],darkMode:l=!1}){const a=i=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(i||0),x=i=>{if(i<60)return`${i}min`;const m=Math.floor(i/60),b=i%60;return`${m}h ${b}min`},c=r.reduce((i,m)=>i+(m.delivery_fee||0),0),u=r.length>0?r.reduce((i,m)=>{if(!m.picked_up_at||!m.delivered_at)return i;const b=new Date(m.picked_up_at),f=new Date(m.delivered_at);return i+(f-b)/6e4},0)/r.length:0,g=s.total_deliveries>0?(r.length/s.total_deliveries*100).toFixed(1):0,h=[{label:"Entregas Hoje",value:r.length,icon:U,color:"blue",change:"+12%",trend:"up"},{label:"Ganhos Hoje",value:a(c),icon:Se,color:"green",change:"+8%",trend:"up"},{label:"Tempo M√©dio",value:x(Math.round(u)),icon:se,color:"purple",change:"-5min",trend:"down"},{label:"Taxa de Conclus√£o",value:`${g}%`,icon:At,color:"orange",change:"+2%",trend:"up"}];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:`text-xl font-bold ${l?"text-white":"text-gray-900"}`,children:"Dashboard"}),e.jsx("p",{className:`text-sm ${l?"text-gray-400":"text-gray-600"}`,children:"Vis√£o geral do seu desempenho"})]}),e.jsxs(W,{className:"bg-green-500 text-white",children:[e.jsx(Ve,{className:"w-3 h-3 mr-1"}),s.rating?.toFixed(1)||"5.0"]})]}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:h.map((i,m)=>{const b=i.icon,f={blue:l?"from-blue-900/50 to-blue-800/30 border-blue-700":"from-blue-50 to-blue-100 border-blue-200",green:l?"from-green-900/50 to-green-800/30 border-green-700":"from-green-50 to-green-100 border-green-200",purple:l?"from-purple-900/50 to-purple-800/30 border-purple-700":"from-purple-50 to-purple-100 border-purple-200",orange:l?"from-orange-900/50 to-orange-800/30 border-orange-700":"from-orange-50 to-orange-100 border-orange-200"};return e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:m*.1},whileHover:{scale:1.02,y:-2},className:`bg-gradient-to-br ${f[i.color]} border rounded-2xl p-4 backdrop-blur-sm`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(b,{className:`w-5 h-5 ${i.color==="blue"?"text-blue-600":i.color==="green"?"text-green-600":i.color==="purple"?"text-purple-600":"text-orange-600"}`}),e.jsx("span",{className:`text-xs font-medium ${i.trend==="up"?"text-green-600":"text-red-600"}`,children:i.change})]}),e.jsx("p",{className:`text-2xl font-bold ${l?"text-white":"text-gray-900"} mb-1`,children:i.value}),e.jsx("p",{className:`text-xs ${l?"text-gray-400":"text-gray-600"}`,children:i.label})]},i.label)})}),e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:`${l?"bg-gray-800 border-gray-700":"bg-white border-gray-200"} border rounded-2xl p-6`,children:[e.jsx("h3",{className:`font-bold text-lg mb-4 ${l?"text-white":"text-gray-900"}`,children:"Desempenho Semanal"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:`text-sm ${l?"text-gray-300":"text-gray-700"}`,children:"Entregas Conclu√≠das"}),e.jsxs("span",{className:`text-sm font-bold ${l?"text-white":"text-gray-900"}`,children:[r.length," / ",s.total_deliveries||0]})]}),e.jsx(Ye,{value:r.length/(s.total_deliveries||1)*100,className:"h-2"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:`text-sm ${l?"text-gray-300":"text-gray-700"}`,children:"Meta de Ganhos"}),e.jsxs("span",{className:`text-sm font-bold ${l?"text-white":"text-gray-900"}`,children:[a(c)," / ",a(s.total_earnings||0)]})]}),e.jsx(Ye,{value:c/(s.total_earnings||1)*100,className:"h-2"})]})]})]}),t.length>0&&e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:`${l?"bg-gradient-to-r from-blue-900/30 to-indigo-900/30 border-blue-700":"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200"} border rounded-2xl p-4`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-xl flex items-center justify-center",children:e.jsx(U,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:`font-bold ${l?"text-white":"text-gray-900"}`,children:"Entregas em Andamento"}),e.jsxs("p",{className:`text-sm ${l?"text-gray-400":"text-gray-600"}`,children:[t.length," ",t.length===1?"entrega ativa":"entregas ativas"]})]})]}),e.jsx("div",{className:"space-y-2",children:t.slice(0,3).map((i,m)=>e.jsxs("div",{className:`${l?"bg-gray-800/50":"bg-white/50"} rounded-lg p-3 flex items-center justify-between`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:`text-sm font-medium ${l?"text-white":"text-gray-900"}`,children:["#",i.order_code]}),e.jsx("p",{className:`text-xs ${l?"text-gray-400":"text-gray-600"}`,children:i.customer_name})]})]}),e.jsx(W,{className:"bg-blue-500 text-white text-xs",children:i.status==="going_to_store"?"Indo ao restaurante":i.status==="picked_up"?"Coletado":i.status==="out_for_delivery"?"Em rota":"Aguardando"})]},i.id))})]})]})}function Sa(){const[s,t]=n.useState({}),[r,l]=n.useState({}),[a,x]=n.useState(null),[c,u]=n.useState(null),[g,h]=n.useState(null),[i,m]=n.useState(!1),[b,f]=n.useState(!1),[C,j]=n.useState(!1),[p,N]=n.useState(!1),[d,L]=n.useState(!1),[D,E]=n.useState(null),[le,Re]=n.useState(!1),[de,ne]=n.useState(null),[Oe,M]=n.useState(!1),[Pe,Te]=n.useState(!1),[S,P]=n.useState(!1),[q,I]=n.useState(!1),[xe,me]=n.useState(null),Q=n.useRef(null),R=we(),{slug:A}=st(),{user:F,entregador:y,loading:G,asSubscriber:H,isMaster:ae}=es(),{activeOrders:O,completedOrders:Ie,completedOrdersToday:nt}=ts(y?.id,H,ae),ue=ys(y?.id);n.useEffect(()=>{y&&L(y.dark_mode||!1)},[y]),n.useEffect(()=>{const o=localStorage.getItem("entregador_tutorial_seen"),w=localStorage.getItem("entregador_tutorial_never_show");!o&&!w&&y&&setTimeout(()=>m(!0),1e3)},[y]);const Fe=n.useRef(0);n.useEffect(()=>{const o=O.filter(w=>w.status===z.OUT_FOR_DELIVERY).length;o>Fe.current&&y?.sound_enabled!==!1&&(Q.current&&(Q.current.volume=1,Q.current.play().catch(()=>{})),navigator.vibrate&&navigator.vibrate([300,100,300,100,300])),Fe.current=o},[O,y]);const K=O[0],{coordinates:ke}=ss(K?.address);n.useEffect(()=>{if(!K){ne(null);return}if(K.customer_latitude&&K.customer_longitude){ne({lat:K.customer_latitude,lng:K.customer_longitude});return}ke?ne(ke):K.store_latitude!=null&&K.store_longitude!=null&&ne({lat:K.store_latitude,lng:K.store_longitude})},[K,ke]);const it=ce({mutationFn:({orderId:o,status:w})=>$.entities.Order.update(o,{status:w,delivered_at:w==="delivered"?new Date().toISOString():void 0}),onSuccess:()=>{R.invalidateQueries({queryKey:["deliveryOrders"]}),R.invalidateQueries({queryKey:["allDeliveryOrders"]})}}),{data:ge=[]}=oe({queryKey:["availableOrders"],queryFn:async()=>(await $.entities.Order.filter({status:"ready",delivery_method:"delivery"})).filter(w=>!w.entregador_id),enabled:!!y&&y.status==="available",refetchInterval:3e3}),He=ce({mutationFn:async()=>{const o=y.status==="available"?"offline":"available";return y._isVirtual||y._isMaster?{...y,status:o}:await $.entities.Entregador.update(y.id,{...y,status:o})},onSuccess:o=>{setEntregador(o),R.invalidateQueries({queryKey:["entregadores"]})}}),ot=o=>{const w=s[o.id]||"";if(!w){alert("Por favor, informe o c√≥digo de entrega fornecido pelo cliente");return}if(w!==o.delivery_code){alert("C√≥digo de entrega inv√°lido! Verifique com o cliente.");return}u(o),t(T=>{const k={...T};return delete k[o.id],k})},ct=()=>{const o=c;it.mutate({orderId:o.id,status:"delivered"}),y._isMaster?setEntregador(w=>({...w,status:"available",total_deliveries:(w.total_deliveries||0)+1,total_earnings:(w.total_earnings||0)+(o.delivery_fee||0)})):$.entities.Entregador.update(y.id,{status:"available",current_order_id:null,total_deliveries:(y.total_deliveries||0)+1,total_earnings:(y.total_earnings||0)+(o.delivery_fee||0)}),u(null),setTimeout(()=>h(o),500)},dt=()=>{localStorage.setItem("entregador_tutorial_seen","true"),m(!1)},xt=(o,w)=>{I(!0);const T=new Date(Date.now()+o*6e4);me(T),setTimeout(()=>{I(!1),me(null)},o*6e4)},mt=o=>{if(o==null||o==="")return"‚Äî";const w=new Date(o);if(Number.isNaN(w.getTime()))return"‚Äî";const k=new Date-w,Y=Math.floor(k/6e4);if(Y<0||!Number.isFinite(Y))return"‚Äî";if(Y<1)return"Agora";if(Y<60)return`${Y}m atr√°s`;const De=Math.floor(Y/60);return De<24?`${De}h atr√°s`:`${Math.floor(De/24)}d atr√°s`},ut=(o,w="")=>{const T=o.replace(/\D/g,"");window.open(`https://wa.me/55${T}?text=${encodeURIComponent(w)}`)},gt=o=>{window.location.href=`tel:${o}`};return G?e.jsx("div",{className:`min-h-screen flex items-center justify-center ${d?"bg-gray-900":"bg-gray-50"}`,children:e.jsx(tt,{className:"w-12 h-12 animate-spin text-blue-500"})}):!G&&!y&&!ae&&F?.profile_role!=="entregador"?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-lg text-center max-w-md",children:[e.jsx(bt,{className:"w-16 h-16 text-blue-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"App Entregador"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Esta funcionalidade n√£o est√° dispon√≠vel no seu plano atual."}),e.jsx(Ke,{to:Be("PainelAssinante",A||void 0),children:e.jsx(_,{className:"bg-blue-500 hover:bg-blue-600",children:"Voltar ao Painel"})})]})}):y?e.jsx(yt,{children:e.jsxs("div",{className:`min-h-screen ${d?"bg-gray-900":"bg-gradient-to-br from-blue-50 via-indigo-50 to-blue-50"}`,children:[e.jsx("audio",{ref:Q,preload:"auto",volume:"1.0",children:e.jsx("source",{src:"https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3",type:"audio/mpeg"})}),e.jsx(xs,{entregador:y,enabled:y?.notifications_enabled!==!1&&!q}),e.jsx(Cs,{darkMode:d}),e.jsx($s,{darkMode:d}),e.jsx("header",{className:`${d?"bg-gradient-to-r from-gray-800 via-gray-900 to-gray-800 border-gray-700":"bg-gradient-to-r from-white via-gray-50 to-white border-gray-200"} border-b-2 sticky top-0 z-40 backdrop-blur-lg shadow-lg`,children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[y.photo?e.jsx(v.img,{whileHover:{scale:1.1},src:y.photo,alt:y.name,className:"w-12 h-12 rounded-2xl object-cover border-2 border-blue-500 shadow-lg"}):e.jsx(v.div,{whileHover:{scale:1.1,rotate:360},transition:{duration:.5},className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-lg",children:e.jsx(Ae,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:`font-bold text-lg ${d?"text-white":"text-gray-900"}`,children:y.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[y.vehicle_type&&e.jsx("span",{className:"text-base",children:jt[y.vehicle_type]||"üöó"}),e.jsxs("div",{className:"flex items-center gap-1 bg-yellow-100 px-2 py-0.5 rounded-full",children:[e.jsx(Ve,{className:"w-3 h-3 text-yellow-600 fill-yellow-600"}),e.jsx("span",{className:"text-xs font-bold text-yellow-700",children:y.rating?.toFixed(1)||"5.0"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(It,{pageName:"Entregador",compact:!0}),e.jsx(_,{variant:"ghost",size:"icon",onClick:()=>m(!0),className:"hidden md:flex min-h-touch min-w-touch",children:e.jsx(Je,{className:"w-5 h-5"})}),e.jsx(_,{variant:"ghost",size:"icon",onClick:()=>j(!0),className:"hidden md:flex",children:e.jsx(We,{className:"w-5 h-5"})}),e.jsx(_,{variant:"ghost",size:"icon",onClick:()=>$.auth.logout(),className:"hidden md:flex text-red-600",children:e.jsx(Ze,{className:"w-5 h-5"})}),e.jsx(_,{variant:"ghost",size:"icon",onClick:()=>M(!0),className:"md:hidden",children:e.jsx(qt,{className:"w-5 h-5"})})]})]})})}),Oe&&e.jsx("div",{className:"md:hidden fixed inset-0 z-50 bg-black/50",onClick:()=>M(!1),children:e.jsxs("div",{className:`w-64 h-full ${d?"bg-gray-800":"bg-white"} shadow-xl`,onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h2",{className:`font-bold ${d?"text-white":"text-gray-900"}`,children:"Menu"}),e.jsx("button",{onClick:()=>M(!1),children:e.jsx(V,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-2",children:[e.jsxs("button",{onClick:()=>{f(!0),M(!1)},className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left ${d?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:[e.jsx(Ae,{className:"w-5 h-5"}),e.jsx("span",{children:"Perfil"})]}),e.jsxs("button",{onClick:()=>{N(!0),M(!1)},className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left ${d?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:[e.jsx(ve,{className:"w-5 h-5"}),e.jsx("span",{children:"Ganhos"})]}),e.jsxs("button",{onClick:()=>{j(!0),M(!1)},className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left ${d?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:[e.jsx(We,{className:"w-5 h-5"}),e.jsx("span",{children:"Configura√ß√µes"})]}),e.jsxs("button",{onClick:()=>{m(!0),M(!1)},className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left ${d?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:[e.jsx(Je,{className:"w-5 h-5"}),e.jsx("span",{children:"Tutorial"})]}),e.jsxs("button",{onClick:()=>$.auth.logout(),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left text-red-500 hover:bg-red-50",children:[e.jsx(Ze,{className:"w-5 h-5"}),e.jsx("span",{children:"Sair"})]})]})]})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsx(Os,{entregador:y,activeOrders:O,completedOrdersToday:nt,darkMode:d})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:`${d?"bg-gradient-to-br from-gray-800 via-gray-900 to-gray-800":"bg-gradient-to-br from-white via-gray-50 to-white"} rounded-3xl p-4 md:p-6 shadow-2xl border ${d?"border-gray-700":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:`text-lg md:text-xl font-bold ${d?"text-white":"text-gray-900"} mb-1`,children:"Status de Disponibilidade"}),e.jsx("p",{className:`text-xs md:text-sm ${d?"text-gray-400":"text-gray-500"}`,children:y.status==="available"?"Voc√™ est√° dispon√≠vel para receber pedidos":"Voc√™ est√° offline"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full",children:[e.jsx(v.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>He.mutate(),disabled:He.isPending||q,className:`flex-1 px-6 py-3 md:py-4 rounded-2xl font-bold text-sm md:text-base text-white transition-all shadow-lg ${q?"bg-gradient-to-r from-orange-500 to-orange-600 cursor-not-allowed":y.status==="available"?"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700":"bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700"}`,children:q?e.jsx("span",{className:"flex items-center justify-center gap-2",children:"‚è∏Ô∏è Em Pausa"}):y.status==="available"?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 md:w-3 md:h-3 bg-white rounded-full animate-pulse"}),"Dispon√≠vel"]}):"‚ö´ Offline"}),y.status==="available"&&!q&&e.jsx(v.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>Te(!0),className:"flex-1 sm:flex-none sm:px-8 px-4 py-3 rounded-2xl font-bold text-sm bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white shadow-lg",children:"‚è∏Ô∏è Pausar"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 md:gap-4",children:[e.jsxs(v.div,{whileHover:{scale:1.02,y:-2},className:`p-3 md:p-5 rounded-2xl ${d?"bg-gradient-to-br from-blue-900/50 to-blue-800/30 border border-blue-700":"bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200"} backdrop-blur-sm`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(U,{className:"w-5 md:w-7 h-5 md:h-7 text-blue-600"}),O.length>0&&e.jsx("span",{className:"w-5 h-5 md:w-6 md:h-6 bg-blue-600 text-white rounded-full text-[10px] md:text-xs font-bold flex items-center justify-center",children:O.length})]}),e.jsx("p",{className:`text-2xl md:text-3xl font-bold ${d?"text-white":"text-blue-700"} mb-1`,children:O.length}),e.jsx("p",{className:`text-[10px] md:text-xs ${d?"text-gray-400":"text-gray-600"} font-medium`,children:"Entregas Ativas"})]}),e.jsxs(v.div,{whileHover:{scale:1.02,y:-2},className:`p-3 md:p-5 rounded-2xl ${d?"bg-gradient-to-br from-green-900/50 to-green-800/30 border border-green-700":"bg-gradient-to-br from-green-50 to-green-100 border border-green-200"} backdrop-blur-sm`,children:[e.jsx(J,{className:"w-5 md:w-7 h-5 md:h-7 text-green-600 mb-2"}),e.jsx("p",{className:`text-2xl md:text-3xl font-bold ${d?"text-white":"text-green-700"} mb-1`,children:y.total_deliveries||0}),e.jsx("p",{className:`text-[10px] md:text-xs ${d?"text-gray-400":"text-gray-600"} font-medium`,children:"Total de Entregas"})]}),e.jsxs(v.div,{whileHover:{scale:1.02,y:-2},className:`p-3 md:p-5 rounded-2xl ${d?"bg-gradient-to-br from-purple-900/50 to-purple-800/30 border border-purple-700":"bg-gradient-to-br from-purple-50 to-purple-100 border border-purple-200"} backdrop-blur-sm`,children:[e.jsx(Se,{className:"w-5 md:w-7 h-5 md:h-7 text-purple-600 mb-2"}),e.jsx("p",{className:`text-lg md:text-2xl font-bold ${d?"text-white":"text-purple-700"} mb-1 break-words`,children:fe(y.total_earnings||0)}),e.jsx("p",{className:`text-[10px] md:text-xs ${d?"text-gray-400":"text-gray-600"} font-medium`,children:"Ganhos Totais"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 md:gap-3 mt-4 md:mt-6",children:[e.jsx(v.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(_,{onClick:()=>f(!0),variant:"outline",className:`w-full h-10 md:h-12 rounded-xl font-semibold text-sm ${d?"border-gray-700 hover:bg-gray-800":"border-gray-300 hover:bg-gray-50"}`,children:[e.jsx(Ae,{className:"w-4 md:w-5 h-4 md:h-5 mr-1 md:mr-2"}),"Perfil"]})}),e.jsx(v.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(_,{onClick:()=>N(!0),variant:"outline",className:`w-full h-10 md:h-12 rounded-xl font-semibold text-sm ${d?"border-gray-700 hover:bg-gray-800":"border-gray-300 hover:bg-gray-50"}`,children:[e.jsx(ve,{className:"w-4 md:w-5 h-4 md:h-5 mr-1 md:mr-2"}),"Relat√≥rio"]})})]})]})}),e.jsx(hs,{entregador:y,onLocationUpdate:E}),O.length>0&&e.jsx("div",{className:"max-w-7xl mx-auto px-4 pb-4",children:e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:`${d?"bg-gray-800 border-gray-700":"bg-white border-gray-200"} rounded-3xl overflow-hidden shadow-2xl border-2`,children:[e.jsx("div",{className:`p-4 border-b ${d?"bg-gray-900/50 border-gray-700":"bg-gradient-to-r from-blue-50 to-indigo-50 border-gray-200"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx(B,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:`font-bold ${d?"text-white":"text-gray-900"}`,children:"Rota em Tempo Real"}),e.jsx("p",{className:`text-xs ${d?"text-gray-400":"text-gray-600"}`,children:D?"Navega√ß√£o GPS ativa":"Aguardando localiza√ß√£o..."})]})]}),e.jsx(W,{className:D?"bg-green-500 text-white":"bg-yellow-500 text-white",children:D?"Ao vivo":"Carregando"})]})}),e.jsx("div",{className:"h-[400px] md:h-[500px]",children:e.jsx(ls,{entregadorLocation:D,storeLocation:O[0]?.store_latitude&&O[0]?.store_longitude?{lat:O[0].store_latitude,lng:O[0].store_longitude}:null,customerLocation:de,order:O[0],darkMode:d,mode:"entregador",onNavigate:o=>{window.open(`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(o)}`,"_blank")}})})]})}),q&&xe&&e.jsx("div",{className:"max-w-7xl mx-auto px-4 pb-4",children:e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-orange-500 to-orange-600 rounded-3xl p-6 text-white shadow-2xl text-center",children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:"‚è∏Ô∏è Voc√™ est√° em pausa"}),e.jsxs("p",{className:"text-3xl font-bold mb-2",children:[Math.max(0,Math.ceil((xe-new Date)/6e4))," minutos restantes"]}),e.jsx("p",{className:"text-sm opacity-90 mb-4",children:"Voc√™ n√£o receber√° novos pedidos at√© o fim da pausa"}),e.jsx(_,{onClick:()=>{I(!1),me(null)},variant:"outline",className:"bg-white text-orange-600 hover:bg-gray-100",children:"Retomar Agora"})]})}),y.status==="available"&&!q&&!O.length&&ge&&ge.length>0&&e.jsxs("div",{className:"max-w-7xl mx-auto px-4 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:`text-xl font-bold ${d?"text-white":"text-gray-900"}`,children:["Pedidos Dispon√≠veis (",ge.length,")"]}),e.jsx(W,{className:"bg-green-500 text-white animate-pulse",children:"Novos!"})]}),e.jsx("div",{className:"space-y-4",children:ge.map(o=>e.jsxs("div",{className:`${d?"bg-gray-800 border-gray-700":"bg-white border-gray-200"} rounded-xl p-4 border shadow-sm hover:shadow-md transition-shadow`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs(W,{className:"bg-orange-500 text-white mb-2",children:["#",o.order_code]}),e.jsx("h3",{className:`font-bold ${d?"text-white":"text-gray-900"}`,children:o.customer_name}),e.jsx("p",{className:`text-sm ${d?"text-gray-400":"text-gray-600"}`,children:o.customer_phone})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:fe(o.delivery_fee||0)}),e.jsx("p",{className:`text-xs ${d?"text-gray-400":"text-gray-600"}`,children:"Taxa de entrega"})]})]}),e.jsx("div",{className:`p-3 rounded-lg mb-3 ${d?"bg-gray-700":"bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:`text-sm ${d?"text-white":"text-gray-900"}`,children:o.address||"Endere√ßo n√£o informado"})]})}),e.jsxs(_,{onClick:async()=>{try{const T=(await $.entities.Store.list())[0];await $.entities.Order.update(o.id,{...o,entregador_id:y.id,status:"going_to_store",store_latitude:T?.store_latitude||-5.0892,store_longitude:T?.store_longitude||-42.8019}),y._isVirtual||await $.entities.Entregador.update(y.id,{...y,status:"busy",current_order_id:o.id}),R.invalidateQueries({queryKey:["deliveryOrders"]}),R.invalidateQueries({queryKey:["availableOrders"]}),R.invalidateQueries({queryKey:["entregadores"]}),R.invalidateQueries({queryKey:["gestorOrders"]}),Q.current&&Q.current.play().catch(()=>{})}catch{alert("Erro ao aceitar entrega")}},className:"w-full bg-green-500 hover:bg-green-600 h-12",children:[e.jsx(J,{className:"w-5 h-5 mr-2"}),"Aceitar Entrega"]})]},o.id))})]}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:`text-xl font-bold ${d?"text-white":"text-gray-900"}`,children:["Entregas Ativas (",O.length,")"]}),O.length>1&&e.jsxs(_,{onClick:()=>Re(!0),className:"bg-blue-600 hover:bg-blue-700",size:"sm",children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Otimizar Rota"]})]}),O.length===0?e.jsxs("div",{className:`${d?"bg-gray-800":"bg-white"} rounded-2xl p-12 text-center`,children:[e.jsx(U,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:`font-bold mb-2 ${d?"text-white":"text-gray-900"}`,children:y.status==="available"?"Aguardando pedidos...":"Voc√™ est√° offline"}),e.jsx("p",{className:d?"text-gray-400":"text-gray-500",children:y.status==="available"?"Novos pedidos aparecer√£o aqui quando estiverem prontos para entrega":'Mude seu status para "Dispon√≠vel" para receber pedidos'})]}):e.jsx("div",{className:"space-y-4",children:O.map(o=>e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},whileHover:{scale:1.01,y:-2},className:`${d?"bg-gradient-to-br from-gray-800 to-gray-900 border-gray-700":"bg-gradient-to-br from-white to-gray-50 border-gray-200"} rounded-3xl p-4 md:p-6 shadow-2xl border-2`,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start justify-between gap-3 md:gap-0 mb-5",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[e.jsxs(W,{className:"bg-gradient-to-r from-blue-600 to-blue-500 text-white font-bold px-2 md:px-3 py-1 shadow-lg text-xs",children:["#",o.order_code]}),e.jsx("span",{className:`text-xs font-medium ${d?"text-gray-400":"text-gray-500"}`,children:mt(o.created_date)})]}),e.jsx("h3",{className:`font-bold text-lg md:text-xl ${d?"text-white":"text-gray-900"} mb-1`,children:o.customer_name}),e.jsxs("p",{className:`text-xs md:text-sm ${d?"text-gray-400":"text-gray-600"} flex items-center gap-2`,children:[e.jsx("span",{children:"üì±"})," ",o.customer_phone]})]}),e.jsxs(v.div,{whileHover:{scale:1.05},className:`text-center sm:text-right ${d?"bg-green-900/30":"bg-green-50"} px-3 md:px-4 py-2 md:py-3 rounded-2xl border-2 ${d?"border-green-700":"border-green-200"} w-full sm:w-auto`,children:[e.jsx("p",{className:`text-[10px] md:text-xs ${d?"text-green-400":"text-green-700"} font-semibold mb-1`,children:"Taxa de Entrega"}),e.jsx("p",{className:"font-bold text-xl md:text-2xl text-green-600",children:fe(o.delivery_fee||0)})]})]}),e.jsx("div",{className:"mb-5",children:e.jsx(_s,{status:o.status,darkMode:d})}),e.jsx("div",{className:"mb-5",children:e.jsx(Rs,{order:o,darkMode:d})}),e.jsxs(v.div,{whileHover:{scale:1.01},className:`p-5 rounded-2xl mb-5 ${d?"bg-gray-700/70 border-gray-600":"bg-gradient-to-r from-red-50 to-pink-50 border-red-200"} border-2 shadow-inner`,children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-red-500 rounded-xl flex items-center justify-center shadow-lg flex-shrink-0",children:e.jsx(B,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`text-xs font-bold ${d?"text-red-400":"text-red-700"} mb-1 uppercase tracking-wide`,children:"Endere√ßo de Entrega"}),e.jsx("p",{className:`font-bold text-base ${d?"text-white":"text-gray-900"} mb-1`,children:o.address}),o.neighborhood&&e.jsxs("p",{className:`text-sm ${d?"text-gray-400":"text-gray-600"}`,children:["üìç ",o.neighborhood]})]})]}),o.customer_latitude&&o.customer_longitude||o.address?e.jsxs(_,{onClick:()=>{let w="";const T=o.address||"",k=o.customer_latitude,Y=o.customer_longitude;k&&Y?w=`https://www.google.com/maps/dir/?api=1&destination=${k},${Y}`:T&&(w=`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(T)}`),w?window.open(w,"_blank"):ee.error("Endere√ßo n√£o dispon√≠vel para navega√ß√£o")},className:"w-full mt-3 bg-blue-500 hover:bg-blue-600 text-white font-semibold h-10",children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Ir at√© o Cliente (Google Maps)"]}):null]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[e.jsx(v.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(_,{onClick:()=>ut(o.customer_phone,`Ol√°! Sou o entregador do seu pedido #${o.order_code}. Estou a caminho!`),variant:"outline",className:`w-full h-10 md:h-12 rounded-xl font-semibold text-xs ${d?"border-gray-700 hover:bg-gray-800":"border-gray-300 hover:bg-green-50 hover:border-green-300"}`,children:[e.jsx("span",{className:"mr-1",children:"üí¨"}),e.jsx("span",{className:"hidden sm:inline",children:"WhatsApp"})]})}),e.jsx(v.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(_,{onClick:()=>gt(o.customer_phone),variant:"outline",className:`w-full h-10 md:h-12 rounded-xl font-semibold text-xs ${d?"border-gray-700 hover:bg-gray-800":"border-gray-300 hover:bg-blue-50 hover:border-blue-300"}`,children:[e.jsx(rt,{className:"w-3 md:w-4 h-3 md:h-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Ligar"})]})}),e.jsx(v.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(_,{onClick:()=>P(!0),variant:"outline",className:`w-full h-10 md:h-12 rounded-xl font-semibold text-xs ${d?"border-gray-700 hover:bg-gray-800":"border-gray-300 hover:bg-orange-50 hover:border-orange-300"}`,children:[e.jsx(te,{className:"w-3 md:w-4 h-3 md:h-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Reportar"})]})})]}),o.status==="going_to_store"?e.jsxs("div",{className:"space-y-3",children:[e.jsxs(v.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},className:`${d?"bg-blue-900/30 border-blue-700":"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-300"} border-2 rounded-2xl p-4`,children:[e.jsxs("p",{className:`text-sm font-bold ${d?"text-blue-400":"text-blue-900"} mb-2 flex items-center gap-2`,children:[e.jsx(B,{className:"w-4 h-4"}),"Indo ao Restaurante"]}),e.jsx("p",{className:`text-xs ${d?"text-gray-300":"text-gray-600"}`,children:'Clique em "Cheguei" quando voc√™ estiver no restaurante para solicitar o c√≥digo de coleta.'})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 md:gap-3",children:[e.jsx(v.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(_,{onClick:async()=>{const w=prompt(`Motivo do cancelamento:

1 - Restaurante fechado
2 - Pedido cancelado
3 - Outro motivo

Digite o n√∫mero ou descreva:`);if(!w)return;const k={1:"Restaurante fechado",2:"Pedido cancelado"}[w]||w;await $.entities.Order.update(o.id,{...o,status:"cancelled",rejection_reason:`Cancelado pelo entregador: ${k}`}),y._isVirtual||await $.entities.Entregador.update(y.id,{...y,status:"available",current_order_id:null}),R.invalidateQueries({queryKey:["deliveryOrders"]}),R.invalidateQueries({queryKey:["gestorOrders"]})},variant:"outline",className:`w-full h-10 md:h-12 rounded-xl font-semibold text-xs md:text-sm border-2 ${d?"border-red-700 text-red-400 hover:bg-red-900/30":"border-red-500 text-red-600 hover:bg-red-50"}`,children:[e.jsx(V,{className:"w-3 md:w-4 h-3 md:h-4 mr-1 md:mr-2"}),"Cancelar"]})}),e.jsx(v.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(_,{onClick:async()=>{await $.entities.Order.update(o.id,{...o,status:"arrived_at_store"}),R.invalidateQueries({queryKey:["deliveryOrders"]}),R.invalidateQueries({queryKey:["gestorOrders"]})},className:"w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white h-10 md:h-12 text-xs md:text-base font-bold rounded-xl shadow-lg shadow-blue-500/30",children:[e.jsx(J,{className:"w-4 md:w-5 h-4 md:h-5 mr-1 md:mr-2"}),"Cheguei ao Restaurante"]})})]})]}):o.status==="arrived_at_store"?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs md:text-sm font-bold mb-2 ${d?"text-gray-300":"text-gray-700"} uppercase tracking-wide`,children:"C√≥digo de Retirada do Restaurante"}),e.jsx(Ue,{placeholder:"Digite o c√≥digo do restaurante",value:r[o.id]||"",onChange:w=>l(T=>({...T,[o.id]:w.target.value})),maxLength:4,className:`text-center text-2xl md:text-3xl font-bold tracking-[0.3em] md:tracking-[0.5em] h-14 md:h-16 rounded-2xl ${d?"bg-gray-700 border-gray-600 text-white":"bg-gradient-to-r from-gray-50 to-white border-2 border-gray-300 text-gray-900"} focus:ring-4 focus:ring-blue-500/30`}),e.jsx("p",{className:`text-[10px] md:text-xs mt-2 text-center ${d?"text-gray-400":"text-gray-500"} font-medium`,children:"O restaurante fornecer√° este c√≥digo para liberar o pedido"})]}),e.jsx(v.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(_,{onClick:async()=>{const w=r[o.id]||"";if(!w){alert("Digite o c√≥digo fornecido pelo restaurante");return}if(w!==o.pickup_code){alert("C√≥digo inv√°lido! Verifique com o restaurante.");return}await $.entities.Order.update(o.id,{...o,status:"picked_up",picked_up_at:new Date().toISOString()}),R.invalidateQueries({queryKey:["deliveryOrders"]}),R.invalidateQueries({queryKey:["gestorOrders"]}),l(T=>{const k={...T};return delete k[o.id],k})},disabled:!r[o.id]||r[o.id].length!==4,className:"w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white h-10 md:h-12 text-xs md:text-base font-bold rounded-xl shadow-lg shadow-green-500/30",children:[e.jsx(U,{className:"w-4 md:w-5 h-4 md:h-5 mr-1 md:mr-2"}),"Confirmar Coleta"]})})]}):o.status==="picked_up"?e.jsxs("div",{className:"space-y-3",children:[e.jsxs(v.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},className:`${d?"bg-green-900/30 border-green-700":"bg-gradient-to-r from-green-50 to-emerald-50 border-green-300"} border-2 rounded-2xl p-4`,children:[e.jsxs("p",{className:`text-sm font-bold ${d?"text-green-400":"text-green-900"} mb-2 flex items-center gap-2`,children:[e.jsx(J,{className:"w-4 h-4"}),"Pedido Coletado com Sucesso!"]}),e.jsx("p",{className:`text-xs ${d?"text-gray-300":"text-gray-600"}`,children:'Clique em "Sair para Entrega" quando estiver pronto para ir at√© o cliente.'})]}),e.jsx(v.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(_,{onClick:async()=>{await $.entities.Order.update(o.id,{...o,status:"out_for_delivery"}),R.invalidateQueries({queryKey:["deliveryOrders"]}),R.invalidateQueries({queryKey:["gestorOrders"]})},className:"w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white h-12 md:h-14 text-base font-bold rounded-xl shadow-lg shadow-blue-500/30",children:[e.jsx(ie,{className:"w-5 h-5 mr-2"}),"Sair para Entrega"]})})]}):o.status==="out_for_delivery"?e.jsxs("div",{className:"space-y-3",children:[e.jsxs(v.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},className:`${d?"bg-blue-900/30 border-blue-700":"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-300"} border-2 rounded-2xl p-4`,children:[e.jsxs("p",{className:`text-sm font-bold ${d?"text-blue-400":"text-blue-900"} mb-2 flex items-center gap-2`,children:[e.jsx(ie,{className:"w-4 h-4"}),"A Caminho do Cliente"]}),e.jsx("p",{className:`text-xs ${d?"text-gray-300":"text-gray-600"}`,children:'Clique em "Cheguei" quando estiver no local de entrega para solicitar o c√≥digo do cliente.'})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 md:gap-3",children:[e.jsx(v.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(_,{onClick:async()=>{const w=prompt(`Motivo do cancelamento:

1 - Endere√ßo n√£o encontrado
2 - Cliente n√£o atende
3 - Outro motivo

Digite o n√∫mero ou descreva:`);if(!w)return;const k={1:"Endere√ßo n√£o encontrado",2:"Cliente n√£o atende"}[w]||w;await $.entities.Order.update(o.id,{...o,status:"cancelled",rejection_reason:`Cancelado pelo entregador: ${k}`}),y._isVirtual||await $.entities.Entregador.update(y.id,{...y,status:"available",current_order_id:null}),R.invalidateQueries({queryKey:["deliveryOrders"]}),R.invalidateQueries({queryKey:["gestorOrders"]})},variant:"outline",className:`w-full h-10 md:h-12 rounded-xl font-semibold text-xs md:text-sm border-2 ${d?"border-red-700 text-red-400 hover:bg-red-900/30":"border-red-500 text-red-600 hover:bg-red-50"}`,children:[e.jsx(V,{className:"w-3 md:w-4 h-3 md:h-4 mr-1 md:mr-2"}),"Cancelar"]})}),e.jsx(v.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(_,{onClick:async()=>{await $.entities.Order.update(o.id,{...o,status:"arrived_at_customer"}),R.invalidateQueries({queryKey:["deliveryOrders"]}),R.invalidateQueries({queryKey:["gestorOrders"]})},className:"w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white h-10 md:h-12 text-xs md:text-base font-bold rounded-xl shadow-lg shadow-blue-500/30",children:[e.jsx(J,{className:"w-4 md:w-5 h-4 md:h-5 mr-1 md:mr-2"}),"Cheguei no Local"]})})]})]}):o.status==="arrived_at_customer"?e.jsxs("div",{className:"space-y-3 md:space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs md:text-sm font-bold mb-2 md:mb-3 ${d?"text-gray-300":"text-gray-700"} uppercase tracking-wide`,children:"C√≥digo de Valida√ß√£o do Cliente"}),e.jsx(v.div,{whileFocus:{scale:1.02},children:e.jsx(Ue,{placeholder:"Digite os 4 d√≠gitos",value:s[o.id]||"",onChange:w=>t(T=>({...T,[o.id]:w.target.value})),maxLength:4,className:`text-center text-2xl md:text-3xl font-bold tracking-[0.3em] md:tracking-[0.5em] h-14 md:h-16 rounded-2xl ${d?"bg-gray-700 border-gray-600 text-white":"bg-gradient-to-r from-gray-50 to-white border-2 border-gray-300 text-gray-900"} focus:ring-4 focus:ring-blue-500/30`})}),e.jsx("p",{className:`text-[10px] md:text-xs mt-2 text-center ${d?"text-gray-400":"text-gray-500"} font-medium px-2`,children:"O cliente ir√° fornecer este c√≥digo ao receber o pedido"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 md:gap-3",children:[e.jsx(v.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(_,{onClick:async()=>{const w=prompt(`Motivo do cancelamento:

1 - Endere√ßo n√£o encontrado
2 - Cliente n√£o atende
3 - Outro motivo

Digite o n√∫mero ou descreva:`);if(!w)return;const k={1:"Endere√ßo n√£o encontrado",2:"Cliente n√£o atende"}[w]||w;await $.entities.Order.update(o.id,{...o,status:"cancelled",rejection_reason:`Cancelado pelo entregador: ${k}`}),y._isVirtual||await $.entities.Entregador.update(y.id,{...y,status:"available",current_order_id:null}),R.invalidateQueries({queryKey:["deliveryOrders"]}),R.invalidateQueries({queryKey:["gestorOrders"]})},variant:"outline",className:`w-full h-10 md:h-12 rounded-xl font-semibold text-xs md:text-sm border-2 ${d?"border-red-700 text-red-400 hover:bg-red-900/30":"border-red-500 text-red-600 hover:bg-red-50"}`,children:[e.jsx(V,{className:"w-3 md:w-4 h-3 md:h-4 mr-1 md:mr-2"}),"Cancelar"]})}),e.jsx(v.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(_,{onClick:()=>ot(o),disabled:!s[o.id]||s[o.id].length!==4,className:"w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white h-10 md:h-14 text-xs md:text-base font-bold rounded-xl shadow-lg shadow-green-500/30",children:[e.jsx(J,{className:"w-4 md:w-5 h-4 md:h-5 mr-1 md:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Confirmar Entrega"}),e.jsx("span",{className:"sm:hidden",children:"Confirmar"})]})})]})]}):null]},o.id))})]}),Ie.length>0&&e.jsxs("div",{className:"max-w-7xl mx-auto px-4 pb-8",children:[e.jsxs("h2",{className:`text-xl font-bold mb-4 ${d?"text-white":"text-gray-900"}`,children:["Entregas Conclu√≠das Hoje (",Ie.length,")"]}),e.jsx("div",{className:"space-y-3",children:Ie.slice(0,5).map((o,w)=>e.jsxs(v.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:w*.05},whileHover:{scale:1.01,x:4},className:`${d?"bg-gradient-to-r from-gray-800 to-gray-900 border-gray-700":"bg-gradient-to-r from-white to-gray-50 border-gray-200"} rounded-2xl p-5 flex items-center justify-between border-2 shadow-md`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-green-500 to-green-600 rounded-2xl flex items-center justify-center shadow-lg",children:e.jsx(J,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("p",{className:`font-bold ${d?"text-white":"text-gray-900"} mb-1`,children:["#",o.order_code," - ",o.customer_name]}),e.jsxs("p",{className:`text-sm ${d?"text-gray-400":"text-gray-500"} flex items-center gap-2`,children:[e.jsx(se,{className:"w-3 h-3"}),new Date(o.delivered_at).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})]})]})]}),e.jsx("div",{className:`px-4 py-2 rounded-xl ${d?"bg-green-900/30":"bg-green-50"} border-2 ${d?"border-green-700":"border-green-200"}`,children:e.jsx("span",{className:"font-bold text-lg text-green-600",children:fe(o.delivery_fee||0)})})]},o.id))})]}),c&&e.jsx(is,{order:c,entregador:y,onClose:()=>u(null),onConfirm:ct,darkMode:d}),g&&e.jsx(os,{order:g,entregador:y,onClose:()=>h(null),darkMode:d}),i&&e.jsx(cs,{onClose:dt,darkMode:d}),b&&F&&e.jsx($t,{user:F,profileRole:"entregador",onClose:()=>f(!1),onUpdate:o=>{setUser(o),y&&setEntregador({...y,...o}),R.invalidateQueries({queryKey:["entregador"]})}}),C&&e.jsx(ds,{entregador:y,onClose:()=>j(!1),onDarkModeChange:L}),p&&y?.id&&e.jsx(ns,{entregadorId:y.id,darkMode:d,isOpen:p,onClose:()=>N(!1)}),ue.orders.pendingOrders.length>0&&e.jsx(gs,{order:ue.orders.pendingOrders[0],onAccept:o=>ue.orders.acceptOrder(o,y.id),onReject:ue.orders.rejectOrder}),le&&e.jsx(Ns,{isOpen:le,onClose:()=>Re(!1),orders:O,currentLocation:D,darkMode:d}),e.jsx(Ss,{isOpen:Pe,onClose:()=>Te(!1),onPause:xt,darkMode:d}),e.jsx(Es,{isOpen:S,onClose:()=>P(!1),order:O[0],entregador:y,darkMode:d})]})}):e.jsx("div",{className:`min-h-screen flex items-center justify-center p-4 ${d?"bg-gray-900":"bg-gray-100"}`,children:e.jsxs("div",{className:`${d?"bg-gray-800":"bg-white"} rounded-2xl shadow-lg p-8 max-w-md text-center`,children:[e.jsx(te,{className:"w-16 h-16 text-amber-500 mx-auto mb-4"}),e.jsx("h2",{className:`text-2xl font-bold mb-2 ${d?"text-white":"text-gray-800"}`,children:"Acesso Negado"}),e.jsx("p",{className:`mb-6 ${d?"text-gray-300":"text-gray-600"}`,children:"Voc√™ n√£o est√° cadastrado como entregador."}),e.jsx(Ke,{to:Be("Cardapio",A||void 0),children:e.jsx(_,{className:"w-full bg-blue-500 hover:bg-blue-600",children:"Ver Card√°pio"})})]})})}export{Sa as default};
