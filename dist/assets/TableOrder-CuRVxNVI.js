import{m as z,k as A,u as I,r as d,j as e,B as f,x as u}from"./main-AonIQAES.js";import{b as m}from"./base44Client-DnnNNlVu.js";import{u as P}from"./useQuery-1B__UZCp.js";import{u as y}from"./useMutation--pPw_T_d.js";import{a as V,D as F,C as G,c as L}from"./useCart-CW5LrpbV.js";import{B as R}from"./bell-VrVpKCOv.js";import{S as $}from"./shopping-cart-Ur_1HrJq.js";import"./badge-VNLW5sw5.js";import"./textarea-DMRLefWJ.js";import"./ticket-DIxUtuYp.js";import"./circle-check-big-BQQ24GbH.js";import"./map-pin-u_JGe0km.js";import"./truck-D6zUN2Zr.js";import"./chef-hat-DUqumxLr.js";import"./clock-C5Rng7N-.js";import"./index-C7_vRD1M.js";import"./proxy-DNI-KLs9.js";import"./minus-BcVwmOP2.js";import"./plus-BWjW9AHH.js";import"./differenceInCalendarDays-DRQCwW68.js";import"./constants-CG7Neo-X.js";import"./trash-2-eTZTaYxL.js";import"./star-4jmeOV9l.js";import"./format-DzdVs_Wz.js";import"./input-BZMCG3xh.js";import"./index-CXHrl_Fq.js";import"./select-BsJPtTd1.js";import"./index-CaNfpB9J.js";import"./index-BQa84rXG.js";import"./index-BBieB--f.js";import"./index-Diz3LxqQ.js";import"./chevron-down-W9Dhjl9M.js";import"./check-CPlY7ZZw.js";import"./dialog-LI6mGNSb.js";import"./search-Sb5SY96K.js";import"./navigation-C5CV02Fx.js";import"./dollar-sign-B5ekxtL2.js";import"./calendar-BWMBrEkL.js";import"./sparkles-BpSaorR-.js";import"./cepService-BFcvLHg_.js";import"./store-DsTxvmXo.js";function Te(){const{tableNumber:r}=z(),[v]=A(),a=v.get("slug")||"";I();const{cart:n,addItem:C,removeItem:N,updateQuantity:_,clearCart:w}=V(a),[p,c]=d.useState("menu"),[i,S]=d.useState(null),[x,h]=d.useState(!1),{data:l,isLoading:k,error:E}=P({queryKey:["publicCardapio",a],queryFn:()=>m.get(`/public/cardapio/${a}`),enabled:!!a}),b=l?.tables??[],q=l?.dishes??[],O=l?.categories??[],B=l?.store??null;d.useEffect(()=>{const t=b.find(s=>String(s.table_number)===String(r));S(t)},[b,r]);const g=y({mutationFn:async()=>a?m.post("/public/chamar-garcom",{slug:a,table_id:i?.id,table_number:r}):m.entities.WaiterCall.create({table_id:i?.id,table_number:r,status:"pending",created_at:new Date().toISOString()}),onSuccess:()=>{u.success("Garçom chamado! Ele chegará em breve."),h(!0),setTimeout(()=>h(!1),3e4)},onError:()=>{u.error("Erro ao chamar garçom")}}),M=y({mutationFn:async t=>a?m.post("/public/pedido-mesa",{slug:a,table_number:r,table_id:i?.id,items:t.items,total:t.total,customer_name:t.customer_name||"",customer_phone:t.customer_phone||"",customer_email:t.customer_email||"",observations:t.observations||""}):m.entities.Order.create({...t,table_id:i?.id,table_number:r,delivery_type:"table",status:"new"}),onSuccess:()=>{u.success("Pedido realizado com sucesso!"),w(),c("menu")},onError:t=>{u.error("Erro ao realizar pedido: "+(t.message||"Erro desconhecido"))}}),T=t=>{const s={...t,items:n.map(o=>({dish_id:o.id,dish:o,quantity:o.quantity,unit_price:o.price,subtotal:o.price*o.quantity})),total:n.reduce((o,j)=>o+j.price*j.quantity,0),table_id:i?.id,table_number:r,tip:t.tip||null};M.mutate(s)},Q=()=>{g.mutate()},W=O.map(t=>({...t,dishes:q.filter(s=>String(s.category_id)===String(t.id)&&s.is_active!==!1)}));return a?k?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"Carregando cardápio..."})}):E?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-600 mb-2",children:"Não foi possível carregar o cardápio."}),e.jsx("p",{className:"text-sm text-gray-500",children:"Verifique se o link está correto ou tente novamente."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold",children:["Mesa ",r]}),i&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Capacidade: ",i.capacity," pessoas",i.location&&` • ${i.location}`]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{variant:x?"default":"outline",onClick:Q,disabled:g.isLoading||x,children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),x?"Garçom Chamado":"Chamar Garçom"]}),n.length>0&&e.jsxs(f,{onClick:()=>c("cart"),children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Carrinho (",n.reduce((t,s)=>t+s.quantity,0),")"]})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[p==="menu"&&e.jsx("div",{className:"space-y-8",children:W.map(t=>t.dishes.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:t.name}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.dishes.map(s=>e.jsx(F,{dish:s,onAddToCart:C},s.id))})]},t.id))}),p==="cart"&&e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsx(G,{isOpen:!0,onClose:()=>c("menu"),cart:n,onRemoveItem:N,onUpdateQuantity:_,onCheckout:()=>c("checkout")})}),p==="checkout"&&e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsx(L,{cart:n,onBack:()=>c("cart"),onSubmit:T,store:B,primaryColor:"#22c55e",isTableOrder:!0,slug:a||void 0})})]})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsxs("h1",{className:"text-xl font-bold text-gray-800 mb-2",children:["Mesa ",r]}),e.jsxs("p",{className:"text-gray-600 mb-4",children:["Acesse este cardápio pelo ",e.jsx("strong",{children:"QR Code da mesa"})," para fazer seu pedido."]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["O link deve conter o identificador do estabelecimento (ex.: .../mesa/",r,"?slug=meu-restaurante)."]})]})})}export{Te as default};
