import{r as u,u as E,j as e,P as d,B as g}from"./main-BRmc9wuQ.js";import{b as i}from"./base44Client-DNwoQjfp.js";import{u as k}from"./useQuery-DECqmSjD.js";import{u as p}from"./useMutation-7mrcm5kq.js";import{B as n}from"./badge-0XfQUglg.js";import{U as C}from"./UserAuthButton-aEHoGetV.js";import{f as j}from"./formatters-CvOEClq0.js";import{T as c}from"./truck-BEX3wnhD.js";import{U as O}from"./user-DROTyYEO.js";import{P}from"./phone-BNGqqYl8.js";import{M as f}from"./map-pin-C1grN2RK.js";import{C as A}from"./circle-check-big-BgD3Vilh.js";import"./alert-dialog-WT2FZKvg.js";import"./index-Us3IJkK4.js";import"./index-DtU2aqBA.js";import"./index-Cj8IEuVO.js";import"./log-in-V4EDTWPP.js";import"./power-CSJOf1Dk.js";function W(){const[t,b]=u.useState(null),N=E();u.useEffect(()=>{o()},[]);const o=async()=>{try{const s=await i.auth.me(),w=(await i.entities.Entregador.list()).find(_=>_.email===s.email);b(w)}catch(s){console.error("Erro ao carregar entregador:",s)}},{data:m=[]}=k({queryKey:["deliveryOrders"],queryFn:async()=>(await i.entities.Order.list("-created_date")).filter(r=>["ready","out_for_delivery"].includes(r.status)),refetchInterval:5e3}),x=p({mutationFn:({id:s,data:r})=>i.entities.Order.update(s,r),onSuccess:()=>{N.invalidateQueries({queryKey:["deliveryOrders"]})}}),h=p({mutationFn:({id:s,data:r})=>i.entities.Entregador.update(s,r),onSuccess:()=>{o()}}),y=s=>{t&&(x.mutate({id:s.id,data:{...s,status:"out_for_delivery",entregador_id:t.id}}),h.mutate({id:t.id,data:{...t,status:"busy",current_order_id:s.id}}))},v=s=>{t&&(x.mutate({id:s.id,data:{...s,status:"delivered",delivered_at:new Date().toISOString()}}),h.mutate({id:t.id,data:{...t,status:"available",current_order_id:null,total_deliveries:(t.total_deliveries||0)+1}}))},a=t?m.find(s=>s.entregador_id===t.id&&s.status==="out_for_delivery"):null,l=m.filter(s=>s.status==="ready");return t?e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[e.jsx("header",{className:"bg-white border-b sticky top-0 z-10",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(c,{className:"w-6 h-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-lg",children:t.name}),e.jsx(n,{className:t.status==="available"?"bg-green-500":"bg-yellow-500",children:t.status==="available"?"Disponível":"Em Entrega"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right hidden sm:block",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Entregas Hoje"}),e.jsx("p",{className:"font-bold text-2xl text-blue-600",children:t.total_deliveries||0})]}),e.jsx(C,{})]})]})})}),e.jsxs("div",{className:"max-w-4xl mx-auto p-4 space-y-6",children:[a&&e.jsxs("section",{children:[e.jsxs("h2",{className:"font-bold text-lg mb-3 flex items-center gap-2",children:[e.jsx(d,{className:"w-5 h-5"}),"Entrega Atual"]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-2xl p-6 shadow-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm opacity-80",children:"Pedido"}),e.jsxs("p",{className:"text-2xl font-bold",children:["#",a.order_code||a.id?.slice(-6)]})]}),e.jsx(n,{className:"bg-white text-blue-600 font-bold",children:j(a.total)})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(O,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.customer_name}),e.jsxs("p",{className:"text-sm opacity-80 flex items-center gap-1",children:[e.jsx(P,{className:"w-3 h-3"}),a.customer_phone]})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(f,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm opacity-80",children:"Endereço"}),e.jsx("p",{className:"font-medium",children:a.address}),a.neighborhood&&e.jsx("p",{className:"text-sm opacity-80",children:a.neighborhood})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm opacity-80 mb-2",children:"Itens do Pedido:"}),a.items?.map((s,r)=>e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 text-sm",children:[s.quantity||1,"x ",s.dish?.name]},r))]}),e.jsxs(g,{onClick:()=>v(a),className:"w-full mt-6 bg-green-500 hover:bg-green-600 text-white font-bold py-6 text-lg",children:[e.jsx(A,{className:"w-5 h-5 mr-2"}),"Confirmar Entrega"]})]})]}),!a&&l.length>0&&e.jsxs("section",{children:[e.jsxs("h2",{className:"font-bold text-lg mb-3 flex items-center gap-2",children:[e.jsx(d,{className:"w-5 h-5"}),"Pedidos Prontos para Entrega"]}),e.jsx("div",{className:"space-y-3",children:l.map(s=>e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-lg",children:["#",s.order_code||s.id?.slice(-6)]}),e.jsx("p",{className:"text-sm text-gray-600",children:s.customer_name})]}),e.jsx(n,{className:"bg-green-100 text-green-700",children:j(s.total)})]}),e.jsxs("div",{className:"flex items-start gap-2 text-sm text-gray-600 mb-3",children:[e.jsx(f,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{children:s.address}),s.neighborhood&&e.jsx("p",{className:"text-xs text-gray-400",children:s.neighborhood})]})]}),e.jsxs(g,{onClick:()=>y(s),className:"w-full bg-blue-600 hover:bg-blue-700",children:[e.jsx(c,{className:"w-4 h-4 mr-2"}),"Aceitar Entrega"]})]},s.id))})]}),!a&&l.length===0&&e.jsxs("div",{className:"text-center py-16",children:[e.jsx(d,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-gray-500",children:"Nenhum pedido disponível no momento"}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Aguardando novos pedidos..."})]})]})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(c,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-gray-600",children:"Carregando dados do entregador..."})]})})}export{W as default};
