import{r as d,u as Ie,P as te,z as q,j as e,X as pe,B,g as re,L as Oe}from"./main-BRmc9wuQ.js";import{B as se}from"./badge-0XfQUglg.js";import{T as De}from"./textarea-BVLzEUED.js";import{u as ze}from"./useQuery-DECqmSjD.js";import{u as qe}from"./useMutation-7mrcm5kq.js";import{B as Me,T as Ne}from"./ticket-U__hmTOt.js";import{C as we}from"./circle-check-big-BgD3Vilh.js";import{M as J}from"./map-pin-C1grN2RK.js";import{T as xe}from"./truck-BEX3wnhD.js";import{C as Ve}from"./chef-hat-BVOq19yV.js";import{C as ke}from"./clock-BVnf5BSk.js";import{A as de}from"./index-POiUmsPA.js";import{m as T}from"./proxy-UArsdzLI.js";import{S as _e}from"./shopping-cart-DFfB9Dsc.js";import{M as Ke}from"./minus-RtCrWvOr.js";import{P as he}from"./plus-DSv6Z-VR.js";import{S as fe}from"./differenceInCalendarDays-m29H_lYP.js";import{T as Pe}from"./trash-2-BCVOf2oN.js";import{S as ce}from"./star-gxnzHQI6.js";import{f as Ge,B as He}from"./format-_TcWQ5qq.js";import{I as R,L as P}from"./input-BSSWZZVM.js";import{S as Ye,a as Je,b as Ue,c as Qe,d as ne}from"./select-VIQuVK7X.js";import{D as ye,a as be,b as je,c as ve,e as We}from"./dialog-DJhUD2H1.js";import{S as Ee}from"./search-BzcCetuR.js";import{N as Xe}from"./navigation-DF2HYaFW.js";import{D as Ze}from"./dollar-sign-Cy_CReDz.js";import{C as et}from"./calendar-C_CZG2Mr.js";import{C as Ae}from"./check-B8wFGgpR.js";import{b as W}from"./base44Client-DNwoQjfp.js";import{S as Fe}from"./sparkles-Dl4xu82C.js";import{b as tt}from"./cepService-BFcvLHg_.js";import{S as st}from"./store-DD9u3xYC.js";const le={new:{label:"Novo",color:"bg-blue-500",icon:ke},accepted:{label:"Aceito",color:"bg-green-500",icon:te},preparing:{label:"Preparando",color:"bg-yellow-500",icon:Ve},ready:{label:"Pronto",color:"bg-purple-500",icon:we},going_to_store:{label:"Entregador indo ao Restaurante",color:"bg-blue-400",icon:xe},arrived_at_store:{label:"Entregador no Restaurante",color:"bg-blue-500",icon:te},picked_up:{label:"Pedido Coletado",color:"bg-green-500",icon:te},out_for_delivery:{label:"Saiu para Entrega",color:"bg-indigo-500",icon:xe},arrived_at_customer:{label:"Entregador Chegou",color:"bg-green-500",icon:J},delivered:{label:"Entregue",color:"bg-green-600",icon:we},cancelled:{label:"Cancelado",color:"bg-red-500",icon:Me}};function Yt({isOpen:a,onClose:m,cart:u,onUpdateQuantity:r,onRemoveItem:j,onCheckout:p,onEditItem:w,onEditPizza:f,darkMode:o=!1,primaryColor:l="#f97316",store:N=null,onReviewBonus:b=null}){const[_,k]=d.useState("cart"),[y,D]=d.useState(null),[n,c]=d.useState(0),[i,t]=d.useState(0),[x,C]=d.useState(""),I=d.useRef([]),O=Ie(),L=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s||0),K=u.reduce((s,v)=>s+v.totalPrice*(v.quantity||1),0),{data:F=[],isLoading:V}=ze({queryKey:["customerOrdersInCart"],queryFn:async()=>{try{const s=await re.auth.me();if(!s||!s.email)return console.log("âŒ UsuÃ¡rio nÃ£o autenticado ou sem email"),[];console.log("ðŸ” Buscando pedidos para:",s.email);const v=await re.entities.Order.list("-created_date");console.log("ðŸ“¦ Total de pedidos no sistema:",v.length);const S=new Date;S.setHours(S.getHours()-5);const $=v.filter(h=>{const A=h.customer_email===s.email||h.created_by===s.email,z=s.phone&&h.customer_phone&&h.customer_phone.replace(/\D/g,"")===s.phone.replace(/\D/g,""),U=A||z,H=h.status!=="delivered"&&h.status!=="cancelled",X=h.status==="delivered"&&h.delivered_at&&new Date(h.delivered_at)>S&&!h.restaurant_rating;return U&&(H||X)});return console.log("âœ… Pedidos do cliente encontrados:",$.length),$.length>0&&console.log("ðŸ“‹ IDs dos pedidos:",$.map(h=>`#${h.order_code} (${h.status})`).join(", ")),$}catch(s){return console.error("âŒ Erro ao buscar pedidos:",s),[]}},enabled:a,refetchInterval:2e3,refetchOnWindowFocus:!0,refetchOnMount:!0});d.useEffect(()=>{if(!a||V||F.length===0)return;const s=I.current,v=F.filter(h=>h.status==="delivered"&&!h.restaurant_rating),S=s.filter(h=>h.status==="delivered"&&!h.restaurant_rating),$=v.find(h=>!S.find(A=>A.id===h.id));$&&!y&&setTimeout(()=>{D($)},1e3),s.length>0&&F.forEach(h=>{const A=s.find(z=>z.id===h.id);if(A&&A.status!==h.status){const z=le[h.status],U=z?.icon||ke;if(console.log(`ðŸ”” Status atualizado: Pedido #${h.order_code} â†’ ${z?.label||h.status}`),q.success(e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:"Status atualizado!"}),e.jsxs("p",{className:"text-sm",children:["Pedido #",h.order_code,": ",z?.label||h.status]})]})]}),{duration:4e3,position:"top-center",style:{background:"#fff",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"}}),["ready","out_for_delivery","arrived_at_customer","delivered"].includes(h.status))try{const H=new Audio("/notification.mp3");H.volume=.5,H.play().catch(()=>{})}catch{}}}),I.current=F},[F,V,a,y]);const G=qe({mutationFn:async({orderId:s,ratings:v})=>{const S=F.find($=>$.id===s);if(S.entregador_id&&v.deliveryRating>0)try{await re.entities.DeliveryRating.create({order_id:s,entregador_id:S.entregador_id,rating:v.deliveryRating,comment:v.comment,rated_by:"customer"})}catch($){console.log("Erro ao criar avaliaÃ§Ã£o do entregador:",$)}await re.entities.Order.update(s,{...S,restaurant_rating:v.restaurantRating,rating_comment:v.comment})},onSuccess:async()=>{if(O.invalidateQueries({queryKey:["customerOrdersInCart"]}),O.invalidateQueries({queryKey:["myOrders"]}),O.invalidateQueries({queryKey:["customerOrders"]}),D(null),c(0),t(0),C(""),b)try{const s=await b();s&&s.success?q.success(s.message,{duration:5e3}):q.success("AvaliaÃ§Ã£o enviada! Obrigado pelo feedback.")}catch(s){console.error("Erro ao aplicar bÃ´nus de avaliaÃ§Ã£o:",s),q.success("AvaliaÃ§Ã£o enviada! Obrigado pelo feedback.")}else q.success("AvaliaÃ§Ã£o enviada! Obrigado pelo feedback.")},onError:s=>{console.error("Erro ao enviar avaliaÃ§Ã£o:",s),q.error("Erro ao enviar avaliaÃ§Ã£o. Tente novamente.")}}),M=()=>{if(n===0){q.error("Por favor, avalie o restaurante");return}G.mutate({orderId:y.id,ratings:{restaurantRating:n,deliveryRating:y.delivery_method==="delivery"?i:0,comment:x}})};return a?e.jsxs(de,{children:[e.jsx(T.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center md:items-stretch md:justify-end justify-center p-4 md:p-0",onClick:m,children:e.jsxs(T.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"tween",duration:.3},onClick:s=>s.stopPropagation(),className:`${o?"bg-gray-800":"bg-white"} md:rounded-none rounded-2xl shadow-2xl w-full md:w-[400px] max-w-lg md:max-w-none h-auto md:h-full max-h-[85vh] md:max-h-none overflow-hidden flex flex-col`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",style:{borderColor:o?"#374151":"#e5e7eb"},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"w-5 h-5",style:{color:l}}),e.jsx("h2",{className:`text-lg font-bold ${o?"text-white":"text-gray-900"}`,children:"Carrinho"})]}),e.jsx("button",{onClick:m,className:`p-2 rounded-lg ${o?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:e.jsx(pe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex border-b",style:{borderColor:o?"#374151":"#e5e7eb"},children:[e.jsxs("button",{onClick:()=>k("cart"),className:`flex-1 py-3 px-4 text-sm font-medium transition-colors ${_==="cart"?o?"text-white border-b-2":"text-gray-900 border-b-2":o?"text-gray-400 hover:text-gray-300":"text-gray-500 hover:text-gray-700"}`,style:_==="cart"?{borderBottomColor:l}:{},children:["Carrinho ",u.length>0&&`(${u.length})`]}),e.jsxs("button",{onClick:()=>k("orders"),className:`flex-1 py-3 px-4 text-sm font-medium transition-colors relative ${_==="orders"?o?"text-white border-b-2":"text-gray-900 border-b-2":o?"text-gray-400 hover:text-gray-300":"text-gray-500 hover:text-gray-700"}`,style:_==="orders"?{borderBottomColor:l}:{},children:[e.jsxs("span",{className:"flex items-center justify-center gap-2",children:["Meus Pedidos",_==="orders"&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 bg-red-500 text-white text-[10px] font-bold rounded uppercase",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),"Live"]})]}),F.length>0&&e.jsx("span",{className:`absolute top-1 right-2 w-5 h-5 ${le[F[0]?.status]?.color||"bg-red-500"} text-white text-xs rounded-full flex items-center justify-center font-bold animate-pulse`,children:F.length})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:_==="cart"?u.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(_e,{className:"w-16 h-16 mx-auto mb-4 opacity-30",style:{color:o?"#6b7280":"#9ca3af"}}),e.jsx("p",{className:o?"text-gray-400":"text-gray-500",children:"Carrinho vazio"})]}):u.map(s=>e.jsxs("div",{className:`flex gap-3 p-3 rounded-xl ${o?"bg-gray-700/50":"bg-gray-50"}`,children:[e.jsx("div",{className:"w-16 h-16 flex-shrink-0 rounded-lg overflow-hidden bg-gray-200",children:s.dish?.image?e.jsx("img",{src:s.dish.image,alt:s.dish.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400 text-xs",children:"Sem foto"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`font-medium text-sm ${o?"text-white":"text-gray-900"}`,children:s.dish?.name}),s.selections&&Object.keys(s.selections).length>0&&e.jsx("p",{className:`text-xs mt-1 ${o?"text-gray-400":"text-gray-500"} line-clamp-2`,children:Object.values(s.selections).map(v=>Array.isArray(v)?v.map(S=>S.name).join(", "):v.name).filter(Boolean).join(" â€¢ ")}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"font-bold text-sm",style:{color:l},children:L(s.totalPrice)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>r(s.id,-1),className:`w-7 h-7 rounded-lg flex items-center justify-center ${o?"bg-gray-600 hover:bg-gray-500":"bg-gray-200 hover:bg-gray-300"}`,children:e.jsx(Ke,{className:"w-3 h-3"})}),e.jsx("span",{className:`text-sm font-medium w-6 text-center ${o?"text-white":"text-gray-900"}`,children:s.quantity||1}),e.jsx("button",{onClick:()=>r(s.id,1),className:`w-7 h-7 rounded-lg flex items-center justify-center ${o?"bg-gray-600 hover:bg-gray-500":"bg-gray-200 hover:bg-gray-300"}`,children:e.jsx(he,{className:"w-3 h-3"})})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("button",{onClick:()=>{s.dish?.product_type==="pizza"&&f?f(s):w(s)},className:`p-1 ${o?"text-blue-400 hover:text-blue-300":"text-blue-500 hover:text-blue-700"}`,title:"Editar",children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>j(s.id),className:"text-red-500 hover:text-red-700 p-1",title:"Remover",children:e.jsx(Pe,{className:"w-4 h-4"})})]})]},s.id)):V?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 mx-auto mb-4",style:{borderColor:l}}),e.jsx("p",{className:o?"text-gray-400":"text-gray-500",children:"Carregando pedidos..."})]}):F.length===0?e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx(te,{className:"w-16 h-16 mx-auto mb-4 opacity-30",style:{color:o?"#6b7280":"#9ca3af"}}),e.jsx("p",{className:`font-semibold mb-2 ${o?"text-gray-300":"text-gray-700"}`,children:"Nenhum pedido ativo"}),e.jsx("p",{className:`text-sm mb-4 ${o?"text-gray-400":"text-gray-500"}`,children:"Seus pedidos em andamento aparecerÃ£o aqui com atualizaÃ§Ã£o em tempo real"}),e.jsx("div",{className:`text-xs p-3 rounded-lg ${o?"bg-gray-700/50 text-gray-400":"bg-blue-50 text-blue-600"}`,children:"ðŸ’¡ FaÃ§a um pedido e acompanhe o status em tempo real!"})]}):F.map(s=>{const v=le[s.status]||le.new,S=v.icon;return e.jsxs("div",{className:`rounded-xl p-4 border ${o?"bg-gray-700/50 border-gray-600":"bg-gray-50 border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:`font-bold text-sm ${o?"text-white":"text-gray-900"}`,children:["Pedido #",s.order_code||s.id?.slice(-6)]}),s.created_date&&e.jsx("p",{className:`text-xs ${o?"text-gray-400":"text-gray-500"}`,children:Ge(new Date(s.created_date),"dd/MM/yyyy HH:mm")})]}),e.jsxs(se,{className:`${v.color} text-white flex items-center gap-1`,children:[e.jsx(S,{className:"w-3 h-3"}),v.label]})]}),s.items&&s.items.length>0&&e.jsx("div",{className:"space-y-2 mb-3",children:s.items.map(($,h)=>e.jsxs("div",{className:`text-xs border-l-2 pl-2 ${o?"border-gray-600":"border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium ${o?"text-gray-400":"text-gray-500"}`,children:[$.quantity||1,"x"]}),e.jsx("span",{className:`font-semibold flex-1 ${o?"text-white":"text-gray-900"}`,children:$.dish?.name}),e.jsx("span",{className:`font-medium ${o?"text-gray-300":"text-gray-700"}`,children:L($.totalPrice*($.quantity||1))})]}),$.selections&&Object.keys($.selections).length>0&&e.jsx("div",{className:`ml-5 mt-1 space-y-0.5 ${o?"text-gray-500":"text-gray-600"}`,children:Object.entries($.selections).map(([A,z])=>Array.isArray(z)?z.map((U,H)=>e.jsxs("p",{children:["â€¢ ",U.name]},H)):z?e.jsxs("p",{children:["â€¢ ",z.name]},A):null)})]},h))}),e.jsxs("div",{className:`flex items-center justify-between pt-3 border-t ${o?"border-gray-600":"border-gray-200"}`,children:[e.jsx("span",{className:`text-sm ${o?"text-gray-300":"text-gray-600"}`,children:"Total"}),e.jsx("span",{className:"font-bold text-base",style:{color:l},children:L(s.total)})]}),s.delivery_method==="delivery"&&s.address&&e.jsxs("div",{className:`mt-2 text-xs flex items-start gap-1 ${o?"text-gray-400":"text-gray-500"}`,children:[e.jsx(xe,{className:"w-3 h-3 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"line-clamp-1",children:s.address})]}),s.status==="arrived_at_customer"&&s.delivery_code&&e.jsxs("div",{className:`mt-3 rounded-lg p-3 text-center border-2 ${o?"bg-yellow-900/20 border-yellow-600":"bg-yellow-100 border-yellow-400"}`,children:[e.jsx("p",{className:`text-xs font-medium mb-1 ${o?"text-yellow-300":"text-yellow-800"}`,children:"CÃ³digo de ValidaÃ§Ã£o"}),e.jsx("p",{className:`text-2xl font-bold tracking-widest ${o?"text-yellow-200":"text-yellow-900"}`,children:s.delivery_code}),e.jsx("p",{className:`text-xs mt-1 ${o?"text-yellow-300":"text-yellow-700"}`,children:"ForneÃ§a ao entregador"})]}),s.status==="delivered"&&!s.restaurant_rating&&e.jsx("div",{className:"mt-3 pt-3 border-t",style:{borderColor:o?"#4b5563":"#e5e7eb"},children:e.jsxs("button",{onClick:()=>D(s),className:"w-full py-2 px-4 rounded-lg text-sm font-medium flex items-center justify-center gap-2 transition-colors",style:{backgroundColor:l,color:"white"},children:[e.jsx(ce,{className:"w-4 h-4 fill-current"}),"Avaliar Pedido"]})}),s.status==="delivered"&&s.restaurant_rating&&e.jsxs("div",{className:`mt-3 pt-3 border-t flex items-center justify-center gap-1 ${o?"border-gray-600":"border-gray-200"}`,children:[e.jsx(ce,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"}),e.jsxs("span",{className:`text-sm font-medium ${o?"text-gray-300":"text-gray-700"}`,children:["Avaliado: ",s.restaurant_rating,"/5"]})]})]},s.id)})}),_==="cart"&&u.length>0&&e.jsxs("div",{className:`border-t p-4 space-y-3 ${o?"border-gray-700":"border-gray-200"}`,children:[N?.free_delivery_min_value&&K>0&&K<N.free_delivery_min_value&&e.jsxs("div",{className:`p-3 rounded-lg ${o?"bg-blue-900/30 border border-blue-700":"bg-blue-50 border border-blue-200"}`,children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsxs("span",{className:`font-medium ${o?"text-blue-300":"text-blue-700"}`,children:["Frete grÃ¡tis acima de ",L(N.free_delivery_min_value)]}),e.jsxs("span",{className:`font-bold ${o?"text-blue-200":"text-blue-800"}`,children:["Faltam ",L(N.free_delivery_min_value-K)]})]}),e.jsx("div",{className:`h-2 rounded-full overflow-hidden ${o?"bg-blue-800":"bg-blue-200"}`,children:e.jsx("div",{className:`h-full transition-all duration-500 ${o?"bg-gradient-to-r from-blue-500 to-blue-400":"bg-gradient-to-r from-blue-500 to-green-500"}`,style:{width:`${Math.min(K/N.free_delivery_min_value*100,100)}%`}})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`font-medium ${o?"text-gray-300":"text-gray-600"}`,children:"Subtotal"}),e.jsx("span",{className:"text-xl font-bold",style:{color:l},children:L(K)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(B,{onClick:m,variant:"outline",className:"flex-1",children:"Continuar"}),e.jsx(B,{onClick:p,className:"flex-1 text-white",style:{backgroundColor:l},children:"Finalizar Pedido"})]})]})]})}),y&&e.jsx(T.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 z-[60] flex items-center justify-center p-4",onClick:()=>D(null),children:e.jsxs(T.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:s=>s.stopPropagation(),className:`rounded-2xl p-6 max-w-md w-full shadow-2xl ${o?"bg-gray-800":"bg-white"}`,children:[e.jsx("h3",{className:`text-xl font-bold mb-2 ${o?"text-white":"text-gray-900"}`,children:"Avalie sua experiÃªncia"}),e.jsxs("p",{className:`text-sm mb-4 ${o?"text-gray-400":"text-gray-600"}`,children:["Pedido #",y.order_code||y.id?.slice(-6)]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("label",{className:`font-medium ${o?"text-gray-300":"text-gray-700"}`,children:"Restaurante *"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(s=>e.jsx("button",{onClick:()=>c(s),className:"text-3xl transition-transform hover:scale-110",children:s<=n?"â­":"â˜†"},s))})]}),y.delivery_method==="delivery"&&e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("label",{className:`font-medium ${o?"text-gray-300":"text-gray-700"}`,children:"Entregador (opcional)"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(s=>e.jsx("button",{onClick:()=>t(s),className:"text-3xl transition-transform hover:scale-110",children:s<=i?"â­":"â˜†"},s))})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("label",{className:`font-medium ${o?"text-gray-300":"text-gray-700"}`,children:"ComentÃ¡rio (opcional)"}),e.jsx(De,{value:x,onChange:s=>C(s.target.value),placeholder:"Conte-nos sobre sua experiÃªncia...",className:`w-full p-3 border rounded-lg resize-none ${o?"bg-gray-700 border-gray-600 text-white placeholder:text-gray-400":"bg-white border-gray-300"}`,rows:3})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(B,{onClick:()=>D(null),variant:"outline",className:"flex-1",children:"Cancelar"}),e.jsx(B,{onClick:M,disabled:n===0||G.isPending,className:"flex-1 text-white",style:{backgroundColor:n===0||G.isPending?"#d1d5db":l},children:G.isPending?"Enviando...":"Enviar"})]})]})})]}):null}function at({center:a,onPositionChange:m,className:u="",style:r={}}){d.useRef(null);const j=d.useRef(null),p=d.useRef(null),[w,f]=d.useState(null);return d.useEffect(()=>{},[""]),d.useEffect(()=>{if(!j.current||!p.current||!a)return;const l={lat:a.lat,lng:a.lng};j.current.panTo(l),p.current.setPosition(l)},[a?.lat,a?.lng]),e.jsxs("div",{className:`flex flex-col items-center justify-center bg-gray-100 rounded-lg ${u}`,style:{minHeight:300,...r},children:[e.jsx(J,{className:"w-12 h-12 text-gray-400 mb-2"}),e.jsx("p",{className:"text-gray-500 text-sm text-center px-4",children:"Configure VITE_GOOGLE_MAPS_API_KEY no .env para exibir o mapa."})]})}function rt({isOpen:a,onClose:m,onConfirm:u,initialAddress:r=""}){const[j,p]=d.useState({lat:-15.7942,lng:-47.8822}),[w,f]=d.useState(""),[o,l]=d.useState(r),[N,b]=d.useState(!1),[_,k]=d.useState(!1),[y,D]=d.useState([]),[n,c]=d.useState(!1),[i,t]=d.useState(""),[x,C]=d.useState(!1),I=d.useRef(null),O=d.useRef(null);d.useEffect(()=>{r&&a&&(l(r),F(r))},[a,r]);const L=async s=>{if(!s.trim()||s.length<3){D([]),c(!1);return}try{const S=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(s+", Brasil")}&limit=5&countrycodes=br`)).json();S&&S.length>0?(D(S),c(!0)):(D([]),c(!1))}catch(v){console.error("Erro ao buscar sugestÃµes:",v),D([]),c(!1)}};d.useEffect(()=>(I.current&&clearTimeout(I.current),o&&o.length>=3?I.current=setTimeout(()=>{L(o)},300):(D([]),c(!1)),()=>{I.current&&clearTimeout(I.current)}),[o]);const K=async s=>{const v={lat:parseFloat(s.lat),lng:parseFloat(s.lon)};p(v),f(s.display_name),l(s.display_name),c(!1),D([]),setTimeout(()=>{V(v.lat,v.lng)},200)},F=async(s=o)=>{if(s.trim()){b(!0),c(!1);try{const S=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(s+", Brasil")}&limit=1&countrycodes=br`)).json();if(S&&S.length>0){const $=S[0],h={lat:parseFloat($.lat),lng:parseFloat($.lon)};p(h),f($.display_name),l($.display_name),setTimeout(()=>{V(h.lat,h.lng)},300)}}catch(v){console.error("Erro ao buscar endereÃ§o:",v)}finally{b(!1)}}},V=async(s,v)=>{k(!0);try{const $=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${s}&lon=${v}`)).json();if($&&$.address){const h=$.address,A=$.display_name;return f(A),{street:h.road||"",number:h.house_number||"",neighborhood:h.suburb||h.neighbourhood||h.city_district||"",city:h.city||h.town||h.municipality||"",state:h.state||"",fullAddress:A}}}catch(S){console.error("Erro ao buscar endereÃ§o:",S)}finally{k(!1)}return null};d.useEffect(()=>{if(!j||!a)return;const s=setTimeout(()=>{V(j.lat,j.lng)},500);return()=>clearTimeout(s)},[j,a]);const G=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(s=>{p({lat:s.coords.latitude,lng:s.coords.longitude})},s=>{alert("NÃ£o foi possÃ­vel obter sua localizaÃ§Ã£o")}):alert("GeolocalizaÃ§Ã£o nÃ£o suportada pelo navegador")},M=async()=>{const s=await V(j.lat,j.lng),v={latitude:j.lat,longitude:j.lng,addressData:s?{...s,cep:i}:{cep:i},cep:i};u(v)};return e.jsx(ye,{open:a,onOpenChange:s=>!s&&m(),children:e.jsxs(be,{className:"max-w-4xl h-[90vh] p-0",onPointerDownOutside:s=>s.preventDefault(),onInteractOutside:s=>s.preventDefault(),children:[e.jsx(je,{className:"p-2 border-b",children:e.jsxs(ve,{className:"flex items-center gap-2 text-base",children:[e.jsx(J,{className:"w-4 h-4 text-orange-500"}),"Selecione sua LocalizaÃ§Ã£o"]})}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-3 border-b space-y-2 relative",children:[e.jsxs("div",{className:"flex gap-2 relative",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(R,{ref:O,placeholder:"Digite seu endereÃ§o ou arraste o marcador no mapa",value:o,onChange:s=>l(s.target.value),onKeyDown:s=>{s.key==="Enter"?(s.preventDefault(),F(),c(!1)):s.key==="Escape"?c(!1):s.key==="ArrowDown"&&y.length>0&&(s.preventDefault(),c(!0))},onFocus:()=>{y.length>0&&c(!0)},onBlur:s=>{setTimeout(()=>{s.relatedTarget?.closest(".suggestions-dropdown")||c(!1)},200)},className:"flex-1 pr-8"}),o&&e.jsx("button",{onClick:()=>{l(""),D([]),c(!1),O.current?.focus()},className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsx(de,{children:n&&y.length>0&&e.jsx(T.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"suggestions-dropdown absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-xl z-[9999] max-h-60 overflow-y-auto",onMouseDown:s=>s.preventDefault(),children:y.map((s,v)=>e.jsx("button",{onClick:S=>{S.preventDefault(),S.stopPropagation(),K(s)},className:"w-full text-left p-3 hover:bg-orange-50 active:bg-orange-100 border-b border-gray-100 last:border-b-0 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(J,{className:"w-4 h-4 text-orange-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:s.display_name.split(",")[0]}),e.jsx("p",{className:"text-xs text-gray-500 line-clamp-1",children:s.display_name})]})]})},v))})})]}),e.jsx(B,{onClick:()=>F(),disabled:N||!o.trim(),className:"bg-orange-500 hover:bg-orange-600",children:e.jsx(Ee,{className:"w-4 h-4"})})]}),e.jsxs(B,{onClick:G,variant:"outline",className:"w-full h-8",size:"sm",children:[e.jsx(Xe,{className:"w-3 h-3 mr-2"}),"Usar Minha LocalizaÃ§Ã£o Atual"]})]}),e.jsxs("div",{className:"flex-1 relative min-h-[400px] max-h-[500px] overflow-hidden",children:[e.jsx(at,{center:j,onPositionChange:(s,v)=>p({lat:s,lng:v}),className:"absolute inset-0",style:{height:"100%",width:"100%",zIndex:1}}),w&&e.jsx("div",{className:"absolute top-2 left-2 right-2 z-[1000] bg-white/95 backdrop-blur-sm rounded-lg shadow-lg p-2 border-2 border-orange-200",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(J,{className:"w-4 h-4 text-orange-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-bold text-gray-900",children:"EndereÃ§o:"}),e.jsx("p",{className:"text-xs text-gray-700 line-clamp-2",children:w}),_&&e.jsx("p",{className:"text-xs text-orange-600 mt-0.5 animate-pulse",children:"Atualizando..."})]})]})}),e.jsx("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 z-[1000] bg-blue-500 text-white px-3 py-1.5 rounded-full shadow-lg text-xs font-medium",children:"ðŸ‘† Clique no mapa ou arraste o marcador"})]}),e.jsx("div",{className:"p-3 border-t bg-white space-y-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(B,{onClick:m,variant:"outline",className:"flex-1",children:"Cancelar"}),e.jsx(B,{onClick:M,disabled:!j||_,className:"flex-1 bg-orange-500 hover:bg-orange-600",children:_?"Processando...":"Confirmar LocalizaÃ§Ã£o"})]})})]})]})})}function nt({isOpen:a,onClose:m,onConfirm:u,onEdit:r,cart:j=[],customer:p={},cartTotal:w=0,discount:f=0,deliveryFee:o=0,total:l=0,appliedCoupon:N=null,scheduledDate:b=null,scheduledTime:_=null,primaryColor:k="#f97316"}){const y=i=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(i||0),D=i=>{const t=[];if(i.rice&&t.push(`ðŸš ${i.rice.name||i.rice}`),i.bean&&t.push(`ðŸ«˜ ${i.bean.name||i.bean}`),i.garnish)if(Array.isArray(i.garnish)){const x=i.garnish.map(C=>C.name||C).join(", ");x&&t.push(`ðŸ¥— ${x}`)}else typeof i.garnish=="object"&&i.garnish.name&&t.push(`ðŸ¥— ${i.garnish.name}`);if(i.salad&&t.push(`ðŸ¥¬ ${i.salad.name||i.salad}`),i.drink&&t.push(`ðŸ¥¤ ${i.drink.name||i.drink}`),i.size&&t.push(`ðŸ“ ${i.size.name||i.size}`),i.flavors&&Array.isArray(i.flavors)){const x=i.flavors.map(C=>C.name||C).join(" + ");x&&t.push(`ðŸ• ${x}`)}if(i.edge&&t.push(`ðŸ§€ Borda: ${i.edge.name||i.edge}`),i.extras&&Array.isArray(i.extras)&&i.extras.length>0){const x=i.extras.map(C=>C.name||C).join(", ");x&&t.push(`âž• ${x}`)}if(i.complements&&Array.isArray(i.complements)){const x=i.complements.map(C=>C.name||C).join(", ");x&&t.push(x)}return i.selections&&typeof i.selections=="object"&&Object.entries(i.selections).forEach(([x,C])=>{if(C)if(Array.isArray(C)){const I=C.map(O=>O.name||O).filter(Boolean).join(", ");I&&t.push(I)}else typeof C=="object"&&C.name?t.push(C.name):typeof C=="string"&&t.push(C)}),i.specifications&&t.push(`ðŸ“ ${i.specifications}`),i.observations&&t.push(`ðŸ“ ${i.observations}`),t.length>0?t.join(" â€¢ "):null},n=()=>p.deliveryMethod==="pickup"?"Retirada na loja":[p.address_street,p.address_number,p.complement&&`(${p.complement})`,p.neighborhood].filter(Boolean).join(", ")||"EndereÃ§o nÃ£o informado",c=()=>({dinheiro:"ðŸ’µ Dinheiro",pix:"ðŸ’³ PIX",cartao_credito:"ðŸ’³ CartÃ£o de CrÃ©dito",cartao_debito:"ðŸ’³ CartÃ£o de DÃ©bito"})[p.paymentMethod]||p.paymentMethod||"NÃ£o informado";return e.jsx(ye,{open:a,onOpenChange:m,children:e.jsxs(be,{className:"sm:max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsx(je,{children:e.jsxs(ve,{className:"flex items-center gap-2 text-xl",children:[e.jsx(te,{className:"w-5 h-5",style:{color:k}}),"Confirmar Pedido"]})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm text-gray-700 mb-2",children:"Itens do Pedido"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:j.map((i,t)=>{const x=D(i);return e.jsxs("div",{className:"flex items-start justify-between text-sm bg-gray-50 p-2 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-medium text-gray-900",children:[i.quantity,"x ",i.dish?.name||i.name]}),x&&e.jsx("p",{className:"text-xs text-gray-500 mt-1 leading-relaxed",children:x})]}),e.jsx("p",{className:"font-medium text-gray-900 ml-2 flex-shrink-0",children:y((i.totalPrice||i.price||0)*(i.quantity||1))})]},t)})})]}),e.jsxs("div",{className:"space-y-3 pt-2 border-t",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(J,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Entrega"})]}),e.jsx("p",{className:"text-sm text-gray-900",children:n()}),p.deliveryMethod==="delivery"&&p.customer_phone&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["ðŸ“ž ",p.customer_phone]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ze,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Pagamento"})]}),e.jsx("p",{className:"text-sm text-gray-900",children:c()}),p.paymentMethod==="dinheiro"&&p.needs_change&&p.change_amount&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Troco para: ",y(p.change_amount)]})]}),b&&_&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(et,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Agendamento"})]}),e.jsxs("p",{className:"text-sm text-gray-900",children:[new Date(b).toLocaleDateString("pt-BR")," Ã s ",_]})]}),N&&e.jsx("div",{children:e.jsxs(se,{className:"bg-green-100 text-green-700 text-xs",children:["Cupom: ",N.code," (-",N.discount_type==="percentage"?`${N.discount_value}%`:y(N.discount_value),")"]})})]}),e.jsxs("div",{className:"pt-3 border-t space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal"}),e.jsx("span",{className:"font-medium",children:y(w)})]}),f>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Desconto"}),e.jsxs("span",{className:"font-medium",children:["-",y(f)]})]}),o>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Taxa de entrega"}),e.jsx("span",{className:"font-medium",children:y(o)})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold pt-2 border-t",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{style:{color:k},children:y(l)})]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4 border-t",children:[e.jsxs(B,{variant:"outline",onClick:r,className:"flex-1",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"Editar"]}),e.jsxs(B,{onClick:u,className:"flex-1 text-white font-bold",style:{backgroundColor:k},children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Confirmar Pedido"]})]})]})})}const Ce="saved_addresses";function lt({customer:a,setCustomer:m,darkMode:u=!1}){const[r,j]=d.useState([]),[p,w]=d.useState(!1),[f,o]=d.useState(null),[l,N]=d.useState({name:"",street:"",number:"",complement:"",neighborhood:"",reference:""});d.useEffect(()=>{try{const n=localStorage.getItem(Ce);n&&j(JSON.parse(n))}catch(n){console.error("Erro ao carregar endereÃ§os salvos:",n)}},[]);const b=n=>{try{localStorage.setItem(Ce,JSON.stringify(n)),j(n)}catch(c){console.error("Erro ao salvar endereÃ§os:",c)}},_=()=>{if(!l.name||!l.street||!l.neighborhood){q.error("Preencha pelo menos: nome, rua e bairro");return}const n={id:f?.id||Date.now().toString(),name:l.name,street:l.street,number:l.number||"",complement:l.complement||"",neighborhood:l.neighborhood,reference:l.reference||"",createdAt:f?.createdAt||new Date().toISOString()};let c;f?(c=r.map(i=>i.id===f.id?n:i),q.success("EndereÃ§o atualizado!")):(c=[...r,n],q.success("EndereÃ§o salvo!")),b(c),w(!1),o(null),N({name:"",street:"",number:"",complement:"",neighborhood:"",reference:""})},k=n=>{if(!confirm("Deseja realmente excluir este endereÃ§o?"))return;const c=r.filter(i=>i.id!==n);b(c),q.success("EndereÃ§o excluÃ­do!")},y=n=>{m({...a,address_street:n.street,address_number:n.number,address_complement:n.complement,neighborhood:n.neighborhood,address:`${n.street}${n.number?`, ${n.number}`:""}${n.complement?` - ${n.complement}`:""}, ${n.neighborhood}`}),q.success(`EndereÃ§o "${n.name}" selecionado!`)},D=n=>{o(n),N({name:n.name||"",street:n.street||"",number:n.number||"",complement:n.complement||"",neighborhood:n.neighborhood||"",reference:n.reference||""}),w(!0)};return r.length===0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(P,{className:"text-sm font-medium",children:"EndereÃ§os Salvos"}),e.jsxs(B,{variant:"outline",size:"sm",onClick:()=>w(!0),className:"h-7 text-xs",children:[e.jsx(he,{className:"w-3 h-3 mr-1"}),"Salvar Atual"]})]}),a.address_street&&a.neighborhood&&e.jsx("p",{className:"text-xs text-gray-500",children:"VocÃª pode salvar este endereÃ§o para usar novamente"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(P,{className:"text-sm font-medium",children:"EndereÃ§os Salvos"}),e.jsxs(B,{variant:"outline",size:"sm",onClick:()=>{o(null),N({name:a.address_street?"EndereÃ§o Principal":"Novo EndereÃ§o",street:a.address_street||"",number:a.address_number||"",complement:a.address_complement||"",neighborhood:a.neighborhood||"",reference:""}),w(!0)},className:"h-7 text-xs",children:[e.jsx(he,{className:"w-3 h-3 mr-1"}),"Novo"]})]}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:e.jsx(de,{children:r.map(n=>e.jsx(T.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,x:-20},className:`p-3 rounded-lg border-2 transition-all cursor-pointer hover:border-blue-400 ${a.address_street===n.street&&a.neighborhood===n.neighborhood?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800"}`,onClick:()=>y(n),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(J,{className:"w-4 h-4 text-blue-500 flex-shrink-0"}),e.jsx("span",{className:"font-semibold text-sm text-gray-900 dark:text-white",children:n.name}),a.address_street===n.street&&a.neighborhood===n.neighborhood&&e.jsxs(se,{className:"bg-blue-500 text-white text-xs h-4 px-1",children:[e.jsx(Ae,{className:"w-2 h-2 mr-1"}),"Atual"]})]}),e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-300",children:[n.street,n.number&&`, ${n.number}`,n.complement&&` - ${n.complement}`]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:n.neighborhood})]}),e.jsxs("div",{className:"flex gap-1 ml-2",onClick:c=>c.stopPropagation(),children:[e.jsx(B,{variant:"ghost",size:"icon",onClick:()=>D(n),className:"h-7 w-7",children:e.jsx(fe,{className:"w-3 h-3"})}),e.jsx(B,{variant:"ghost",size:"icon",onClick:()=>k(n.id),className:"h-7 w-7 text-red-600 hover:text-red-700",children:e.jsx(Pe,{className:"w-3 h-3"})})]})]})},n.id))})}),e.jsx(ye,{open:p,onOpenChange:w,children:e.jsxs(be,{className:"sm:max-w-md",children:[e.jsx(je,{children:e.jsx(ve,{children:f?"Editar EndereÃ§o":"Salvar EndereÃ§o"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Nome do EndereÃ§o"}),e.jsx(R,{placeholder:"Ex: Casa, Trabalho",value:l.name,onChange:n=>N({...l,name:n.target.value})})]}),e.jsxs("div",{children:[e.jsx(P,{children:"Rua/Avenida *"}),e.jsx(R,{placeholder:"Rua, Avenida...",value:l.street,onChange:n=>N({...l,street:n.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx(P,{children:"NÃºmero"}),e.jsx(R,{placeholder:"123",value:l.number,onChange:n=>N({...l,number:n.target.value})})]}),e.jsxs("div",{children:[e.jsx(P,{children:"Bairro *"}),e.jsx(R,{placeholder:"Bairro",value:l.neighborhood,onChange:n=>N({...l,neighborhood:n.target.value}),required:!0})]})]}),e.jsxs("div",{children:[e.jsx(P,{children:"Complemento"}),e.jsx(R,{placeholder:"Apto, Bloco...",value:l.complement,onChange:n=>N({...l,complement:n.target.value})})]}),e.jsxs("div",{children:[e.jsx(P,{children:"Ponto de ReferÃªncia"}),e.jsx(R,{placeholder:"PrÃ³ximo a...",value:l.reference,onChange:n=>N({...l,reference:n.target.value})})]})]}),e.jsxs(We,{children:[e.jsx(B,{variant:"outline",onClick:()=>{w(!1),o(null)},children:"Cancelar"}),e.jsx(B,{onClick:_,children:f?"Atualizar":"Salvar"})]})]})})]})}const Se="loyalty_points",ge={bronze:{name:"Bronze",minPoints:0,discount:0,color:"#CD7F32",icon:"ðŸ¥‰"},silver:{name:"Prata",minPoints:100,discount:5,color:"#C0C0C0",icon:"ðŸ¥ˆ"},gold:{name:"Ouro",minPoints:500,discount:10,color:"#FFD700",icon:"ðŸ¥‡"},platinum:{name:"Platina",minPoints:1e3,discount:15,color:"#E5E4E2",icon:"ðŸ’Ž"}};function ie(a){const m=Object.entries(ge).reverse();for(const[u,r]of m)if(a>=r.minPoints)return{key:u,...r};return{key:"bronze",...ge.bronze}}function ot(a){const m=ie(a),r=Object.values(ge).sort((j,p)=>j.minPoints-p.minPoints).find(j=>j.minPoints>m.minPoints);return r?r.minPoints-a:null}function Re(a,m,u){const[r,j]=d.useState({points:0,totalSpent:0,tier:"bronze",bonusPoints:0,lastOrderDate:null,birthday:null,referralCode:null,referredBy:null,consecutiveDays:0,firstReviewDate:null,lastBirthdayBonus:null,lastConsecutiveBonusAt:0}),[p,w]=d.useState(!0);d.useEffect(()=>{(async()=>{if(!a&&!m){w(!1);return}try{try{const t=await W.entities.Loyalty?.filter({customer_phone:a||"",customer_email:m||"",subscriber_slug:u||""});if(t&&t.length>0){const x=t[0];j({points:x.points||0,totalSpent:x.total_spent||0,tier:x.tier||"bronze",bonusPoints:x.bonus_points||0,lastOrderDate:x.last_order_date,birthday:x.birthday,referralCode:x.referral_code,referredBy:x.referred_by,consecutiveDays:x.consecutive_days||0,firstReviewDate:x.first_review_date,lastBirthdayBonus:x.last_birthday_bonus,lastConsecutiveBonusAt:x.last_consecutive_bonus_at??0}),w(!1);return}}catch{console.log("Loyalty entity nÃ£o encontrada, usando localStorage")}const c=`${Se}_${u||"default"}_${a||m||"guest"}`,i=localStorage.getItem(c);i&&j(JSON.parse(i))}catch(c){console.error("Erro ao carregar dados de fidelidade:",c)}finally{w(!1)}})()},[a,m,u]);const f=d.useCallback(async n=>{const c={...r,...n};j(c);try{if(a||m)try{const t=await W.entities.Loyalty?.filter({customer_phone:a||"",customer_email:m||"",subscriber_slug:u||""}),x={customer_phone:a||"",customer_email:m||"",subscriber_slug:u||"",points:c.points,total_spent:c.totalSpent,tier:c.tier,bonus_points:c.bonusPoints,last_order_date:c.lastOrderDate,birthday:c.birthday,referral_code:c.referralCode,referred_by:c.referredBy,consecutive_days:c.consecutiveDays||0,first_review_date:c.firstReviewDate,last_birthday_bonus:c.lastBirthdayBonus,last_consecutive_bonus_at:c.lastConsecutiveBonusAt??0};t&&t.length>0?await W.entities.Loyalty?.update(t[0].id,x):await W.entities.Loyalty?.create(x)}catch(t){console.log("Erro ao salvar no backend, usando localStorage:",t)}const i=`${Se}_${u||"default"}_${a||m||"guest"}`;localStorage.setItem(i,JSON.stringify(c))}catch(i){console.error("Erro ao salvar dados de fidelidade:",i)}},[r,a,m,u]),o=d.useCallback(async(n,c="compra")=>{const i=r.points+n,t=r.totalSpent+(c==="compra"?n:0),x=ie(i),C={points:i,totalSpent:t,tier:x.key,lastOrderDate:new Date().toISOString()};if(c==="compra"){const I=new Date,O=r.lastOrderDate?new Date(r.lastOrderDate):null,L=O?Math.floor((I-O)/(1e3*60*60*24)):null;L===null||L===0||L===1?C.consecutiveDays=(r.consecutiveDays||0)+1:C.consecutiveDays=1}return await f(C),{points:i,tier:x}},[r,f]),l=d.useCallback(async(n,c)=>{await f({bonusPoints:r.bonusPoints+n,points:r.points+n})},[r,f]),N=d.useCallback(()=>ie(r.points).discount,[r.points]),b=d.useCallback(async()=>{if(r.referralCode)return r.referralCode;const n=`${(a||m||"USER").slice(-4).toUpperCase()}${Math.floor(Math.random()*1e3)}`;return await f({referralCode:n}),n},[r.referralCode,a,m,f]),_=d.useCallback(async n=>{try{const c=await W.entities.Loyalty?.filter({referral_code:n,subscriber_slug:u||""});if(c&&c.length>0){const i=c[0];return await W.entities.Loyalty?.update(i.id,{...i,points:(i.points||0)+100,bonus_points:(i.bonus_points||0)+100}),await o(100,"indicacao"),{success:!0,message:"CÃ³digo de referÃªncia aplicado! +100 pontos para vocÃª e para quem indicou!"}}return{success:!1,message:"CÃ³digo de referÃªncia invÃ¡lido"}}catch(c){return console.error("Erro ao aplicar cÃ³digo de referÃªncia:",c),{success:!1,message:"Erro ao aplicar cÃ³digo"}}},[u,o]),k=d.useCallback(async()=>{if(!r.birthday)return;const n=new Date,c=new Date(r.birthday),i=r.lastBirthdayBonus?new Date(r.lastBirthdayBonus):null;return c.getMonth()===n.getMonth()&&c.getDate()===n.getDate()&&(!i||i.getFullYear()<n.getFullYear())?(await l(100,"aniversario"),await f({lastBirthdayBonus:n.toISOString()}),{success:!0,message:"ðŸŽ‰ ParabÃ©ns! VocÃª ganhou 100 pontos de bÃ´nus de aniversÃ¡rio!"}):{success:!1}},[r.birthday,r.lastBirthdayBonus,l,f]),y=d.useCallback(async()=>(await l(20,"avaliacao"),{success:!0,message:"Obrigado pela avaliaÃ§Ã£o! VocÃª ganhou 20 pontos!"}),[l]),D=d.useCallback(async()=>{const n=r.consecutiveDays||0,c=r.lastConsecutiveBonusAt??0;return n>=7&&c<7?(await l(30,"consecutivo_7"),await f({lastConsecutiveBonusAt:7}),{success:!0,message:"ðŸŽ‰ 7 pedidos seguidos! VocÃª ganhou 30 pontos de bÃ´nus!"}):n>=3&&c<3?(await l(15,"consecutivo_3"),await f({lastConsecutiveBonusAt:3}),{success:!0,message:"ðŸ”¥ 3 pedidos seguidos! VocÃª ganhou 15 pontos de bÃ´nus!"}):{success:!1}},[r.consecutiveDays,r.lastConsecutiveBonusAt,l,f]);return{loyaltyData:r,loading:p,addPoints:o,addBonus:l,getDiscount:N,generateReferralCode:b,applyReferralCode:_,checkBirthdayBonus:k,applyReviewBonus:y,checkConsecutiveOrdersBonus:D,currentTier:ie(r.points),pointsToNext:ot(r.points)}}function it({customerPhone:a,customerEmail:m,slug:u,orderTotal:r=0,primaryColor:j="#f97316"}){const{loyaltyData:p,currentTier:w,loading:f}=Re(a,m,u);if(f||!a&&!m)return null;const o=Math.floor(r),l=w.discount,N=r*(l/100);return e.jsxs(T.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 rounded-lg border border-orange-200 dark:border-orange-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5",style:{color:j}}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:[p.points.toLocaleString("pt-BR")," pontos"]}),e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:["NÃ­vel ",w.name," â€¢ ",l,"% OFF"]})]})]}),e.jsxs(se,{style:{backgroundColor:w.color,color:"white",border:"none"},children:[w.icon," ",w.name]})]}),l>0&&r>0&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),e.jsxs("span",{className:"text-sm font-semibold text-green-700 dark:text-green-300",children:["Desconto de ",l,"% aplicado"]})]}),e.jsxs("span",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:["-",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(N)]})]}),o>0&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),e.jsx("span",{className:"text-sm font-semibold text-blue-700 dark:text-blue-300",children:"VocÃª vai ganhar"})]}),e.jsxs("span",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:["+",o," pontos"]})]})]})}function ct(a,m,u,r){const p=oe(u-a),w=oe(r-m),f=Math.sin(p/2)*Math.sin(p/2)+Math.cos(oe(a))*Math.cos(oe(u))*Math.sin(w/2)*Math.sin(w/2);return 6371*(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)))}function oe(a){return a*(Math.PI/180)}function dt(a,m){const{baseFee:u=0,pricePerKm:r=0,minFee:j=0,maxFee:p=null,freeDeliveryDistance:w=null}=m;if(w&&a<=w)return 0;let f=u+a*r;return f<j&&(f=j),p!==null&&f>p&&(f=p),Math.round(f*100)/100}const mt={generateOrderCode(){const a="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let m="";for(let u=0;u<6;u++)m+=a.charAt(Math.floor(Math.random()*a.length));return m},calculateDeliveryFee(a,m,u,r=null,j=null,p=null){if(a!=="delivery")return 0;if(r?.delivery_fee_mode==="distance"&&j&&p&&r.latitude&&r.longitude){const f=ct(r.latitude,r.longitude,j,p),o={baseFee:r.delivery_base_fee||0,pricePerKm:r.delivery_price_per_km||0,minFee:r.delivery_min_fee||0,maxFee:r.delivery_max_fee||null,freeDeliveryDistance:r.delivery_free_distance||null};return dt(f,o)}if(!m)return r?.delivery_fee||0;const w=u?.find(f=>f.neighborhood?.toLowerCase().trim()===m.toLowerCase().trim()&&f.is_active);return w?w.fee:r?.delivery_fee||0},formatFullAddress(a){if(a.deliveryMethod!=="delivery")return"";let m=`${a.address_street}, ${a.address_number}`;return a.address_complement&&(m+=` - ${a.address_complement}`),m+=` - ${a.neighborhood}`,m},calculateTotals(a,m,u){return{subtotal:a,discount:m,deliveryFee:u,total:a-m+u}},async createOrder(a,m){return await m.mutateAsync(a)},async updateCouponUsage(a,m){a&&await m.mutateAsync({id:a.id,data:{...a,current_uses:(a.current_uses||0)+1}})}},ut={name:"",phone:"",deliveryMethod:"pickup",address_street:"",address_number:"",address_complement:"",address:"",paymentMethod:"",neighborhood:"",cep:"",city:"",state:"",latitude:null,longitude:null,scheduled_date:"",scheduled_time:"",needs_change:!1,change_amount:null};function Jt({cart:a,customer:m,setCustomer:u,onBack:r,onSendWhatsApp:j,onSubmit:p,onGeneratePDF:w,couponCode:f="",setCouponCode:o=()=>{},appliedCoupon:l=null,couponError:N="",onApplyCoupon:b=()=>{},onRemoveCoupon:_=()=>{},deliveryZones:k=[],store:y,primaryColor:D="#f97316",isTableOrder:n=!1,userEmail:c=null,slug:i=null}){const t=m??ut,x=u??(()=>{}),[C,I]=d.useState(!1),[O,L]=d.useState(!1),[K,F]=d.useState(!1),[V,G]=d.useState(!1),[M,s]=d.useState("none"),[v,S]=d.useState(""),$=g=>{const E=g.replace(/\D/g,"");return E.length<=10?E.replace(/(\d{2})(\d{4})(\d{0,4})/,"($1) $2-$3"):E.replace(/(\d{2})(\d{5})(\d{0,4})/,"($1) $2-$3")},h=g=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(g||0),A=a.reduce((g,E)=>g+E.totalPrice*(E.quantity||1),0),z=()=>l?l.discount_type==="percentage"?A*l.discount_value/100:Math.min(l.discount_value,A):0,U=()=>t.deliveryMethod!=="delivery"?0:mt.calculateDeliveryFee(t.deliveryMethod,t.neighborhood,k,y,t.latitude,t.longitude),{getDiscount:H}=Re(t.phone?.replace(/\D/g,""),c,i),X=z(),Le=H(),me=A*(Le/100),ue=X+me,Z=U(),ee=n&&M!=="none"?M==="percent"?A*(parseFloat(v||0)/100):parseFloat(v||0):0,Q=A-ue+Z+ee,ae=()=>!(!(t.name&&t.phone&&t.paymentMethod&&(t.deliveryMethod==="pickup"||t.deliveryMethod==="delivery"&&t.address_street&&t.address_number&&t.neighborhood))||C&&(!t.scheduled_date||!t.scheduled_time)||t.paymentMethod==="dinheiro"&&t.needs_change&&(!t.change_amount||t.change_amount<=Q));return e.jsx(de,{children:e.jsxs(T.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center md:items-stretch md:justify-end justify-center p-4 md:p-0",onClick:r,children:[e.jsxs(T.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"tween",duration:.3},onClick:g=>g.stopPropagation(),className:"bg-white md:rounded-none rounded-2xl shadow-2xl w-full md:w-[400px] max-w-lg md:max-w-none h-auto md:h-full max-h-[85vh] md:max-h-none overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Finalizar Pedido"})}),e.jsx("button",{onClick:r,className:"p-2 rounded-lg hover:bg-gray-100",children:e.jsx(pe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.jsxs("section",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsx("h2",{className:"font-bold text-sm mb-3",children:"Dados do Cliente"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"name",className:"text-xs text-gray-600",children:"Nome do Cliente"}),e.jsx(R,{id:"name",placeholder:"Digite seu nome",value:t.name,onChange:g=>x({...t,name:g.target.value}),className:"mt-1 h-10"})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"phone",className:"text-xs text-gray-600",children:"Telefone / WhatsApp"}),e.jsx(R,{id:"phone",placeholder:"(00) 00000-0000",value:t.phone,onChange:g=>x({...t,phone:$(g.target.value)}),className:"mt-1 h-10",maxLength:15})]})]})]}),e.jsxs("section",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsx("h2",{className:"font-bold text-sm mb-3",children:"Forma de Recebimento"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>x({...t,deliveryMethod:"pickup"}),className:`flex flex-col items-center justify-center gap-1.5 p-3 rounded-lg border-2 transition-all ${t.deliveryMethod==="pickup"?"border-green-500 bg-green-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx(st,{className:"w-5 h-5",style:{color:t.deliveryMethod==="pickup"?"#22c55e":"#9ca3af"}}),e.jsx("span",{className:`font-medium text-xs ${t.deliveryMethod==="pickup"?"text-green-700":"text-gray-600"}`,children:"Retirada"})]}),e.jsxs("button",{onClick:()=>x({...t,deliveryMethod:"delivery"}),className:`flex flex-col items-center justify-center gap-1.5 p-3 rounded-lg border-2 transition-all ${t.deliveryMethod==="delivery"?"border-green-500 bg-green-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx(He,{className:"w-5 h-5",style:{color:t.deliveryMethod==="delivery"?"#22c55e":"#9ca3af"}}),e.jsx("span",{className:`font-medium text-xs ${t.deliveryMethod==="delivery"?"text-green-700":"text-gray-600"}`,children:"Entrega"})]})]}),t.deliveryMethod==="delivery"&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx(lt,{customer:t,setCustomer:x,darkMode:!1}),e.jsxs(B,{type:"button",onClick:()=>L(!0),variant:"outline",className:"w-full mb-2 border-2 border-orange-200 hover:border-orange-300 hover:bg-orange-50",children:[e.jsx(J,{className:"w-4 h-4 mr-2 text-orange-500"}),t.latitude?"Alterar LocalizaÃ§Ã£o no Mapa":"Selecionar LocalizaÃ§Ã£o no Mapa"]}),t.latitude&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-2 mb-2",children:e.jsxs("p",{className:"text-xs text-green-700 font-medium flex items-center gap-1",children:[e.jsx(J,{className:"w-3 h-3"}),"âœ“ LocalizaÃ§Ã£o GPS confirmada"]})}),e.jsxs("div",{children:[e.jsxs(P,{htmlFor:"cep",className:"text-xs text-gray-600 flex items-center gap-1",children:["CEP *",e.jsx("span",{className:"text-[10px] text-gray-400",children:"(Digite para preencher automaticamente)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ee,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(R,{id:"cep",placeholder:"00000-000",value:t.cep||"",onChange:g=>{const E=g.target.value.replace(/\D/g,""),Y=E.length<=8?E.replace(/(\d{5})(\d)/,"$1-$2"):t.cep||"";x({...t,cep:Y})},onBlur:async()=>{const g=(t.cep||"").replace(/\D/g,"");if(g.length===8){G(!0);try{const E=await tt(g);x({...t,cep:E.cep||t.cep,address_street:E.logradouro||t.address_street||"",neighborhood:E.bairro||t.neighborhood||"",city:E.cidade||t.city||"",state:E.estado||t.state||""}),q.success("EndereÃ§o preenchido automaticamente!")}catch(E){console.error("Erro ao buscar CEP:",E),q.error("CEP nÃ£o encontrado. Preencha o endereÃ§o manualmente.")}finally{G(!1)}}},maxLength:9,className:"mt-1 h-10 pl-9 pr-8",disabled:V,required:!0}),V&&e.jsx(Oe,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 animate-spin text-orange-500"})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"address_street",className:"text-xs text-gray-600",children:"Rua/Avenida *"}),e.jsx(R,{id:"address_street",placeholder:"Ex: Rua das Flores",value:t.address_street||"",onChange:g=>x({...t,address_street:g.target.value}),className:"mt-1 h-10",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"address_number",className:"text-xs text-gray-600",children:"NÃºmero *"}),e.jsx(R,{id:"address_number",placeholder:"123",value:t.address_number||"",onChange:g=>x({...t,address_number:g.target.value}),className:"mt-1 h-10",required:!0})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"address_complement",className:"text-xs text-gray-600",children:"Complemento"}),e.jsx(R,{id:"address_complement",placeholder:"Apto 101",value:t.address_complement||"",onChange:g=>x({...t,address_complement:g.target.value}),className:"mt-1 h-10"})]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"neighborhood",className:"text-xs text-gray-600",children:"Bairro *"}),e.jsx(R,{id:"neighborhood",placeholder:"Digite o bairro",value:t.neighborhood,onChange:g=>x({...t,neighborhood:g.target.value}),className:"mt-1 h-10",required:!0}),t.neighborhood&&(()=>{if(y?.delivery_fee_mode==="distance"&&t.latitude&&t.longitude){const g=U();if(g>0)return e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:["âœ“ Taxa de entrega calculada por distÃ¢ncia: ",h(g)]})}else if(k.length>0){const g=k.find(E=>E.neighborhood?.toLowerCase().trim()===t.neighborhood.toLowerCase().trim()&&E.is_active);if(g)return e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:["âœ“ Taxa de entrega: ",h(g.fee)]});if(t.neighborhood.length>2)return e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"âš ï¸ Bairro nÃ£o cadastrado. Confirmaremos a taxa via WhatsApp."})}return null})()]})]})]}),e.jsxs("section",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsx("h2",{className:"font-bold text-sm mb-3",children:"Forma de Pagamento"}),e.jsxs(Ye,{value:t.paymentMethod,onValueChange:g=>x({...t,paymentMethod:g,needs_change:!1,change_amount:""}),children:[e.jsx(Je,{className:"h-10",children:e.jsx(Ue,{placeholder:"Selecione a forma de pagamento"})}),e.jsxs(Qe,{children:[e.jsx(ne,{value:"pix",children:"PIX"}),e.jsx(ne,{value:"dinheiro",children:"Dinheiro"}),e.jsx(ne,{value:"cartao_credito",children:"CartÃ£o de CrÃ©dito"}),e.jsx(ne,{value:"cartao_debito",children:"CartÃ£o de DÃ©bito"})]})]}),t.paymentMethod==="dinheiro"&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"needs_change",checked:t.needs_change||!1,onChange:g=>x({...t,needs_change:g.target.checked,change_amount:g.target.checked?t.change_amount:""}),className:"w-4 h-4"}),e.jsx(P,{htmlFor:"needs_change",className:"text-sm cursor-pointer",children:"Preciso de troco"})]}),t.needs_change&&e.jsxs("div",{children:[e.jsx(P,{htmlFor:"change_amount",className:"text-xs text-gray-600",children:"Troco para quanto?"}),e.jsx(R,{id:"change_amount",type:"number",step:"0.01",placeholder:"Ex: 50.00",value:t.change_amount||"",onChange:g=>x({...t,change_amount:g.target.value}),className:"mt-1 h-10"}),t.change_amount&&parseFloat(t.change_amount)>Q&&e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:["Troco: ",h(parseFloat(t.change_amount)-Q)]})]})]})]}),e.jsxs("section",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"font-bold text-sm",children:"Agendamento"}),e.jsx("button",{type:"button",onClick:()=>I(!C),className:`px-3 py-1 rounded-full text-xs font-medium transition-colors ${C?"bg-green-100 text-green-700":"bg-gray-200 text-gray-600"}`,children:C?"âœ“ Ativo":"Agendar"})]}),C&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"scheduled_date",className:"text-xs text-gray-600",children:"Data"}),e.jsx(R,{id:"scheduled_date",type:"date",value:t.scheduled_date||"",onChange:g=>x({...t,scheduled_date:g.target.value}),className:"mt-1 h-10",min:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"scheduled_time",className:"text-xs text-gray-600",children:"HorÃ¡rio"}),e.jsx(R,{id:"scheduled_time",type:"time",value:t.scheduled_time||"",onChange:g=>x({...t,scheduled_time:g.target.value}),className:"mt-1 h-10",min:y.opening_time||"08:00",max:y.closing_time||"22:00"}),y.opening_time&&y.closing_time&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["HorÃ¡rio de funcionamento: ",y.opening_time," - ",y.closing_time]})]})]})]}),e.jsxs("section",{className:"bg-amber-50/70 rounded-xl p-4 border border-amber-200/60",children:[e.jsx(P,{htmlFor:"customer_change_request",className:"text-xs font-medium text-amber-800 flex items-center gap-1",children:"âœï¸ Solicitar alteraÃ§Ã£o ou adicional (opcional)"}),e.jsx("p",{className:"text-[10px] text-amber-700/90 mb-1.5",children:'Ex.: "Trocar arroz por batata", "Adicionar queijo extra". O restaurante pode aceitar ou reprovar.'}),e.jsx(De,{id:"customer_change_request",placeholder:"Descreva a alteraÃ§Ã£o ou o adicional desejado...",value:t.customer_change_request||"",onChange:g=>x({...t,customer_change_request:g.target.value}),className:"mt-1 min-h-[72px] text-sm resize-none border-amber-200 bg-white",maxLength:500})]}),l&&e.jsx("div",{className:"bg-green-50 rounded-xl p-3 border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs font-medium text-green-700",children:[e.jsx(Ne,{className:"w-3 h-3 inline mr-1"}),l.code," aplicado!"]}),e.jsx("button",{onClick:_,className:"text-xs text-red-600 hover:text-red-700 font-medium",children:"Remover"})]})}),!l&&e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsxs(P,{className:"text-xs text-gray-600 flex items-center gap-1 mb-2",children:[e.jsx(Ne,{className:"w-3 h-3"}),"Cupom de Desconto"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(R,{placeholder:"DIGITE O CÃ“DIGO",value:f,onChange:g=>o(g.target.value.toUpperCase()),className:"flex-1 h-10"}),e.jsx(B,{onClick:b,variant:"outline",size:"sm",children:"Aplicar"})]}),N&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:N})]}),(t.phone||c)&&e.jsx("div",{className:"mt-4",children:e.jsx(it,{customerPhone:t.phone?.replace(/\D/g,""),customerEmail:c,slug:i,orderTotal:A,primaryColor:D})}),n&&e.jsxs("section",{className:"bg-purple-50 rounded-xl p-4 border border-purple-200",children:[e.jsx("h2",{className:"font-bold text-sm mb-3",children:"ðŸ’µ Gorjeta (Opcional)"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{s("none"),S("")},className:`px-3 py-2 rounded-lg text-sm font-medium transition ${M==="none"?"bg-gray-200 text-gray-700":"bg-white text-gray-600 hover:bg-gray-100"}`,children:"Sem gorjeta"}),e.jsx("button",{type:"button",onClick:()=>{s("percent"),S("10")},className:`px-3 py-2 rounded-lg text-sm font-medium transition ${M==="percent"?"bg-purple-500 text-white":"bg-white text-gray-600 hover:bg-gray-100"}`,children:"Percentual"}),e.jsx("button",{type:"button",onClick:()=>{s("fixed"),S("")},className:`px-3 py-2 rounded-lg text-sm font-medium transition ${M==="fixed"?"bg-purple-500 text-white":"bg-white text-gray-600 hover:bg-gray-100"}`,children:"Valor fixo"})]}),M==="percent"&&e.jsxs("div",{children:[e.jsx(P,{htmlFor:"tip_percent",className:"text-xs text-gray-600",children:"Percentual (%)"}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[[5,10,15,20].map(g=>e.jsxs("button",{type:"button",onClick:()=>S(g.toString()),className:`px-3 py-2 rounded-lg text-sm font-medium transition ${v===g.toString()?"bg-purple-500 text-white":"bg-white text-gray-600 hover:bg-gray-100"}`,children:[g,"%"]},g)),e.jsx(R,{id:"tip_percent",type:"number",min:"0",max:"100",step:"0.1",placeholder:"Outro %",value:v,onChange:g=>S(g.target.value),className:"flex-1 h-10"})]})]}),M==="fixed"&&e.jsxs("div",{children:[e.jsx(P,{htmlFor:"tip_fixed",className:"text-xs text-gray-600",children:"Valor (R$)"}),e.jsx(R,{id:"tip_fixed",type:"number",min:"0",step:"0.01",placeholder:"Ex: 10.00",value:v,onChange:g=>S(g.target.value),className:"mt-1 h-10"})]}),ee>0&&e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsxs("p",{className:"text-sm font-medium text-purple-700",children:["Gorjeta: ",h(ee)]})})]})]})]}),e.jsxs("div",{className:"border-t p-4 bg-white",children:[e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal"}),e.jsx("span",{className:"font-medium",children:h(A)})]}),X>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Desconto (Cupom)"}),e.jsxs("span",{className:"font-medium",children:["-",h(X)]})]}),me>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Desconto (Fidelidade)"}),e.jsxs("span",{className:"font-medium",children:["-",h(me)]})]}),Z>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Taxa de entrega"}),e.jsx("span",{className:"font-medium",children:h(Z)})]}),ee>0&&e.jsxs("div",{className:"flex justify-between text-sm text-purple-600",children:[e.jsx("span",{children:"Gorjeta"}),e.jsx("span",{className:"font-medium",children:h(ee)})]}),e.jsxs("div",{className:"flex justify-between text-base font-bold pt-2 border-t",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{style:{color:D},children:h(Q)})]})]}),e.jsx(B,{onClick:()=>{ae()&&F(!0)},disabled:!ae()||y?.accepting_orders===!1||y?.is_open===!1,className:"w-full h-12 text-white font-bold",style:{backgroundColor:ae()&&y?.accepting_orders!==!1&&y?.is_open!==!1?D:"#d1d5db"},children:y?.is_open===!1?"ðŸ”´ Loja Fechada":y?.accepting_orders===!1?"â¸ï¸ Pedidos Pausados":"Finalizar Pedido"}),y?.is_open===!1?e.jsx("p",{className:"text-xs text-red-600 text-center mt-2",children:"A loja estÃ¡ fechada no momento"}):y?.accepting_orders===!1?e.jsx("p",{className:"text-xs text-orange-600 text-center mt-2",children:y.pause_message||"NÃ£o estamos aceitando pedidos temporariamente"}):ae()?null:e.jsx("p",{className:"text-xs text-red-600 text-center mt-2",children:"Preencha todos os campos obrigatÃ³rios"})]})]}),e.jsx(rt,{isOpen:O,onClose:()=>L(!1),initialAddress:t.address_street?`${t.address_street}, ${t.address_number||""}`:"",onConfirm:({latitude:g,longitude:E,addressData:Y})=>{x({...t,latitude:g,longitude:E,address_street:Y?.street||t.address_street||"",address_number:Y?.number||t.address_number||"",address_complement:Y?.complement||t.address_complement||"",neighborhood:Y?.neighborhood||t.neighborhood||"",city:Y?.city||t.city||"",state:Y?.state||t.state||"",address:Y?.fullAddress||t.address||""}),L(!1)}}),e.jsx(nt,{isOpen:K,onClose:()=>F(!1),onConfirm:()=>{F(!1),typeof p=="function"?p({customer_name:t.name,customer_phone:t.phone?.replace(/\D/g,"")||"",customer_email:t.email||c||"",observations:t.observations||"",tip:n&&M!=="none"?parseFloat(v||0):null,total:Q,cartTotal:A,discount:ue,deliveryFee:Z,appliedCoupon:l,customer:t}):typeof j=="function"&&j()},onEdit:()=>{F(!1)},cart:a,customer:t,cartTotal:A,discount:ue,deliveryFee:Z,total:Q,appliedCoupon:l,scheduledDate:t.scheduled_date,scheduledTime:t.scheduled_time,primaryColor:D})]})})}const xt="favorites_dishes";function ht(a="default"){const m=`${xt}_${a}`,[u,r]=d.useState(()=>{try{const l=localStorage.getItem(m);return l?JSON.parse(l):[]}catch{return[]}});d.useEffect(()=>{try{localStorage.setItem(m,JSON.stringify(u))}catch(l){console.error("Erro ao salvar favoritos:",l)}},[u,m]);const j=d.useCallback(l=>{r(N=>N.some(b=>b.id===l.id)?N:[...N,{id:l.id,dish:l,addedAt:new Date().toISOString()}])},[]),p=d.useCallback(l=>{r(N=>N.filter(b=>b.id!==l))},[]),w=d.useCallback(l=>{f(l.id)?p(l.id):j(l)},[]),f=d.useCallback(l=>u.some(N=>N.id===l),[u]),o=d.useCallback(()=>{r([])},[]);return{favorites:u,addFavorite:j,removeFavorite:p,toggleFavorite:w,isFavorite:f,clearFavorites:o}}function Ut({dish:a,onClick:m,index:u=0,isOutOfStock:r=!1,isLowStock:j=!1,primaryColor:p="#f97316",textPrimaryColor:w,slug:f=null}){ht(f);const o=b=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(b||0),l=[];if(a.is_new&&l.push({label:"Novo",icon:"âœ¨",color:"from-green-500 to-green-600",position:"top-left",pulse:!0}),a.is_popular&&l.push({label:"Popular",icon:"ðŸ”¥",color:"from-purple-500 to-purple-600",position:l.length===0?"top-left":"top-right",pulse:!0}),a.original_price&&a.original_price>a.price){const b=Math.round((a.original_price-a.price)/a.original_price*100);l.push({label:`-${b}%`,icon:"ðŸ’¥",color:"from-red-500 to-red-600",position:l.length===0?"top-right":"bottom-right",pulse:!0})}r?l.push({label:"Esgotado",icon:"",color:"bg-gray-600",position:"top-right",pulse:!1}):j&&l.push({label:"Ãšltimas",icon:"âš ï¸",color:"from-orange-500 to-orange-600",position:"top-right",pulse:!0});const N={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{type:"spring",stiffness:100,damping:15,delay:u*.05}},hover:{y:-8,scale:1.03,boxShadow:"0 20px 40px rgba(0,0,0,0.15)",transition:{type:"spring",stiffness:300,damping:20}}};return e.jsxs(T.div,{variants:N,initial:"hidden",animate:"visible",whileHover:r?{}:"hover",className:`
        group relative bg-card border border-border rounded-xl md:rounded-lg
        overflow-hidden shadow-sm cursor-pointer
        ${r?"opacity-60 cursor-not-allowed":""}
      `,onClick:()=>!r&&m(a),children:[!r&&e.jsx(T.div,{className:"absolute inset-0 z-10 bg-gradient-to-r from-transparent via-white/20 to-transparent pointer-events-none",initial:{x:"-100%",opacity:0},whileHover:{x:"200%",opacity:1,transition:{duration:.6,ease:"easeInOut"}}}),l.map((b,_)=>e.jsx(T.div,{className:`
            absolute z-20 
            ${b.position==="top-left"?"top-2 left-2":""}
            ${b.position==="top-right"?"top-2 right-2":""}
            ${b.position==="bottom-right"?"bottom-2 right-2":""}
          `,animate:b.pulse?{scale:[1,1.05,1]}:{},transition:b.pulse?{repeat:1/0,duration:2,ease:"easeInOut"}:{},children:e.jsxs(se,{className:`
              bg-gradient-to-r ${b.color} 
              text-white font-bold shadow-lg 
              text-[10px] md:text-[9px] px-1.5 md:px-1 py-0.5
              backdrop-blur-sm
            `,children:[b.icon," ",b.label]})},_)),e.jsxs("div",{className:"relative aspect-square bg-gray-100 dark:bg-gray-800 overflow-hidden",children:[a.image?e.jsxs(e.Fragment,{children:[e.jsx(T.div,{className:"absolute inset-0 bg-gray-200 dark:bg-gray-700",animate:{opacity:[.5,.7,.5]},transition:{repeat:1/0,duration:1.5}}),e.jsx(T.img,{src:a.image,alt:a.name,className:`
                w-full h-full object-cover 
                ${r?"grayscale":""}
              `,loading:"lazy",onLoad:b=>{b.target.previousSibling&&(b.target.previousSibling.style.display="none")},whileHover:r?{}:{scale:1.1},transition:{duration:.3}})]}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-3xl md:text-2xl",children:"ðŸ½ï¸"}),!r&&e.jsx(T.div,{className:"absolute inset-0 bg-gradient-to-t from-black/40 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),e.jsxs("div",{className:"p-3 md:p-2.5 space-y-2 md:space-y-1.5 bg-card",children:[e.jsx("h3",{className:"font-bold text-sm md:text-xs text-foreground line-clamp-2 min-h-[36px] md:min-h-[32px] group-hover:text-primary transition-colors",children:a.name}),a.description&&e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-1 md:hidden",children:a.description}),e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsx(T.div,{whileHover:{scale:1.05},transition:{type:"spring",stiffness:300},children:a.original_price&&a.original_price>a.price?e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{className:"text-[10px] md:text-[9px] text-muted-foreground line-through",children:o(a.original_price)}),e.jsx("p",{className:"text-base md:text-sm font-bold",style:{color:w||p},children:o(a.price)})]}):e.jsx("p",{className:"text-base md:text-sm font-bold",style:{color:w||p},children:o(a.price)})}),!r&&e.jsx(T.div,{initial:{opacity:0,scale:0},whileHover:{opacity:1,scale:1},className:"w-8 h-8 rounded-full bg-primary flex items-center justify-center text-white shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Fe,{className:"w-4 h-4"})})]})]})]})}const Be="cardapio_cart",Te=a=>a?`cardapio_cart_${a}`:Be;function $e(a){try{const m=Te(a),u=localStorage.getItem(m);return u?JSON.parse(u):[]}catch{return[]}}function Qt(a=null){const m=Te(a),[u,r]=d.useState(()=>$e(a));d.useEffect(()=>{r($e(a))},[a]),d.useEffect(()=>{try{localStorage.setItem(m,JSON.stringify(u)),a||localStorage.setItem(Be,JSON.stringify(u))}catch(b){console.error("Erro ao salvar carrinho:",b)}},[u,m,a]);const j=d.useCallback(b=>{r(_=>[..._,{...b,quantity:1,id:`${b.dish.id}_${Date.now()}`}])},[]),p=d.useCallback((b,_)=>{r(k=>k.map(y=>y.id===b?{..._,id:b,quantity:y.quantity}:y))},[]),w=d.useCallback(b=>{r(_=>_.filter(k=>k.id!==b))},[]),f=d.useCallback((b,_)=>{r(k=>k.map(y=>{if(y.id===b){const D=(y.quantity||1)+_;return D<=0?null:{...y,quantity:D}}return y}).filter(Boolean))},[]),o=d.useCallback(()=>{r([])},[]),l=u.reduce((b,_)=>b+_.totalPrice*(_.quantity||1),0),N=u.reduce((b,_)=>b+(_.quantity||1),0);return{cart:u,addItem:j,updateItem:p,removeItem:w,updateQuantity:f,clearCart:o,cartTotal:l,cartItemsCount:N}}export{Yt as C,Ut as D,Qt as a,Re as b,Jt as c,mt as o,ht as u};
