import{r as d,u as Ce,z as G,j as e,B as N,X as Oe,L as _e,E as Re}from"./main-5wCJ0shd.js";import{b as L}from"./base44Client-BjweZdup.js";import{u as ke}from"./useQuery-TBRlwA9F.js";import{B as oe}from"./badge-tC6tpDVj.js";import{L as W,I as U}from"./label-BGurCIwA.js";import{D as he,a as ge,b as pe,c as fe,e as De}from"./dialog-BQt4A9EY.js";import{I as Ue}from"./InstallAppButton-D7LO9hfL.js";import{P as Ie,u as Ge}from"./useComandaWebSocket-DLthfoyN.js";import{l as He}from"./index-CL3SdtP1.js";import{B as le}from"./bell-BP42pcPs.js";import{u as Ae}from"./useMutation-CfjUJVgq.js";import{C as A,P as Qe,a as We}from"./constants-BZ6YHCOj.js";import{u as Ve}from"./useDebounce-clvhhWu8.js";import{f as S,a as Ye,b as Ke}from"./formatters-CvOEClq0.js";import{C as Ze}from"./ColaboradorProfile-hI86Ih0T.js";import{S as je,a as Ne,b as ve,c as we,d as ue}from"./select-D68HeZiV.js";import{P as ie}from"./plus-DJfFeu4q.js";import{T as Je}from"./trash-2-CxXzmM5w.js";import{H as ae}from"./history-Cqrz1KjB.js";import{C as Le}from"./circle-x-C3c2vtU6.js";import{C as be}from"./circle-check-B4wdpzyW.js";import{C as Te,c as ze}from"./card-co3zywKC.js";import{R as K}from"./receipt-DLhuB_An.js";import{U as $e}from"./user-SYMNLJbz.js";import{P as Xe}from"./phone-DEvhMYo9.js";import{C as et}from"./clock-8p17jiPd.js";import{T as tt}from"./trending-up-8OxCq5vE.js";import{C as at}from"./calculator-CLN8Z376.js";import{D as st}from"./dollar-sign-BdBkW913.js";import{L as Ee}from"./log-out-DCopNCEG.js";import{S as rt}from"./search-C1Oe3veH.js";import{C as nt}from"./circle-alert-CSoTi2zi.js";import"./index-BjH-urEE.js";import"./index-DJGIH_vd.js";import"./index-XPl2RJU8.js";import"./download-DOPNSAwp.js";import"./camera-BlP5SAbE.js";import"./save-CE2DQko5.js";import"./index-DBH5IvqS.js";import"./index-DJsYT-OT.js";import"./chevron-down-LYt6GC0H.js";import"./check-b5qncWl4.js";const ot="wss://digimenu-backend.onrender.com";function lt(a=!0){const[x,r]=d.useState([]),s=d.useRef(null),i=Ce(),n=d.useRef(null),{data:l=[]}=ke({queryKey:["WaiterCall"],queryFn:async()=>{try{return await L.entities.WaiterCall.list("-created_at",{status:"pending"})}catch(m){return console.error("Erro ao buscar chamadas:",m),[]}},enabled:a,refetchInterval:a?5e3:!1});return d.useEffect(()=>{if(Array.isArray(l)){const m=l.filter(p=>p.status==="pending");r(m)}},[l]),d.useEffect(()=>{if(a)return n.current=new Audio("data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUKzn8LZjGwY4kdfyzHksBSR3x/DdkEAKFF606euoVRQKRp/g8r5sIQUrgc7y2Yk2CBtpvfDknE4MDlCs5/C2YxsGOJHX8sx5LAUkd8fw3ZBAC"),n.current.volume=.7,n.current.load(),()=>{n.current&&(n.current.pause(),n.current=null)}},[a]),d.useEffect(()=>{if(!a){s.current&&(s.current.disconnect(),s.current=null);return}return(async()=>{try{const p=await L.auth.me();if(!p)return;const w=p.subscriber_email||p.email,h=p.email;s.current=He(ot,{transports:["websocket","polling"],reconnection:!0,reconnectionDelay:2e3,reconnectionAttempts:5});const g=s.current;g.on("connect",()=>{console.log("âœ… WebSocket GarÃ§om conectado:",g.id),g.emit("subscribe:waiter",{subscriberEmail:w,waiterEmail:h})}),g.on("disconnect",()=>{console.log("âŒ WebSocket GarÃ§om desconectado")}),g.on("connect_error",()=>{console.warn("âš ï¸ WebSocket GarÃ§om indisponÃ­vel.")}),g.on("waiter:call",f=>{console.log("ðŸ”” Chamada de garÃ§om via WebSocket:",f),i.invalidateQueries({queryKey:["WaiterCall"]}),r(E=>E.some(q=>q.id===f.id)?E:[...E,{...f,status:"pending"}]),n.current&&n.current.play().catch(E=>console.log("Erro ao tocar som:",E)),navigator.vibrate&&navigator.vibrate([200,100,200,100,200]),G.success(e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(le,{className:"w-6 h-6 text-orange-500 animate-pulse"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:"Chamada de GarÃ§om!"}),e.jsxs("p",{className:"text-sm",children:["Mesa ",f.table_number||f.table_id]})]})]}),{duration:5e3,position:"top-center",style:{background:"#fff",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"}}),"Notification"in window&&Notification.permission==="granted"&&new Notification("ðŸ”” Chamada de GarÃ§om",{body:`Mesa ${f.table_number||f.table_id} estÃ¡ chamando`,icon:"/icon.png",badge:"/badge.png",tag:"waiter-call",requireInteraction:!0})})}catch(p){console.error("Erro ao conectar WebSocket:",p)}})(),()=>{s.current&&(s.current.disconnect(),s.current=null)}},[a,i]),{waiterCalls:x,allWaiterCalls:l||[],setWaiterCalls:r}}const it="DigiMenuGarcom",ct=1,v={COMANDAS:"comandas",WAITER_CALLS:"waiter_calls",SYNC_QUEUE:"sync_queue"};let xe=null;function ce(){return new Promise((a,x)=>{if(xe){a(xe);return}const r=indexedDB.open(it,ct);r.onerror=()=>{console.error("[Offline] Erro ao abrir IndexedDB:",r.error),x(r.error)},r.onsuccess=()=>{xe=r.result,console.log("[Offline] IndexedDB aberto com sucesso"),a(xe)},r.onupgradeneeded=s=>{const i=s.target.result;if(!i.objectStoreNames.contains(v.COMANDAS)){const n=i.createObjectStore(v.COMANDAS,{keyPath:"id",autoIncrement:!1});n.createIndex("status","status",{unique:!1}),n.createIndex("created_at","created_at",{unique:!1})}if(!i.objectStoreNames.contains(v.WAITER_CALLS)){const n=i.createObjectStore(v.WAITER_CALLS,{keyPath:"id",autoIncrement:!1});n.createIndex("status","status",{unique:!1}),n.createIndex("created_at","created_at",{unique:!1})}if(!i.objectStoreNames.contains(v.SYNC_QUEUE)){const n=i.createObjectStore(v.SYNC_QUEUE,{keyPath:"id",autoIncrement:!0});n.createIndex("type","type",{unique:!1}),n.createIndex("timestamp","timestamp",{unique:!1})}}})}async function dt(a){try{return await(await ce()).transaction([v.COMANDAS],"readwrite").objectStore(v.COMANDAS).put({...a,_offline:!0,_synced:!1,_timestamp:new Date().toISOString()}),await Pe("comanda",a,"create"),console.log("[Offline] Comanda salva offline:",a.id),a}catch(x){throw console.error("[Offline] Erro ao salvar comanda offline:",x),x}}async function mt(a){try{return await(await ce()).transaction([v.COMANDAS],"readwrite").objectStore(v.COMANDAS).put({...a,_offline:!0,_synced:!1,_timestamp:new Date().toISOString()}),await Pe("comanda",a,"update"),console.log("[Offline] Comanda atualizada offline:",a.id),a}catch(x){throw console.error("[Offline] Erro ao atualizar comanda offline:",x),x}}async function ut(){try{const r=(await ce()).transaction([v.COMANDAS],"readonly").objectStore(v.COMANDAS);return new Promise((s,i)=>{const n=r.getAll();n.onsuccess=()=>{const l=n.result||[];console.log("[Offline] Comandas carregadas:",l.length),s(l)},n.onerror=()=>i(n.error)})}catch(a){return console.error("[Offline] Erro ao buscar comandas offline:",a),[]}}async function Pe(a,x,r){try{await(await ce()).transaction([v.SYNC_QUEUE],"readwrite").objectStore(v.SYNC_QUEUE).add({type:a,action:r,data:x,timestamp:new Date().toISOString(),retries:0}),console.log("[Offline] Adicionado Ã  fila de sincronizaÃ§Ã£o:",a,r)}catch(s){console.error("[Offline] Erro ao adicionar Ã  fila:",s)}}async function xt(a){if(!navigator.onLine){console.log("[Offline] Ainda offline, aguardando...");return}try{const s=(await ce()).transaction([v.SYNC_QUEUE],"readwrite").objectStore(v.SYNC_QUEUE),i=await new Promise((n,l)=>{const m=s.getAll();m.onsuccess=()=>n(m.result||[]),m.onerror=()=>l(m.error)});if(i.length===0){console.log("[Offline] Nada para sincronizar");return}console.log("[Offline] Sincronizando",i.length,"itens...");for(const n of i)try{n.type==="comanda"?n.action==="create"?await a.entities.Comanda.create(n.data):n.action==="update"&&await a.entities.Comanda.update(n.data.id,n.data):n.type==="waiter_call"&&n.action==="create"&&await a.entities.WaiterCall.create(n.data),await new Promise((l,m)=>{const p=s.delete(n.id);p.onsuccess=()=>l(),p.onerror=()=>m(p.error)}),console.log("[Offline] Item sincronizado:",n.id)}catch(l){console.error("[Offline] Erro ao sincronizar item:",n.id,l),n.retries=(n.retries||0)+1,n.retries<3?await s.put(n):await s.delete(n.id)}console.log("[Offline] SincronizaÃ§Ã£o concluÃ­da")}catch(x){console.error("[Offline] Erro na sincronizaÃ§Ã£o:",x)}}function ht(){return navigator.onLine}function gt(a){window.addEventListener("online",()=>{console.log("[Offline] ConexÃ£o restaurada"),a(!0)}),window.addEventListener("offline",()=>{console.log("[Offline] ConexÃ£o perdida"),a(!1)})}function pt(){const[a,x]=d.useState(ht()),[r,s]=d.useState(!1);d.useEffect(()=>{gt(m=>{x(m),m&&i()}),a&&i();const l=setInterval(()=>{a&&!r&&i()},3e4);return()=>{clearInterval(l)}},[a,r]);const i=async()=>{if(!(r||!a)){s(!0);try{await xt(L)}catch(n){console.error("[Offline] Erro na sincronizaÃ§Ã£o:",n)}finally{s(!1)}}};return{online:a,syncing:r,syncData:i}}function ft(a="open",x=!0){const{online:r}=pt(),s=Ce(),{data:i=[],isLoading:n}=ke({queryKey:["Comanda",a,r],queryFn:async()=>{const h=a&&a!=="all"?{status:a}:{};return r?L.entities.Comanda.list("-created_at",h):(await ut()).filter(f=>a==="all"?!0:(f.status||A.OPEN)===a)},enabled:x&&r!==void 0,refetchInterval:r?5e3:!1}),l=Ae({mutationFn:async h=>{if(r)return await L.entities.Comanda.create(h);{const g={...h,id:`offline_${Date.now()}`,code:h.code||`C-${Date.now().toString().slice(-6)}`};return await dt(g)}},onSuccess:()=>{s.invalidateQueries({queryKey:["Comanda"]}),G.success(r?"Comanda criada com sucesso!":"Comanda salva offline. SerÃ¡ sincronizada quando voltar online.")},onError:h=>G.error(h?.message||"Erro ao criar comanda")}),m=Ae({mutationFn:async({id:h,data:g})=>r?await L.entities.Comanda.update(h,g):await mt({...g,id:h}),onSuccess:()=>{s.invalidateQueries({queryKey:["Comanda"]}),G.success(r?"Comanda atualizada com sucesso!":"Comanda atualizada offline. SerÃ¡ sincronizada quando voltar online.")},onError:h=>G.error(h?.message||"Erro ao atualizar comanda")}),p=d.useMemo(()=>Array.isArray(i)?i:[],[i]),w=d.useMemo(()=>{const h=p;return{total:h.length,open:h.filter(g=>(g.status||A.OPEN)===A.OPEN).length,closed:h.filter(g=>g.status===A.CLOSED).length,cancelled:h.filter(g=>g.status===A.CANCELLED).length,totalValue:h.reduce((g,f)=>g+(f.total||0),0),averageTicket:h.length>0?h.reduce((g,f)=>g+(f.total||0),0)/h.length:0}},[p]);return{comandas:p,isLoading:n,stats:w,createMutation:l,updateMutation:m,online:r}}function bt({open:a,onOpenChange:x,mode:r,comanda:s,dishes:i=[],onCreate:n,onUpdate:l,isCreating:m=!1,isUpdating:p=!1,user:w}){const[h,g]=d.useState(""),[f,E]=d.useState(""),[V,q]=d.useState(""),[y,H]=d.useState([]),[O,Q]=d.useState([{method:"pix",amount:""}]),[C,_]=d.useState({type:"percent",value:""}),[M,Z]=d.useState(!1),[B,J]=d.useState(2);d.useEffect(()=>{r==="edit"&&s?(g(s.table_name||""),E(s.customer_name||""),q(s.customer_phone||""),H(Array.isArray(s.items)?s.items:[]),Q(Array.isArray(s.payments)&&s.payments.length>0?s.payments:[{method:"pix",amount:""}]),_(s.tip?{type:s.tip.type||"percent",value:s.tip.value||""}:{type:"percent",value:""}),Z(!!s.split_count),J(s.split_count||2)):r==="create"?(g(""),E(""),q(""),H([]),Q([{method:"pix",amount:""}]),_({type:"percent",value:""}),Z(!1),J(2)):r==="close"&&s&&(g(s.table_name||""),E(s.customer_name||""),q(s.customer_phone||""),H(Array.isArray(s.items)?s.items:[]),Q([{method:"pix",amount:""}]),_({type:"percent",value:""}),Z(!1),J(2))},[r,s,a]);const de=()=>{if(i.length===0){G.error("Nenhum prato disponÃ­vel");return}H([...y,{dish_id:i[0].id,dish_name:i[0].name,quantity:1,unit_price:i[0].price||0,observations:""}])},X=(o,c,u)=>{const j=[...y];j[o]={...j[o],[c]:u},H(j)},Se=o=>{H(y.filter((c,u)=>u!==o))},se=()=>{Q([...O,{method:"pix",amount:""}])},F=(o,c,u)=>{const j=[...O];j[o]={...j[o],[c]:u},Q(j)},re=o=>{O.length>1&&Q(O.filter((c,u)=>u!==o))},T=y.reduce((o,c)=>o+(Number(c.quantity)||0)*(Number(c.unit_price)||0),0),z=C.value?C.type==="percent"?T*(parseFloat(C.value)/100):parseFloat(C.value):0,R=T+z,ee=M&&B>0?R/B:R,te=(o,c,u)=>[...Array.isArray(o)?o:[],{at:new Date().toISOString(),by:w?.email||"sistema",action:c,details:u||{}}],ye=o=>{if(o.preventDefault(),r==="create"&&y.length===0){G.error("A comanda deve ter pelo menos um item");return}if(r==="create"){const c=te([],"created",{});n({code:void 0,status:"open",table_name:h.trim()||null,customer_name:f.trim()||null,customer_phone:V.trim()||null,items:y,payments:[],total:T,created_by:w?.email,history:c})}else if(r==="close"&&s){const c=O.filter(j=>parseFloat(j.amount)>0).map(j=>({method:j.method,amount:parseFloat(j.amount),created_at:new Date().toISOString(),created_by:w?.email}));if(c.reduce((j,ne)=>j+ne.amount,0)<R){G.error("O valor dos pagamentos deve ser igual ao total");return}const u=te(s.history||[],"closed",{payments:c,tip:z>0?C:null,tip_amount:z,split_count:M?B:null});l({id:s.id,data:{...s,status:"closed",closed_at:new Date().toISOString(),closed_by:w?.email,payments:c,total:R,tip:z>0?C:null,tip_amount:z,split_count:M?B:null,history:u}})}else if(r==="edit"&&s){if(y.length===0){G.error("A comanda deve ter pelo menos um item");return}const c=te(s.history||[],"updated",{summary:"AlteraÃ§Ã£o de itens ou dados"});l({id:s.id,data:{...s,table_name:h.trim()||null,customer_name:f.trim()||null,customer_phone:V.trim()||null,items:y,total:T,history:c}})}},D=r==="close",me=m||p;return e.jsx(he,{open:a,onOpenChange:x,children:e.jsxs(ge,{className:"sm:max-w-2xl max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsx(pe,{children:e.jsxs(fe,{children:[r==="create"&&"Nova Comanda",r==="edit"&&`Editar Comanda ${s?.code||`#${s?.id}`}`,r==="close"&&`Fechar Comanda ${s?.code||`#${s?.id}`}`]})}),e.jsxs("form",{onSubmit:ye,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(W,{children:"Mesa"}),e.jsx(U,{value:h,onChange:o=>g(o.target.value),placeholder:"NÃºmero ou nome da mesa",disabled:D})]}),e.jsxs("div",{children:[e.jsx(W,{children:"Cliente"}),e.jsx(U,{value:f,onChange:o=>E(o.target.value),placeholder:"Nome do cliente",disabled:D})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(W,{children:"Telefone"}),e.jsx(U,{type:"tel",value:V,onChange:o=>q(o.target.value),placeholder:"(00) 00000-0000",disabled:D})]})]}),!D&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(W,{children:"Itens"}),e.jsxs(N,{type:"button",onClick:de,size:"sm",variant:"outline",children:[e.jsx(ie,{className:"w-4 h-4 mr-1"}),"Adicionar"]})]}),e.jsxs("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:[y.map((o,c)=>e.jsxs("div",{className:"flex gap-2 p-2 border rounded-lg",children:[e.jsxs(je,{value:o.dish_id,onValueChange:u=>{const j=i.find(ne=>ne.id===u);X(c,"dish_id",u),X(c,"dish_name",j?.name||""),X(c,"unit_price",j?.price||0)},children:[e.jsx(Ne,{className:"flex-1",children:e.jsx(ve,{placeholder:"Selecione o prato"})}),e.jsx(we,{children:i.map(u=>e.jsxs(ue,{value:u.id,children:[u.name," - ",S(u.price||0)]},u.id))})]}),e.jsx(U,{type:"number",min:"1",value:o.quantity,onChange:u=>X(c,"quantity",parseInt(u.target.value)||1),className:"w-20",placeholder:"Qtd"}),e.jsx(U,{type:"text",value:o.observations||"",onChange:u=>X(c,"observations",u.target.value),className:"flex-1",placeholder:"ObservaÃ§Ãµes"}),e.jsx(N,{type:"button",onClick:()=>Se(c),size:"sm",variant:"ghost",children:e.jsx(Je,{className:"w-4 h-4 text-red-500"})})]},c)),y.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"Nenhum item adicionado"})]})]}),D&&y.length>0&&e.jsxs("div",{children:[e.jsx(W,{children:"Itens da Comanda"}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto border rounded-lg p-2",children:y.map((o,c)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 dark:bg-gray-800 rounded",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[o.quantity,"x ",o.dish_name]}),o.observations&&e.jsx("p",{className:"text-xs text-gray-500",children:o.observations})]}),e.jsx("p",{className:"font-bold",children:S((o.quantity||0)*(o.unit_price||0))})]},c))})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-medium",children:"Subtotal:"}),e.jsx("span",{className:"font-bold",children:S(T)})]}),D&&e.jsxs("div",{className:"space-y-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"flex-1",children:"Gorjeta"}),e.jsxs(je,{value:C.type,onValueChange:o=>_({...C,type:o}),children:[e.jsx(Ne,{className:"w-24",children:e.jsx(ve,{})}),e.jsxs(we,{children:[e.jsx(ue,{value:"percent",children:"%"}),e.jsx(ue,{value:"fixed",children:"R$"})]})]}),e.jsx(U,{type:"number",min:"0",value:C.value,onChange:o=>_({...C,value:o.target.value}),className:"w-24",placeholder:"0"})]}),z>0&&e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsx("span",{children:"Gorjeta:"}),e.jsx("span",{children:S(z)})]})]}),D&&e.jsxs("div",{className:"space-y-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"split",checked:M,onChange:o=>Z(o.target.checked),className:"rounded"}),e.jsx(W,{htmlFor:"split",className:"flex-1",children:"Dividir conta"}),M&&e.jsx(U,{type:"number",min:"2",value:B,onChange:o=>J(parseInt(o.target.value)||2),className:"w-20"})]}),M&&e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsxs("span",{children:["Valor por pessoa (",B,"):"]}),e.jsx("span",{children:S(ee)})]})]}),e.jsxs("div",{className:"flex justify-between items-center text-lg font-bold border-t pt-2",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{children:S(R)})]})]}),D&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(W,{children:"Pagamentos"}),e.jsxs(N,{type:"button",onClick:se,size:"sm",variant:"outline",children:[e.jsx(ie,{className:"w-4 h-4 mr-1"}),"Adicionar"]})]}),e.jsx("div",{className:"space-y-2",children:O.map((o,c)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(je,{value:o.method,onValueChange:u=>F(c,"method",u),children:[e.jsx(Ne,{className:"w-40",children:e.jsx(ve,{})}),e.jsx(we,{children:Qe.map(u=>e.jsx(ue,{value:u.value,children:u.label},u.value))})]}),e.jsx(U,{type:"number",min:"0",step:"0.01",value:o.amount,onChange:u=>F(c,"amount",u.target.value),className:"flex-1",placeholder:"Valor"}),O.length>1&&e.jsx(N,{type:"button",onClick:()=>re(c),size:"sm",variant:"ghost",children:e.jsx(Oe,{className:"w-4 h-4"})})]},c))}),e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:["Total pago: ",S(O.reduce((o,c)=>o+(parseFloat(c.amount)||0),0))]})]}),e.jsxs(De,{children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>x(!1),children:"Cancelar"}),e.jsx(N,{type:"submit",disabled:me,className:"bg-teal-600 hover:bg-teal-700",children:me?"Salvando...":r==="create"?"Criar":r==="close"?"Fechar comanda":"Salvar"})]})]})]})})}function yt({open:a,onOpenChange:x,comanda:r}){const s=Array.isArray(r?.history)?r.history:[],i=l=>{switch(l){case"created":return e.jsx(ie,{className:"w-4 h-4 text-green-600 dark:text-green-400"});case"updated":return e.jsx(Ie,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"});case"closed":return e.jsx(be,{className:"w-4 h-4 text-teal-600 dark:text-teal-400"});case"cancelled":return e.jsx(Le,{className:"w-4 h-4 text-red-600 dark:text-red-400"});default:return e.jsx(ae,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"})}},n=l=>({created:"Criada",updated:"Atualizada",closed:"Fechada",cancelled:"Cancelada"})[l]||l;return e.jsx(he,{open:a,onOpenChange:x,children:e.jsxs(ge,{className:"max-w-md max-h-[85vh] overflow-y-auto bg-white dark:bg-gray-800 border-teal-200 dark:border-teal-800",children:[e.jsx(pe,{children:e.jsxs(fe,{className:"text-teal-700 dark:text-teal-300 flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),"HistÃ³rico â€” ",r?.code||`#${r?.id}`]})}),e.jsx("div",{className:"space-y-3",children:s.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ae,{className:"w-12 h-12 mx-auto mb-3 text-gray-300 dark:text-gray-600 opacity-50"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Nenhuma alteraÃ§Ã£o registrada."})]}):s.map((l,m)=>e.jsxs("div",{className:"flex gap-3 p-3 rounded-lg border border-teal-100 dark:border-teal-900 bg-teal-50 dark:bg-teal-900/20 hover:bg-teal-100 dark:hover:bg-teal-900/30 transition-colors",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:i(l.action)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-teal-700 dark:text-teal-300",children:n(l.action)}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-500",children:Ye(l.at)})]}),e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:["Por: ",l.by||"Sistema"]}),l.details&&Object.keys(l.details).length>0&&e.jsxs("div",{className:"mt-2 p-2 bg-white dark:bg-gray-800 rounded text-xs text-gray-700 dark:text-gray-300 overflow-x-auto",children:[l.details.payments&&Array.isArray(l.details.payments)&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:"Pagamentos:"}),l.details.payments.map((p,w)=>e.jsxs("p",{className:"pl-2",children:[p.method,": ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(p.amount)]},w))]}),l.details.summary&&e.jsx("p",{className:"italic",children:l.details.summary}),!l.details.payments&&!l.details.summary&&e.jsx("pre",{className:"text-xs",children:JSON.stringify(l.details,null,2)})]})]})]},m))})]})})}function jt({comanda:a,onEdit:x,onClose:r,onCancel:s,onHistory:i,onPrint:n}){const l=a.status||A.OPEN,m=l===A.OPEN,p=l===A.CLOSED,h=(Array.isArray(a.items)?a.items:[]).reduce((g,f)=>g+(Number(f.quantity)||0),0);return e.jsx(Te,{className:`transition-all hover:shadow-lg ${m?"border-teal-300 dark:border-teal-700 bg-teal-50/50 dark:bg-teal-900/10":p?"border-green-300 dark:border-green-700 bg-green-50/50 dark:bg-green-900/10":"border-gray-300 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-900/10"}`,children:e.jsxs(ze,{className:"p-4",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(K,{className:"w-5 h-5 text-teal-600 dark:text-teal-400"}),e.jsx("h3",{className:"font-bold text-lg text-gray-900 dark:text-white",children:a.code||`#${a.id}`}),e.jsx(oe,{variant:m?"default":p?"secondary":"destructive",className:m?"bg-teal-500 text-white":p?"bg-green-500 text-white":"bg-red-500 text-white",children:m?"Aberta":p?"Fechada":"Cancelada"})]}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600 dark:text-gray-400",children:[a.table_name&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium",children:"Mesa:"}),e.jsx("span",{children:a.table_name})]}),a.customer_name&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($e,{className:"w-3 h-3"}),e.jsx("span",{children:a.customer_name})]}),a.customer_phone&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Xe,{className:"w-3 h-3"}),e.jsx("span",{children:a.customer_phone})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(et,{className:"w-3 h-3"}),e.jsx("span",{children:Ke(a.created_at)})]})]})]})}),e.jsxs("div",{className:"border-t pt-3 mt-3 space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[h," ",h===1?"item":"itens"]}),e.jsx("span",{className:"text-lg font-bold text-teal-700 dark:text-teal-300",children:S(a.total||0)})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2",children:[m&&e.jsxs(e.Fragment,{children:[e.jsxs(N,{size:"sm",variant:"outline",onClick:()=>x(a),className:"flex-1 border-teal-300 dark:border-teal-700 text-teal-700 dark:text-teal-300 hover:bg-teal-50 dark:hover:bg-teal-900/20",children:[e.jsx(Ie,{className:"w-4 h-4 mr-1"}),"Editar"]}),e.jsxs(N,{size:"sm",variant:"outline",onClick:()=>r(a),className:"flex-1 border-green-300 dark:border-green-700 text-green-700 dark:text-green-300 hover:bg-green-50 dark:hover:bg-green-900/20",children:[e.jsx(be,{className:"w-4 h-4 mr-1"}),"Fechar"]}),e.jsxs(N,{size:"sm",variant:"outline",onClick:()=>s(a),className:"border-red-300 dark:border-red-700 text-red-700 dark:text-red-300 hover:bg-red-50 dark:hover:bg-red-900/20",children:[e.jsx(Le,{className:"w-4 h-4 mr-1"}),"Cancelar"]})]}),e.jsxs(N,{size:"sm",variant:"ghost",onClick:()=>i(a),className:"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100",children:[e.jsx(ae,{className:"w-4 h-4 mr-1"}),"HistÃ³rico"]}),n&&e.jsx(N,{size:"sm",variant:"ghost",onClick:()=>n(a),className:"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100",children:"Imprimir"})]})]})]})})}function Nt({stats:a}){const x=[{label:"Total de Comandas",value:a.total,icon:K,color:"from-teal-500 to-teal-600",bgColor:"bg-teal-50 dark:bg-teal-900/20",textColor:"text-teal-700 dark:text-teal-300"},{label:"Abertas",value:a.open,icon:tt,color:"from-blue-500 to-blue-600",bgColor:"bg-blue-50 dark:bg-blue-900/20",textColor:"text-blue-700 dark:text-blue-300"},{label:"Fechadas",value:a.closed,icon:at,color:"from-green-500 to-green-600",bgColor:"bg-green-50 dark:bg-green-900/20",textColor:"text-green-700 dark:text-green-300"},{label:"Valor Total",value:S(a.totalValue),icon:st,color:"from-orange-500 to-orange-600",bgColor:"bg-orange-50 dark:bg-orange-900/20",textColor:"text-orange-700 dark:text-orange-300"}];return e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:x.map((r,s)=>{const i=r.icon;return e.jsx(Te,{className:`${r.bgColor} border-0 shadow-md hover:shadow-lg transition-shadow`,children:e.jsxs(ze,{className:"p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("div",{className:`p-2 rounded-lg bg-gradient-to-br ${r.color} bg-opacity-10`,children:e.jsx(i,{className:`w-5 h-5 ${r.textColor}`})})}),e.jsx("p",{className:`text-2xl font-bold ${r.textColor} mb-1`,children:r.value}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:r.label})]})},s)})})}function da(){const[a,x]=d.useState(null),[r,s]=d.useState(!0),[i,n]=d.useState(!1),l=Ce(),[m,p]=d.useState(A.OPEN),[w,h]=d.useState(""),[g,f]=d.useState(!1),[E,V]=d.useState(!1),[q,y]=d.useState(null),[H,O]=d.useState("create"),[Q,C]=d.useState(!1),[_,M]=d.useState(null),[Z,B]=d.useState(!1),[J,de]=d.useState(!1),[X,Se]=d.useState(!1),se=Ve(w,We.SEARCH);d.useEffect(()=>{(async()=>{try{const t=await L.auth.me();if(x(t),!t){L.auth.redirectToLogin("/Garcom");return}const b=t?.subscriber_email&&(t?.email||"").toLowerCase().trim()===(t?.subscriber_email||"").toLowerCase().trim(),I=t?.profile_roles?.length?t.profile_roles:t?.profile_role?[t.profile_role]:[],$=I.includes("gerente"),P=t?.profile_role==="garcom"||I.includes("garcom"),k=!t.subscriber_email||t.email&&t.subscriber_email&&t.email.toLowerCase().trim()===t.subscriber_email.toLowerCase().trim(),Y=P||t?.is_master===!0||b||$||k;if(n(Y),!Y){s(!1);return}}catch{L.auth.redirectToLogin("/Garcom")}finally{s(!1)}})()},[]);const{comandas:F,isLoading:re,stats:T,createMutation:z,updateMutation:R}=ft(m,i);Ge(i);const{waiterCalls:ee,allWaiterCalls:te,setWaiterCalls:ye}=lt(i),{data:D=[]}=ke({queryKey:["Dish"],queryFn:()=>L.entities.Dish.list(),enabled:i}),me=d.useMemo(()=>Array.isArray(D)?D.filter(t=>t.is_active!==!1):[],[D]),o=d.useMemo(()=>F.filter(t=>{if(m!=="all"&&(t.status||A.OPEN)!==m)return!1;if(se.trim()){const b=se.toLowerCase().trim(),I=(t.code||`#${t.id}`).toLowerCase(),$=(t.table_name||"").toLowerCase(),P=(t.customer_name||"").toLowerCase();return I.includes(b)||$.includes(b)||P.includes(b)}return!0}),[F,m,se]),c=d.useMemo(()=>{const t=new Date().toDateString(),b=F.filter(P=>(P.created_at?new Date(P.created_at).toDateString():"")===t),I=b.reduce((P,k)=>P+(k.total||0),0),$=b.length>0?I/b.length:0;return{count:b.length,totalValue:I,averageTicket:$}},[F]),u=()=>{y(null),O("create"),f(!0)},j=t=>{y(t),O("edit"),f(!0)},ne=t=>{M(t),C(!0)},qe=()=>{_&&(y(_),O("close"),f(!0),C(!1),M(null))},Me=t=>{if(window.confirm(`Tem certeza que deseja cancelar a comanda ${t.code||`#${t.id}`}?`)){const b=[...Array.isArray(t.history)?t.history:[],{at:new Date().toISOString(),by:a?.email||"sistema",action:"cancelled",details:{}}];R.mutate({id:t.id,data:{...t,status:A.CANCELLED,cancelled_at:new Date().toISOString(),cancelled_by:a?.email,history:b}})}},Be=t=>{y(t),V(!0)},Fe=t=>{const b=window.open("","_blank"),I=Array.isArray(t.items)?t.items:[],$=I.map(k=>{const Y=(Number(k.quantity)||0)*(Number(k.unit_price)||0);return`
        <div style="margin: 5px 0; padding: 5px 0; border-bottom: 1px dashed #ccc;">
          <div style="display: flex; justify-content: space-between;">
            <span><strong>${k.quantity}x</strong> ${k.dish_name||"Item"}</span>
            <span>${S(Y)}</span>
          </div>
          ${k.unit_price?`<div style="font-size: 10px; color: #666;">Unit: ${S(k.unit_price)}</div>`:""}
          ${k.observations?`<div style="font-size: 10px; color: #666; font-style: italic;">Obs: ${k.observations}</div>`:""}
        </div>
      `}).join(""),P=t.total||I.reduce((k,Y)=>k+(Number(Y.quantity)||0)*(Number(Y.unit_price)||0),0);b.document.write(`
      <!DOCTYPE html>
      <html>
        <head>
          <title>Comanda ${t.code||`#${t.id}`}</title>
          <meta charset="utf-8">
          <style>
            @page { size: 80mm auto; margin: 5mm; }
            body {
              font-family: 'Courier New', monospace;
              font-size: 12px;
              line-height: 1.4;
              padding: 10px;
              margin: 0;
              max-width: 80mm;
            }
            .header {
              text-align: center;
              margin-bottom: 10px;
              padding-bottom: 10px;
              border-bottom: 2px dashed #000;
            }
            .info { margin: 8px 0; font-size: 11px; }
            .total {
              border-top: 2px solid #000;
              margin-top: 10px;
              padding-top: 10px;
              font-weight: bold;
              font-size: 14px;
              text-align: right;
            }
            .code {
              background: #fff3cd;
              border: 2px solid #ff9800;
              padding: 8px;
              margin: 10px 0;
              text-align: center;
              font-size: 18px;
              font-weight: bold;
            }
          </style>
        </head>
        <body>
          <div class="header">
            <h1 style="margin: 0; font-size: 18px;">COMANDA</h1>
          </div>
          <div class="code">${t.code||`#${t.id}`}</div>
          <div class="info">
            ${t.table_name?`<strong>Mesa:</strong> ${t.table_name}<br>`:""}
            ${t.customer_name?`<strong>Cliente:</strong> ${t.customer_name}<br>`:""}
            ${t.customer_phone?`<strong>Telefone:</strong> ${t.customer_phone}<br>`:""}
            <strong>Data:</strong> ${t.created_at?new Date(t.created_at).toLocaleString("pt-BR"):new Date().toLocaleString("pt-BR")}
          </div>
          <div style="margin: 15px 0;">
            <strong>ITENS:</strong>
            ${$}
          </div>
          <div class="total">
            TOTAL: ${S(P)}
          </div>
          <div style="text-align: center; margin-top: 15px; font-size: 10px; color: #666;">
            ${new Date().toLocaleString("pt-BR")}
          </div>
        </body>
      </html>
    `),b.document.close(),setTimeout(()=>{b.print()},250)};return r?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-teal-50 via-emerald-50 to-teal-50 dark:from-teal-950 dark:via-emerald-950 dark:to-teal-950",children:e.jsx(_e,{className:"w-8 h-8 animate-spin text-teal-600 dark:text-teal-400"})}):i?e.jsx(Re,{children:e.jsxs("div",{className:"min-h-screen min-h-screen-mobile bg-gradient-to-br from-teal-50 via-emerald-50 to-teal-50 dark:from-teal-950 dark:via-emerald-950 dark:to-teal-950 pb-safe",children:[e.jsx("header",{className:"bg-gradient-to-r from-teal-600 via-teal-700 to-teal-600 dark:from-teal-800 dark:via-teal-900 dark:to-teal-800 text-white sticky top-0 z-20 shadow-xl backdrop-blur-sm",children:e.jsxs("div",{className:"px-4 py-4 flex items-center justify-between safe-top",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-2xl flex items-center justify-center backdrop-blur-md shadow-lg",children:e.jsx(K,{className:"w-7 h-7"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-xl",children:"Comandas"}),e.jsx("p",{className:"text-xs text-teal-100 opacity-90",children:"GestÃ£o de comandas em tempo real"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ue,{pageName:"GarÃ§om",compact:!0}),e.jsxs(N,{variant:"ghost",size:"sm",className:"text-white hover:bg-white/20 min-h-touch",onClick:()=>de(!0),"aria-label":"Abrir perfil",children:[e.jsx($e,{className:"w-5 h-5 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Perfil"})]}),e.jsxs(N,{variant:"ghost",size:"sm",className:"text-white hover:bg-white/20 min-h-touch",onClick:()=>L.auth.logout(),"aria-label":"Sair",children:[e.jsx(Ee,{className:"w-5 h-5 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Sair"})]})]})]})}),e.jsxs("main",{className:"p-4 max-w-7xl mx-auto pb-24 safe-bottom",children:[ee.length>0&&e.jsx("div",{className:"mb-6 p-4 bg-gradient-to-r from-orange-50 to-orange-100 dark:from-orange-900/30 dark:to-orange-800/30 border-2 border-orange-500 rounded-2xl shadow-lg animate-pulse",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-500 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(le,{className:"w-6 h-6 text-white animate-bounce"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-lg text-orange-900 dark:text-orange-100",children:[ee.length," ",ee.length===1?"chamada pendente":"chamadas pendentes"]}),e.jsx("p",{className:"text-sm text-orange-700 dark:text-orange-300",children:ee.map(t=>`Mesa ${t.table_number||t.table_id}`).join(", ")})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(N,{size:"sm",onClick:()=>B(!0),className:"bg-orange-600 hover:bg-orange-700 text-white",children:[e.jsx(ae,{className:"w-4 h-4 mr-1"}),"HistÃ³rico"]}),e.jsx(N,{size:"sm",variant:"outline",onClick:()=>ye([]),className:"border-orange-300 text-orange-700 dark:text-orange-300",children:"Limpar"})]})]})}),!re&&F.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5 text-teal-600 dark:text-teal-400"}),"RelatÃ³rios de Hoje"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl p-6 text-white shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(K,{className:"w-8 h-8 opacity-80"}),e.jsx(oe,{className:"bg-white/20 text-white border-0",children:c.count})]}),e.jsx("p",{className:"text-sm opacity-90 mb-1",children:"Comandas Hoje"}),e.jsx("p",{className:"text-3xl font-bold",children:c.count})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-500 to-green-600 rounded-2xl p-6 text-white shadow-xl",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(be,{className:"w-8 h-8 opacity-80"})}),e.jsx("p",{className:"text-sm opacity-90 mb-1",children:"Valor Total Hoje"}),e.jsx("p",{className:"text-3xl font-bold",children:S(c.totalValue)})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-2xl p-6 text-white shadow-xl",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(ae,{className:"w-8 h-8 opacity-80"})}),e.jsx("p",{className:"text-sm opacity-90 mb-1",children:"Ticket MÃ©dio"}),e.jsx("p",{className:"text-3xl font-bold",children:S(c.averageTicket)})]})]})]}),!re&&F.length>0&&e.jsx(Nt,{stats:T}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(rt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx(U,{value:w,onChange:t=>h(t.target.value),placeholder:"Buscar por cÃ³digo, mesa ou cliente...",className:"pl-10 pr-10 bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600 h-12 text-base","aria-label":"Buscar comandas"}),w&&e.jsx("button",{onClick:()=>h(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 min-h-touch min-w-touch","aria-label":"Limpar busca",children:e.jsx(Oe,{className:"w-5 h-5"})})]})}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:[{value:A.OPEN,label:"Abertas",count:T.open},{value:A.CLOSED,label:"Fechadas",count:T.closed},{value:"all",label:"Todas",count:T.total}].map(t=>e.jsxs("button",{onClick:()=>p(t.value),className:`px-5 py-2.5 rounded-full text-sm font-medium transition-all min-h-touch ${m===t.value?"bg-teal-600 text-white shadow-lg scale-105":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border border-gray-200 dark:border-gray-700 hover:border-teal-300 dark:hover:border-teal-700"}`,"aria-label":`Filtrar por ${t.label}`,children:[t.label,t.count>0&&e.jsx(oe,{className:`ml-2 ${m===t.value?"bg-white/20 text-white":"bg-teal-100 dark:bg-teal-900/30 text-teal-700 dark:text-teal-300"}`,children:t.count})]},t.value))}),re?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(_e,{className:"w-8 h-8 animate-spin text-teal-600 dark:text-teal-400"})}):o.length===0?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-3xl shadow-xl p-12 text-center border border-teal-200 dark:border-teal-800",children:[e.jsx(K,{className:"w-20 h-20 mx-auto mb-4 text-teal-400 dark:text-teal-500 opacity-50"}),e.jsx("p",{className:"font-semibold text-xl text-gray-900 dark:text-white mb-2",children:"Nenhuma comanda encontrada"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-6",children:[m!=="all"?"Altere o filtro ou":""," crie uma nova comanda."]}),e.jsxs(N,{onClick:u,className:"bg-teal-600 hover:bg-teal-700 text-white min-h-touch px-6 py-3 text-base",children:[e.jsx(ie,{className:"w-5 h-5 mr-2"}),"Nova Comanda"]})]}):e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:o.map(t=>e.jsx(jt,{comanda:t,onEdit:j,onClose:ne,onCancel:Me,onHistory:Be,onPrint:Fe},t.id))})]}),e.jsx("button",{onClick:u,className:"fixed bottom-6 right-6 w-16 h-16 bg-gradient-to-r from-teal-600 to-teal-700 hover:from-teal-700 hover:to-teal-800 text-white rounded-full shadow-2xl flex items-center justify-center z-30 transition-all hover:scale-110 active:scale-95 min-h-touch safe-bottom",style:{marginBottom:"env(safe-area-inset-bottom, 0px)"},"aria-label":"Criar nova comanda",children:e.jsx(ie,{className:"w-8 h-8"})}),e.jsx(bt,{open:g,onOpenChange:t=>{f(t),t||y(null)},mode:H,comanda:q,dishes:me,onCreate:z.mutate,onUpdate:R.mutate,isCreating:z.isPending,isUpdating:R.isPending,user:a}),e.jsx(yt,{open:E,onOpenChange:t=>{V(t),t||y(null)},comanda:q}),e.jsx(he,{open:Z,onOpenChange:B,children:e.jsxs(ge,{className:"max-w-2xl max-h-[85vh] overflow-y-auto bg-white dark:bg-gray-800",children:[e.jsx(pe,{children:e.jsxs(fe,{className:"text-teal-700 dark:text-teal-300 flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5"}),"HistÃ³rico de Chamadas"]})}),e.jsx("div",{className:"space-y-3",children:te.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(le,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Nenhuma chamada registrada"})]}):te.map(t=>{const b=t.status==="pending",I=t.created_at?new Date(t.created_at).toLocaleString("pt-BR"):"",$=t.answered_at&&t.created_at?Math.round((new Date(t.answered_at)-new Date(t.created_at))/1e3):null;return e.jsx("div",{className:`p-4 rounded-lg border ${b?"bg-orange-50 dark:bg-orange-900/20 border-orange-300 dark:border-orange-700":"bg-gray-50 dark:bg-gray-800 border-gray-200 dark:border-gray-700"}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(le,{className:`w-5 h-5 ${b?"text-orange-600 dark:text-orange-400":"text-gray-400"}`}),e.jsxs("span",{className:"font-bold text-lg",children:["Mesa ",t.table_number||t.table_id||"N/A"]}),b&&e.jsx(oe,{className:"bg-orange-600 text-white animate-pulse",children:"Pendente"}),!b&&e.jsx(oe,{className:"bg-green-600 text-white",children:"Atendida"})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Chamada: ",I]}),t.answered_at&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Atendida: ",new Date(t.answered_at).toLocaleString("pt-BR")]}),$!==null&&e.jsxs("p",{className:"text-sm text-teal-600 dark:text-teal-400 font-medium",children:["Tempo de resposta: ",$,"s"]}),t.answered_by&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:["Atendido por: ",t.answered_by]})]})})},t.id)})})]})}),e.jsx(he,{open:Q,onOpenChange:C,children:e.jsxs(ge,{className:"bg-white dark:bg-gray-800 border-teal-200 dark:border-teal-800",children:[e.jsx(pe,{children:e.jsxs(fe,{className:"text-teal-700 dark:text-teal-300 flex items-center gap-2",children:[e.jsx(nt,{className:"w-5 h-5"}),"Confirmar fechamento"]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-gray-700 dark:text-gray-300",children:["Tem certeza que deseja fechar a comanda ",e.jsx("strong",{children:_?.code||`#${_?.id}`}),"?"]}),_&&e.jsxs("div",{className:"bg-teal-50 dark:bg-teal-900/20 p-3 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("strong",{children:"Total:"})," ",S(_.total||0)]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("strong",{children:"Itens:"})," ",Array.isArray(_.items)?_.items.length:0]})]})]}),e.jsxs(De,{children:[e.jsx(N,{variant:"outline",onClick:()=>C(!1),className:"border-gray-300 dark:border-gray-600",children:"Cancelar"}),e.jsxs(N,{onClick:qe,className:"bg-teal-600 hover:bg-teal-700 text-white",children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Confirmar"]})]})]})}),J&&a&&e.jsx(Ze,{user:a,profileRole:"garcom",onClose:()=>de(!1),onUpdate:t=>{x(t),l.invalidateQueries({queryKey:["Comanda"]})}})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-teal-50 via-emerald-50 to-teal-50 dark:from-teal-950 dark:via-emerald-950 dark:to-teal-950",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-3xl shadow-xl p-8 max-w-md text-center border border-teal-200 dark:border-teal-800",children:[e.jsx(K,{className:"w-16 h-16 text-teal-600 dark:text-teal-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"Acesso restrito"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:"Esta tela Ã© apenas para o perfil GarÃ§om."}),e.jsxs(N,{onClick:()=>L.auth.logout(),className:"bg-teal-600 hover:bg-teal-700 text-white",children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Sair"]})]})})}export{da as default};
