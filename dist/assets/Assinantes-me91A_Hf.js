import{c as Ke,r as f,j as e,a as ee,b as Js,T as Ue,X as qe,L as ue,B as b,A as fs,u as Ts,P as zs,z as k,l as $,d as ge,e as vs,f as cs,g as Ys,R as ds,_ as Zs}from"./main-5wCJ0shd.js";import{u as ss}from"./useQuery-TBRlwA9F.js";import{u as Xe}from"./useMutation-CfjUJVgq.js";import{L as O,I as M}from"./label-BGurCIwA.js";import{D as je,a as fe,b as ve,c as be,d as ms,e as Qe}from"./dialog-BQt4A9EY.js";import{S as te,a as re,b as ie,c as ne,d as T}from"./select-D68HeZiV.js";import{A as Xs,a as ea,b as sa,c as aa,d as ta,e as ra,f as ia,g as na}from"./alert-dialog-CsqCNnx-.js";import{U as la,P as oa,C as Ms,a as He,I as ca,G as da,b as Re,c as ma,R as xa,F as Os,T as Fs,d as Oe,e as Fe,f as Le,E as ua,g as pa,h as ha,L as bs}from"./EmptyState-DwIWL_NX.js";import{t as Ae,D as Ls,a as qs,b as Is,c as xe,d as ys}from"./index-DxdNJ03y.js";import{B as I}from"./badge-tC6tpDVj.js";import{b as H}from"./base44Client-BjweZdup.js";import{v as ga,g as Pe}from"./PlanPresets-DhKoJrBx.js";import{C as Ee,a as Ve,b as $e,c as Ge}from"./card-co3zywKC.js";import{C as ps}from"./circle-check-B4wdpzyW.js";import{C as ja}from"./circle-x-C3c2vtU6.js";import{C as Ie}from"./check-b5qncWl4.js";import{C as fa}from"./index-DJsYT-OT.js";import{C as va}from"./chevron-down-LYt6GC0H.js";import{T as ba,a as ya,b as ye,c as Ne}from"./tabs-DLr74N5K.js";import{T as xs}from"./textarea-BBItVPmi.js";import{S as we}from"./switch-CiXzU0WK.js";import{C as Na}from"./circle-check-big-C21gM6y_.js";import{A as Rs}from"./arrow-left-nPuylZ-_.js";import{D as hs}from"./download-DOPNSAwp.js";import{S as wa}from"./shopping-cart-BukW6CqG.js";import{D as _a}from"./dollar-sign-BdBkW913.js";import{C as Vs}from"./clock-8p17jiPd.js";import{G as Ca}from"./gift-XBKin6Vd.js";import{P as _e}from"./plus-DJfFeu4q.js";import{T as De}from"./trash-2-CxXzmM5w.js";import{C as $s}from"./copy-DcaS5Ul6.js";import{E as ka,a as Sa}from"./eye-CkTGamEz.js";import{g as Aa,U as os,A as Pa}from"./planLimits-Asbb4bbl.js";import{u as Ea}from"./useDebounce-clvhhWu8.js";import{C as es}from"./circle-alert-CSoTi2zi.js";import{T as Da}from"./ThemeToggle-D03lFMdb.js";import{U as Ta}from"./UserAuthButton-BbxpONeD.js";import{U as gs}from"./users-BsPmyBXt.js";import{C as za}from"./chart-column-Da9oBHTD.js";import{T as Ma}from"./trending-up-8OxCq5vE.js";import{t as us}from"./constants-CG7Neo-X.js";import{d as Oa,S as Gs}from"./differenceInCalendarDays-DQNRMz4Z.js";import{P as Fa,a as La,b as qa}from"./popover-BtTeZi4R.js";import{F as Ia}from"./filter-BiXx4-4p.js";import{S as Ra}from"./search-C1Oe3veH.js";import{C as Ns}from"./calendar-Bijjub7E.js";import{C as Va}from"./chevron-left-BxOhQUkW.js";import{C as $a}from"./chevron-right-CodG0qo6.js";import{C as Be}from"./circle-help-BqbVHdsR.js";import{P as ws}from"./phone-DEvhMYo9.js";import"./index-BjH-urEE.js";import"./index-DJGIH_vd.js";import"./index-XPl2RJU8.js";import"./index-DBH5IvqS.js";import"./proxy-CaN4jGBq.js";import"./sun-DNFYo3QJ.js";import"./log-in-DU8-DLrh.js";import"./user-SYMNLJbz.js";import"./power-CLRjBc1X.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ga=[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]],_s=Ke("Building2",Ga);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ba=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]],Ua=Ke("FileJson",Ba);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qa=[["path",{d:"M21 10.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.5",key:"1uzm8b"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Bs=Ke("SquareCheckBig",Qa);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ha=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],Us=Ke("Square",Ha);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ka=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],Cs=Ke("Tag",Ka);function Wa(a){return f.useMemo(()=>{if(!a||typeof a!="object")return{totalModules:0,activeModules:0,totalPermissions:0,permissionsByModule:{},hasPermission:()=>!1};const x={};let l=0,i=0;Object.entries(a).forEach(([c,g])=>{Array.isArray(g)&&g.length>0?(i++,l+=g.length,x[c]={count:g.length,actions:g}):x[c]={count:0,actions:[]}});const u=(c,g)=>{const d=x[c];return!!(d&&Array.isArray(d.actions)&&d.actions.includes(g))};return{totalModules:Object.keys(a).length,activeModules:i,totalPermissions:l,permissionsByModule:x,hasPermission:u}},[a])}const Ja=Js("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Te=f.forwardRef(({className:a,variant:n,...x},l)=>e.jsx("div",{ref:l,role:"alert",className:ee(Ja({variant:n}),a),...x}));Te.displayName="Alert";const Ya=f.forwardRef(({className:a,...n},x)=>e.jsx("h5",{ref:x,className:ee("mb-1 font-medium leading-none tracking-tight",a),...n}));Ya.displayName="AlertTitle";const ze=f.forwardRef(({className:a,...n},x)=>e.jsx("div",{ref:x,className:ee("text-sm [&_p]:leading-relaxed",a),...n}));ze.displayName="AlertDescription";const ks={dashboard:"Dashboard",pdv:"PDV",gestor_pedidos:"Gestor de Pedidos",caixa:"Caixa",whatsapp:"WhatsApp",dishes:"Pratos",pizza_config:"Pizzas",delivery_zones:"Zonas de Entrega",coupons:"Cupons",promotions:"Promo√ß√µes",theme:"Tema",store:"Loja",payments:"Pagamentos",graficos:"Gr√°ficos",orders:"Pedidos",history:"Hist√≥rico",clients:"Clientes",financial:"Financeiro",printer:"Impressora",mais:"Mais Fun√ß√µes"},Za={view:"Ver",create:"Criar",update:"Editar",delete:"Excluir"};function Xa({permissions:a={}}){const n={totalModules:Object.keys(a).length,activeModules:Object.keys(a).filter(i=>a[i]&&Array.isArray(a[i])&&a[i].length>0).length,totalPermissions:Object.values(a).reduce((i,u)=>i+(Array.isArray(u)?u.length:0),0),viewOnly:Object.entries(a).filter(([i,u])=>Array.isArray(u)&&u.length===1&&u.includes("view")).length},x=Object.entries(a).filter(([i,u])=>Array.isArray(u)&&u.length>0).map(([i,u])=>({moduleId:i,moduleName:ks[i]||i,actions:u||[]})),l=Object.entries(a).filter(([i,u])=>!Array.isArray(u)||u.length===0).map(([i])=>({moduleId:i,moduleName:ks[i]||i}));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Ee,{className:"p-4 bg-gradient-to-br from-blue-50 to-purple-50 border-blue-200",children:[e.jsx("h4",{className:"font-semibold text-sm mb-3 flex items-center gap-2",children:"üìä Resumo das Permiss√µes"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:n.activeModules}),e.jsx("div",{className:"text-xs text-gray-600",children:"M√≥dulos Ativos"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:n.totalPermissions}),e.jsx("div",{className:"text-xs text-gray-600",children:"Permiss√µes"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:n.viewOnly}),e.jsx("div",{className:"text-xs text-gray-600",children:"Somente Leitura"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:n.totalModules-n.activeModules}),e.jsx("div",{className:"text-xs text-gray-600",children:"Bloqueados"})]})]})]}),x.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-sm mb-2 flex items-center gap-2",children:[e.jsx(ps,{className:"w-4 h-4 text-green-600"}),"M√≥dulos Acess√≠veis (",x.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:x.map(({moduleId:i,moduleName:u,actions:c})=>e.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-sm text-gray-900",children:u}),e.jsxs(I,{variant:"outline",className:"bg-green-100 text-green-700 border-green-300 text-xs",children:[c.length," permiss√£o",c.length>1?"√µes":""]})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:c.map(g=>e.jsx(I,{variant:"secondary",className:"text-xs bg-green-200 text-green-800",children:Za[g]||g},g))})]},i))})]}),l.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-sm mb-2 flex items-center gap-2",children:[e.jsx(ja,{className:"w-4 h-4 text-red-600"}),"M√≥dulos Bloqueados (",l.length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:l.map(({moduleId:i,moduleName:u})=>e.jsx(I,{variant:"outline",className:"bg-red-50 text-red-700 border-red-200 text-xs",children:u},i))})]}),n.totalPermissions===0&&e.jsxs(Te,{variant:"destructive",children:[e.jsx(Ue,{className:"h-4 w-4"}),e.jsx(ze,{className:"text-sm",children:"‚ö†Ô∏è Nenhuma permiss√£o configurada! O assinante n√£o ter√° acesso a nenhum m√≥dulo."})]}),n.viewOnly===n.activeModules&&n.activeModules>0&&e.jsxs(Te,{children:[e.jsx(Ue,{className:"h-4 w-4"}),e.jsx(ze,{className:"text-sm",children:"‚ÑπÔ∏è Todas as permiss√µes s√£o somente leitura. O assinante poder√° visualizar mas n√£o modificar dados."})]})]})}function et({plans:a=[],currentPlan:n,onSelectPlan:x}){if(a.length<2)return null;const l=[{id:"dashboard",label:"Dashboard",icon:"üìä"},{id:"dishes",label:"Pratos",icon:"üçΩÔ∏è"},{id:"pizza_config",label:"Pizzas",icon:"üçï"},{id:"store",label:"Loja",icon:"üè™"},{id:"orders",label:"Pedidos",icon:"üì¶"},{id:"gestor_pedidos",label:"Gestor Completo",icon:"üöö"},{id:"delivery_zones",label:"Zonas de Entrega",icon:"üìç"},{id:"coupons",label:"Cupons",icon:"üéüÔ∏è"},{id:"promotions",label:"Promo√ß√µes",icon:"üéØ"},{id:"graficos",label:"Relat√≥rios",icon:"üìà"},{id:"financial",label:"Financeiro",icon:"üí∞"},{id:"payments",label:"Pagamentos",icon:"üí≥"},{id:"2fa",label:"2FA",icon:"üîê"},{id:"whatsapp",label:"WhatsApp",icon:"üí¨"},{id:"pdv",label:"PDV",icon:"üñ•Ô∏è"},{id:"caixa",label:"Caixa",icon:"üìã"},{id:"comandas",label:"Comandas",icon:"üßæ"},{id:"tables",label:"Mesas",icon:"ü™ë"}],i=(c,g)=>{const o=(c.permissions||{})[g]||[];return o.length===0?"none":o.length===1&&o[0]==="view"?"view":o.includes("create")||o.includes("update")?"full":"limited"},u=(c,g)=>{switch(i(c,g)){case"none":return e.jsx(qe,{className:"w-4 h-4 text-gray-300"});case"view":return e.jsx(I,{variant:"outline",className:"text-xs bg-gray-100",children:"Ver"});case"limited":return e.jsx(I,{variant:"outline",className:"text-xs bg-blue-100",children:"Limitado"});case"full":return e.jsx(Ie,{className:"w-4 h-4 text-green-600"});default:return e.jsx(qe,{className:"w-4 h-4 text-gray-300"})}};return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ee,{className:"p-4",children:[e.jsx("h4",{className:"font-semibold text-lg mb-4",children:"Compara√ß√£o de Planos"}),e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2 text-sm font-medium text-gray-700",children:"Recurso"}),a.map(c=>e.jsxs("th",{className:ee("text-center p-2 text-sm font-medium cursor-pointer transition-colors",n===c.slug?"bg-blue-100 text-blue-900":"hover:bg-gray-50"),onClick:()=>x?.(c.slug),children:[c.name,n===c.slug&&e.jsx(I,{variant:"secondary",className:"ml-2 text-xs",children:"Atual"})]},c.slug))]})}),e.jsx("tbody",{children:l.map(c=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsxs("td",{className:"p-2 text-sm",children:[e.jsx("span",{className:"mr-2",children:c.icon}),c.label]}),a.map(g=>e.jsx("td",{className:"text-center p-2",children:u(g,c.id)},g.slug))]},c.id))})]})]})})}const Ss=[{id:"gestao",name:"üìä GEST√ÉO",modules:[{id:"dashboard",name:"Dashboard",actions:["view"]},{id:"financial",name:"Financeiro",actions:["view"]},{id:"caixa",name:"Caixa",actions:["view","create","update"]},{id:"pdv",name:"PDV",actions:["view","create","update"]},{id:"gestor_pedidos",name:"Gestor de Pedidos",actions:["view","create","update","delete"]}]},{id:"operacao",name:"üßæ OPERA√á√ÉO",modules:[{id:"orders",name:"Gestor de Pedidos (lista)",actions:["view","create","update","delete"]},{id:"history",name:"Hist√≥rico de Pedidos",actions:["view"]},{id:"clients",name:"Clientes",actions:["view","create","update","delete"]},{id:"whatsapp",name:"WhatsApp",actions:["view"]},{id:"inventory",name:"Gest√£o de Estoque",actions:["view","create","update","delete"]}]},{id:"cardapio",name:"üçΩÔ∏è CARD√ÅPIO",modules:[{id:"dishes",name:"Restaurante (pratos e bebidas)",actions:["view","create","update","delete"]},{id:"pizza_config",name:"Pizzaria",actions:["view","create","update","delete"]},{id:"theme",name:"Tema",actions:["view","update"]},{id:"store",name:"Loja",actions:["view","update"]}]},{id:"garcom",name:"üßë‚Äçüç≥ GAR√áOM",modules:[{id:"garcom",name:"App do Gar√ßom",actions:["view"]},{id:"comandas",name:"Comandas",actions:["view","create","update","close","history"]},{id:"tables",name:"Mesas e QR Code",actions:["view","create","update","delete"]}]},{id:"delivery",name:"üöö DELIVERY",modules:[{id:"delivery_zones",name:"Zonas de Entrega",actions:["view","create","update","delete"]},{id:"payments",name:"M√©todos de Pagamento",actions:["view","update"]}]},{id:"sistema",name:"‚öôÔ∏è SISTEMA",modules:[{id:"printer",name:"Impressora",actions:["view","update"]},{id:"colaboradores",name:"Colaboradores",actions:["view","create","update","delete"]},{id:"2fa",name:"Autentica√ß√£o 2FA",actions:["view","update"]},{id:"lgpd",name:"Conformidade LGPD",actions:["view","update"]}]},{id:"marketing",name:"üí∞ MARKETING",modules:[{id:"promotions",name:"Promo√ß√µes",actions:["view","create","update","delete"]},{id:"coupons",name:"Cupons",actions:["view","create","update","delete"]},{id:"affiliates",name:"Programa de Afiliados",actions:["view","create","update","delete"]}]},{id:"graficos_section",name:"Gr√°ficos",modules:[{id:"graficos",name:"Gr√°ficos",actions:["view"]}]},{id:"mais_funcoes",name:"Mais Fun√ß√µes",modules:[{id:"mais",name:"Mais Fun√ß√µes",actions:["view"]}]}],st={view:"Ver",create:"Criar",update:"Editar",delete:"Excluir"};function As({permissions:a,onChange:n,selectedPlan:x="basic",onPlanChange:l}){const[i,u]=f.useState(new Set(["gestao","operacao","cardapio","garcom","delivery","sistema","marketing"])),[c,g]=f.useState(new Set(["dashboard","dishes","orders","inventory","garcom","tables","affiliates"])),[d,o]=f.useState(!1),[r,C]=f.useState(!1),D=[{id:"free",slug:"free",name:"Gratuito",description:"Plano gratuito para uso pessoal",is_active:!0,order:0},{id:"basic",slug:"basic",name:"B√°sico",description:"Plano b√°sico com funcionalidades essenciais",is_active:!0,order:1},{id:"pro",slug:"pro",name:"Pro",description:"Plano profissional com recursos avan√ßados",is_active:!0,order:2},{id:"ultra",slug:"ultra",name:"Ultra",description:"Plano ultra com todos os recursos",is_active:!0,order:3}],{data:p=D,isLoading:v}=ss({queryKey:["plans"],queryFn:async()=>{try{const w=await H.entities.Plan.list("order"),E=Array.isArray(w)?w.filter(P=>P.is_active!==!1):[];return console.log("üìã Planos carregados do banco:",E.length,E),E.length===0?(console.log("‚ö†Ô∏è Nenhum plano no banco, retornando planos padr√£o (PermissionsEditor)"),D):E}catch(w){return console.error("‚ùå Erro ao carregar planos:",w),D}},initialData:D,retry:1,staleTime:300*1e3}),A=x||"basic",j=f.useMemo(()=>{const w=p.find(E=>E.slug===A);return console.log("üîç PermissionsEditor - selectedPlanData:",w,"currentPlan:",A,"plans:",p),w},[p,A]),y=f.useMemo(()=>{if(A==="custom")return"Personalizado";const w=j?.name||A.charAt(0).toUpperCase()+A.slice(1);return console.log("üè∑Ô∏è PermissionsEditor - displayName:",w,"currentPlan:",A),w},[A,j]),F=ga(a),U=(a?.pizza_config?.length||0)>0?"pizzas":"pratos",V=w=>{if(l&&l(w),w==="custom")return;const E={...Pe(w)||{},store:["view","update"]};n(E)},Z=w=>{const E={...a,store:a?.store?.length?a.store:["view","update"]};w==="pizzas"?(E.pizza_config=["view","create","update","delete"],E.dishes=[]):(E.pizza_config=[],E.dishes=["view","create","update","delete"]),n(E)},Q=w=>{u(E=>{const P=new Set(E);return P.has(w)?P.delete(w):P.add(w),P})},B=w=>{g(E=>{const P=new Set(E);return P.has(w)?P.delete(w):P.add(w),P})},K=w=>{const E=Ss.find(z=>z.id===w);if(!E)return;const P=E.modules.map(z=>z.id),G=P.some(z=>a?.[z]?.length>0),L={...a};G?P.forEach(z=>{L[z]=[]}):E.modules.forEach(z=>{L[z.id]=[...z.actions]}),n(L)},se=(w,E)=>{const P=a?.[w]||[],G=E.every(z=>P.includes(z)),L={...a};G?L[w]=[]:L[w]=[...E],n(L)},ce=(w,E,P)=>{const G={...a},L=G[w]||[];P?L.includes(E)||(G[w]=[...L,E]):G[w]=L.filter(z=>z!==E),n(G)},de=Wa(a),le=(w,E)=>de.hasPermission(w,E);return v?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(ue,{className:"w-6 h-6 animate-spin text-orange-500"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(O,{className:"mb-1 block",children:"Plano"}),e.jsxs(te,{value:A,onValueChange:V,children:[e.jsx(re,{className:"w-full",children:e.jsx(ie,{placeholder:"Selecione um plano",children:y})}),e.jsxs(ne,{children:[(p||[]).map(w=>e.jsx(T,{value:w.slug,children:w.name},w.id||w.slug)),e.jsx(T,{value:"custom",children:"Personalizado"})]})]},A)]}),A==="basic"&&e.jsxs("div",{className:"flex flex-col gap-2 p-3 rounded-lg bg-amber-50 dark:bg-amber-950/30 border border-amber-200 dark:border-amber-800",children:[e.jsx(O,{className:"text-sm font-medium",children:"Plano B√°sico: tipo de estabelecimento"}),e.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-400",children:["No plano B√°sico o card√°pio √© apenas ",e.jsx("strong",{children:"Restaurante (pratos)"})," ou ",e.jsx("strong",{children:"Pizzaria (pizzas)"}),". Nos planos Pro e Ultra os dois est√£o dispon√≠veis."]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(b,{type:"button",size:"sm",variant:U==="pratos"?"default":"outline",className:U==="pratos"?"bg-orange-500 hover:bg-orange-600":"",onClick:()=>Z("pratos"),children:[e.jsx(la,{className:"w-4 h-4 mr-1"})," Restaurante (pratos)"]}),e.jsxs(b,{type:"button",size:"sm",variant:U==="pizzas"?"default":"outline",className:U==="pizzas"?"bg-orange-500 hover:bg-orange-600":"",onClick:()=>Z("pizzas"),children:[e.jsx(oa,{className:"w-4 h-4 mr-1"})," Pizzaria (pizzas)"]})]})]}),F.length>0&&e.jsxs(Te,{variant:"destructive",className:"py-2",children:[e.jsx(Ue,{className:"h-4 w-4"}),e.jsx(ze,{children:e.jsx("ul",{className:"list-disc list-inside text-sm",children:F.map((w,E)=>e.jsx("li",{children:w.message},E))})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(O,{children:"M√≥dulos"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(b,{type:"button",variant:"ghost",size:"sm",onClick:()=>C(!r),children:[r?e.jsx(fa,{className:"w-4 h-4"}):e.jsx(va,{className:"w-4 h-4"})," Resumo"]}),p.length>=2&&A!=="custom"&&e.jsxs(b,{type:"button",variant:"ghost",size:"sm",onClick:()=>o(!d),children:[d?"Ocultar":"Comparar"," planos"]})]})]}),r&&e.jsx("div",{className:"mb-3 p-3 rounded-lg border bg-gray-50",children:e.jsx(Xa,{permissions:a})}),d&&p.length>=2&&A!=="custom"&&e.jsx("div",{className:"mb-3",children:e.jsx(et,{plans:p.map(w=>({...w,permissions:w.permissions||Pe(w.slug)})),currentPlan:A,onSelectPlan:V})}),e.jsx("div",{className:"border rounded-lg divide-y",children:Ss.map(w=>{const E=i.has(w.id);return e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer flex-1",onClick:()=>Q(w.id),children:[e.jsx("span",{className:`transform transition-transform ${E?"rotate-90":""}`,children:"‚ñ∏"}),e.jsx("span",{className:"font-bold text-base",children:w.name})]}),e.jsx("button",{onClick:P=>{P.stopPropagation(),K(w.id)},className:"px-3 py-1 rounded-lg text-sm font-medium transition-colors hover:bg-gray-100",children:w.modules.some(P=>a?.[P.id]?.length>0)?"üîì Ativo":"üîí Inativo"})]}),E&&e.jsx("div",{className:"ml-6 space-y-3 mt-3",children:w.modules.map(P=>{const G=c.has(P.id),L=a?.[P.id]||[];return e.jsxs("div",{className:"border-l-2 border-gray-200 pl-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer flex-1",onClick:z=>{z.stopPropagation(),B(P.id)},children:[e.jsx("span",{className:`transform transition-transform ${G?"rotate-90":""}`,children:"‚ñ∏"}),e.jsx("span",{className:"font-medium",children:P.name}),L.length>0&&e.jsxs(I,{variant:"outline",className:"text-xs bg-green-50 text-green-700",children:[L.length," ativa",L.length===1?"":"s"]})]}),e.jsx("button",{onClick:z=>{z.stopPropagation(),se(P.id,P.actions)},className:"px-2 py-1 rounded text-xs font-medium transition-colors hover:bg-gray-100",children:L.length===P.actions.length?"üîì":"üîí"})]}),G&&e.jsx("div",{className:"mt-3 ml-6 space-y-2",children:P.actions.map(z=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded",children:[e.jsx(Ms,{checked:!!le(P.id,z),onCheckedChange:he=>ce(P.id,z,he)}),e.jsx("span",{className:"text-sm",children:st[z]})]},z))})]},P.id)})})]},w.id)})})]})]})}function at({isOpen:a,onClose:n,onSubmit:x,combo:l,dishes:i=[]}){const u=Array.isArray(i)?i:[],[c,g]=f.useState(l||{name:"",description:"",image:"",type:"bundle_discount",dishes:[],original_price:0,combo_price:0,discount_type:"percentage",discount_value:0,buy_quantity:3,pay_quantity:2,is_active:!0,is_highlight:!1,valid_until:""}),d=p=>{p.preventDefault(),x(c)},o=p=>{if(!u.find(j=>j.id===p))return;const A=c.dishes.find(j=>j.dish_id===p);g(A?j=>({...j,dishes:j.dishes.map(y=>y.dish_id===p?{...y,quantity:y.quantity+1}:y)}):j=>({...j,dishes:[...j.dishes,{dish_id:p,quantity:1}]})),C(c.dishes,p)},r=p=>{g(v=>({...v,dishes:v.dishes.filter(A=>A.dish_id!==p)}))},C=(p,v=null)=>{const j=(v?[...p,{dish_id:v,quantity:1}]:p).reduce((y,F)=>{const U=u.find(V=>V.id===F.dish_id);return y+(U?.price||0)*F.quantity},0);g(y=>({...y,original_price:j}))},D=p=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(p||0);return e.jsx(je,{open:a,onOpenChange:n,children:e.jsxs(fe,{className:"sm:max-w-3xl max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsx(ve,{children:e.jsx(be,{children:l?"Editar Combo":"Criar Combo"})}),e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(O,{children:"Nome do Combo *"}),e.jsx(M,{value:c.name,onChange:p=>g(v=>({...v,name:p.target.value})),placeholder:"Ex: Combo Executivo",required:!0})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(O,{children:"Tipo de Combo *"}),e.jsxs(te,{value:c.type,onValueChange:p=>g(v=>({...v,type:p})),children:[e.jsx(re,{children:e.jsx(ie,{})}),e.jsxs(ne,{children:[e.jsx(T,{value:"bundle_discount",children:"üéÅ Desconto no Combo"}),e.jsx(T,{value:"buy_x_pay_y",children:"üî• Leve X Pague Y"}),e.jsx(T,{value:"percentage_off",children:"üí∞ Percentual de Desconto"}),e.jsx(T,{value:"fixed_discount",children:"üíµ Desconto Fixo"})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[c.type==="bundle_discount"&&"Junte pratos e ofere√ßa por um pre√ßo especial",c.type==="buy_x_pay_y"&&"Leve mais, pague menos (ex: Leve 3, Pague 2)",c.type==="percentage_off"&&"Desconto em % sobre o total",c.type==="fixed_discount"&&"Desconto em R$ sobre o total"]})]})]}),e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[e.jsx(O,{className:"mb-3 block",children:"Pratos do Combo *"}),e.jsxs(te,{onValueChange:o,children:[e.jsx(re,{children:e.jsx(ie,{placeholder:"Adicionar prato ao combo"})}),e.jsx(ne,{children:u.filter(p=>p.is_active!==!1).map(p=>e.jsxs(T,{value:p.id,children:[p.name," - ",D(p.price)]},p.id))})]}),e.jsx("div",{className:"mt-3 space-y-2",children:c.dishes.map(p=>{const v=u.find(A=>A.id===p.dish_id);return v?e.jsxs("div",{className:"flex items-center justify-between bg-white p-2 rounded border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[v.image&&e.jsx("img",{src:v.image,alt:"",className:"w-10 h-10 rounded object-cover"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:v.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[D(v.price)," x ",p.quantity]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{type:"button",size:"sm",variant:"outline",onClick:()=>g(A=>({...A,dishes:A.dishes.map(j=>j.dish_id===p.dish_id?{...j,quantity:Math.max(1,j.quantity-1)}:j)})),children:"-"}),e.jsx("span",{className:"w-8 text-center",children:p.quantity}),e.jsx(b,{type:"button",size:"sm",variant:"outline",onClick:()=>g(A=>({...A,dishes:A.dishes.map(j=>j.dish_id===p.dish_id?{...j,quantity:j.quantity+1}:j)})),children:"+"}),e.jsx(b,{type:"button",size:"sm",variant:"ghost",onClick:()=>r(p.dish_id),children:e.jsx(qe,{className:"w-4 h-4 text-red-500"})})]})]},p.dish_id):null})})]}),c.type==="buy_x_pay_y"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(O,{children:"Leve (quantidade)"}),e.jsx(M,{type:"number",min:"2",value:c.buy_quantity,onChange:p=>g(v=>({...v,buy_quantity:parseInt(p.target.value)||2}))})]}),e.jsxs("div",{children:[e.jsx(O,{children:"Pague (quantidade)"}),e.jsx(M,{type:"number",min:"1",value:c.pay_quantity,onChange:p=>g(v=>({...v,pay_quantity:parseInt(p.target.value)||1}))})]})]}),(c.type==="percentage_off"||c.type==="fixed_discount")&&e.jsxs("div",{children:[e.jsx(O,{children:"Valor do Desconto"}),e.jsx(M,{type:"number",step:"0.01",value:c.discount_value,onChange:p=>g(v=>({...v,discount_value:parseFloat(p.target.value)||0})),placeholder:c.type==="percentage_off"?"Ex: 20 (para 20%)":"Ex: 10.00"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(O,{children:"Pre√ßo Original (autom√°tico)"}),e.jsx(M,{type:"number",step:"0.01",value:c.original_price,onChange:p=>g(v=>({...v,original_price:parseFloat(p.target.value)||0}))})]}),e.jsxs("div",{children:[e.jsx(O,{children:"Pre√ßo do Combo *"}),e.jsx(M,{type:"number",step:"0.01",value:c.combo_price,onChange:p=>g(v=>({...v,combo_price:parseFloat(p.target.value)||0})),required:!0})]})]}),e.jsxs("div",{children:[e.jsx(O,{children:"Descri√ß√£o"}),e.jsx(xs,{value:c.description,onChange:p=>g(v=>({...v,description:p.target.value})),rows:2,placeholder:"Descreva o combo..."})]}),e.jsxs("div",{children:[e.jsx(O,{children:"V√°lido at√©"}),e.jsx(M,{type:"date",value:c.valid_until,onChange:p=>g(v=>({...v,valid_until:p.target.value}))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded",children:[e.jsx(O,{children:"Destacar no card√°pio"}),e.jsx(we,{checked:c.is_highlight,onCheckedChange:p=>g(v=>({...v,is_highlight:p}))})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(b,{type:"button",variant:"outline",onClick:n,className:"flex-1",children:"Cancelar"}),e.jsx(b,{type:"submit",className:"flex-1 bg-orange-500",children:l?"Salvar":"Criar Combo"})]})]})]})})}function tt({open:a,onOpenChange:n,onSuccess:x}){const[l,i]=f.useState(null),[u,c]=f.useState(null),[g,d]=f.useState(null),[o,r]=f.useState(!1),[C,D]=f.useState("merge"),p=j=>{j||(i(null),c(null),d(null),r(!1)),n(j)},v=async j=>{const y=j.target.files?.[0];if(y){if(!y.name.endsWith(".json")){Ae.error("Arquivo inv√°lido. Selecione um arquivo .json");return}i(y),d(null),c(null);try{const F=await y.text(),U=JSON.parse(F);c(U);const V=await fs.post("/subscriber-backup/validate",{backupData:U});d(V.data),V.data.valid?Ae.success("Arquivo validado com sucesso!"):Ae.error(V.data.error||"Arquivo de backup inv√°lido")}catch(F){Ae.error("Erro ao ler arquivo: "+(F.message||"Arquivo JSON inv√°lido")),i(null),c(null)}}},A=async()=>{if(!u||!g?.valid){Ae.error("Selecione um arquivo v√°lido primeiro");return}r(!0);try{const j=await fs.post("/subscriber-backup/import",{backupData:u,mode:C}),{results:y}=j.data;Ae.success(`Importa√ß√£o conclu√≠da! ${y.dishes.created+y.dishes.updated} pratos, ${y.categories.created+y.categories.updated} categorias.`,{duration:5e3}),x&&x(y),p(!1)}catch(j){Ae.error("Erro ao importar: "+(j.response?.data?.error||j.message))}finally{r(!1)}};return e.jsx(je,{open:a,onOpenChange:p,children:e.jsxs(fe,{className:"sm:max-w-[600px] max-w-[95vw]",children:[e.jsxs(ve,{children:[e.jsxs(be,{className:"flex items-center gap-2",children:[e.jsx(He,{className:"w-5 h-5"}),"Importar Backup"]}),e.jsx(ms,{children:"Restaure seus pratos, categorias, complementos e configura√ß√µes a partir de um arquivo de backup."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"backup-file",className:"block text-sm font-medium",children:"Selecionar arquivo de backup (.json)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(b,{variant:"outline",onClick:()=>document.getElementById("backup-file").click(),className:"w-full",children:[e.jsx(Ua,{className:"w-4 h-4 mr-2"}),l?l.name:"Escolher arquivo"]}),e.jsx("input",{id:"backup-file",type:"file",accept:".json",onChange:v,className:"hidden"})]})]}),g&&e.jsxs(Te,{variant:g.valid?"default":"destructive",children:[e.jsx(Ue,{className:"w-4 h-4"}),e.jsx(ze,{children:g.valid?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium",children:"‚úÖ Arquivo v√°lido!"}),e.jsxs("ul",{className:"text-sm space-y-1",children:[e.jsxs("li",{children:["üìÇ ",g.stats.categories," categorias"]}),e.jsxs("li",{children:["üçΩÔ∏è ",g.stats.dishes," pratos"]}),e.jsxs("li",{children:["üçî ",g.stats.complement_groups," grupos de complementos"]}),g.stats.has_store&&e.jsx("li",{children:"üè™ Configura√ß√µes da loja"})]}),g.warnings.length>0&&e.jsxs("div",{className:"mt-2 p-2 bg-yellow-50 dark:bg-yellow-900/20 rounded",children:[e.jsx("p",{className:"text-xs font-medium mb-1",children:"‚ö†Ô∏è Avisos:"}),e.jsx("ul",{className:"text-xs space-y-1",children:g.warnings.map((j,y)=>e.jsxs("li",{children:["‚Ä¢ ",j]},y))})]})]}):e.jsx("p",{children:g.error||"Arquivo inv√°lido"})})]}),g?.valid&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Modo de importa√ß√£o"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(b,{variant:C==="merge"?"default":"outline",onClick:()=>D("merge"),className:"justify-start",children:[e.jsx(Na,{className:"w-4 h-4 mr-2"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"Mesclar"}),e.jsx("div",{className:"text-xs opacity-70",children:"Adiciona novos dados"})]})]}),e.jsxs(b,{variant:C==="replace"?"default":"outline",onClick:()=>D("replace"),className:"justify-start",children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"Substituir"}),e.jsx("div",{className:"text-xs opacity-70",children:"Sempre cria novos"})]})]})]}),e.jsxs(Te,{children:[e.jsx(ca,{className:"w-4 h-4"}),e.jsx(ze,{className:"text-xs",children:C==="merge"?"‚úÖ Dados existentes ser√£o mantidos. Novos itens ser√£o adicionados e itens com mesmo ID ser√£o atualizados.":"‚ö†Ô∏è Todos os itens do backup ser√£o criados como novos, mesmo que j√° existam similares."})]})]})]}),e.jsxs(Qe,{children:[e.jsx(b,{variant:"outline",onClick:()=>p(!1),disabled:o,children:"Cancelar"}),e.jsx(b,{onClick:A,disabled:!g?.valid||o,children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Importando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"w-4 h-4 mr-2"}),"Importar"]})})]})]})})}function rt({subscriber:a,onBack:n}){const x=Ts(),[l,i]=f.useState(!1),[u,c]=f.useState(null),[g,d]=f.useState(!1),[o,r]=f.useState(null),[C,D]=f.useState(!1),[p,v]=f.useState({name:"",category_id:"",price:"",original_price:"",description:"",is_active:!0,complement_groups:[],stock:"",portion:"",is_highlight:!1,is_new:!1,is_popular:!1,prep_time:"",internal_notes:""}),[A,j]=f.useState(!1),[y,F]=f.useState(!1),[U,V]=f.useState(!1),[Z,Q]=f.useState(null),[B,K]=f.useState(!1),[se,ce]=f.useState(null),[de,le]=f.useState({name:"",is_required:!1,max_selection:1}),[w,E]=f.useState(!1),[P,G]=f.useState(null),[L,z]=f.useState({group_id:"",name:"",price:"",is_active:!0}),{data:he,isLoading:ae}=ss({queryKey:["subscriberProfile",a.email],queryFn:async()=>await H.functions.invoke("getFullSubscriberProfile",{subscriber_email:a.email}),enabled:!!a.email});if(ae)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ue,{className:"w-8 h-8 animate-spin text-gray-400"})});if(!he)return e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"Erro ao carregar dados do assinante"})});const{data:_={},stats:Ce={}}=he,J={as_subscriber:a.email},oe=()=>x.invalidateQueries({queryKey:["subscriberProfile",a.email]}),Me=async t=>{j(!0);try{u?(await H.entities.Category.update(u.id,t,J),k.success("Categoria atualizada")):(await H.entities.Category.create({...t,as_subscriber:a.email}),k.success("Categoria criada")),oe(),i(!1),c(null)}catch(m){k.error(m?.message||"Erro ao salvar categoria")}finally{j(!1)}},ke=async t=>{if(window.confirm(`Excluir a categoria "${t.name}"?`))try{await H.entities.Category.delete(t.id,J),k.success("Categoria exclu√≠da"),oe()}catch(m){k.error(m?.message||"Erro ao excluir")}},We=async t=>{j(!0);try{const m={name:t.name,category_id:t.category_id||null,price:parseFloat(t.price)||0,original_price:t.original_price?parseFloat(t.original_price):void 0,description:t.description||"",is_active:t.is_active!==!1,complement_groups:Array.isArray(t.complement_groups)?t.complement_groups:[],stock:t.stock===""||t.stock==null?void 0:t.stock,portion:t.portion||void 0,is_highlight:!!t.is_highlight,is_new:!!t.is_new,is_popular:!!t.is_popular,prep_time:t.prep_time||void 0,internal_notes:t.internal_notes||void 0};o?(await H.entities.Dish.update(o.id,m,J),k.success("Prato atualizado")):(await H.entities.Dish.create({...m,as_subscriber:a.email}),k.success("Prato criado")),oe(),d(!1),r(null)}catch(m){k.error(m?.message||"Erro ao salvar prato")}finally{j(!1)}},Je=async t=>{if(window.confirm(`Excluir o prato "${t.name}"?`))try{await H.entities.Dish.delete(t.id,J),k.success("Prato exclu√≠do"),oe()}catch(m){k.error(m?.message||"Erro ao excluir")}},as=async()=>{j(!0);try{const t={name:de.name.trim(),is_required:!!de.is_required,max_selection:Math.max(1,parseInt(de.max_selection,10)||1),options:se?se.options||[]:[],order:se!=null?se.order??(_.complement_groups||[]).length:(_.complement_groups||[]).length};se?(await H.entities.ComplementGroup.update(se.id,t,J),k.success("Grupo atualizado")):(await H.entities.ComplementGroup.create({...t,as_subscriber:a.email}),k.success("Grupo criado")),oe(),K(!1),ce(null),le({name:"",is_required:!1,max_selection:1})}catch(t){k.error(t?.message||"Erro ao salvar grupo")}finally{j(!1)}},ts=async t=>{if(window.confirm(`Excluir o grupo "${t.name}" e suas op√ß√µes?`))try{await H.entities.ComplementGroup.delete(t.id,J),k.success("Grupo exclu√≠do"),oe()}catch(m){k.error(m?.message||"Erro ao excluir")}},Se=async()=>{j(!0);try{const t=_.complement_groups||[];if(P){const m=t.find(R=>String(R.id)===String(P.groupId));if(!m){k.error("Grupo n√£o encontrado");return}const X=(m.options||[]).map(R=>String(R.id)===String(P.optionId)?{...R,name:L.name.trim(),price:parseFloat(L.price)||0,is_active:L.is_active!==!1}:R);await H.entities.ComplementGroup.update(m.id,{options:X},J),k.success("Complemento atualizado")}else{const m=t.find(W=>String(W.id)===String(L.group_id));if(!m){k.error("Selecione um grupo");return}const X={id:Date.now().toString(),name:L.name.trim(),price:parseFloat(L.price)||0,is_active:!0},R=[...m.options||[],X];await H.entities.ComplementGroup.update(m.id,{options:R},J),k.success("Complemento criado")}oe(),E(!1),G(null),z({group_id:"",name:"",price:"",is_active:!0})}catch(t){k.error(t?.message||"Erro ao salvar complemento")}finally{j(!1)}},Ye=async(t,m,X)=>{if(window.confirm(`Excluir o complemento "${X}"?`))try{const R=(_.complement_groups||[]).find(s=>String(s.id)===String(t));if(!R)return;const W=(R.options||[]).filter(s=>String(s.id)!==String(m));await H.entities.ComplementGroup.update(R.id,{options:W},J),k.success("Complemento exclu√≠do"),oe()}catch(R){k.error(R?.message||"Erro ao excluir")}},rs=async t=>{j(!0);try{for(const m of t.categories||[])await H.entities.Category.update(m.id,{order:m.order},J);for(const m of t.dishes||[]){const X={order:m.order};Array.isArray(m.complement_groups)&&(X.complement_groups=m.complement_groups),await H.entities.Dish.update(m.id,X,J)}for(const m of t.groups||[])await H.entities.ComplementGroup.update(m.id,{order:m.order},J);for(const[m,X]of Object.entries(t.groupOptions||{})){const R=(_.complement_groups||[]).find(W=>String(W.id)===String(m));R&&await H.entities.ComplementGroup.update(m,{...R,options:X},J)}k.success("Ordem atualizada"),F(!1),oe()}catch(m){k.error(m?.message||"Erro ao reordenar")}finally{j(!1)}},is=async t=>{j(!0);try{Z?(await H.entities.Combo.update(Z.id,t,J),k.success("Combo atualizado")):(await H.entities.Combo.create({...t,as_subscriber:a.email}),k.success("Combo criado")),oe(),V(!1),Q(null)}catch(m){k.error(m?.message||"Erro ao salvar combo")}finally{j(!1)}},Ze=async t=>{if(window.confirm(`Excluir o combo "${t.name}"?`))try{await H.entities.Combo.delete(t.id,J),k.success("Combo exclu√≠do"),oe()}catch(m){k.error(m?.message||"Erro ao excluir")}},pe=t=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t||0),ns=()=>{if(!he)return;const t={subscriber:{...a,plan:a.plan,permissions:a.permissions||{},status:a.status,expires_at:a.expires_at},data:{dishes:_.dishes||[],categories:_.categories||[],complement_groups:_.complement_groups||[],combos:_.combos||[],orders:_.orders||[],caixas:_.caixas||[],store:_.store||null},stats:Ce||{},exported_at:new Date().toISOString(),exported_by:"admin"},m=JSON.stringify(t,null,2),X=new Blob([m],{type:"application/json"}),R=window.URL.createObjectURL(X),W=document.createElement("a");W.href=R;const s=new Date().toISOString().split("T")[0];W.download=`backup-${a.email}-${s}.json`,W.click(),window.URL.revokeObjectURL(R)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(b,{variant:"ghost",size:"icon",onClick:n,children:e.jsx(Rs,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-2xl font-bold",children:a.name}),e.jsx("p",{className:"text-gray-500",children:a.email})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(b,{variant:"outline",onClick:ns,children:[e.jsx(hs,{className:"w-4 h-4 mr-2"}),"Exportar Backup"]}),e.jsxs(b,{variant:"outline",onClick:()=>D(!0),children:[e.jsx(He,{className:"w-4 h-4 mr-2"}),"Importar Backup"]}),e.jsx(I,{className:a.status==="active"?"bg-green-500":a.status==="expired"?"bg-red-500":"bg-yellow-500",children:a.status})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(Ee,{children:[e.jsxs(Ve,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx($e,{className:"text-sm font-medium",children:"Pratos"}),e.jsx(zs,{className:"w-4 h-4 text-gray-500"})]}),e.jsx(Ge,{children:e.jsx("div",{className:"text-2xl font-bold",children:Ce.total_dishes})})]}),e.jsxs(Ee,{children:[e.jsxs(Ve,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx($e,{className:"text-sm font-medium",children:"Pedidos"}),e.jsx(wa,{className:"w-4 h-4 text-gray-500"})]}),e.jsx(Ge,{children:e.jsx("div",{className:"text-2xl font-bold",children:Ce.total_orders})})]}),e.jsxs(Ee,{children:[e.jsxs(Ve,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx($e,{className:"text-sm font-medium",children:"Faturamento"}),e.jsx(_a,{className:"w-4 h-4 text-gray-500"})]}),e.jsx(Ge,{children:e.jsx("div",{className:"text-2xl font-bold",children:pe(Ce.total_revenue)})})]}),e.jsxs(Ee,{children:[e.jsxs(Ve,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx($e,{className:"text-sm font-medium",children:"Caixas Abertos"}),e.jsx(Vs,{className:"w-4 h-4 text-gray-500"})]}),e.jsx(Ge,{children:e.jsx("div",{className:"text-2xl font-bold",children:Ce.active_caixas})})]})]}),e.jsxs(ba,{defaultValue:"dishes",className:"w-full",children:[e.jsxs(ya,{children:[e.jsxs(ye,{value:"dishes",children:["Pratos (",(_.dishes||[]).length,")"]}),e.jsxs(ye,{value:"categories",children:["Categorias (",(_.categories||[]).length,")"]}),e.jsxs(ye,{value:"groups",children:["Grupos de Complementos (",(_.complement_groups||[]).length,")"]}),e.jsxs(ye,{value:"complements",children:["Complementos (",(_.complement_groups||[]).reduce((t,m)=>t+(m.options||[]).length,0),")"]}),e.jsxs(ye,{value:"combos",children:["Combos (",(_.combos||[]).length,")"]}),e.jsxs(ye,{value:"orders",children:["Pedidos (",(_.orders||[]).length,")"]}),e.jsx(ye,{value:"store",children:"Loja"}),e.jsxs(ye,{value:"caixas",children:["Caixas (",(_.caixas||[]).length,")"]})]}),e.jsxs(Ne,{value:"dishes",className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2",children:[e.jsxs(b,{variant:"outline",size:"sm",onClick:()=>F(!0),children:[e.jsx(da,{className:"w-4 h-4 mr-2"}),"Reordenar"]}),e.jsxs(b,{variant:"outline",size:"sm",onClick:()=>{Q(null),V(!0)},children:[e.jsx(Ca,{className:"w-4 h-4 mr-2"}),"Criar combo"]}),e.jsxs(b,{size:"sm",onClick:()=>{r(null),v({name:"",category_id:_.categories&&_.categories[0]?.id||"",price:"",original_price:"",description:"",is_active:!0,complement_groups:[],stock:"",portion:"",is_highlight:!1,is_new:!1,is_popular:!1,prep_time:"",internal_notes:""}),d(!0)},children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Adicionar prato"]})]}),e.jsx("div",{className:"bg-white rounded-lg border overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Nome"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Categoria"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Pre√ßo"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Complementos"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-gray-700",children:"A√ß√µes"})]})}),e.jsx("tbody",{className:"divide-y",children:(Array.isArray(_?.dishes)?_.dishes:[]).map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:t.name}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:(_.categories||[]).find(m=>m.id===t.category_id)?.name||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:pe(t.price)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:(t.complement_groups||[]).length}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx(I,{variant:t.is_active!==!1?"default":"secondary",children:t.is_active!==!1?"Ativo":"Inativo"})}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx(b,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{r(t),v({name:t.name,category_id:t.category_id||"",price:t.price??"",original_price:t.original_price??"",description:t.description||"",is_active:t.is_active!==!1,complement_groups:(t.complement_groups||[]).map(m=>({group_id:m.group_id,is_required:!!m.is_required})),stock:t.stock??"",portion:t.portion||"",is_highlight:!!t.is_highlight,is_new:!!t.is_new,is_popular:!!t.is_popular,prep_time:t.prep_time??"",internal_notes:t.internal_notes||""}),d(!0)},children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsx(b,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-600",onClick:()=>Je(t),children:e.jsx(De,{className:"w-4 h-4"})})]})]},t.id))})]})})]}),e.jsxs(Ne,{value:"categories",className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(b,{size:"sm",onClick:()=>{c(null),i(!0)},children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Adicionar categoria"]})}),e.jsx("div",{className:"bg-white rounded-lg border",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Nome"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Ordem"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-gray-700",children:"A√ß√µes"})]})}),e.jsx("tbody",{className:"divide-y",children:(Array.isArray(_?.categories)?_.categories:[]).map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:t.name}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:t.order??"-"}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx(b,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{c(t),i(!0)},children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsx(b,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-600",onClick:()=>ke(t),children:e.jsx(De,{className:"w-4 h-4"})})]})]},t.id))})]})})]}),e.jsxs(Ne,{value:"groups",className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(b,{size:"sm",onClick:()=>{ce(null),le({name:"",is_required:!1,max_selection:1}),K(!0)},children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Adicionar grupo"]})}),e.jsx("div",{className:"bg-white rounded-lg border",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Nome"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Obrigat√≥rio"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"M√°x. sele√ß√£o"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Op√ß√µes"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-gray-700",children:"A√ß√µes"})]})}),e.jsx("tbody",{className:"divide-y",children:(Array.isArray(_?.complement_groups)?_.complement_groups:[]).map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:t.name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.is_required?"Sim":"N√£o"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.max_selection??1}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:(t.options||[]).length}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx(b,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{ce(t),le({name:t.name||"",is_required:!!t.is_required,max_selection:t.max_selection??1}),K(!0)},children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsx(b,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-600",onClick:()=>ts(t),children:e.jsx(De,{className:"w-4 h-4"})})]})]},t.id))})]})})]}),e.jsxs(Ne,{value:"complements",className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(b,{size:"sm",disabled:(_.complement_groups||[]).length===0,onClick:()=>{G(null),z({group_id:_.complement_groups&&_.complement_groups[0]?.id||"",name:"",price:"",is_active:!0}),E(!0)},title:(_.complement_groups||[]).length===0?"Crie primeiro um grupo na aba Grupos de Complementos":"",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Adicionar complemento"]})}),e.jsxs("div",{className:"bg-white rounded-lg border",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Grupo"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Nome"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Pre√ßo"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-gray-700",children:"A√ß√µes"})]})}),e.jsx("tbody",{className:"divide-y",children:(Array.isArray(_?.complement_groups)?_.complement_groups:[]).flatMap(t=>(t.options||[]).map(m=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:t.name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:m.name}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:pe(m.price)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx(I,{variant:m.is_active!==!1?"default":"secondary",children:m.is_active!==!1?"Ativo":"Inativo"})}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx(b,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{G({optionId:m.id,groupId:t.id}),z({group_id:t.id,name:m.name||"",price:m.price??"",is_active:m.is_active!==!1}),E(!0)},children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsx(b,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-600",onClick:()=>Ye(t.id,m.id,m.name),children:e.jsx(De,{className:"w-4 h-4"})})]})]},`${t.id}-${m.id}`)))})]}),(_.complement_groups||[]).reduce((t,m)=>t+(m.options||[]).length,0)===0&&e.jsx("div",{className:"px-4 py-8 text-center text-gray-500",children:"Nenhum complemento cadastrado. Crie grupos e adicione op√ß√µes na aba Grupos de Complementos."})]})]}),e.jsxs(Ne,{value:"combos",className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(b,{size:"sm",onClick:()=>{Q(null),V(!0)},children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Adicionar combo"]})}),e.jsxs("div",{className:"bg-white rounded-lg border",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Nome"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Tipo"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Pre√ßo"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-gray-700",children:"A√ß√µes"})]})}),e.jsx("tbody",{className:"divide-y",children:(Array.isArray(_?.combos)?_.combos:[]).map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:t.name}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:t.type||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:pe(t.combo_price)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx(I,{variant:t.is_active!==!1?"default":"secondary",children:t.is_active!==!1?"Ativo":"Inativo"})}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx(b,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{Q(t),V(!0)},children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsx(b,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-600",onClick:()=>Ze(t),children:e.jsx(De,{className:"w-4 h-4"})})]})]},t.id))})]}),(_.combos||[]).length===0&&e.jsx("div",{className:"px-4 py-8 text-center text-gray-500",children:'Nenhum combo. Use "Criar combo" em Promo√ß√µes.'})]})]}),e.jsx(Ne,{value:"orders",className:"space-y-4",children:e.jsx("div",{className:"bg-white rounded-lg border",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"C√≥digo"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Cliente"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Data"})]})}),e.jsx("tbody",{className:"divide-y",children:_.orders.slice(0,50).map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:t.order_code}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.customer_name}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:pe(t.total)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx(I,{children:t.status})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:new Date(t.created_date).toLocaleDateString("pt-BR")})]},t.id))})]})})}),e.jsx(Ne,{value:"store",children:_.store?e.jsxs(Ee,{children:[e.jsx(Ve,{children:e.jsx($e,{children:"Configura√ß√µes da Loja"})}),e.jsx(Ge,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Nome"}),e.jsx("p",{className:"text-base",children:_.store.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"WhatsApp"}),e.jsx("p",{className:"text-base",children:_.store.whatsapp||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Endere√ßo"}),e.jsx("p",{className:"text-base",children:_.store.address||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Taxa de Entrega"}),e.jsx("p",{className:"text-base",children:pe(_.store.delivery_fee)})]})]})})]}):e.jsx("p",{className:"text-gray-500 text-center py-12",children:"Nenhuma loja configurada"})}),e.jsx(Ne,{value:"caixas",className:"space-y-4",children:e.jsx("div",{className:"bg-white rounded-lg border",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Abertura"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Fechamento"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Aberto por"})]})}),e.jsx("tbody",{className:"divide-y",children:(_.caixas||[]).map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(t.opening_date).toLocaleString("pt-BR")}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.closing_date?new Date(t.closing_date).toLocaleString("pt-BR"):"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx(I,{variant:t.status==="open"?"default":"secondary",children:t.status==="open"?"Aberto":"Fechado"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:t.opened_by})]},t.id))})]})})})]}),e.jsx(ma,{isOpen:l,onClose:()=>{i(!1),c(null)},onSubmit:Me,category:u,categoriesCount:(_.categories||[]).length},u?u.id:"new"),e.jsx(je,{open:g,onOpenChange:t=>{t||(d(!1),r(null))},children:e.jsxs(fe,{className:"sm:max-w-2xl max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsx(ve,{children:e.jsx(be,{children:o?"Editar prato":"Novo prato"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(O,{children:"Nome *"}),e.jsx(M,{value:p.name,onChange:t=>v(m=>({...m,name:t.target.value})),placeholder:"Ex: Alcatra",required:!0})]}),e.jsxs("div",{children:[e.jsx(O,{children:"Categoria *"}),e.jsxs(te,{value:String(p.category_id||""),onValueChange:t=>v(m=>({...m,category_id:t||null})),children:[e.jsx(re,{children:e.jsx(ie,{placeholder:"Selecione"})}),e.jsx(ne,{children:(_.categories||[]).map(t=>e.jsx(T,{value:String(t.id),children:t.name},t.id))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(O,{children:"Pre√ßo de (R$) ‚Äî original"}),e.jsx(M,{type:"number",step:"0.01",value:p.original_price,onChange:t=>v(m=>({...m,original_price:t.target.value})),placeholder:"Ex: 25,00"})]}),e.jsxs("div",{children:[e.jsx(O,{children:"Por (R$) *"}),e.jsx(M,{type:"number",step:"0.01",value:p.price,onChange:t=>v(m=>({...m,price:t.target.value})),placeholder:"0,00",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(O,{children:"Estoque (vazio = ilimitado)"}),e.jsx(M,{type:"number",value:p.stock,onChange:t=>v(m=>({...m,stock:t.target.value})),placeholder:"Ex: 10"})]}),e.jsxs("div",{children:[e.jsx(O,{children:"Por√ß√£o"}),e.jsx(M,{value:p.portion,onChange:t=>v(m=>({...m,portion:t.target.value})),placeholder:"Ex: 180g, 500ml"})]})]}),e.jsxs("div",{children:[e.jsx(O,{children:"Descri√ß√£o"}),e.jsx(xs,{value:p.description,onChange:t=>v(m=>({...m,description:t.target.value})),rows:2,placeholder:"Opcional"})]}),e.jsxs("div",{children:[e.jsx(O,{children:"Tempo de preparo (min)"}),e.jsx(M,{type:"number",value:p.prep_time,onChange:t=>v(m=>({...m,prep_time:t.target.value})),placeholder:"Ex: 30"})]}),e.jsxs("div",{children:[e.jsx(O,{children:"Observa√ß√µes internas (n√£o vis√≠veis ao cliente)"}),e.jsx(xs,{value:p.internal_notes,onChange:t=>v(m=>({...m,internal_notes:t.target.value})),rows:1,placeholder:"Opcional"})]}),e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[e.jsx(O,{className:"mb-3 block",children:"Grupos de complementos no prato"}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Marque os grupos que o cliente poder√° escolher ao pedir este prato. Obrigat√≥rio = cliente deve escolher."}),(_.complement_groups||[]).length===0?e.jsx("p",{className:"text-sm text-gray-500",children:'Nenhum grupo. Crie na aba "Grupos de Complementos".'}):e.jsx("div",{className:"space-y-2",children:(_.complement_groups||[]).map(t=>{const m=(p.complement_groups||[]).find(R=>String(R.group_id)===String(t.id)),X=!!m;return e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx(Ms,{checked:X,onCheckedChange:R=>{v(R?W=>({...W,complement_groups:[...W.complement_groups||[],{group_id:t.id,is_required:!1}]}):W=>({...W,complement_groups:(W.complement_groups||[]).filter(s=>String(s.group_id)!==String(t.id))}))}}),e.jsx("span",{className:"text-sm font-medium",children:t.name}),X&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Obrigat√≥rio"}),e.jsx(we,{checked:!!m?.is_required,onCheckedChange:R=>v(W=>({...W,complement_groups:(W.complement_groups||[]).map(s=>String(s.group_id)===String(t.id)?{...s,is_required:R}:s)}))})]})]},t.id)})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded",children:[e.jsx(O,{className:"text-sm",children:"‚≠ê Destaque"}),e.jsx(we,{checked:p.is_highlight,onCheckedChange:t=>v(m=>({...m,is_highlight:t}))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded",children:[e.jsx(O,{className:"text-sm",children:"‚ú® Novo"}),e.jsx(we,{checked:p.is_new,onCheckedChange:t=>v(m=>({...m,is_new:t}))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded",children:[e.jsx(O,{className:"text-sm",children:"üî• Mais vendido"}),e.jsx(we,{checked:p.is_popular,onCheckedChange:t=>v(m=>({...m,is_popular:t}))})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded",children:[e.jsx(O,{children:"Ativo"}),e.jsx(we,{checked:p.is_active,onCheckedChange:t=>v(m=>({...m,is_active:t}))})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(b,{variant:"outline",className:"flex-1",onClick:()=>{d(!1),r(null)},children:"Cancelar"}),e.jsx(b,{className:"flex-1",disabled:A,onClick:()=>We(p),children:A?e.jsx(ue,{className:"w-4 h-4 animate-spin"}):o?"Salvar":"Criar"})]})]})]})}),e.jsx(je,{open:B,onOpenChange:t=>{t||(K(!1),ce(null))},children:e.jsxs(fe,{className:"sm:max-w-md max-w-[95vw]",children:[e.jsx(ve,{children:e.jsx(be,{children:se?"Editar grupo":"Novo grupo de complementos"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(O,{children:"Nome *"}),e.jsx(M,{value:de.name,onChange:t=>le(m=>({...m,name:t.target.value})),placeholder:"Ex: Guarni√ß√µes, Bebidas",required:!0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(O,{children:"Obrigat√≥rio"}),e.jsx(we,{checked:de.is_required,onCheckedChange:t=>le(m=>({...m,is_required:t}))})]}),e.jsxs("div",{children:[e.jsx(O,{children:"M√°ximo de sele√ß√µes"}),e.jsx(M,{type:"number",min:1,value:de.max_selection,onChange:t=>le(m=>({...m,max_selection:parseInt(t.target.value,10)||1}))})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(b,{variant:"outline",className:"flex-1",onClick:()=>{K(!1),ce(null)},children:"Cancelar"}),e.jsx(b,{className:"flex-1",disabled:A,onClick:as,children:A?e.jsx(ue,{className:"w-4 h-4 animate-spin"}):se?"Salvar":"Criar"})]})]})]})}),e.jsx(je,{open:w,onOpenChange:t=>{t||(E(!1),G(null))},children:e.jsxs(fe,{className:"sm:max-w-md max-w-[95vw]",children:[e.jsx(ve,{children:e.jsx(be,{children:P?"Editar complemento":"Novo complemento"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(O,{children:"Grupo *"}),e.jsxs(te,{value:String(L.group_id||""),onValueChange:t=>z(m=>({...m,group_id:t})),disabled:!!P,children:[e.jsx(re,{children:e.jsx(ie,{placeholder:"Selecione o grupo"})}),e.jsx(ne,{children:(_.complement_groups||[]).map(t=>e.jsx(T,{value:String(t.id),children:t.name},t.id))})]})]}),e.jsxs("div",{children:[e.jsx(O,{children:"Nome *"}),e.jsx(M,{value:L.name,onChange:t=>z(m=>({...m,name:t.target.value})),placeholder:"Ex: Arroz, Refrigerante",required:!0})]}),e.jsxs("div",{children:[e.jsx(O,{children:"Pre√ßo (R$)"}),e.jsx(M,{type:"number",step:"0.01",value:L.price,onChange:t=>z(m=>({...m,price:t.target.value})),placeholder:"0,00"})]}),P&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(O,{children:"Ativo"}),e.jsx(we,{checked:L.is_active,onCheckedChange:t=>z(m=>({...m,is_active:t}))})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(b,{variant:"outline",className:"flex-1",onClick:()=>{E(!1),G(null)},children:"Cancelar"}),e.jsx(b,{className:"flex-1",disabled:A,onClick:Se,children:A?e.jsx(ue,{className:"w-4 h-4 animate-spin"}):P?"Salvar":"Criar"})]})]})]})}),e.jsx(xa,{isOpen:y,onClose:()=>F(!1),categories:_.categories||[],dishes:_.dishes||[],complementGroups:_.complement_groups||[],onSave:rs}),e.jsx(at,{isOpen:U,onClose:()=>{V(!1),Q(null)},onSubmit:is,combo:Z,dishes:_.dishes||[]},Z?.id??"new"),e.jsx(tt,{open:C,onOpenChange:D,onSuccess:t=>{k.success("Backup importado com sucesso!"),x.invalidateQueries({queryKey:["profile",a.slug]})}})]})}function js(a,n){const x=us(a),l=us(n),i=Ps(x,l),u=Math.abs(Oa(x,l));x.setDate(x.getDate()-i*u);const c=+(Ps(x,l)===-i),g=i*(u-c);return g===0?0:g}function Ps(a,n){const x=a.getFullYear()-n.getFullYear()||a.getMonth()-n.getMonth()||a.getDate()-n.getDate()||a.getHours()-n.getHours()||a.getMinutes()-n.getMinutes()||a.getSeconds()-n.getSeconds()||a.getMilliseconds()-n.getMilliseconds();return x<0?-1:x>0?1:x}function Qs(a){return+us(a)<Date.now()}function it({expiresAt:a,className:n}){if(!a)return e.jsxs(I,{variant:"outline",className:ee("bg-green-500/15 text-green-700 dark:text-green-300 border-green-500/30",n),children:[e.jsx(ps,{className:"w-3 h-3 mr-1"}),"Sem expira√ß√£o"]});const x=new Date(a),i=js(x,new Date),u=Qs(x),c=i<=30&&i>7,g=i<=7&&i>0,o=Math.min(i/90*100,100);return u?e.jsx("div",{className:ee("space-y-1",n),children:e.jsxs(I,{variant:"outline",className:"bg-destructive/15 text-destructive border-destructive/30",children:[e.jsx(es,{className:"w-3 h-3 mr-1"}),"Expirado ",Math.abs(i)," dias atr√°s"]})}):g?e.jsxs("div",{className:ee("space-y-1",n),children:[e.jsxs(I,{variant:"outline",className:"bg-destructive/15 text-destructive border-destructive/30 animate-pulse",children:[e.jsx(es,{className:"w-3 h-3 mr-1"}),"Expira em ",i," dias"]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-1.5",children:e.jsx("div",{className:"bg-destructive h-1.5 rounded-full transition-all duration-300",style:{width:`${Math.max(o,5)}%`}})})]}):c?e.jsxs("div",{className:ee("space-y-1",n),children:[e.jsxs(I,{variant:"outline",className:"bg-amber-500/15 text-amber-700 dark:text-amber-300 border-amber-500/30",children:[e.jsx(Ns,{className:"w-3 h-3 mr-1"}),"Expira em ",i," dias"]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-1.5",children:e.jsx("div",{className:"bg-amber-500 h-1.5 rounded-full transition-all duration-300",style:{width:`${o}%`}})})]}):e.jsxs("div",{className:ee("space-y-1",n),children:[e.jsxs(I,{variant:"outline",className:"bg-green-500/15 text-green-700 dark:text-green-300 border-green-500/30",children:[e.jsx(Ns,{className:"w-3 h-3 mr-1"}),"Expira em ",i," dias"]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-1.5",children:e.jsx("div",{className:"bg-green-500 h-1.5 rounded-full transition-all duration-300",style:{width:`${Math.min(o,100)}%`}})})]})}function nt({open:a,onClose:n,setupUrl:x,subscriberName:l}){const[i,u]=f.useState(!1),[c,g]=f.useState(!1),d=async()=>{if(x)try{await navigator.clipboard.writeText(x),u(!0),setTimeout(()=>u(!1),2e3)}catch{u(!1)}},o=()=>{if(c){g(!1);return}window.confirm("Exibir o link de defini√ß√£o de senha na tela? Ele cont√©m um token sens√≠vel.")&&g(!0)};return e.jsx(je,{open:a,onOpenChange:n,children:e.jsxs(fe,{className:"sm:max-w-md max-w-[95vw]",children:[e.jsx(ve,{children:e.jsx(be,{className:"text-green-700 dark:text-green-400",children:"Assinante criado com sucesso!"})}),e.jsxs("div",{className:"space-y-4 py-2",children:[l&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("strong",{children:l})," foi cadastrado. Envie o link para que defina a senha."]}),x?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"flex-1 px-3 py-2 text-sm border rounded-lg bg-gray-50 dark:bg-gray-800 text-gray-500",children:c?x:"Link dispon√≠vel ‚Äî use Copiar ou Revelar"}),e.jsx(b,{variant:"outline",size:"icon",onClick:d,className:"shrink-0",title:"Copiar link","aria-label":"Copiar link",children:i?e.jsx(Ie,{className:"w-4 h-4 text-green-600"}):e.jsx($s,{className:"w-4 h-4"})}),e.jsx(b,{variant:"outline",size:"icon",onClick:o,className:"shrink-0",title:c?"Ocultar link":"Revelar link","aria-label":c?"Ocultar link":"Revelar link",children:c?e.jsx(ka,{className:"w-4 h-4"}):e.jsx(Sa,{className:"w-4 h-4"})})]}),i&&e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400",children:"Link copiado."})]}):e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:'Link de defini√ß√£o de senha n√£o foi gerado. Use "Resetar Senha" na lista do assinante.'})]}),e.jsx(Qe,{children:e.jsx(b,{onClick:n,children:"Fechar"})})]})})}const lt={restaurant_basic:{name:"Restaurante B√°sico",description:"Plano ideal para restaurantes que precisam gerenciar card√°pio e pedidos",permissions:{dashboard:["view"],dishes:["view","create","update"],orders:["view","create","update"],history:["view"],clients:["view"],store:["view","update"],theme:["view","update"]}},delivery_pro:{name:"Delivery Profissional",description:"Plano completo para empresas de delivery com gest√£o de entregas",permissions:{dashboard:["view"],dishes:["view","create","update","delete"],delivery_zones:["view","create","update","delete"],gestor_pedidos:["view","create","update","delete"],orders:["view","create","update"],history:["view"],clients:["view","create","update"],graficos:["view"],store:["view","update"],theme:["view","update"],payments:["view"]}},pizzaria_premium:{name:"Pizzaria Premium",description:"Plano completo para pizzarias com sistema de montagem de pizzas",permissions:{dashboard:["view"],dishes:["view","create","update","delete"],pdv:["view","create","update"],gestor_pedidos:["view","create","update","delete"],orders:["view","create","update","delete"],history:["view"],clients:["view","create","update","delete"],coupons:["view","create","update","delete"],promotions:["view","create","update","delete"],graficos:["view"],financial:["view"],store:["view","update"],theme:["view","update"],payments:["view"]}},cafe_basic:{name:"Cafeteria B√°sico",description:"Plano simples para cafeterias e lanchonetes",permissions:{dashboard:["view"],dishes:["view","create","update"],orders:["view","create"],history:["view"],store:["view","update"]}},marketplace_full:{name:"Marketplace Completo",description:"Acesso total para marketplaces e e-commerces",permissions:{dashboard:["view"],pdv:["view","create","update"],gestor_pedidos:["view","create","update","delete"],caixa:["view","create","update"],dishes:["view","create","update","delete"],delivery_zones:["view","create","update","delete"],coupons:["view","create","update","delete"],promotions:["view","create","update","delete"],theme:["view","update"],store:["view","update"],payments:["view","update"],graficos:["view"],orders:["view","create","update","delete"],history:["view"],clients:["view","create","update","delete"],financial:["view"],printer:["view","update"],whatsapp:["view"],mais:["view"]}}};function ot(){return Object.entries(lt).map(([a,n])=>({id:a,...n}))}function Es({onSelectTemplate:a}){const n=ot(),x=l=>{const i=n.find(u=>u.id===l);i&&a&&a(i)};return e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 block",children:"Templates R√°pidos (opcional)"}),e.jsxs(te,{onValueChange:x,children:[e.jsx(re,{className:"w-full",children:e.jsx(ie,{placeholder:"Escolher template para preencher automaticamente"})}),e.jsx(ne,{children:n.map(l=>e.jsx(T,{value:l.id,children:e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Os,{className:"w-4 h-4 text-orange-500"}),e.jsx("span",{className:"font-medium",children:l.name})]}),e.jsx("span",{className:"text-xs text-gray-500 mt-0.5",children:l.description})]})},l.id))})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Templates preenchem automaticamente as permiss√µes. Voc√™ pode ajustar depois."})]})}function ct(a){const n={subscribers:[],pagination:null};if(a==null)return n;if(a?.data?.error)throw new Error(a.data.error);let x=[],l=null;if(a?.data?.subscribers)x=Array.isArray(a.data.subscribers)?a.data.subscribers:[],l=a.data.pagination??null;else if(a?.data&&Array.isArray(a.data))x=a.data;else if(Array.isArray(a))x=a;else if(a?.subscribers)x=Array.isArray(a.subscribers)?a.subscribers:[],l=a.pagination??null;else if(a?.data&&typeof a.data=="object"&&!a.data.subscribers)return $.debug("subscribers.service: formato de resposta inesperado"),n;return{subscribers:x,pagination:l}}async function dt({page:a=1,limit:n=50,signal:x}={}){const l=new AbortController;let i;const u=12e4;x&&x.addEventListener("abort",()=>{i&&clearTimeout(i),l.abort()},{once:!0}),i=setTimeout(()=>{$.debug("subscribers.service: timeout atingido"),l.abort()},u);try{const c=await ge.get("/establishments/subscribers",{page:a,limit:n},{signal:l.signal});return clearTimeout(i),ct(c)}catch(c){throw clearTimeout(i),c?.name==="AbortError"?new Error('Servidor n√£o respondeu a tempo. Pode estar em cold start. Aguarde e clique em "Tentar novamente".'):c}}const mt=()=>"https://digimenu-backend-3m6t.onrender.com/api".replace(/\/api\/?$/,""),xt=8e4;async function ut(){const a=new AbortController,n=setTimeout(()=>a.abort(),6e4);try{$.debug("Warmup servidor..."),await fetch(mt(),{method:"GET",signal:a.signal}),$.debug("Warmup ok")}catch(x){$.debug("Warmup falhou, continuando:",x?.message)}finally{clearTimeout(n)}}function pt({page:a=1,limit:n=50,enabled:x=!0}={}){const[l,i]=f.useState(!0),[u,c]=f.useState(!1);f.useEffect(()=>{let A=!1;return ut().then(()=>{A||i(!1)}),()=>{A=!0}},[]);const g=!!x&&!l,{data:d,isLoading:o,isError:r,error:C,refetch:D}=ss({queryKey:["subscribers",a,n],queryFn:async({signal:A})=>await dt({page:a,limit:n,signal:A}),enabled:g,refetchOnWindowFocus:!1,refetchOnMount:!0,retry:(A,j)=>j?.name==="AbortError"?!1:A<1,retryDelay:3e3,refetchInterval:!1,staleTime:3e4});f.useEffect(()=>{if(!o){c(!1);return}const A=setTimeout(()=>c(!0),xt);return()=>clearTimeout(A)},[o]);const p=d?.subscribers??[],v=d?.pagination??null;return{subscribers:p,pagination:v,isLoading:o,isError:r,error:C,refetch:D,serverWarming:l,loadingStuck:u}}function ht(a=[]){const[n,x]=f.useState(""),[l,i]=f.useState(null),u=Ea(n,300),c=f.useMemo(()=>{const o=l!==null?l:a;if(!u.trim())return o;const r=u.toLowerCase().trim();return o.filter(C=>C.email?.toLowerCase().includes(r)||C.name?.toLowerCase().includes(r))},[a,u,l]),g=f.useMemo(()=>{const o=Array.isArray(a)?a:[];return{total:o.length,active:o.filter(r=>r.status==="active").length,inactive:o.filter(r=>r.status==="inactive").length,free:o.filter(r=>r.plan==="free"&&r.status==="active").length,basic:o.filter(r=>r.plan==="basic"&&r.status==="active").length,pro:o.filter(r=>r.plan==="pro"&&r.status==="active").length,ultra:o.filter(r=>r.plan==="ultra"&&r.status==="active").length}},[a]);return{filteredSubscribers:c,stats:g,searchTerm:n,setSearchTerm:x,advancedFiltered:l,setAdvancedFiltered:i,setQuickFilter:o=>{if(o===null||o==="all"){i(null);return}if(o==="active"||o==="inactive"){i(a.filter(r=>r.status===o));return}i(a.filter(r=>r.plan===o&&r.status==="active"))}}}function gt(a=[],n=x=>x?.id){const[x,l]=f.useState(()=>new Set),i=f.useCallback(o=>x.has(o),[x]),u=f.useCallback(o=>{l(r=>{const C=new Set(r);return C.has(o)?C.delete(o):C.add(o),C})},[]),c=f.useCallback(o=>{const r=Array.isArray(o)?o:a.map(n).filter(Boolean);l(new Set(r))},[a,n]),g=f.useCallback(()=>l(new Set),[]),d=f.useCallback(o=>{l(new Set(o))},[]);return{selectedIds:x,setSelectedIds:d,isSelected:i,toggle:u,selectAll:c,clear:g}}function Hs(a){if(!a||a.length===0)return"";const n=["Email","Nome","Plano","Status","Data de Expira√ß√£o","Email de Acesso","Telefone","CNPJ_CPF","Origem","Tags","Slug","Observa√ß√µes"],x=a.map(l=>{const i=Array.isArray(l.tags)?l.tags.join(";"):"";return[l.email||"",l.name||"",l.plan||"basic",l.status||"active",l.expires_at||"",l.linked_user_email||"",l.phone||"",l.cnpj_cpf||"",l.origem||"",i,l.slug||"",(l.notes||"").replace(/"/g,'""')].map(u=>`"${String(u)}"`).join(",")});return[n.map(l=>`"${l}"`).join(","),...x].join(`
`)}function Ks(a,n="assinantes.csv"){const x=new Blob(["\uFEFF"+a],{type:"text/csv;charset=utf-8;"}),l=window.URL.createObjectURL(x),i=document.createElement("a");i.href=l,i.download=n,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(l)}function Ws(a){const n=a.split(`
`).filter(y=>y.trim());if(n.length<2)throw new Error("CSV inv√°lido: deve ter pelo menos cabe√ßalho e uma linha de dados");const x=n[0],l=Ds(x),i=l.findIndex(y=>/^email$/i.test(y)||/email/i.test(y)&&!/acesso/i.test(y)),u=l.findIndex(y=>/nome/i.test(y)),c=l.findIndex(y=>/plano/i.test(y)),g=l.findIndex(y=>/status/i.test(y)),d=l.findIndex(y=>/expira/i.test(y)),o=l.findIndex(y=>/acesso/i.test(y)),r=l.findIndex(y=>/telefone|phone/i.test(y)),C=l.findIndex(y=>/cnpj|cpf/i.test(y)),D=l.findIndex(y=>/origem/i.test(y)),p=l.findIndex(y=>/tags/i.test(y)),v=l.findIndex(y=>/slug|link/i.test(y)),A=l.findIndex(y=>/observa|note/i.test(y)),j=[];for(let y=1;y<n.length;y++){const F=Ds(n[y]),U=F[i]?.trim();if(!U){console.warn(`Linha ${y+1}: Email n√£o encontrado, pulando...`);continue}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(U)){console.warn(`Linha ${y+1}: Email inv√°lido (${U}), pulando...`);continue}const Z=F[p]?.trim(),Q=Z?Z.split(/[;,]/).map(B=>B.trim()).filter(Boolean):[];j.push({email:U.toLowerCase(),name:F[u]?.trim()||"",plan:F[c]?.trim()||"basic",status:F[g]?.trim()||"active",expires_at:F[d]?.trim()||"",linked_user_email:F[o]?.trim()||"",phone:F[r]?.trim()||"",cnpj_cpf:F[C]?.trim()||"",origem:F[D]?.trim()||"import",tags:Q.length?Q:void 0,slug:F[v]?.trim()||"",notes:F[A]?.trim()||""})}return j}function Ds(a){const n=[];let x="",l=!1;for(let i=0;i<a.length;i++){const u=a[i],c=a[i+1];u==='"'?l&&c==='"'?(x+='"',i++):l=!l:u===","&&!l?(n.push(x.trim()),x=""):x+=u}return n.push(x.trim()),n}const jt=Object.freeze(Object.defineProperty({__proto__:null,downloadCSV:Ks,exportSubscribersToCSV:Hs,importCSVToSubscribers:Ws},Symbol.toStringTag,{value:"Module"}));function ft({onImport:a,disabled:n=!1}){const[x,l]=f.useState(!1),[i,u]=f.useState(null),[c,g]=f.useState(null),[d,o]=f.useState(null),r=D=>{const p=D.target.files?.[0];if(!p)return;if(!p.name.endsWith(".csv")){o("Por favor, selecione um arquivo CSV");return}u(p),o(null);const v=new FileReader;v.onload=A=>{try{const j=A.target.result,y=Ws(j);g(y),o(null)}catch(j){o(j.message||"Erro ao processar CSV"),g(null)}},v.readAsText(p,"UTF-8")},C=()=>{if(!c||c.length===0){k.error("Nenhum assinante v√°lido para importar");return}try{a(c),k.success(`${c.length} assinante(s) importado(s) com sucesso!`),l(!1),u(null),g(null),o(null)}catch(D){console.error("Erro ao importar:",D),k.error("Erro ao importar assinantes: "+D.message)}};return e.jsxs(e.Fragment,{children:[e.jsxs(b,{variant:"outline",onClick:()=>l(!0),disabled:n,className:"gap-2",children:[e.jsx(He,{className:"w-4 h-4"}),"Importar CSV"]}),e.jsx(je,{open:x,onOpenChange:l,children:e.jsxs(fe,{className:"sm:max-w-2xl max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsx(ve,{children:e.jsxs(be,{className:"flex items-center gap-2",children:[e.jsx(He,{className:"w-5 h-5 text-orange-500"}),"Importar Assinantes (CSV)"]})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Selecione o arquivo CSV"}),e.jsx(M,{type:"file",accept:".csv",onChange:r,className:"cursor-pointer"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Colunas: Email, Nome, Plano, Status, Data de Expira√ß√£o, Email de Acesso, Telefone, CNPJ_CPF, Origem, Tags, Slug, Observa√ß√µes"})]}),d&&e.jsxs(Te,{variant:"destructive",children:[e.jsx(es,{className:"h-4 w-4"}),e.jsx(ze,{children:d})]}),c&&c.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ps,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"text-sm font-medium text-green-700",children:[c.length," assinante(s) v√°lido(s) encontrado(s)"]})]}),e.jsx("div",{className:"border rounded-lg p-3 bg-gray-50 max-h-60 overflow-y-auto",children:e.jsxs("div",{className:"space-y-2",children:[c.slice(0,5).map((D,p)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(I,{variant:"outline",className:"text-xs",children:p+1}),e.jsx("span",{className:"font-medium",children:D.email}),D.name&&e.jsxs("span",{className:"text-gray-500",children:["- ",D.name]}),e.jsx(I,{variant:"outline",className:"ml-auto text-xs",children:D.plan})]},p)),c.length>5&&e.jsxs("p",{className:"text-xs text-gray-500 text-center pt-2",children:["... e mais ",c.length-5," assinante(s)"]})]})})]}),i&&!c&&!d&&e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(Os,{className:"w-8 h-8 text-gray-400 animate-pulse"})})]}),e.jsxs(Qe,{children:[e.jsx(b,{variant:"outline",onClick:()=>l(!1),children:"Cancelar"}),e.jsxs(b,{onClick:C,disabled:!c||c.length===0,className:"bg-orange-500 hover:bg-orange-600",children:["Importar ",c?`(${c.length})`:""]})]})]})})]})}function vt({subscribers:a,disabled:n=!1}){const x=()=>{try{if(!a||a.length===0){k.error("Nenhum assinante para exportar");return}const l=Hs(a),u=`assinantes_${new Date().toISOString().split("T")[0]}.csv`;Ks(l,u),k.success(`${a.length} assinante(s) exportado(s) com sucesso!`)}catch(l){console.error("Erro ao exportar CSV:",l),k.error("Erro ao exportar CSV: "+l.message)}};return e.jsxs(b,{variant:"outline",onClick:x,disabled:n||!a||a.length===0,className:"gap-2",children:[e.jsx(hs,{className:"w-4 h-4"}),"Exportar CSV"]})}function bt({onAddClick:a,onImport:n,subscribers:x=[],createMutation:l,className:i}){return e.jsx("header",{className:ee("sticky top-0 z-40 border-b border-border bg-card/95 backdrop-blur supports-[backdrop-filter]:bg-card/80",i),role:"banner",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 py-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(vs,{to:cs("Admin"),children:e.jsx(b,{variant:"ghost",size:"icon",className:"shrink-0","aria-label":"Voltar para Admin",children:e.jsx(Rs,{className:"w-5 h-5"})})}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center shrink-0","aria-hidden":!0,children:e.jsx(gs,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"font-semibold text-lg text-foreground truncate",children:"Gest√£o de Assinantes"}),e.jsx("p",{className:"text-muted-foreground text-xs truncate",children:"Gerencie quem tem acesso ao sistema"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx(vs,{to:cs("AdminMasterDashboard"),children:e.jsxs(b,{variant:"ghost",size:"sm",children:[e.jsx(za,{className:"w-4 h-4 mr-1.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Dashboard"})]})}),e.jsx(ft,{onImport:n}),e.jsx(vt,{subscribers:x}),e.jsxs(b,{onClick:a,size:"sm",className:"bg-primary text-primary-foreground hover:opacity-90","aria-label":"Novo assinante",children:[e.jsx(_e,{className:"w-4 h-4 mr-1.5"}),"Novo Assinante"]}),e.jsx(Da,{}),e.jsx(Ta,{})]})]})})})}function yt({subscribers:a=[]}){const n=Array.isArray(a)?a:[],x=new Date,l=n.filter(o=>o.status==="active").length,i=n.filter(o=>o.status==="inactive").length,u=n.filter(o=>o.expires_at?Qs(new Date(o.expires_at)):!1).length,c=n.filter(o=>{if(!o.expires_at)return!1;const r=js(new Date(o.expires_at),x);return r<=30&&r>0}).length,g=n.filter(o=>!o.has_password).length,d=n.length>0?(l/n.length*100).toFixed(0):0;return e.jsxs("div",{className:"flex flex-wrap items-center gap-3 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-muted rounded-md",children:[e.jsx(gs,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:n.length}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"total"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-muted rounded-md border border-green-500/30",children:[e.jsx(Ma,{className:"w-4 h-4 text-green-600 dark:text-green-400"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:l}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["ativos (",d,"%)"]}),i>0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["¬∑ ",i," inativo(s)"]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-muted rounded-md border border-amber-500/30",children:[e.jsx(Vs,{className:"w-4 h-4 text-amber-600 dark:text-amber-400"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:c}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"exp. <30 dias"}),u>0&&e.jsxs("span",{className:"text-xs text-destructive",children:["¬∑ ",u," expirado(s)"]})]}),g>0&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-muted rounded-md border border-destructive/30",children:[e.jsx(es,{className:"w-4 h-4 text-destructive"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:g}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"sem senha"})]})]})}function Nt({subscribers:a=[],onFilterChange:n}){const[x,l]=f.useState(!1),[i,u]=f.useState({status:[],plan:[],expires_soon:!1,has_password:null,search:""}),c=o=>{const r={...i,...o};u(r);const C=a.filter(D=>{if(r.status.length>0&&!r.status.includes(D.status)||r.plan.length>0&&!r.plan.includes(D.plan))return!1;if(r.expires_soon){if(!D.expires_at)return!1;const p=js(new Date(D.expires_at),new Date);if(p>30||p<0)return!1}return!(r.has_password!==null&&!!D.has_password!==r.has_password)});n?.(C)},g=()=>{u({status:[],plan:[],expires_soon:!1,has_password:null,search:""}),n?.(a)},d=[i.status.length,i.plan.length,i.expires_soon,i.has_password!==null].filter(Boolean).reduce((o,r)=>o+(typeof r=="number"?r:1),0);return e.jsxs(Fa,{open:x,onOpenChange:l,children:[e.jsx(La,{asChild:!0,children:e.jsxs(b,{variant:"outline",className:"gap-2 relative",children:[e.jsx(Ia,{className:"w-4 h-4"}),"Filtros",d>0&&e.jsx(I,{variant:"secondary",className:"ml-1 h-5 min-w-5 px-1.5 text-xs",children:d})]})}),e.jsx(qa,{className:"w-80",align:"start",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Filtros Avan√ßados"}),d>0&&e.jsxs(b,{variant:"ghost",size:"sm",onClick:g,className:"h-7 text-xs",children:[e.jsx(qe,{className:"w-3 h-3 mr-1"}),"Limpar"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"Status"}),e.jsxs(te,{value:i.status[0]||"all",onValueChange:o=>{c({status:o==="all"?[]:[o]})},children:[e.jsx(re,{className:"h-8 text-xs",children:e.jsx(ie,{})}),e.jsxs(ne,{children:[e.jsx(T,{value:"all",children:"Todos"}),e.jsx(T,{value:"active",children:"Ativo"}),e.jsx(T,{value:"inactive",children:"Inativo"}),e.jsx(T,{value:"pending",children:"Pendente"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"Plano"}),e.jsxs(te,{value:i.plan[0]||"all",onValueChange:o=>{c({plan:o==="all"?[]:[o]})},children:[e.jsx(re,{className:"h-8 text-xs",children:e.jsx(ie,{})}),e.jsxs(ne,{children:[e.jsx(T,{value:"all",children:"Todos"}),e.jsx(T,{value:"free",children:"Gratuito"}),e.jsx(T,{value:"basic",children:"B√°sico"}),e.jsx(T,{value:"pro",children:"Pro"}),e.jsx(T,{value:"ultra",children:"Ultra"}),e.jsx(T,{value:"custom",children:"Personalizado"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Expira em < 30 dias"}),e.jsx(b,{variant:i.expires_soon?"default":"outline",size:"sm",className:"h-7 text-xs",onClick:()=>c({expires_soon:!i.expires_soon}),children:i.expires_soon?"Sim":"N√£o"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"Senha Definida"}),e.jsxs(te,{value:i.has_password===null?"all":i.has_password?"yes":"no",onValueChange:o=>{c({has_password:o==="all"?null:o==="yes"})},children:[e.jsx(re,{className:"h-8 text-xs",children:e.jsx(ie,{})}),e.jsxs(ne,{children:[e.jsx(T,{value:"all",children:"Todos"}),e.jsx(T,{value:"yes",children:"Sim"}),e.jsx(T,{value:"no",children:"N√£o"})]})]})]}),d>0&&e.jsx("div",{className:"pt-2 border-t",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[i.status.length>0&&e.jsxs(I,{variant:"secondary",className:"text-xs",children:["Status: ",i.status.join(", ")]}),i.plan.length>0&&e.jsxs(I,{variant:"secondary",className:"text-xs",children:["Plano: ",i.plan.join(", ")]}),i.expires_soon&&e.jsx(I,{variant:"secondary",className:"text-xs",children:"Expira em < 30 dias"}),i.has_password!==null&&e.jsxs(I,{variant:"secondary",className:"text-xs",children:["Senha: ",i.has_password?"Sim":"N√£o"]})]})})]})})]})}const wt=[{label:"Todos",filter:null,key:"all"},{label:"Ativos",filter:"active",key:"active"},{label:"Inativos",filter:"inactive",key:"inactive"},{label:"Gratuitos",filter:"free",key:"free"},{label:"B√°sico",filter:"basic",key:"basic"},{label:"Pro",filter:"pro",key:"pro"},{label:"Ultra",filter:"ultra",key:"ultra"}],_t={all:"gray",active:"green",inactive:"red",free:"green",basic:"blue",pro:"orange",ultra:"purple"},Ct={gray:"bg-muted text-foreground hover:bg-muted/80 border-border",green:"bg-muted text-foreground hover:bg-muted/80 border-green-500/30",red:"bg-muted text-foreground hover:bg-muted/80 border-destructive/30",blue:"bg-muted text-foreground hover:bg-muted/80 border-blue-500/30",orange:"bg-muted text-foreground hover:bg-muted/80 border-primary/50",purple:"bg-muted text-foreground hover:bg-muted/80 border-violet-500/30"};function kt({searchTerm:a,onSearchChange:n,subscribers:x=[],advancedFiltered:l,onAdvancedFilterChange:i,stats:u,onQuickFilter:c,className:g}){const d=r=>u?r.filter===null?u.total:r.filter==="active"?u.active:r.filter==="inactive"?u.inactive:r.filter==="free"?u.free:r.filter==="basic"?u.basic:r.filter==="pro"?u.pro:r.filter==="ultra"?u.ultra:0:0,o=r=>r.filter===null?l===null:l===null?!1:r.filter==="active"||r.filter==="inactive"?l.every(C=>C.status===r.filter):l.every(C=>C.plan===r.filter&&C.status==="active");return e.jsxs("div",{className:ee("space-y-3",g),children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px] max-w-sm",children:[e.jsx(Ra,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground","aria-hidden":!0}),e.jsx(M,{placeholder:"Buscar por email ou nome...",value:a,onChange:r=>n(r.target.value),"aria-label":"Buscar assinantes por email ou nome",className:"pl-9 h-9 text-sm"})]}),e.jsx(Nt,{subscribers:x,onFilterChange:i})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground mr-1",children:"Filtro:"}),wt.map(r=>e.jsxs(b,{variant:"outline",size:"sm",className:ee("text-xs h-7 px-2",Ct[_t[r.key]||"gray"],o(r)&&"ring-2 ring-offset-1 ring-ring"),onClick:()=>c(r.filter),children:[r.label,e.jsx(I,{variant:"secondary",className:"ml-1 h-4 px-1 text-[10px] bg-background/80",children:d(r)})]},r.key))]})]})}function St({subscribers:a=[],selectedIds:n=[],onSelectionChange:x,onBulkAction:l,disabled:i=!1}){const u=a.length>0&&n.length===a.length,c=n.length>0&&!u,g=()=>{x?.(u?[]:a.map(o=>o.id))},d=async o=>{if(!n.length)return;const r=a.filter(C=>n.includes(C.id));switch(o){case"activate":await l?.("activate",r);break;case"deactivate":await l?.("deactivate",r);break;case"delete":confirm(`Tem certeza que deseja excluir ${n.length} assinante(s)?`)&&await l?.("delete",r);break;case"export":await l?.("export",r);break}};return a.length===0?null:e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-border bg-muted/50 px-4 rounded-t-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(b,{variant:"ghost",size:"sm",onClick:g,className:"gap-2 h-8",disabled:i,children:[u?e.jsx(Bs,{className:"w-4 h-4"}):c?e.jsx("div",{className:"w-4 h-4 border-2 border-muted-foreground rounded bg-background",children:e.jsx("div",{className:"w-2 h-2 bg-primary rounded m-0.5"})}):e.jsx(Us,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:u?"Desmarcar todos":"Selecionar todos"})]}),n.length>0&&e.jsxs(I,{variant:"secondary",className:"gap-1",children:[n.length," selecionado",n.length>1?"s":""]})]}),n.length>0&&e.jsxs(Ls,{children:[e.jsx(qs,{asChild:!0,children:e.jsxs(b,{variant:"outline",size:"sm",className:"gap-2 h-8",children:["A√ß√µes em Lote",e.jsx(I,{variant:"secondary",className:"ml-1 h-4 min-w-4 px-1 text-xs",children:n.length})]})}),e.jsxs(Is,{align:"end",children:[e.jsxs(xe,{onClick:()=>d("activate"),children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Ativar ",n.length," assinante(s)"]}),e.jsxs(xe,{onClick:()=>d("deactivate"),children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Desativar ",n.length," assinante(s)"]}),e.jsx(ys,{}),e.jsxs(xe,{onClick:()=>d("export"),children:[e.jsx(hs,{className:"w-4 h-4 mr-2"}),"Exportar ",n.length," assinante(s)"]}),e.jsx(ys,{}),e.jsxs(xe,{onClick:()=>d("delete"),className:"text-red-600",children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),"Excluir ",n.length," assinante(s)"]})]})]})]})}function At({subscriber:a,isSelected:n,onToggleSelect:x,getPlanLabel:l,getPlanColor:i,onEdit:u,onToggleStatus:c,onViewData:g,onDuplicate:d,onDelete:o,regenerateToken:r,generateTokenPending:C}){const D=!!a.has_password;return e.jsxs("div",{className:ee("flex items-center gap-3 py-2 px-3 border-b border-border last:border-0 hover:bg-muted/50",n&&"bg-primary/10 border-l-2 border-l-primary"),role:"row",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx(b,{variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0",onClick:()=>x(a.id),"aria-label":n?"Desmarcar":"Selecionar",children:n?e.jsx(Bs,{className:"w-4 h-4 text-primary"}):e.jsx(Us,{className:"w-4 h-4 text-muted-foreground"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("p",{className:"font-medium text-foreground truncate",children:a.name||a.email}),e.jsx(I,{className:ee("text-xs shrink-0",i(a.plan)),children:l(a.plan)})]}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:a.email})]})]}),e.jsx("div",{className:"hidden lg:flex items-center gap-2 shrink-0",children:e.jsx(I,{className:ee("text-xs",a.status==="active"?"bg-green-500/15 text-green-700 dark:text-green-300":"bg-muted text-muted-foreground"),children:a.status==="active"?"Ativo":"Inativo"})}),e.jsx("div",{className:"hidden md:block shrink-0 max-w-[140px]",children:a.expires_at?e.jsx(it,{expiresAt:a.expires_at,className:"text-xs"}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"‚Äî"})}),e.jsx("div",{className:"shrink-0",children:e.jsx(Fs,{children:e.jsxs(Oe,{children:[e.jsx(Fe,{asChild:!0,children:e.jsx("span",{className:"inline-flex items-center",children:D?e.jsx(Ie,{className:"w-4 h-4 text-green-600 dark:text-green-400","aria-label":"Senha definida"}):e.jsx(Ys,{className:"w-4 h-4 text-amber-500","aria-label":"Senha pendente"})})}),e.jsx(Le,{children:e.jsx("p",{children:D?"Senha j√° definida":"Senha pendente"})})]})})}),e.jsxs(Ls,{children:[e.jsx(qs,{asChild:!0,children:e.jsx(b,{variant:"ghost",size:"icon",className:"h-8 w-8","aria-label":"Menu de op√ß√µes",children:e.jsx(ua,{className:"w-4 h-4"})})}),e.jsxs(Is,{align:"end",children:[a.slug&&e.jsxs(xe,{onClick:()=>window.open(`/s/${a.slug}`,"_blank","noopener"),children:[e.jsx(pa,{className:"w-4 h-4 mr-2"}),"Abrir card√°pio"]}),e.jsxs(xe,{onClick:()=>g(a),children:[e.jsx(zs,{className:"w-4 h-4 mr-2"}),"Ver Dados Completos"]}),e.jsxs(xe,{onClick:()=>u(a),children:[e.jsx(Gs,{className:"w-4 h-4 mr-2"}),"Editar Assinatura"]}),e.jsx(xe,{onClick:()=>c(a),children:a.status==="active"?e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Desativar"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Ativar"]})}),e.jsxs(xe,{onClick:()=>d(a),children:[e.jsx($s,{className:"w-4 h-4 mr-2"}),"Duplicar"]}),!D&&e.jsxs(xe,{onClick:()=>r(a),disabled:C,children:[e.jsx(ds,{className:ee("w-4 h-4 mr-2",C&&"animate-spin")}),"Resetar Senha"]}),e.jsxs(xe,{onClick:()=>o(a),className:"text-destructive",children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),"Excluir"]})]})]})]})}function Pt({page:a,totalPages:n,total:x,limit:l,isLoading:i,onPrev:u,onNext:c,className:g}){if(!n||n<=1)return null;const d=(a-1)*l+1,o=Math.min(a*l,x),r=x>0?`${d}‚Äì${o} de ${x}`:"0 de 0";return e.jsxs("div",{className:ee("flex items-center justify-between gap-4 py-3 px-4 border-t border-border bg-muted/30",g),role:"navigation","aria-label":"Pagina√ß√£o da lista de assinantes",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:r}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(b,{variant:"outline",size:"sm",onClick:u,disabled:a<=1||i,"aria-label":"P√°gina anterior",children:[e.jsx(Va,{className:"w-4 h-4"}),"Anterior"]}),e.jsxs(b,{variant:"outline",size:"sm",onClick:c,disabled:a>=n||i,"aria-label":"Pr√≥xima p√°gina",children:["Pr√≥xima",e.jsx($a,{className:"w-4 h-4"})]})]})]})}function Et({filteredSubscribers:a=[],rawSubscribers:n=[],selectedIds:x,onSelectionChange:l,selection:i,getPlanLabel:u,getPlanColor:c,onEdit:g,onToggleStatus:d,onViewData:o,onDuplicate:r,onDelete:C,regenerateToken:D,generateTokenPending:p,updateMutation:v,deleteMutation:A,pagination:j,page:y,limit:F,onPagePrev:U,onPageNext:V,isLoading:Z,searchTerm:Q,onAddClick:B,onRefetch:K,isError:se,errorMessage:ce,serverWarming:de,loadingStuck:le}){const w=Array.isArray(x)?x:Array.from(x||[]);return se?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4 text-center",children:[e.jsx("p",{className:"text-destructive font-medium mb-2",children:"Erro ao carregar assinantes"}),e.jsx("p",{className:"text-muted-foreground text-sm mb-4 max-w-md",children:ce}),e.jsxs(b,{onClick:K,variant:"outline",className:"gap-2",children:[e.jsx(ds,{className:"w-4 h-4"}),"Tentar novamente"]})]}):de?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:[e.jsx(ue,{className:"w-10 h-10 text-primary animate-spin mb-3","aria-hidden":!0}),e.jsx("p",{className:"text-foreground font-medium",children:"Iniciando servidor..."}),e.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:"Aguarde at√© 60 segundos na primeira vez"})]}):Z&&le?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4 text-center",children:[e.jsx(ue,{className:"w-10 h-10 text-amber-500 animate-spin mb-3","aria-hidden":!0}),e.jsx("p",{className:"text-foreground font-medium mb-2",children:"Demorou mais do que o esperado"}),e.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:"Cold start pode levar at√© 2 min. Aguarde ou tente novamente."}),e.jsxs(b,{onClick:K,variant:"outline",className:"gap-2 border-amber-400",children:[e.jsx(ds,{className:"w-4 h-4"}),"Tentar novamente"]})]}):Z?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:[e.jsx(ue,{className:"w-10 h-10 text-primary animate-spin mb-3","aria-hidden":!0}),e.jsx("p",{className:"text-foreground",children:"Carregando assinantes..."}),e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:"Cold start: at√© 2 min na primeira vez"})]}):a.length===0?e.jsx(ha,{icon:gs,title:"Nenhum assinante encontrado",description:Q?`Nenhum resultado para "${Q}". Tente outros termos.`:"Adicione seu primeiro assinante para come√ßar.",action:B,actionLabel:"Adicionar Assinante"}):e.jsxs(e.Fragment,{children:[e.jsx(St,{subscribers:a,selectedIds:w,onSelectionChange:l,onBulkAction:async(E,P)=>{try{switch(E){case"activate":await Promise.all(P.map(ae=>v.mutateAsync({id:ae.id,data:{...ae,status:"active"},originalData:ae}))),k.success(`${P.length} assinante(s) ativado(s)!`);break;case"deactivate":await Promise.all(P.map(ae=>v.mutateAsync({id:ae.id,data:{...ae,status:"inactive"},originalData:ae}))),k.success(`${P.length} assinante(s) desativado(s)!`);break;case"delete":await Promise.all(P.map(ae=>A.mutateAsync(ae.id))),k.success(`${P.length} assinante(s) exclu√≠do(s)!`);break;case"export":const{exportSubscribersToCSV:G,downloadCSV:L}=await Zs(async()=>{const{exportSubscribersToCSV:ae,downloadCSV:_}=await Promise.resolve().then(()=>jt);return{exportSubscribersToCSV:ae,downloadCSV:_}},void 0),z=G(P),he=new Date().toISOString().split("T")[0];L(z,`assinantes_selecionados_${he}.csv`),k.success(`${P.length} assinante(s) exportado(s)!`);break;default:break}i?.clear()}catch(G){throw G}}}),e.jsx("div",{className:"divide-y divide-border",role:"list",children:a.map(E=>e.jsx(At,{subscriber:E,isSelected:i?.isSelected(E.id),onToggleSelect:i?.toggle,getPlanLabel:u,getPlanColor:c,onEdit:g,onToggleStatus:d,onViewData:o,onDuplicate:r,onDelete:C,regenerateToken:D,generateTokenPending:p},E.id))}),j&&j.totalPages>1&&e.jsx(Pt,{page:j.page,totalPages:j.totalPages,total:j.total,limit:F,isLoading:Z,onPrev:U,onNext:V})]})}function Fr(){const[a,n]=f.useState(null),[x,l]=f.useState(!0),[i,u]=f.useState(!1),[c,g]=f.useState(!1),[d,o]=f.useState(null),[r,C]=f.useState({email:"",linked_user_email:"",name:"",slug:"",plan:"basic",status:"active",expires_at:"",permissions:Pe("basic"),phone:"",cnpj_cpf:"",origem:"manual",tags:[],notes:""}),[D,p]=f.useState(null),[v,A]=f.useState({}),[j,y]=f.useState({open:!1,url:null,name:null}),[F,U]=f.useState(null),[V,Z]=f.useState(1),Q=50,B=Ts();f.useEffect(()=>{(async()=>{try{const h=await ge.auth.me();n(h),h.is_master||(window.location.href=cs("Admin"))}catch{ge.auth.redirectToLogin()}finally{l(!1)}})()},[]);const{subscribers:K,pagination:se,isLoading:ce,isError:de,error:le,refetch:w,serverWarming:E,loadingStuck:P}=pt({page:V,limit:Q,enabled:!!a?.is_master}),{filteredSubscribers:G,stats:L,searchTerm:z,setSearchTerm:he,advancedFiltered:ae,setAdvancedFiltered:_,setQuickFilter:Ce}=ht(K),J=gt(G,s=>s.id);f.useEffect(()=>{const s={};K.forEach(h=>{(h.setup_url||h.password_token)&&(s[h.id||h.email]={token:h.password_token,setup_url:h.setup_url,expires_at:h.token_expires_at})}),A(s)},[K]);const{data:oe=[]}=ss({queryKey:["plans"],queryFn:async()=>{try{const h=(await ge.entities.Plan.list("order")).filter(N=>N.is_active!==!1);return h.length===0?(console.log("‚ö†Ô∏è Nenhum plano no banco, retornando planos padr√£o (Assinantes)"),[{id:"free",slug:"free",name:"Gratuito",description:"Teste de 10 dias",is_active:!0,order:0},{id:"basic",slug:"basic",name:"B√°sico",description:"Funcionalidades essenciais",is_active:!0,order:1},{id:"pro",slug:"pro",name:"Pro",description:"Recursos avan√ßados",is_active:!0,order:2},{id:"ultra",slug:"ultra",name:"Ultra",description:"Todos os recursos",is_active:!0,order:3}]):h}catch(s){return console.error("‚ùå Erro ao carregar planos, retornando padr√£o:",s),[{id:"free",slug:"free",name:"Gratuito",description:"Teste de 10 dias",is_active:!0,order:0},{id:"basic",slug:"basic",name:"B√°sico",description:"Funcionalidades essenciais",is_active:!0,order:1},{id:"pro",slug:"pro",name:"Pro",description:"Recursos avan√ßados",is_active:!0,order:2},{id:"ultra",slug:"ultra",name:"Ultra",description:"Todos os recursos",is_active:!0,order:3}]}},enabled:!!a?.is_master}),Me=Xe({onMutate:async s=>{const h=["subscribers",V,Q];await B.cancelQueries({queryKey:["subscribers"]});const N=B.getQueryData(h),S={id:`temp-${Date.now()}`,...s,status:s.status||"active",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),_optimistic:!0};return B.setQueryData(h,q=>({subscribers:[...Array.isArray(q)?q:q?.subscribers??[],S],pagination:q?.pagination??null})),{previousData:N}},mutationFn:async s=>{try{const h=await ge.post("/establishments/subscribers",s);if(h?.data?.error)throw new Error(h.data.error);if(!h?.data?.subscriber)throw new Error("Resposta inv√°lida do servidor. Subscriber n√£o encontrado.");return{...h.data.subscriber,setup_url:h.data.setup_url,password_token:h.data.password_token}}catch(h){throw $.debug("createSubscriber error",h?.message),h}},onSuccess:async s=>{u(!1),C({email:"",linked_user_email:"",name:"",slug:"",plan:"basic",status:"active",expires_at:"",permissions:Pe("basic"),phone:"",cnpj_cpf:"",origem:"manual",tags:[],notes:""});const h=window.location.origin;let N=s.setup_url;!N&&s.password_token&&(N=`${h}/definir-senha?token=${s.password_token}`);let S=!1;if(N)try{await navigator.clipboard.writeText(N),S=!0}catch(q){$.debug("Clipboard copy failed",q?.message)}k.success(S?"Assinante criado! Link copiado.":"Assinante criado com sucesso!"),y({open:!0,url:N,name:s.name||s.email})},onError:(s,h,N)=>{N?.previousData!=null&&B.setQueryData(["subscribers",V,Q],N.previousData),$.error("‚ùå Erro completo ao criar assinante:",s);const S=s?.message||s?.toString()||"Erro desconhecido";k.error(`Erro ao adicionar assinante: ${S}`)},onSettled:()=>{B.invalidateQueries({queryKey:["subscribers"]})}}),ke=Xe({onMutate:async({id:s,data:h})=>{const N=["subscribers",V,Q];await B.cancelQueries({queryKey:["subscribers"]});const S=B.getQueryData(N);return B.setQueryData(N,q=>({subscribers:(Array.isArray(q)?q:q?.subscribers??[]).map(ls=>ls.id===s?{...ls,...h,_optimistic:!0}:ls),pagination:q?.pagination??null})),{previousData:S}},mutationFn:async({id:s,data:h,originalData:N})=>{const S=await ge.functions.invoke("updateSubscriber",{id:s,data:h,originalData:N});if(S.data?.error)throw new Error(S.data.error);return S.data?.subscriber??S.data},onError:(s,h,N)=>{N?.previousData!=null&&B.setQueryData(["subscribers",V,Q],N.previousData);const S=s?.message||s?.toString()||"Erro ao atualizar assinante";k.error(S)},onSettled:()=>{B.invalidateQueries({queryKey:["subscribers"]})}}),We=Xe({onMutate:async s=>{const h=["subscribers",V,Q];await B.cancelQueries({queryKey:["subscribers"]});const N=B.getQueryData(h);return B.setQueryData(h,S=>({subscribers:(Array.isArray(S)?S:S?.subscribers??[]).filter(me=>me.id!==s),pagination:S?.pagination??null})),{previousData:N}},mutationFn:async s=>{const h=await ge.functions.invoke("deleteSubscriber",{id:s});if(h.data.error)throw new Error(h.data.error);return h.data},onError:(s,h,N)=>{N?.previousData!=null&&B.setQueryData(["subscribers",V,Q],N.previousData),k.error("Erro ao excluir assinante")},onSettled:()=>{B.invalidateQueries({queryKey:["subscribers"]})}}),Je=Xe({mutationFn:async({subscriber_id:s,email:h})=>{const N=await ge.functions.invoke("generatePasswordTokenForSubscriber",{subscriber_id:s,email:h});if(N.data.error)throw new Error(N.data.error);return N.data},onSuccess:async(s,h)=>{const N=h.subscriber_id||h.email,S={token:s.token||s.data?.token,setup_url:s.setup_url||s.data?.setup_url,expires_at:s.expires_at||s.data?.expires_at};A(Y=>({...Y,[N]:S}));const q=s.setup_url||s.data?.setup_url;if(q)try{await navigator.clipboard.writeText(q),k.success("Link copiado para a √°rea de transfer√™ncia.")}catch{k.success("Token de senha gerado. Use o bot√£o Copiar no modal se precisar do link.")}else k.success("Token de senha gerado com sucesso.")},onError:s=>{$.debug("generateToken error",s?.message),k.error(s?.message||"Erro ao gerar token de senha")}}),as=s=>{Je.mutate({subscriber_id:s.id,email:s.email})},ts=s=>{if(!s)return{valid:!1,error:"Email √© obrigat√≥rio"};const h=s.trim().toLowerCase();return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(h)?K.some(q=>q.email?.toLowerCase()===h&&q.id!==r.id)?{valid:!1,error:"Este email j√° est√° cadastrado"}:{valid:!0,email:h}:{valid:!1,error:"Formato de email inv√°lido"}},Se=s=>(s||"").trim().toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")||"",Ye=s=>{if(!s)return{valid:!0,slug:""};const h=Se(s);return/^[a-z0-9]+(?:-[a-z0-9]+)*$/.test(h)?{valid:!0,slug:h}:{valid:!1,error:"Use apenas letras min√∫sculas, n√∫meros e h√≠fen"}},rs=()=>{const s=ts(r.email);if(!s.valid){k.error(s.error);return}const N=String(r.plan||"basic");let S=r.permissions||{};N!=="custom"&&(!S||Object.keys(S).length===0)&&(S=Pe(N));const q=Ye(r.slug);if(!q.valid){k.error(q.error);return}const Y={email:s.email,name:(r.name||"").trim(),plan:N,status:String(r.status||"active")};r.expires_at&&(Y.expires_at=r.expires_at),q.slug&&(Y.slug=q.slug),r.linked_user_email!=null&&String(r.linked_user_email||"").trim()&&(Y.linked_user_email=String(r.linked_user_email).trim()),S&&Object.keys(S).length>0&&(Y.permissions=S),r.phone?.trim()&&(Y.phone=r.phone.trim()),r.cnpj_cpf?.trim()&&(Y.cnpj_cpf=r.cnpj_cpf.trim()),r.notes?.trim()&&(Y.notes=r.notes.trim()),r.origem?.trim()&&(Y.origem=r.origem.trim()),Array.isArray(r.tags)&&r.tags.length>0&&(Y.tags=r.tags.filter(me=>me&&String(me).trim())),$.log("Criando assinante:",JSON.stringify(Y,null,2));try{Me.mutate(Y)}catch(me){$.error("Erro ao criar assinante:",me),alert("Erro ao criar assinante: "+me.message)}},is=s=>{const h=s.status==="active"?"inactive":"active";ke.mutate({id:s.id,data:{...s,status:h},originalData:s})},[Ze,pe]=f.useState([]),ns=async s=>{$.log("üìÇ Abrindo modal para:",s);const h=s.addons&&typeof s.addons=="object"?s.addons:{orders:0},N={...s,permissions:s.permissions||{},plan:s.plan||"basic",status:s.status||"active",addons:{...h,orders:Number(h.orders)||0}};$.log("üìÇ Estado inicial editingSubscriber:",N),o(N),g(!0);try{const S=await ge.entities.PermissionLog.filter({subscriber_email:s.email},"-created_date",10);pe(S)}catch(S){$.error("Erro ao carregar logs:",S),pe([])}},t=()=>{if(!d)return;const s=K.find(S=>S.id===d.id);$.log("üíæ SALVANDO - editingSubscriber completo:",JSON.stringify(d,null,2));const h=Ye(d.slug);if(!h.valid){k.error(h.error);return}const N={id:d.id,email:d.email,linked_user_email:d.linked_user_email||d.email,name:d.name||"",plan:d.plan,status:d.status||"active",expires_at:d.expires_at||"",permissions:d.permissions||{},notes:d.notes||"",slug:h.slug??"",phone:d.phone||"",cnpj_cpf:d.cnpj_cpf||"",origem:d.origem||"",tags:Array.isArray(d.tags)?d.tags:[],addons:d.addons&&typeof d.addons=="object"?{orders:Number(d.addons.orders)||0}:{orders:0}};$.log("üíæ SALVANDO - editingSubscriber.id:",d.id),$.log("üíæ SALVANDO - originalData:",s),$.log("üíæ SALVANDO - dataToUpdate completo:",JSON.stringify(N,null,2)),ke.mutate({id:d.id,data:N,originalData:s}),g(!1),o(null),pe([])},m=s=>{$.log("üß† Assinantes.jsx - Recebido plano:",s);const h=s!=="custom"?Pe(s):{};d?o(N=>{const S={...N,plan:s,permissions:s!=="custom"?h:N.permissions||{}};return $.log("üß† Assinantes.jsx - editingSubscriber atualizado:",S.plan,S.permissions),S}):C(N=>{const S={...N,plan:s,permissions:s!=="custom"?h:{}};return $.log("üß† Assinantes.jsx - newSubscriber atualizado:",S.plan,S.permissions),S})},X=s=>s==="custom"?"Personalizado":oe.find(N=>N.slug===s)?.name||s,R=s=>s==="custom"?"bg-primary/20 text-primary":s==="free"?"bg-emerald-500/15 text-emerald-700 dark:text-emerald-300":s==="basic"?"bg-blue-500/15 text-blue-700 dark:text-blue-300":s==="pro"?"bg-primary/20 text-primary":s==="ultra"?"bg-purple-500/15 text-purple-700 dark:text-purple-300":"bg-muted text-muted-foreground";if(x)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx(ue,{className:"w-8 h-8 animate-spin text-primary"})});if(!a?.is_master)return null;if(D)return e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx(rt,{subscriber:D,onBack:()=>p(null)})})});const W=le?.message!=null?(()=>{const s=String(le.message);return s.includes("Acesso negado")||s.includes("MASTER_ONLY")||s.includes("administradores master")?"Acesso negado. Verifique se sua conta possui permiss√£o de Admin Master.":s||"Verifique sua conex√£o ou tente novamente em instantes."})():"Verifique sua conex√£o ou tente novamente em instantes.";return e.jsxs("div",{className:"min-h-screen min-h-screen-mobile bg-background",children:[e.jsx(bt,{onAddClick:()=>u(!0),onImport:async s=>{let h=0,N=0;for(const S of s)try{await Me.mutateAsync(S),h++}catch(q){$.debug("Import error",S?.email,q?.message),N++}N>0&&k.error(`${N} assinante(s) n√£o puderam ser importado(s)`),h>0&&k.success(`${h} assinante(s) importado(s) com sucesso!`)},subscribers:K}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 py-3",children:!ce&&e.jsx(yt,{subscribers:K})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 py-4",children:[e.jsx(kt,{searchTerm:z,onSearchChange:he,subscribers:K,advancedFiltered:ae,onAdvancedFilterChange:_,stats:L,onQuickFilter:Ce}),e.jsx("div",{className:"bg-card rounded-xl border border-border overflow-hidden",children:e.jsx(Et,{filteredSubscribers:G,rawSubscribers:K,selectedIds:J.selectedIds,onSelectionChange:s=>J.setSelectedIds(s),selection:J,getPlanLabel:X,getPlanColor:R,onEdit:ns,onToggleStatus:is,onViewData:p,onDuplicate:s=>{C({email:"",linked_user_email:s.linked_user_email||"",name:s.name?`${s.name} (c√≥pia)`:"",slug:"",plan:s.plan||"basic",status:s.status||"active",expires_at:s.expires_at||"",permissions:s.permissions||Pe(s.plan||"basic"),phone:s.phone||"",cnpj_cpf:s.cnpj_cpf||"",origem:s.origem||"manual",tags:Array.isArray(s.tags)?[...s.tags]:[],notes:s.notes||""}),u(!0),k.success("Dados copiados. Informe um novo email e salve.")},onDelete:U,regenerateToken:as,generateTokenPending:Je.isPending,updateMutation:ke,deleteMutation:We,pagination:se,page:V,limit:Q,onPagePrev:()=>Z(s=>Math.max(1,s-1)),onPageNext:()=>Z(s=>Math.min(se?.totalPages??1,s+1)),isLoading:ce,searchTerm:z,onAddClick:()=>u(!0),onRefetch:w,isError:de,errorMessage:W,serverWarming:E,loadingStuck:P})})]}),e.jsx(je,{open:i,onOpenChange:u,children:e.jsxs(fe,{className:"sm:max-w-md max-h-[90vh] overflow-y-auto animate-in fade-in-0 zoom-in-95 duration-200","aria-describedby":"add-subscriber-desc",children:[e.jsxs(ve,{children:[e.jsxs(be,{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"w-5 h-5 text-primary"}),"Adicionar Assinante"]}),e.jsx(ms,{id:"add-subscriber-desc",children:"Preencha os dados do novo assinante. Campos com * s√£o obrigat√≥rios."})]}),e.jsx(Fs,{children:e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Email da Assinatura *"}),e.jsxs(Oe,{children:[e.jsx(Fe,{asChild:!0,children:e.jsx(Be,{className:"w-4 h-4 text-muted-foreground cursor-help"})}),e.jsx(Le,{children:e.jsx("p",{className:"max-w-xs",children:"Email principal do titular da assinatura. Ser√° usado para login e identifica√ß√£o."})})]})]}),e.jsx(M,{type:"email",placeholder:"email@exemplo.com",value:r.email,onChange:s=>C({...r,email:s.target.value}),autoFocus:!0}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Email do titular da assinatura"})]}),e.jsxs("div",{"data-field":"email-acesso",className:"border-l-2 border-primary/30 pl-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"linked_user_email",children:"Email de Acesso / Email personalizado (opcional)"}),e.jsxs(Oe,{children:[e.jsx(Fe,{asChild:!0,children:e.jsx(Be,{className:"w-4 h-4 text-muted-foreground cursor-help"})}),e.jsx(Le,{children:e.jsx("p",{className:"max-w-xs",children:"Se diferente do email da assinatura, informe aqui o email que ter√° acesso ao painel. Deixe vazio para usar o mesmo email."})})]})]}),e.jsx(M,{id:"linked_user_email",type:"email",placeholder:"email@exemplo.com",value:r.linked_user_email||"",onChange:s=>C({...r,linked_user_email:s.target.value})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Se diferente, informe o email do usu√°rio que ter√° acesso ao painel"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Nome"}),e.jsxs(Oe,{children:[e.jsx(Fe,{asChild:!0,children:e.jsx(Be,{className:"w-4 h-4 text-muted-foreground cursor-help"})}),e.jsx(Le,{children:e.jsx("p",{children:"Nome completo ou comercial do assinante. Ser√° exibido no dashboard e relat√≥rios."})})]})]}),e.jsx(M,{placeholder:"Nome do assinante",value:r.name,onChange:s=>C({...r,name:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-1 block",children:"Status"}),e.jsxs(te,{value:r.status,onValueChange:s=>C({...r,status:s}),children:[e.jsx(re,{children:e.jsx(ie,{})}),e.jsxs(ne,{children:[e.jsx(T,{value:"active",children:"Ativo"}),e.jsx(T,{value:"inactive",children:"Inativo"}),e.jsx(T,{value:"pending",children:"Pendente"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-foreground mb-1 block flex items-center gap-1",children:[e.jsx(ws,{className:"w-4 h-4 text-primary"}),"Telefone"]}),e.jsx(M,{placeholder:"(00) 00000-0000",value:r.phone||"",onChange:s=>C({...r,phone:s.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-foreground mb-1 block flex items-center gap-1",children:[e.jsx(_s,{className:"w-4 h-4 text-primary"}),"CNPJ/CPF"]}),e.jsx(M,{placeholder:"00.000.000/0001-00",value:r.cnpj_cpf||"",onChange:s=>C({...r,cnpj_cpf:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-1 block",children:"Origem"}),e.jsxs(te,{value:r.origem||"manual",onValueChange:s=>C({...r,origem:s}),children:[e.jsx(re,{children:e.jsx(ie,{})}),e.jsxs(ne,{children:[e.jsx(T,{value:"manual",children:"Manual"}),e.jsx(T,{value:"import",children:"Importa√ß√£o CSV"}),e.jsx(T,{value:"landing",children:"Landing Page"}),e.jsx(T,{value:"indicacao",children:"Indica√ß√£o"}),e.jsx(T,{value:"outro",children:"Outro"})]})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("label",{className:"text-sm font-medium text-foreground flex items-center gap-1",children:[e.jsx(bs,{className:"w-4 h-4 text-primary"}),"Link do card√°pio"]}),e.jsxs(Oe,{children:[e.jsx(Fe,{asChild:!0,children:e.jsx(Be,{className:"w-4 h-4 text-muted-foreground cursor-help"})}),e.jsx(Le,{children:e.jsx("p",{className:"max-w-xs",children:"Parte final da URL do card√°pio: /s/meu-restaurante. Apenas letras min√∫sculas, n√∫meros e h√≠fen. Deixe vazio para o assinante definir depois em Loja."})})]})]}),e.jsx(M,{placeholder:"ex: meu-restaurante",value:r.slug||"",onChange:s=>C({...r,slug:s.target.value}),onBlur:s=>C(h=>({...h,slug:Se(h.slug)})),className:"font-mono"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["URL: /s/",e.jsx("span",{className:"font-mono",children:Se(r.slug)||"..."})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-foreground mb-1 block flex items-center gap-1",children:[e.jsx(Cs,{className:"w-4 h-4 text-primary"}),"Tags (separadas por v√≠rgula)"]}),e.jsx(M,{placeholder:"ex: beta, parceiro, vip",value:Array.isArray(r.tags)?r.tags.join(", "):"",onChange:s=>{const h=(s.target.value||"").split(",").map(N=>N.trim()).filter(Boolean);C({...r,tags:h})}})]}),e.jsx(Es,{onSelectTemplate:s=>{C({...r,permissions:s.permissions,plan:"custom"}),k.success(`Template "${s.name}" aplicado!`)}}),e.jsx(As,{permissions:r.permissions,onChange:s=>C({...r,permissions:s}),selectedPlan:r.plan,onPlanChange:m}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Data de Expira√ß√£o"}),e.jsxs(Oe,{children:[e.jsx(Fe,{asChild:!0,children:e.jsx(Be,{className:"w-4 h-4 text-muted-foreground cursor-help"})}),e.jsx(Le,{children:e.jsx("p",{className:"max-w-xs",children:"Data em que a assinatura expira. Deixe vazio para permanente."})})]})]}),e.jsx(M,{type:"date",value:r.expires_at,onChange:s=>C({...r,expires_at:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-1 block",children:"Observa√ß√µes"}),e.jsx(M,{placeholder:"Notas internas...",value:r.notes||"",onChange:s=>C({...r,notes:s.target.value})})]})]})]})}),e.jsxs(Qe,{children:[e.jsx(b,{variant:"outline",onClick:()=>u(!1),children:"Cancelar"}),e.jsxs(b,{onClick:rs,disabled:!r.email||Me.isPending,className:"bg-primary text-primary-foreground hover:opacity-90",children:[Me.isPending?e.jsx(ue,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Adicionar"]})]})]})}),e.jsx(je,{open:c,onOpenChange:g,children:e.jsxs(fe,{size:"large",className:"max-h-[90vh] flex flex-col","aria-describedby":"edit-subscriber-desc",children:[e.jsxs(ve,{children:[e.jsxs(be,{className:"flex items-center gap-2",children:[e.jsx(Gs,{className:"w-5 h-5 text-primary"}),"Editar Assinante"]}),e.jsx(ms,{id:"edit-subscriber-desc",children:"Edite as informa√ß√µes e permiss√µes do assinante"})]}),d&&e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-1 block",children:"Email da Assinatura"}),e.jsx(M,{type:"email",value:d.email,disabled:!0,className:"bg-muted"})]}),e.jsxs("div",{"data-field":"email-acesso",className:"border-l-2 border-primary/30 pl-3",children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-1 block",htmlFor:"edit-linked_user_email",children:"Email de Acesso / Email personalizado"}),e.jsx(M,{id:"edit-linked_user_email",type:"email",placeholder:"Se diferente do email da assinatura",value:d.linked_user_email||"",onChange:s=>o({...d,linked_user_email:s.target.value})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Email do usu√°rio que ter√° acesso ao painel (deixe vazio se for o mesmo da assinatura)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-1 block",children:"Nome"}),e.jsx(M,{value:d.name||"",onChange:s=>o({...d,name:s.target.value})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-foreground mb-1 block flex items-center gap-1",children:[e.jsx(bs,{className:"w-4 h-4 text-primary"}),"Link do card√°pio"]}),e.jsx(M,{placeholder:"ex: meu-restaurante",value:d.slug||"",onChange:s=>o({...d,slug:s.target.value}),onBlur:s=>o(h=>({...h,slug:Se(h.slug)})),className:"font-mono"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["URL: /s/",e.jsx("span",{className:"font-mono",children:Se(d.slug)||"..."})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-foreground mb-1 block flex items-center gap-1",children:[e.jsx(ws,{className:"w-4 h-4 text-primary"}),"Telefone"]}),e.jsx(M,{placeholder:"(00) 00000-0000",value:d.phone||"",onChange:s=>o({...d,phone:s.target.value})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-foreground mb-1 block flex items-center gap-1",children:[e.jsx(_s,{className:"w-4 h-4 text-primary"}),"CNPJ/CPF"]}),e.jsx(M,{placeholder:"00.000.000/0001-00",value:d.cnpj_cpf||"",onChange:s=>o({...d,cnpj_cpf:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-1 block",children:"Origem"}),e.jsxs(te,{value:d.origem||"manual",onValueChange:s=>o({...d,origem:s}),children:[e.jsx(re,{children:e.jsx(ie,{})}),e.jsxs(ne,{children:[e.jsx(T,{value:"manual",children:"Manual"}),e.jsx(T,{value:"import",children:"Importa√ß√£o CSV"}),e.jsx(T,{value:"landing",children:"Landing Page"}),e.jsx(T,{value:"indicacao",children:"Indica√ß√£o"}),e.jsx(T,{value:"outro",children:"Outro"})]})]})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsxs("label",{className:"text-sm font-medium text-foreground mb-1 block flex items-center gap-1",children:[e.jsx(Cs,{className:"w-4 h-4 text-primary"}),"Tags (separadas por v√≠rgula)"]}),e.jsx(M,{placeholder:"ex: beta, parceiro",value:Array.isArray(d.tags)?d.tags.join(", "):"",onChange:s=>{const h=(s.target.value||"").split(",").map(N=>N.trim()).filter(Boolean);o({...d,tags:h})}})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-1 block",children:"Status"}),e.jsxs(te,{value:d.status,onValueChange:s=>o({...d,status:s}),children:[e.jsx(re,{children:e.jsx(ie,{})}),e.jsxs(ne,{children:[e.jsx(T,{value:"active",children:"Ativo"}),e.jsx(T,{value:"inactive",children:"Inativo"}),e.jsx(T,{value:"pending",children:"Pendente"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-1 block",children:"Data de Expira√ß√£o"}),e.jsx(M,{type:"date",value:d.expires_at||"",onChange:s=>o({...d,expires_at:s.target.value})})]})]}),d.plan&&d.plan!=="custom"&&(()=>{const s=Aa(d.plan),h=Number(d.addons?.orders)||0,N=s&&s.orders_per_month!==os?s.orders_per_month+h:s?.orders_per_month===os?"Ilimitado":"-";return e.jsxs("div",{className:"space-y-3 rounded-lg border border-border bg-muted/30 p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-foreground",children:"Limites e add-ons"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsx("div",{className:"text-muted-foreground",children:"Pedidos/m√™s (efetivo):"}),e.jsx("div",{className:"font-medium",children:N}),e.jsx("div",{className:"text-muted-foreground",children:"Produtos:"}),e.jsx("div",{className:"font-medium",children:s?.products===os?"Ilimitado":s?.products??"-"}),e.jsx("div",{className:"text-muted-foreground",children:"Colaboradores:"}),e.jsx("div",{className:"font-medium",children:s?.collaborators??"-"}),e.jsx("div",{className:"text-muted-foreground",children:"Unidades:"}),e.jsx("div",{className:"font-medium",children:s?.locations??"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-1 block",children:"Volume extra de pedidos/m√™s"}),e.jsxs(te,{value:String(Number(d.addons?.orders)||0),onValueChange:S=>o(q=>({...q,addons:{...q.addons||{},orders:Number(S)||0}})),children:[e.jsx(re,{children:e.jsx(ie,{})}),e.jsx(ne,{children:Pa.map(S=>e.jsx(T,{value:String(S.value),children:S.label},S.value))})]})]})]})})(),e.jsx(Es,{onSelectTemplate:s=>{o({...d,permissions:s.permissions,plan:"custom"}),k.success(`Template "${s.name}" aplicado!`)}}),e.jsx(As,{permissions:d.permissions,onChange:s=>{$.log("üîÑ Permissions onChange - Antes:",d.plan),o(h=>{$.log("üîÑ Permissions onChange - Prev plan:",h.plan);const N={...h,permissions:s};return $.log("üîÑ Permissions onChange - Depois:",N.plan),N})},selectedPlan:d.plan,onPlanChange:m}),Ze.length>0&&e.jsxs("div",{className:"space-y-2 pt-4 border-t",children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"Hist√≥rico de Altera√ß√µes"}),e.jsx("div",{className:"bg-muted rounded-lg p-3 max-h-40 overflow-y-auto space-y-2",children:Ze.map(s=>e.jsxs("div",{className:"text-xs bg-white p-2 rounded border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-medium text-foreground",children:s.description}),e.jsx("span",{className:"text-muted-foreground",children:(()=>{const h=new Date(s.created_date),N=String(h.getDate()).padStart(2,"0"),S=String(h.getMonth()+1).padStart(2,"0"),q=h.getFullYear(),Y=String(h.getHours()).padStart(2,"0"),me=String(h.getMinutes()).padStart(2,"0");return`${N}/${S}/${q} ${Y}:${me}`})()})]}),e.jsxs("p",{className:"text-muted-foreground",children:["Por: ",s.changed_by]})]},s.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-1 block",children:"Observa√ß√µes"}),e.jsx("textarea",{value:d.notes||"",onChange:s=>o({...d,notes:s.target.value}),className:"w-full border rounded-lg p-2 text-sm",rows:3,placeholder:"Notas internas sobre o assinante..."})]})]}),e.jsxs(Qe,{children:[e.jsx(b,{variant:"outline",onClick:()=>g(!1),children:"Cancelar"}),e.jsxs(b,{onClick:t,disabled:ke.isPending,className:"bg-primary text-primary-foreground hover:opacity-90",children:[ke.isPending?e.jsx(ue,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Salvar"]})]})]})}),e.jsx(nt,{open:j.open,onClose:()=>y({open:!1,url:null,name:null}),setupUrl:j.url,subscriberName:j.name}),e.jsx(Xs,{open:!!F,onOpenChange:s=>!s&&U(null),children:e.jsxs(ea,{children:[e.jsxs(sa,{children:[e.jsx(aa,{children:"Excluir assinante?"}),e.jsxs(ta,{children:["Esta a√ß√£o √© irrevers√≠vel. O assinante ",e.jsx("strong",{children:F?.name||F?.email})," e todos os dados associados ser√£o removidos. Considerar desativar em vez de excluir para preservar o hist√≥rico."]})]}),e.jsxs(ra,{children:[e.jsx(ia,{children:"Cancelar"}),e.jsx(na,{className:"bg-red-600 hover:bg-red-700",onClick:()=>{F&&(We.mutate(F.id),U(null))},children:"Excluir"})]})]})})]})}export{Fr as default};
