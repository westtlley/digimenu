const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/cloudinaryUpload-vqCefYaz.js","assets/main-5wCJ0shd.js","assets/main-BtcpJIrZ.css"])))=>i.map(i=>d[i]);
import{c as te,r as n,o as _t,j as e,P as K,B as _,u as we,X as L,d as $t,_ as Ct,z as X,T as ee,L as lt,p as ae,g as Me,e as ze,f as Ve,E as St}from"./main-5wCJ0shd.js";import{b as $}from"./base44Client-BjweZdup.js";import{u as ie}from"./useQuery-TBRlwA9F.js";import{u as oe}from"./useMutation-CfjUJVgq.js";import{B as W}from"./badge-tC6tpDVj.js";import{L as he,I as Ye}from"./label-BGurCIwA.js";import{u as nt}from"./useSlugContext-DE6V1uue.js";import{O as V,R as Je,D as We,V as Et}from"./constants-BZ6YHCOj.js";import{f as pe}from"./formatters-CvOEClq0.js";import{D as Ne,a as _e,b as $e,c as Ce}from"./dialog-BQt4A9EY.js";import{D as Se}from"./dollar-sign-BdBkW913.js";import{T as ve}from"./trending-up-8OxCq5vE.js";import{C as se}from"./clock-8p17jiPd.js";import{D as Rt}from"./download-DOPNSAwp.js";import{T as Ee}from"./textarea-BBItVPmi.js";import{C as Ot}from"./camera-BlP5SAbE.js";import{C as it}from"./check-b5qncWl4.js";import{S as Be}from"./star-BGayr--b.js";import{C as Pt}from"./chevron-left-BxOhQUkW.js";import{C as Tt}from"./chevron-right-CodG0qo6.js";import{C as It}from"./ColaboradorProfile-hI86Ih0T.js";import{S as fe}from"./switch-CiXzU0WK.js";import{B as Dt}from"./bell-BP42pcPs.js";import{V as kt}from"./volume-2-tCXURf6C.js";import{P as At}from"./play-Cg3R6ahj.js";import{M as qt,S as zt}from"./sun-DNFYo3QJ.js";import{m as v}from"./proxy-CaN4jGBq.js";import{M as B}from"./map-pin-Cc9ILfAa.js";import{Z as Vt}from"./zap-BFRB5ZLZ.js";import{C as J}from"./circle-check-big-C21gM6y_.js";import{N as ne}from"./navigation-BASsHeDs.js";import{S as Ze}from"./store-DBfh0a_B.js";import{A as Ke}from"./index-BrRbWNqX.js";import{P as ot}from"./phone-DEvhMYo9.js";import{M as Lt}from"./message-circle-CIMJfci3.js";import{I as Ft}from"./InstallAppButton-D7LO9hfL.js";import{C as Ht}from"./coffee-DFAoqCUI.js";import{C as Bt}from"./index-DJsYT-OT.js";import{C as Kt}from"./chevron-down-LYt6GC0H.js";import"./card-co3zywKC.js";import{P as Xe}from"./progress-C57mHLoD.js";import{T as Ut}from"./target-DVKGgDzt.js";import{u as Qt}from"./usePermission-CvwVjOfT.js";import{U as Le}from"./user-SYMNLJbz.js";import{C as et}from"./circle-help-BqbVHdsR.js";import{S as tt}from"./settings-CVkD5Rnm.js";import{L as st}from"./log-out-DCopNCEG.js";import{M as Gt}from"./menu-RhFNat6_.js";import"./index-BjH-urEE.js";import"./index-DJGIH_vd.js";import"./index-XPl2RJU8.js";import"./save-CE2DQko5.js";import"./PlanPresets-DhKoJrBx.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}],["line",{x1:"6",x2:"6",y1:"11",y2:"13",key:"1wd6dw"}]],Yt=te("BatteryLow",Mt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=[["line",{x1:"3",x2:"15",y1:"22",y2:"22",key:"xegly4"}],["line",{x1:"4",x2:"14",y1:"9",y2:"9",key:"xcnuvu"}],["path",{d:"M14 22V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v18",key:"16j0yd"}],["path",{d:"M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 0 2 2a2 2 0 0 0 2-2V9.83a2 2 0 0 0-.59-1.42L18 5",key:"7cu91f"}]],Wt=te("Fuel",Jt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=[["path",{d:"M12.75 7.09a3 3 0 0 1 2.16 2.16",key:"1d4wjd"}],["path",{d:"M17.072 17.072c-1.634 2.17-3.527 3.912-4.471 4.727a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 1.432-4.568",key:"12yil7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.475 2.818A8 8 0 0 1 20 10c0 1.183-.31 2.377-.81 3.533",key:"lhrkcz"}],["path",{d:"M9.13 9.13a3 3 0 0 0 3.74 3.74",key:"13wojd"}]],Xt=te("MapPinOff",Zt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]],ts=te("PhoneOff",es);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]],as=te("Route",ss);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]],ls=te("Utensils",rs);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=[["path",{d:"m2 8 2 2-2 2 2 2-2 2",key:"sv1b1"}],["path",{d:"m22 8-2 2 2 2-2 2 2 2",key:"101i4y"}],["rect",{width:"8",height:"14",x:"8",y:"5",rx:"1",key:"1oyrl4"}]],is=te("Vibrate",ns);function os(){const[s,t]=n.useState(null),[r,l]=n.useState(null),[a,m]=n.useState(!0),{subscriberEmail:d,inSlugContext:u}=nt();return n.useEffect(()=>{(async()=>{try{const h=await $.auth.me();t(h);const i=u&&h?.is_master&&d?d:void 0;try{const b=(await $.entities.Entregador.list(null,i?{as_subscriber:i}:{})).find(p=>p.email?.toLowerCase().trim()===h.email?.toLowerCase().trim());if(b)l(b);else if(h.is_master||h.profile_role==="entregador"){const p={id:h.is_master?"master-"+h.email:"user-"+h.email,name:h.full_name||h.email.split("@")[0],email:h.email,phone:h.phone||"(00) 00000-0000",photo:h.photo||h.google_photo,status:"available",total_deliveries:0,total_earnings:0,rating:5,dark_mode:!1,sound_enabled:!0,notifications_enabled:!0,vibration_enabled:!0,_isMaster:h.is_master,_isVirtual:!0,_subscriberEmail:h.subscriber_email||h.email};l(p)}}catch(x){console.warn("Erro ao buscar entregador (backend valida acesso):",x)}}catch(h){console.error("Erro de autentica√ß√£o:",h),$.auth.redirectToLogin("/Entregador")}finally{m(!1)}})()},[u,d]),{user:s,entregador:r,loading:a,asSubscriber:u&&s?.is_master&&d?d:void 0,isMaster:s?.is_master||!1}}function cs(s,t,r=!1){const{data:l=[]}=ie({queryKey:["deliveryOrders",s,t??"me"],queryFn:()=>$.entities.Order.filter({entregador_id:s,...t&&{as_subscriber:t}}),enabled:!!s&&!r,refetchInterval:Je.ORDERS}),{data:a=[]}=ie({queryKey:["allDeliveryOrders",t??"me"],queryFn:async()=>(await $.entities.Order.list(null,t?{as_subscriber:t}:{})).filter(x=>[V.GOING_TO_STORE,V.ARRIVED_AT_STORE,V.PICKED_UP,V.OUT_FOR_DELIVERY,V.ARRIVED_AT_CUSTOMER].includes(x.status)),enabled:r,refetchInterval:Je.ORDERS}),m=r?a:l,d=n.useMemo(()=>m.filter(i=>[V.GOING_TO_STORE,V.ARRIVED_AT_STORE,V.PICKED_UP,V.OUT_FOR_DELIVERY,V.ARRIVED_AT_CUSTOMER].includes(i.status)),[m]),u=n.useMemo(()=>m.filter(i=>i.status===V.DELIVERED),[m]),g=n.useMemo(()=>{const i=new Date;return i.setHours(0,0,0,0),u.filter(x=>{if(!x.delivered_at)return!1;const b=new Date(x.delivered_at);return b.setHours(0,0,0,0),b.getTime()===i.getTime()})},[u]),h=n.useMemo(()=>{const i=g.reduce((b,p)=>b+(p.delivery_fee||0),0),x=g.length>0?g.reduce((b,p)=>{if(!p.picked_up_at||!p.delivered_at)return b;const C=new Date(p.picked_up_at),j=new Date(p.delivered_at);return b+(j-C)/6e4},0)/g.length:0;return{active:d.length,completed:u.length,completedToday:g.length,todayEarnings:i,avgDeliveryTime:Math.round(x)}},[d,u,g]);return{orders:m,activeOrders:d,completedOrders:u,completedOrdersToday:g,stats:h}}function ds(s){const[t,r]=n.useState(null),[l,a]=n.useState(!1),[m,d]=n.useState(null),u=n.useCallback(async g=>{if(!g||!g.trim()){r(null);return}a(!0),d(null);try{const h=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(g)}&limit=1`,{headers:{"User-Agent":`${_t}/1.0`}});if(!h.ok)throw new Error("Erro ao buscar coordenadas");const i=await h.json();i&&i.length>0?r({lat:parseFloat(i[0].lat),lng:parseFloat(i[0].lon)}):(r(We),d("Endere√ßo n√£o encontrado"))}catch(h){console.error("Erro na geocodifica√ß√£o:",h),r(We),d(h.message||"Erro ao buscar coordenadas")}finally{a(!1)}},[]);return n.useEffect(()=>{s?u(s):r(null)},[s,u]),{coordinates:t,loading:l,error:m,geocode:u}}function Fe(s,t){if(!s||!t)return 0;const r=(t.lng-s.lng)*Math.PI/180,l=s.lat*Math.PI/180,a=t.lat*Math.PI/180,m=Math.sin(r)*Math.cos(a),d=Math.cos(l)*Math.sin(a)-Math.sin(l)*Math.cos(a)*Math.cos(r);return(Math.atan2(m,d)*180/Math.PI+360)%360}function be(s=0,t=!1){const a=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 56 56">
    <defs>
      <linearGradient id="g" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#f97316"/><stop offset="100%" stop-color="#ea580c"/></linearGradient>
      <filter id="shadow">
        <feGaussianBlur in="SourceAlpha" stdDeviation="2"/>
        <feOffset dx="0" dy="2" result="offsetblur"/>
        <feComponentTransfer>
          <feFuncA type="linear" slope="0.3"/>
        </feComponentTransfer>
        <feMerge>
          <feMergeNode/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>
    </defs>
    <g transform="rotate(${s-90} 28 28)">
      <!-- Sombra animada (pulso) -->
      <circle cx="28" cy="28" r="20" fill="#000" opacity="${t?.3:.2}" filter="url(#shadow)"/>
      <!-- Moto -->
      <path d="M14 34 Q16 28 22 26 L34 26 Q40 26 44 28 L48 32 L46 34 L42 30 Q38 28 34 28 L22 28 Q18 30 16 34 Z" fill="url(#g)" stroke="#c2410c" stroke-width="1" filter="url(#shadow)"/>
      <ellipse cx="28" cy="26" rx="6" ry="2.5" fill="#fef3c7" stroke="#c2410c"/>
      <circle cx="48" cy="30" r="2" fill="#fef9c3"/>
      <circle cx="14" cy="40" r="6" fill="#475569" stroke="#1e293b" stroke-width="1"/>
      <circle cx="44" cy="40" r="6" fill="#475569" stroke="#1e293b" stroke-width="1"/>
    </g>
  </svg>`;return"data:image/svg+xml,"+encodeURIComponent(a)}function ct(s){return s<.5?4*s*s*s:1-Math.pow(-2*s+2,3)/2}function at(s,t,r,l=2e3,a,m=null){if(!s||!t||!r)return;let d;const u=performance.now(),g=()=>{d!=null&&(cancelAnimationFrame(d),d=null)};a&&(a.current=g);function h(i){const x=i-u,b=Math.min(x/l,1),p=ct(b),C=t.lat+(r.lat-t.lat)*p,j=t.lng+(r.lng-t.lng)*p;s.setPosition({lat:C,lng:j}),m&&m({progress:b,eased:p,position:{lat:C,lng:j}}),b<1&&(d=requestAnimationFrame(h))}d=requestAnimationFrame(h)}function ms(s,t,r=3e3,l,a=null){if(!s||!t||t.length<2)return;let m;const d=performance.now(),u=()=>{m!=null&&(cancelAnimationFrame(m),m=null)};l&&(l.current=u);function g(h){const i=h-d,x=Math.min(i/r,1),b=ct(x),p=t.length-1,C=b*p,j=Math.floor(C),f=C-j;if(j>=p){s.setPosition(t[t.length-1]),a&&a({progress:1,eased:1,position:t[t.length-1]});return}const N=t[j],c=t[j+1],F=N.lat+(c.lat-N.lat)*f,q=N.lng+(c.lng-N.lng)*f;s.setPosition({lat:F,lng:q}),a&&a({progress:x,eased:b,position:{lat:F,lng:q},segmentIndex:j,segmentT:f}),x<1&&(m=requestAnimationFrame(g))}m=requestAnimationFrame(g)}const xs=[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]}];function us({entregadorLocation:s,storeLocation:t,customerLocation:r,order:l,darkMode:a=!1,mode:m="entregador",onNavigate:d}){n.useRef(null);const u=n.useRef(null),g=n.useRef(null),h=n.useRef(null),i=n.useRef(null),x=n.useRef(null),b=n.useRef(null),p=n.useRef(null),C=n.useRef(null),j=n.useRef([]),f=n.useRef(null),[N,c]=n.useState(!1),[F,q]=n.useState(null),[E,re]=n.useState([]),[Re,ce]=n.useState(null),[le,Oe]=n.useState(!1),Q="",Pe=!!(r||t);return n.useEffect(()=>{},[Q,Pe,a]),n.useEffect(()=>{const S=u.current;S&&S.setOptions({styles:a?xs:void 0})},[N,a]),n.useEffect(()=>{if(!N)return;const S=g.current,P=h.current;t&&S?(S.setPosition(t),S.setVisible(!0)):S&&S.setVisible(!1),r&&P?(P.setPosition(r),P.setVisible(!0)):P&&P.setVisible(!1)},[N,t,r]),n.useEffect(()=>{if(!s||!r){re([]),ce(null);return}{re([]),ce(null),Oe(!1);return}},[s,r,t,l?.status,void 0]),n.useEffect(()=>{const S=x.current;if(!S||!E.length){S&&S.setPath([]);return}S.setPath(E.map(P=>({lat:P.lat,lng:P.lng})))},[N,E]),n.useEffect(()=>{if(!N||!i.current)return;const S=i.current,P=typeof google<"u"?google.maps:null;if(!P)return;if(!s){S.setVisible(!1),p.current=null,j.current=[],b.current&&b.current.setPath([]),f.current&&clearInterval(f.current);return}const z=p.current,D={lat:s.lat,lng:s.lng};if(!z){S.setPosition(D),S.setIcon({url:be(0,!1),scaledSize:new P.Size(48,48),anchor:new P.Point(24,24)}),S.setVisible(!0),p.current={...D},j.current=[{...D}],f.current&&clearInterval(f.current);let k=!1;f.current=setInterval(()=>{if(!S.getVisible())return;k=!k;const G=p.current?Fe(p.current,D):0;S.setIcon({url:be(G,k),scaledSize:new P.Size(48,48),anchor:new P.Point(24,24)})},1e3);return}const de=Math.hypot(D.lat-z.lat,D.lng-z.lng),U=Math.min(3e3,Math.max(500,de/1e-4)),O=Fe(z,D);if(E.length>=2){let k=0,G=1/0;E.forEach((M,R)=>{const y=Math.hypot(M.lat-D.lat,M.lng-D.lng);y<G&&(G=y,k=R)});const Ie=E.slice(Math.max(0,k-1),Math.min(E.length,k+3));Ie.length>=2?(C.current?.(),ms(S,Ie,U,C,({position:M})=>{if(j.current.push({...M}),j.current.length>20&&j.current.shift(),b.current&&j.current.length>=2&&b.current.setPath(j.current.map(R=>({lat:R.lat,lng:R.lng}))),j.current.length>=2){const R=j.current[j.current.length-2],xe=Fe(R,M);S.setIcon({url:be(xe,!1),scaledSize:new P.Size(48,48),anchor:new P.Point(24,24)})}})):(C.current?.(),at(S,z,D,U,C,({position:M})=>{j.current.push({...M}),j.current.length>20&&j.current.shift(),b.current&&j.current.length>=2&&b.current.setPath(j.current.map(R=>({lat:R.lat,lng:R.lng})))}))}else C.current?.(),at(S,z,D,U,C,({position:k})=>{j.current.push({...k}),j.current.length>20&&j.current.shift(),b.current&&j.current.length>=2&&b.current.setPath(j.current.map(G=>({lat:G.lat,lng:G.lng})))});S.setIcon({url:be(O,!1),scaledSize:new P.Size(48,48),anchor:new P.Point(24,24)}),S.setVisible(!0),p.current={...D},j.current.push({...D}),j.current.length>20&&j.current.shift(),b.current&&j.current.length>=2&&b.current.setPath(j.current.map(k=>({lat:k.lat,lng:k.lng})))},[N,s,E]),n.useEffect(()=>{const S=u.current;!S||!s||S.panTo({lat:s.lat,lng:s.lng})},[N,s]),e.jsxs("div",{className:"h-full flex flex-col items-center justify-center bg-gray-100 dark:bg-gray-800 rounded-xl",children:[e.jsx("span",{className:"text-4xl mb-2",children:"üó∫Ô∏è"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm text-center px-4",children:"Configure VITE_GOOGLE_MAPS_KEY no .env para exibir o mapa."})]})}function gs({entregadorId:s,darkMode:t,isOpen:r,onClose:l}){const[a,m]=n.useState("today"),d=f=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(f||0),u=f=>new Date(f).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),{data:g=[],isLoading:h}=ie({queryKey:["delivery-earnings",s,a],queryFn:async()=>await $.get("/delivery-earnings",{entregador_id:s,period:a})||[],enabled:r&&!!s}),i=g.reduce((f,N)=>f+parseFloat(N.amount||0),0),x=g.length,b=x>0?i/x:0,p=g.filter(f=>f.paid).reduce((f,N)=>f+parseFloat(N.amount||0),0),C=i-p,j=()=>{const f=g.map(E=>({data:u(E.delivered_at),pedido:E.order_id||"N/A",valor:E.amount,tipo:E.calculation_type,distancia:E.distance_km?`${E.distance_km} km`:"N/A",pago:E.paid?"Sim":"N√£o"})),N=[["Data","Pedido","Valor","Tipo de C√°lculo","Dist√¢ncia","Pago"],...f.map(E=>[E.data,E.pedido,E.valor,E.tipo,E.distancia,E.pago])].map(E=>E.join(",")).join(`
`),c=new Blob([N],{type:"text/csv;charset=utf-8;"}),F=window.URL.createObjectURL(c),q=document.createElement("a");q.href=F,q.download=`ganhos-${a}-${new Date().toISOString().split("T")[0]}.csv`,q.click(),window.URL.revokeObjectURL(F)};return e.jsx(Ne,{open:r,onOpenChange:l,children:e.jsxs(_e,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx($e,{children:e.jsx(Ce,{className:"text-2xl font-bold",children:"Meus Ganhos"})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex gap-2 flex-wrap",children:["today","week","month","all"].map(f=>e.jsx("button",{onClick:()=>m(f),className:`px-4 py-2 rounded-lg text-sm font-medium transition ${a===f?"bg-orange-500 text-white":t?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:f==="today"?"Hoje":f==="week"?"7 Dias":f==="month"?"30 Dias":"Todos"},f))}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:`p-4 rounded-xl ${t?"bg-gray-800":"bg-green-50"} border ${t?"border-gray-700":"border-green-200"}`,children:[e.jsx(Se,{className:`w-6 h-6 mb-2 ${t?"text-green-400":"text-green-600"}`}),e.jsx("p",{className:`text-xs ${t?"text-gray-400":"text-gray-600"}`,children:"Total Ganho"}),e.jsx("p",{className:`font-bold text-xl ${t?"text-white":"text-green-700"}`,children:d(i)})]}),e.jsxs("div",{className:`p-4 rounded-xl ${t?"bg-gray-800":"bg-blue-50"} border ${t?"border-gray-700":"border-blue-200"}`,children:[e.jsx(K,{className:`w-6 h-6 mb-2 ${t?"text-blue-400":"text-blue-600"}`}),e.jsx("p",{className:`text-xs ${t?"text-gray-400":"text-gray-600"}`,children:"Entregas"}),e.jsx("p",{className:`font-bold text-xl ${t?"text-white":"text-blue-700"}`,children:x})]}),e.jsxs("div",{className:`p-4 rounded-xl ${t?"bg-gray-800":"bg-purple-50"} border ${t?"border-gray-700":"border-purple-200"}`,children:[e.jsx(ve,{className:`w-6 h-6 mb-2 ${t?"text-purple-400":"text-purple-600"}`}),e.jsx("p",{className:`text-xs ${t?"text-gray-400":"text-gray-600"}`,children:"M√©dia/Entrega"}),e.jsx("p",{className:`font-bold text-xl ${t?"text-white":"text-purple-700"}`,children:d(b)})]}),e.jsxs("div",{className:`p-4 rounded-xl ${t?"bg-gray-800":"bg-orange-50"} border ${t?"border-gray-700":"border-orange-200"}`,children:[e.jsx(se,{className:`w-6 h-6 mb-2 ${t?"text-orange-400":"text-orange-600"}`}),e.jsx("p",{className:`text-xs ${t?"text-gray-400":"text-gray-600"}`,children:"A Receber"}),e.jsx("p",{className:`font-bold text-xl ${t?"text-white":"text-orange-700"}`,children:d(C)})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(_,{onClick:j,variant:"outline",size:"sm",children:[e.jsx(Rt,{className:"w-4 h-4 mr-2"}),"Exportar CSV"]})}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:h?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:t?"text-gray-400":"text-gray-600",children:"Carregando..."})}):g.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:t?"text-gray-400":"text-gray-600",children:"Nenhum ganho encontrado neste per√≠odo"})}):g.map(f=>e.jsx("div",{className:`p-4 rounded-lg border ${t?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("p",{className:`font-medium ${t?"text-white":"text-gray-900"}`,children:["Pedido #",f.order_id||"N/A"]}),f.paid&&e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-green-100 text-green-700",children:"Pago"})]}),e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:u(f.delivered_at)}),e.jsxs("div",{className:"flex gap-4 mt-2 text-xs",children:[e.jsxs("span",{className:t?"text-gray-400":"text-gray-600",children:["Tipo: ",f.calculation_type||"N/A"]}),f.distance_km&&e.jsxs("span",{className:t?"text-gray-400":"text-gray-600",children:["Dist√¢ncia: ",parseFloat(f.distance_km).toFixed(2)," km"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:`font-bold text-lg ${t?"text-green-400":"text-green-600"}`,children:d(f.amount)})})]})},f.id))})]})]})})}function hs({order:s,entregador:t,onClose:r,onConfirm:l,darkMode:a}){const[m,d]=n.useState(""),[u,g]=n.useState(""),[h,i]=n.useState(!1),x=n.useRef(null),b=we(),p=oe({mutationFn:f=>$t.entities.DeliveryProof.create(f),onSuccess:()=>{b.invalidateQueries({queryKey:["deliveryOrders"]}),b.invalidateQueries({queryKey:["allDeliveryOrders"]}),l&&l(),r()}}),C=async f=>{const N=f.target.files[0];if(N){i(!0);try{const{uploadToCloudinary:c}=await Ct(async()=>{const{uploadToCloudinary:q}=await import("./cloudinaryUpload-vqCefYaz.js");return{uploadToCloudinary:q}},__vite__mapDeps([0,1,2])),F=await c(N,"delivery-proofs");d(F)}catch{alert("Erro ao fazer upload da foto")}finally{i(!1)}}},j=()=>{p.mutate({order_id:s.id,entregador_id:t.id,photo_url:m,notes:u,delivered_at:new Date().toISOString()})};return e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:`${a?"bg-gray-800":"bg-white"} rounded-2xl max-w-lg w-full p-6`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:`text-xl font-bold ${a?"text-white":"text-gray-900"}`,children:"Comprovante de Entrega"}),e.jsx("button",{onClick:r,className:"p-2 rounded-lg hover:bg-gray-100",children:e.jsx(L,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Foto da Entrega (Opcional)"}),e.jsx("input",{ref:x,type:"file",accept:"image/*",capture:"environment",onChange:C,className:"hidden"}),m?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:m,alt:"Comprovante",className:"w-full h-48 object-cover rounded-lg"}),e.jsx("button",{onClick:()=>d(""),className:"absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full",children:e.jsx(L,{className:"w-4 h-4"})})]}):e.jsx("button",{onClick:()=>x.current?.click(),disabled:h,className:`w-full h-32 border-2 border-dashed rounded-lg flex flex-col items-center justify-center ${a?"border-gray-600 bg-gray-700":"border-gray-300 bg-gray-50"}`,children:h?e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}):e.jsxs(e.Fragment,{children:[e.jsx(Ot,{className:"w-8 h-8 text-gray-400 mb-2"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Tirar foto"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Observa√ß√µes (Opcional)"}),e.jsx(Ee,{value:u,onChange:f=>g(f.target.value),placeholder:"Ex: Entregue na portaria, deixado com vizinho...",rows:3})]}),e.jsxs(_,{onClick:j,disabled:p.isPending,className:"w-full bg-green-500 hover:bg-green-600 text-white",children:[e.jsx(it,{className:"w-5 h-5 mr-2"}),"Confirmar Entrega"]})]})]})})}function ps({order:s,entregador:t,onClose:r,darkMode:l}){const[a,m]=n.useState(5),[d,u]=n.useState(""),[g,h]=n.useState(0),i=we(),x=oe({mutationFn:p=>$.entities.DeliveryRating.create(p),onSuccess:()=>{i.invalidateQueries({queryKey:["deliveryOrders"]}),r()}}),b=()=>{x.mutate({order_id:s.id,entregador_id:t.id,rating:a,comment:d,rated_by:"entregador"})};return e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:`${l?"bg-gray-800":"bg-white"} rounded-2xl max-w-lg w-full p-6`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:`text-xl font-bold ${l?"text-white":"text-gray-900"}`,children:"Avaliar Cliente"}),e.jsx("button",{onClick:r,className:"p-2 rounded-lg hover:bg-gray-100",children:e.jsx(L,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:`text-sm mb-3 ${l?"text-gray-300":"text-gray-600"}`,children:"Como foi sua experi√™ncia com este cliente?"}),e.jsx("p",{className:"font-bold text-lg mb-4",children:s.customer_name}),e.jsx("div",{className:"flex justify-center gap-2 mb-2",children:[1,2,3,4,5].map(p=>e.jsx("button",{onClick:()=>m(p),onMouseEnter:()=>h(p),onMouseLeave:()=>h(0),className:"transition-transform hover:scale-110",children:e.jsx(Be,{className:`w-10 h-10 ${(g||a)>=p?"fill-yellow-400 text-yellow-400":"text-gray-300"}`})},p))}),e.jsxs("p",{className:"text-sm text-gray-500",children:[a===1&&"Muito ruim",a===2&&"Ruim",a===3&&"Regular",a===4&&"Bom",a===5&&"Excelente"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Coment√°rio (Opcional)"}),e.jsx(Ee,{value:d,onChange:p=>u(p.target.value),placeholder:"Deixe um coment√°rio sobre o atendimento...",rows:3})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(_,{onClick:r,variant:"outline",className:"flex-1",children:"Pular"}),e.jsx(_,{onClick:b,disabled:x.isPending,className:"flex-1 bg-blue-500 hover:bg-blue-600 text-white",children:"Enviar Avalia√ß√£o"})]})]})]})})}const Z=[{title:"Bem-vindo!",description:"Este √© o painel de entregas. Aqui voc√™ gerencia seus pedidos e acompanha seus ganhos.",icon:"üëã"},{title:"Status de Disponibilidade",description:"Ative/desative sua disponibilidade para receber novos pedidos. S√≥ receba quando estiver pronto!",icon:"üü¢"},{title:"Pedidos Ativos",description:"Veja todos os pedidos que voc√™ precisa entregar. Clique em um pedido para ver os detalhes completos.",icon:"üì¶"},{title:"Navega√ß√£o GPS",description:"Use o mapa para ver a rota e o bot√£o de navega√ß√£o para abrir no Google Maps ou Waze.",icon:"üó∫Ô∏è"},{title:"C√≥digo de Valida√ß√£o",description:"Cada entrega tem um c√≥digo de 4 d√≠gitos. O cliente ir√° fornecer este c√≥digo ao receber o pedido.",icon:"üî¢"},{title:"Comprovante de Entrega",description:"Tire uma foto e deixe observa√ß√µes para comprovar que a entrega foi realizada.",icon:"üì∏"},{title:"Relat√≥rio de Ganhos",description:"Acompanhe seus ganhos di√°rios, semanais e mensais. Exporte relat√≥rios quando precisar.",icon:"üí∞"}];function fs({onClose:s,darkMode:t}){const[r,l]=n.useState(0),[a,m]=n.useState(!1),d=()=>{r<Z.length-1?l(r+1):(a&&localStorage.setItem("entregador_tutorial_never_show","true"),s())},u=()=>{r>0&&l(r-1)},g=Z[r];return e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:`${t?"bg-gray-800":"bg-white"} rounded-2xl max-w-lg w-full p-6`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:`text-xl font-bold ${t?"text-white":"text-gray-900"}`,children:"Tutorial"}),e.jsx("button",{onClick:s,className:"p-2 rounded-lg hover:bg-gray-100",children:e.jsx(L,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex justify-between mb-2",children:Z.map((h,i)=>e.jsx("div",{className:`h-1 flex-1 mx-1 rounded-full ${i<=r?"bg-blue-500":t?"bg-gray-700":"bg-gray-200"}`},i))}),e.jsxs("p",{className:"text-xs text-gray-500 text-center",children:[r+1," de ",Z.length]})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:g.icon}),e.jsx("h3",{className:`text-2xl font-bold mb-3 ${t?"text-white":"text-gray-900"}`,children:g.title}),e.jsx("p",{className:`text-lg ${t?"text-gray-300":"text-gray-600"}`,children:g.description})]}),r===Z.length-1&&e.jsx("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a,onChange:h=>m(h.target.checked),className:"w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"N√£o mostrar este tutorial novamente"})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(_,{onClick:u,disabled:r===0,variant:"outline",className:"flex-1",children:[e.jsx(Pt,{className:"w-5 h-5 mr-2"}),"Anterior"]}),e.jsxs(_,{onClick:d,className:"flex-1 bg-blue-500 hover:bg-blue-600 text-white",children:[r===Z.length-1?"Finalizar":"Pr√≥ximo",r<Z.length-1&&e.jsx(Tt,{className:"w-5 h-5 ml-2"})]})]})]})})}function bs({entregador:s,onClose:t,onDarkModeChange:r}){const[l,a]=n.useState({notifications_enabled:s.notifications_enabled??!0,sound_enabled:s.sound_enabled??!0,vibration_enabled:s.vibration_enabled??!0,dark_mode:s.dark_mode??!1}),m=we(),d=oe({mutationFn:i=>s._isMaster?Promise.resolve(i):$.entities.Entregador.update(s.id,i),onSuccess:()=>{m.invalidateQueries({queryKey:["entregador"]}),t()}}),u=i=>{const x={...l,[i]:!l[i]};a(x),i==="dark_mode"&&r(x.dark_mode)},g=()=>{l.notifications_enabled&&"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission().then(i=>{i==="granted"?X.success("Permiss√£o de notifica√ß√µes concedida!"):X.error("Permiss√£o negada. Ative nas configura√ß√µes do navegador.")}),d.mutate({...s,...l})},h=()=>{const i=new Audio("https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3");i.volume=.8,i.play().catch(()=>X.error("Erro ao reproduzir som")),l.vibration_enabled&&navigator.vibrate&&navigator.vibrate([300,100,300]),X.success("Som de teste reproduzido!")};return e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:`${l.dark_mode?"bg-gray-800":"bg-white"} rounded-2xl max-w-lg w-full p-6`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:`text-xl font-bold ${l.dark_mode?"text-white":"text-gray-900"}`,children:"Configura√ß√µes"}),e.jsx("button",{onClick:t,className:"p-2 rounded-lg hover:bg-gray-100",children:e.jsx(L,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Dt,{className:"w-5 h-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx(he,{children:"Notifica√ß√µes Push"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Receba alertas de novos pedidos"})]})]}),e.jsx(fe,{checked:l.notifications_enabled,onCheckedChange:()=>u("notifications_enabled")})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(kt,{className:"w-5 h-5 text-green-500"}),e.jsxs("div",{children:[e.jsx(he,{children:"Som"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Alertas sonoros"})]})]}),e.jsx(fe,{checked:l.sound_enabled,onCheckedChange:()=>u("sound_enabled")})]}),l.sound_enabled&&e.jsxs("button",{onClick:h,className:"mt-2 ml-8 text-xs text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[e.jsx(At,{className:"w-3 h-3"}),"Testar Som"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(is,{className:"w-5 h-5 text-purple-500"}),e.jsxs("div",{children:[e.jsx(he,{children:"Vibra√ß√£o"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Vibrar ao receber pedidos"})]})]}),e.jsx(fe,{checked:l.vibration_enabled,onCheckedChange:()=>u("vibration_enabled")})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[l.dark_mode?e.jsx(qt,{className:"w-5 h-5 text-indigo-500"}):e.jsx(zt,{className:"w-5 h-5 text-yellow-500"}),e.jsxs("div",{children:[e.jsx(he,{children:"Modo Escuro"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Tema escuro para a noite"})]})]}),e.jsx(fe,{checked:l.dark_mode,onCheckedChange:()=>u("dark_mode")})]}),e.jsx(_,{onClick:g,disabled:d.isPending,className:"w-full bg-blue-500 hover:bg-blue-600 text-white",children:"Salvar Configura√ß√µes"})]})]})})}function ys({entregador:s,enabled:t}){const r=n.useRef(0),l=n.useRef(null),a=n.useRef(!1),{data:m=[]}=ie({queryKey:["availableOrdersNotif"],queryFn:async()=>(await $.entities.Order.filter({status:"ready",delivery_method:"delivery"})).filter(u=>!u.entregador_id),enabled:t&&s?.status==="available",refetchInterval:3e3});return n.useEffect(()=>{!t||a.current||"Notification"in window&&Notification.permission==="default"&&(Notification.requestPermission().then(d=>{d==="granted"&&X.success("Notifica√ß√µes ativadas! ‚úÖ")}),a.current=!0)},[t]),n.useEffect(()=>(l.current=new Audio("https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"),l.current.volume=.8,l.current.load(),()=>{l.current&&(l.current.pause(),l.current=null)}),[]),n.useEffect(()=>{if(!t||!s)return;const d=m.length;if(d>r.current&&r.current>0){const u=d-r.current;if(s.sound_enabled!==!1&&l.current&&l.current.play().catch(g=>console.log("Audio play failed:",g)),s.vibration_enabled!==!1&&navigator.vibrate&&navigator.vibrate([300,100,300,100,300]),Notification.permission==="granted"){const g=new Notification("üö¥ Novo Pedido Dispon√≠vel!",{body:`${u} ${u===1?"pedido pronto":"pedidos prontos"} para entrega`,icon:"/icon.png",badge:"/badge.png",tag:"new-order",requireInteraction:!0,vibrate:[300,100,300]});g.onclick=()=>{window.focus(),g.close()},setTimeout(()=>g.close(),1e4)}X.success(`üö¥ ${u} ${u===1?"Novo pedido":"Novos pedidos"} dispon√≠vel para entrega!`,{duration:5e3,style:{background:"#10b981",color:"white",fontWeight:"bold"}})}r.current=d},[m,t,s]),null}const js=["Muito longe da minha localiza√ß√£o","Problema no ve√≠culo","Fora da minha rota atual","Hor√°rio de pausa/descanso","Outro motivo"];function vs({order:s,onConfirm:t,onCancel:r}){const[l,a]=n.useState(""),[m,d]=n.useState(""),[u,g]=n.useState(!1),h=l&&(l!=="Outro motivo"||m.trim()),i=async()=>{if(!h)return;g(!0);const x=l==="Outro motivo"?m:l;try{await t(x)}catch(b){console.error("Erro ao rejeitar:",b),g(!1)}};return e.jsx("div",{className:"fixed inset-0 z-[110] flex items-center justify-center bg-black/90 backdrop-blur-sm",children:e.jsxs(v.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-amber-500 to-orange-500 p-4",children:e.jsxs("div",{className:"flex items-center gap-3 text-white",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx(ee,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:"Rejeitar Pedido"}),e.jsx("p",{className:"text-xs text-orange-100",children:"Informe o motivo da recusa"})]})]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Pedido que ser√° rejeitado:"}),e.jsxs("p",{className:"font-semibold text-gray-900",children:["#",s.order_code]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:s.address})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Motivo da rejei√ß√£o *"}),e.jsx("div",{className:"space-y-2",children:js.map(x=>e.jsx("button",{onClick:()=>a(x),className:`w-full text-left px-4 py-3 rounded-lg border-2 transition-all ${l===x?"border-red-500 bg-red-50 text-red-700":"border-gray-200 bg-white hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:x}),l===x&&e.jsx("div",{className:"w-5 h-5 bg-red-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs",children:"‚úì"})})]})},x))})]}),l==="Outro motivo"&&e.jsx(v.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},children:e.jsx(Ee,{value:m,onChange:x=>d(x.target.value),placeholder:"Descreva o motivo...",className:"min-h-[80px]"})}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:e.jsx("p",{className:"text-xs text-yellow-700 text-center",children:"‚ö†Ô∏è Este motivo ser√° registrado e enviado ao gestor"})})]}),e.jsxs("div",{className:"p-4 bg-gray-50 border-t space-y-2",children:[e.jsx(_,{onClick:i,disabled:!h||u,className:"w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-3",children:u?"Rejeitando...":"Confirmar Rejei√ß√£o"}),e.jsx(_,{onClick:r,disabled:u,variant:"outline",className:"w-full",children:"Voltar"})]})]})})}function ws({order:s,onAccept:t,onReject:r}){const[l,a]=n.useState(!1),[m,d]=n.useState(!1),u=i=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(i||0),g=async()=>{d(!0);try{await t(s.id)}catch(i){console.error("Erro ao aceitar:",i),d(!1)}},h=async i=>{d(!0);try{await r(s.id,i),a(!1)}catch(x){console.error("Erro ao rejeitar:",x),d(!1)}};return l?e.jsx(vs,{order:s,onConfirm:h,onCancel:()=>a(!1)}):e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/90 backdrop-blur-sm",children:e.jsxs(v.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0,boxShadow:["0 0 0 0 rgba(239, 68, 68, 0)","0 0 0 20px rgba(239, 68, 68, 0.2)","0 0 0 0 rgba(239, 68, 68, 0)"]},transition:{boxShadow:{duration:2,repeat:1/0,ease:"easeInOut"}},className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-red-500 to-red-600 p-4",children:e.jsxs("div",{className:"flex items-center gap-3 text-white",children:[e.jsx(v.div,{animate:{rotate:[0,10,-10,0]},transition:{duration:.5,repeat:1/0,repeatDelay:1},className:"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx(K,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-lg",children:"üîî Novo Pedido Dispon√≠vel!"}),e.jsx("p",{className:"text-xs text-red-100",children:"Tome uma decis√£o agora"})]})]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Pedido"}),e.jsxs("span",{className:"font-bold text-gray-900",children:["#",s.order_code]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(B,{className:"w-4 h-4 text-red-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-0.5",children:"Entregar em:"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.address}),s.neighborhood&&e.jsx("p",{className:"text-xs text-gray-600 mt-0.5",children:s.neighborhood})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Valor"}),e.jsx("p",{className:"font-bold text-green-600",children:u(s.total)})]})]}),s.delivery_fee>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Taxa entrega"}),e.jsx("p",{className:"font-bold text-blue-600",children:u(s.delivery_fee)})]})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-blue-700 font-medium mb-1",children:"Cliente"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:s.customer_name}),e.jsx("p",{className:"text-xs text-gray-600",children:s.customer_phone})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:e.jsx("p",{className:"text-xs text-yellow-700 text-center",children:"‚è∞ Responda rapidamente para n√£o perder este pedido"})})]}),e.jsxs("div",{className:"p-4 bg-gray-50 border-t space-y-2",children:[e.jsxs(_,{onClick:g,disabled:m,className:"w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-3 text-base",children:[e.jsx(it,{className:"w-5 h-5 mr-2"}),m?"Aceitando...":"Aceitar Pedido"]}),e.jsxs(_,{onClick:()=>a(!0),disabled:m,variant:"outline",className:"w-full border-red-300 text-red-600 hover:bg-red-50 py-3",children:[e.jsx(L,{className:"w-5 h-5 mr-2"}),"Rejeitar Pedido"]})]})]})})}function Ns({entregador:s,onLocationUpdate:t}){return n.useEffect(()=>{if(!s||s._isVirtual||!navigator.geolocation)return;const r=navigator.geolocation.watchPosition(async l=>{const{latitude:a,longitude:m}=l.coords;t({lat:a,lng:m});try{await $.entities.Entregador.update(s.id,{current_latitude:a,current_longitude:m})}catch(d){console.error("Erro ao atualizar localiza√ß√£o:",d)}},l=>{console.error("Erro ao obter localiza√ß√£o:",l)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:5e3});return()=>{navigator.geolocation.clearWatch(r)}},[s,t]),null}const He="pending_messages";function _s(s){const[t,r]=n.useState([]),[l,a]=n.useState(!0);return n.useEffect(()=>{const d=localStorage.getItem(He);if(d)try{r(JSON.parse(d))}catch(u){console.error("Erro ao carregar mensagens:",u)}},[]),n.useEffect(()=>{if(!s)return;const d=async()=>{try{const h=(await $.entities.DeliveryMessage.filter({entregador_id:s,status:"pending"},"-created_date")).filter(i=>!t.find(x=>x.id===i.id));if(h.length>0){const i=[...t,...h];r(i),localStorage.setItem(He,JSON.stringify(i))}}catch(g){console.error("Erro ao buscar mensagens:",g)}finally{a(!1)}};d();const u=setInterval(d,5e3);return()=>clearInterval(u)},[s,t]),{pendingMessages:t,confirmMessage:async d=>{try{const u=typeof d=="string"?d:d?.id;if(!u){console.error("ID de mensagem inv√°lido:",d);return}await $.entities.DeliveryMessage.update(u,{status:"read",read_at:new Date().toISOString()});const g=t.filter(h=>h.id!==u);r(g),localStorage.setItem(He,JSON.stringify(g))}catch(u){console.error("Erro ao confirmar mensagem:",u)}},loading:l}}function $s(){const s=n.useRef(null),t=n.useRef(!1);n.useEffect(()=>(s.current=new Audio("https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"),s.current.loop=!0,s.current.volume=1,()=>{s.current&&(s.current.pause(),s.current=null)}),[]);const r=n.useCallback(()=>{s.current&&!t.current&&(s.current.play().catch(()=>{}),t.current=!0)},[]),l=n.useCallback(()=>{s.current&&(s.current.pause(),s.current.currentTime=0,t.current=!1)},[]),a=n.useCallback(()=>t.current,[]);return{play:r,stop:l,isPlaying:a}}const ye="pending_orders";function Cs(s){const[t,r]=n.useState([]),[l,a]=n.useState(!0),{play:m,stop:d}=$s();n.useEffect(()=>{const x=localStorage.getItem(ye);if(x)try{const b=JSON.parse(x);r(b),b.length>0&&(m(),u())}catch(b){console.error("Erro ao carregar pedidos:",b)}},[]),n.useEffect(()=>{if(!s)return;const x=async()=>{try{const C=(await $.entities.Order.filter({status:"ready",entregador_id:null,delivery_method:"delivery"},"-created_date",10)).filter(j=>!t.find(f=>f.id===j.id));if(C.length>0){const j=[...t,...C];r(j),localStorage.setItem(ye,JSON.stringify(j)),m(),u()}}catch(p){console.error("Erro ao buscar pedidos:",p)}finally{a(!1)}};x();const b=setInterval(x,3e3);return()=>clearInterval(b)},[s,t,m]);const u=n.useCallback(()=>{if(navigator.vibrate){const x=setInterval(()=>{navigator.vibrate([200,100,200])},1e3);window.orderVibrateInterval=x}},[]),g=n.useCallback(()=>{window.orderVibrateInterval&&(clearInterval(window.orderVibrateInterval),window.orderVibrateInterval=null),navigator.vibrate&&navigator.vibrate(0)},[]);return{pendingOrders:t,acceptOrder:async(x,b)=>{try{const C=(await $.entities.Store.list())[0];await $.entities.Order.update(x,{entregador_id:b,status:"going_to_store",store_latitude:C?.store_latitude||-5.0892,store_longitude:C?.store_longitude||-42.8019});const j=t.filter(f=>f.id!==x);return r(j),localStorage.setItem(ye,JSON.stringify(j)),j.length===0&&(d(),g()),!0}catch(p){throw console.error("Erro ao aceitar pedido:",p),p}},rejectOrder:async(x,b)=>{try{await $.entities.OrderLog.create({order_id:x,action:"delivery_rejected",details:`Entregador rejeitou: ${b}`});const p=t.filter(C=>C.id!==x);return r(p),localStorage.setItem(ye,JSON.stringify(p)),p.length===0&&(d(),g()),!0}catch(p){throw console.error("Erro ao rejeitar pedido:",p),p}},loading:l}}function Ss(s){const t=_s(s),r=Cs(s),l=t.pendingMessages.length>0||r.pendingOrders.length>0;return{messages:t,orders:r,hasCriticalAlerts:l,loading:t.loading||r.loading}}const Es=(s,t)=>{if(s.length===0)return{optimizedOrders:[],totalDistance:0,estimatedTime:0};const r=[...s],l=[];let a=t,m=0;for(;r.length>0;){let u=0,g=rt(a,r[0].coordinates);for(let i=1;i<r.length;i++){const x=rt(a,r[i].coordinates);x<g&&(g=x,u=i)}const h=r.splice(u,1)[0];l.push(h),a=h.coordinates,m+=g}const d=Math.round(m/25*60+l.length*7);return{optimizedOrders:l,totalDistance:Math.round(m*10)/10,estimatedTime:d}},rt=(s,t)=>{const l=je(t.lat-s.lat),a=je(t.lng-s.lng),m=je(s.lat),d=je(t.lat),u=Math.sin(l/2)*Math.sin(l/2)+Math.sin(a/2)*Math.sin(a/2)*Math.cos(m)*Math.cos(d);return 6371*(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)))},je=s=>s*(Math.PI/180),Rs=async s=>{try{const r=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(s)}&limit=1`)).json();if(r&&r.length>0)return{lat:parseFloat(r[0].lat),lng:parseFloat(r[0].lon)}}catch(t){console.error("Erro ao geocodificar:",t)}return null};function Os({orders:s,currentLocation:t,onNavigate:r}){return ae.useRef(null),ae.useRef(null),ae.useRef([]),ae.useRef(null),ae.useRef(null),ae.useEffect(()=>{},["",t,s,r]),e.jsxs("div",{className:"h-[400px] flex flex-col items-center justify-center bg-gray-100 rounded-xl",children:[e.jsx(B,{className:"w-12 h-12 text-gray-400 mb-2"}),e.jsx("p",{className:"text-gray-500 text-sm text-center px-4",children:"Configure VITE_GOOGLE_MAPS_API_KEY no .env para exibir o mapa."})]})}function Ps({isOpen:s,onClose:t,orders:r,currentLocation:l,darkMode:a}){const[m,d]=n.useState(null),[u,g]=n.useState(!1),[h,i]=n.useState(!1),x=f=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(f||0),b=async()=>{if(!l){alert("N√£o foi poss√≠vel obter sua localiza√ß√£o atual");return}g(!0),i(!0);try{const f=await Promise.all(r.map(async N=>{const c=await Rs(N.address);return{...N,coordinates:c||{lat:-5.0892+(Math.random()-.5)*.05,lng:-42.8019+(Math.random()-.5)*.05}}}));i(!1),setTimeout(()=>{const N=Es(f,l);d(N),g(!1)},800)}catch(f){console.error("Erro ao otimizar rota:",f),g(!1),i(!1),alert("Erro ao otimizar rota")}},p=()=>{if(m&&m.optimizedOrders.length>0){const N=m.optimizedOrders[0].coordinates,c=`https://www.google.com/maps/dir/?api=1&destination=${N.lat},${N.lng}`;window.open(c,"_blank")}},C=f=>{const N=`https://www.google.com/maps/dir/?api=1&destination=${f.lat},${f.lng}`;window.open(N,"_blank")},j=r.reduce((f,N)=>f+(N.delivery_fee||0),0);return e.jsx(Ne,{open:s,onOpenChange:t,children:e.jsxs(_e,{className:`max-w-4xl max-h-[90vh] overflow-y-auto ${a?"bg-gray-800 text-white":""}`,children:[e.jsx($e,{children:e.jsxs(Ce,{className:"flex items-center gap-2",children:[e.jsx(as,{className:"w-5 h-5 text-blue-600"}),"Otimiza√ß√£o de Rota"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:`${a?"bg-gray-700":"bg-blue-50"} rounded-lg p-3 text-center border ${a?"border-gray-600":"border-blue-200"}`,children:[e.jsx(B,{className:"w-5 h-5 mx-auto mb-1 text-blue-600"}),e.jsx("p",{className:`text-2xl font-bold ${a?"text-white":"text-blue-900"}`,children:r.length}),e.jsx("p",{className:`text-xs ${a?"text-gray-300":"text-blue-700"}`,children:"Entregas"})]}),e.jsxs("div",{className:`${a?"bg-gray-700":"bg-green-50"} rounded-lg p-3 text-center border ${a?"border-gray-600":"border-green-200"}`,children:[e.jsx(ve,{className:"w-5 h-5 mx-auto mb-1 text-green-600"}),e.jsx("p",{className:`text-2xl font-bold ${a?"text-white":"text-green-900"}`,children:m?`${m.totalDistance}km`:"-"}),e.jsx("p",{className:`text-xs ${a?"text-gray-300":"text-green-700"}`,children:"Dist√¢ncia"})]}),e.jsxs("div",{className:`${a?"bg-gray-700":"bg-orange-50"} rounded-lg p-3 text-center border ${a?"border-gray-600":"border-orange-200"}`,children:[e.jsx(se,{className:"w-5 h-5 mx-auto mb-1 text-orange-600"}),e.jsx("p",{className:`text-2xl font-bold ${a?"text-white":"text-orange-900"}`,children:m?`${m.estimatedTime}min`:"-"}),e.jsx("p",{className:`text-xs ${a?"text-gray-300":"text-orange-700"}`,children:"Tempo Est."})]})]}),e.jsx("div",{className:`${a?"bg-gray-700":"bg-gradient-to-r from-green-50 to-emerald-50"} rounded-lg p-4 border ${a?"border-gray-600":"border-green-200"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${a?"text-gray-300":"text-gray-600"}`,children:"Ganho Total Estimado"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:x(j)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:`text-sm ${a?"text-gray-300":"text-gray-600"}`,children:"M√©dia por Entrega"}),e.jsx("p",{className:`text-xl font-bold ${a?"text-white":"text-gray-900"}`,children:x(j/r.length)})]})]})}),m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-xl overflow-hidden",children:e.jsx(Os,{orders:m.optimizedOrders,currentLocation:l,onNavigate:C})}),e.jsxs("div",{className:`${a?"bg-gray-700":"bg-gradient-to-r from-blue-50 to-indigo-50"} rounded-lg p-4 border ${a?"border-gray-600":"border-blue-200"}`,children:[e.jsxs("h3",{className:"font-bold text-lg mb-2 flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5 text-green-600"}),"Rota Otimizada"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:a?"text-gray-300":"text-gray-600",children:"Paradas"}),e.jsx("p",{className:`font-bold text-lg ${a?"text-white":"text-gray-900"}`,children:m.optimizedOrders.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:a?"text-gray-300":"text-gray-600",children:"Dist√¢ncia"}),e.jsxs("p",{className:`font-bold text-lg ${a?"text-white":"text-gray-900"}`,children:[m.totalDistance," km"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:a?"text-gray-300":"text-gray-600",children:"Tempo"}),e.jsxs("p",{className:`font-bold text-lg ${a?"text-white":"text-gray-900"}`,children:["~",m.estimatedTime," min"]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:`font-semibold text-sm mb-3 ${a?"text-gray-300":"text-gray-700"}`,children:"Sequ√™ncia Otimizada de Entrega:"}),e.jsx("div",{className:"space-y-2",children:m.optimizedOrders.map((f,N)=>e.jsxs("div",{className:`flex items-start gap-3 p-3 rounded-lg border ${N===0?a?"bg-blue-900/30 border-blue-600":"bg-blue-50 border-blue-300":a?"bg-gray-700 border-gray-600":"bg-white border-gray-200"}`,children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold text-sm",children:N+1}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("p",{className:`font-bold ${a?"text-white":"text-gray-900"}`,children:["#",f.order_code]}),e.jsx(W,{className:"text-xs bg-gray-500",children:f.customer_name}),N===0&&e.jsx(W,{className:"text-xs bg-green-500 animate-pulse",children:"Pr√≥xima"})]}),e.jsxs("p",{className:`text-xs ${a?"text-gray-400":"text-gray-600"} flex items-start gap-1`,children:[e.jsx(B,{className:"w-3 h-3 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:f.address})]})]}),e.jsx("p",{className:"text-sm font-semibold text-green-600",children:x(f.delivery_fee||0)})]},f.id))})]}),e.jsxs("div",{className:`${a?"bg-gray-700":"bg-yellow-50"} border ${a?"border-gray-600":"border-yellow-200"} rounded-lg p-3 text-sm`,children:[e.jsx("p",{className:`font-semibold ${a?"text-yellow-400":"text-yellow-900"} mb-1`,children:"üí° Dica Inteligente:"}),e.jsx("p",{className:a?"text-gray-300":"text-yellow-800",children:'Essa rota economiza tempo priorizando entregas mais pr√≥ximas. Clique em "Iniciar Navega√ß√£o" para come√ßar pela primeira parada.'})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(_,{variant:"outline",onClick:()=>d(null),className:"h-12",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Recalcular"]}),e.jsxs(_,{onClick:p,className:"bg-green-600 hover:bg-green-700 h-12 text-base font-bold",children:[e.jsx(ne,{className:"w-5 h-5 mr-2"}),"Iniciar Navega√ß√£o"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("h3",{className:`font-bold mb-3 ${a?"text-white":"text-gray-900"}`,children:["Suas Entregas Ativas (",r.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:r.map((f,N)=>e.jsx("div",{className:`p-3 rounded-lg border ${a?"bg-gray-700 border-gray-600":"bg-white border-gray-200"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"text-xs font-bold text-gray-400",children:["#",N+1]}),e.jsxs(W,{className:"bg-blue-500 text-white text-xs",children:["#",f.order_code]})]}),e.jsx("p",{className:`font-medium ${a?"text-white":"text-gray-900"}`,children:f.customer_name}),e.jsxs("p",{className:`text-xs ${a?"text-gray-400":"text-gray-500"} mt-1 flex items-start gap-1`,children:[e.jsx(B,{className:"w-3 h-3 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:f.address})]})]}),e.jsx("p",{className:"text-lg font-bold text-green-600",children:x(f.delivery_fee||0)})]})},f.id))})]}),e.jsx(_,{onClick:b,disabled:u||!l,className:"w-full bg-blue-600 hover:bg-blue-700 h-12 text-base font-bold",children:u?e.jsxs(e.Fragment,{children:[e.jsx(lt,{className:"w-5 h-5 mr-2 animate-spin"}),h?"Localizando endere√ßos...":"Otimizando rota..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Vt,{className:"w-5 h-5 mr-2"}),"Otimizar Rota Agora"]})}),!l&&e.jsx("p",{className:"text-xs text-amber-600 text-center",children:"‚ö†Ô∏è Aguardando localiza√ß√£o GPS..."})]})]})]})})}function Ts({status:s,darkMode:t}){const r=[{key:"going_to_store",label:"Indo ao Restaurante",icon:Ze,progress:20},{key:"arrived_at_store",label:"No Restaurante",icon:Ze,progress:40},{key:"picked_up",label:"Pedido Coletado",icon:K,progress:60},{key:"out_for_delivery",label:"Indo ao Cliente",icon:K,progress:80},{key:"delivered",label:"Entregue",icon:J,progress:100}],a=r.find(d=>d.key===s)?.progress||0,m=r.findIndex(d=>d.key===s);return e.jsxs("div",{className:`${t?"bg-gray-800":"bg-white"} rounded-2xl p-4 shadow-lg`,children:[e.jsx("div",{className:"flex items-center justify-between mb-3 overflow-x-auto pb-2",children:r.map((d,u)=>{const g=d.icon,h=s===d.key,i=m>u;return e.jsxs("div",{className:"flex-1 flex flex-col items-center min-w-[60px]",children:[e.jsx(v.div,{animate:h?{scale:[1,1.1,1]}:{},transition:{repeat:1/0,duration:2},className:`w-8 h-8 md:w-10 md:h-10 rounded-full flex items-center justify-center mb-1 md:mb-2 ${i||h?"bg-gradient-to-br from-green-500 to-green-600":t?"bg-gray-700":"bg-gray-200"}`,children:e.jsx(g,{className:`w-4 h-4 md:w-5 md:h-5 ${i||h?"text-white":"text-gray-400"}`})}),e.jsx("p",{className:`text-[10px] md:text-xs text-center font-medium leading-tight ${h?"text-blue-600 font-bold":t?"text-gray-400":"text-gray-500"}`,children:d.label})]},d.key)})}),e.jsx("div",{className:`h-2 rounded-full overflow-hidden ${t?"bg-gray-700":"bg-gray-200"}`,children:e.jsx(v.div,{initial:{width:0},animate:{width:`${a}%`},transition:{duration:.5},className:"h-full bg-gradient-to-r from-green-500 to-green-600"})}),e.jsxs("p",{className:`text-center text-xs mt-2 font-semibold ${t?"text-green-400":"text-green-600"}`,children:[a,"% Conclu√≠do"]})]})}function Is({darkMode:s}){const[t,r]=n.useState(!1),l=[{label:"Ligar para Gestor",icon:ot,action:()=>window.location.href="tel:+5586999999999",color:"from-red-500 to-red-600"},{label:"WhatsApp Emerg√™ncia",icon:Lt,action:()=>window.open("https://wa.me/5586999999999?text=üö® EMERG√äNCIA - Preciso de ajuda urgente!","_blank"),color:"from-orange-500 to-orange-600"},{label:"Cancelar",icon:L,action:()=>r(!1),color:"from-gray-500 to-gray-600"}];return e.jsxs(e.Fragment,{children:[e.jsx(v.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>r(!0),className:"fixed bottom-24 right-6 z-40 w-14 h-14 bg-gradient-to-br from-red-500 to-red-600 rounded-full shadow-2xl flex items-center justify-center",children:e.jsx("div",{className:"flex items-center justify-center w-full h-full",children:e.jsx(ee,{className:"w-7 h-7 text-white animate-pulse"})})}),e.jsx(Ke,{children:t&&e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4",onClick:()=>r(!1),children:e.jsxs(v.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},onClick:a=>a.stopPropagation(),className:`${s?"bg-gray-800":"bg-white"} rounded-3xl p-6 max-w-sm w-full shadow-2xl`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-red-500 rounded-2xl flex items-center justify-center",children:e.jsx(ee,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:`font-bold text-lg ${s?"text-white":"text-gray-900"}`,children:"Emerg√™ncia"}),e.jsx("p",{className:`text-xs ${s?"text-gray-400":"text-gray-600"}`,children:"Precisa de ajuda?"})]})]}),e.jsx("div",{className:"space-y-3",children:l.map((a,m)=>{const d=a.icon;return e.jsx(v.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(_,{onClick:a.action,className:`w-full h-14 bg-gradient-to-r ${a.color} text-white font-bold rounded-xl shadow-lg`,children:[e.jsx(d,{className:"w-5 h-5 mr-2"}),a.label]})},m)})})]})})})]})}function Ds({darkMode:s}){const[t,r]=n.useState(100),[l,a]=n.useState(!1),[m,d]=n.useState(!1);return n.useEffect(()=>{(async()=>{if("getBattery"in navigator)try{const g=await navigator.getBattery();r(Math.round(g.level*100)),a(g.charging),g.addEventListener("levelchange",()=>{r(Math.round(g.level*100))}),g.addEventListener("chargingchange",()=>{a(g.charging)})}catch{console.log("Battery API n√£o suportada")}})()},[]),n.useEffect(()=>{t<=20&&!l?d(!0):d(!1)},[t,l]),m?e.jsx(Ke,{children:e.jsx(v.div,{initial:{y:-100,opacity:0},animate:{y:0,opacity:1},exit:{y:-100,opacity:0},className:`fixed top-20 left-4 right-4 z-50 ${s?"bg-gradient-to-r from-red-900 to-red-800":"bg-gradient-to-r from-red-500 to-red-600"} rounded-2xl p-4 shadow-2xl`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(v.div,{animate:{scale:[1,1.2,1]},transition:{repeat:1/0,duration:1.5},children:e.jsx(Yt,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-bold text-white text-sm",children:["‚ö†Ô∏è Bateria Baixa: ",t,"%"]}),e.jsx("p",{className:"text-xs text-white/90",children:"Carregue seu celular para n√£o perder o rastreamento GPS"})]}),e.jsx("button",{onClick:()=>d(!1),className:"w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center",children:e.jsx(ee,{className:"w-4 h-4 text-white"})})]})})}):null}function ks({isOpen:s,onClose:t,onPause:r,darkMode:l}){const[a,m]=n.useState(15),[d,u]=n.useState("break"),g=[{value:10,label:"10 min"},{value:15,label:"15 min"},{value:30,label:"30 min"},{value:60,label:"1 hora"}],h=[{key:"break",label:"Pausa R√°pida",icon:Ht},{key:"fuel",label:"Abastecimento",icon:Wt},{key:"meal",label:"Refei√ß√£o",icon:ls}],i=[{name:"Posto BR - 500m",type:"Combust√≠vel",distance:"500m"},{name:"Caf√© Central - 300m",type:"Caf√©",distance:"300m"},{name:"Restaurante Popular - 800m",type:"Refei√ß√£o",distance:"800m"}],x=()=>{r(a,d),t()};return e.jsx(Ne,{open:s,onOpenChange:t,children:e.jsxs(_e,{className:`max-w-md ${l?"bg-gray-800 text-white":""}`,children:[e.jsx($e,{children:e.jsxs(Ce,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5 text-blue-600"}),"Pausa Inteligente"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-semibold mb-2 ${l?"text-gray-300":"text-gray-700"}`,children:"Por quanto tempo?"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:g.map(b=>e.jsx(v.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>m(b.value),className:`p-3 rounded-xl text-sm font-bold transition-all ${a===b.value?"bg-blue-600 text-white":l?"bg-gray-700 text-gray-300":"bg-gray-100 text-gray-700"}`,children:b.label},b.value))})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-semibold mb-2 ${l?"text-gray-300":"text-gray-700"}`,children:"Motivo da pausa:"}),e.jsx("div",{className:"space-y-2",children:h.map(b=>{const p=b.icon;return e.jsxs(v.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>u(b.key),className:`w-full flex items-center gap-3 p-3 rounded-xl transition-all ${d===b.key?"bg-blue-600 text-white":l?"bg-gray-700 text-gray-300":"bg-gray-100 text-gray-700"}`,children:[e.jsx(p,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:b.label})]},b.key)})})]}),e.jsxs("div",{className:`${l?"bg-gray-700":"bg-blue-50"} rounded-xl p-3`,children:[e.jsxs("p",{className:`text-xs font-semibold mb-2 flex items-center gap-1 ${l?"text-blue-400":"text-blue-700"}`,children:[e.jsx(B,{className:"w-3 h-3"}),"Locais pr√≥ximos sugeridos:"]}),e.jsx("div",{className:"space-y-1",children:i.map((b,p)=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:l?"text-gray-300":"text-gray-700",children:b.name}),e.jsx("span",{className:`${l?"text-blue-400":"text-blue-600"} font-semibold`,children:b.distance})]},p))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-2",children:[e.jsx(_,{variant:"outline",onClick:t,className:"h-12",children:"Cancelar"}),e.jsx(_,{onClick:x,className:"bg-blue-600 hover:bg-blue-700 h-12 font-bold",children:"Iniciar Pausa"})]}),e.jsx("p",{className:`text-xs text-center ${l?"text-gray-400":"text-gray-500"}`,children:"Voc√™ n√£o receber√° novos pedidos durante a pausa"})]})]})})}function As({isOpen:s,onClose:t,order:r,entregador:l,darkMode:a}){const[m,d]=n.useState(null),[u,g]=n.useState(""),[h,i]=n.useState(!1),x=[{key:"no_answer",label:"Cliente n√£o atende",icon:ts,color:"text-orange-600"},{key:"wrong_address",label:"Endere√ßo incorreto",icon:Xt,color:"text-red-600"},{key:"restaurant_delay",label:"Restaurante atrasado",icon:se,color:"text-yellow-600"},{key:"order_issue",label:"Problema com pedido",icon:K,color:"text-purple-600"}],b=async()=>{if(m){i(!0);try{const p=x.find(C=>C.key===m);await $.entities.DeliveryMessage.create({entregador_id:l.id,order_id:r?.id,title:"‚ö†Ô∏è Problema Reportado",message:`${p.label}

Detalhes: ${u||"Nenhum detalhe adicional"}`,priority:"urgent",type:"alert"}),alert("Problema reportado com sucesso! O gestor foi notificado."),t()}catch{alert("Erro ao reportar problema")}finally{i(!1)}}};return e.jsx(Ne,{open:s,onOpenChange:t,children:e.jsxs(_e,{className:`max-w-md ${a?"bg-gray-800 text-white":""}`,children:[e.jsx($e,{children:e.jsxs(Ce,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5 text-orange-600"}),"Reportar Problema"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-semibold mb-3 ${a?"text-gray-300":"text-gray-700"}`,children:"Qual √© o problema?"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:x.map(p=>{const C=p.icon;return e.jsxs(v.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>d(p.key),className:`p-3 rounded-xl transition-all border-2 ${m===p.key?"bg-blue-600 text-white border-blue-600":a?"bg-gray-700 text-gray-300 border-gray-600":"bg-white text-gray-700 border-gray-200"}`,children:[e.jsx(C,{className:`w-6 h-6 mx-auto mb-1 ${m===p.key?"text-white":p.color}`}),e.jsx("p",{className:"text-xs font-medium",children:p.label})]},p.key)})})]}),m&&e.jsxs(v.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:[e.jsx("p",{className:`text-sm font-semibold mb-2 ${a?"text-gray-300":"text-gray-700"}`,children:"Detalhes adicionais (opcional):"}),e.jsx(Ee,{value:u,onChange:p=>g(p.target.value),placeholder:"Descreva o problema com mais detalhes...",className:`h-24 ${a?"bg-gray-700 border-gray-600":""}`})]}),r&&e.jsxs("div",{className:`${a?"bg-gray-700":"bg-gray-50"} rounded-xl p-3`,children:[e.jsx("p",{className:`text-xs font-semibold mb-1 ${a?"text-gray-400":"text-gray-600"}`,children:"Pedido Relacionado:"}),e.jsxs("p",{className:`text-sm font-bold ${a?"text-white":"text-gray-900"}`,children:["#",r.order_code," - ",r.customer_name]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-2",children:[e.jsx(_,{variant:"outline",onClick:t,disabled:h,className:"h-12",children:"Cancelar"}),e.jsx(_,{onClick:b,disabled:!m||h,className:"bg-orange-600 hover:bg-orange-700 h-12 font-bold",children:h?"Enviando...":"Reportar"})]}),e.jsx("p",{className:`text-xs text-center ${a?"text-gray-400":"text-gray-500"}`,children:"O gestor ser√° notificado imediatamente sobre o problema"})]})]})})}function qs({order:s,darkMode:t}){const[r,l]=n.useState(!1);if(!s||!s.items||s.items.length===0)return null;const a=m=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(m||0);return e.jsxs("div",{className:`${t?"bg-gray-700 border-gray-600":"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200"} rounded-2xl border-2 overflow-hidden shadow-md`,children:[e.jsxs("button",{onClick:()=>l(!r),className:"w-full p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 ${t?"bg-blue-900":"bg-blue-600"} rounded-xl flex items-center justify-center`,children:e.jsx(K,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"text-left",children:[e.jsxs("p",{className:`font-bold ${t?"text-white":"text-gray-900"}`,children:["Itens do Pedido (",s.items.length,")"]}),e.jsxs("p",{className:`text-xs ${t?"text-gray-400":"text-gray-600"}`,children:["Toque para ",r?"ocultar":"visualizar"," detalhes"]})]})]}),r?e.jsx(Bt,{className:`w-5 h-5 ${t?"text-gray-400":"text-gray-600"}`}):e.jsx(Kt,{className:`w-5 h-5 ${t?"text-gray-400":"text-gray-600"}`})]}),e.jsx(Ke,{children:r&&e.jsxs(v.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:`${t?"bg-gray-800":"bg-white"} px-4 pb-4`,children:[e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:s.items.map((m,d)=>e.jsx(v.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:d*.05},className:`p-3 rounded-xl ${t?"bg-gray-700":"bg-gray-50"} border ${t?"border-gray-600":"border-gray-200"}`,children:e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-bold ${t?"text-white":"text-gray-900"}`,children:[m.quantity,"x"]}),e.jsx("p",{className:`font-semibold ${t?"text-white":"text-gray-900"}`,children:m.name})]}),m.complements&&m.complements.length>0&&e.jsx("div",{className:"mt-1 ml-6",children:m.complements.map((u,g)=>e.jsxs("p",{className:`text-xs ${t?"text-gray-400":"text-gray-600"}`,children:["+ ",u.name]},g))}),m.notes&&e.jsxs("p",{className:`text-xs mt-1 italic ${t?"text-gray-400":"text-gray-600"}`,children:["Obs: ",m.notes]})]}),e.jsx("p",{className:`font-bold ${t?"text-green-400":"text-green-600"} ml-2`,children:a(m.total_price)})]})},d))}),e.jsx("div",{className:`mt-3 pt-3 border-t ${t?"border-gray-700":"border-gray-200"}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:`font-semibold ${t?"text-gray-300":"text-gray-700"}`,children:"Total do Pedido:"}),e.jsx("p",{className:`text-xl font-bold ${t?"text-green-400":"text-green-600"}`,children:a(s.total)})]})})]})})]})}function zs({entregador:s,activeOrders:t=[],completedOrdersToday:r=[],darkMode:l=!1}){const a=i=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(i||0),m=i=>{if(i<60)return`${i}min`;const x=Math.floor(i/60),b=i%60;return`${x}h ${b}min`},d=r.reduce((i,x)=>i+(x.delivery_fee||0),0),u=r.length>0?r.reduce((i,x)=>{if(!x.picked_up_at||!x.delivered_at)return i;const b=new Date(x.picked_up_at),p=new Date(x.delivered_at);return i+(p-b)/6e4},0)/r.length:0,g=s.total_deliveries>0?(r.length/s.total_deliveries*100).toFixed(1):0,h=[{label:"Entregas Hoje",value:r.length,icon:K,color:"blue",change:"+12%",trend:"up"},{label:"Ganhos Hoje",value:a(d),icon:Se,color:"green",change:"+8%",trend:"up"},{label:"Tempo M√©dio",value:m(Math.round(u)),icon:se,color:"purple",change:"-5min",trend:"down"},{label:"Taxa de Conclus√£o",value:`${g}%`,icon:Ut,color:"orange",change:"+2%",trend:"up"}];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:`text-xl font-bold ${l?"text-white":"text-gray-900"}`,children:"Dashboard"}),e.jsx("p",{className:`text-sm ${l?"text-gray-400":"text-gray-600"}`,children:"Vis√£o geral do seu desempenho"})]}),e.jsxs(W,{className:"bg-green-500 text-white",children:[e.jsx(Be,{className:"w-3 h-3 mr-1"}),s.rating?.toFixed(1)||"5.0"]})]}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:h.map((i,x)=>{const b=i.icon,p={blue:l?"from-blue-900/50 to-blue-800/30 border-blue-700":"from-blue-50 to-blue-100 border-blue-200",green:l?"from-green-900/50 to-green-800/30 border-green-700":"from-green-50 to-green-100 border-green-200",purple:l?"from-purple-900/50 to-purple-800/30 border-purple-700":"from-purple-50 to-purple-100 border-purple-200",orange:l?"from-orange-900/50 to-orange-800/30 border-orange-700":"from-orange-50 to-orange-100 border-orange-200"};return e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:x*.1},whileHover:{scale:1.02,y:-2},className:`bg-gradient-to-br ${p[i.color]} border rounded-2xl p-4 backdrop-blur-sm`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(b,{className:`w-5 h-5 ${i.color==="blue"?"text-blue-600":i.color==="green"?"text-green-600":i.color==="purple"?"text-purple-600":"text-orange-600"}`}),e.jsx("span",{className:`text-xs font-medium ${i.trend==="up"?"text-green-600":"text-red-600"}`,children:i.change})]}),e.jsx("p",{className:`text-2xl font-bold ${l?"text-white":"text-gray-900"} mb-1`,children:i.value}),e.jsx("p",{className:`text-xs ${l?"text-gray-400":"text-gray-600"}`,children:i.label})]},i.label)})}),e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:`${l?"bg-gray-800 border-gray-700":"bg-white border-gray-200"} border rounded-2xl p-6`,children:[e.jsx("h3",{className:`font-bold text-lg mb-4 ${l?"text-white":"text-gray-900"}`,children:"Desempenho Semanal"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:`text-sm ${l?"text-gray-300":"text-gray-700"}`,children:"Entregas Conclu√≠das"}),e.jsxs("span",{className:`text-sm font-bold ${l?"text-white":"text-gray-900"}`,children:[r.length," / ",s.total_deliveries||0]})]}),e.jsx(Xe,{value:r.length/(s.total_deliveries||1)*100,className:"h-2"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:`text-sm ${l?"text-gray-300":"text-gray-700"}`,children:"Meta de Ganhos"}),e.jsxs("span",{className:`text-sm font-bold ${l?"text-white":"text-gray-900"}`,children:[a(d)," / ",a(s.total_earnings||0)]})]}),e.jsx(Xe,{value:d/(s.total_earnings||1)*100,className:"h-2"})]})]})]}),t.length>0&&e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:`${l?"bg-gradient-to-r from-blue-900/30 to-indigo-900/30 border-blue-700":"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200"} border rounded-2xl p-4`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-xl flex items-center justify-center",children:e.jsx(K,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:`font-bold ${l?"text-white":"text-gray-900"}`,children:"Entregas em Andamento"}),e.jsxs("p",{className:`text-sm ${l?"text-gray-400":"text-gray-600"}`,children:[t.length," ",t.length===1?"entrega ativa":"entregas ativas"]})]})]}),e.jsx("div",{className:"space-y-2",children:t.slice(0,3).map((i,x)=>e.jsxs("div",{className:`${l?"bg-gray-800/50":"bg-white/50"} rounded-lg p-3 flex items-center justify-between`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:`text-sm font-medium ${l?"text-white":"text-gray-900"}`,children:["#",i.order_code]}),e.jsx("p",{className:`text-xs ${l?"text-gray-400":"text-gray-600"}`,children:i.customer_name})]})]}),e.jsx(W,{className:"bg-blue-500 text-white text-xs",children:i.status==="going_to_store"?"Indo ao restaurante":i.status==="picked_up"?"Coletado":i.status==="out_for_delivery"?"Em rota":"Aguardando"})]},i.id))})]})]})}function Va(){const[s,t]=n.useState({}),[r,l]=n.useState({}),[a,m]=n.useState(null),[d,u]=n.useState(null),[g,h]=n.useState(null),[i,x]=n.useState(!1),[b,p]=n.useState(!1),[C,j]=n.useState(!1),[f,N]=n.useState(!1),[c,F]=n.useState(!1),[q,E]=n.useState(null),[re,Re]=n.useState(!1),[ce,le]=n.useState(null),[Oe,Q]=n.useState(!1),[Pe,Te]=n.useState(!1),[S,P]=n.useState(!1),[z,D]=n.useState(!1),[de,me]=n.useState(null),U=n.useRef(null),O=we(),{slug:k}=nt(),{subscriberData:G}=Qt(),M=(G?.plan||"basic").toString().toLowerCase()==="basic",{user:R,entregador:y,loading:xe,asSubscriber:dt,isMaster:De}=os(),{activeOrders:I,completedOrders:ke,completedOrdersToday:mt}=cs(y?.id,dt,De),ue=Ss(y?.id);n.useEffect(()=>{y&&F(y.dark_mode||!1)},[y]),n.useEffect(()=>{const o=localStorage.getItem("entregador_tutorial_seen"),w=localStorage.getItem("entregador_tutorial_never_show");!o&&!w&&y&&setTimeout(()=>x(!0),1e3)},[y]);const Ue=n.useRef(0);n.useEffect(()=>{const o=I.filter(w=>w.status===V.OUT_FOR_DELIVERY).length;o>Ue.current&&y?.sound_enabled!==!1&&(U.current&&(U.current.volume=1,U.current.play().catch(()=>{})),navigator.vibrate&&navigator.vibrate([300,100,300,100,300])),Ue.current=o},[I,y]);const H=I[0],{coordinates:Ae}=ds(H?.address);n.useEffect(()=>{if(!H){le(null);return}if(H.customer_latitude&&H.customer_longitude){le({lat:H.customer_latitude,lng:H.customer_longitude});return}Ae?le(Ae):H.store_latitude!=null&&H.store_longitude!=null&&le({lat:H.store_latitude,lng:H.store_longitude})},[H,Ae]);const xt=oe({mutationFn:({orderId:o,status:w})=>$.entities.Order.update(o,{status:w,delivered_at:w==="delivered"?new Date().toISOString():void 0}),onSuccess:()=>{O.invalidateQueries({queryKey:["deliveryOrders"]}),O.invalidateQueries({queryKey:["allDeliveryOrders"]})}}),{data:ge=[]}=ie({queryKey:["availableOrders"],queryFn:async()=>(await $.entities.Order.filter({status:"ready",delivery_method:"delivery"})).filter(w=>!w.entregador_id),enabled:!!y&&y.status==="available",refetchInterval:3e3}),Qe=oe({mutationFn:async()=>{const o=y.status==="available"?"offline":"available";return y._isVirtual||y._isMaster?{...y,status:o}:await $.entities.Entregador.update(y.id,{...y,status:o})},onSuccess:o=>{setEntregador(o),O.invalidateQueries({queryKey:["entregadores"]})}}),ut=o=>{const w=s[o.id]||"";if(!w){alert("Por favor, informe o c√≥digo de entrega fornecido pelo cliente");return}if(w!==o.delivery_code){alert("C√≥digo de entrega inv√°lido! Verifique com o cliente.");return}u(o),t(T=>{const A={...T};return delete A[o.id],A})},gt=()=>{const o=d;xt.mutate({orderId:o.id,status:"delivered"}),y._isMaster?setEntregador(w=>({...w,status:"available",total_deliveries:(w.total_deliveries||0)+1,total_earnings:(w.total_earnings||0)+(o.delivery_fee||0)})):$.entities.Entregador.update(y.id,{status:"available",current_order_id:null,total_deliveries:(y.total_deliveries||0)+1,total_earnings:(y.total_earnings||0)+(o.delivery_fee||0)}),u(null),setTimeout(()=>h(o),500)},ht=()=>{localStorage.setItem("entregador_tutorial_seen","true"),x(!1)},pt=(o,w)=>{D(!0);const T=new Date(Date.now()+o*6e4);me(T),setTimeout(()=>{D(!1),me(null)},o*6e4)},ft=o=>{if(o==null||o==="")return"‚Äî";const w=new Date(o);if(Number.isNaN(w.getTime()))return"‚Äî";const A=new Date-w,Y=Math.floor(A/6e4);if(Y<0||!Number.isFinite(Y))return"‚Äî";if(Y<1)return"Agora";if(Y<60)return`${Y}m atr√°s`;const qe=Math.floor(Y/60);return qe<24?`${qe}h atr√°s`:`${Math.floor(qe/24)}d atr√°s`},bt=(o,w="")=>{const T=o.replace(/\D/g,"");window.open(`https://wa.me/55${T}?text=${encodeURIComponent(w)}`)},yt=o=>{window.location.href=`tel:${o}`};if(xe)return e.jsx("div",{className:`min-h-screen flex items-center justify-center ${c?"bg-gray-900":"bg-gray-50"}`,children:e.jsx(lt,{className:"w-12 h-12 animate-spin text-blue-500"})});if(M&&!De)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:e.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-lg text-center max-w-md",children:[e.jsx(Me,{className:"w-16 h-16 text-blue-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"App Entregador"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"O App Entregador est√° dispon√≠vel nos planos Pro e Ultra. No plano B√°sico use o Gestor de pedidos no painel."}),e.jsx(ze,{to:Ve("PainelAssinante",k||void 0),children:e.jsx(_,{className:"bg-blue-500 hover:bg-blue-600",children:"Voltar ao Painel"})})]})});const Ge=R?.profile_roles?.length?R.profile_roles:R?.profile_role?[R.profile_role]:[],jt=Ge.includes("gerente"),vt=R?.profile_role==="entregador"||Ge.includes("entregador"),wt=R?.subscriber_email&&(R?.email||"").toLowerCase().trim()===(R?.subscriber_email||"").toLowerCase().trim(),Nt=!R?.subscriber_email||R?.email&&R?.subscriber_email&&R?.email.toLowerCase().trim()===R?.subscriber_email.toLowerCase().trim();return!xe&&!y&&!(De||vt||jt||wt||Nt)?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-lg text-center max-w-md",children:[e.jsx(Me,{className:"w-16 h-16 text-blue-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"App Entregador"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Esta funcionalidade n√£o est√° dispon√≠vel no seu plano atual."}),e.jsx(ze,{to:Ve("PainelAssinante",k||void 0),children:e.jsx(_,{className:"bg-blue-500 hover:bg-blue-600",children:"Voltar ao Painel"})})]})}):y?e.jsx(St,{children:e.jsxs("div",{className:`min-h-screen ${c?"bg-gray-900":"bg-gradient-to-br from-blue-50 via-indigo-50 to-blue-50"}`,children:[e.jsx("audio",{ref:U,preload:"auto",volume:"1.0",children:e.jsx("source",{src:"https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3",type:"audio/mpeg"})}),e.jsx(ys,{entregador:y,enabled:y?.notifications_enabled!==!1&&!z}),e.jsx(Ds,{darkMode:c}),e.jsx(Is,{darkMode:c}),e.jsx("header",{className:`${c?"bg-gradient-to-r from-gray-800 via-gray-900 to-gray-800 border-gray-700":"bg-gradient-to-r from-white via-gray-50 to-white border-gray-200"} border-b-2 sticky top-0 z-40 backdrop-blur-lg shadow-lg`,children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[y.photo?e.jsx(v.img,{whileHover:{scale:1.1},src:y.photo,alt:y.name,className:"w-12 h-12 rounded-2xl object-cover border-2 border-blue-500 shadow-lg"}):e.jsx(v.div,{whileHover:{scale:1.1,rotate:360},transition:{duration:.5},className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-lg",children:e.jsx(Le,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:`font-bold text-lg ${c?"text-white":"text-gray-900"}`,children:y.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[y.vehicle_type&&e.jsx("span",{className:"text-base",children:Et[y.vehicle_type]||"üöó"}),e.jsxs("div",{className:"flex items-center gap-1 bg-yellow-100 px-2 py-0.5 rounded-full",children:[e.jsx(Be,{className:"w-3 h-3 text-yellow-600 fill-yellow-600"}),e.jsx("span",{className:"text-xs font-bold text-yellow-700",children:y.rating?.toFixed(1)||"5.0"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ft,{pageName:"Entregador",compact:!0}),e.jsx(_,{variant:"ghost",size:"icon",onClick:()=>x(!0),className:"hidden md:flex min-h-touch min-w-touch",children:e.jsx(et,{className:"w-5 h-5"})}),e.jsx(_,{variant:"ghost",size:"icon",onClick:()=>j(!0),className:"hidden md:flex",children:e.jsx(tt,{className:"w-5 h-5"})}),e.jsx(_,{variant:"ghost",size:"icon",onClick:()=>$.auth.logout(),className:"hidden md:flex text-red-600",children:e.jsx(st,{className:"w-5 h-5"})}),e.jsx(_,{variant:"ghost",size:"icon",onClick:()=>Q(!0),className:"md:hidden",children:e.jsx(Gt,{className:"w-5 h-5"})})]})]})})}),Oe&&e.jsx("div",{className:"md:hidden fixed inset-0 z-50 bg-black/50",onClick:()=>Q(!1),children:e.jsxs("div",{className:`w-64 h-full ${c?"bg-gray-800":"bg-white"} shadow-xl`,onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h2",{className:`font-bold ${c?"text-white":"text-gray-900"}`,children:"Menu"}),e.jsx("button",{onClick:()=>Q(!1),children:e.jsx(L,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-2",children:[e.jsxs("button",{onClick:()=>{p(!0),Q(!1)},className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left ${c?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:[e.jsx(Le,{className:"w-5 h-5"}),e.jsx("span",{children:"Perfil"})]}),e.jsxs("button",{onClick:()=>{N(!0),Q(!1)},className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left ${c?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:[e.jsx(ve,{className:"w-5 h-5"}),e.jsx("span",{children:"Ganhos"})]}),e.jsxs("button",{onClick:()=>{j(!0),Q(!1)},className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left ${c?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:[e.jsx(tt,{className:"w-5 h-5"}),e.jsx("span",{children:"Configura√ß√µes"})]}),e.jsxs("button",{onClick:()=>{x(!0),Q(!1)},className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left ${c?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:[e.jsx(et,{className:"w-5 h-5"}),e.jsx("span",{children:"Tutorial"})]}),e.jsxs("button",{onClick:()=>$.auth.logout(),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left text-red-500 ${c?"hover:bg-red-900/20":"hover:bg-red-50"}`,children:[e.jsx(st,{className:"w-5 h-5"}),e.jsx("span",{children:"Sair"})]})]})]})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsx(zs,{entregador:y,activeOrders:I,completedOrdersToday:mt,darkMode:c})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:`${c?"bg-gradient-to-br from-gray-800 via-gray-900 to-gray-800":"bg-gradient-to-br from-white via-gray-50 to-white"} rounded-3xl p-4 md:p-6 shadow-2xl border ${c?"border-gray-700":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:`text-lg md:text-xl font-bold ${c?"text-white":"text-gray-900"} mb-1`,children:"Status de Disponibilidade"}),e.jsx("p",{className:`text-xs md:text-sm ${c?"text-gray-400":"text-gray-500"}`,children:y.status==="available"?"Voc√™ est√° dispon√≠vel para receber pedidos":"Voc√™ est√° offline"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full",children:[e.jsx(v.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>Qe.mutate(),disabled:Qe.isPending||z,className:`flex-1 px-6 py-3 md:py-4 rounded-2xl font-bold text-sm md:text-base text-white transition-all shadow-lg ${z?"bg-gradient-to-r from-orange-500 to-orange-600 cursor-not-allowed":y.status==="available"?"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700":"bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700"}`,children:z?e.jsx("span",{className:"flex items-center justify-center gap-2",children:"‚è∏Ô∏è Em Pausa"}):y.status==="available"?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 md:w-3 md:h-3 bg-white rounded-full animate-pulse"}),"Dispon√≠vel"]}):"‚ö´ Offline"}),y.status==="available"&&!z&&e.jsx(v.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>Te(!0),className:"flex-1 sm:flex-none sm:px-8 px-4 py-3 rounded-2xl font-bold text-sm bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white shadow-lg",children:"‚è∏Ô∏è Pausar"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 md:gap-4",children:[e.jsxs(v.div,{whileHover:{scale:1.02,y:-2},className:`p-3 md:p-5 rounded-2xl ${c?"bg-gradient-to-br from-blue-900/50 to-blue-800/30 border border-blue-700":"bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200"} backdrop-blur-sm`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(K,{className:"w-5 md:w-7 h-5 md:h-7 text-blue-600"}),I.length>0&&e.jsx("span",{className:"w-5 h-5 md:w-6 md:h-6 bg-blue-600 text-white rounded-full text-[10px] md:text-xs font-bold flex items-center justify-center",children:I.length})]}),e.jsx("p",{className:`text-2xl md:text-3xl font-bold ${c?"text-white":"text-blue-700"} mb-1`,children:I.length}),e.jsx("p",{className:`text-[10px] md:text-xs ${c?"text-gray-400":"text-gray-600"} font-medium`,children:"Entregas Ativas"})]}),e.jsxs(v.div,{whileHover:{scale:1.02,y:-2},className:`p-3 md:p-5 rounded-2xl ${c?"bg-gradient-to-br from-green-900/50 to-green-800/30 border border-green-700":"bg-gradient-to-br from-green-50 to-green-100 border border-green-200"} backdrop-blur-sm`,children:[e.jsx(J,{className:"w-5 md:w-7 h-5 md:h-7 text-green-600 mb-2"}),e.jsx("p",{className:`text-2xl md:text-3xl font-bold ${c?"text-white":"text-green-700"} mb-1`,children:y.total_deliveries||0}),e.jsx("p",{className:`text-[10px] md:text-xs ${c?"text-gray-400":"text-gray-600"} font-medium`,children:"Total de Entregas"})]}),e.jsxs(v.div,{whileHover:{scale:1.02,y:-2},className:`p-3 md:p-5 rounded-2xl ${c?"bg-gradient-to-br from-purple-900/50 to-purple-800/30 border border-purple-700":"bg-gradient-to-br from-purple-50 to-purple-100 border border-purple-200"} backdrop-blur-sm`,children:[e.jsx(Se,{className:"w-5 md:w-7 h-5 md:h-7 text-purple-600 mb-2"}),e.jsx("p",{className:`text-lg md:text-2xl font-bold ${c?"text-white":"text-purple-700"} mb-1 break-words`,children:pe(y.total_earnings||0)}),e.jsx("p",{className:`text-[10px] md:text-xs ${c?"text-gray-400":"text-gray-600"} font-medium`,children:"Ganhos Totais"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 md:gap-3 mt-4 md:mt-6",children:[e.jsx(v.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(_,{onClick:()=>p(!0),variant:"outline",className:`w-full h-10 md:h-12 rounded-xl font-semibold text-sm ${c?"border-gray-700 hover:bg-gray-800":"border-gray-300 hover:bg-gray-50"}`,children:[e.jsx(Le,{className:"w-4 md:w-5 h-4 md:h-5 mr-1 md:mr-2"}),"Perfil"]})}),e.jsx(v.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(_,{onClick:()=>N(!0),variant:"outline",className:`w-full h-10 md:h-12 rounded-xl font-semibold text-sm ${c?"border-gray-700 hover:bg-gray-800":"border-gray-300 hover:bg-gray-50"}`,children:[e.jsx(ve,{className:"w-4 md:w-5 h-4 md:h-5 mr-1 md:mr-2"}),"Relat√≥rio"]})})]})]})}),e.jsx(Ns,{entregador:y,onLocationUpdate:E}),I.length>0&&e.jsx("div",{className:"max-w-7xl mx-auto px-4 pb-4",children:e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:`${c?"bg-gray-800 border-gray-700":"bg-white border-gray-200"} rounded-3xl overflow-hidden shadow-2xl border-2`,children:[e.jsx("div",{className:`p-4 border-b ${c?"bg-gray-900/50 border-gray-700":"bg-gradient-to-r from-blue-50 to-indigo-50 border-gray-200"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx(B,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:`font-bold ${c?"text-white":"text-gray-900"}`,children:"Rota em Tempo Real"}),e.jsx("p",{className:`text-xs ${c?"text-gray-400":"text-gray-600"}`,children:q?"Navega√ß√£o GPS ativa":"Aguardando localiza√ß√£o..."})]})]}),e.jsx(W,{className:q?"bg-green-500 text-white":"bg-yellow-500 text-white",children:q?"Ao vivo":"Carregando"})]})}),e.jsx("div",{className:"h-[400px] md:h-[500px]",children:e.jsx(us,{entregadorLocation:q,storeLocation:I[0]?.store_latitude&&I[0]?.store_longitude?{lat:I[0].store_latitude,lng:I[0].store_longitude}:null,customerLocation:ce,order:I[0],darkMode:c,mode:"entregador",onNavigate:o=>{window.open(`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(o)}`,"_blank")}})})]})}),z&&de&&e.jsx("div",{className:"max-w-7xl mx-auto px-4 pb-4",children:e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-orange-500 to-orange-600 rounded-3xl p-6 text-white shadow-2xl text-center",children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:"‚è∏Ô∏è Voc√™ est√° em pausa"}),e.jsxs("p",{className:"text-3xl font-bold mb-2",children:[Math.max(0,Math.ceil((de-new Date)/6e4))," minutos restantes"]}),e.jsx("p",{className:"text-sm opacity-90 mb-4",children:"Voc√™ n√£o receber√° novos pedidos at√© o fim da pausa"}),e.jsx(_,{onClick:()=>{D(!1),me(null)},variant:"outline",className:"bg-white text-orange-600 hover:bg-gray-100",children:"Retomar Agora"})]})}),y.status==="available"&&!z&&!I.length&&ge&&ge.length>0&&e.jsxs("div",{className:"max-w-7xl mx-auto px-4 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:`text-xl font-bold ${c?"text-white":"text-gray-900"}`,children:["Pedidos Dispon√≠veis (",ge.length,")"]}),e.jsx(W,{className:"bg-green-500 text-white animate-pulse",children:"Novos!"})]}),e.jsx("div",{className:"space-y-4",children:ge.map(o=>e.jsxs("div",{className:`${c?"bg-gray-800 border-gray-700":"bg-white border-gray-200"} rounded-xl p-4 border shadow-sm hover:shadow-md transition-shadow`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs(W,{className:"bg-orange-500 text-white mb-2",children:["#",o.order_code]}),e.jsx("h3",{className:`font-bold ${c?"text-white":"text-gray-900"}`,children:o.customer_name}),e.jsx("p",{className:`text-sm ${c?"text-gray-400":"text-gray-600"}`,children:o.customer_phone})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:pe(o.delivery_fee||0)}),e.jsx("p",{className:`text-xs ${c?"text-gray-400":"text-gray-600"}`,children:"Taxa de entrega"})]})]}),e.jsx("div",{className:`p-3 rounded-lg mb-3 ${c?"bg-gray-700":"bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:`text-sm ${c?"text-white":"text-gray-900"}`,children:o.address||"Endere√ßo n√£o informado"})]})}),e.jsxs(_,{onClick:async()=>{try{const T=(await $.entities.Store.list())[0];await $.entities.Order.update(o.id,{...o,entregador_id:y.id,status:"going_to_store",store_latitude:T?.store_latitude||-5.0892,store_longitude:T?.store_longitude||-42.8019}),y._isVirtual||await $.entities.Entregador.update(y.id,{...y,status:"busy",current_order_id:o.id}),O.invalidateQueries({queryKey:["deliveryOrders"]}),O.invalidateQueries({queryKey:["availableOrders"]}),O.invalidateQueries({queryKey:["entregadores"]}),O.invalidateQueries({queryKey:["gestorOrders"]}),U.current&&U.current.play().catch(()=>{})}catch{alert("Erro ao aceitar entrega")}},className:"w-full bg-green-500 hover:bg-green-600 h-12",children:[e.jsx(J,{className:"w-5 h-5 mr-2"}),"Aceitar Entrega"]})]},o.id))})]}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:`text-xl font-bold ${c?"text-white":"text-gray-900"}`,children:["Entregas Ativas (",I.length,")"]}),I.length>1&&e.jsxs(_,{onClick:()=>Re(!0),className:"bg-blue-600 hover:bg-blue-700",size:"sm",children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Otimizar Rota"]})]}),I.length===0?e.jsxs("div",{className:`${c?"bg-gray-800":"bg-white"} rounded-2xl p-12 text-center`,children:[e.jsx(K,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:`font-bold mb-2 ${c?"text-white":"text-gray-900"}`,children:y.status==="available"?"Aguardando pedidos...":"Voc√™ est√° offline"}),e.jsx("p",{className:c?"text-gray-400":"text-gray-500",children:y.status==="available"?"Novos pedidos aparecer√£o aqui quando estiverem prontos para entrega":'Mude seu status para "Dispon√≠vel" para receber pedidos'})]}):e.jsx("div",{className:"space-y-4",children:I.map(o=>e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},whileHover:{scale:1.01,y:-2},className:`${c?"bg-gradient-to-br from-gray-800 to-gray-900 border-gray-700":"bg-gradient-to-br from-white to-gray-50 border-gray-200"} rounded-3xl p-4 md:p-6 shadow-2xl border-2`,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start justify-between gap-3 md:gap-0 mb-5",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[e.jsxs(W,{className:"bg-gradient-to-r from-blue-600 to-blue-500 text-white font-bold px-2 md:px-3 py-1 shadow-lg text-xs",children:["#",o.order_code]}),e.jsx("span",{className:`text-xs font-medium ${c?"text-gray-400":"text-gray-500"}`,children:ft(o.created_date)})]}),e.jsx("h3",{className:`font-bold text-lg md:text-xl ${c?"text-white":"text-gray-900"} mb-1`,children:o.customer_name}),e.jsxs("p",{className:`text-xs md:text-sm ${c?"text-gray-400":"text-gray-600"} flex items-center gap-2`,children:[e.jsx("span",{children:"üì±"})," ",o.customer_phone]})]}),e.jsxs(v.div,{whileHover:{scale:1.05},className:`text-center sm:text-right ${c?"bg-green-900/30":"bg-green-50"} px-3 md:px-4 py-2 md:py-3 rounded-2xl border-2 ${c?"border-green-700":"border-green-200"} w-full sm:w-auto`,children:[e.jsx("p",{className:`text-[10px] md:text-xs ${c?"text-green-400":"text-green-700"} font-semibold mb-1`,children:"Taxa de Entrega"}),e.jsx("p",{className:"font-bold text-xl md:text-2xl text-green-600",children:pe(o.delivery_fee||0)})]})]}),e.jsx("div",{className:"mb-5",children:e.jsx(Ts,{status:o.status,darkMode:c})}),e.jsx("div",{className:"mb-5",children:e.jsx(qs,{order:o,darkMode:c})}),e.jsxs(v.div,{whileHover:{scale:1.01},className:`p-5 rounded-2xl mb-5 ${c?"bg-gray-700/70 border-gray-600":"bg-gradient-to-r from-red-50 to-pink-50 border-red-200"} border-2 shadow-inner`,children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-red-500 rounded-xl flex items-center justify-center shadow-lg flex-shrink-0",children:e.jsx(B,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`text-xs font-bold ${c?"text-red-400":"text-red-700"} mb-1 uppercase tracking-wide`,children:"Endere√ßo de Entrega"}),e.jsx("p",{className:`font-bold text-base ${c?"text-white":"text-gray-900"} mb-1`,children:o.address}),o.neighborhood&&e.jsxs("p",{className:`text-sm ${c?"text-gray-400":"text-gray-600"}`,children:["üìç ",o.neighborhood]})]})]}),o.customer_latitude&&o.customer_longitude||o.address?e.jsxs(_,{onClick:()=>{let w="";const T=o.address||"",A=o.customer_latitude,Y=o.customer_longitude;A&&Y?w=`https://www.google.com/maps/dir/?api=1&destination=${A},${Y}`:T&&(w=`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(T)}`),w?window.open(w,"_blank"):X.error("Endere√ßo n√£o dispon√≠vel para navega√ß√£o")},className:"w-full mt-3 bg-blue-500 hover:bg-blue-600 text-white font-semibold h-10",children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Ir at√© o Cliente (Google Maps)"]}):null]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[e.jsx(v.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(_,{onClick:()=>bt(o.customer_phone,`Ol√°! Sou o entregador do seu pedido #${o.order_code}. Estou a caminho!`),variant:"outline",className:`w-full h-10 md:h-12 rounded-xl font-semibold text-xs ${c?"border-gray-700 hover:bg-gray-800":"border-gray-300 hover:bg-green-50 hover:border-green-300"}`,children:[e.jsx("span",{className:"mr-1",children:"üí¨"}),e.jsx("span",{className:"hidden sm:inline",children:"WhatsApp"})]})}),e.jsx(v.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(_,{onClick:()=>yt(o.customer_phone),variant:"outline",className:`w-full h-10 md:h-12 rounded-xl font-semibold text-xs ${c?"border-gray-700 hover:bg-gray-800":"border-gray-300 hover:bg-blue-50 hover:border-blue-300"}`,children:[e.jsx(ot,{className:"w-3 md:w-4 h-3 md:h-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Ligar"})]})}),e.jsx(v.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(_,{onClick:()=>P(!0),variant:"outline",className:`w-full h-10 md:h-12 rounded-xl font-semibold text-xs ${c?"border-gray-700 hover:bg-gray-800":"border-gray-300 hover:bg-orange-50 hover:border-orange-300"}`,children:[e.jsx(ee,{className:"w-3 md:w-4 h-3 md:h-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Reportar"})]})})]}),o.status==="going_to_store"?e.jsxs("div",{className:"space-y-3",children:[e.jsxs(v.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},className:`${c?"bg-blue-900/30 border-blue-700":"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-300"} border-2 rounded-2xl p-4`,children:[e.jsxs("p",{className:`text-sm font-bold ${c?"text-blue-400":"text-blue-900"} mb-2 flex items-center gap-2`,children:[e.jsx(B,{className:"w-4 h-4"}),"Indo ao Restaurante"]}),e.jsx("p",{className:`text-xs ${c?"text-gray-300":"text-gray-600"}`,children:'Clique em "Cheguei" quando voc√™ estiver no restaurante para solicitar o c√≥digo de coleta.'})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 md:gap-3",children:[e.jsx(v.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(_,{onClick:async()=>{const w=prompt(`Motivo do cancelamento:

1 - Restaurante fechado
2 - Pedido cancelado
3 - Outro motivo

Digite o n√∫mero ou descreva:`);if(!w)return;const A={1:"Restaurante fechado",2:"Pedido cancelado"}[w]||w;await $.entities.Order.update(o.id,{...o,status:"cancelled",rejection_reason:`Cancelado pelo entregador: ${A}`}),y._isVirtual||await $.entities.Entregador.update(y.id,{...y,status:"available",current_order_id:null}),O.invalidateQueries({queryKey:["deliveryOrders"]}),O.invalidateQueries({queryKey:["gestorOrders"]})},variant:"outline",className:`w-full h-10 md:h-12 rounded-xl font-semibold text-xs md:text-sm border-2 ${c?"border-red-700 text-red-400 hover:bg-red-900/30":"border-red-500 text-red-600 hover:bg-red-50"}`,children:[e.jsx(L,{className:"w-3 md:w-4 h-3 md:h-4 mr-1 md:mr-2"}),"Cancelar"]})}),e.jsx(v.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(_,{onClick:async()=>{await $.entities.Order.update(o.id,{...o,status:"arrived_at_store"}),O.invalidateQueries({queryKey:["deliveryOrders"]}),O.invalidateQueries({queryKey:["gestorOrders"]})},className:"w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white h-10 md:h-12 text-xs md:text-base font-bold rounded-xl shadow-lg shadow-blue-500/30",children:[e.jsx(J,{className:"w-4 md:w-5 h-4 md:h-5 mr-1 md:mr-2"}),"Cheguei ao Restaurante"]})})]})]}):o.status==="arrived_at_store"?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs md:text-sm font-bold mb-2 ${c?"text-gray-300":"text-gray-700"} uppercase tracking-wide`,children:"C√≥digo de Retirada do Restaurante"}),e.jsx(Ye,{placeholder:"Digite o c√≥digo do restaurante",value:r[o.id]||"",onChange:w=>l(T=>({...T,[o.id]:w.target.value})),maxLength:4,className:`text-center text-2xl md:text-3xl font-bold tracking-[0.3em] md:tracking-[0.5em] h-14 md:h-16 rounded-2xl ${c?"bg-gray-700 border-gray-600 text-white":"bg-gradient-to-r from-gray-50 to-white border-2 border-gray-300 text-gray-900"} focus:ring-4 focus:ring-blue-500/30`}),e.jsx("p",{className:`text-[10px] md:text-xs mt-2 text-center ${c?"text-gray-400":"text-gray-500"} font-medium`,children:"O restaurante fornecer√° este c√≥digo para liberar o pedido"})]}),e.jsx(v.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(_,{onClick:async()=>{const w=r[o.id]||"";if(!w){alert("Digite o c√≥digo fornecido pelo restaurante");return}if(w!==o.pickup_code){alert("C√≥digo inv√°lido! Verifique com o restaurante.");return}await $.entities.Order.update(o.id,{...o,status:"picked_up",picked_up_at:new Date().toISOString()}),O.invalidateQueries({queryKey:["deliveryOrders"]}),O.invalidateQueries({queryKey:["gestorOrders"]}),l(T=>{const A={...T};return delete A[o.id],A})},disabled:!r[o.id]||r[o.id].length!==4,className:"w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white h-10 md:h-12 text-xs md:text-base font-bold rounded-xl shadow-lg shadow-green-500/30",children:[e.jsx(K,{className:"w-4 md:w-5 h-4 md:h-5 mr-1 md:mr-2"}),"Confirmar Coleta"]})})]}):o.status==="picked_up"?e.jsxs("div",{className:"space-y-3",children:[e.jsxs(v.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},className:`${c?"bg-green-900/30 border-green-700":"bg-gradient-to-r from-green-50 to-emerald-50 border-green-300"} border-2 rounded-2xl p-4`,children:[e.jsxs("p",{className:`text-sm font-bold ${c?"text-green-400":"text-green-900"} mb-2 flex items-center gap-2`,children:[e.jsx(J,{className:"w-4 h-4"}),"Pedido Coletado com Sucesso!"]}),e.jsx("p",{className:`text-xs ${c?"text-gray-300":"text-gray-600"}`,children:'Clique em "Sair para Entrega" quando estiver pronto para ir at√© o cliente.'})]}),e.jsx(v.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(_,{onClick:async()=>{await $.entities.Order.update(o.id,{...o,status:"out_for_delivery"}),O.invalidateQueries({queryKey:["deliveryOrders"]}),O.invalidateQueries({queryKey:["gestorOrders"]})},className:"w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white h-12 md:h-14 text-base font-bold rounded-xl shadow-lg shadow-blue-500/30",children:[e.jsx(ne,{className:"w-5 h-5 mr-2"}),"Sair para Entrega"]})})]}):o.status==="out_for_delivery"?e.jsxs("div",{className:"space-y-3",children:[e.jsxs(v.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},className:`${c?"bg-blue-900/30 border-blue-700":"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-300"} border-2 rounded-2xl p-4`,children:[e.jsxs("p",{className:`text-sm font-bold ${c?"text-blue-400":"text-blue-900"} mb-2 flex items-center gap-2`,children:[e.jsx(ne,{className:"w-4 h-4"}),"A Caminho do Cliente"]}),e.jsx("p",{className:`text-xs ${c?"text-gray-300":"text-gray-600"}`,children:'Clique em "Cheguei" quando estiver no local de entrega para solicitar o c√≥digo do cliente.'})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 md:gap-3",children:[e.jsx(v.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(_,{onClick:async()=>{const w=prompt(`Motivo do cancelamento:

1 - Endere√ßo n√£o encontrado
2 - Cliente n√£o atende
3 - Outro motivo

Digite o n√∫mero ou descreva:`);if(!w)return;const A={1:"Endere√ßo n√£o encontrado",2:"Cliente n√£o atende"}[w]||w;await $.entities.Order.update(o.id,{...o,status:"cancelled",rejection_reason:`Cancelado pelo entregador: ${A}`}),y._isVirtual||await $.entities.Entregador.update(y.id,{...y,status:"available",current_order_id:null}),O.invalidateQueries({queryKey:["deliveryOrders"]}),O.invalidateQueries({queryKey:["gestorOrders"]})},variant:"outline",className:`w-full h-10 md:h-12 rounded-xl font-semibold text-xs md:text-sm border-2 ${c?"border-red-700 text-red-400 hover:bg-red-900/30":"border-red-500 text-red-600 hover:bg-red-50"}`,children:[e.jsx(L,{className:"w-3 md:w-4 h-3 md:h-4 mr-1 md:mr-2"}),"Cancelar"]})}),e.jsx(v.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(_,{onClick:async()=>{await $.entities.Order.update(o.id,{...o,status:"arrived_at_customer"}),O.invalidateQueries({queryKey:["deliveryOrders"]}),O.invalidateQueries({queryKey:["gestorOrders"]})},className:"w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white h-10 md:h-12 text-xs md:text-base font-bold rounded-xl shadow-lg shadow-blue-500/30",children:[e.jsx(J,{className:"w-4 md:w-5 h-4 md:h-5 mr-1 md:mr-2"}),"Cheguei no Local"]})})]})]}):o.status==="arrived_at_customer"?e.jsxs("div",{className:"space-y-3 md:space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs md:text-sm font-bold mb-2 md:mb-3 ${c?"text-gray-300":"text-gray-700"} uppercase tracking-wide`,children:"C√≥digo de Valida√ß√£o do Cliente"}),e.jsx(v.div,{whileFocus:{scale:1.02},children:e.jsx(Ye,{placeholder:"Digite os 4 d√≠gitos",value:s[o.id]||"",onChange:w=>t(T=>({...T,[o.id]:w.target.value})),maxLength:4,className:`text-center text-2xl md:text-3xl font-bold tracking-[0.3em] md:tracking-[0.5em] h-14 md:h-16 rounded-2xl ${c?"bg-gray-700 border-gray-600 text-white":"bg-gradient-to-r from-gray-50 to-white border-2 border-gray-300 text-gray-900"} focus:ring-4 focus:ring-blue-500/30`})}),e.jsx("p",{className:`text-[10px] md:text-xs mt-2 text-center ${c?"text-gray-400":"text-gray-500"} font-medium px-2`,children:"O cliente ir√° fornecer este c√≥digo ao receber o pedido"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 md:gap-3",children:[e.jsx(v.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(_,{onClick:async()=>{const w=prompt(`Motivo do cancelamento:

1 - Endere√ßo n√£o encontrado
2 - Cliente n√£o atende
3 - Outro motivo

Digite o n√∫mero ou descreva:`);if(!w)return;const A={1:"Endere√ßo n√£o encontrado",2:"Cliente n√£o atende"}[w]||w;await $.entities.Order.update(o.id,{...o,status:"cancelled",rejection_reason:`Cancelado pelo entregador: ${A}`}),y._isVirtual||await $.entities.Entregador.update(y.id,{...y,status:"available",current_order_id:null}),O.invalidateQueries({queryKey:["deliveryOrders"]}),O.invalidateQueries({queryKey:["gestorOrders"]})},variant:"outline",className:`w-full h-10 md:h-12 rounded-xl font-semibold text-xs md:text-sm border-2 ${c?"border-red-700 text-red-400 hover:bg-red-900/30":"border-red-500 text-red-600 hover:bg-red-50"}`,children:[e.jsx(L,{className:"w-3 md:w-4 h-3 md:h-4 mr-1 md:mr-2"}),"Cancelar"]})}),e.jsx(v.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(_,{onClick:()=>ut(o),disabled:!s[o.id]||s[o.id].length!==4,className:"w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white h-10 md:h-14 text-xs md:text-base font-bold rounded-xl shadow-lg shadow-green-500/30",children:[e.jsx(J,{className:"w-4 md:w-5 h-4 md:h-5 mr-1 md:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Confirmar Entrega"}),e.jsx("span",{className:"sm:hidden",children:"Confirmar"})]})})]})]}):null]},o.id))})]}),ke.length>0&&e.jsxs("div",{className:"max-w-7xl mx-auto px-4 pb-8",children:[e.jsxs("h2",{className:`text-xl font-bold mb-4 ${c?"text-white":"text-gray-900"}`,children:["Entregas Conclu√≠das Hoje (",ke.length,")"]}),e.jsx("div",{className:"space-y-3",children:ke.slice(0,5).map((o,w)=>e.jsxs(v.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:w*.05},whileHover:{scale:1.01,x:4},className:`${c?"bg-gradient-to-r from-gray-800 to-gray-900 border-gray-700":"bg-gradient-to-r from-white to-gray-50 border-gray-200"} rounded-2xl p-5 flex items-center justify-between border-2 shadow-md`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-green-500 to-green-600 rounded-2xl flex items-center justify-center shadow-lg",children:e.jsx(J,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("p",{className:`font-bold ${c?"text-white":"text-gray-900"} mb-1`,children:["#",o.order_code," - ",o.customer_name]}),e.jsxs("p",{className:`text-sm ${c?"text-gray-400":"text-gray-500"} flex items-center gap-2`,children:[e.jsx(se,{className:"w-3 h-3"}),new Date(o.delivered_at).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})]})]})]}),e.jsx("div",{className:`px-4 py-2 rounded-xl ${c?"bg-green-900/30":"bg-green-50"} border-2 ${c?"border-green-700":"border-green-200"}`,children:e.jsx("span",{className:"font-bold text-lg text-green-600",children:pe(o.delivery_fee||0)})})]},o.id))})]}),d&&e.jsx(hs,{order:d,entregador:y,onClose:()=>u(null),onConfirm:gt,darkMode:c}),g&&e.jsx(ps,{order:g,entregador:y,onClose:()=>h(null),darkMode:c}),i&&e.jsx(fs,{onClose:ht,darkMode:c}),b&&R&&e.jsx(It,{user:R,profileRole:"entregador",onClose:()=>p(!1),onUpdate:o=>{setUser(o),y&&setEntregador({...y,...o}),O.invalidateQueries({queryKey:["entregador"]})}}),C&&e.jsx(bs,{entregador:y,onClose:()=>j(!1),onDarkModeChange:F}),f&&y?.id&&e.jsx(gs,{entregadorId:y.id,darkMode:c,isOpen:f,onClose:()=>N(!1)}),ue.orders.pendingOrders.length>0&&e.jsx(ws,{order:ue.orders.pendingOrders[0],onAccept:o=>ue.orders.acceptOrder(o,y.id),onReject:ue.orders.rejectOrder}),re&&e.jsx(Ps,{isOpen:re,onClose:()=>Re(!1),orders:I,currentLocation:q,darkMode:c}),e.jsx(ks,{isOpen:Pe,onClose:()=>Te(!1),onPause:pt,darkMode:c}),e.jsx(As,{isOpen:S,onClose:()=>P(!1),order:I[0],entregador:y,darkMode:c})]})}):e.jsx("div",{className:`min-h-screen flex items-center justify-center p-4 ${c?"bg-gray-900":"bg-gray-100"}`,children:e.jsxs("div",{className:`${c?"bg-gray-800":"bg-white"} rounded-2xl shadow-lg p-8 max-w-md text-center`,children:[e.jsx(ee,{className:"w-16 h-16 text-amber-500 mx-auto mb-4"}),e.jsx("h2",{className:`text-2xl font-bold mb-2 ${c?"text-white":"text-gray-800"}`,children:"Acesso Negado"}),e.jsx("p",{className:`mb-6 ${c?"text-gray-300":"text-gray-600"}`,children:"Voc√™ n√£o est√° cadastrado como entregador."}),e.jsx(ze,{to:Ve("Cardapio",k||void 0),children:e.jsx(_,{className:"w-full bg-blue-500 hover:bg-blue-600",children:"Ver Card√°pio"})})]})})}export{Va as default};
