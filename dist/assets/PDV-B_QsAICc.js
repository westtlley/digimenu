import{r as i,j as e,B as d,X as As,p as Je,f as Fs,u as ma,g as c,e as xa,L as ws,F as ha,d as Cs,z as p}from"./main-BRmc9wuQ.js";import{u as k}from"./useQuery-DECqmSjD.js";import{u as ie}from"./useMutation-7mrcm5kq.js";import{L as q,I as V}from"./input-BSSWZZVM.js";import{B as se}from"./badge-0XfQUglg.js";import{C as ua,c as pa}from"./card-Ctp-7rs8.js";import{D as I,a as R,b as H,c as Q,e as ae}from"./dialog-DJhUD2H1.js";import{u as ga}from"./useSlugContext-C_H0E5cf.js";import{u as fa,N as ja,P as ba,U as ya}from"./useUpsell-CGRIavuk.js";import{D as Na}from"./dollar-sign-Cy_CReDz.js";import{A as va}from"./index-POiUmsPA.js";import{m as ue}from"./proxy-UArsdzLI.js";import{C as Ae}from"./circle-check-big-BgD3Vilh.js";import{T as Ye}from"./trash-2-BCVOf2oN.js";import{P as Fe}from"./plus-DSv6Z-VR.js";import{C as wa}from"./circle-alert-BZWE3mVm.js";import{P as ks,u as Ca}from"./useManagerialAuth-BHrKp2KS.js";import{u as Sa}from"./usePermission-iPsVutLm.js";import{I as _a}from"./InstallAppButton-D28BW715.js";import{f as h}from"./formatters-CvOEClq0.js";import{L as Ze}from"./log-out-CDSnoSZk.js";import{C as Pa}from"./credit-card-BeVXrvzu.js";import{A as Ss}from"./arrow-left-CctukX1s.js";import{R as _s}from"./receipt-CmsoOcEY.js";import{W as Da}from"./wallet-CtBJ9SZV.js";import{H as Ps}from"./history-Dy7dhA_p.js";import{T as Aa}from"./trending-up-DfwTY8KU.js";import{T as Fa}from"./trending-down-BJcPmoiH.js";import{S as ka}from"./search-BzcCetuR.js";import{S as We}from"./shopping-cart-DFfB9Dsc.js";import{M as Ds}from"./minus-RtCrWvOr.js";import{C as za}from"./clock-BVnf5BSk.js";import"./index-DtU2aqBA.js";import"./index-Cj8IEuVO.js";import"./index-Us3IJkK4.js";import"./base44Client-DNwoQjfp.js";import"./play-BshYjaFQ.js";import"./check-B8wFGgpR.js";import"./chevron-left-dEb2H1jL.js";import"./chevron-down-Br9th1QV.js";import"./star-gxnzHQI6.js";import"./shopping-bag-BPXgUy-7.js";import"./zap-Cci-1Hlx.js";import"./download-BLDsYadX.js";const Oa=[{id:"dinheiro",label:"Dinheiro",icon:"ðŸ’µ"},{id:"pix",label:"PIX",icon:"ðŸ“±"},{id:"debito",label:"DÃ©bito",icon:"ðŸ’³"},{id:"credito",label:"CrÃ©dito",icon:"ðŸ’³"},{id:"outro",label:"Outro",icon:"ðŸ§¾"}];function Ma({isOpen:b,onClose:S,total:u,formatCurrency:f,onConfirm:D}){const[y,z]=i.useState([]),[X,N]=i.useState(!1),[_,l]=i.useState(null),[A,$]=i.useState(""),[E,G]=i.useState("");i.useEffect(()=>{b&&(z([]),N(!0),l(null),$(""),G(""))},[b,u]);const K=y.reduce((m,T)=>m+T.amount,0),F=u-K,O=F<=0,J=()=>{if(!_||!A||parseFloat(A)<=0)return;const m=Math.min(parseFloat(A),F);z([...y,{id:Date.now(),method:_.id,methodLabel:_.label,amount:m}]),l(null),$(""),N(!1)},Y=m=>{z(y.filter(T=>T.id!==m))},v=()=>{if(O)if(y.length===1&&y[0].method==="dinheiro"){const m=y[0],T=m.amount-u;D({payments:[{...m,amount:u}],change:Math.max(0,T),document:E})}else D({payments:y,change:0,document:E})};return e.jsx(I,{open:b,onOpenChange:S,children:e.jsxs(R,{className:"max-w-lg",children:[e.jsx(H,{children:e.jsxs(Q,{className:"flex items-center gap-2 text-xl",children:[e.jsx(Na,{className:"w-6 h-6 text-green-600"}),"Formas de Pagamento"]})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-50 to-red-50 border-2 border-orange-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total a Pagar"}),e.jsx("p",{className:"text-3xl font-bold text-orange-600",children:f(u)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Restante"}),e.jsx("p",{className:`text-2xl font-bold ${F>0?"text-red-600":"text-green-600"}`,children:f(Math.max(0,F))})]})]})}),y.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{className:"font-semibold",children:"Pagamentos Registrados"}),e.jsx(va,{children:y.map(m=>e.jsxs(ue.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ae,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:m.methodLabel}),e.jsx("p",{className:"text-lg font-bold text-green-600",children:f(m.amount)})]})]}),e.jsx("button",{onClick:()=>Y(m.id),className:"text-red-500 hover:text-red-700 p-2",children:e.jsx(Ye,{className:"w-4 h-4"})})]},m.id))})]}),!O&&e.jsx(e.Fragment,{children:X?e.jsxs(ue.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"space-y-4 p-4 bg-gray-50 rounded-lg border-2 border-gray-200",children:[e.jsx(q,{className:"font-semibold",children:"Selecione a Forma de Pagamento"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:Oa.map(m=>e.jsxs("button",{onClick:()=>l(m),className:`p-3 rounded-lg border-2 transition-all ${_?.id===m.id?"border-green-500 bg-green-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:m.icon}),e.jsx("p",{className:"font-medium text-xs",children:m.label})]},m.id))}),_&&e.jsxs(ue.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs(q,{className:"mb-2 block",children:["Valor em ",_.label," (R$)"]}),e.jsx(V,{type:"number",step:"0.01",max:F,value:A,onChange:m=>{(parseFloat(m.target.value)<=F||!m.target.value)&&$(m.target.value)},placeholder:`MÃ¡x: ${f(F)}`,className:"h-12 text-lg font-semibold",autoFocus:!0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{onClick:()=>{N(!1),l(null),$("")},variant:"outline",className:"flex-1",children:"Cancelar"}),e.jsxs(d,{onClick:J,disabled:!A||parseFloat(A)<=0,className:"flex-1 bg-green-600 hover:bg-green-700",children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Adicionar"]})]})]})]}):e.jsxs(d,{onClick:()=>N(!0),variant:"outline",className:"w-full border-dashed border-2",children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Adicionar Forma de Pagamento"]})}),O&&e.jsxs(ue.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-green-50 border-2 border-green-500 rounded-lg p-4 flex items-center gap-3",children:[e.jsx(Ae,{className:"w-6 h-6 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-green-800",children:"Pagamento Completo!"}),e.jsxs("p",{className:"text-sm text-green-600",children:["Total pago: ",f(K)]})]})]}),F>0&&y.length>0&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 flex items-center gap-2",children:[e.jsx(wa,{className:"w-5 h-5 text-yellow-600"}),e.jsxs("p",{className:"text-sm text-yellow-800",children:["Ainda falta ",f(F)," para completar o pagamento"]})]}),y.length>0&&e.jsxs("div",{children:[e.jsx(q,{className:"mb-2 block text-xs text-gray-600",children:"CPF/CNPJ (opcional)"}),e.jsx(V,{value:E,onChange:m=>G(m.target.value),placeholder:"000.000.000-00",className:"h-10"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-2 border-t",children:[e.jsx(d,{variant:"outline",onClick:S,className:"h-12",children:"Cancelar"}),e.jsxs(d,{onClick:v,disabled:!O,className:"bg-green-600 hover:bg-green-700 h-12 font-semibold",children:[e.jsx(Ae,{className:"w-5 h-5 mr-2"}),"Confirmar"]})]})]})})}function Va({isOpen:b,onClose:S,orderCode:u,total:f,payments:D,change:y,formatCurrency:z,onPrint:X}){return e.jsx(I,{open:b,onOpenChange:S,children:e.jsx(R,{className:"max-w-md",children:e.jsxs("div",{className:"text-center py-6",children:[e.jsx(ue.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",duration:.5},children:e.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Ae,{className:"w-12 h-12 text-green-600"})})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Venda ConcluÃ­da!"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["Pedido ",e.jsxs("span",{className:"font-mono font-bold",children:["#",u]})," registrado com sucesso"]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2 text-left mb-6",children:[D&&D.length>0&&e.jsxs(e.Fragment,{children:[D.length>1&&e.jsx("div",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Pagamento Misto:"}),D.map((N,_)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:[N.methodLabel,":"]}),e.jsx("span",{className:"font-semibold text-green-600",children:z(N.amount)})]},_))]}),e.jsxs("div",{className:"flex justify-between text-sm pt-2 border-t",children:[e.jsx("span",{className:"text-gray-600",children:"Total:"}),e.jsx("span",{className:"font-semibold text-green-600",children:z(f)})]}),y>0&&e.jsxs("div",{className:"flex justify-between text-sm pt-2 border-t",children:[e.jsx("span",{className:"text-gray-600",children:"Troco:"}),e.jsx("span",{className:"font-bold text-orange-600",children:z(y)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{onClick:X,className:"w-full bg-blue-600 hover:bg-blue-700 h-12 font-semibold",children:[e.jsx(ks,{className:"w-5 h-5 mr-2"}),"Imprimir Cupom"]}),e.jsxs(d,{onClick:S,variant:"outline",className:"w-full h-12 font-semibold",children:[e.jsx(As,{className:"w-5 h-5 mr-2"}),"Fechar"]})]})]})})})}function qa(b){const S=Je.useRef(b);S.current=b,Je.useEffect(()=>{const u=f=>{if(!(f.target.tagName==="INPUT"||f.target.tagName==="TEXTAREA"))switch(f.key){case"F2":f.preventDefault(),S.current?.onOpenMenuVendas?.();break;case"F4":f.preventDefault(),S.current?.onOpenFechamento?.();break;case"F9":f.preventDefault(),S.current?.onCancelSale?.();break;case"F11":f.preventDefault(),S.current?.onFinishSale?.();break}};return window.addEventListener("keydown",u),()=>window.removeEventListener("keydown",u)},[])}function Ta({open:b,onOpenChange:S,caixa:u,operations:f=[],storeName:D="Estabelecimento",operatorName:y="",terminalName:z="",onPrint:X,onFecharClick:N}){if(!u)return null;const _=f.filter(n=>String(n.caixa_id)===String(u.id)),l=_.filter(n=>n.type==="venda_pdv"),A=_.filter(n=>n.type==="sangria"),$=_.filter(n=>n.type==="suprimento"),E=l.filter(n=>n.payment_method==="credito").reduce((n,g)=>n+g.amount,0),G=l.filter(n=>n.payment_method==="debito").reduce((n,g)=>n+g.amount,0),K=l.filter(n=>n.payment_method==="dinheiro").reduce((n,g)=>n+g.amount,0),F=l.filter(n=>n.payment_method==="pix").reduce((n,g)=>n+g.amount,0),O=l.filter(n=>n.payment_method==="outro").reduce((n,g)=>n+g.amount,0),J=E+G+K+F+O,Y=Number(u.opening_amount_cash)||0,v=A.reduce((n,g)=>n+g.amount,0),m=$.reduce((n,g)=>n+g.amount,0),T=Y+J+m-v,le=l.reduce((n,g)=>n+(g.change||0),0),oe=l.length,pe=u.opening_date?new Date(u.opening_date).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"-",ke=u.status==="closed"&&u.closing_date?new Date(u.closing_date).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"(CAIXA ABERTO)",ce=Je.useRef(null),o=()=>{if(X){X();return}const n=ce.current;if(!n)return;const g=window.open("","_blank");g.document.write(`
      <!DOCTYPE html><html><head><meta charset="utf-8"><title>Fechamento de Caixa</title>
      <style>body{ font-family: monospace; padding: 16px; font-size: 12px; } .line{border-bottom:1px solid #000; margin:4px 0;} .center{text-align:center;} table{width:100%;} td:nth-child(2){text-align:right;}</style>
      </head><body>${n.innerHTML}</body></html>
    `),g.document.close(),g.print(),g.close()};return e.jsx(I,{open:b,onOpenChange:S,children:e.jsxs(R,{className:"sm:max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsx(H,{children:e.jsx(Q,{className:"text-xl",children:"Fechamento de Caixa"})}),e.jsxs("div",{ref:ce,className:"space-y-4 text-sm",children:[e.jsx("div",{className:"text-center font-bold text-base",children:"RELATÃ“RIO DE FECHAMENTO"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"OPERADOR:"})," ",y||u.opened_by||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"CAIXA:"})," ",z||u.id||"1"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"DH INICIAL:"})," ",pe]}),e.jsxs("p",{children:[e.jsx("strong",{children:"DH FINAL:"})," ",ke]})]}),e.jsx("div",{className:"line"}),e.jsx("div",{className:"font-semibold",children:"MOVIMENTAÃ‡Ã•ES"}),e.jsx("table",{className:"w-full text-sm",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"(+) ABERTURA DE CAIXA"}),e.jsx("td",{children:"1"}),e.jsx("td",{className:"text-right",children:h(Y)})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"(+) VENDA (VF)"}),e.jsx("td",{children:l.length}),e.jsx("td",{className:"text-right",children:h(J)})]}),e.jsxs("tr",{className:"font-bold",children:[e.jsx("td",{children:"(=) SALDO EM CAIXA"}),e.jsx("td",{}),e.jsx("td",{className:"text-right",children:h(T)})]})]})}),e.jsx("div",{className:"line"}),e.jsx("div",{className:"font-semibold",children:"FORMA DE PAGAMENTO"}),e.jsx("table",{className:"w-full text-sm",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"C. CRÃ‰DITO"}),e.jsx("td",{children:l.filter(n=>n.payment_method==="credito").length}),e.jsx("td",{className:"text-right",children:h(E)})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"C. DÃ‰BITO"}),e.jsx("td",{children:l.filter(n=>n.payment_method==="debito").length}),e.jsx("td",{className:"text-right",children:h(G)})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"DINHEIRO"}),e.jsx("td",{children:l.filter(n=>n.payment_method==="dinheiro").length}),e.jsx("td",{className:"text-right",children:h(K)})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"PIX"}),e.jsx("td",{children:l.filter(n=>n.payment_method==="pix").length}),e.jsx("td",{className:"text-right",children:h(F)})]}),e.jsxs("tr",{className:"font-bold",children:[e.jsx("td",{children:"TOTAL"}),e.jsx("td",{}),e.jsx("td",{className:"text-right",children:h(J)})]})]})}),e.jsx("div",{className:"line"}),e.jsx("div",{className:"font-semibold",children:"VENDAS CANCELADAS"}),e.jsx("table",{className:"w-full text-sm",children:e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:"VENDA"}),e.jsx("td",{children:"0"}),e.jsx("td",{className:"text-right",children:"0,00"})]})})}),e.jsx("p",{className:"text-xs text-gray-500",children:"CANCELAMENTO EM TELA"}),e.jsx("div",{className:"line"}),e.jsx("div",{className:"font-semibold",children:"ADICIONAIS"}),e.jsx("table",{className:"w-full text-sm",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"TROCO"}),e.jsx("td",{className:"text-right",children:h(le)})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"DESCONTO"}),e.jsx("td",{className:"text-right",children:"0,00"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"ACRÃ‰SCIMO"}),e.jsx("td",{className:"text-right",children:"0,00"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"QTDE CUPONS"}),e.jsx("td",{className:"text-right",children:oe})]})]})})]}),e.jsxs(ae,{className:"flex-wrap gap-2",children:[e.jsxs(d,{type:"button",variant:"outline",size:"sm",onClick:o,children:[e.jsx(ks,{className:"w-4 h-4 mr-2"}),"Imprimir"]}),u.status==="open"&&N&&e.jsxs(d,{type:"button",className:"bg-gray-900",onClick:N,children:[e.jsx(Fs,{className:"w-4 h-4 mr-2"}),"Fechar"]}),e.jsxs(d,{type:"button",variant:"outline",onClick:()=>S(!1),children:[e.jsx(Ze,{className:"w-4 h-4 mr-2"}),"Sair"]})]})]})})}function At(){const[b,S]=i.useState(null),[u,f]=i.useState(!0),[D,y]=i.useState(!1),[z,X]=i.useState(""),[N,_]=i.useState("all"),[l,A]=i.useState([]),[$,E]=i.useState(""),[G,K]=i.useState(""),[F,O]=i.useState(!1),[J,Y]=i.useState(!1),[v,m]=i.useState(null),[T,le]=i.useState(null),[oe,pe]=i.useState("Cliente BalcÃ£o"),[ke,ce]=i.useState(""),[o,n]=i.useState(null),[g,de]=i.useState(!1),[zs,B]=i.useState(!1),[ge,es]=i.useState(""),[fe,ss]=i.useState(""),[Os,ze]=i.useState(!1),[as,Oe]=i.useState(null),[M,Me]=i.useState(null),[ts,Ve]=i.useState(""),[je,qe]=i.useState(""),[Ms,me]=i.useState(!1),U=ma(),{isMaster:Te}=Sa(),{requireAuthorization:be,modal:Vs}=Ca(),{slug:qs,subscriberEmail:rs,inSlugContext:Ts}=ga(),P=Ts&&Te&&rs?rs:void 0,[Es,te]=i.useState(!1),[Ls,xe]=i.useState(!1),[Is,ye]=i.useState(!1),[Rs,Ne]=i.useState(!1),[$s,ve]=i.useState(!1),[Z,Ee]=i.useState({amount:"",reason:""}),[ee,Le]=i.useState({amount:"",reason:""}),[we,ns]=i.useState(""),[is,ls]=i.useState("");i.useEffect(()=>{(async()=>{try{const s=await c.auth.me();if(S(s),!s){c.auth.redirectToLogin("/PDV");return}const a=s?.subscriber_email&&(s?.email||"").toLowerCase().trim()===(s?.subscriber_email||"").toLowerCase().trim(),t=s?.profile_role==="pdv"||s?.is_master===!0||a;if(y(t),!t){f(!1);return}}catch{c.auth.redirectToLogin("/PDV")}finally{f(!1)}})()},[]);const os=xa(Te?"Admin":"PainelAssinante",Te?void 0:qs||void 0),w=P?{as_subscriber:P}:{},{data:cs=[]}=k({queryKey:["dishes",P??"me"],queryFn:()=>c.entities.Dish.list(null,w)}),{data:Ks=[]}=k({queryKey:["categories",P??"me"],queryFn:()=>c.entities.Category.list("order",w)}),{data:ds=[]}=k({queryKey:["complementGroups",P??"me"],queryFn:()=>c.entities.ComplementGroup.list("order",w),refetchOnMount:"always"}),{data:ms=[],isLoading:xs}=k({queryKey:["caixas",P??"me"],queryFn:()=>c.entities.Caixa.list("-opening_date",w),refetchInterval:5e3}),{data:Ie=[]}=k({queryKey:["caixaOperations",P??"me"],queryFn:()=>c.entities.CaixaOperation.list("-date",w).catch(()=>[]),enabled:!!b&&D}),Ce=o&&Array.isArray(Ie)?Ie.filter(s=>String(s.caixa_id)===String(o.id)):[],{data:Re=[]}=k({queryKey:["pedidosPDV",P??"me"],queryFn:()=>c.entities.PedidoPDV.list("-created_date",w).catch(()=>[])}),{data:Bs=[]}=k({queryKey:["store",P??"me"],queryFn:()=>c.entities.Store.list(w)}),W=Bs[0]||{theme_primary_color:"#f97316"},Us=Array.isArray(W?.pdv_terminals)&&W.pdv_terminals.length>0?W.pdv_terminals:["PDV 1","PDV 2","PDV 3"],{data:hs=[]}=k({queryKey:["pdvSessions",P??"me"],queryFn:()=>c.entities.PDVSession.list("-created_at",{...w,ended_at:"null"}).catch(()=>[]),enabled:!!b&&D}),us=Array.isArray(hs)?hs.filter(s=>!s.ended_at):[],{data:ps=[]}=k({queryKey:["pizzaSizes",P??"me"],queryFn:()=>c.entities.PizzaSize.list("order",w)}),{data:gs=[]}=k({queryKey:["pizzaFlavors",P??"me"],queryFn:()=>c.entities.PizzaFlavor.list("order",w)}),{data:Hs=[]}=k({queryKey:["pizzaEdges",P??"me"],queryFn:()=>c.entities.PizzaEdge.list(null,w)}),{data:Qs=[]}=k({queryKey:["pizzaExtras",P??"me"],queryFn:()=>c.entities.PizzaExtra.list(null,w)}),{data:Xs=[]}=k({queryKey:["pizzaCategories",P??"me"],queryFn:()=>c.entities.PizzaCategory.list("order",w)}),{data:fs=[]}=k({queryKey:["promotions",P??"me"],queryFn:()=>c.entities.Promotion.list(w)}),{showUpsellModal:Gs,upsellPromotions:Ws,checkUpsell:Js,resetUpsell:Ys,closeUpsell:Se}=fa(Array.isArray(fs)?fs:[],l.reduce((s,a)=>s+(a.totalPrice||0)*(a.quantity||1),0));i.useEffect(()=>{const s=(ms||[]).find(a=>a&&a.status==="open");n(s||null),!xs&&B(!s)},[ms,xs]);const js=ie({mutationFn:async s=>c.entities.PDVSession.create(s),onSuccess:s=>{U.invalidateQueries({queryKey:["pdvSessions"]}),Me(s),Ve(s.terminal_id??s.terminal_name??""),qe(s.terminal_name??s.terminal_id??""),me(!1)}}),$e=ie({mutationFn:async s=>c.entities.PDVSession.update(s,{ended_at:new Date().toISOString()}),onSuccess:()=>{U.invalidateQueries({queryKey:["pdvSessions"]}),Me(null),Ve(""),qe(""),me(!0)}});i.useEffect(()=>{if(!b||!D||M)return;const s=us.find(a=>a.operator_email===b.email);s?(Me(s),Ve(s.terminal_id??s.terminal_name??""),qe(s.terminal_name??s.terminal_id??""),me(!1)):me(!0)},[b,D,us,M]);const Zs=ie({mutationFn:s=>c.entities.PedidoPDV.create(s),onSuccess:()=>{U.invalidateQueries({queryKey:["pedidosPDV"]})}}),Ke=ie({mutationFn:async s=>{const a=await c.auth.me();return c.entities.CaixaOperation.create({...s,subscriber_email:a?.subscriber_email||a?.email,operator:a.email,date:new Date().toISOString()})},onSuccess:()=>{U.invalidateQueries({queryKey:["caixaOperations"]})}}),Be=ie({mutationFn:async s=>{const a=await c.auth.me();return c.entities.Caixa.create({...s,subscriber_email:a?.subscriber_email||a?.email,opened_by:a.email})},onSuccess:()=>{U.invalidateQueries({queryKey:["caixas"]}),B(!1),es(""),ss(""),p.success("âœ… Caixa aberto com sucesso!")}}),Ue=ie({mutationFn:async({id:s,freshCaixa:a,totals:t,closingCash:x,closingNotes:r})=>{const C=await c.auth.me(),L={...a,opening_amount_cash:Number(a.opening_amount_cash)||0,status:"closed",total_cash:t.cash,total_pix:t.pix,total_debit:t.debit,total_credit:t.credit,total_other:t.other,closing_amount_cash:Number(x)||0,closing_notes:r||"",closed_by:C.email,closing_date:new Date().toISOString()};return delete L.id,delete L.created_date,delete L.updated_date,delete L.created_by,c.entities.Caixa.update(s,L)},onSuccess:()=>{U.invalidateQueries({queryKey:["caixas"]}),ve(!1),xe(!1),ns(""),ls(""),p.success("âœ… Caixa fechado com sucesso!")}}),re=o?.lock_threshold!=null&&(Number(o?.total_cash)||0)>=(Number(o?.lock_threshold)||0),ea=async()=>{if(!o||!Z.amount||!Z.reason){p.error("Preencha valor e motivo");return}const s=parseFloat(Z.amount),a=Ce.filter(j=>j.type==="venda_pdv"),t=Ce.filter(j=>j.type==="sangria"),x=Ce.filter(j=>j.type==="suprimento"),r=a.filter(j=>j.payment_method==="dinheiro").reduce((j,he)=>j+he.amount,0),C=t.reduce((j,he)=>j+he.amount,0),L=x.reduce((j,he)=>j+he.amount,0),da=(o.opening_amount_cash||0)+r+L-C;if(s>da){p.error("Saldo insuficiente no caixa");return}await Ke.mutateAsync({caixa_id:o.id,type:"sangria",description:`Sangria: ${Z.reason}`,amount:s,payment_method:"dinheiro",reason:Z.reason});const vs=await c.entities.Caixa.list("-opening_date",w),Ge=Array.isArray(vs)?vs.find(j=>String(j.id)===String(o.id)):null;if(Ge){const j={...Ge,withdrawals:(Ge.withdrawals||0)+s};delete j.id,delete j.created_date,delete j.updated_date,delete j.created_by,await c.entities.Caixa.update(o.id,j)}U.invalidateQueries({queryKey:["caixas","caixaOperations"]}),ye(!1),Ee({amount:"",reason:""}),p.success("Sangria registrada")},sa=async()=>{if(!o||!ee.amount||!ee.reason){p.error("Preencha valor e motivo");return}const s=parseFloat(ee.amount);await Ke.mutateAsync({caixa_id:o.id,type:"suprimento",description:`Suprimento: ${ee.reason}`,amount:s,payment_method:"dinheiro",reason:ee.reason});const a=await c.entities.Caixa.list("-opening_date",w),t=Array.isArray(a)?a.find(x=>String(x.id)===String(o.id)):null;if(t){const x={...t,supplies:(t.supplies||0)+s};delete x.id,delete x.created_date,delete x.updated_date,delete x.created_by,await c.entities.Caixa.update(o.id,x)}U.invalidateQueries({queryKey:["caixas","caixaOperations"]}),Ne(!1),Le({amount:"",reason:""}),p.success("Suprimento registrado")},aa=async()=>{if(!o||!we){p.error("Informe o valor em dinheiro ao fechar");return}const s=Ce.filter(r=>r.type==="venda_pdv"),a={cash:s.filter(r=>r.payment_method==="dinheiro").reduce((r,C)=>r+C.amount,0),pix:s.filter(r=>r.payment_method==="pix").reduce((r,C)=>r+C.amount,0),debit:s.filter(r=>r.payment_method==="debito").reduce((r,C)=>r+C.amount,0),credit:s.filter(r=>r.payment_method==="credito").reduce((r,C)=>r+C.amount,0),other:s.filter(r=>r.payment_method==="outro").reduce((r,C)=>r+C.amount,0)},t=await c.entities.Caixa.list("-opening_date",w),x=Array.isArray(t)?t.find(r=>String(r.id)===String(o.id)):null;if(!x){p.error("Caixa nÃ£o encontrado");return}Ue.mutate({id:o.id,freshCaixa:x,totals:a,closingCash:parseFloat(we),closingNotes:is})},He=Array.isArray(cs)?cs:[],bs=He.filter(s=>s&&s.is_active!==!1),ta=bs.some(s=>s.product_type==="pizza"),ys=bs.filter(s=>{if(!s||!s.name)return!1;const a=!z||s.name.toLowerCase().includes(z.toLowerCase());let t=!0;return N==="pizzas"?t=s.product_type==="pizza":N!=="all"&&(t=s.category_id===N),a&&t}),ra=s=>{if(!o){p.error("âš ï¸ Abra o caixa para iniciar as vendas"),B(!0);return}if(re){p.error("ðŸ”’ Caixa travado. FaÃ§a uma retirada em Caixa para continuar.");return}if(s.product_type==="pizza"&&ps?.length>0&&gs?.length>0){Oe(s);return}ds.filter(t=>s.complement_groups?.some(x=>x.group_id===t.id)).length>0?le(s):_e({dish:s,totalPrice:s.price??0,selections:{}})},_e=s=>{if(!o){p.error("âš ï¸ Abra o caixa para iniciar as vendas"),B(!0);return}if(re){p.error("ðŸ”’ Caixa travado. FaÃ§a uma retirada em Caixa para continuar.");return}const a={...s,quantity:1,id:Date.now()};A(t=>{const x=[...t,a],r=x.reduce((C,L)=>C+(L.totalPrice||0)*(L.quantity||1),0);return setTimeout(()=>Js(r),100),x}),le(null),Oe(null),p.success(`${s.dish.name} adicionado!`)},na=s=>{if(!s)return;const a=He.find(x=>x.id===s.offer_dish_id);if(!a){Se();return}s.type==="replace"&&A([]);const t={dish:{...a,price:s.offer_price},totalPrice:s.offer_price,selections:{}};_e(t),Se()},Pe=(s,a)=>{a<=0?Qe(s):A(l.map(t=>t.id===s?{...t,quantity:a}:t))},Qe=s=>{A(l.filter(a=>a.id!==s)),p.success("Item removido")},Ns=()=>{l.length!==0&&(A([]),E(""),K(""),pe("Cliente BalcÃ£o"),ce(""),Ys(),p.success("Venda limpa"))};qa({onOpenMenuVendas:()=>M&&te(!0),onOpenFechamento:()=>M&&o&&xe(!0),onCancelSale:Ns,onFinishSale:()=>{l.length>0&&!re&&o&&O(!0)}});const De=l.reduce((s,a)=>s+a.totalPrice*a.quantity,0),ia=De*(parseFloat(G||0)/100),Xe=parseFloat($||0)+ia,ne=Math.max(0,De-Xe);if(u)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ws,{className:"w-8 h-8 animate-spin text-orange-500 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Carregando..."})]})});if(!D)return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-gray-50 dark:bg-gray-900",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-8 max-w-md text-center",children:[e.jsx(Pa,{className:"w-16 h-16 text-orange-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"Acesso restrito"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:"Esta tela Ã© apenas para o perfil PDV."}),e.jsxs(d,{onClick:()=>c.auth.logout(),className:"bg-orange-600 hover:bg-orange-700 text-white",children:[e.jsx(Ze,{className:"w-4 h-4 mr-2"}),"Sair"]})]})});const la=()=>{const s=parseFloat(ge);if(isNaN(s)||s<0){p.error("Informe um valor vÃ¡lido de abertura");return}const a=fe?parseFloat(fe):null;if(fe&&(isNaN(a)||a<=0)){p.error("Valor limite de travamento deve ser maior que zero ou vazio");return}Be.mutate({opening_amount_cash:s,opening_date:new Date().toISOString(),status:"open",total_cash:0,total_pix:0,total_debit:0,total_credit:0,total_other:0,withdrawals:0,supplies:0,lock_threshold:a||null})},oa=async s=>{if(!o){p.error("âš ï¸ Abra o caixa para iniciar as vendas"),O(!1),B(!0);return}const a=await c.auth.me(),t=`PDV${Date.now().toString().slice(-8)}`,x={subscriber_email:a?.subscriber_email||a?.email,order_code:t,customer_name:oe,customer_phone:ke,customer_document:s.document,items:l.map(r=>({dish_id:r.dish?.id,dish_name:r.dish?.name,quantity:r.quantity,unit_price:r.totalPrice??r.dish?.price,total_price:(r.totalPrice??r.dish?.price??0)*r.quantity,selections:r.selections||(r.flavors?{size:r.size,flavors:r.flavors,edge:r.edge,extras:r.extras,specifications:r.specifications}:{})})),subtotal:De,discount:Xe,total:ne,payment_method:s.payments.length===1?s.payments[0].methodLabel:`Misto (${s.payments.map(r=>r.methodLabel).join(" + ")})`,payment_amount:s.payments.reduce((r,C)=>r+C.amount,0),change:s.change,caixa_id:o.id,seller_email:a.email,seller_name:a.full_name,...ts&&{pdv_terminal_id:ts},...je&&{pdv_terminal_name:je},...M?.id&&{pdv_session_id:M.id}};await Zs.mutateAsync(x);for(const r of s.payments)await Ke.mutateAsync({caixa_id:o.id,type:"venda_pdv",description:`PDV #${t} - ${oe} (${r.methodLabel})`,amount:r.amount,payment_method:r.method,payment_amount:r.amount,change:0,pedido_pdv_id:t});U.invalidateQueries({queryKey:["caixas"]}),m({orderCode:t,total:ne,payments:s.payments,change:s.change,items:l,customerName:oe}),A([]),E(""),K(""),pe("Cliente BalcÃ£o"),ce(""),O(!1),de(!1),Y(!0)},ca=()=>{if(!v)return;const s=window.open("","","width=300,height=600");s.document.write(`
      <html>
        <head>
          <title>Cupom #${v.orderCode}</title>
          <style>
            body { 
              font-family: 'Courier New', monospace; 
              font-size: 12px; 
              padding: 10px;
              margin: 0;
            }
            .center { text-align: center; }
            .bold { font-weight: bold; }
            .line { border-top: 1px dashed #000; margin: 10px 0; }
            .item { display: flex; justify-content: space-between; margin: 5px 0; }
            .total { font-size: 16px; margin-top: 10px; }
          </style>
        </head>
        <body>
          <div class="center bold">CUPOM NÃƒO FISCAL</div>
          <div class="center">PDV - Venda Presencial</div>
          <div class="line"></div>
          <div>Pedido: #${v.orderCode}</div>
          <div>Data: ${new Date().toLocaleString("pt-BR")}</div>
          <div>Cliente: ${v.customerName}</div>
          <div class="line"></div>
          ${v.items.map(a=>{const t=a.flavors?.length?` (${a.size?.name||""} ${a.flavors.map(x=>x.name).join(" + ")})`:"";return`
            <div class="item">
              <span>${a.quantity}x ${a.dish.name}${t||""}</span>
              <span>${h(a.totalPrice*a.quantity)}</span>
            </div>
          `}).join("")}
          <div class="line"></div>
          <div class="item bold total">
            <span>TOTAL</span>
            <span>${h(v.total)}</span>
          </div>
          <div class="line"></div>
          ${v.payments.map(a=>`
            <div>${a.methodLabel}: ${h(a.amount)}</div>
          `).join("")}
          ${v.change>0?`<div>Troco: ${h(v.change)}</div>`:""}
          <div class="line"></div>
          <div class="center">Obrigado pela preferÃªncia!</div>
        </body>
      </html>
    `),s.document.close(),s.print()};return e.jsxs("div",{className:"min-h-screen min-h-screen-mobile h-screen flex flex-col bg-gray-50",children:[e.jsx(ha,{position:"top-center"}),Vs,e.jsx("div",{className:"bg-gray-900 text-white h-14 sm:h-16 flex-shrink-0 border-b border-gray-700 safe-top",children:e.jsxs("div",{className:"h-full px-3 sm:px-4 flex items-center justify-between max-w-[2000px] mx-auto gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 min-w-0",children:[e.jsx(Cs,{to:os,className:"shrink-0",children:e.jsxs(d,{variant:"ghost",size:"sm",className:"text-white hover:bg-gray-800 min-h-touch min-w-touch h-10 sm:h-10 px-2 sm:px-3",children:[e.jsx(Ss,{className:"w-4 h-4 mr-2"}),"Voltar"]})}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(_s,{className:"w-4 h-4 sm:w-5 sm:h-5 shrink-0"}),e.jsx("h1",{className:"font-bold text-sm sm:text-lg truncate",children:"PDV - Venda Presencial"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 shrink-0",children:[e.jsx(_a,{pageName:"PDV",compact:!0}),o?e.jsx(se,{variant:"outline",className:"bg-green-600 text-white border-green-600 h-8 font-semibold",children:"âœ… Caixa Aberto"}):e.jsx(se,{variant:"outline",className:"bg-red-600 text-white border-red-600 h-8 font-semibold",children:"ðŸ”’ Caixa Fechado"}),e.jsxs(se,{variant:"outline",className:"text-white border-gray-600 h-8 hidden sm:flex",children:[l.length," ",l.length===1?"item":"itens"]}),e.jsxs(d,{variant:"ghost",size:"sm",onClick:()=>M&&te(!0),className:"text-white hover:bg-gray-800 h-10 hidden sm:flex",title:"Menu de Vendas (F2) - Suprimento, Sangria, Fechamento",children:[e.jsx(Da,{className:"w-4 h-4 mr-2"}),"Menu"]}),e.jsxs(d,{variant:"ghost",size:"sm",onClick:()=>ze(!0),className:"text-white hover:bg-gray-800 h-10 hidden sm:flex",children:[e.jsx(Ps,{className:"w-4 h-4 mr-2"}),"HistÃ³rico"]}),M&&e.jsxs(d,{variant:"ghost",size:"sm",onClick:()=>$e.mutate(M.id),disabled:$e.isPending,className:"text-white hover:bg-gray-800 h-10 hidden sm:flex",title:"Sair deste PDV (encerra sua sessÃ£o)",children:[$e.isPending?e.jsx(ws,{className:"w-4 h-4 animate-spin"}):e.jsx(Ze,{className:"w-4 h-4 mr-2"}),"Sair do PDV"]}),M&&e.jsx(se,{variant:"outline",className:"text-white border-gray-500 h-8 font-normal",children:je})]})]})}),e.jsx(I,{open:Ms,onOpenChange:me,children:e.jsxs(R,{className:"sm:max-w-md",children:[e.jsx(H,{children:e.jsx(Q,{children:"Selecionar terminal PDV"})}),e.jsx("p",{className:"text-sm text-gray-600",children:"Em qual PDV vocÃª estÃ¡ operando?"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 py-2",children:Us.map((s,a)=>e.jsx(d,{variant:"outline",className:"h-12",disabled:js.isPending,onClick:async()=>{const t=await c.auth.me();await js.mutateAsync({terminal_id:String(a+1),terminal_name:typeof s=="string"?s:`PDV ${a+1}`,operator_email:t?.email,operator_name:t?.full_name,started_at:new Date().toISOString()})},children:typeof s=="string"?s:`PDV ${a+1}`},a))}),e.jsx(ae,{})]})}),e.jsx(I,{open:Es,onOpenChange:te,children:e.jsxs(R,{className:"sm:max-w-sm",children:[e.jsx(H,{children:e.jsx(Q,{children:"Menu de Vendas"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 py-2",children:[e.jsxs(d,{variant:"outline",className:"h-14 flex flex-col gap-1",onClick:()=>{te(!1),be("suprimento",()=>Ne(!0))},children:[e.jsx(Aa,{className:"w-6 h-6 text-green-600"}),e.jsx("span",{children:"Suprimento (F2)"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Adicionar troco"})]}),e.jsxs(d,{variant:"outline",className:"h-14 flex flex-col gap-1",onClick:()=>{te(!1),be("sangria",()=>ye(!0))},children:[e.jsx(Fa,{className:"w-6 h-6 text-red-600"}),e.jsx("span",{children:"Sangria (F3)"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Retirada"})]}),e.jsxs(d,{variant:"outline",className:"h-14 flex flex-col gap-1 col-span-2",onClick:()=>{te(!1),xe(!0)},children:[e.jsx(Fs,{className:"w-6 h-6"}),e.jsx("span",{children:"Fechamento (F4)"}),e.jsx("span",{className:"text-xs text-gray-500",children:"RelatÃ³rio e fechar caixa"})]})]})]})}),e.jsx(Ta,{open:Ls,onOpenChange:xe,caixa:o,operations:Ie||[],storeName:W?.name,operatorName:b?.full_name||b?.email,terminalName:je,onFecharClick:o?.status==="open"?()=>be("fechar_caixa",()=>{xe(!1),ve(!0)}):void 0}),e.jsx(I,{open:$s,onOpenChange:ve,children:e.jsxs(R,{children:[e.jsx(H,{children:e.jsx(Q,{children:"Fechar caixa"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsx(q,{children:"Valor em dinheiro ao fechar (R$)"}),e.jsx(V,{type:"number",step:"0.01",value:we,onChange:s=>ns(s.target.value),placeholder:"0,00"}),e.jsx(q,{children:"ObservaÃ§Ãµes (opcional)"}),e.jsx(V,{value:is,onChange:s=>ls(s.target.value),placeholder:"ObservaÃ§Ãµes do fechamento"})]}),e.jsxs(ae,{children:[e.jsx(d,{variant:"outline",onClick:()=>ve(!1),children:"Cancelar"}),e.jsx(d,{onClick:aa,disabled:!we||Ue.isPending,children:Ue.isPending?"Fechando...":"Confirmar Fechamento"})]})]})}),e.jsx(I,{open:Is,onOpenChange:ye,children:e.jsxs(R,{children:[e.jsx(H,{children:e.jsx(Q,{children:"Registrar Sangria (retirada)"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(q,{children:"Valor (R$)"}),e.jsx(V,{type:"number",step:"0.01",value:Z.amount,onChange:s=>Ee(a=>({...a,amount:s.target.value})),placeholder:"0,00"})]}),e.jsxs("div",{children:[e.jsx(q,{children:"Motivo"}),e.jsx(V,{value:Z.reason,onChange:s=>Ee(a=>({...a,reason:s.target.value})),placeholder:"Ex: DepÃ³sito bancÃ¡rio"})]})]}),e.jsxs(ae,{children:[e.jsx(d,{variant:"outline",onClick:()=>ye(!1),children:"Cancelar"}),e.jsx(d,{className:"bg-red-600",onClick:ea,children:"Registrar Sangria"})]})]})}),e.jsx(I,{open:Rs,onOpenChange:Ne,children:e.jsxs(R,{children:[e.jsx(H,{children:e.jsx(Q,{children:"Registrar Suprimento (adicionar troco)"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(q,{children:"Valor (R$)"}),e.jsx(V,{type:"number",step:"0.01",value:ee.amount,onChange:s=>Le(a=>({...a,amount:s.target.value})),placeholder:"0,00"})]}),e.jsxs("div",{children:[e.jsx(q,{children:"Motivo"}),e.jsx(V,{value:ee.reason,onChange:s=>Le(a=>({...a,reason:s.target.value})),placeholder:"Ex: ReforÃ§o de caixa"})]})]}),e.jsxs(ae,{children:[e.jsx(d,{variant:"outline",onClick:()=>Ne(!1),children:"Cancelar"}),e.jsx(d,{className:"bg-orange-600",onClick:sa,children:"Registrar Suprimento"})]})]})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:!M&&D?e.jsx("div",{className:"flex items-center justify-center h-full p-8",children:e.jsx("p",{className:"text-gray-500",children:"Selecione o terminal PDV acima para continuar."})}):e.jsxs("div",{className:"h-full max-w-[2000px] mx-auto grid grid-cols-1 lg:grid-cols-[1fr_480px]",children:[e.jsxs("div",{className:"flex flex-col bg-white h-full overflow-hidden",children:[e.jsx("div",{className:"flex-shrink-0 bg-gray-50 border-b px-3 sm:px-4 py-2 sm:py-3",children:e.jsxs("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide",children:[e.jsx("button",{onClick:()=>_("all"),className:`px-4 sm:px-5 py-2 sm:py-2.5 rounded-lg text-xs sm:text-sm font-bold whitespace-nowrap transition-colors min-h-touch ${N==="all"?"bg-orange-500 text-white":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-300"}`,children:"TODOS"}),ta&&e.jsx("button",{onClick:()=>_("pizzas"),className:`px-4 sm:px-5 py-2 sm:py-2.5 rounded-lg text-xs sm:text-sm font-bold whitespace-nowrap transition-colors min-h-touch ${N==="pizzas"?"bg-orange-500 text-white":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-300"}`,children:"PIZZAS"}),(Ks||[]).filter(s=>s&&s.name).map(s=>e.jsx("button",{onClick:()=>_(s.id),className:`px-4 sm:px-5 py-2 sm:py-2.5 rounded-lg text-xs sm:text-sm font-bold whitespace-nowrap transition-colors min-h-touch ${N===s.id?"bg-orange-500 text-white":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-300"}`,children:(s.name||"Categoria").toUpperCase()},s.id))]})}),e.jsx("div",{className:"flex-shrink-0 px-4 py-3 bg-white border-b",children:e.jsxs("div",{className:"relative",children:[e.jsx(ka,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(V,{placeholder:"Buscar produto por nome...",value:z,onChange:s=>X(s.target.value),className:"pl-10 h-11 bg-gray-50"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-3",children:ys.map(s=>e.jsxs("button",{onClick:()=>ra(s),className:"group bg-white rounded-xl border-2 border-gray-200 hover:border-orange-400 hover:shadow-md transition-all overflow-hidden",children:[e.jsx("div",{className:"aspect-square bg-gray-100 overflow-hidden",children:s.image?e.jsx("img",{src:s.image,alt:s.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-5xl",children:"ðŸ½ï¸"})}),e.jsxs("div",{className:"p-3",children:[e.jsx("h4",{className:"font-bold text-sm text-gray-900 mb-2 line-clamp-2 min-h-[40px]",children:s.name}),e.jsx("div",{className:"text-xl font-bold text-orange-600",children:s.product_type==="pizza"?s.pizza_config?.sizes?.[0]?h(s.pizza_config.sizes[0].price_tradicional):"Montar":h(s.price)})]})]},s.id))}),ys.length===0&&e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-gray-400",children:"Nenhum produto encontrado"})})]})]}),e.jsxs("div",{className:"hidden lg:flex flex-col bg-gray-900 h-full overflow-hidden border-l border-gray-700",children:[e.jsx("div",{className:"flex-shrink-0 p-4 border-b border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-6 h-6 text-orange-400"}),e.jsx("h3",{className:"text-xl font-bold text-white",children:"Comanda"})]}),e.jsx(se,{className:"bg-orange-500 text-white px-3 py-1",children:l.length})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:l.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center py-12",children:[e.jsx(We,{className:"w-16 h-16 text-gray-700 mb-3"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Nenhum item na comanda"}),e.jsx("p",{className:"text-gray-600 text-xs mt-1",children:"Clique em um produto para adicionar"})]}):l.map(s=>e.jsxs("div",{className:"bg-gray-800 rounded-lg p-3 border border-gray-700",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1 pr-2",children:[e.jsx("h4",{className:"font-bold text-white text-sm mb-1",children:s.dish.name}),(s.flavors?.length>0||s.selections&&Object.keys(s.selections).length>0)&&e.jsxs("div",{className:"mb-1",children:[s.size&&e.jsxs("p",{className:"text-xs text-gray-400",children:["â€¢ ",s.size.name]}),s.flavors?.map((a,t)=>e.jsxs("p",{className:"text-xs text-gray-400",children:["â€¢ ",a.name]},t)),s.edge&&s.edge.id!=="none"&&e.jsxs("p",{className:"text-xs text-gray-400",children:["â€¢ Borda: ",s.edge.name]}),!s.flavors?.length&&Object.entries(s.selections||{}).map(([a,t])=>Array.isArray(t)?t.map((x,r)=>e.jsxs("p",{className:"text-xs text-gray-400",children:["â€¢ ",x?.name]},`${a}-${r}`)):t?e.jsxs("p",{className:"text-xs text-gray-400",children:["â€¢ ",t?.name]},a):null)]}),e.jsxs("p",{className:"text-xs text-gray-400",children:[h(s.totalPrice)," un."]})]}),e.jsx("button",{onClick:()=>Qe(s.id),className:"text-red-400 hover:text-red-300 p-1.5 hover:bg-red-900/20 rounded",children:e.jsx(Ye,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-gray-700 rounded-lg p-0.5",children:[e.jsx("button",{onClick:()=>Pe(s.id,s.quantity-1),className:"w-9 h-9 min-h-touch min-w-touch rounded hover:bg-gray-600 flex items-center justify-center",children:e.jsx(Ds,{className:"w-4 h-4 text-white"})}),e.jsx("span",{className:"w-10 text-center font-bold text-lg text-white",children:s.quantity}),e.jsx("button",{onClick:()=>Pe(s.id,s.quantity+1),className:"w-9 h-9 min-h-touch min-w-touch rounded hover:bg-gray-600 flex items-center justify-center",children:e.jsx(Fe,{className:"w-4 h-4 text-white"})})]}),e.jsx("span",{className:"font-bold text-xl text-orange-400",children:h(s.totalPrice*s.quantity)})]})]},s.id))}),e.jsxs("div",{className:"flex-shrink-0 border-t border-gray-700 p-3 space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(V,{type:"number",step:"0.01",value:$,onChange:s=>E(s.target.value),placeholder:"Desc. R$",className:"h-8 bg-gray-800 border-gray-700 text-white text-xs"}),e.jsx(V,{type:"number",step:"0.01",value:G,onChange:s=>K(s.target.value),placeholder:"Desc. %",className:"h-8 bg-gray-800 border-gray-700 text-white text-xs"})]}),Xe>0&&e.jsxs("div",{className:"flex items-center justify-between text-xs py-1 border-b border-gray-700",children:[e.jsx("span",{className:"text-gray-400",children:"Subtotal"}),e.jsx("span",{className:"font-semibold text-white",children:h(De)})]}),e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-orange-600 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-base font-bold text-white",children:"TOTAL"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:h(ne)})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(d,{onClick:Ns,disabled:l.length===0,variant:"outline",className:"h-9 border-gray-700 text-gray-300 hover:bg-gray-800 text-sm",children:"Limpar"}),e.jsx(d,{onClick:()=>{if(re){p.error("ðŸ”’ Caixa travado. FaÃ§a uma retirada em Caixa para continuar.");return}O(!0)},disabled:l.length===0,className:"h-9 bg-green-600 hover:bg-green-700 font-bold text-sm",children:"Finalizar"})]})]})]})]})}),M&&e.jsxs("div",{className:"hidden lg:flex flex-shrink-0 px-4 py-2 bg-gray-800 border-t border-gray-700 text-gray-400 text-xs justify-center gap-6 flex-wrap",children:[e.jsxs("span",{children:[e.jsx("kbd",{className:"px-1.5 py-0.5 bg-gray-700 rounded",children:"F2"})," Menu de Vendas"]}),e.jsxs("span",{children:[e.jsx("kbd",{className:"px-1.5 py-0.5 bg-gray-700 rounded",children:"F4"})," Fechamento"]}),e.jsxs("span",{children:[e.jsx("kbd",{className:"px-1.5 py-0.5 bg-gray-700 rounded",children:"F9"})," Cancelar venda"]}),e.jsxs("span",{children:[e.jsx("kbd",{className:"px-1.5 py-0.5 bg-gray-700 rounded",children:"F11"})," Recebimento"]})]}),M&&e.jsx("div",{className:"lg:hidden fixed bottom-0 left-0 right-0 p-4 pb-[max(1rem,env(safe-area-inset-bottom,0px))] bg-gray-900 border-t border-gray-700",children:e.jsxs(d,{onClick:()=>de(!0),className:"w-full min-h-[48px] h-14 bg-orange-500 hover:bg-orange-600 text-white font-bold text-lg",disabled:l.length===0,children:[e.jsx(We,{className:"w-5 h-5 mr-2"}),"Ver Comanda (",l.length,")",l.length>0&&e.jsxs("span",{className:"ml-2",children:["â€¢ ",h(ne)]})]})}),g&&e.jsxs("div",{className:"lg:hidden fixed inset-0 z-50 bg-gray-900 flex flex-col",children:[e.jsxs("div",{className:"flex-shrink-0 p-4 border-b border-gray-700 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Comanda"}),e.jsx("button",{onClick:()=>de(!1),className:"text-white min-h-touch min-w-touch flex items-center justify-center p-2 -m-1 hover:bg-gray-800 rounded","aria-label":"Fechar comanda",children:e.jsx(As,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:l.map(s=>e.jsxs("div",{className:"bg-gray-800 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-white text-sm",children:s.dish.name}),e.jsxs("p",{className:"text-xs text-gray-400",children:[h(s.totalPrice)," un."]})]}),e.jsx("button",{onClick:()=>Qe(s.id),className:"text-red-400 p-2 min-h-touch min-w-touch rounded hover:bg-red-900/20",children:e.jsx(Ye,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-gray-700 rounded-lg p-0.5",children:[e.jsx("button",{onClick:()=>Pe(s.id,s.quantity-1),className:"w-9 h-9 min-h-touch min-w-touch rounded flex items-center justify-center hover:bg-gray-600",children:e.jsx(Ds,{className:"w-4 h-4 text-white"})}),e.jsx("span",{className:"w-10 text-center font-bold text-white",children:s.quantity}),e.jsx("button",{onClick:()=>Pe(s.id,s.quantity+1),className:"w-9 h-9 min-h-touch min-w-touch rounded flex items-center justify-center hover:bg-gray-600",children:e.jsx(Fe,{className:"w-4 h-4 text-white"})})]}),e.jsx("span",{className:"font-bold text-lg text-orange-400",children:h(s.totalPrice*s.quantity)})]})]},s.id))}),e.jsxs("div",{className:"flex-shrink-0 p-4 pb-[max(1rem,env(safe-area-inset-bottom,0px))] border-t border-gray-700 space-y-3",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-orange-600 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-lg font-bold text-white",children:"TOTAL"}),e.jsx("span",{className:"text-3xl font-bold text-white",children:h(ne)})]})}),e.jsx(d,{onClick:()=>{if(!o){p.error("âš ï¸ Abra o caixa para iniciar as vendas"),de(!1),B(!0);return}if(re){p.error("ðŸ”’ Caixa travado. FaÃ§a uma retirada em Caixa para continuar.");return}if(l.length===0){p.error("Adicione itens Ã  comanda antes de finalizar");return}de(!1),O(!0)},disabled:l.length===0||!o||re,className:"w-full min-h-[48px] h-12 bg-green-600 hover:bg-green-700 font-bold disabled:opacity-50 disabled:cursor-not-allowed",children:"Finalizar Venda"})]})]}),e.jsx(ja,{isOpen:!!T,onClose:()=>le(null),dish:T,complementGroups:ds,onAddToCart:_e,primaryColor:W.theme_primary_color||"#f97316"}),as&&e.jsx(ba,{dish:as,sizes:ps,flavors:gs,edges:Hs,extras:Qs,categories:Xs,onAddToCart:_e,onClose:()=>Oe(null),primaryColor:W.theme_primary_color||"#f97316",store:W}),e.jsx(ya,{isOpen:Gs,onClose:Se,promotions:Ws,dishes:He,onAccept:na,onDecline:Se,primaryColor:W.theme_primary_color||"#f97316",darkMode:!0}),e.jsx(Ma,{isOpen:F,onClose:()=>O(!1),total:ne,formatCurrency:h,onConfirm:oa}),e.jsx(Va,{isOpen:J,onClose:()=>Y(!1),orderCode:v?.orderCode,total:v?.total,payments:v?.payments,change:v?.change,formatCurrency:h,onPrint:ca}),e.jsx(I,{open:Os,onOpenChange:ze,children:e.jsxs(R,{className:"max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx(H,{children:e.jsxs(Q,{className:"flex items-center gap-2 text-xl",children:[e.jsx(Ps,{className:"w-6 h-6 text-orange-500"}),"HistÃ³rico de Vendas PDV"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-3 py-4",children:!Re||Re.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(_s,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Nenhuma venda registrada ainda"})]}):(Re||[]).filter(s=>s).map(s=>{let a=null;try{const t=s.created_date||s.created_at;t&&typeof t=="string"&&t.trim()!==""&&(a=new Date(t),isNaN(a.getTime())&&(a=null))}catch(t){console.error("Erro ao processar data:",t),a=null}return e.jsx(ua,{className:"border-l-4 border-l-orange-500",children:e.jsxs(pa,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs(se,{className:"bg-orange-500",children:["#",s.order_code]}),a&&e.jsxs("span",{className:"text-sm text-gray-600",children:[e.jsx(za,{className:"w-4 h-4 inline mr-1"}),a.toLocaleString("pt-BR")]})]}),e.jsx("p",{className:"font-semibold text-lg",children:s.customer_name}),s.customer_phone&&e.jsxs("p",{className:"text-sm text-gray-600",children:["ðŸ“ž ",s.customer_phone]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:h(s.total)}),e.jsx(se,{variant:"outline",className:"mt-1",children:s.payment_method})]})]}),e.jsxs("div",{className:"space-y-1 border-t pt-2",children:[s.items?.map((t,x)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:[t.quantity,"x ",t.dish_name]}),e.jsx("span",{className:"font-medium",children:h(t.total_price)})]},x)),s.discount>0&&e.jsxs("div",{className:"flex justify-between text-sm text-red-600 pt-1 border-t",children:[e.jsx("span",{children:"Desconto"}),e.jsxs("span",{children:["-",h(s.discount)]})]}),s.change>0&&e.jsxs("div",{className:"flex justify-between text-sm text-blue-600",children:[e.jsx("span",{children:"Troco"}),e.jsx("span",{children:h(s.change)})]})]})]})},s.id)})}),e.jsx(ae,{children:e.jsx(d,{variant:"outline",onClick:()=>ze(!1),children:"Fechar"})})]})}),e.jsx(I,{open:zs,onOpenChange:s=>{if(!s&&!o){p.error("ðŸš« Ã‰ OBRIGATÃ“RIO abrir o caixa para usar o PDV!");return}B(s)},children:e.jsxs(R,{className:"sm:max-w-md",onInteractOutside:s=>{o||s.preventDefault()},onEscapeKeyDown:s=>{o||s.preventDefault()},children:[e.jsx(H,{children:e.jsx(Q,{className:"text-xl font-bold text-red-600",children:o?"ðŸ”“ Abrir Novo Caixa":"ðŸ”’ CAIXA FECHADO - PDV BLOQUEADO"})}),e.jsxs("div",{className:"space-y-6 py-4",children:[!o&&e.jsxs("div",{className:"bg-red-50 border-2 border-red-500 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-red-800 font-bold mb-2",children:"âš ï¸ O PDV estÃ¡ bloqueado!"}),e.jsx("p",{className:"text-xs text-red-700",children:"Para realizar vendas no PDV, vocÃª DEVE abrir um caixa primeiro. Esta Ã© uma operaÃ§Ã£o obrigatÃ³ria para controle financeiro."})]}),o&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-blue-800 font-medium",children:"ðŸ’¡ JÃ¡ existe um caixa aberto. Deseja abrir um novo?"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(q,{className:"text-base font-semibold",children:"Valor de Abertura em Dinheiro (R$) *"}),e.jsx(V,{type:"number",step:"0.01",min:"0",value:ge,onChange:s=>es(s.target.value),placeholder:"0,00",className:"text-2xl font-bold h-16 text-center border-2",autoFocus:!0}),e.jsx("p",{className:"text-xs text-gray-600",children:"Valor em dinheiro fÃ­sico disponÃ­vel no caixa ao abrir"})]}),e.jsxs("div",{className:"space-y-3 p-3 rounded-lg border border-amber-200 bg-amber-50/50",children:[e.jsx(q,{className:"text-base font-semibold",children:"Valor limite de travamento (R$) â€“ opcional"}),e.jsx(V,{type:"number",step:"0.01",min:"0",value:fe,onChange:s=>ss(s.target.value),placeholder:"Ex: 500",className:"h-12 border-2 bg-white"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Quando as vendas em dinheiro atingirem este valor, o PDV trava atÃ© ser feita uma retirada em Caixa"})]}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsx("p",{className:"text-xs text-green-800 font-medium",children:"âœ… ApÃ³s abrir o caixa, vocÃª poderÃ¡ realizar vendas normalmente"})})]}),e.jsxs(ae,{className:"gap-2 sm:gap-0 flex-col sm:flex-row",children:[o?e.jsx(d,{variant:"outline",onClick:()=>B(!1),className:"w-full sm:w-auto",children:"Cancelar"}):e.jsx(Cs,{to:os,className:"w-full sm:w-auto",children:e.jsxs(d,{variant:"outline",className:"w-full",children:[e.jsx(Ss,{className:"w-4 h-4 mr-2"}),"Voltar"]})}),e.jsx(d,{onClick:()=>be("abrir_caixa",()=>la()),disabled:!ge||parseFloat(ge)<0||Be.isPending,className:"bg-green-600 hover:bg-green-700 font-semibold w-full sm:w-auto",children:Be.isPending?"Abrindo Caixa...":"âœ… Confirmar Abertura"})]})]})})]})}export{At as default};
