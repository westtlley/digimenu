import{c as Be,p as fe,r as o,u as Le,P as be,z as F,j as e,X as me,B as _,R as Et,L as qt,q as Je,a as $s,d as qe,f as Bt,e as jt,F as Ts,S as zs}from"./main-BRmc9wuQ.js";import{b as Q}from"./base44Client-DNwoQjfp.js";import{u as ke}from"./useQuery-DECqmSjD.js";import{I as ue,L as X}from"./input-BSSWZZVM.js";import{e as Is,C as Fs,P as Ls,t as ze,D as qs,a as Bs,b as Ks,c as ct}from"./index-BKuSiZNQ.js";import{B as ae}from"./badge-0XfQUglg.js";import{S as Ee,a as Me,b as De,c as Pe,d as de,e as ls}from"./select-VIQuVK7X.js";import{u as Ne}from"./useMutation-7mrcm5kq.js";import{C as zt}from"./chef-hat-BVOq19yV.js";import{C as ge}from"./circle-check-big-BgD3Vilh.js";import{T as Ae}from"./truck-BEX3wnhD.js";import{S as os}from"./search-BzcCetuR.js";import{F as cs}from"./filter-B-ySBKey.js";import{M as Vs,a as Hs,d as dt,T as Us}from"./differenceInMinutes-CxwK6Gwe.js";import{C as Qs,u as Gs,a as Ys}from"./index-Deio2Puc.js";import{A as Js}from"./index-POiUmsPA.js";import{m as Se}from"./proxy-UArsdzLI.js";import{B as it}from"./bell-B_jl57AB.js";import{C as Re}from"./clock-BVnf5BSk.js";import{S as gt,u as Ws,H as Kt,L as vt}from"./useDocumentHead-DTnInFCs.js";import{D as ye,a as je,c as ve,d as Vt,b as Ye,e as It}from"./dialog-DJhUD2H1.js";import{T as Qe}from"./textarea-BVLzEUED.js";import{a as Nt,b as Ht,C as Xs}from"./dateUtils-BbzTuuJw.js";import{p as Ut,g as Qt,R as Gt,B as Zs,X as ea,Y as ta,T as Yt,a as sa,P as aa,b as ra,C as na,L as ia,c as la,d as oa,e as wt,F as ca,f as da}from"./FinancialDashboard-CbElDF5E.js";import{C as at}from"./check-B8wFGgpR.js";import{C as ma}from"./circle-alert-BZWE3mVm.js";import{f as Mt,B as st}from"./format-_TcWQ5qq.js";import{C as Dt}from"./circle-x-BoXIGvxl.js";import{P as rt,u as xa}from"./useManagerialAuth-BHrKp2KS.js";import{M as lt}from"./message-square-D4l20RJ6.js";import{M as Ie}from"./map-pin-C1grN2RK.js";import{Z as pt}from"./zap-Cci-1Hlx.js";import{S as Fe}from"./star-gxnzHQI6.js";import{N as _t}from"./navigation-DF2HYaFW.js";import{T as ds}from"./trending-up-DfwTY8KU.js";import{A as ms}from"./award-SiU4ov57.js";import{C as xt}from"./calendar-C_CZG2Mr.js";import{P as Pt}from"./plus-DSv6Z-VR.js";import{P as xs}from"./phone-BNGqqYl8.js";import{M as ua}from"./mail-BNh_3Nbk.js";import{S as ha}from"./differenceInCalendarDays-m29H_lYP.js";import{S as Oe}from"./switch-gnnivmk-.js";import{u as ga,c as pa,a as Ue,P as ot}from"./index-Us3IJkK4.js";import{c as fa,u as ba}from"./index-Clzu_iyV.js";import{V as us}from"./volume-2-CZ76rO0d.js";import{P as ya}from"./play-BshYjaFQ.js";import{S as ja}from"./store-DD9u3xYC.js";import{U as hs}from"./user-DROTyYEO.js";import{S as ut}from"./save-CsDfwi79.js";import{T as va}from"./trash-2-BCVOf2oN.js";import{L as Na}from"./log-out-CDSnoSZk.js";import{P as Ct}from"./progress-D7YE5rXl.js";import{D as nt}from"./dollar-sign-Cy_CReDz.js";import{P as wa,a as _a,b as Ca}from"./popover-dlYatlIR.js";import{C as Sa}from"./credit-card-BeVXrvzu.js";import{U as ka}from"./UserAuthButton-aEHoGetV.js";import{u as Ea}from"./usePermission-iPsVutLm.js";import{u as Ma}from"./useSlugContext-C_H0E5cf.js";import{u as Da,I as Pa}from"./InstallAppButton-D28BW715.js";import{H as Oa}from"./headphones-B_rxkwyS.js";import{M as Aa}from"./message-circle-BosG9deC.js";import{C as Jt}from"./circle-help-wMU4n52T.js";import{D as Ra}from"./download-BLDsYadX.js";import{M as Wt}from"./menu-C4YDxp4T.js";import{C as $a}from"./chevron-left-dEb2H1jL.js";import{S as Xt}from"./settings-DlQQnpge.js";import"./index-DtU2aqBA.js";import"./index-Cj8IEuVO.js";import"./index-Crj2I8cN.js";import"./chevron-right-nMC1nZWH.js";import"./chevron-down-Br9th1QV.js";import"./constants-CG7Neo-X.js";import"./formatters-CvOEClq0.js";import"./card-Ctp-7rs8.js";import"./shopping-bag-BPXgUy-7.js";import"./alert-dialog-WT2FZKvg.js";import"./log-in-V4EDTWPP.js";import"./power-CSJOf1Dk.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ta=[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]],za=Be("ChartNoAxesColumn",Ta);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ia=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],Fa=Be("CheckCheck",Ia);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const La=[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]],qa=Be("Keyboard",La);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ba=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],Zt=Be("Lightbulb",Ba);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ka=[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]],Va=Be("List",Ka);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ha=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],Ua=Be("Map",Ha);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qa=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],Ga=Be("VolumeX",Qa),gs=fe.createContext({}),ps=!0;function Ya({baseColor:t,highlightColor:a,width:s,height:n,borderRadius:c,circle:l,direction:d,duration:m,enableAnimation:u=ps,customHighlightBackground:E}){const N={};return d==="rtl"&&(N["--animation-direction"]="reverse"),typeof m=="number"&&(N["--animation-duration"]=`${m}s`),u||(N["--pseudo-element-display"]="none"),(typeof s=="string"||typeof s=="number")&&(N.width=s),(typeof n=="string"||typeof n=="number")&&(N.height=n),(typeof c=="string"||typeof c=="number")&&(N.borderRadius=c),l&&(N.borderRadius="50%"),typeof t<"u"&&(N["--base-color"]=t),typeof a<"u"&&(N["--highlight-color"]=a),typeof E=="string"&&(N["--custom-highlight-background"]=E),N}function et({count:t=1,wrapper:a,className:s,containerClassName:n,containerTestId:c,circle:l=!1,style:d,...m}){var u,E,N;const r=fe.useContext(gs),C={...m};for(const[w,I]of Object.entries(m))typeof I>"u"&&delete C[w];const R={...r,...C,circle:l},$={...d,...Ya(R)};let T="react-loading-skeleton";s&&(T+=` ${s}`);const j=(u=R.inline)!==null&&u!==void 0?u:!1,P=[],f=Math.ceil(t);for(let w=0;w<f;w++){let I=$;if(f>t&&w===f-1){const A=(E=I.width)!==null&&E!==void 0?E:"100%",v=t%1,D=typeof A=="number"?A*v:`calc(${A} * ${v})`;I={...I,width:D}}const i=fe.createElement("span",{className:T,style:I,key:w},"‚Äå");j?P.push(i):P.push(fe.createElement(fe.Fragment,{key:w},i,fe.createElement("br",null)))}return fe.createElement("span",{className:n,"data-testid":c,"aria-live":"polite","aria-busy":(N=R.enableAnimation)!==null&&N!==void 0?N:ps},a?P.map((w,I)=>fe.createElement(a,{key:I},w)):P)}function es({children:t,...a}){return fe.createElement(gs.Provider,{value:a},t)}const St=[{id:"new",label:"Em preparo",icon:zt,bgColor:"bg-orange-50",textColor:"text-orange-600",borderColor:"border-orange-200",statuses:["new","accepted","preparing"],darkBg:"bg-orange-900/20",darkBorder:"border-orange-700"},{id:"ready",label:"Pronto",icon:ge,bgColor:"bg-green-50",textColor:"text-green-600",borderColor:"border-green-200",statuses:["ready","going_to_store","arrived_at_store","picked_up"],darkBg:"bg-green-900/20",darkBorder:"border-green-700"},{id:"delivery",label:"Em rota",icon:Ae,bgColor:"bg-blue-50",textColor:"text-blue-600",borderColor:"border-blue-200",statuses:["out_for_delivery","arrived_at_customer"],darkBg:"bg-blue-900/20",darkBorder:"border-blue-700"},{id:"done",label:"Finalizados",icon:be,bgColor:"bg-gray-50",textColor:"text-gray-600",borderColor:"border-gray-200",statuses:["delivered","cancelled"],darkBg:"bg-gray-900/20",darkBorder:"border-gray-700"}];function Ja({orders:t,onSelectOrder:a,darkMode:s=!1,isLoading:n=!1}){const c=Array.isArray(t)?t:[],[l,d]=o.useState({}),[m,u]=o.useState(""),[E,N]=o.useState("all"),[r,C]=o.useState("all"),[R,$]=o.useState(!1),[T,j]=o.useState(!1),[P,f]=o.useState(()=>Date.now()),[w,I]=o.useState(!1),i=Le();o.useEffect(()=>{const b=window.matchMedia("(prefers-reduced-motion: reduce)");I(b.matches);const z=()=>I(b.matches);return b.addEventListener("change",z),()=>b.removeEventListener("change",z)},[]),fe.useEffect(()=>{const b=setInterval(()=>f(Date.now()),6e4);return()=>clearInterval(b)},[]);const A=Ne({mutationFn:async({orderId:b,newStatus:z})=>{const V=c.find(G=>String(G.id)===String(b));if(!V)throw new Error("Pedido n√£o encontrado");const U={...V,status:z};return z==="ready"&&(U.ready_at=new Date().toISOString(),V.pickup_code||(U.pickup_code=Math.floor(1e3+Math.random()*9e3).toString()),!V.delivery_code&&V.delivery_method==="delivery"&&(U.delivery_code=Math.floor(1e3+Math.random()*9e3).toString())),z==="delivered"&&(U.delivered_at=new Date().toISOString()),await Q.entities.Order.update(b,U),{orderId:b,newStatus:z}},onSuccess:()=>{i.invalidateQueries({queryKey:["gestorOrders"]}),F.success("Status atualizado!")},onError:b=>{F.error(b.message||"Erro ao atualizar pedido")}}),v=b=>{let z=c.filter(V=>b.includes(V.status));return m&&(z=z.filter(V=>V.order_code?.toLowerCase().includes(m.toLowerCase())||V.customer_name?.toLowerCase().includes(m.toLowerCase())||V.customer_phone?.includes(m))),r!=="all"&&(z=z.filter(V=>V.delivery_method===r)),z=[...z].sort((V,U)=>{const G=new Date(V.created_at||V.created_date||0).getTime(),h=new Date(U.created_at||U.created_date||0).getTime();return G-h}),z},D=b=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(b||0),S=b=>{if(!b)return"";const z=dt(new Date(P),new Date(b));return z<1?"Agora":z<60?`H√° ${z} min`:`H√° ${Math.floor(z/60)}h ${z%60}min`},p=b=>b?.created_at||b?.created_date,M=b=>{const z=p(b);return z?dt(new Date(P),new Date(z))>30&&!["delivered","cancelled"].includes(b.status):!1},q=b=>{const z=p(b);return z?dt(new Date(P),new Date(z))>45&&!["delivered","cancelled"].includes(b.status):!1},H=b=>b.accepted_at?dt(new Date(P),new Date(b.accepted_at)):null,re=b=>{const z=H(b),V=b.prep_time||30;return z!=null&&z>=V-5&&z<V&&!["delivered","cancelled"].includes(b.status)},ee=b=>{const z=H(b),V=b.prep_time||30;return z!=null&&z>=V&&!["delivered","cancelled"].includes(b.status)},ne=b=>{d(z=>({...z,[b]:!z[b]}))},ie=o.useCallback(b=>{const{destination:z,source:V,draggableId:U}=b;if(!z||z.droppableId===V.droppableId&&z.index===V.index)return;const G=St.find(J=>J.id===z.droppableId);if(!G)return;const h=c.find(J=>String(J.id)===String(U));if(!h)return;let g;if(G.id==="new")g=["new","accepted","preparing"].includes(h.status)?h.status:"preparing";else if(G.id==="ready")g="ready";else if(G.id==="delivery")if(h.status==="ready"||h.status==="picked_up")g="out_for_delivery";else{F.error("Pedido precisa estar pronto antes de ir para entrega");return}else if(G.id==="done")if(["out_for_delivery","arrived_at_customer"].includes(h.status))g="delivered";else{F.error("Pedido precisa estar em entrega para ser finalizado");return}else return;const Y=i.getQueryData(["gestorOrders"])||[];i.setQueryData(["gestorOrders"],Y.map(J=>String(J.id)===String(U)?{...J,status:g}:J)),A.mutate({orderId:U,newStatus:g},{onError:()=>{i.setQueryData(["gestorOrders"],Y)}})},[A,t,i]);return n&&c.length===0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:`${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"} border rounded-lg p-4`,children:e.jsxs(es,{baseColor:"#ebebeb",highlightColor:"#f5f5f5",children:[e.jsx(et,{height:40,className:"mb-3",enableAnimation:!w}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(et,{width:140,height:36,enableAnimation:!w}),e.jsx(et,{width:80,height:36,enableAnimation:!w})]})]})}),e.jsx("div",{className:"flex gap-2.5 h-[calc(100vh-280px)]",children:St.map(b=>e.jsx("div",{className:`flex-1 flex flex-col ${s?"bg-gray-800/50 border-gray-700":"bg-gray-50 border-gray-200"} border rounded-lg p-2`,children:e.jsxs(es,{baseColor:"#ebebeb",highlightColor:"#f5f5f5",children:[e.jsx(et,{height:36,className:"mb-2",enableAnimation:!w}),e.jsx(et,{count:3,height:100,style:{marginBottom:8},enableAnimation:!w})]})},b.id))})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:`${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"} border rounded-lg p-4`,children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(os,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(ue,{placeholder:"Buscar por c√≥digo, nome ou telefone...",value:m,onChange:b=>u(b.target.value),className:`pl-10 ${s?"bg-gray-700 border-gray-600 text-white":""}`}),m&&e.jsx("button",{onClick:()=>u(""),className:"absolute right-3 top-1/2 -translate-y-1/2",children:e.jsx(me,{className:"w-4 h-4 text-gray-400"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Ee,{value:r,onValueChange:C,children:[e.jsx(Me,{className:`w-[140px] ${s?"bg-gray-700 border-gray-600":""}`,children:e.jsx(De,{placeholder:"Tipo"})}),e.jsxs(Pe,{children:[e.jsx(de,{value:"all",children:"Todos"}),e.jsx(de,{value:"delivery",children:"Entrega"}),e.jsx(de,{value:"pickup",children:"Retirada"})]})]}),e.jsxs(_,{variant:"outline",onClick:()=>$(!R),className:s?"border-gray-600":"",children:[e.jsx(cs,{className:"w-4 h-4 mr-2"}),"Filtros"]}),e.jsx(_,{variant:"outline",size:"sm",onClick:()=>j(b=>!b),className:"h-9",title:T?"Expandir":"Compacto",children:T?e.jsx(Vs,{className:"w-4 h-4"}):e.jsx(Hs,{className:"w-4 h-4"})})]})]})}),e.jsx(Is,{onDragEnd:ie,children:e.jsx("div",{className:"flex gap-2.5 h-[calc(100vh-280px)]",children:St.map(b=>{const z=v(b.statuses),V=b.icon,U=l[b.id];return e.jsxs("div",{className:`${U?"w-10":"flex-1"} transition-all duration-300 flex flex-col ${s?`${b.darkBg} ${b.darkBorder} border`:`${b.bgColor} ${b.borderColor} border`} rounded-lg`,children:[e.jsx("button",{onClick:()=>ne(b.id),className:`border-b p-2.5 flex items-center justify-between hover:opacity-80 transition-opacity ${s?"border-gray-700":"border-gray-200"}`,children:U?e.jsxs("div",{className:"flex flex-col items-center gap-1.5 w-full",children:[e.jsx(V,{className:`w-4 h-4 ${b.textColor}`}),e.jsx("span",{className:`text-[10px] font-bold ${s?"text-gray-300":"text-gray-500"}`,children:z.length})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:`w-4 h-4 ${b.textColor}`}),e.jsxs("div",{className:"text-left",children:[e.jsxs("p",{className:`font-semibold text-xs ${s?"text-white":"text-gray-700"}`,children:[b.label,b.id==="new"&&z.some(G=>G.status==="new")&&e.jsxs("span",{className:`ml-1 font-medium ${b.textColor}`,children:["¬∑ ",z.filter(G=>G.status==="new").length," novo(s)"]})]}),e.jsxs("p",{className:"text-[10px] text-gray-400",children:[z.length," pedidos"]})]})]}),e.jsx(Qs,{className:"w-3.5 h-3.5 text-gray-400"})]})}),!U&&e.jsx(Fs,{droppableId:b.id,children:(G,h)=>e.jsxs("div",{ref:G.innerRef,...G.droppableProps,className:`flex-1 overflow-y-auto p-1.5 space-y-1.5 transition-colors ${h.isDraggingOver?s?"bg-gray-700/50":"bg-gray-100/50":""}`,children:[e.jsx(Js,{children:z.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center px-3",children:[e.jsx(V,{className:`w-8 h-8 ${b.textColor} opacity-15 mb-1.5`}),e.jsx("p",{className:`text-[10px] ${s?"text-gray-500":"text-gray-400"} leading-relaxed`,children:b.id==="new"?"Nenhum pedido em preparo":b.id==="ready"?"Nenhum pedido pronto":b.id==="delivery"?"Nenhuma entrega em rota":"Nenhum pedido finalizado"})]}):z.map((g,Y)=>e.jsx(Ls,{draggableId:g.id,index:Y,children:(J,te)=>e.jsxs(Se.div,{ref:J.innerRef,...J.draggableProps,...J.dragHandleProps,initial:{opacity:0,scale:.98},animate:{opacity:te.isDragging?.8:1,scale:te.isDragging?1.05:1},exit:{opacity:0,scale:.98},whileHover:{y:-2},onClick:()=>a(g),className:`${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"} rounded-md hover:shadow-md transition-all cursor-pointer border-l-2 ${T?"p-1.5":"p-2.5"} ${q(g)||ee(g)?"border-red-600 bg-red-100/50 dark:bg-red-900/30 ring-1 ring-red-300":M(g)?"border-red-500 bg-red-50/30 dark:bg-red-900/20":re(g)?"border-amber-500 bg-amber-50/50 dark:bg-amber-900/20":g.priority==="alta"?"border-orange-400 dark:border-orange-500":s?"border-gray-600":"border-gray-200"} ${te.isDragging?"shadow-xl":""}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-1.5",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:`font-semibold text-[11px] ${s?"text-white":"text-gray-900"}`,children:["#",g.order_code||g.id?.slice(-6)]}),(M(g)||ee(g))&&e.jsxs(ae,{className:"bg-red-500 text-white text-[8px] h-3.5 mt-0.5 px-1 flex items-center gap-0.5 w-fit",children:[q(g)&&e.jsx(it,{className:"w-2.5 h-2.5"}),"Atrasado"]}),re(g)&&!ee(g)&&e.jsx(ae,{className:"bg-amber-500 text-white text-[8px] h-3.5 mt-0.5 px-1 flex items-center w-fit",children:"Quase no limite"})]}),e.jsx("span",{className:"text-[11px] flex-shrink-0",title:g.delivery_method==="delivery"?"Entrega":"Retirada",children:g.delivery_method==="delivery"?"üö¥":"üè™"})]}),e.jsx("p",{className:`text-[11px] font-medium ${s?"text-gray-200":"text-gray-700"} mb-1 truncate`,children:g.customer_name}),e.jsxs("p",{className:`text-[10px] ${s?"text-gray-400":"text-gray-500"} mb-1.5 truncate`,children:[(g.items||[]).slice(0,3).map((pe,oe)=>`${pe.quantity}x ${pe.dish?.name||"Item"}`).join(", "),(g.items||[]).length>3&&` +${(g.items||[]).length-3}`]}),e.jsxs("div",{className:`flex items-center justify-between pt-1.5 border-t ${s?"border-gray-700":"border-gray-100"}`,children:[e.jsx("span",{className:`font-bold text-[11px] ${s?"text-green-400":"text-green-600"}`,children:D(g.total)}),e.jsxs("span",{className:`text-[9px] ${s?"text-gray-500":"text-gray-400"} flex items-center gap-0.5`,children:[e.jsx(Re,{className:"w-2.5 h-2.5"}),S(g.created_at||g.created_date)]})]})]})},g.id))}),G.placeholder]})})]},b.id)})})})]})}function Wa({order:t,entregador:a,onClose:s}){const[n,c]=o.useState(""),l=Le(),{data:d=[]}=ke({queryKey:["orderMessages",t.id],queryFn:()=>Q.entities.DeliveryMessage.filter({order_id:t.id},"-created_date",50),refetchInterval:3e3}),m=Ne({mutationFn:C=>Q.entities.DeliveryMessage.create(C),onSuccess:()=>{l.invalidateQueries({queryKey:["orderMessages",t.id]}),c(""),F.success("Mensagem enviada!")}}),u=["Pedido urgente - priorizar","Cliente aguardando contato","Confirme sua localiza√ß√£o","Retorne √† loja"],E=C=>{m.mutate({entregador_id:t.entregador_id,order_id:t.id,title:"Mensagem do Gestor",message:C,priority:"urgent",type:"order_update"})},N=()=>{n.trim()&&m.mutate({entregador_id:t.entregador_id,order_id:t.id,title:"Mensagem do Gestor",message:n,priority:"normal",type:"order_update"})},r=C=>{const R=new Date,$=new Date(C),T=R-$,j=Math.floor(T/6e4);if(j<1)return"Agora";if(j<60)return`${j}m`;const P=Math.floor(j/60);return P<24?`${P}h`:`${Math.floor(P/24)}d`};return e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs(Se.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden flex flex-col max-h-[80vh]",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-blue-500 text-white p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:"Chat com Entregador"}),e.jsx("p",{className:"text-sm opacity-90",children:a?.name||"Entregador"})]}),e.jsx("button",{onClick:s,className:"text-white hover:bg-white/20 p-2 rounded-lg",children:e.jsx(me,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"bg-white/20 backdrop-blur-sm rounded-lg p-2",children:e.jsxs("p",{className:"text-xs font-semibold",children:["Pedido #",t.order_code]})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50",children:d.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-sm text-gray-500",children:"Nenhuma mensagem ainda"})}):d.map(C=>e.jsxs(Se.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`p-3 rounded-xl ${C.status==="pending"?"bg-blue-50 border-2 border-blue-200":"bg-white border border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[C.priority==="urgent"&&e.jsx(ae,{className:"bg-red-500 text-white text-[10px]",children:"üî• Urgente"}),C.status==="pending"&&e.jsx(ae,{className:"bg-green-500 text-white text-[10px]",children:"‚ú® Nova"}),C.status==="read"&&e.jsx(Fa,{className:"w-4 h-4 text-blue-500"})]}),e.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(Re,{className:"w-3 h-3"}),r(C.created_date)]})]}),C.title&&e.jsx("p",{className:"font-bold text-sm mb-1",children:C.title}),e.jsx("p",{className:"text-sm text-gray-700",children:C.message})]},C.id))}),e.jsxs("div",{className:"p-4 bg-white border-t",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 mb-2",children:"RESPOSTAS R√ÅPIDAS:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:u.map((C,R)=>e.jsx("button",{onClick:()=>E(C),disabled:m.isPending,className:"text-xs p-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 border border-gray-300 transition-colors text-left disabled:opacity-50",children:C},R))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 mb-2",children:"MENSAGEM PERSONALIZADA:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:n,onChange:C=>c(C.target.value),onKeyPress:C=>C.key==="Enter"&&N(),placeholder:"Digite sua mensagem...",disabled:m.isPending,className:"flex-1 px-3 py-2 rounded-lg text-sm bg-gray-50 border-2 border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50"}),e.jsx(_,{onClick:N,disabled:!n.trim()||m.isPending,className:"bg-blue-600 hover:bg-blue-700 px-4",children:e.jsx(gt,{className:"w-4 h-4"})})]})]})]})]})})}function Xa({order:t,logs:a=[]}){const s=[{key:"created",label:"Pedido Recebido",icon:be,date:t.created_date,color:"blue",status:"completed"},{key:"accepted",label:"Pedido Aceito",icon:at,date:t.accepted_at,color:"green",status:t.accepted_at?"completed":t.status==="cancelled"?"skipped":"pending"},{key:"preparing",label:"Em Preparo",icon:zt,date:t.status==="preparing"?new Date().toISOString():null,color:"yellow",status:["preparing","ready","out_for_delivery","delivered"].includes(t.status)?"completed":t.status==="cancelled"?"skipped":"pending"},{key:"ready",label:"Pedido Pronto",icon:Re,date:t.ready_at,color:"green",status:t.ready_at?"completed":t.status==="cancelled"?"skipped":"pending"}];t.delivery_method==="delivery"&&s.push({key:"out_for_delivery",label:"Saiu para Entrega",icon:Ae,date:t.status==="out_for_delivery"?new Date().toISOString():null,color:"blue",status:["out_for_delivery","delivered"].includes(t.status)?"completed":t.status==="cancelled"?"skipped":"pending"}),s.push({key:"delivered",label:t.delivery_method==="delivery"?"Entregue":"Retirado",icon:at,date:t.delivered_at,color:"green",status:t.status==="delivered"?"completed":t.status==="cancelled"?"skipped":"pending"}),t.status==="cancelled"&&s.push({key:"cancelled",label:"Pedido Cancelado",icon:ma,date:t.updated_date,color:"red",status:"completed",description:t.rejection_reason});const n={completed:"bg-green-500 border-green-500",pending:"bg-gray-200 border-gray-300",skipped:"bg-gray-100 border-gray-200"},c={completed:"text-white",pending:"text-gray-400",skipped:"text-gray-300"};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Hist√≥rico do Pedido"}),e.jsx("div",{className:"space-y-3",children:s.map((l,d)=>{const m=l.icon,u=d===s.length-1;return e.jsxs("div",{className:"relative flex gap-3",children:[!u&&e.jsx("div",{className:`absolute left-4 top-10 bottom-0 w-0.5 ${l.status==="completed"?"bg-green-500":"bg-gray-200"}`}),e.jsx("div",{className:`relative z-10 w-8 h-8 rounded-full border-2 flex items-center justify-center flex-shrink-0 ${n[l.status]}`,children:e.jsx(m,{className:`w-4 h-4 ${c[l.status]}`})}),e.jsx("div",{className:"flex-1 pb-4",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:`font-medium text-sm ${l.status==="completed"?"text-gray-900":"text-gray-500"}`,children:l.label}),l.date&&e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:Mt(new Date(l.date),"dd/MM/yyyy '√†s' HH:mm",{locale:Ut})}),l.description&&e.jsx("p",{className:"text-xs text-red-600 mt-1 bg-red-50 px-2 py-1 rounded",children:l.description})]})})})]},l.key)})}),a.length>0&&e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsx("h4",{className:"font-semibold text-xs text-gray-600 mb-2",children:"Atividades Recentes"}),e.jsx("div",{className:"space-y-2",children:a.slice(0,5).map((l,d)=>e.jsxs("div",{className:"text-xs text-gray-500 flex items-start gap-2",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-gray-400 mt-1.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{children:l.action}),e.jsxs("p",{className:"text-gray-400",children:[Mt(new Date(l.created_date),"dd/MM/yyyy HH:mm",{locale:Ut}),l.user_email&&` - ${l.user_email}`]})]})]},d))})]})]})}const Za={pix:"PIX",dinheiro:"Dinheiro",cartao_credito:"Cart√£o de Cr√©dito",cartao_debito:"Cart√£o de D√©bito"},er=["Loja fechada","Produto indispon√≠vel","Problema no endere√ßo","√Årea fora de cobertura","Pedido duplicado","Outro motivo"];function tr({order:t,entregadores:a,onClose:s,onUpdate:n,user:c,asSub:l,suggestedPrepTime:d=30,quickStatusKey:m,onClearQuickStatus:u,onViewMap:E,onDuplicate:N,onAddToPrintQueue:r}){const[C,R]=o.useState(!1),[$,T]=o.useState(!1),[j,P]=o.useState(!1),[f,w]=o.useState(""),[I,i]=o.useState(""),[A,v]=o.useState(""),[D,S]=o.useState(!1),[p,M]=o.useState(""),[q,H]=o.useState(t.prep_time||d||30),[re,ee]=o.useState(!1),[ne,ie]=o.useState(!1),[Z,b]=o.useState(t.internal_notes||""),[z,V]=o.useState(t.priority||"normal"),U=(()=>{try{return JSON.parse(localStorage.getItem("gestorSettings")||"{}").can_alter_prep_per_order!==!1}catch{return!0}})(),G=Le();fe.useEffect(()=>{if(!m||g.isPending)return;(()=>{if(m==="accepted"&&t.status==="new"){const L=U?q:d||30;g.mutate({id:t.id,updates:{status:"accepted",accepted_at:new Date().toISOString(),prep_time:L}},{onSuccess:()=>u?.()});return}if(m==="ready"&&["accepted","preparing"].includes(t.status)){const L={status:"ready",ready_at:new Date().toISOString()};t.pickup_code||(L.pickup_code=Math.floor(1e3+Math.random()*9e3).toString()),!t.delivery_code&&t.delivery_method==="delivery"&&(L.delivery_code=Math.floor(1e3+Math.random()*9e3).toString()),g.mutate({id:t.id,updates:L},{onSuccess:()=>u?.()});return}if(m==="out_for_delivery"&&["ready","picked_up"].includes(t.status)){g.mutate({id:t.id,updates:{status:"out_for_delivery"}},{onSuccess:()=>u?.()});return}if(m==="delivered"&&["ready","out_for_delivery","arrived_at_customer"].includes(t.status)){g.mutate({id:t.id,updates:{status:"delivered",delivered_at:new Date().toISOString()}},{onSuccess:()=>u?.()});return}u?.()})()},[m]);const{data:h=[]}=ke({queryKey:["orderLogs",t.id],queryFn:()=>Q.entities.OrderLog.filter({order_id:t.id},"-created_date"),enabled:!!t.id}),g=Ne({mutationFn:async({id:x,updates:L})=>{if(L.status==="accepted"&&t.status!=="new")throw new Error("Apenas pedidos novos podem ser aceitos");if(L.status==="cancelled"&&!["new","accepted"].includes(t.status))throw new Error("Pedidos em andamento n√£o podem ser cancelados");if(L.status==="accepted"&&(!L.prep_time||L.prep_time<5))throw new Error("Tempo de preparo deve ser no m√≠nimo 5 minutos");L.status==="ready"&&(t.pickup_code||(L.pickup_code=Math.floor(1e3+Math.random()*9e3).toString()),!t.delivery_code&&t.delivery_method==="delivery"&&(L.delivery_code=Math.floor(1e3+Math.random()*9e3).toString()));const B={...t,...L},y=l?{as_subscriber:l}:{},K=await Q.entities.Order.update(x,B,y);try{await Q.entities.OrderLog.create({order_id:x,action:`Status alterado para ${L.status}`,old_status:t.status,new_status:L.status,user_email:c?.email,details:L.rejection_reason||null,...l&&{as_subscriber:l}})}catch(he){console.log("Log error:",he)}return{status:L.status,order:K||B}},onSuccess:x=>{const L=x?.status;G.invalidateQueries({queryKey:["gestorOrders"]}),G.invalidateQueries({queryKey:["orderLogs",t.id]});const B=new Audio("https://assets.mixkit.co/active_storage/sfx/2018/2018-preview.mp3");B.volume=.5,B.play().catch(()=>{});const y={accepted:"‚úÖ Pedido aceito!",preparing:"üë®‚Äçüç≥ Em preparo!",ready:"‚úÖ Pronto!",out_for_delivery:"üöö Saiu para entrega!",delivered:"‚úÖ Entregue!",cancelled:"‚ùå Cancelado"};y[L]&&F.success(y[L]),n(x?.order)},onError:x=>{console.error("Update error:",x);const L=x.message||"Erro ao atualizar pedido. Tente novamente.";F.error(L)}}),Y=x=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(x||0),J=async()=>{if(g.isPending)return;const x=U?q:d||30;if(!x||x<5||x>180){F.error("Tempo de preparo deve ser entre 5 e 180 minutos");return}if(t.status!=="new"){F.error("Este pedido j√° foi processado");return}g.mutate({id:t.id,updates:{status:"accepted",accepted_at:new Date().toISOString(),prep_time:x}})},te=()=>{const L={accepted:"preparing",preparing:"ready",ready:t.delivery_method==="delivery"?"ready":"delivered",out_for_delivery:"delivered"}[t.status];if(!L)return;const B={status:L};L==="ready"&&(B.ready_at=new Date().toISOString()),L==="delivered"&&(B.delivered_at=new Date().toISOString()),g.mutate({id:t.id,updates:B})},pe=async()=>{if(g.isPending)return;if(!["new","accepted"].includes(t.status)){F.error("Este pedido n√£o pode mais ser cancelado");return}if(!I){F.error("Selecione um motivo para rejeitar o pedido");return}const x=I==="Outro motivo"?A.trim():I;if(I==="Outro motivo"&&!A.trim()){S(!0),F.error("Descreva o motivo da rejei√ß√£o");return}if(x.length<5){I==="Outro motivo"&&S(!0),F.error("Motivo muito curto. M√≠nimo de 5 caracteres");return}S(!1),g.mutate({id:t.id,updates:{status:"cancelled",rejection_reason:x}}),R(!1),i(""),v(""),S(!1)},oe=async()=>{if(g.isPending)return;if(!p){F.error("Selecione um entregador");return}const x=a.find(L=>L.id===p);if(!x){F.error("Entregador n√£o encontrado");return}if(x.status!=="available"){F.error("Entregador n√£o est√° dispon√≠vel");return}try{const B=(await Q.entities.Store.list())[0],y=a.find(he=>he.id===p),K={status:"going_to_store",entregador_id:p,store_latitude:B?.store_latitude||-5.0892,store_longitude:B?.store_longitude||-42.8019};if(t.pickup_code||(K.pickup_code=Math.floor(1e3+Math.random()*9e3).toString()),t.delivery_code||(K.delivery_code=Math.floor(1e3+Math.random()*9e3).toString()),g.mutate({id:t.id,updates:K}),y){const he=l?{as_subscriber:l}:{};await Q.entities.Entregador.update(p,{...y,current_order_id:t.id,status:"busy"},he)}T(!1),F.success(`Entregador ${y.name} est√° indo buscar o pedido`)}catch(L){console.error("Assign delivery error:",L),F.error("Erro ao atribuir entregador")}},Ke=async()=>{try{const x=l?{as_subscriber:l}:{};await Q.entities.Order.update(t.id,{...t,customer_change_status:"approved"},x),G.invalidateQueries({queryKey:["gestorOrders"]}),F.success("Altera√ß√£o do cliente aceita."),n()}catch(x){F.error(x?.message||"Erro ao aceitar altera√ß√£o.")}},W=async()=>{const x=(f||"").trim();if(x.length<3){F.error("Informe um breve motivo da reprova√ß√£o (m√≠n. 3 caracteres).");return}try{const L=l?{as_subscriber:l}:{};await Q.entities.Order.update(t.id,{...t,customer_change_status:"rejected",customer_change_response:x},L),G.invalidateQueries({queryKey:["gestorOrders"]}),F.success("Altera√ß√£o reprovada."),P(!1),w(""),n()}catch(L){F.error(L?.message||"Erro ao reprovar altera√ß√£o.")}},Ve=()=>{try{const x=window.open("","_blank");if(!x){F.error("Popup bloqueado! Permita popups para imprimir.");return}const L={pix:"PIX",dinheiro:"Dinheiro",cartao_credito:"Cart√£o de Cr√©dito",cartao_debito:"Cart√£o de D√©bito"}[t.payment_method]||t.payment_method;let B="";(t.items||[]).forEach((y,K)=>{const he=y.dish?.product_type==="pizza",Te=y.size||y.selections?.size,He=y.flavors||y.selections?.flavors,xe=y.edge||y.selections?.edge,Xe=y.extras||y.selections?.extras;if(B+='<div style="margin-bottom: 12px; border-left: 3px solid #666; padding-left: 8px;">',B+=`<p style="margin: 0; font-weight: bold;">#${K+1} - ${y.dish?.name} x${y.quantity||1}</p>`,he&&Te){if(B+=`<p style="margin: 4px 0 0 12px; font-size: 10px; font-weight: bold;">üçï ${Te.name} (${Te.slices||""} fatias ‚Ä¢ ${He?.length||0} sabores)</p>`,He&&He.length>0){B+='<p style="margin: 2px 0 0 12px; font-size: 10px;">Sabores:</p>';const we=He.reduce((_e,k)=>(_e[k.name]=(_e[k.name]||0)+1,_e),{});Object.entries(we).forEach(([_e,k])=>{B+=`<p style="margin: 2px 0; font-size: 10px; margin-left: 24px;">  ‚Ä¢ ${k}/${Te.slices||""} ${_e}</p>`})}xe&&(B+=`<p style="margin: 2px 0; font-size: 10px; margin-left: 12px;">üßÄ Borda: ${xe.name}</p>`),Xe&&Xe.length>0&&(B+='<p style="margin: 2px 0; font-size: 10px; margin-left: 12px;">Extras:</p>',Xe.forEach(we=>{B+=`<p style="margin: 2px 0; font-size: 10px; margin-left: 24px;">  ‚Ä¢ ${we.name}</p>`})),y.specifications&&(B+=`<p style="margin: 2px 0; font-size: 10px; margin-left: 12px; font-style: italic;">üìù ${y.specifications}</p>`)}else y.selections&&Object.keys(y.selections).length>0&&Object.values(y.selections).forEach(we=>{Array.isArray(we)?we.forEach(_e=>{B+=`<p style="margin: 2px 0; font-size: 10px; margin-left: 12px;">  ‚Ä¢ ${_e.name}</p>`}):we&&(B+=`<p style="margin: 2px 0; font-size: 10px; margin-left: 12px;">  ‚Ä¢ ${we.name}</p>`)});y.observations&&(B+=`<p style="margin: 2px 0; font-size: 10px; margin-left: 12px; font-style: italic;">üìù ${y.observations}</p>`),B+=`<p style="margin: 4px 0 0 0;">Valor: ${Y(y.totalPrice*(y.quantity||1))}</p>`,B+="</div>"}),x.document.open(),x.document.write(`
      <html>
        <head>
          <title>Comanda #${t.order_code||t.id?.slice(-6).toUpperCase()}</title>
          <style>
            body {
              font-family: 'Courier New', monospace;
              font-size: 11px;
              line-height: 1.35;
              padding: 10mm;
              margin: 0;
              max-width: 80mm;
              word-wrap: break-word;
              overflow-wrap: break-word;
              word-break: break-word;
            }
            p, div { word-wrap: break-word; overflow-wrap: break-word; word-break: break-word; }
            h1 {
              text-align: center;
              font-size: 16px;
              margin: 0 0 5px 0;
            }
            .header {
              text-align: center;
              margin-bottom: 10px;
              padding-bottom: 10px;
              border-bottom: 2px dashed #000;
            }
            .section {
              margin: 10px 0;
            }
            .total {
              border-top: 2px solid #000;
              margin-top: 10px;
              padding-top: 10px;
              font-weight: bold;
              font-size: 14px;
            }
            .code-box {
              background: #fff3cd;
              border: 2px solid #ff9800;
              padding: 10px;
              margin: 10px 0;
              text-align: center;
            }
            .code-box .code {
              font-size: 24px;
              font-weight: bold;
              letter-spacing: 5px;
            }
          </style>
        </head>
        <body>
          <div class="header">
            <h1>COMANDA</h1>
            <p style="margin: 0;">Pedido #${t.order_code||t.id?.slice(-6).toUpperCase()}</p>
            <p style="margin: 0; font-size: 11px;">${t.created_at||t.created_date?Nt(t.created_at||t.created_date):"‚Äî"}</p>
          </div>
          
          <div class="section">
            <p style="margin: 0;"><strong>Cliente:</strong> ${t.customer_name||""}</p>
            <p style="margin: 0;"><strong>Contato:</strong> ${t.customer_phone||""}</p>
            <p style="margin: 0;"><strong>Tipo:</strong> ${t.delivery_method==="delivery"?"Entrega üö¥":"Retirada üè™"}</p>
            ${Qt(t)||t.address?`<p style="margin: 0;"><strong>Endere√ßo:</strong> ${Qt(t)||t.address||""}</p>`:""}
            <p style="margin: 0;"><strong>Pagamento:</strong> ${L}</p>
            ${t.payment_method==="dinheiro"&&t.needs_change&&t.change_amount?`<p style="margin: 0; color: #ff6600;"><strong>Troco para:</strong> ${Y(t.change_amount)} (Troco: ${Y(t.change_amount-t.total)})</p>`:""}
            ${t.scheduled_date&&t.scheduled_time?`<p style="margin: 0; color: #0066cc; font-weight: bold;">‚è∞ AGENDADO: ${Ht(t.scheduled_date,t.scheduled_time)}</p>`:""}
            ${t.customer_change_request?`<p style="margin: 4px 0 0 0; padding: 6px; background: #fef3c7; border: 1px solid #f59e0b; border-radius: 4px;"><strong>‚úèÔ∏è Altera√ß√£o/adicional:</strong> ${t.customer_change_request}${t.customer_change_status==="approved"?' <span style="color:green;">(Aceito)</span>':t.customer_change_status==="rejected"?' <span style="color:red;">(Reprovado)</span>':' <span style="color:#b45309;">(Pendente)</span>'}</p>`:""}
          </div>


          
          <div class="section">
            <p style="margin: 0; font-weight: bold; border-bottom: 1px solid #000; padding-bottom: 5px;">--- Pedido ---</p>
            ${B}
          </div>
          
          <div class="total">
            <p style="margin: 0;">Subtotal itens: ${Y(t.subtotal)}</p>
            ${t.delivery_fee>0?`<p style="margin: 0;">Taxa de entrega: ${Y(t.delivery_fee)}</p>`:""}
            ${t.discount>0?`<p style="margin: 0; color: green;">Desconto: -${Y(t.discount)}</p>`:""}
            <p style="margin: 5px 0 0 0; font-size: 16px;">TOTAL: ${Y(t.total)}</p>
          </div>

          <div style="text-align: center; margin-top: 15px; font-size: 10px; color: #666;">
            Enviado em ${t.created_at||t.created_date?Nt(t.created_at||t.created_date):"‚Äî"}
          </div>
        </body>
      </html>
    `),x.document.close(),x.focus(),setTimeout(()=>{try{x.print(),F.success("Comanda enviada para impress√£o!")}catch(y){console.error("Erro ao imprimir:",y),F.error("Erro ao imprimir. Verifique se popups est√£o permitidos.")}},350)}catch(x){console.error("Erro ao imprimir:",x),F.error("Erro ao imprimir. Verifique se popups est√£o permitidos.")}},$e=a.filter(x=>x.status==="available");return e.jsxs(e.Fragment,{children:[e.jsx(ye,{open:!0,onOpenChange:s,children:e.jsxs(je,{className:"max-w-md max-h-[85vh] overflow-y-auto p-0","aria-describedby":void 0,children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-orange-600 to-orange-500 text-white p-4 z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(ve,{className:"font-bold text-lg text-white",children:"COMANDA"}),e.jsxs("p",{className:"text-sm opacity-90",children:["Pedido #",t.order_code||t.id?.slice(-6).toUpperCase()]}),e.jsx("p",{className:"text-xs opacity-75",children:t.created_at||t.created_date?Nt(t.created_at||t.created_date):"‚Äî"})]}),e.jsx("button",{onClick:s,className:"text-white",children:e.jsx(me,{className:"w-5 h-5"})})]}),["ready","going_to_store","arrived_at_store","picked_up"].includes(t.status)&&t.pickup_code&&e.jsxs("div",{className:"bg-white/20 backdrop-blur-sm border-2 border-white/50 rounded-xl p-3 text-center mt-3",children:[e.jsx("p",{className:"text-xs font-semibold mb-1",children:t.status==="picked_up"?"‚úÖ C√≥digo Validado":"C√≥digo de Retirada"}),e.jsx("p",{className:"text-4xl font-bold tracking-widest",children:t.pickup_code}),e.jsx("p",{className:"text-[10px] opacity-90 mt-1",children:t.status==="picked_up"?"Pedido coletado":t.status==="ready"?"Pronto para coleta":"Forne√ßa ao entregador"})]})]}),e.jsxs("div",{className:"p-4 space-y-3 text-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-bold text-base",children:t.customer_name}),e.jsx("p",{className:"text-xs text-gray-600",children:t.customer_phone}),t.delivery_method==="delivery"&&t.address&&e.jsxs("p",{className:"text-xs text-gray-600",children:["üìç ",t.address]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(ae,{variant:"outline",className:"text-xs",children:t.delivery_method==="delivery"?"üö¥ Entrega":"üè™ Retirada"}),e.jsx(ae,{variant:"outline",className:"text-xs",children:Za[t.payment_method]||t.payment_method})]}),t.scheduled_date&&t.scheduled_time&&e.jsxs("p",{className:"text-xs text-blue-600 font-bold bg-blue-50 p-2 rounded",children:["‚è∞ AGENDADO: ",Ht(t.scheduled_date,t.scheduled_time)]})]}),t.customer_change_request&&e.jsxs("div",{className:`rounded-lg p-3 border ${t.customer_change_status==="approved"?"bg-green-50 border-green-200":t.customer_change_status==="rejected"?"bg-red-50 border-red-200":"bg-amber-50 border-amber-200"}`,children:[e.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:"‚úèÔ∏è Solicita√ß√£o do cliente"}),e.jsx("p",{className:"text-sm text-gray-800",children:t.customer_change_request}),(!t.customer_change_status||t.customer_change_status==="pending")&&e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsxs(_,{size:"sm",onClick:Ke,className:"rounded bg-green-600 hover:bg-green-700 uppercase font-bold transition-all duration-100",children:[e.jsx(at,{className:"w-3.5 h-3.5 mr-1"})," Aceitar"]}),e.jsxs(_,{size:"sm",variant:"outline",onClick:()=>P(!0),className:"rounded border-red-300 text-red-600 hover:bg-red-50 uppercase font-bold transition-all duration-100",children:[e.jsx(Dt,{className:"w-3.5 h-3.5 mr-1"})," Reprovar"]})]}),t.customer_change_status==="approved"&&e.jsx(ae,{className:"mt-2 bg-green-600",children:"Altera√ß√£o aceita"}),t.customer_change_status==="rejected"&&e.jsxs("div",{className:"mt-2",children:[e.jsx(ae,{variant:"outline",className:"border-red-300 text-red-700",children:"Reprovada"}),t.customer_change_response&&e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Motivo: ",t.customer_change_response]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-600 block mb-1",children:"Notas internas"}),e.jsx(Qe,{value:Z,onChange:x=>b(x.target.value),placeholder:"S√≥ voc√™ v√™",rows:2,className:"resize-none text-sm focus:border-gray-800 focus:ring-1 focus:ring-gray-800/20 focus:outline-none"}),e.jsx(_,{type:"button",size:"sm",variant:"ghost",className:"mt-1 h-7 text-xs",onClick:()=>g.mutate({id:t.id,updates:{internal_notes:Z}}),disabled:g.isPending,children:"Salvar notas"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Prioridade:"}),e.jsxs("select",{value:z,onChange:x=>{const L=x.target.value;V(L),g.mutate({id:t.id,updates:{priority:L}})},className:"border rounded px-2 py-1 text-xs focus:border-gray-800 focus:ring-1 focus:ring-gray-800/20 focus:outline-none",children:[e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"alta",children:"Alta"}),e.jsx("option",{value:"baixa",children:"Baixa"})]})]})]}),e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>ee(!re),className:"w-full",children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),re?"Ocultar Hist√≥rico":"Ver Hist√≥rico do Pedido"]}),re&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:e.jsx(Xa,{order:t,logs:h})}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("p",{className:"font-bold mb-2 text-xs text-gray-500",children:"ITENS DO PEDIDO"}),e.jsx("div",{className:"space-y-3",children:(t.items||[]).map((x,L)=>{const B=x.dish?.product_type==="pizza";return e.jsxs("div",{className:"border-l-2 border-gray-300 pl-2",children:[e.jsxs("p",{className:"font-bold text-sm",children:[x.quantity||1,"x ",x.dish?.name]}),B&&x.size&&e.jsxs("div",{className:"ml-2 text-xs mt-1 space-y-1",children:[e.jsxs("p",{className:"font-semibold text-gray-700",children:["üçï ",x.size.name," (",x.size.slices," fatias ‚Ä¢ ",x.flavors?.length||0," sabores)"]}),x.flavors&&x.flavors.length>0&&e.jsxs("div",{className:"ml-2",children:[e.jsx("p",{className:"font-medium text-gray-600",children:"Sabores:"}),Object.entries(x.flavors.reduce((y,K)=>(y[K.name]=(y[K.name]||0)+1,y),{})).map(([y,K])=>e.jsxs("p",{className:"ml-2 text-gray-600",children:["‚Ä¢ ",K,"/",x.size.slices," ",y]},y))]}),x.edge&&e.jsxs("p",{className:"font-medium text-gray-600 ml-2",children:["üßÄ Borda: ",x.edge.name]}),x.extras&&x.extras.length>0&&e.jsxs("div",{className:"ml-2",children:[e.jsx("p",{className:"font-medium text-gray-600",children:"Extras:"}),x.extras.map((y,K)=>e.jsxs("p",{className:"ml-2 text-gray-600",children:["‚Ä¢ ",y.name]},K))]}),x.specifications&&e.jsxs("p",{className:"text-gray-600 ml-2 italic",children:["üìù ",x.specifications]})]}),!B&&x.selections&&Object.keys(x.selections).length>0&&e.jsx("div",{className:"ml-2 text-xs text-gray-600 mt-1 space-y-0.5",children:Object.entries(x.selections).map(([y,K])=>Array.isArray(K)?K.map((he,Te)=>e.jsxs("p",{children:["‚Ä¢ ",he.name]},Te)):K?e.jsxs("p",{children:["‚Ä¢ ",K.name]},y):null)}),x.observations&&e.jsxs("p",{className:"ml-2 text-xs text-gray-600 italic mt-1",children:["üìù ",x.observations]}),e.jsx("p",{className:"font-semibold text-sm text-green-700 mt-1",children:Y(x.totalPrice*(x.quantity||1))})]},L)})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-lg p-3 space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:Y(t.subtotal)})]}),t.delivery_fee>0&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{children:"Taxa de entrega"}),e.jsx("span",{children:Y(t.delivery_fee)})]}),t.discount>0&&e.jsxs("div",{className:"flex justify-between text-xs text-green-600",children:[e.jsx("span",{children:"Desconto"}),e.jsxs("span",{children:["-",Y(t.discount)]})]}),e.jsxs("div",{className:"flex justify-between font-bold text-base pt-2 border-t",children:[e.jsx("span",{children:"TOTAL"}),e.jsx("span",{className:"text-green-600",children:Y(t.total)})]})]})]}),e.jsx("div",{className:"p-4 border-t bg-gray-50 space-y-2",children:e.jsxs("div",{className:"space-y-2",children:[t.status==="new"&&e.jsxs(e.Fragment,{children:[U&&e.jsxs("div",{className:"flex items-center gap-2 mb-2 bg-white p-2 rounded border flex-wrap",children:[e.jsx(Us,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"text-xs",children:"Tempo de preparo:"}),e.jsx("select",{value:q,onChange:x=>H(parseInt(x.target.value)),className:"border rounded px-2 py-1 text-xs font-medium min-h-[52px] focus:border-gray-800 focus:ring-1 focus:ring-gray-800/20 focus:outline-none",children:[10,15,20,25,30,40,45,60,90].map(x=>e.jsxs("option",{value:x,children:[x," min"]},x))}),d&&d!==q&&e.jsxs("button",{type:"button",onClick:()=>H(d),className:"text-[10px] text-blue-600 underline",children:["Sugerido: ",d,"min"]})]}),!U&&e.jsxs("p",{className:"text-xs text-gray-500 mb-2",children:["Tempo de preparo: ",d||30," min (padr√£o)"]}),e.jsx(_,{onClick:J,className:"rounded w-full bg-green-600 hover:bg-green-700 h-12 font-bold uppercase disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-100",disabled:g.isPending,children:g.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Et,{className:"w-5 h-5 mr-2 animate-spin"})," Processando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(at,{className:"w-5 h-5 mr-2"})," Aceitar Pedido"]})}),e.jsxs(_,{onClick:()=>R(!0),variant:"outline",className:"rounded w-full border-red-300 text-red-600 hover:bg-red-50 h-10 uppercase font-bold transition-all duration-100",disabled:g.isPending,children:[e.jsx(Dt,{className:"w-4 h-4 mr-2"})," Rejeitar"]})]}),t.status==="accepted"&&e.jsxs(_,{onClick:te,className:"rounded w-full bg-yellow-600 hover:bg-yellow-700 h-12 font-semibold transition-all duration-100",children:[e.jsx(zt,{className:"w-5 h-5 mr-2"})," Iniciar Preparo"]}),t.status==="preparing"&&e.jsxs(_,{onClick:te,className:"rounded w-full bg-green-600 hover:bg-green-700 h-12 font-semibold transition-all duration-100",children:[e.jsx(ge,{className:"w-5 h-5 mr-2"})," Marcar como Pronto"]}),t.status==="ready"&&t.delivery_method==="delivery"&&e.jsxs(_,{onClick:()=>T(!0),className:"rounded w-full bg-blue-600 hover:bg-blue-700 h-12 font-semibold transition-all duration-100",children:[e.jsx(Ae,{className:"w-5 h-5 mr-2"})," Chamar Entregador"]}),t.status==="ready"&&t.delivery_method==="pickup"&&e.jsxs(_,{onClick:te,className:"rounded w-full bg-green-600 hover:bg-green-700 h-12 font-semibold transition-all duration-100",children:[e.jsx(ge,{className:"w-5 h-5 mr-2"})," Marcar como Entregue"]}),t.status==="out_for_delivery"&&e.jsxs(e.Fragment,{children:[t.entregador_id&&e.jsxs(_,{onClick:()=>ie(!0),variant:"outline",className:"w-full border-blue-500 text-blue-600 hover:bg-blue-50 h-10 font-medium mb-2",children:[e.jsx(gt,{className:"w-4 h-4 mr-2"})," Enviar Mensagem ao Entregador"]}),e.jsxs(_,{onClick:te,className:"rounded w-full bg-green-600 hover:bg-green-700 h-12 font-semibold transition-all duration-100",children:[e.jsx(ge,{className:"w-5 h-5 mr-2"})," Confirmar Entrega"]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-5 gap-2 pt-2 border-t border-gray-200",children:[e.jsx(_,{size:"sm",variant:t.status==="new"?"default":"outline",className:"min-h-touch bg-green-600 hover:bg-green-700 text-white border-0",disabled:t.status!=="new"||g.isPending,onClick:()=>{const x=U?q:d||30;g.mutate({id:t.id,updates:{status:"accepted",accepted_at:new Date().toISOString(),prep_time:x}})},children:"Aceitar"}),e.jsx(_,{size:"sm",variant:["accepted","preparing"].includes(t.status)?"default":"outline",className:"min-h-touch bg-yellow-600 hover:bg-yellow-700 text-white border-0",disabled:!["accepted","preparing"].includes(t.status)||g.isPending,onClick:()=>g.mutate({id:t.id,updates:{status:"preparing"}}),children:"Preparo"}),e.jsx(_,{size:"sm",variant:t.status==="ready"?"default":"outline",className:"min-h-touch bg-emerald-600 hover:bg-emerald-700 text-white border-0",disabled:!["accepted","preparing"].includes(t.status)||g.isPending,onClick:()=>{const x={status:"ready",ready_at:new Date().toISOString()};t.pickup_code||(x.pickup_code=Math.floor(1e3+Math.random()*9e3).toString()),!t.delivery_code&&t.delivery_method==="delivery"&&(x.delivery_code=Math.floor(1e3+Math.random()*9e3).toString()),g.mutate({id:t.id,updates:x})},children:"Pronto"}),e.jsx(_,{size:"sm",variant:t.status==="out_for_delivery"?"default":"outline",className:"min-h-touch bg-blue-600 hover:bg-blue-700 text-white border-0",disabled:!["ready","picked_up"].includes(t.status)||g.isPending,onClick:()=>g.mutate({id:t.id,updates:{status:"out_for_delivery"}}),children:"Saiu"}),e.jsx(_,{size:"sm",variant:t.status==="delivered"?"default":"outline",className:"min-h-touch bg-gray-700 hover:bg-gray-800 text-white border-0",disabled:!["ready","out_for_delivery","arrived_at_customer"].includes(t.status)||g.isPending,onClick:()=>g.mutate({id:t.id,updates:{status:"delivered",delivered_at:new Date().toISOString()}}),children:"Entregue"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(_,{onClick:Ve,variant:"outline",size:"sm",className:"rounded uppercase font-bold transition-all duration-100 min-h-touch",children:[e.jsx(rt,{className:"w-4 h-4 mr-1"})," Imprimir"]}),r&&e.jsxs(_,{onClick:r,variant:"outline",size:"sm",children:[e.jsx(rt,{className:"w-4 h-4 mr-1"})," Na fila"]}),t.customer_phone&&e.jsxs(e.Fragment,{children:[e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>{const x=t.customer_phone?.replace(/\D/g,""),L=`Ol√°! Seu pedido #${t.order_code||t.id} est√°: ${t.status}.`;window.open(`https://wa.me/55${x}?text=${encodeURIComponent(L)}`,"_blank")},children:[e.jsx(gt,{className:"w-4 h-4 mr-1"})," Enviar status"]}),e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>window.open(`https://wa.me/55${t.customer_phone?.replace(/\D/g,"")}`,"_blank"),children:[e.jsx(lt,{className:"w-4 h-4 mr-1"})," WhatsApp"]})]}),E&&t.delivery_method==="delivery"&&t.address&&e.jsxs(_,{onClick:E,variant:"outline",size:"sm",children:[e.jsx(Ie,{className:"w-4 h-4 mr-1"})," Ver no mapa"]}),N&&e.jsxs(_,{onClick:()=>N(t),variant:"outline",size:"sm",children:[e.jsx(Xs,{className:"w-4 h-4 mr-1"})," Duplicar"]})]}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"1‚Äì4: atalhos de status | Esc: fechar"})]})})]})}),e.jsx(ye,{open:C,onOpenChange:R,children:e.jsx(je,{className:"max-w-sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(ve,{className:"font-bold text-lg text-red-600",children:"‚ö†Ô∏è Rejeitar Pedido"}),e.jsx(Vt,{className:"text-sm text-gray-600",children:"Tem certeza? Selecione o motivo da rejei√ß√£o. Esta a√ß√£o n√£o pode ser desfeita."}),e.jsx("div",{className:"space-y-2",children:er.map(x=>e.jsx("button",{onClick:()=>i(x),className:`w-full p-3 rounded-lg border-2 text-left text-sm transition-colors ${I===x?"border-red-500 bg-red-50 font-medium":"border-gray-200 hover:border-gray-300"}`,children:x},x))}),I==="Outro motivo"&&e.jsxs("div",{children:[e.jsx("label",{className:`text-sm font-medium mb-2 block ${D?"text-red-500":"text-gray-700"}`,children:"Descreva o motivo *"}),e.jsx(Qe,{value:A,onChange:x=>{v(x.target.value),S(!1)},placeholder:"Ex: Cliente solicitou cancelamento...",rows:3,className:`resize-none min-h-[52px] focus:outline-none focus:ring-1 focus:ring-gray-800/20 focus:border-gray-800 ${D?"border-2 border-red-500":""}`}),e.jsx("p",{className:`text-xs mt-1 ${D?"text-red-500":"text-gray-500"}`,children:"M√≠nimo de 5 caracteres"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(_,{onClick:()=>{R(!1),i(""),v(""),S(!1)},className:"flex-1 bg-[#a6a6a5] hover:bg-[#929290] text-white border-0 rounded transition-all duration-100",children:"Cancelar"}),e.jsx(_,{onClick:pe,disabled:!I||g.isPending,className:"rounded flex-1 bg-red-600 hover:bg-red-700 disabled:opacity-50 transition-all duration-100",children:g.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Et,{className:"w-4 h-4 mr-2 animate-spin"}),"Processando..."]}):"Confirmar Rejei√ß√£o"})]})]})})}),e.jsx(ye,{open:j,onOpenChange:x=>{P(x),x||w("")},children:e.jsx(je,{className:"max-w-sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(ve,{className:"font-bold text-lg text-amber-700",children:"Reprovar altera√ß√£o solicitada"}),e.jsx(Vt,{className:"text-sm text-gray-600",children:'Informe um breve motivo para o cliente (m√≠n. 3 caracteres). Ex.: "Ingrediente indispon√≠vel".'}),e.jsx(Qe,{value:f,onChange:x=>w(x.target.value),placeholder:"Motivo da reprova√ß√£o...",rows:3,className:"resize-none min-h-[52px] focus:border-gray-800 focus:ring-1 focus:ring-gray-800/20 focus:outline-none"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(_,{onClick:()=>{P(!1),w("")},className:"flex-1 bg-[#a6a6a5] hover:bg-[#929290] text-white border-0 rounded transition-all duration-100",children:"Cancelar"}),e.jsx(_,{onClick:W,disabled:(f||"").trim().length<3,className:"rounded flex-1 bg-amber-600 hover:bg-amber-700 transition-all duration-100",children:"Reprovar altera√ß√£o"})]})]})})}),e.jsx(ye,{open:$,onOpenChange:T,children:e.jsx(je,{className:"max-w-sm","aria-describedby":void 0,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(ve,{className:"font-bold text-lg",children:"Chamar Entregador"}),$e.length===0?e.jsx("p",{className:"text-center text-gray-500 py-4",children:"Nenhum entregador dispon√≠vel"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2",children:$e.map(x=>e.jsxs("button",{onClick:()=>M(x.id),className:`w-full p-3 rounded-lg border-2 text-left ${p===x.id?"border-blue-500 bg-blue-50":"border-gray-200"}`,children:[e.jsx("p",{className:"font-medium",children:x.name}),e.jsx("p",{className:"text-sm text-gray-500",children:x.phone})]},x.id))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(_,{onClick:()=>T(!1),className:"flex-1 bg-[#a6a6a5] hover:bg-[#929290] text-white border-0 rounded transition-all duration-100",children:"Cancelar"}),e.jsx(_,{onClick:oe,disabled:!p||g.isPending,className:"rounded flex-1 bg-blue-600 disabled:opacity-50 transition-all duration-100",children:g.isPending?"Processando...":"Confirmar"})]})]})]})})}),ne&&t.entregador_id&&e.jsx(Wa,{order:t,entregador:a.find(x=>x.id===t.entregador_id),onClose:()=>ie(!1)})]})}function sr({isOpen:t,onClose:a,order:s,entregadores:n,onAssign:c}){const[l,d]=o.useState("nearest"),m=r=>(Math.random()*4.5+.5).toFixed(1),E=[...n.filter(r=>r.status==="available")].sort((r,C)=>l==="nearest"?parseFloat(m())-parseFloat(m()):l==="least_busy"?(r.total_deliveries||0)-(C.total_deliveries||0):l==="best_rated"?(C.rating||0)-(r.rating||0):0),N=E[0];return e.jsx(ye,{open:t,onOpenChange:a,children:e.jsxs(je,{className:"max-w-2xl",children:[e.jsx(Ye,{children:e.jsxs(ve,{className:"flex items-center gap-2",children:[e.jsx(pt,{className:"w-5 h-5 text-orange-500"}),"Atribui√ß√£o Autom√°tica de Entregador"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 border",children:[e.jsxs("p",{className:"font-bold text-sm mb-1",children:["Pedido #",s?.order_code]}),e.jsx("p",{className:"text-xs text-gray-600",children:s?.customer_name}),e.jsx("p",{className:"text-xs text-gray-500",children:s?.address})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"M√©todo de sele√ß√£o:"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("button",{onClick:()=>d("nearest"),className:`p-3 rounded-lg border-2 text-left transition-all ${l==="nearest"?"border-orange-500 bg-orange-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx(Ie,{className:"w-4 h-4 mb-1 text-orange-500"}),e.jsx("p",{className:"font-medium text-xs",children:"Mais Pr√≥ximo"})]}),e.jsxs("button",{onClick:()=>d("least_busy"),className:`p-3 rounded-lg border-2 text-left transition-all ${l==="least_busy"?"border-orange-500 bg-orange-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx(be,{className:"w-4 h-4 mb-1 text-orange-500"}),e.jsx("p",{className:"font-medium text-xs",children:"Menos Ocupado"})]}),e.jsxs("button",{onClick:()=>d("best_rated"),className:`p-3 rounded-lg border-2 text-left transition-all ${l==="best_rated"?"border-orange-500 bg-orange-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx(Fe,{className:"w-4 h-4 mb-1 text-orange-500"}),e.jsx("p",{className:"font-medium text-xs",children:"Melhor Avaliado"})]})]})]}),N&&e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 border-2 border-green-500 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-500 rounded-full flex items-center justify-center",children:e.jsx(st,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-bold",children:["Melhor Op√ß√£o: ",N.name]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(ae,{className:"bg-green-600 text-xs",children:"Dispon√≠vel"}),e.jsxs("span",{className:"text-xs text-gray-600",children:["~",m(),"km de dist√¢ncia"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-white/50 rounded p-2",children:[e.jsx("p",{className:"text-gray-600",children:"Entregas"}),e.jsx("p",{className:"font-bold",children:N.total_deliveries||0})]}),e.jsxs("div",{className:"bg-white/50 rounded p-2",children:[e.jsx("p",{className:"text-gray-600",children:"Avalia√ß√£o"}),e.jsxs("p",{className:"font-bold flex items-center gap-1",children:[e.jsx(Fe,{className:"w-3 h-3 fill-yellow-400 text-yellow-400"}),N.rating?.toFixed(1)||"N/A"]})]}),e.jsxs("div",{className:"bg-white/50 rounded p-2",children:[e.jsx("p",{className:"text-gray-600",children:"Ve√≠culo"}),e.jsx("p",{className:"font-bold uppercase",children:N.vehicle_type||"N/A"})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Outras op√ß√µes dispon√≠veis:"}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2",children:E.slice(1,5).map(r=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer",onClick:()=>c?.(s.id,r.id),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(st,{className:"w-5 h-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:r.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:["~",m(),"km"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-xs",children:["‚≠ê ",r.rating?.toFixed(1)||"N/A"]})})]},r.id))})]})]}),e.jsxs(It,{children:[e.jsx(_,{variant:"outline",onClick:a,children:"Cancelar"}),e.jsxs(_,{onClick:()=>{N&&(c?.(s.id,N.id),a())},className:"bg-green-600 hover:bg-green-700",disabled:!N,children:[e.jsx(pt,{className:"w-4 h-4 mr-2"}),"Atribuir para ",N?.name]})]})]})})}function ar({isOpen:t,onClose:a,entregador:s}){const[n,c]=o.useState(""),[l,d]=o.useState(!1),m=["Pedido urgente dispon√≠vel","Por favor, confirme sua localiza√ß√£o","Cliente aguardando contato","Retorne √† loja para nova entrega"],u=async()=>{n.trim()&&(d(!0),await new Promise(N=>setTimeout(N,1e3)),ze.success(`Mensagem enviada para ${s.name}`),c(""),d(!1))},E=async()=>{d(!0),await new Promise(N=>setTimeout(N,800)),ze.success(`Notifica√ß√£o push enviada para ${s.name}`),d(!1)};return e.jsx(ye,{open:t,onOpenChange:a,children:e.jsxs(je,{className:"max-w-md",children:[e.jsx(Ye,{children:e.jsxs(ve,{className:"flex items-center gap-2",children:[e.jsx(lt,{className:"w-5 h-5 text-blue-500"}),"Mensagem para ",s?.name]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Mensagens r√°pidas:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:m.map((N,r)=>e.jsx("button",{onClick:()=>c(N),className:"p-2 text-xs text-left border rounded-lg hover:bg-gray-50 transition-colors",children:N},r))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Mensagem personalizada:"}),e.jsx(Qe,{value:n,onChange:N=>c(N.target.value),placeholder:"Digite sua mensagem...",rows:4,className:"resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(_,{onClick:E,disabled:l,variant:"outline",className:"w-full",children:[e.jsx(it,{className:"w-4 h-4 mr-2"}),"Notifica√ß√£o Push"]}),e.jsxs(_,{onClick:u,disabled:l||!n.trim(),className:"w-full bg-blue-600 hover:bg-blue-700",children:[e.jsx(gt,{className:"w-4 h-4 mr-2"}),"Enviar Mensagem"]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 border text-xs",children:[e.jsx("p",{className:"font-medium mb-1",children:"Contato:"}),e.jsxs("p",{className:"text-gray-600",children:["üì± ",s?.phone||"N√£o informado"]})]})]})]})})}function rr({isOpen:t,onClose:a,entregador:s,orderId:n}){const[c,l]=o.useState(0),[d,m]=o.useState(0),[u,E]=o.useState(""),N=Le(),r=Ne({mutationFn:async R=>{await Q.entities.DeliveryRating.create(R);const $=s.rating||5,T=s.total_ratings||0,j=T+1,P=($*T+R.rating)/j;await Q.entities.Entregador.update(s.id,{...s,rating:P,total_ratings:j})},onSuccess:()=>{N.invalidateQueries({queryKey:["entregadores"]}),ze.success("Avalia√ß√£o registrada com sucesso!"),a(),l(0),E("")}}),C=()=>{if(c===0){ze.error("Por favor, selecione uma avalia√ß√£o");return}r.mutate({order_id:n,entregador_id:s.id,rating:c,comment:u.trim()||void 0,rated_by:"customer"})};return e.jsx(ye,{open:t,onOpenChange:a,children:e.jsxs(je,{className:"max-w-md",children:[e.jsx(Ye,{children:e.jsx(ve,{children:"Avaliar Entregador"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-bold text-lg",children:s?.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s?.total_deliveries||0," entregas ‚Ä¢ ‚≠ê ",s?.rating?.toFixed(1)||"N/A"]})]}),e.jsx("div",{className:"flex justify-center gap-2 py-4",children:[1,2,3,4,5].map(R=>e.jsx("button",{onMouseEnter:()=>m(R),onMouseLeave:()=>m(0),onClick:()=>l(R),className:"transition-transform hover:scale-110",children:e.jsx(Fe,{className:`w-10 h-10 ${R<=(d||c)?"fill-yellow-400 text-yellow-400":"text-gray-300"}`})},R))}),c>0&&e.jsxs("p",{className:"text-center text-sm font-medium",children:[c===1&&"P√©ssimo",c===2&&"Ruim",c===3&&"Regular",c===4&&"Bom",c===5&&"Excelente"]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Coment√°rio (opcional)"}),e.jsx(Qe,{value:u,onChange:R=>E(R.target.value),placeholder:"Deixe um coment√°rio sobre a entrega...",rows:3,className:"resize-none"})]})]}),e.jsxs(It,{children:[e.jsx(_,{variant:"outline",onClick:a,children:"Cancelar"}),e.jsx(_,{onClick:C,disabled:c===0||r.isPending,className:"bg-yellow-500 hover:bg-yellow-600",children:r.isPending?"Enviando...":"Enviar Avalia√ß√£o"})]})]})})}const nr=(t,a={lat:-5.0892,lng:-42.8019})=>{if(t.length===0)return{optimizedOrders:[],totalDistance:0,estimatedTime:0};const s=[...t],n=[];let c=a,l=0;for(;s.length>0;){let m=0,u=ts(c,s[0].coordinates||ht());for(let N=1;N<s.length;N++){const r=ts(c,s[N].coordinates||ht());r<u&&(u=r,m=N)}const E=s.splice(m,1)[0];n.push(E),c=E.coordinates||ht(),l+=u}const d=Math.round(l/30*60+n.length*5);return{optimizedOrders:n,totalDistance:Math.round(l*10)/10,estimatedTime:d}},ts=(t,a)=>{const n=mt(a.lat-t.lat),c=mt(a.lng-t.lng),l=mt(t.lat),d=mt(a.lat),m=Math.sin(n/2)*Math.sin(n/2)+Math.sin(c/2)*Math.sin(c/2)*Math.cos(l)*Math.cos(d);return 6371*(2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)))},mt=t=>t*(Math.PI/180),ht=()=>({lat:-5.0892+(Math.random()-.5)*.1,lng:-42.8019+(Math.random()-.5)*.1});function ir({isOpen:t,onClose:a,entregador:s,orders:n}){const[c,l]=o.useState([]),[d,m]=o.useState(null),[u,E]=o.useState(!1),N=Le(),r=n.filter(j=>j.status==="ready"&&j.delivery_method==="delivery"&&!j.entregador_id);o.useEffect(()=>{t&&(l([]),m(null))},[t]);const C=j=>{l(P=>P.some(w=>w.id===j.id)?P.filter(w=>w.id!==j.id):[...P,j])},R=()=>{if(c.length===0){F.error("Selecione pelo menos um pedido");return}E(!0),setTimeout(()=>{const j=c.map(f=>({...f,coordinates:f.coordinates||ht()})),P=nr(j);m(P),E(!1),F.success("Rota otimizada com sucesso!")},800)},$=Ne({mutationFn:async()=>{if(d){for(const j of d.optimizedOrders)await Q.entities.Order.update(j.id,{status:"out_for_delivery",entregador_id:s.id});await Q.entities.Entregador.update(s.id,{...s,status:"busy",current_order_id:d.optimizedOrders[0].id})}},onSuccess:()=>{N.invalidateQueries({queryKey:["gestorOrders"]}),N.invalidateQueries({queryKey:["entregadores"]}),F.success("Rota atribu√≠da ao entregador!"),a()},onError:()=>{F.error("Erro ao atribuir rota")}}),T=j=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(j||0);return e.jsx(ye,{open:t,onOpenChange:a,children:e.jsxs(je,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ye,{children:e.jsxs(ve,{className:"flex items-center gap-2",children:[e.jsx(_t,{className:"w-5 h-5 text-blue-600"}),"Otimiza√ß√£o de Rota - ",s?.name]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 text-center border border-blue-200",children:[e.jsx(Ie,{className:"w-5 h-5 mx-auto mb-1 text-blue-600"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:c.length}),e.jsx("p",{className:"text-xs text-blue-700",children:"Entregas"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-3 text-center border border-green-200",children:[e.jsx(ds,{className:"w-5 h-5 mx-auto mb-1 text-green-600"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:d?`${d.totalDistance}km`:"-"}),e.jsx("p",{className:"text-xs text-green-700",children:"Dist√¢ncia"})]}),e.jsxs("div",{className:"bg-orange-50 rounded-lg p-3 text-center border border-orange-200",children:[e.jsx(Re,{className:"w-5 h-5 mx-auto mb-1 text-orange-600"}),e.jsx("p",{className:"text-2xl font-bold text-orange-900",children:d?`${d.estimatedTime}min`:"-"}),e.jsx("p",{className:"text-xs text-orange-700",children:"Tempo Est."})]})]}),!d&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"font-bold",children:["Pedidos Dispon√≠veis (",r.length,")"]}),e.jsx(_,{onClick:R,disabled:c.length===0||u,className:"bg-blue-600 hover:bg-blue-700",size:"sm",children:u?e.jsxs(e.Fragment,{children:[e.jsx(qt,{className:"w-4 h-4 mr-2 animate-spin"}),"Otimizando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_t,{className:"w-4 h-4 mr-2"}),"Otimizar Rota"]})})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto space-y-2",children:r.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Ie,{className:"w-12 h-12 mx-auto mb-2 opacity-30"}),e.jsx("p",{children:"Nenhum pedido dispon√≠vel para entrega"})]}):r.map(j=>{const P=c.some(f=>f.id===j.id);return e.jsx("div",{onClick:()=>C(j),className:`p-3 rounded-lg border-2 cursor-pointer transition-all ${P?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 bg-white"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("p",{className:"font-bold",children:["#",j.order_code]}),e.jsx(ae,{className:"text-xs bg-green-500",children:"Pronto"})]}),e.jsx("p",{className:"text-sm text-gray-700",children:j.customer_name}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[e.jsx(Ie,{className:"w-3 h-3 inline mr-1"}),j.address]}),e.jsx("p",{className:"text-sm font-bold text-green-600 mt-2",children:T(j.total)})]}),P&&e.jsx(ge,{className:"w-6 h-6 text-blue-600 flex-shrink-0"})]})},j.id)})})]}),d&&e.jsxs("div",{children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-green-50 rounded-lg p-4 mb-4 border-2 border-blue-200",children:[e.jsxs("h3",{className:"font-bold text-lg mb-2 flex items-center gap-2",children:[e.jsx(_t,{className:"w-5 h-5 text-blue-600"}),"Rota Otimizada"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Total de Entregas"}),e.jsx("p",{className:"font-bold text-lg",children:d.optimizedOrders.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Dist√¢ncia Total"}),e.jsxs("p",{className:"font-bold text-lg",children:[d.totalDistance," km"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Tempo Estimado"}),e.jsxs("p",{className:"font-bold text-lg",children:[d.estimatedTime," min"]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700",children:"Sequ√™ncia de Entrega:"}),d.optimizedOrders.map((j,P)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-white rounded-lg border",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold text-sm",children:P+1}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("p",{className:"font-bold",children:["#",j.order_code]}),e.jsx(ae,{className:"text-xs",children:j.customer_name})]}),e.jsxs("p",{className:"text-xs text-gray-600 flex items-start gap-1",children:[e.jsx(Ie,{className:"w-3 h-3 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:j.address})]}),e.jsx("p",{className:"text-sm font-semibold text-green-600 mt-1",children:T(j.total)})]})]},j.id))]}),e.jsxs("div",{className:"mt-4 bg-yellow-50 border border-yellow-200 rounded-lg p-3 text-sm",children:[e.jsx("p",{className:"font-semibold text-yellow-900 mb-1",children:"üí° Dica de Otimiza√ß√£o:"}),e.jsx("p",{className:"text-yellow-800",children:"Esta rota foi calculada usando o algoritmo de vizinho mais pr√≥ximo, priorizando menor dist√¢ncia entre pontos de entrega."})]})]})]}),e.jsx(It,{className:"flex gap-2",children:d?e.jsxs(e.Fragment,{children:[e.jsx(_,{variant:"outline",onClick:()=>m(null),children:"Voltar"}),e.jsx(_,{onClick:()=>$.mutate(),disabled:$.isPending,className:"bg-green-600 hover:bg-green-700",children:$.isPending?e.jsxs(e.Fragment,{children:[e.jsx(qt,{className:"w-4 h-4 mr-2 animate-spin"}),"Atribuindo..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Confirmar e Iniciar Entregas"]})})]}):e.jsx(_,{variant:"outline",onClick:a,children:"Cancelar"})})]})})}const lr={};function or(t=0,a="#22c55e"){const s=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><g transform="rotate(${t-90} 24 24)"><path fill="${a}" stroke="#166534" stroke-width="1" d="M12 30q2-1 4-2t4-1l-2-4h-4q-1 2-2 4t-2 3zm8-14l4 8 8-2-4-8q-2 1-4 2t-4 2zm-8 20q-2 0-4-1t-4-3 -2-4q0-3 2.5-5.5T20 28q3 0 5.5 2.5T28 36q0 2-1 4t-3 4-4 2q-3 0-5.5-2.5T12 36z"/><circle cx="36" cy="36" r="6" fill="#475569"/></g></svg>`;return"data:image/svg+xml,"+encodeURIComponent(s)}function cr({entregadores:t=[],orders:a=[],stores:s=[],onSelectEntregador:n,onSelectOrder:c,darkMode:l=!1}){o.useRef(null);const d=o.useRef(null),m=o.useRef({}),u=o.useRef({}),[E,N]=o.useState(!1),[r,C]=o.useState(null),[R,$]=o.useState({}),[T,j]=o.useState({}),[P,f]=o.useState(null),w="";o.useEffect(()=>{a.filter(D=>["going_to_store","out_for_delivery"].includes(D.status)&&D.address).forEach(async D=>{if(!R[D.id])try{const p=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(D.address)}&limit=1`)).json();p?.[0]&&$(M=>({...M,[D.id]:{lat:parseFloat(p[0].lat),lng:parseFloat(p[0].lon)}}))}catch(S){console.error(S)}})},[a]),o.useEffect(()=>{},[t,a,R,void 0]);const i=t.filter(D=>(D.status==="busy"||D.current_order_id)&&D.current_latitude&&D.current_longitude),A=a.filter(D=>D.status==="ready"&&D.delivery_method==="delivery"),v=[...i.map(D=>({lat:D.current_latitude,lng:D.current_longitude})),...Object.values(R),...s.filter(D=>D.store_latitude&&D.store_longitude).map(D=>({lat:D.store_latitude,lng:D.store_longitude}))];return v.length>0&&(v.reduce((D,S)=>D+S.lat,0)/v.length,v.reduce((D,S)=>D+S.lng,0)/v.length),o.useEffect(()=>{},[w]),o.useEffect(()=>{const D=d.current;D&&D.setOptions({styles:l?[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]}]:void 0})},[E,l]),o.useEffect(()=>{const D=d.current;!D||!E||(Object.values(m.current).forEach(S=>S?.setMap?.(null)),Object.values(u.current).forEach(S=>S?.setMap?.(null)),m.current={},u.current={},s.forEach(S=>{if(!S.store_latitude||!S.store_longitude)return;const p=new google.maps.Marker({map:D,position:{lat:S.store_latitude,lng:S.store_longitude},title:S.name||"Restaurante",icon:{path:google.maps.SymbolPath.BACKWARD_CLOSED_ARROW,scale:8,fillColor:"#8b5cf6",fillOpacity:1,strokeColor:"#fff",strokeWeight:2}});m.current[`store-${S.id}`]=p}),i.forEach(S=>{const p=a.find(H=>H.id===S.current_order_id);if(!p||!R[p.id])return;const M=T[`${S.id}-${p.id}`];if(!M?.path?.length)return;const q=new google.maps.Polyline({map:D,path:M.path,strokeColor:P===S.id?"#3b82f6":"#10b981",strokeWeight:P===S.id?6:4,strokeOpacity:.7});u.current[`route-${S.id}`]=q}),i.forEach(S=>{const p=a.find(ee=>ee.id===S.current_order_id),M=p?T[`${S.id}-${p.id}`]:null;let q=0;if(M?.path?.length>=2){const ee=M.path[0],ne=M.path[1],ie=(ne.lng-ee.lng)*Math.PI/180;q=(Math.atan2(Math.sin(ie)*Math.cos(ne.lat*Math.PI/180),Math.cos(ee.lat*Math.PI/180)*Math.sin(ne.lat*Math.PI/180)-Math.sin(ee.lat*Math.PI/180)*Math.cos(ne.lat*Math.PI/180)*Math.cos(ie))*180/Math.PI+360)%360}const H=P===S.id?"#3b82f6":S.status==="busy"?"#eab308":"#22c55e",re=new google.maps.Marker({map:D,position:{lat:S.current_latitude,lng:S.current_longitude},title:S.name,icon:{url:or(q,H),scaledSize:new google.maps.Size(44,44),anchor:new google.maps.Point(22,22)}});re.addListener("click",()=>{f(S.id),n?.(S),p&&c?.(p)}),m.current[`ent-${S.id}`]=re}),Object.entries(R).forEach(([S,p])=>{const M=a.find(H=>H.id===S);if(!M)return;const q=new google.maps.Marker({map:D,position:p,title:M.customer_name,icon:{path:google.maps.SymbolPath.CIRCLE,scale:10,fillColor:"#ef4444",fillOpacity:1,strokeColor:"#fff",strokeWeight:2}});q.addListener("click",()=>c?.(M)),m.current[`cust-${S}`]=q}),A.forEach(S=>{const p=R[S.id];if(!p)return;const M=new google.maps.Marker({map:D,position:p,title:`#${S.order_code}`,icon:{path:google.maps.SymbolPath.CIRCLE,scale:10,fillColor:"#ef4444",fillOpacity:1,strokeColor:"#fff",strokeWeight:2}});M.addListener("click",()=>c?.(S)),m.current[`pend-${S.id}`]=M}))},[E,i,R,T,s,a,A,P,n,c]),o.useEffect(()=>{const D=d.current;if(!D||v.length<2)return;const S=new google.maps.LatLngBounds;v.forEach(p=>S.extend(p)),D.fitBounds(S,60)},[E,v.length]),e.jsxs("div",{className:"h-full flex flex-col items-center justify-center bg-amber-50 dark:bg-amber-900/20 rounded-xl p-6",children:[e.jsx(Ie,{className:"w-12 h-12 text-amber-500 mb-2"}),e.jsx("p",{className:"text-amber-800 dark:text-amber-200 text-sm font-medium text-center mb-1",children:"Chave do Google Maps n√£o configurada"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 text-xs text-center max-w-xs",children:["Adicione ",e.jsx("code",{className:"bg-black/5 dark:bg-white/10 px-1 rounded",children:"VITE_GOOGLE_MAPS_KEY"})," (ou ",e.jsx("code",{className:"bg-black/5 dark:bg-white/10 px-1 rounded",children:"VITE_GOOGLE_MAPS_API_KEY"}),") no ",e.jsx("code",{className:"bg-black/5 dark:bg-white/10 px-1 rounded",children:".env"})," na raiz e reinicie (",e.jsx("code",{children:"npm run dev"}),"). Na Vercel: Settings ‚Üí Environment Variables."]})]})}function dr({entregador:t,onClose:a,darkMode:s}){const{data:n=[]}=ke({queryKey:["deliveryRatings",t.id],queryFn:()=>Q.entities.DeliveryRating.filter({entregador_id:t.id},"-created_date")}),{data:c=[]}=ke({queryKey:["ratedOrders",t.id],queryFn:async()=>(await Q.entities.Order.filter({entregador_id:t.id,status:"delivered"})).filter(E=>E.restaurant_rating||E.rating_comment)}),l=n.length>0?(n.reduce((u,E)=>u+(E.rating||0),0)/n.length).toFixed(1):"5.0",d=[5,4,3,2,1].map(u=>({star:u,count:n.filter(E=>E.rating===u).length,percentage:n.length>0?n.filter(E=>E.rating===u).length/n.length*100:0})),m=[...n.map(u=>({...u,type:"delivery",date:u.created_date,rating:u.rating,comment:u.comment})),...c.map(u=>({...u,type:"restaurant",date:u.delivered_at,rating:u.restaurant_rating,comment:u.rating_comment}))].sort((u,E)=>new Date(E.date)-new Date(u.date));return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs(Se.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:`w-full max-w-2xl max-h-[90vh] ${s?"bg-gray-800":"bg-white"} rounded-2xl shadow-2xl overflow-hidden`,children:[e.jsxs("div",{className:"bg-gradient-to-r from-amber-500 to-orange-500 text-white p-6 relative",children:[e.jsx("button",{onClick:a,className:"absolute top-4 right-4 hover:bg-white/20 rounded-lg p-2 transition-colors",children:e.jsx(me,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm",children:e.jsx(ms,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Hist√≥rico de Avalia√ß√µes"}),e.jsx("p",{className:"text-white/80 text-sm",children:"Suas avalia√ß√µes de clientes e restaurantes"})]})]})]}),e.jsxs("div",{className:"p-6 border-b",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-amber-500",children:l}),e.jsx("div",{className:"flex items-center justify-center gap-1 mb-1",children:[...Array(5)].map((u,E)=>e.jsx(Fe,{className:`w-4 h-4 ${E<Math.round(parseFloat(l))?"fill-amber-400 text-amber-400":"text-gray-300"}`},E))}),e.jsx("p",{className:"text-xs text-gray-500",children:"M√©dia Geral"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-500",children:m.length}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Total de Avalia√ß√µes"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-500",children:m.filter(u=>u.rating>=4).length}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Positivas"})]})]}),e.jsx("div",{className:"space-y-2",children:d.map(({star:u,count:E,percentage:N})=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1 w-16",children:[e.jsx(Fe,{className:"w-3 h-3 fill-amber-400 text-amber-400"}),e.jsx("span",{className:"text-sm font-medium",children:u})]}),e.jsx("div",{className:"flex-1 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-amber-400 transition-all duration-500",style:{width:`${N}%`}})}),e.jsx("span",{className:"text-xs text-gray-500 w-12 text-right",children:E})]},u))})]}),e.jsx("div",{className:"overflow-y-auto max-h-[400px] p-6 space-y-4",children:m.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(lt,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Nenhuma avalia√ß√£o ainda"})]}):m.map((u,E)=>e.jsxs(Se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:E*.05},className:`p-4 rounded-xl border ${s?"bg-gray-700 border-gray-600":"bg-gray-50 border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`px-2 py-1 rounded-lg text-xs font-medium ${u.type==="delivery"?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:u.type==="delivery"?"üë§ Cliente":"üçΩÔ∏è Restaurante"}),e.jsx("div",{className:"flex items-center gap-1",children:[...Array(5)].map((N,r)=>e.jsx(Fe,{className:`w-4 h-4 ${r<u.rating?"fill-amber-400 text-amber-400":"text-gray-300"}`},r))})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(xt,{className:"w-3 h-3"}),new Date(u.date).toLocaleDateString("pt-BR")]})]}),u.comment&&e.jsxs("p",{className:`text-sm ${s?"text-gray-300":"text-gray-700"} mt-2`,children:['"',u.comment,'"']}),u.order_code&&e.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:["Pedido #",u.order_code]})]},E))}),e.jsx("div",{className:`p-4 border-t ${s?"bg-gray-750 border-gray-700":"bg-gray-50 border-gray-200"} text-center`,children:e.jsx("p",{className:"text-xs text-gray-500",children:"Continue fazendo um √≥timo trabalho para receber mais avalia√ß√µes positivas! üåü"})})]})})}function mr({entregadores:t,orders:a,stores:s=[]}){const n=Array.isArray(a)?a:[],c=Array.isArray(t)?t:[],[l,d]=o.useState("list"),[m,u]=o.useState(null),[E,N]=o.useState(!1),[r,C]=o.useState(null),[R,$]=o.useState(!1),[T,j]=o.useState(!1),[P,f]=o.useState(!1),[w,I]=o.useState(null),[i,A]=o.useState(!1),[v,D]=o.useState(null),[S,p]=o.useState(!1),M=Le(),{data:q=[]}=ke({queryKey:["entregadorRatings"],queryFn:()=>Q.entities.DeliveryRating.list()}),H=h=>{const g=q.filter(J=>J.entregador_id===h&&J.rated_by==="customer");return g.length===0?null:(g.reduce((J,te)=>J+te.rating,0)/g.length).toFixed(1)},re=h=>a.filter(g=>g.entregador_id===h&&g.status==="delivered"),ee=Ne({mutationFn:async({orderId:h,entregadorId:g})=>{const Y=a.find(te=>te.id===h),J=t.find(te=>te.id===g);await Q.entities.Order.update(h,{...Y,entregador_id:g,status:"out_for_delivery"}),await Q.entities.Entregador.update(g,{...J,status:"busy",current_order_id:h})},onSuccess:()=>{M.invalidateQueries({queryKey:["gestorOrders"]}),M.invalidateQueries({queryKey:["entregadores"]}),ze.success("Entregador atribu√≠do com sucesso!")}}),ne=c.filter(h=>h.status==="available"),ie=c.filter(h=>h.status==="busy"),Z=n.filter(h=>h.status==="ready"&&h.delivery_method==="delivery"),[b,z]=o.useState({name:"",phone:"",email:""}),V=h=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(h||0),U=Ne({mutationFn:h=>Q.entities.Entregador.create({...h,status:"offline",total_deliveries:0,total_earnings:0,rating:5}),onSuccess:()=>{M.invalidateQueries({queryKey:["entregadores"]}),p(!1),z({name:"",phone:"",email:""}),ze.success("Entregador cadastrado com sucesso!")}}),G=Ne({mutationFn:async({id:h,data:g})=>{const Y=t.find(J=>J.id===h);return await Q.entities.Entregador.update(h,{...Y,...g})},onSuccess:()=>{M.invalidateQueries({queryKey:["entregadores"]}),D(null),ze.success("Entregador atualizado!")}});return Ne({mutationFn:h=>Q.entities.Entregador.delete(h),onSuccess:()=>{M.invalidateQueries({queryKey:["entregadores"]}),ze.success("Entregador removido!")}}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-green-50 to-green-100 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-green-700 font-medium",children:"Dispon√≠veis"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:ne.length})]}),e.jsx("div",{className:"w-10 h-10 bg-green-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xl",children:"‚úì"})})]})}),e.jsx("div",{className:"bg-gradient-to-br from-yellow-50 to-yellow-100 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-yellow-700 font-medium",children:"Em entrega"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:ie.length})]}),e.jsx("div",{className:"w-10 h-10 bg-yellow-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xl",children:"üö¥"})})]})}),e.jsx("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100 border border-orange-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-orange-700 font-medium",children:"Aguardando"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:Z.length})]}),e.jsx("div",{className:"w-10 h-10 bg-orange-500 rounded-full flex items-center justify-center",children:e.jsx(be,{className:"w-5 h-5 text-white"})})]})})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white rounded-lg p-1 border w-fit",children:[e.jsxs(_,{size:"sm",variant:l==="map"?"default":"ghost",onClick:()=>d("map"),className:l==="map"?"bg-orange-500 hover:bg-orange-600":"",children:[e.jsx(Ua,{className:"w-4 h-4 mr-1"}),"Mapa ao Vivo"]}),e.jsxs(_,{size:"sm",variant:l==="list"?"default":"ghost",onClick:()=>d("list"),className:l==="list"?"bg-orange-500 hover:bg-orange-600":"",children:[e.jsx(Va,{className:"w-4 h-4 mr-1"}),"Lista"]})]}),l==="map"&&e.jsxs("div",{className:"grid lg:grid-cols-3 gap-4",children:[e.jsx("div",{className:"lg:col-span-2 h-[400px] min-h-[300px] lg:h-[480px] rounded-xl overflow-hidden border border-gray-200",children:e.jsx(cr,{orders:a,entregadores:t,stores:s,onSelectOrder:u,onSelectEntregador:h=>{const g=a.find(Y=>Y.id===h.current_order_id);g&&u(g)},darkMode:!1})}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"bg-white border rounded-lg p-3",children:[e.jsxs("h4",{className:"font-semibold text-sm mb-2 flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4 text-orange-500"}),"Pedidos Prontos (",Z.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-[450px] overflow-y-auto",children:Z.slice(0,10).map(h=>e.jsxs("div",{className:"bg-gray-50 p-2 rounded text-xs",children:[e.jsxs("p",{className:"font-bold text-gray-900",children:["#",h.order_code]}),e.jsx("p",{className:"text-gray-600",children:h.customer_name}),e.jsxs(_,{size:"sm",onClick:()=>{u(h),N(!0)},className:"w-full mt-2 h-7 text-xs bg-orange-500 hover:bg-orange-600",children:[e.jsx(pt,{className:"w-3 h-3 mr-1"}),"Atribuir"]})]},h.id))})]})})]}),l==="list"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-end mb-3",children:e.jsxs(_,{onClick:()=>p(!0),className:"bg-orange-500 hover:bg-orange-600",children:[e.jsx(Pt,{className:"w-4 h-4 mr-2"}),"Novo Entregador"]})}),t.length===0?e.jsxs("div",{className:"bg-white rounded-xl p-12 text-center border",children:[e.jsx(st,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Nenhum entregador cadastrado"}),e.jsxs(_,{onClick:()=>p(!0),className:"bg-orange-500 hover:bg-orange-600",children:[e.jsx(Pt,{className:"w-4 h-4 mr-2"}),"Cadastrar Primeiro Entregador"]})]}):e.jsx("div",{className:"grid gap-3",children:t.map(h=>{const g=h.current_order_id?a.find(te=>te.id===h.current_order_id):null,Y=re(h.id),J=H(h.id);return e.jsxs("div",{className:"bg-white rounded-lg border p-5",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[h.photo?e.jsx("img",{src:h.photo,alt:h.name,className:"w-12 h-12 rounded-full object-cover"}):e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${h.status==="available"?"bg-green-100":h.status==="busy"?"bg-yellow-100":"bg-gray-100"}`,children:e.jsx(st,{className:`w-6 h-6 ${h.status==="available"?"text-green-600":h.status==="busy"?"text-yellow-600":"text-gray-400"}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-base",children:h.name}),e.jsxs("div",{className:"flex flex-col gap-0.5 mt-0.5",children:[e.jsxs("span",{className:"text-xs text-gray-600 flex items-center gap-1",children:[e.jsx(xs,{className:"w-3 h-3"}),h.phone]}),h.email&&e.jsxs("span",{className:"text-xs text-gray-600 flex items-center gap-1",children:[e.jsx(ua,{className:"w-3 h-3"}),h.email]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:`text-[10px] h-5 ${h.status==="available"?"bg-green-500":h.status==="busy"?"bg-yellow-500":"bg-gray-500"}`,children:h.status==="available"?"Online":h.status==="busy"?"Ocupado":"Offline"}),e.jsx(_,{size:"icon",variant:"ghost",onClick:()=>D(h),className:"h-7 w-7",children:e.jsx(ha,{className:"w-3.5 h-3.5"})})]})]}),e.jsxs("div",{className:"grid grid-cols-5 gap-2 mb-3",children:[e.jsxs("div",{className:"bg-blue-50 rounded-md p-2 text-center",children:[e.jsx(be,{className:"w-4 h-4 mx-auto mb-0.5 text-blue-600"}),e.jsx("p",{className:"text-lg font-bold text-blue-700",children:h.total_deliveries||0}),e.jsx("p",{className:"text-[9px] text-gray-600",children:"Entregas"})]}),e.jsxs("div",{className:"bg-yellow-50 rounded-md p-2 text-center",children:[e.jsx(Fe,{className:"w-4 h-4 mx-auto mb-0.5 text-yellow-500"}),e.jsx("p",{className:"text-lg font-bold text-yellow-600",children:J||"5.0"}),e.jsx("p",{className:"text-[9px] text-gray-600",children:"Nota"})]}),e.jsxs("div",{className:"bg-green-50 rounded-md p-2 text-center",children:[e.jsx(ge,{className:"w-4 h-4 mx-auto mb-0.5 text-green-600"}),e.jsx("p",{className:"text-lg font-bold text-green-700",children:Y.length}),e.jsx("p",{className:"text-[9px] text-gray-600",children:"Hoje"})]}),e.jsxs("div",{className:"bg-purple-50 rounded-md p-2 text-center",children:[e.jsx(st,{className:"w-4 h-4 mx-auto mb-0.5 text-purple-600"}),e.jsx("p",{className:"text-base font-bold text-purple-700",children:h.vehicle_type==="bike"?"üö¥":h.vehicle_type==="motorcycle"?"üèçÔ∏è":h.vehicle_type==="car"?"üöó":"N/A"}),e.jsx("p",{className:"text-[9px] text-gray-600",children:"Ve√≠culo"})]}),e.jsxs("div",{className:"bg-orange-50 rounded-md p-2 text-center",children:[e.jsx(Re,{className:"w-4 h-4 mx-auto mb-0.5 text-orange-600"}),e.jsx("p",{className:"text-xs font-bold text-orange-700",children:V(h.total_earnings||0)}),e.jsx("p",{className:"text-[9px] text-gray-600",children:"Ganhos"})]})]}),g&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-2.5 mb-3",children:[e.jsxs("p",{className:"font-semibold text-blue-900 mb-1 text-xs flex items-center gap-1",children:[e.jsx(be,{className:"w-3.5 h-3.5"}),"Em entrega agora:"]}),e.jsxs("p",{className:"text-xs text-blue-700 font-medium",children:["#",g.order_code," ‚Ä¢ ",g.customer_name]}),e.jsx("p",{className:"text-[10px] text-blue-600 truncate",children:g.address})]}),Y.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("h4",{className:"font-semibold text-xs text-gray-600 mb-1.5",children:"√öltimas 3 entregas"}),e.jsx("div",{className:"space-y-1",children:Y.slice(0,3).map(te=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 rounded-md p-1.5 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[e.jsx(ge,{className:"w-3 h-3 text-green-500 flex-shrink-0"}),e.jsxs("span",{className:"font-medium truncate",children:["#",te.order_code]})]}),e.jsx("span",{className:"text-[10px] text-gray-500 flex-shrink-0",children:te.delivered_at&&Mt(new Date(te.delivered_at),"HH:mm")})]},te.id))})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-1.5",children:[e.jsxs(_,{size:"sm",variant:"outline",onClick:()=>{C(h),$(!0)},className:"text-xs h-8",children:[e.jsx(lt,{className:"w-3.5 h-3.5 mr-1"}),"Msg"]}),e.jsxs(_,{size:"sm",variant:"outline",onClick:()=>{C(h),j(!0)},className:"text-xs h-8",children:[e.jsx(Fe,{className:"w-3.5 h-3.5 mr-1"}),"Avaliar"]}),e.jsxs(_,{size:"sm",variant:"outline",onClick:()=>{C(h),A(!0)},className:"text-xs h-8",children:[e.jsx(ms,{className:"w-3.5 h-3.5 mr-1"}),"Notas"]})]}),g&&e.jsxs(_,{size:"sm",onClick:()=>{C(h),u(g),$(!0)},className:"w-full bg-blue-500 hover:bg-blue-600 text-xs h-8 mt-1.5",children:[e.jsx(Ie,{className:"w-3.5 h-3.5 mr-1"}),"Ver Entrega Ativa"]})]},h.id)})})]}),E&&m&&e.jsx(sr,{isOpen:E,onClose:()=>{N(!1),u(null)},order:m,entregadores:t,onAssign:(h,g)=>ee.mutate({orderId:h,entregadorId:g})}),R&&r&&e.jsx(ar,{isOpen:R,onClose:()=>{$(!1),C(null)},entregador:r}),T&&r&&e.jsx(rr,{isOpen:T,onClose:()=>{j(!1),C(null)},entregador:r,orderId:r.current_order_id}),P&&r&&e.jsx(ir,{isOpen:P,onClose:()=>{f(!1),C(null)},entregador:r,orders:a}),i&&r&&e.jsx(dr,{entregador:r,onClose:()=>{A(!1),C(null)},darkMode:!1}),e.jsx(ye,{open:S,onOpenChange:p,children:e.jsxs(je,{className:"max-w-md","aria-describedby":void 0,children:[e.jsx(Ye,{children:e.jsx(ve,{children:"Novo Entregador"})}),e.jsxs("form",{onSubmit:h=>{h.preventDefault(),U.mutate(b)},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(X,{htmlFor:"name",children:"Nome *"}),e.jsx(ue,{id:"name",value:b.name,onChange:h=>z({...b,name:h.target.value}),placeholder:"Nome completo",required:!0})]}),e.jsxs("div",{children:[e.jsx(X,{htmlFor:"phone",children:"Telefone *"}),e.jsx(ue,{id:"phone",value:b.phone,onChange:h=>z({...b,phone:h.target.value}),placeholder:"(00) 00000-0000",required:!0})]}),e.jsxs("div",{children:[e.jsx(X,{htmlFor:"email",children:"Email (opcional)"}),e.jsx(ue,{id:"email",type:"email",value:b.email,onChange:h=>z({...b,email:h.target.value}),placeholder:"email@exemplo.com"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(_,{type:"button",variant:"outline",onClick:()=>p(!1),className:"flex-1",children:"Cancelar"}),e.jsx(_,{type:"submit",className:"flex-1 bg-orange-500 hover:bg-orange-600",children:"Cadastrar"})]})]})]})}),v&&e.jsx(ye,{open:!!v,onOpenChange:()=>D(null),children:e.jsxs(je,{className:"max-w-md","aria-describedby":void 0,children:[e.jsx(Ye,{children:e.jsx(ve,{children:"Editar Entregador"})}),e.jsxs("form",{onSubmit:h=>{h.preventDefault(),G.mutate({id:v.id,data:v})},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(X,{htmlFor:"edit_name",children:"Nome *"}),e.jsx(ue,{id:"edit_name",value:v.name,onChange:h=>D({...v,name:h.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(X,{htmlFor:"edit_phone",children:"Telefone *"}),e.jsx(ue,{id:"edit_phone",value:v.phone,onChange:h=>D({...v,phone:h.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(X,{htmlFor:"edit_email",children:"Email"}),e.jsx(ue,{id:"edit_email",type:"email",value:v.email||"",onChange:h=>D({...v,email:h.target.value})})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(_,{type:"button",variant:"outline",onClick:()=>D(null),className:"flex-1",children:"Cancelar"}),e.jsx(_,{type:"submit",className:"flex-1 bg-orange-500 hover:bg-orange-600",children:"Salvar"})]})]})]})})]})}var fs=["PageUp","PageDown"],bs=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],ys={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},We="Slider",[Ot,xr,ur]=fa(We),[js]=pa(We,[ur]),[hr,ft]=js(We),vs=o.forwardRef((t,a)=>{const{name:s,min:n=0,max:c=100,step:l=1,orientation:d="horizontal",disabled:m=!1,minStepsBetweenThumbs:u=0,defaultValue:E=[n],value:N,onValueChange:r=()=>{},onValueCommit:C=()=>{},inverted:R=!1,form:$,...T}=t,j=o.useRef(new Set),P=o.useRef(0),w=d==="horizontal"?gr:pr,[I=[],i]=ga({prop:N,defaultProp:E,onChange:M=>{[...j.current][P.current]?.focus(),r(M)}}),A=o.useRef(I);function v(M){const q=vr(I,M);p(M,q)}function D(M){p(M,P.current)}function S(){const M=A.current[P.current];I[P.current]!==M&&C(I)}function p(M,q,{commit:H}={commit:!1}){const re=Cr(l),ee=Sr(Math.round((M-n)/l)*l+n,re),ne=ls(ee,[n,c]);i((ie=[])=>{const Z=yr(ie,ne,q);if(_r(Z,u*l)){P.current=Z.indexOf(ne);const b=String(Z)!==String(ie);return b&&H&&C(Z),b?Z:ie}else return ie})}return e.jsx(hr,{scope:t.__scopeSlider,name:s,disabled:m,min:n,max:c,valueIndexToChangeRef:P,thumbs:j.current,values:I,orientation:d,form:$,children:e.jsx(Ot.Provider,{scope:t.__scopeSlider,children:e.jsx(Ot.Slot,{scope:t.__scopeSlider,children:e.jsx(w,{"aria-disabled":m,"data-disabled":m?"":void 0,...T,ref:a,onPointerDown:Ue(T.onPointerDown,()=>{m||(A.current=I)}),min:n,max:c,inverted:R,onSlideStart:m?void 0:v,onSlideMove:m?void 0:D,onSlideEnd:m?void 0:S,onHomeKeyDown:()=>!m&&p(n,0,{commit:!0}),onEndKeyDown:()=>!m&&p(c,I.length-1,{commit:!0}),onStepKeyDown:({event:M,direction:q})=>{if(!m){const ee=fs.includes(M.key)||M.shiftKey&&bs.includes(M.key)?10:1,ne=P.current,ie=I[ne],Z=l*ee*q;p(ie+Z,ne,{commit:!0})}}})})})})});vs.displayName=We;var[Ns,ws]=js(We,{startEdge:"left",endEdge:"right",size:"width",direction:1}),gr=o.forwardRef((t,a)=>{const{min:s,max:n,dir:c,inverted:l,onSlideStart:d,onSlideMove:m,onSlideEnd:u,onStepKeyDown:E,...N}=t,[r,C]=o.useState(null),R=Je(a,w=>C(w)),$=o.useRef(void 0),T=ba(c),j=T==="ltr",P=j&&!l||!j&&l;function f(w){const I=$.current||r.getBoundingClientRect(),i=[0,I.width],v=Ft(i,P?[s,n]:[n,s]);return $.current=I,v(w-I.left)}return e.jsx(Ns,{scope:t.__scopeSlider,startEdge:P?"left":"right",endEdge:P?"right":"left",direction:P?1:-1,size:"width",children:e.jsx(_s,{dir:T,"data-orientation":"horizontal",...N,ref:R,style:{...N.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:w=>{const I=f(w.clientX);d?.(I)},onSlideMove:w=>{const I=f(w.clientX);m?.(I)},onSlideEnd:()=>{$.current=void 0,u?.()},onStepKeyDown:w=>{const i=ys[P?"from-left":"from-right"].includes(w.key);E?.({event:w,direction:i?-1:1})}})})}),pr=o.forwardRef((t,a)=>{const{min:s,max:n,inverted:c,onSlideStart:l,onSlideMove:d,onSlideEnd:m,onStepKeyDown:u,...E}=t,N=o.useRef(null),r=Je(a,N),C=o.useRef(void 0),R=!c;function $(T){const j=C.current||N.current.getBoundingClientRect(),P=[0,j.height],w=Ft(P,R?[n,s]:[s,n]);return C.current=j,w(T-j.top)}return e.jsx(Ns,{scope:t.__scopeSlider,startEdge:R?"bottom":"top",endEdge:R?"top":"bottom",size:"height",direction:R?1:-1,children:e.jsx(_s,{"data-orientation":"vertical",...E,ref:r,style:{...E.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:T=>{const j=$(T.clientY);l?.(j)},onSlideMove:T=>{const j=$(T.clientY);d?.(j)},onSlideEnd:()=>{C.current=void 0,m?.()},onStepKeyDown:T=>{const P=ys[R?"from-bottom":"from-top"].includes(T.key);u?.({event:T,direction:P?-1:1})}})})}),_s=o.forwardRef((t,a)=>{const{__scopeSlider:s,onSlideStart:n,onSlideMove:c,onSlideEnd:l,onHomeKeyDown:d,onEndKeyDown:m,onStepKeyDown:u,...E}=t,N=ft(We,s);return e.jsx(ot.span,{...E,ref:a,onKeyDown:Ue(t.onKeyDown,r=>{r.key==="Home"?(d(r),r.preventDefault()):r.key==="End"?(m(r),r.preventDefault()):fs.concat(bs).includes(r.key)&&(u(r),r.preventDefault())}),onPointerDown:Ue(t.onPointerDown,r=>{const C=r.target;C.setPointerCapture(r.pointerId),r.preventDefault(),N.thumbs.has(C)?C.focus():n(r)}),onPointerMove:Ue(t.onPointerMove,r=>{r.target.hasPointerCapture(r.pointerId)&&c(r)}),onPointerUp:Ue(t.onPointerUp,r=>{const C=r.target;C.hasPointerCapture(r.pointerId)&&(C.releasePointerCapture(r.pointerId),l(r))})})}),Cs="SliderTrack",Ss=o.forwardRef((t,a)=>{const{__scopeSlider:s,...n}=t,c=ft(Cs,s);return e.jsx(ot.span,{"data-disabled":c.disabled?"":void 0,"data-orientation":c.orientation,...n,ref:a})});Ss.displayName=Cs;var At="SliderRange",ks=o.forwardRef((t,a)=>{const{__scopeSlider:s,...n}=t,c=ft(At,s),l=ws(At,s),d=o.useRef(null),m=Je(a,d),u=c.values.length,E=c.values.map(C=>Ds(C,c.min,c.max)),N=u>1?Math.min(...E):0,r=100-Math.max(...E);return e.jsx(ot.span,{"data-orientation":c.orientation,"data-disabled":c.disabled?"":void 0,...n,ref:m,style:{...t.style,[l.startEdge]:N+"%",[l.endEdge]:r+"%"}})});ks.displayName=At;var Rt="SliderThumb",Es=o.forwardRef((t,a)=>{const s=xr(t.__scopeSlider),[n,c]=o.useState(null),l=Je(a,m=>c(m)),d=o.useMemo(()=>n?s().findIndex(m=>m.ref.current===n):-1,[s,n]);return e.jsx(fr,{...t,ref:l,index:d})}),fr=o.forwardRef((t,a)=>{const{__scopeSlider:s,index:n,name:c,...l}=t,d=ft(Rt,s),m=ws(Rt,s),[u,E]=o.useState(null),N=Je(a,f=>E(f)),r=u?d.form||!!u.closest("form"):!0,C=Gs(u),R=d.values[n],$=R===void 0?0:Ds(R,d.min,d.max),T=jr(n,d.values.length),j=C?.[m.size],P=j?Nr(j,$,m.direction):0;return o.useEffect(()=>{if(u)return d.thumbs.add(u),()=>{d.thumbs.delete(u)}},[u,d.thumbs]),e.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[m.startEdge]:`calc(${$}% + ${P}px)`},children:[e.jsx(Ot.ItemSlot,{scope:t.__scopeSlider,children:e.jsx(ot.span,{role:"slider","aria-label":t["aria-label"]||T,"aria-valuemin":d.min,"aria-valuenow":R,"aria-valuemax":d.max,"aria-orientation":d.orientation,"data-orientation":d.orientation,"data-disabled":d.disabled?"":void 0,tabIndex:d.disabled?void 0:0,...l,ref:N,style:R===void 0?{display:"none"}:t.style,onFocus:Ue(t.onFocus,()=>{d.valueIndexToChangeRef.current=n})})}),r&&e.jsx(Ms,{name:c??(d.name?d.name+(d.values.length>1?"[]":""):void 0),form:d.form,value:R},n)]})});Es.displayName=Rt;var br="RadioBubbleInput",Ms=o.forwardRef(({__scopeSlider:t,value:a,...s},n)=>{const c=o.useRef(null),l=Je(c,n),d=Ys(a);return o.useEffect(()=>{const m=c.current;if(!m)return;const u=window.HTMLInputElement.prototype,N=Object.getOwnPropertyDescriptor(u,"value").set;if(d!==a&&N){const r=new Event("input",{bubbles:!0});N.call(m,a),m.dispatchEvent(r)}},[d,a]),e.jsx(ot.input,{style:{display:"none"},...s,ref:l,defaultValue:a})});Ms.displayName=br;function yr(t=[],a,s){const n=[...t];return n[s]=a,n.sort((c,l)=>c-l)}function Ds(t,a,s){const l=100/(s-a)*(t-a);return ls(l,[0,100])}function jr(t,a){return a>2?`Value ${t+1} of ${a}`:a===2?["Minimum","Maximum"][t]:void 0}function vr(t,a){if(t.length===1)return 0;const s=t.map(c=>Math.abs(c-a)),n=Math.min(...s);return s.indexOf(n)}function Nr(t,a,s){const n=t/2,l=Ft([0,50],[0,n]);return(n-l(a)*s)*s}function wr(t){return t.slice(0,-1).map((a,s)=>t[s+1]-a)}function _r(t,a){if(a>0){const s=wr(t);return Math.min(...s)>=a}return!0}function Ft(t,a){return s=>{if(t[0]===t[1]||a[0]===a[1])return a[0];const n=(a[1]-a[0])/(t[1]-t[0]);return a[0]+n*(s-t[0])}}function Cr(t){return(String(t).split(".")[1]||"").length}function Sr(t,a){const s=Math.pow(10,a);return Math.round(t*s)/s}var Ps=vs,kr=Ss,Er=ks,Mr=Es;const Os=o.forwardRef(({className:t,...a},s)=>e.jsxs(Ps,{ref:s,className:$s("relative flex w-full touch-none select-none items-center",t),...a,children:[e.jsx(kr,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:e.jsx(Er,{className:"absolute h-full bg-primary"})}),e.jsx(Mr,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]}));Os.displayName=Ps.displayName;const Ge=[{id:"phone_classic",name:"Som 1 - Telefone",url:"https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"},{id:"phone_urgent",name:"Som 2 - Urgente",url:"https://assets.mixkit.co/active_storage/sfx/2354/2354-preview.mp3"},{id:"phone_retro",name:"Som 3 - Retr√¥",url:"https://assets.mixkit.co/active_storage/sfx/2871/2871-preview.mp3"},{id:"beep_short",name:"Som 4 - Bip curto",url:"https://assets.mixkit.co/active_storage/sfx/2356/2356-preview.mp3"},{id:"beep_long",name:"Som 5 - Bip longo",url:"https://assets.mixkit.co/active_storage/sfx/2357/2357-preview.mp3"},{id:"electronic_ping",name:"Som 6 - Ping",url:"https://assets.mixkit.co/active_storage/sfx/2363/2363-preview.mp3"},{id:"ifood_01",name:"Som 7",url:"https://assets.mixkit.co/active_storage/sfx/2870/2870-preview.mp3"},{id:"ifood_02",name:"Som 8",url:"https://assets.mixkit.co/active_storage/sfx/2872/2872-preview.mp3"}],Dr="gestor_notification_config";function As(t,a=null){return t==="custom"&&a?a:Ge.find(s=>s.id===t)?.url||Ge[0].url}function Pr(){try{const t=localStorage.getItem(Dr);if(!t)return{url:Ge[0].url,volume:.8};const a=JSON.parse(t);if(a.soundEnabled===!1)return{url:Ge[0].url,volume:0};const s=a.soundNewOrder||a.selectedSound||"phone_classic",n=(a.soundVolume??a.volume??80)/100;return{url:As(s,a.customSoundUrl),volume:n}}catch{return{url:Ge[0].url,volume:.8}}}const $t="gestor_notification_config",Tt={soundEnabled:!0,soundNewOrder:"phone_classic",soundVolume:80,soundAutoAccept:!0,soundProblemsInactivity:!0,soundNewMessages:!0};function Rs(){try{const t=localStorage.getItem($t);if(!t)return{...Tt};const a=JSON.parse(t);return{soundEnabled:a.soundEnabled!==!1,soundNewOrder:a.soundNewOrder||a.selectedSound||"phone_classic",soundVolume:a.soundVolume??a.volume??80,soundAutoAccept:a.soundAutoAccept!==!1,soundProblemsInactivity:a.soundProblemsInactivity!==!1,soundNewMessages:a.soundNewMessages!==!1}}catch{return{...Tt}}}function Or(t){try{const s={...Rs(),...t},n=localStorage.getItem($t),c=n?{...JSON.parse(n),...s}:s;localStorage.setItem($t,JSON.stringify(c)),window.dispatchEvent(new CustomEvent("gestorNotificationConfigUpdated",{detail:c}))}catch{}}function tt({url:t,volume:a=.8,disabled:s,className:n}){const[c,l]=o.useState(!1),d=o.useCallback(()=>{if(!t)return;l(!0);const m=new Audio(t);m.volume=a,m.play().catch(()=>{}).finally(()=>l(!1)),m.onended=()=>l(!1)},[t,a]);return e.jsxs(_,{type:"button",variant:"outline",size:"sm",className:`h-8 gap-1 ${n||""}`,onClick:d,disabled:s||c,children:[e.jsx(ya,{className:"w-3.5 h-3.5"}),c?"...":"Ouvir"]})}function Ar(){const[t,a]=o.useState(Tt);o.useEffect(()=>{a(Rs())},[]);const s=l=>{a(d=>({...d,...l})),Or(l)},n=t.soundVolume/100,c=As(t.soundNewOrder);return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Alertas de som"}),e.jsx("p",{className:"text-sm text-gray-500 mt-0.5",children:"Configure os sons para cada tipo de evento."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Recebimento de pedidos"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx(X,{className:"text-sm font-medium text-gray-900",children:"Pedido recebido"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Som ao chegar um novo pedido"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs(Ee,{value:t.soundNewOrder,onValueChange:l=>s({soundNewOrder:l}),children:[e.jsx(Me,{className:"w-[140px] h-9 text-sm",children:e.jsx(De,{})}),e.jsx(Pe,{children:Ge.slice(0,8).map(l=>e.jsx(de,{value:l.id,children:l.name},l.id))})]}),e.jsx(tt,{url:c,volume:n})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx(X,{className:"text-sm font-medium text-gray-900",children:"Pedidos com aceite autom√°tico"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Tocar som quando o pedido for aceito automaticamente"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(tt,{url:t.soundAutoAccept?c:null,volume:n,disabled:!t.soundAutoAccept}),e.jsx(Oe,{checked:t.soundAutoAccept,onCheckedChange:l=>s({soundAutoAccept:l})})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx(X,{className:"text-sm font-medium text-gray-900",children:"Volume"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Volume geral dos alertas de pedidos"})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0 min-w-[200px]",children:[e.jsx(Os,{value:[t.soundVolume],onValueChange:([l])=>s({soundVolume:l}),max:100,step:5,className:"flex-1"}),e.jsxs("span",{className:"text-sm font-medium text-gray-600 w-10",children:[t.soundVolume,"%"]}),e.jsx(tt,{url:c,volume:n})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Situa√ß√µes com a loja"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx(X,{className:"text-sm font-medium text-gray-900",children:"Problemas com pedidos ou inatividade"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Alerta quando houver pend√™ncias ou inatividade (ex.: Est√° a√≠?)"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(tt,{url:t.soundProblemsInactivity?c:null,volume:n,disabled:!t.soundProblemsInactivity}),e.jsx(Oe,{checked:t.soundProblemsInactivity,onCheckedChange:l=>s({soundProblemsInactivity:l})})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx(X,{className:"text-sm font-medium text-gray-900",children:"Novas mensagens"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Som ao chegar nova mensagem do cliente"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(tt,{url:t.soundNewMessages?c:null,volume:n,disabled:!t.soundNewMessages}),e.jsx(Oe,{checked:t.soundNewMessages,onCheckedChange:l=>s({soundNewMessages:l})})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-orange-50 border border-orange-100 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(us,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx(X,{className:"text-sm font-medium text-gray-900",children:"Sons ativados"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Desative para silenciar todos os alertas"})]})]}),e.jsx(Oe,{checked:t.soundEnabled,onCheckedChange:l=>s({soundEnabled:l})})]})]})}const ss=[{id:"alertas",label:"Alertas de som",icon:it,group:"gestor"},{id:"logistica",label:"Gest√£o Log√≠stica",icon:Ae,group:"gestor"},{id:"impressao",label:"Impress√£o",icon:rt,group:"gestor"},{id:"templates",label:"Templates de Mensagem",icon:lt,group:"gestor"},{id:"horarios",label:"Hor√°rios",icon:Re,group:"gestor"},{id:"lojas",label:"Gest√£o de lojas",icon:ja,group:"conta"},{id:"conta",label:"Minha conta",icon:hs,group:"conta"}];function Rr(){const[t,a]=o.useState("alertas"),[s,n]=o.useState({default_prep_time:30,can_alter_prep_per_order:!0,auto_print:!1,sound_notifications:!0,auto_accept:!1,are_you_there_enabled:!1,are_you_there_minutes:15,prep_time_manual_enabled:!0,auto_cancel_mode:"off",auto_cancel_minutes:10}),c=Le(),{data:l=[]}=ke({queryKey:["messageTemplates"],queryFn:()=>Q.entities.MessageTemplate.list()}),{data:d=[]}=ke({queryKey:["store"],queryFn:()=>Q.entities.Store.list()}),m=d[0];o.useEffect(()=>{try{const f=localStorage.getItem("gestorSettings");if(f){const w=JSON.parse(f);n(I=>({...I,...w}))}}catch{}},[]);const u=()=>{localStorage.setItem("gestorSettings",JSON.stringify(s)),F.success("Configura√ß√µes salvas!"),window.dispatchEvent(new CustomEvent("gestorSettingsUpdated",{detail:s}))},E=Ne({mutationFn:f=>Q.entities.MessageTemplate.create(f),onSuccess:()=>c.invalidateQueries({queryKey:["messageTemplates"]})}),N=Ne({mutationFn:f=>Q.entities.MessageTemplate.delete(f),onSuccess:()=>c.invalidateQueries({queryKey:["messageTemplates"]})}),[r,C]=o.useState({title:"",message:""}),R=()=>{!r.title||!r.message||(E.mutate(r),C({title:"",message:""}))},$=()=>{if(typeof Q?.auth?.logout=="function")Q.auth.logout();else try{localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/"}catch{window.location.href="/"}},T=ss.filter(f=>f.group==="gestor"),j=ss.filter(f=>f.group==="conta"),P=f=>`w-full flex items-center gap-2 px-3 py-2 rounded-r-md border-l-4 transition-all duration-200 text-left text-sm ${t===f?"border-orange-500 bg-orange-50 text-orange-600 font-medium":"border-transparent text-gray-600 hover:bg-gray-50"}`;return e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsx("aside",{className:"lg:w-56 flex-shrink-0",children:e.jsxs("nav",{className:"space-y-1",children:[e.jsx("p",{className:"px-3 py-1.5 text-[10px] font-semibold text-gray-400 uppercase tracking-wider",children:"Gestor de pedidos"}),T.map(({id:f,label:w,icon:I})=>e.jsxs("button",{onClick:()=>a(f),className:P(f),children:[e.jsx(I,{className:"w-4 h-4 flex-shrink-0"}),w]},f)),e.jsx("p",{className:"px-3 py-1.5 mt-4 text-[10px] font-semibold text-gray-400 uppercase tracking-wider",children:"Conta"}),j.map(({id:f,label:w,icon:I})=>e.jsxs("button",{onClick:()=>a(f),className:P(f),children:[e.jsx(I,{className:"w-4 h-4 flex-shrink-0"}),w]},f))]})}),e.jsxs("div",{className:"flex-1 min-w-0 bg-white border border-gray-200 rounded-lg p-5",children:[t==="alertas"&&e.jsx(Ar,{}),t==="logistica"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Gest√£o Log√≠stica"}),e.jsx("p",{className:"text-sm text-gray-500 mt-0.5",children:"Tempo de preparo e alertas de inatividade."})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx(X,{className:"text-sm font-medium text-gray-900",children:"Tempo de preparo manual"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Tempo estimado para preparar pedidos (minutos)"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(ue,{type:"number",min:5,max:120,value:s.default_prep_time,onChange:f=>n(w=>({...w,default_prep_time:parseInt(f.target.value)||30})),className:"w-20 h-9 text-center"}),e.jsx("span",{className:"text-sm text-gray-500",children:"min"}),e.jsx(Oe,{checked:s.prep_time_manual_enabled!==!1,onCheckedChange:f=>n(w=>({...w,prep_time_manual_enabled:f}))})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx(X,{className:"text-sm font-medium text-gray-900",children:"Permitir alterar por pedido"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Ao aceitar, poder alterar o tempo daquele pedido"})]}),e.jsx(Oe,{checked:s.can_alter_prep_per_order!==!1,onCheckedChange:f=>n(w=>({...w,can_alter_prep_per_order:f}))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx(X,{className:"text-sm font-medium text-gray-900",children:"Est√° a√≠? (alerta de inatividade)"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Ap√≥s N minutos sem intera√ß√£o, avisar"})]}),e.jsx(Oe,{checked:s.are_you_there_enabled===!0,onCheckedChange:f=>n(w=>({...w,are_you_there_enabled:f}))})]}),s.are_you_there_enabled&&e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx(X,{className:"text-sm font-medium text-gray-700",children:"Ap√≥s quantos minutos?"}),e.jsx("select",{value:s.are_you_there_minutes||15,onChange:f=>n(w=>({...w,are_you_there_minutes:parseInt(f.target.value)})),className:"border rounded-md px-2.5 py-1.5 text-sm w-28",children:[5,10,15,20,30,45,60].map(f=>e.jsxs("option",{value:f,children:[f," min"]},f))})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg space-y-3",children:[e.jsxs("div",{children:[e.jsx(X,{className:"text-sm font-medium text-gray-900",children:"Pedidos atrasados (ap√≥s tempo de preparo)"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Quando o pedido passar do tempo de preparo + margem, o que fazer?"})]}),e.jsxs("select",{value:s.auto_cancel_mode||"off",onChange:f=>n(w=>({...w,auto_cancel_mode:f.target.value})),className:"border rounded-md px-2.5 py-1.5 text-sm w-full max-w-xs",children:[e.jsx("option",{value:"off",children:"Desligado"}),e.jsx("option",{value:"alert",children:"S√≥ alertar (toast)"}),e.jsx("option",{value:"cancel",children:"Cancelar automaticamente"})]}),(s.auto_cancel_mode==="alert"||s.auto_cancel_mode==="cancel")&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"text-sm text-gray-700",children:"Margem ap√≥s o tempo de preparo (min):"}),e.jsx(ue,{type:"number",min:0,max:60,value:s.auto_cancel_minutes??10,onChange:f=>n(w=>({...w,auto_cancel_minutes:parseInt(f.target.value)||10})),className:"w-20 h-9 text-center"})]})]}),e.jsxs(_,{onClick:u,className:"bg-orange-500 hover:bg-orange-600",children:[e.jsx(ut,{className:"w-4 h-4 mr-2"})," Salvar"]})]}),t==="impressao"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Impress√£o"}),e.jsx("p",{className:"text-sm text-gray-500 mt-0.5",children:"Impressora e extens√£o para imprimir pedidos."})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx(X,{className:"text-sm font-medium text-gray-900",children:"Impress√£o autom√°tica"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Imprimir ao aceitar pedido"})]}),e.jsx(Oe,{checked:s.auto_print,onCheckedChange:f=>n(w=>({...w,auto_print:f}))})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[e.jsx(X,{className:"text-sm font-medium text-gray-900",children:"Extens√£o da impressora"}),e.jsx(ae,{variant:"outline",className:"bg-red-50 text-red-600 border-red-200",children:"Extens√£o fechada"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"A extens√£o permite enviar pedidos direto para a impressora. Informa√ß√£o atualizada a cada 30 segundos."}),e.jsx("a",{href:"#baixar-extensao",className:"text-sm font-medium text-orange-600 hover:underline",children:"Baixar extens√£o"})]}),e.jsxs(_,{onClick:u,className:"bg-orange-500 hover:bg-orange-600",children:[e.jsx(ut,{className:"w-4 h-4 mr-2"})," Salvar"]})]}),t==="templates"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Templates de Mensagem"}),e.jsx("p",{className:"text-sm text-gray-500 mt-0.5",children:"Respostas r√°pidas para clientes."})]}),e.jsx("div",{className:"space-y-2",children:l.map(f=>e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm text-gray-900 truncate",children:f.title}),e.jsx("p",{className:"text-xs text-gray-500 line-clamp-2",children:f.message})]}),e.jsx(_,{size:"icon",variant:"ghost",className:"h-8 w-8 text-red-500",onClick:()=>N.mutate(f.id),children:e.jsx(va,{className:"w-4 h-4"})})]},f.id))}),e.jsxs("div",{className:"border-t pt-4 space-y-2",children:[e.jsx(ue,{placeholder:"T√≠tulo",value:r.title,onChange:f=>C(w=>({...w,title:f.target.value}))}),e.jsx(Qe,{placeholder:"Mensagem",value:r.message,onChange:f=>C(w=>({...w,message:f.target.value})),className:"min-h-[80px]"}),e.jsxs(_,{onClick:R,variant:"outline",children:[e.jsx(Pt,{className:"w-4 h-4 mr-2"})," Adicionar"]})]})]}),t==="horarios"&&m&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Hor√°rio de Funcionamento"}),e.jsx("p",{className:"text-sm text-gray-500 mt-0.5",children:"Exibido no card√°pio e no gestor."})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-gray-600",children:"Abertura:"}),e.jsx("span",{className:"font-medium",children:m.opening_time||"08:00"})]}),e.jsxs("div",{className:"flex justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-gray-600",children:"Fechamento:"}),e.jsx("span",{className:"font-medium",children:m.closing_time||"18:00"})]}),e.jsxs("div",{className:"flex justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-gray-600",children:"Dias:"}),e.jsx("span",{className:"font-medium",children:(m.working_days||[1,2,3,4,5]).map(f=>["Dom","Seg","Ter","Qua","Qui","Sex","S√°b"][f]).join(", ")})]}),e.jsxs("div",{className:"flex justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx("span",{className:m.is_open?"text-green-600 font-medium":"text-red-600 font-medium",children:m.is_open?"Aberto":"Fechado"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Para alterar, acesse as configura√ß√µes da loja no painel administrativo."})]}),t==="lojas"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Gest√£o de lojas"}),e.jsx("p",{className:"text-sm text-gray-500 mt-0.5",children:"Recebimento e aceite de pedidos."})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx(X,{className:"text-sm font-medium text-gray-900",children:"Aceite autom√°tico de pedidos"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Aceitar e imprimir automaticamente. Configure a impressora em Ajustes > Impress√£o."})]}),e.jsx(Oe,{checked:s.auto_accept,onCheckedChange:f=>n(w=>({...w,auto_accept:f}))})]}),e.jsxs(_,{onClick:u,className:"bg-orange-500 hover:bg-orange-600",children:[e.jsx(ut,{className:"w-4 h-4 mr-2"})," Salvar"]})]}),t==="conta"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Minha conta"}),e.jsx("p",{className:"text-sm text-gray-500 mt-0.5",children:"Trocar de conta ou encerrar sess√£o."})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx(X,{className:"text-sm font-medium text-gray-900",children:"Trocar de conta"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Encerre a sess√£o para acessar com outra conta."}),e.jsxs("button",{type:"button",onClick:$,className:"mt-2 flex items-center gap-2 text-sm font-medium text-orange-600 hover:text-orange-700",children:[e.jsx(Na,{className:"w-4 h-4"})," Sair da conta"]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx(X,{className:"text-sm font-medium text-gray-900",children:"Sistema"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Use se a vers√£o antiga continuar em cache."}),e.jsx("button",{type:"button",onClick:async()=>{try{const f=await navigator.serviceWorker?.getRegistrations?.()||[];for(const w of f)await w.unregister();if("caches"in window){const w=await caches.keys();await Promise.all(w.filter(I=>I!=="meta-json").map(I=>caches.delete(I)))}F.success("Cache limpo. Recarregando..."),window.location.reload()}catch{F.error("Erro ao limpar cache")}},className:"mt-2 text-sm text-orange-600 hover:underline",children:"Limpar cache e recarregar"})]})]})]})]})}function $r({orders:t=[],entregadores:a=[],darkMode:s=!1}){const n=Array.isArray(t)?t:[],c=Array.isArray(a)?a:[],l=A=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(A||0),{todayOrders:d,yesterdayOrders:m,totalRevenue:u,pendingOrders:E,inDelivery:N,avgPrepTime:r,activeEntregadores:C,ticketMedio:R,stats:$,chartByHour:T,pieData:j,concludedOrdersCurrentMonth:P,concludedOrdersLastMonth:f,diffFromLastMonth:w}=o.useMemo(()=>{const A=new Date;A.setHours(0,0,0,0);const v=new Date(A);v.setDate(v.getDate()-1);const D=new Date(A);D.setDate(D.getDate()+1);const S=n.filter(y=>{const K=new Date(y.created_date);return K>=A&&K<D}),p=n.filter(y=>{const K=new Date(y.created_date);return K>=v&&K<A}),M=S.filter(y=>y.status==="delivered"),q=M.reduce((y,K)=>y+(K.total||0),0),H=M.length>0?q/M.length:0,re=n.filter(y=>["new","accepted","preparing"].includes(y.status)).length,ee=n.filter(y=>["out_for_delivery","going_to_store","picked_up"].includes(y.status)).length,ne=S.filter(y=>y.accepted_at&&y.ready_at),ie=ne.length>0?ne.reduce((y,K)=>y+(new Date(K.ready_at)-new Date(K.accepted_at))/6e4,0)/ne.length:0,Z=a.filter(y=>y.status==="available"||y.status==="busy").length,b=new Date,z=new Date(b.getFullYear(),b.getMonth(),1),V=new Date(b.getFullYear(),b.getMonth()-1,1),U=n.filter(y=>y.status!=="delivered"?!1:new Date(y.delivered_at||y.created_date)>=z).length,G=n.filter(y=>{if(y.status!=="delivered")return!1;const K=new Date(y.delivered_at||y.created_date);return K>=V&&K<z}).length,h=G>0?((U-G)/G*100).toFixed(1):null,g=p.length,Y=S.length,J=g>0?((Y-g)/g*100).toFixed(0):null,te=p.filter(y=>y.status==="delivered").reduce((y,K)=>y+(K.total||0),0),pe=te>0?((q-te)/te*100).toFixed(0):null,oe=[{label:"Pedidos Hoje",value:Y,icon:be,color:"blue",change:J!=null?`${Number(J)>=0?"+":""}${J}%`:null,trend:J!=null?Number(J)>=0?"up":"down":"neutral",subtitle:`${re} pendentes`},{label:"Receita Hoje",value:l(q),icon:nt,color:"green",change:pe!=null?`${Number(pe)>=0?"+":""}${pe}%`:null,trend:pe!=null?Number(pe)>=0?"up":"down":"neutral",subtitle:`${M.length} entregues`},{label:"Ticket M√©dio",value:l(H),icon:ds,color:"purple",change:null,trend:"neutral",subtitle:"Por pedido entregue"},{label:"Tempo M√©dio",value:`${Math.round(ie)}min`,icon:Re,color:"slate",change:null,trend:"neutral",subtitle:"Tempo de preparo"},{label:"Em Entrega",value:ee,icon:Ae,color:"orange",change:null,trend:"neutral",subtitle:`${Z} ativos`}],Ke=Array.from({length:24},(y,K)=>({hora:`${K}h`,quantidade:0}));S.forEach(y=>{const K=new Date(y.created_date).getHours();Ke[K].quantidade+=1});const W=Ke.map((y,K)=>({...y,name:`${K}:00`})),Ve=S.filter(y=>["new","accepted","preparing"].includes(y.status)).length,$e=S.filter(y=>["ready","going_to_store","arrived_at_store","picked_up"].includes(y.status)).length,x=S.filter(y=>["out_for_delivery","arrived_at_customer"].includes(y.status)).length,L=S.filter(y=>y.status==="delivered").length,B=[{name:"Em preparo",value:Ve,color:"#f97316"},{name:"Prontos",value:$e,color:"#22c55e"},{name:"Em rota",value:x,color:"#3b82f6"},{name:"Entregues",value:L,color:"#64748b"}].filter(y=>y.value>0);return{todayOrders:S,yesterdayOrders:p,totalRevenue:q,pendingOrders:re,inDelivery:ee,avgPrepTime:ie,activeEntregadores:Z,ticketMedio:H,stats:oe,chartByHour:W,pieData:B,concludedOrdersCurrentMonth:U,concludedOrdersLastMonth:G,diffFromLastMonth:h}},[n,c]),I={blue:s?"from-blue-900/50 to-blue-800/30 border-blue-700":"from-blue-50 to-blue-100 border-blue-200",green:s?"from-green-900/50 to-green-800/30 border-green-700":"from-green-50 to-green-100 border-green-200",purple:s?"from-purple-900/50 to-purple-800/30 border-purple-700":"from-purple-50 to-purple-100 border-purple-200",slate:s?"from-slate-900/50 to-slate-800/30 border-slate-700":"from-slate-50 to-slate-100 border-slate-200",orange:s?"from-orange-900/50 to-orange-800/30 border-orange-700":"from-orange-50 to-orange-100 border-orange-200"},i={blue:"text-blue-600",green:"text-green-600",purple:"text-purple-600",slate:"text-slate-600",orange:"text-orange-600"};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:`text-xl font-bold ${s?"text-white":"text-gray-900"}`,children:"Estat√≠sticas em Tempo Real"}),e.jsx("p",{className:`text-sm ${s?"text-gray-400":"text-gray-600"}`,children:"Vis√£o geral do desempenho de hoje"})]}),e.jsxs(ae,{className:"bg-green-500 text-white",children:[e.jsx(pt,{className:"w-3 h-3 mr-1"})," Ao vivo"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3",children:$.map((A,v)=>{const D=A.icon;return e.jsxs(Se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:v*.05},whileHover:{scale:1.02,y:-2},className:`bg-gradient-to-br ${I[A.color]} border rounded-2xl p-4 backdrop-blur-sm`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(D,{className:`w-5 h-5 ${i[A.color]}`}),A.trend!=="neutral"&&A.change&&e.jsx("span",{className:`text-xs font-medium ${A.trend==="up"?"text-green-600":"text-red-600"}`,children:A.change})]}),e.jsx("p",{className:`text-xl lg:text-2xl font-bold ${s?"text-white":"text-gray-900"} mb-1`,children:A.value}),e.jsx("p",{className:`text-xs ${s?"text-gray-400":"text-gray-600"} mb-1`,children:A.label}),A.subtitle&&e.jsx("p",{className:"text-[10px] text-gray-500",children:A.subtitle})]},A.label)})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs(Se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:`${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"} border rounded-2xl p-4`,children:[e.jsx("h3",{className:`font-bold mb-3 ${s?"text-white":"text-gray-900"}`,children:"Pedidos por hora (hoje)"}),e.jsx("div",{className:"h-[200px]",children:e.jsx(Gt,{width:"100%",height:"100%",children:e.jsxs(Zs,{data:T,margin:{top:5,right:5,left:-20,bottom:5},children:[e.jsx(ea,{dataKey:"hora",tick:{fontSize:10},stroke:s?"#9ca3af":"#6b7280"}),e.jsx(ta,{tick:{fontSize:10},stroke:s?"#9ca3af":"#6b7280",allowDecimals:!1}),e.jsx(Yt,{contentStyle:{fontSize:12,borderRadius:8},formatter:A=>[A,"Pedidos"]}),e.jsx(sa,{dataKey:"quantidade",fill:"#ef4444",radius:[4,4,0,0]})]})})})]}),e.jsxs(Se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.25},className:`${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"} border rounded-2xl p-4`,children:[e.jsx("h3",{className:`font-bold mb-3 ${s?"text-white":"text-gray-900"}`,children:"Status (hoje)"}),e.jsx("div",{className:"h-[200px]",children:j.length>0?e.jsx(Gt,{width:"100%",height:"100%",children:e.jsxs(aa,{children:[e.jsx(ra,{data:j,cx:"50%",cy:"50%",innerRadius:50,outerRadius:75,paddingAngle:2,dataKey:"value",children:j.map((A,v)=>e.jsx(na,{fill:A.color},v))}),e.jsx(Yt,{formatter:A=>[A,""]}),e.jsx(ia,{fontSize:11})]})}):e.jsx("div",{className:`flex items-center justify-center h-full ${s?"text-gray-500":"text-gray-400"}`,children:"Nenhum pedido hoje"})})]})]}),e.jsxs(Se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.25},className:`${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"} border rounded-2xl p-4`,children:[e.jsx("h3",{className:`font-bold mb-3 ${s?"text-white":"text-gray-900"}`,children:"Resumo do m√™s"}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:`text-2xl font-bold ${s?"text-white":"text-gray-900"}`,children:P}),e.jsx("span",{className:`text-sm ml-1 ${s?"text-gray-400":"text-gray-600"}`,children:"conclu√≠dos este m√™s"})]}),e.jsxs("div",{className:`text-sm ${s?"text-gray-400":"text-gray-600"}`,children:["M√™s anterior: ",e.jsx("span",{className:"font-medium",children:f})]}),w!=null&&e.jsxs("span",{className:`text-sm font-medium ${Number(w)>=0?"text-green-600":"text-red-600"}`,children:[Number(w)>=0?"+":"",w,"% em rela√ß√£o ao m√™s passado"]})]})]}),e.jsxs(Se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:`${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"} border rounded-2xl p-6`,children:[e.jsx("h3",{className:`font-bold text-lg mb-4 ${s?"text-white":"text-gray-900"}`,children:"Vis√£o Geral de Performance"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:`text-sm ${s?"text-gray-300":"text-gray-700"}`,children:"Taxa de Conclus√£o"}),e.jsxs("span",{className:`text-sm font-bold ${s?"text-white":"text-gray-900"}`,children:[d.length>0?(d.filter(A=>A.status==="delivered").length/d.length*100).toFixed(1):0,"%"]})]}),e.jsx(Ct,{value:d.filter(A=>A.status==="delivered").length/Math.max(1,d.length)*100,className:"h-2"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:`text-sm ${s?"text-gray-300":"text-gray-700"}`,children:"Entregadores Ativos"}),e.jsxs("span",{className:`text-sm font-bold ${s?"text-white":"text-gray-900"}`,children:[C," / ",a.length]})]}),e.jsx(Ct,{value:C/Math.max(1,a.length)*100,className:"h-2"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:`text-sm ${s?"text-gray-300":"text-gray-700"}`,children:"Pedidos Pendentes"}),e.jsx("span",{className:`text-sm font-bold ${s?"text-white":"text-gray-900"}`,children:E})]}),e.jsx(Ct,{value:Math.min(100,E/Math.max(1,d.length)*100),className:"h-2"})]})]})]})]})}const Tr=1e4,zr=25e3,Ir=35e3;function Fr(){(async()=>{try{const a=await navigator.serviceWorker?.getRegistrations?.()||[];for(const s of a)await s.unregister();if("caches"in window){const s=await caches.keys();await Promise.all(s.filter(n=>n!=="meta-json").map(n=>caches.delete(n)))}}catch{}window.location.reload()})()}function as(){const[t,a]=o.useState(0);return o.useEffect(()=>{const s=setTimeout(()=>a(1),Tr),n=setTimeout(()=>a(2),zr),c=setTimeout(()=>a(3),Ir);return()=>{clearTimeout(s),clearTimeout(n),clearTimeout(c)}},[]),e.jsxs("div",{className:"fixed inset-0 flex flex-col items-center justify-center bg-[#7a7775] z-[100]",children:[e.jsx("div",{className:"relative w-24 h-24 flex-shrink-0",children:e.jsxs("svg",{viewBox:"0 0 100 100",className:"w-full h-full","aria-hidden":"true",children:[e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"#f97316",strokeWidth:"7",strokeLinecap:"round",strokeDasharray:"70.69 70.69",style:{transformOrigin:"50px 50px",animation:"gestor-spin 1.7s linear infinite"}}),e.jsx("circle",{cx:"50",cy:"50",r:"37",fill:"none",stroke:"#ffedd5",strokeWidth:"7",strokeLinecap:"round",strokeDasharray:"58.12 58.12",strokeDashoffset:"39.27",style:{transformOrigin:"50px 50px",animation:"gestor-spin-rev 1.7s linear infinite"}})]})}),e.jsx("p",{className:"mt-4 text-white/90 text-sm",children:"Carregando Gestor de Pedidos..."}),e.jsxs("div",{className:"mt-6 text-center max-w-sm px-4",children:[t>=1&&e.jsx("p",{className:"text-[26px] font-bold text-white",children:"Isso est√° demorando mais que o esperado"}),t>=1&&t<2&&e.jsx("p",{className:"text-lg text-white/90 mt-1",children:"Estamos verificando o seu problema!"}),t>=2&&t<3&&e.jsx("p",{className:"text-lg text-white/90 mt-1",children:"Vamos reiniciar seu Gestor de Pedidos. Aguarde."}),t>=3&&e.jsx(_,{onClick:Fr,className:"rounded mt-4 bg-orange-500 hover:bg-orange-600 uppercase font-bold transition-all duration-100",children:"Recarregar"})]}),e.jsx("style",{children:`
        @keyframes gestor-spin { to { transform: rotate(360deg); } }
        @keyframes gestor-spin-rev { to { transform: rotate(-360deg); } }
        @media (prefers-reduced-motion: reduce) {
          [style*="animation: gestor-spin"] { animation: none; }
          [style*="animation: gestor-spin-rev"] { animation: none; }
        }
      `})]})}const Lr=[{id:"atalhos",title:"Atalhos de teclado",description:"K: Quadros | D: Entregadores | R: Resumo | S: Ajustes | H: In√≠cio | N: S√≥ novos | 1-5: Status no modal | Ctrl+F: Buscar | Ctrl+R: Atualizar | Esc: Fechar",backgroundColor:"#f97316",contentFontColor:"#ffffff",internalRoute:null,externalUrl:null,order:1},{id:"cancelar",title:"Como cancelar um pedido",description:"Abra o pedido, Rejeitar, escolha o motivo e confirme. S√≥ em status Novo ou Aceito.",backgroundColor:"#7C609B",contentFontColor:"#ffffff",internalRoute:null,externalUrl:null,order:2},{id:"comandas",title:"Impress√£o de comandas",description:'Use "Imprimir" no pedido ou "Na fila" e depois "Imprimir X comanda(s)" no bot√£o flutuante.',backgroundColor:"#059669",contentFontColor:"#ffffff",internalRoute:null,externalUrl:null,order:3},{id:"notificacoes",title:"Notifica√ß√µes",description:"Em Ajustes ‚Üí Notifica√ß√µes: escolha o som, volume e em quais status deseja ser avisado.",backgroundColor:"#2563eb",contentFontColor:"#ffffff",internalRoute:"settings",externalUrl:null,order:4},{id:"tempo-preparo",title:"Tempo de preparo",description:"Tempo padr√£o em Ajustes. Ao aceitar, voc√™ pode alterar por pedido. O sistema sugere pela m√©dia.",backgroundColor:"#c2410c",contentFontColor:"#ffffff",internalRoute:"settings",externalUrl:null,order:5}],qr={atalhos:qa,cancelar:Dt,comandas:rt,notificacoes:it,"tempo-preparo":Re};function Br({onNavigate:t}){return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Zt,{className:"w-5 h-5 text-orange-500"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Dicas e atalhos"})]}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:Lr.slice().sort((a,s)=>(a.order||0)-(s.order||0)).map(a=>{const s=qr[a.id]||Zt,n=()=>{a.internalRoute==="settings"&&t&&t("settings"),a.externalUrl&&window.open(a.externalUrl,"_blank")};return e.jsxs("button",{type:"button",onClick:n,className:"rounded-xl p-4 text-left transition hover:shadow-lg hover:scale-[1.02]",style:{backgroundColor:a.backgroundColor||"#f97316",color:a.contentFontColor||"#ffffff"},children:[e.jsx(s,{className:"w-6 h-6 mb-2 opacity-90"}),e.jsx("h3",{className:"font-bold text-sm mb-1",children:a.title}),e.jsx("p",{className:"text-xs opacity-90 leading-relaxed",children:a.description})]},a.id)})})]})}const kt="gestor_saved_filters",rs=[{value:"all",label:"Todos os Status"},{value:"new",label:"Novos"},{value:"accepted",label:"Aceitos"},{value:"preparing",label:"Em Preparo"},{value:"ready",label:"Prontos"},{value:"out_for_delivery",label:"Em Entrega"},{value:"delivered",label:"Entregues"},{value:"cancelled",label:"Cancelados"}],ns=[{value:"today",label:"Hoje"},{value:"week",label:"Esta Semana"},{value:"month",label:"Este M√™s"},{value:"all",label:"Todos"}],is=[{value:"all",label:"Qualquer hor√°rio"},{value:"11",label:"11h"},{value:"12",label:"12h"},{value:"13",label:"13h"},{value:"14",label:"14h"},{value:"18",label:"18h"},{value:"19",label:"19h"},{value:"20",label:"20h"},{value:"21",label:"21h"}];function Kr({orders:t=[],onFilterChange:a,searchTerm:s,onSearchChange:n,entregadores:c=[]}){const[l,d]=o.useState(!1),[m,u]=o.useState([]),[E,N]=o.useState(""),[r,C]=o.useState({status:"all",period:"today",searchType:"code",entregador:"all",scheduledHour:"all",paymentMethod:"all",deliveryType:"all",minValue:"",maxValue:"",dateStart:"",dateEnd:"",productName:""}),R=[r.status,r.period,r.entregador,r.scheduledHour,r.paymentMethod,r.deliveryType,r.minValue,r.maxValue,r.dateStart,r.dateEnd,r.productName].filter(i=>i!=="all"&&i!=="today"&&i!=="").length,$=(i,A)=>{const v={...r,[i]:A};C(v),T(v)},T=i=>{let v=[...Array.isArray(t)?t:[]];i.status!=="all"&&(v=v.filter(p=>p.status===i.status));const D=p=>p.created_at||p.created_date,S=new Date;if(i.period==="today"){const p=new Date(S.getFullYear(),S.getMonth(),S.getDate());v=v.filter(M=>{const q=D(M);if(!q)return!0;const H=new Date(q);return isNaN(H.getTime())?!0:H>=p})}else if(i.period==="week"){const p=new Date(S.getTime()-6048e5);v=v.filter(M=>{const q=D(M);if(!q)return!0;const H=new Date(q);return!isNaN(H.getTime())&&H>=p})}else if(i.period==="month"){const p=new Date(S.getTime()-2592e6);v=v.filter(M=>{const q=D(M);if(!q)return!0;const H=new Date(q);return!isNaN(H.getTime())&&H>=p})}if(i.entregador&&i.entregador!=="all"&&(v=v.filter(p=>String(p.entregador_id)===String(i.entregador))),i.scheduledHour&&i.scheduledHour!=="all"&&(v=v.filter(p=>p.scheduled_time&&String(p.scheduled_time).slice(0,2)===String(i.scheduledHour))),i.paymentMethod&&i.paymentMethod!=="all"&&(v=v.filter(p=>p.payment_method===i.paymentMethod)),i.deliveryType&&i.deliveryType!=="all"&&(i.deliveryType==="delivery"?v=v.filter(p=>p.delivery_method==="delivery"):i.deliveryType==="pickup"&&(v=v.filter(p=>p.delivery_method==="pickup"||!p.delivery_method))),i.minValue&&!isNaN(parseFloat(i.minValue))){const p=parseFloat(i.minValue);v=v.filter(M=>(M.total||0)>=p)}if(i.maxValue&&!isNaN(parseFloat(i.maxValue))){const p=parseFloat(i.maxValue);v=v.filter(M=>(M.total||0)<=p)}if(i.dateStart){const p=new Date(i.dateStart);p.setHours(0,0,0,0),v=v.filter(M=>new Date(M.created_at||M.created_date)>=p)}if(i.dateEnd){const p=new Date(i.dateEnd);p.setHours(23,59,59,999),v=v.filter(M=>new Date(M.created_at||M.created_date)<=p)}i.productName&&(v=v.filter(p=>!p.items||!Array.isArray(p.items)?!1:p.items.some(M=>M.dish?.name?.toLowerCase().includes(i.productName.toLowerCase())))),s&&(i.searchType==="code"?v=v.filter(p=>p.order_code?.toLowerCase().includes(s.toLowerCase())):i.searchType==="customer"?v=v.filter(p=>p.customer_name?.toLowerCase().includes(s.toLowerCase())):i.searchType==="phone"&&(v=v.filter(p=>p.customer_phone?.replace(/\D/g,"").includes(s.replace(/\D/g,""))))),v.sort((p,M)=>{const q=p.created_at||p.created_date,H=M.created_at||M.created_date,re=q?new Date(q).getTime():0;return(H?new Date(H).getTime():0)-re}),a(v)},j={status:"all",period:"today",searchType:"code",entregador:"all",scheduledHour:"all",paymentMethod:"all",deliveryType:"all",minValue:"",maxValue:"",dateStart:"",dateEnd:"",productName:""},P=()=>{C(j),T(j)};o.useEffect(()=>{try{const i=localStorage.getItem(kt);if(i){const A=JSON.parse(i);u(Array.isArray(A)?A:[])}}catch{}},[]);const f=()=>{const i=(E||"").trim();if(!i){F.error("Digite um nome para a combina√ß√£o");return}const A=[...m.filter(v=>v.name!==i),{name:i,filters:{...r}}];u(A),localStorage.setItem(kt,JSON.stringify(A)),N(""),F.success("Filtros salvos")},w=i=>{C(i.filters),T(i.filters),d(!1),F.success(`Aplicado: ${i.name}`)},I=i=>{const A=m.filter(v=>v.name!==i);u(A),localStorage.setItem(kt,JSON.stringify(A)),F.success("Combina√ß√£o removida")};return fe.useEffect(()=>{T(r)},[t,s,r.searchType,r.status,r.period,r.entregador,r.scheduledHour,r.paymentMethod,r.deliveryType,r.minValue,r.maxValue,r.dateStart,r.dateEnd,r.productName]),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px] max-w-md",children:[e.jsx(os,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsxs(Ee,{value:r.searchType,onValueChange:i=>$("searchType",i),children:[e.jsx(Me,{className:"absolute left-10 top-1/2 -translate-y-1/2 h-6 w-20 text-xs border-none bg-transparent focus:ring-0 p-0",children:e.jsx(De,{})}),e.jsxs(Pe,{children:[e.jsx(de,{value:"code",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"w-3 h-3"}),"C√≥digo"]})}),e.jsx(de,{value:"customer",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(hs,{className:"w-3 h-3"}),"Cliente"]})}),e.jsx(de,{value:"phone",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xs,{className:"w-3 h-3"}),"Telefone"]})})]})]}),e.jsx(ue,{placeholder:`Buscar por ${r.searchType==="code"?"c√≥digo":r.searchType==="customer"?"cliente":"telefone"}...`,value:s,onChange:i=>n(i.target.value),className:"pl-32 h-9"})]}),e.jsxs(wa,{open:l,onOpenChange:d,children:[e.jsx(_a,{asChild:!0,children:e.jsxs(_,{variant:"outline",size:"sm",className:"h-9 relative",children:[e.jsx(cs,{className:"w-4 h-4 mr-2"}),"Filtros",R>0&&e.jsx(ae,{className:"ml-2 h-5 w-5 p-0 flex items-center justify-center text-xs bg-orange-500 text-white",children:R})]})}),e.jsx(Ca,{className:"w-96 max-h-[80vh] overflow-y-auto",align:"end",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between sticky top-0 bg-white pb-2 border-b",children:[e.jsx("h3",{className:"font-semibold text-sm",children:"Filtros Avan√ßados"}),R>0&&e.jsxs(_,{variant:"ghost",size:"sm",onClick:P,className:"h-7 text-xs text-red-600 hover:text-red-700",children:[e.jsx(me,{className:"w-3 h-3 mr-1"}),"Limpar"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1.5 block",children:"Status"}),e.jsxs(Ee,{value:r.status,onValueChange:i=>$("status",i),children:[e.jsx(Me,{className:"h-9",children:e.jsx(De,{})}),e.jsx(Pe,{children:rs.map(i=>e.jsx(de,{value:i.value,children:i.label},i.value))})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-medium text-gray-700 mb-1.5 block",children:[e.jsx(xt,{className:"w-3 h-3 inline mr-1"}),"Per√≠odo"]}),e.jsxs(Ee,{value:r.period,onValueChange:i=>$("period",i),children:[e.jsx(Me,{className:"h-9",children:e.jsx(De,{})}),e.jsx(Pe,{children:ns.map(i=>e.jsx(de,{value:i.value,children:i.label},i.value))})]})]}),c.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1.5 block",children:"Entregador"}),e.jsxs(Ee,{value:r.entregador,onValueChange:i=>$("entregador",i),children:[e.jsx(Me,{className:"h-9",children:e.jsx(De,{placeholder:"Todos"})}),e.jsxs(Pe,{children:[e.jsx(de,{value:"all",children:"Todos"}),c.map(i=>e.jsx(de,{value:String(i.id),children:i.name||i.email},i.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1.5 block",children:"Agendado para"}),e.jsxs(Ee,{value:r.scheduledHour,onValueChange:i=>$("scheduledHour",i),children:[e.jsx(Me,{className:"h-9",children:e.jsx(De,{})}),e.jsx(Pe,{children:is.map(i=>e.jsx(de,{value:i.value,children:i.label},i.value))})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-medium text-gray-700 mb-1.5 block flex items-center gap-1",children:[e.jsx(Sa,{className:"w-3 h-3"}),"M√©todo de Pagamento"]}),e.jsxs(Ee,{value:r.paymentMethod,onValueChange:i=>$("paymentMethod",i),children:[e.jsx(Me,{className:"h-9",children:e.jsx(De,{placeholder:"Todos"})}),e.jsxs(Pe,{children:[e.jsx(de,{value:"all",children:"Todos"}),e.jsx(de,{value:"pix",children:"PIX"}),e.jsx(de,{value:"dinheiro",children:"Dinheiro"}),e.jsx(de,{value:"cartao_credito",children:"Cart√£o de Cr√©dito"}),e.jsx(de,{value:"cartao_debito",children:"Cart√£o de D√©bito"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-medium text-gray-700 mb-1.5 block flex items-center gap-1",children:[e.jsx(Ae,{className:"w-3 h-3"}),"Tipo de Entrega"]}),e.jsxs(Ee,{value:r.deliveryType,onValueChange:i=>$("deliveryType",i),children:[e.jsx(Me,{className:"h-9",children:e.jsx(De,{placeholder:"Todos"})}),e.jsxs(Pe,{children:[e.jsx(de,{value:"all",children:"Todos"}),e.jsx(de,{value:"delivery",children:"Entrega"}),e.jsx(de,{value:"pickup",children:"Retirada"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsxs(X,{className:"text-xs font-medium text-gray-700 mb-1.5 block flex items-center gap-1",children:[e.jsx(nt,{className:"w-3 h-3"}),"Valor M√≠n."]}),e.jsx(ue,{type:"number",step:"0.01",placeholder:"0.00",value:r.minValue,onChange:i=>$("minValue",i.target.value),className:"h-9 text-sm"})]}),e.jsxs("div",{children:[e.jsxs(X,{className:"text-xs font-medium text-gray-700 mb-1.5 block flex items-center gap-1",children:[e.jsx(nt,{className:"w-3 h-3"}),"Valor M√°x."]}),e.jsx(ue,{type:"number",step:"0.01",placeholder:"0.00",value:r.maxValue,onChange:i=>$("maxValue",i.target.value),className:"h-9 text-sm"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsxs(X,{className:"text-xs font-medium text-gray-700 mb-1.5 block flex items-center gap-1",children:[e.jsx(xt,{className:"w-3 h-3"}),"Data In√≠cio"]}),e.jsx(ue,{type:"date",value:r.dateStart,onChange:i=>$("dateStart",i.target.value),className:"h-9 text-sm"})]}),e.jsxs("div",{children:[e.jsxs(X,{className:"text-xs font-medium text-gray-700 mb-1.5 block flex items-center gap-1",children:[e.jsx(xt,{className:"w-3 h-3"}),"Data Fim"]}),e.jsx(ue,{type:"date",value:r.dateEnd,onChange:i=>$("dateEnd",i.target.value),className:"h-9 text-sm"})]})]}),e.jsxs("div",{children:[e.jsxs(X,{className:"text-xs font-medium text-gray-700 mb-1.5 block flex items-center gap-1",children:[e.jsx(be,{className:"w-3 h-3"}),"Produto"]}),e.jsx(ue,{placeholder:"Nome do produto...",value:r.productName,onChange:i=>$("productName",i.target.value),className:"h-9 text-sm"})]}),e.jsxs("div",{className:"pt-2 border-t space-y-2",children:[e.jsxs(X,{className:"text-xs font-medium text-gray-700 flex items-center gap-1",children:[e.jsx(la,{className:"w-3 h-3"}),"Combina√ß√µes salvas"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ue,{placeholder:"Nome da combina√ß√£o",value:E,onChange:i=>N(i.target.value),className:"h-9 text-sm flex-1"}),e.jsxs(_,{type:"button",size:"sm",variant:"outline",className:"h-9 shrink-0",onClick:f,children:[e.jsx(ut,{className:"w-3 h-3 mr-1"})," Salvar"]})]}),m.length>0&&e.jsx("ul",{className:"space-y-1",children:m.map(i=>e.jsxs("li",{className:"flex items-center justify-between gap-2 text-sm py-1",children:[e.jsx("button",{type:"button",onClick:()=>w(i),className:"text-left truncate flex-1 text-orange-600 hover:underline",children:i.name}),e.jsx("button",{type:"button",onClick:()=>I(i.name),className:"text-gray-400 hover:text-red-600 p-0.5",title:"Excluir",children:e.jsx(me,{className:"w-3 h-3"})})]},i.name))})]}),R>0&&e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Filtros ativos:"}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[r.status!=="all"&&e.jsxs(ae,{variant:"outline",className:"text-xs",children:[rs.find(i=>i.value===r.status)?.label,e.jsx("button",{onClick:()=>$("status","all"),className:"ml-1 hover:text-red-600",children:e.jsx(me,{className:"w-3 h-3"})})]}),r.period!=="today"&&e.jsxs(ae,{variant:"outline",className:"text-xs",children:[ns.find(i=>i.value===r.period)?.label,e.jsx("button",{onClick:()=>$("period","today"),className:"ml-1 hover:text-red-600",children:e.jsx(me,{className:"w-3 h-3"})})]}),r.entregador!=="all"&&e.jsxs(ae,{variant:"outline",className:"text-xs",children:[c.find(i=>String(i.id)===r.entregador)?.name||"Entregador",e.jsx("button",{onClick:()=>$("entregador","all"),className:"ml-1 hover:text-red-600",children:e.jsx(me,{className:"w-3 h-3"})})]}),r.scheduledHour!=="all"&&e.jsxs(ae,{variant:"outline",className:"text-xs",children:[is.find(i=>i.value===r.scheduledHour)?.label,e.jsx("button",{onClick:()=>$("scheduledHour","all"),className:"ml-1 hover:text-red-600",children:e.jsx(me,{className:"w-3 h-3"})})]}),r.paymentMethod!=="all"&&e.jsxs(ae,{variant:"outline",className:"text-xs",children:[r.paymentMethod==="pix"?"PIX":r.paymentMethod==="dinheiro"?"Dinheiro":r.paymentMethod==="cartao_credito"?"Cart√£o Cr√©dito":"Cart√£o D√©bito",e.jsx("button",{onClick:()=>$("paymentMethod","all"),className:"ml-1 hover:text-red-600",children:e.jsx(me,{className:"w-3 h-3"})})]}),r.deliveryType!=="all"&&e.jsxs(ae,{variant:"outline",className:"text-xs",children:[r.deliveryType==="delivery"?"Entrega":"Retirada",e.jsx("button",{onClick:()=>$("deliveryType","all"),className:"ml-1 hover:text-red-600",children:e.jsx(me,{className:"w-3 h-3"})})]}),r.minValue&&e.jsxs(ae,{variant:"outline",className:"text-xs",children:["Min: R$ ",parseFloat(r.minValue).toFixed(2),e.jsx("button",{onClick:()=>$("minValue",""),className:"ml-1 hover:text-red-600",children:e.jsx(me,{className:"w-3 h-3"})})]}),r.maxValue&&e.jsxs(ae,{variant:"outline",className:"text-xs",children:["M√°x: R$ ",parseFloat(r.maxValue).toFixed(2),e.jsx("button",{onClick:()=>$("maxValue",""),className:"ml-1 hover:text-red-600",children:e.jsx(me,{className:"w-3 h-3"})})]}),r.dateStart&&e.jsxs(ae,{variant:"outline",className:"text-xs",children:["De: ",new Date(r.dateStart).toLocaleDateString("pt-BR"),e.jsx("button",{onClick:()=>$("dateStart",""),className:"ml-1 hover:text-red-600",children:e.jsx(me,{className:"w-3 h-3"})})]}),r.dateEnd&&e.jsxs(ae,{variant:"outline",className:"text-xs",children:["At√©: ",new Date(r.dateEnd).toLocaleDateString("pt-BR"),e.jsx("button",{onClick:()=>$("dateEnd",""),className:"ml-1 hover:text-red-600",children:e.jsx(me,{className:"w-3 h-3"})})]}),r.productName&&e.jsxs(ae,{variant:"outline",className:"text-xs",children:["Produto: ",r.productName,e.jsx("button",{onClick:()=>$("productName",""),className:"ml-1 hover:text-red-600",children:e.jsx(me,{className:"w-3 h-3"})})]})]})]})]})})]})]})}function pi(){const[t,a]=o.useState("now"),[s,n]=o.useState("kanban"),[c,l]=o.useState(null),[d,m]=o.useState(()=>{try{const k=localStorage.getItem("gestor_notification_config");if(k)return JSON.parse(k).soundEnabled!==!1}catch{}return!0}),[u,E]=o.useState(null),[N,r]=o.useState(""),[C,R]=o.useState([]),[$,T]=o.useState(!1),[j,P]=Da("gestor-sidebar-collapsed",!1),[f,w]=o.useState(!1),[I,i]=o.useState([]),[A,v]=o.useState(null),[D,S]=o.useState(!1),[p,M]=o.useState(!1),{requireAuthorization:q,modal:H}=xa(),re=o.useRef(!1),ee=o.useRef(null),ne=o.useRef(0),ie=o.useRef(new Set),Z=Le(),{isMaster:b,hasModuleAccess:z,loading:V,user:U}=Ea(),{slug:G,subscriberEmail:h,inSlugContext:g,loading:Y,error:J}=Ma(),te=b||z("gestor_pedidos"),pe=b?"Admin":"PainelAssinante",oe=g&&b&&h?h:void 0,Ke=!g||b||(U?.email||"").toLowerCase()===(h||"").toLowerCase()||(U?.subscriber_email||"").toLowerCase()===(h||"").toLowerCase();o.useEffect(()=>{U&&"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission()},[U]);const{data:W=[],isLoading:Ve}=ke({queryKey:["gestorOrders",oe??"me"],queryFn:async()=>{const k=oe?{as_subscriber:oe}:{};return(await Q.entities.Order.list("-created_date",k)).filter(se=>{const le=se.order_code?.startsWith("PDV-"),ce=se.delivery_method==="balcao";return!le&&!ce})},refetchInterval:3e3}),{data:$e}=ke({queryKey:["entregadores",oe??"me"],queryFn:()=>Q.entities.Entregador.list(null,oe?{as_subscriber:oe}:{}),refetchInterval:3e3,retry:!1}),x=o.useMemo(()=>$e??[],[$e]),{data:L=[]}=ke({queryKey:["store",oe??"me"],queryFn:()=>Q.entities.Store.list(null,oe?{as_subscriber:oe}:{})}),B=L[0]||{name:"Gestor de Pedidos"};Ws(B);const y=()=>{try{const k=localStorage.getItem("gestor_notification_config");if(k){const le=JSON.parse(k);E(le),m(le.soundEnabled!==!1)}const O=localStorage.getItem("gestorSettings");(O?JSON.parse(O):{}).sound_notifications===!1&&m(!1)}catch(k){console.error("Erro ao carregar configura√ß√µes de notifica√ß√£o:",k)}};o.useEffect(()=>{y()},[]),o.useEffect(()=>{const k=()=>{y()};return window.addEventListener("gestorSettingsUpdated",k),window.addEventListener("gestorNotificationConfigUpdated",k),()=>{window.removeEventListener("gestorSettingsUpdated",k),window.removeEventListener("gestorNotificationConfigUpdated",k)}},[]),o.useEffect(()=>{try{const k=localStorage.getItem("gestorSettings"),O=k?JSON.parse(k):{};if(!O.auto_accept||!W.length)return;const se=Math.max(5,Math.min(180,Number(O.default_prep_time)||30)),le=W.filter(ce=>ce.status==="new");(async()=>{for(const ce of le)if(!ie.current.has(ce.id)){ie.current.add(ce.id);try{await Q.entities.Order.update(ce.id,{...ce,status:"accepted",accepted_at:new Date().toISOString(),prep_time:se},oe?{as_subscriber:oe}:{}),Z.invalidateQueries({queryKey:["gestorOrders"]})}catch{ie.current.delete(ce.id)}}})()}catch{}},[W,Z]),o.useEffect(()=>{if(!u||W.length===0)return;const k={};W.forEach(le=>{k[le.status]=(k[le.status]||0)+1});const O=le=>u.notifyOnStatus?.[le]!==!1,se=W.filter(le=>le.status==="new");se.length>ne.current&&O("new")&&se.length>0&&(d&&u.soundEnabled!==!1&&K(),navigator.vibrate&&navigator.vibrate([200,100,200]),u.browserNotificationEnabled!==!1&&"Notification"in window&&Notification.permission==="granted"&&new Notification("Novo Pedido!",{body:`${se.length} novo(s) pedido(s) recebido(s)`,icon:"/favicon.ico",tag:"new-order"})),ne.current=se.length},[W,d,u]),o.useEffect(()=>{try{const k=JSON.parse(localStorage.getItem("gestorSettings")||"{}");if(!k.are_you_there_enabled)return;const se=Math.max(1,Math.min(120,Number(k.are_you_there_minutes)||15))*60*1e3,le=()=>{re.current||(ee.current&&clearTimeout(ee.current),ee.current=setTimeout(()=>{re.current||S(!0)},se))},ce=()=>{re.current||le()};return window.addEventListener("mousemove",ce),window.addEventListener("keydown",ce),window.addEventListener("click",ce),window.addEventListener("scroll",ce),le(),()=>{ee.current&&clearTimeout(ee.current),window.removeEventListener("mousemove",ce),window.removeEventListener("keydown",ce),window.removeEventListener("click",ce),window.removeEventListener("scroll",ce)}}catch{}},[]),o.useEffect(()=>{const O=setInterval(async()=>{try{const se=JSON.parse(localStorage.getItem("gestorSettings")||"{}"),le=se.auto_cancel_mode||"off";if(le==="off")return;const ce=Math.max(0,Math.min(60,Number(se.auto_cancel_minutes)??10)),bt=new Date;let yt=!1;for(const Ce of W){if(!Ce.accepted_at||["delivered","cancelled"].includes(Ce.status))continue;const Ze=new Date(Ce.accepted_at),Lt=Ce.prep_time||30;if(!((bt-Ze)/1e3/60<=Lt+ce)){if(le==="alert"){F(`Pedido ${Ce.order_code||Ce.id} atrasado (prep ${Lt} min + ${ce} min)`,{icon:"‚ö†Ô∏è",duration:5e3});continue}await Q.entities.Order.update(Ce.id,{...Ce,status:"cancelled",rejection_reason:"Cancelado automaticamente por atraso (tempo de preparo excedido)"},oe?{as_subscriber:oe}:{}),yt=!0}}yt&&Z.invalidateQueries({queryKey:["gestorOrders"]})}catch{}},6e4);return()=>clearInterval(O)},[W,Z,oe]);const K=()=>{try{const{url:k,volume:O}=Pr(),se=new Audio(k);se.volume=O,se.play().catch(()=>{})}catch{}};o.useEffect(()=>{const k=O=>{if(!((O.target.tagName==="INPUT"||O.target.tagName==="TEXTAREA"||O.target.isContentEditable)&&!(O.ctrlKey||O.metaKey))){if(O.key==="Escape"){p?M(!1):c?l(null):$&&T(!1);return}if((O.ctrlKey||O.metaKey)&&O.key==="f"){O.preventDefault(),document.querySelector('input[placeholder*="Buscar"]')?.focus();return}if((O.ctrlKey||O.metaKey)&&O.key==="r"){O.preventDefault(),Z.invalidateQueries({queryKey:["gestorOrders"]}),F.success("Pedidos atualizados!");return}if(O.target.tagName!=="INPUT"&&O.target.tagName!=="TEXTAREA"&&!O.target.isContentEditable){if(O.key==="k"||O.key==="K"){O.preventDefault(),n("kanban"),F.success("Quadros",{duration:1e3});return}if(O.key==="d"||O.key==="D"){O.preventDefault(),n("delivery"),F.success("Entregadores",{duration:1e3});return}if((O.key==="r"||O.key==="R")&&!(O.ctrlKey||O.metaKey)){O.preventDefault(),n("resumo"),F.success("Resumo",{duration:1e3});return}if((O.key==="s"||O.key==="S")&&!(O.ctrlKey||O.metaKey)){O.preventDefault(),n("settings"),F.success("Ajustes",{duration:1e3});return}if(O.key==="h"||O.key==="H"){O.preventDefault(),n("inicio"),F.success("In√≠cio",{duration:1e3});return}if(O.key==="n"||O.key==="N"){O.preventDefault(),w(!f),F.success(f?"Mostrando todos":"S√≥ novos",{duration:1e3});return}}if(c&&["1","2","3","4","5"].includes(O.key)){v({1:"accepted",2:"preparing",3:"ready",4:"out_for_delivery",5:"delivered"}[O.key]);return}if(O.shiftKey&&O.key==="F"){O.preventDefault(),document.querySelector('button:has(svg[class*="Filter"])')?.click();return}}};return window.addEventListener("keydown",k),()=>window.removeEventListener("keydown",k)},[c,$,p,f,Z,s]);const he=o.useMemo(()=>W.filter(k=>{const O=k.scheduled_date&&k.scheduled_time;return t==="now"?!O||O&&k.status!=="new":t==="scheduled"?O&&k.status==="new":!0}),[W,t]),Te=o.useMemo(()=>{const k=W.filter(se=>se.accepted_at&&se.ready_at);if(k.length===0)return 30;const O=k.reduce((se,le)=>se+(new Date(le.ready_at)-new Date(le.accepted_at))/6e4,0)/k.length;return Math.max(5,Math.min(180,Math.round(O)))||30},[W]),He=f?C.filter(k=>k.status==="new"):C,xe=W.filter(k=>k.status==="new").length;o.useEffect(()=>{N||R(he)},[N,he]);const Xe=k=>{R(k)},we=()=>P(k=>!k);if(V)return e.jsx(as,{});if(!U)return e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50 dark:bg-gray-900 p-4",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Sess√£o expirada ou n√£o autenticado."}),e.jsx(qe,{to:"/login",children:e.jsx(_,{className:"bg-orange-500 hover:bg-orange-600",children:"Fazer login"})})]});if(g&&Y)return e.jsx(as,{});if(g&&J)return e.jsx("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8 max-w-md text-center",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Link n√£o encontrado."}),e.jsx(qe,{to:"/",children:e.jsx(_,{children:"Ir ao card√°pio"})})]})});if(g&&h&&!Ke)return e.jsx("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8 max-w-md text-center",children:[e.jsx(Bt,{className:"w-12 h-12 text-red-500 mx-auto mb-3"}),e.jsx("h2",{className:"text-lg font-semibold",children:"Acesso negado"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Voc√™ n√£o tem permiss√£o para acessar o Gestor deste estabelecimento."}),e.jsx(qe,{to:"/",className:"mt-4 inline-block",children:e.jsx(_,{variant:"outline",children:"Voltar"})})]})});if(!te)return e.jsx("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8 max-w-md text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Bt,{className:"w-8 h-8 text-red-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Gestor de Pedidos"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Esta funcionalidade n√£o est√° dispon√≠vel no seu plano atual."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(qe,{to:jt("PainelAssinante",G||void 0),children:e.jsx(_,{className:"w-full bg-orange-500 hover:bg-orange-600",children:"Voltar ao Painel"})}),e.jsx(qe,{to:jt("Cardapio",G||void 0),children:e.jsx(_,{variant:"outline",className:"w-full",children:"Ver Card√°pio"})})]})]})});const _e=jt(pe,b?void 0:G||void 0);return e.jsxs("div",{className:"min-h-screen min-h-screen-mobile bg-gray-50 flex flex-col",children:[e.jsx(Ts,{position:"top-center"}),e.jsx("header",{className:"bg-white border-b border-gray-200 sticky top-0 z-50 h-14 flex-shrink-0",children:e.jsx("div",{className:"px-4 h-full",children:e.jsxs("div",{className:"flex items-center justify-between h-full max-w-screen-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx(qe,{to:_e,className:"lg:hidden flex-shrink-0",children:e.jsx(_,{variant:"ghost",size:"icon",className:"h-9 w-9",children:B.logo?e.jsx("img",{src:B.logo,alt:B.name,className:"w-8 h-8 rounded-lg object-cover"}):e.jsx(be,{className:"w-5 h-5 text-orange-500"})})}),e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[B.logo?e.jsx("img",{src:B.logo,alt:B.name,className:"w-10 h-10 rounded-lg object-cover flex-shrink-0"}):e.jsx("div",{className:"w-10 h-10 bg-orange-500 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(be,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"font-semibold text-base truncate",children:B.name}),e.jsx("p",{className:`text-xs font-medium ${B.is_open?"text-green-600":"text-red-600"}`,children:B.is_open?"Loja aberta":"Loja fechada"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx(Pa,{pageName:"Gestor",compact:!0}),e.jsx(_,{variant:"ghost",size:"icon",className:"h-9 w-9 min-h-touch min-w-touch",onClick:()=>n("resumo"),title:"Resumo",children:e.jsx(za,{className:"w-4 h-4 text-gray-600"})}),e.jsx("a",{href:"#suporte",className:"hidden sm:inline-flex items-center justify-center h-9 w-9 rounded-md text-gray-600 hover:bg-gray-100",title:"Suporte",children:e.jsx(Oa,{className:"w-4 h-4"})}),e.jsx(_,{variant:"ghost",size:"icon",className:"h-9 w-9 hidden sm:flex",title:"Chat",children:e.jsx(Aa,{className:"w-4 h-4 text-gray-600"})}),e.jsx(_,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:()=>M(!0),title:"Atalhos de teclado",children:e.jsx(Jt,{className:"w-4 h-4 text-gray-600"})}),e.jsxs(qs,{children:[e.jsx(Bs,{asChild:!0,children:e.jsx(_,{variant:"ghost",size:"icon",className:"h-9 w-9",children:e.jsx(Ra,{className:"w-4 h-4 text-gray-600"})})}),e.jsxs(Ks,{align:"end",children:[e.jsx(ct,{onClick:()=>q("exportar",()=>{oa(C,`pedidos_${new Date().toISOString().slice(0,10)}.csv`),F.success("CSV baixado")}),children:"Exportar CSV"}),e.jsx(ct,{onClick:()=>q("exportar",()=>{wt(W,"today"),F.success("PDF baixado")}),children:"Relat√≥rio do dia (PDF)"}),e.jsx(ct,{onClick:()=>q("exportar",()=>{wt(W,"week"),F.success("PDF baixado")}),children:"√öltimos 7 dias (PDF)"}),e.jsx(ct,{onClick:()=>q("exportar",()=>{wt(W,"month"),F.success("PDF baixado")}),children:"√öltimos 30 dias (PDF)"})]})]}),e.jsx(_,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:()=>m(!d),title:d?"Desligar som":"Ligar som",children:d?e.jsx(us,{className:"w-4 h-4 text-gray-600"}):e.jsx(Ga,{className:"w-4 h-4 text-gray-400"})}),e.jsx(_,{variant:"ghost",size:"icon",className:"h-9 w-9",onClick:()=>Z.invalidateQueries({queryKey:["gestorOrders"]}),title:"Atualizar",children:e.jsx(Et,{className:`w-4 h-4 text-gray-600 ${Ve?"animate-spin":""}`})}),e.jsx(qe,{to:_e,className:"hidden lg:inline-flex",children:e.jsx(_,{variant:"outline",size:"sm",className:"h-9",children:"Voltar"})}),e.jsx(ka,{})]})]})})}),s==="kanban"&&e.jsx("div",{className:"bg-white border-b border-gray-200 flex-shrink-0",children:e.jsx("div",{className:"px-4 max-w-screen-2xl mx-auto",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex",children:[e.jsx("button",{onClick:()=>a("now"),className:`px-5 py-2.5 font-medium text-sm border-b-2 transition-colors ${t==="now"?"border-orange-500 text-orange-500":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Agora"}),e.jsx("button",{onClick:()=>a("scheduled"),className:`px-5 py-2.5 font-medium text-sm border-b-2 transition-colors ${t==="scheduled"?"border-orange-500 text-orange-500":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Agendados"})]}),e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>T(!0),className:"lg:hidden",children:e.jsx(Wt,{className:"w-5 h-5"})})]})})}),e.jsx("aside",{className:`hidden lg:block fixed left-0 top-14 h-[calc(100vh-3.5rem)] bg-white border-r border-gray-200 z-40 transition-all duration-300 ease-in-out ${j?"w-14":"w-52"}`,children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"p-2 border-b",children:e.jsx("button",{onClick:we,className:"w-full flex items-center justify-center py-1.5 rounded-md text-gray-400 hover:text-gray-600 hover:bg-gray-50 transition-all",title:j?"Expandir":"Recolher",children:e.jsx($a,{className:`w-4 h-4 transition-transform duration-300 ${j?"rotate-180":""}`})})}),e.jsxs("nav",{className:"flex-1 p-1.5 space-y-0.5 overflow-y-auto",children:[e.jsxs("button",{onClick:()=>n("inicio"),className:`w-full flex items-center gap-2 px-2 py-2 rounded-r-md border-l-4 transition-all duration-200 ${s==="inicio"?"border-orange-500 bg-orange-50 text-orange-600":"border-transparent text-gray-600 hover:bg-gray-50"}`,title:j?"In√≠cio":"",children:[e.jsx(Kt,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:`text-sm font-medium whitespace-nowrap transition-all duration-300 ${j?"opacity-0 w-0 overflow-hidden":"opacity-100"}`,children:"In√≠cio"})]}),e.jsxs("button",{onClick:()=>n("kanban"),className:`relative w-full flex items-center gap-2 px-2 py-2 rounded-r-md border-l-4 transition-all duration-200 ${s==="kanban"?"border-orange-500 bg-orange-50 text-orange-600":"border-transparent text-gray-600 hover:bg-gray-50"}`,title:j?xe?`Quadros (${xe} novos)`:"Quadros":"",children:[e.jsx(vt,{className:"w-4 h-4 flex-shrink-0"}),xe>0&&e.jsx("span",{className:"absolute left-6 top-1.5 min-w-[18px] h-[18px] rounded-full bg-orange-500 text-white text-xs font-bold flex items-center justify-center",children:xe>99?"99+":xe}),e.jsxs("span",{className:`text-sm font-medium whitespace-nowrap transition-all duration-300 ${j?"opacity-0 w-0 overflow-hidden":"opacity-100"}`,children:["Quadros ",xe>0&&!j?`(${xe})`:""]})]}),e.jsxs("button",{onClick:()=>n("delivery"),className:`w-full flex items-center gap-2 px-2 py-2 rounded-r-md border-l-4 transition-all duration-200 ${s==="delivery"?"border-orange-500 bg-orange-50 text-orange-600":"border-transparent text-gray-600 hover:bg-gray-50"}`,title:j?"Entregadores":"",children:[e.jsx(Ae,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:`text-sm font-medium whitespace-nowrap transition-all duration-300 ${j?"opacity-0 w-0 overflow-hidden":"opacity-100"}`,children:"Entregadores"})]}),e.jsxs("button",{onClick:()=>n("resumo"),className:`w-full flex items-center gap-2 px-2 py-2 rounded-r-md border-l-4 transition-all duration-200 ${s==="resumo"?"border-orange-500 bg-orange-50 text-orange-600":"border-transparent text-gray-600 hover:bg-gray-50"}`,title:j?"Resumo":"",children:[e.jsx(nt,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:`text-sm font-medium whitespace-nowrap transition-all duration-300 ${j?"opacity-0 w-0 overflow-hidden":"opacity-100"}`,children:"Resumo"})]}),e.jsxs("button",{onClick:()=>n("settings"),className:`w-full flex items-center gap-2 px-2 py-2 rounded-r-md border-l-4 transition-all duration-200 ${s==="settings"?"border-orange-500 bg-orange-50 text-orange-600":"border-transparent text-gray-600 hover:bg-gray-50"}`,title:j?"Ajustes":"",children:[e.jsx(Xt,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:`text-sm font-medium whitespace-nowrap transition-all duration-300 ${j?"opacity-0 w-0 overflow-hidden":"opacity-100"}`,children:"Ajustes"})]})]}),e.jsx("div",{className:"p-2 border-t",children:j?e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-7 h-7 rounded-full bg-orange-500 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-white",children:W.filter(k=>!["delivered","cancelled"].includes(k.status)).length})})}):e.jsxs("div",{className:"text-center py-1",children:[e.jsx("p",{className:"text-[10px] text-gray-400 uppercase tracking-wide",children:"Ativos"}),e.jsx("p",{className:"text-xl font-bold text-orange-500",children:W.filter(k=>!["delivered","cancelled"].includes(k.status)).length})]})})]})}),$&&e.jsx("div",{className:"lg:hidden fixed inset-0 z-50 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",onClick:()=>T(!1),children:e.jsxs("div",{className:"w-72 h-full bg-white shadow-2xl animate-in slide-in-from-left duration-300",onClick:k=>k.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-gradient-to-r from-orange-500 to-orange-600 text-white",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Wt,{className:"w-5 h-5"}),e.jsx("h2",{className:"font-bold",children:"Menu"})]}),e.jsx("button",{onClick:()=>T(!1),className:"min-h-touch min-w-touch flex items-center justify-center p-2 -m-1 rounded-lg hover:bg-white/20 transition-colors","aria-label":"Fechar menu",children:e.jsx(me,{className:"w-5 h-5"})})]}),e.jsxs("nav",{className:"p-3 space-y-2",children:[e.jsxs("button",{onClick:()=>{n("inicio"),T(!1)},className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${s==="inicio"?"bg-orange-500 text-white shadow-sm":"hover:bg-gray-100 text-gray-700"}`,children:[e.jsx(Kt,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"In√≠cio"}),s==="inicio"&&e.jsx(ge,{className:"w-4 h-4 ml-auto"})]}),e.jsxs("button",{onClick:()=>{n("kanban"),T(!1)},className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${s==="kanban"?"bg-orange-500 text-white shadow-sm":"hover:bg-gray-100 text-gray-700"}`,children:[e.jsx(vt,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Quadros"}),xe>0&&e.jsx("span",{className:"ml-auto min-w-[22px] h-[22px] rounded-full bg-orange-500 text-white text-xs font-bold flex items-center justify-center",children:xe>99?"99+":xe}),s==="kanban"&&xe===0&&e.jsx(ge,{className:"w-4 h-4 ml-auto"})]}),e.jsxs("button",{onClick:()=>{n("delivery"),T(!1)},className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${s==="delivery"?"bg-orange-500 text-white shadow-sm":"hover:bg-gray-100 text-gray-700"}`,children:[e.jsx(Ae,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Entregadores"}),s==="delivery"&&e.jsx(ge,{className:"w-4 h-4 ml-auto"})]}),e.jsxs("button",{onClick:()=>{n("resumo"),T(!1)},className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${s==="resumo"?"bg-orange-500 text-white shadow-sm":"hover:bg-gray-100 text-gray-700"}`,children:[e.jsx(nt,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Resumo"}),s==="resumo"&&e.jsx(ge,{className:"w-4 h-4 ml-auto"})]}),e.jsxs("button",{onClick:()=>{n("settings"),T(!1)},className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${s==="settings"?"bg-orange-500 text-white shadow-sm":"hover:bg-gray-100 text-gray-700"}`,children:[e.jsx(Xt,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Ajustes"}),s==="settings"&&e.jsx(ge,{className:"w-4 h-4 ml-auto"})]})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4 pt-4 pb-[max(1rem,env(safe-area-inset-bottom))] border-t bg-gray-50",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-center",children:[e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Pedidos Ativos"}),e.jsx("p",{className:"text-xl font-bold text-orange-500",children:W.filter(k=>!["delivered","cancelled"].includes(k.status)).length})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Novos"}),e.jsx("p",{className:"text-xl font-bold text-orange-500",children:W.filter(k=>k.status==="new").length})]})]})})]})}),e.jsx("main",{className:`flex-1 transition-all duration-300 pb-20 lg:pb-0 ${j?"lg:ml-14":"lg:ml-52"}`,children:e.jsxs("div",{className:"max-w-[1240px] mx-auto p-4 xl:pr-14",children:[e.jsxs("p",{className:"text-xs text-gray-500 mb-2 font-medium",children:[s==="inicio"&&"In√≠cio",s==="kanban"&&`Quadros ‚Ä¢ ${t==="now"?"Agora":"Agendados"}`,s==="delivery"&&"Entregadores",s==="resumo"&&"Resumo financeiro",s==="settings"&&"Ajustes"]}),s==="inicio"&&e.jsx(Br,{onNavigate:n}),s==="kanban"&&e.jsxs("div",{className:"mb-4 flex flex-col sm:flex-row sm:items-center gap-3 flex-wrap",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsx(Kr,{orders:he,onFilterChange:Xe,searchTerm:N,onSearchChange:r,entregadores:x})}),e.jsxs(_,{variant:f?"default":"outline",size:"sm",onClick:()=>w(!f),className:"h-9 shrink-0",title:"S√≥ novos",children:[e.jsx(it,{className:"w-4 h-4 mr-1"}),"S√≥ novos ",W.filter(k=>k.status==="new").length>0&&`(${W.filter(k=>k.status==="new").length})`]})]}),s==="kanban"&&e.jsx(Ja,{orders:He,onSelectOrder:l,darkMode:!1,isLoading:Ve}),s==="kanban"&&e.jsx("div",{className:"mt-6",children:e.jsx($r,{orders:W,entregadores:x,darkMode:!1})}),s==="resumo"&&e.jsx(ca,{orders:W}),s==="delivery"&&e.jsx(mr,{entregadores:x,orders:W,stores:L}),s==="settings"&&e.jsx(Rr,{})]})}),e.jsxs("div",{className:"lg:hidden fixed bottom-0 left-0 right-0 z-30 bg-white border-t border-gray-200 safe-bottom flex",children:[e.jsxs("button",{onClick:()=>n("kanban"),className:`relative flex-1 flex flex-col items-center justify-center py-3 min-h-touch gap-0.5 ${s==="kanban"?"text-orange-500 bg-orange-50 font-semibold":"text-gray-500"}`,children:[e.jsx(vt,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Quadros"}),xe>0&&e.jsx("span",{className:"absolute top-2 right-1/3 min-w-[18px] h-[18px] rounded-full bg-orange-500 text-white text-[10px] font-bold flex items-center justify-center",children:xe>99?"99+":xe})]}),e.jsxs("button",{onClick:()=>n("delivery"),className:`flex-1 flex flex-col items-center justify-center py-3 min-h-touch gap-0.5 ${s==="delivery"?"text-orange-500 bg-orange-50 font-semibold":"text-gray-500"}`,children:[e.jsx(Ae,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"Entregadores"})]})]}),e.jsx("footer",{className:"hidden lg:block flex-shrink-0 border-t border-gray-200 bg-gray-100 py-2 px-4",children:e.jsxs("div",{className:"max-w-screen-2xl mx-auto flex items-center justify-center gap-2 text-sm text-gray-600",children:[e.jsx(at,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{children:[zs," ‚Ä¢ Gestor de Pedidos"]})]})}),e.jsx("a",{href:"#avalie",className:"fixed right-0 top-1/2 -translate-y-1/2 z-40 hidden xl:flex items-center justify-center w-10 h-24 bg-gray-800 hover:bg-gray-700 text-white text-xs font-medium rounded-l-lg shadow-lg writing-mode-vertical cursor-pointer",style:{writingMode:"vertical-rl",textOrientation:"mixed"},title:"Avalie a plataforma",children:"Avalie a plataforma"}),I.length>0&&e.jsxs("button",{onClick:()=>{da(W,I),i([]),F.success(`${I.length} comanda(s) enviada(s) para impress√£o`)},className:"fixed bottom-6 right-6 z-50 flex items-center gap-2 bg-orange-500 hover:bg-orange-600 text-white px-4 py-3 rounded-xl shadow-lg",children:[e.jsx(rt,{className:"w-5 h-5"}),"Imprimir ",I.length," comanda(s)"]}),e.jsx(ye,{open:D,onOpenChange:k=>{k||S(!1)},children:e.jsxs(je,{className:"max-w-sm",children:[e.jsx(ve,{children:"Voc√™ ainda est√° a√≠?"}),e.jsx("p",{className:"text-sm text-gray-600",children:"O gestor est√° pausado. Toque em Continuar para seguir recebendo avisos."}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx(_,{onClick:()=>S(!1),className:"flex-1 bg-orange-500 hover:bg-orange-600 uppercase font-bold",children:"Continuar"}),e.jsx(_,{variant:"outline",onClick:()=>{re.current=!0,S(!1)},className:"flex-1",children:"Desligar (sess√£o)"})]})]})}),e.jsx(ye,{open:p,onOpenChange:M,children:e.jsxs(je,{className:"sm:max-w-md",children:[e.jsxs(ve,{className:"flex items-center gap-2",children:[e.jsx(Jt,{className:"w-5 h-5 text-orange-500"}),"Atalhos de teclado"]}),e.jsxs("div",{className:"grid gap-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("kbd",{className:"px-1.5 py-0.5 rounded bg-gray-100 font-mono",children:"K"})," Quadros"]}),e.jsxs("p",{children:[e.jsx("kbd",{className:"px-1.5 py-0.5 rounded bg-gray-100 font-mono",children:"D"})," Entregadores"]}),e.jsxs("p",{children:[e.jsx("kbd",{className:"px-1.5 py-0.5 rounded bg-gray-100 font-mono",children:"R"})," Resumo"]}),e.jsxs("p",{children:[e.jsx("kbd",{className:"px-1.5 py-0.5 rounded bg-gray-100 font-mono",children:"S"})," Ajustes"]}),e.jsxs("p",{children:[e.jsx("kbd",{className:"px-1.5 py-0.5 rounded bg-gray-100 font-mono",children:"H"})," In√≠cio"]}),e.jsxs("p",{children:[e.jsx("kbd",{className:"px-1.5 py-0.5 rounded bg-gray-100 font-mono",children:"N"})," S√≥ novos"]}),e.jsxs("p",{children:[e.jsx("kbd",{className:"px-1.5 py-0.5 rounded bg-gray-100 font-mono",children:"1"}),"-",e.jsx("kbd",{className:"px-1.5 py-0.5 rounded bg-gray-100 font-mono",children:"5"})," Status (com modal aberto)"]}),e.jsxs("p",{children:[e.jsx("kbd",{className:"px-1.5 py-0.5 rounded bg-gray-100 font-mono",children:"Ctrl+F"})," Buscar"]}),e.jsxs("p",{children:[e.jsx("kbd",{className:"px-1.5 py-0.5 rounded bg-gray-100 font-mono",children:"Ctrl+R"})," Atualizar"]}),e.jsxs("p",{children:[e.jsx("kbd",{className:"px-1.5 py-0.5 rounded bg-gray-100 font-mono",children:"Esc"})," Fechar modal"]})]})]})}),H,c&&e.jsx(tr,{order:c,entregadores:x,onClose:()=>l(null),onUpdate:k=>{Z.invalidateQueries({queryKey:["gestorOrders"]}),l(k??null)},user:U,asSub:oe,suggestedPrepTime:Te,quickStatusKey:A,onClearQuickStatus:()=>v(null),onViewMap:()=>{n("delivery"),l(null)},onDuplicate:k=>{q("duplicar",async()=>{const{id:O,order_code:se,created_date:le,delivered_at:ce,accepted_at:bt,ready_at:yt,...Ce}=k;try{const Ze={...Ce,status:"new",created_date:new Date().toISOString(),...oe&&{as_subscriber:oe}};await Q.entities.Order.create(Ze),Z.invalidateQueries({queryKey:["gestorOrders"]}),F.success("Pedido duplicado."),l(null)}catch(Ze){F.error(Ze?.message||"Erro ao duplicar.")}})},onAddToPrintQueue:()=>i(k=>k.includes(c.id)?k:[...k,c.id])})]})}export{pi as default};
