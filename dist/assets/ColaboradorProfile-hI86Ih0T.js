const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/cloudinaryUpload-vqCefYaz.js","assets/main-5wCJ0shd.js","assets/main-BtcpJIrZ.css"])))=>i.map(i=>d[i]);
import{r as m,u as N,j as e,L as j,B as v,z as n,d as w,_ as P}from"./main-5wCJ0shd.js";import{L as l,I as i}from"./label-BGurCIwA.js";import{D as E,a as D,b as S,c as F,e as z}from"./dialog-BQt4A9EY.js";import{u as L}from"./useMutation-CfjUJVgq.js";import{U as R}from"./user-SYMNLJbz.js";import{C as k}from"./camera-BlP5SAbE.js";import{S as T}from"./save-CE2DQko5.js";function K({user:t,profileRole:q,onClose:c,onUpdate:p}){const[o,s]=m.useState({full_name:t?.full_name||"",phone:t?.phone||"",email:t?.email||"",photo:t?.photo||t?.google_photo||"",address:t?.address||"",city:t?.city||"",state:t?.state||"",birth_date:t?.birth_date||"",document:t?.document||""}),[h,g]=m.useState(!1),x=m.useRef(null),f=N();m.useEffect(()=>{t&&s({full_name:t.full_name||"",phone:t.phone||"",email:t.email||"",photo:t.photo||t.google_photo||"",address:t.address||"",city:t.city||"",state:t.state||"",birth_date:t.birth_date||"",document:t.document||""})},[t]);const u=L({mutationFn:async a=>{const r={full_name:a.full_name,phone:a.phone,photo:a.photo,address:a.address,city:a.city,state:a.state,birth_date:a.birth_date,document:a.document};return Object.keys(r).forEach(d=>{(r[d]===""||r[d]===null)&&delete r[d]}),w.patch(`/users/${t.id}`,r)},onSuccess:a=>{f.invalidateQueries({queryKey:["colaboradores"]}),f.invalidateQueries({queryKey:["user",t.id]}),p&&p(a),n.success("Perfil atualizado com sucesso!"),c&&c()},onError:a=>{n.error(a?.message||"Erro ao atualizar perfil")}}),b=async a=>{const r=a.target.files?.[0];if(r){if(!r.type.startsWith("image/")){n.error("Por favor, selecione uma imagem válida");return}if(r.size>5*1024*1024){n.error("A imagem deve ter no máximo 5MB");return}g(!0);try{const{uploadToCloudinary:d}=await P(async()=>{const{uploadToCloudinary:C}=await import("./cloudinaryUpload-vqCefYaz.js");return{uploadToCloudinary:C}},__vite__mapDeps([0,1,2])),_=await d(r,"profiles");s({...o,photo:_}),n.success("Foto enviada com sucesso!")}catch{n.error("Erro ao fazer upload da foto")}finally{g(!1)}}},y=()=>{if(!o.full_name?.trim()){n.error("Nome é obrigatório");return}u.mutate(o)};return e.jsx(E,{open:!0,onOpenChange:c,children:e.jsxs(D,{className:"sm:max-w-2xl max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsx(S,{children:e.jsx(F,{children:"Meu Perfil"})}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("input",{ref:x,type:"file",accept:"image/*",onChange:b,className:"hidden"}),e.jsxs("div",{className:"relative",children:[o.photo?e.jsx("img",{src:o.photo,alt:"Perfil",className:"w-32 h-32 rounded-full object-cover border-4 border-orange-500 shadow-lg"}):e.jsx("div",{className:"w-32 h-32 rounded-full bg-gradient-to-br from-orange-400 to-orange-600 flex items-center justify-center border-4 border-orange-500 shadow-lg",children:e.jsx(R,{className:"w-16 h-16 text-white"})}),e.jsx("button",{type:"button",onClick:()=>x.current?.click(),disabled:h,className:"absolute bottom-0 right-0 bg-orange-500 text-white p-3 rounded-full hover:bg-orange-600 shadow-lg transition-transform hover:scale-110 disabled:opacity-50",children:h?e.jsx(j,{className:"w-5 h-5 animate-spin"}):e.jsx(k,{className:"w-5 h-5"})})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"Clique na câmera para alterar a foto"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{children:"Nome Completo *"}),e.jsx(i,{value:o.full_name,onChange:a=>s({...o,full_name:a.target.value}),placeholder:"Seu nome completo"})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Email"}),e.jsx(i,{type:"email",value:o.email,disabled:!0,className:"bg-gray-100 dark:bg-gray-800"})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Telefone"}),e.jsx(i,{type:"tel",value:o.phone,onChange:a=>s({...o,phone:a.target.value}),placeholder:"(00) 00000-0000"})]}),e.jsxs("div",{children:[e.jsx(l,{children:"CPF/CNPJ"}),e.jsx(i,{value:o.document,onChange:a=>s({...o,document:a.target.value}),placeholder:"000.000.000-00"})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Data de Nascimento"}),e.jsx(i,{type:"date",value:o.birth_date,onChange:a=>s({...o,birth_date:a.target.value})})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Estado"}),e.jsx(i,{value:o.state,onChange:a=>s({...o,state:a.target.value}),placeholder:"UF",maxLength:2})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(l,{children:"Cidade"}),e.jsx(i,{value:o.city,onChange:a=>s({...o,city:a.target.value}),placeholder:"Nome da cidade"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(l,{children:"Endereço"}),e.jsx(i,{value:o.address,onChange:a=>s({...o,address:a.target.value}),placeholder:"Rua, número, complemento"})]})]})]}),e.jsxs(z,{children:[e.jsx(v,{variant:"outline",onClick:c,children:"Cancelar"}),e.jsx(v,{onClick:y,disabled:u.isPending||h,className:"bg-orange-500 hover:bg-orange-600",children:u.isPending?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"w-4 h-4 mr-2 animate-spin"}),"Salvando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Salvar"]})})]})]})})}export{K as C};
