import{m as I,k as W,r as m,i as J,j as e,L as f,B as E,g as F,e as y,f as S,z as h}from"./main-5wCJ0shd.js";import{b as j}from"./base44Client-BjweZdup.js";import{L as d,I as c}from"./label-BGurCIwA.js";import{v as K}from"./cpfValidator-BjAD6qbQ.js";import{b as Q}from"./cepService-BFcvLHg_.js";import{u as X}from"./useQuery-TBRlwA9F.js";import{C as Z}from"./circle-check-big-C21gM6y_.js";import{U as b}from"./user-plus-Cpsd25vN.js";import{M as ee}from"./mail-CqIb88cT.js";import{C as ae}from"./calendar-Bijjub7E.js";import{P as se}from"./phone-DEvhMYo9.js";import{S as re}from"./search-C1Oe3veH.js";import{M as te}from"./map-pin-Cc9ILfAa.js";import{C as le}from"./credit-card-DjT0Ipnr.js";import{E as $,a as L}from"./eye-CkTGamEz.js";import"./index-BjH-urEE.js";function Ne(){const{slug:k}=I(),[q]=W(),z=q.get("slug"),p=k||z,[a,v]=m.useState({name:"",email:"",birthDate:"",phone:"",cep:"",address:"",addressNumber:"",addressComplement:"",neighborhood:"",city:"",state:"",cpf:"",password:"",confirmPassword:""}),[u,M]=m.useState(!1),[g,B]=m.useState(!1),[t,N]=m.useState(!1),[C,w]=m.useState(!1),[P,o]=m.useState(""),[R,D]=m.useState(!1),x=J(),{data:A}=X({queryKey:["publicCardapio",p],queryFn:()=>j.get(`/public/cardapio/${p}`),enabled:!!p,retry:!1}),T=A?.subscriber_email||null,i=(s,r)=>{v(l=>({...l,[s]:r})),o("")},U=s=>{const r=s.replace(/\D/g,"");return r.length<=11?r.replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d{1,2})$/,"$1-$2"):s},V=s=>{const r=s.replace(/\D/g,"");return r.length<=11?r.replace(/(\d{2})(\d)/,"($1) $2").replace(/(\d{5})(\d)/,"$1-$2"):s},G=s=>{const r=s.replace(/\D/g,"");return r.length<=8?r.replace(/(\d{5})(\d)/,"$1-$2"):s},O=async()=>{const s=a.cep.replace(/\D/g,"");if(s.length===8){w(!0);try{const r=await Q(s);v(l=>({...l,address:r.logradouro||l.address,neighborhood:r.bairro||l.neighborhood,city:r.cidade||l.city,state:r.estado||l.state})),h.success("Endere√ßo preenchido automaticamente!")}catch(r){console.error("Erro ao buscar CEP:",r),h.error("CEP n√£o encontrado. Preencha o endere√ßo manualmente.")}finally{w(!1)}}},_=()=>{if(!a.name.trim())return o("Nome √© obrigat√≥rio"),!1;if(!a.email.trim()||!a.email.includes("@"))return o("Email v√°lido √© obrigat√≥rio"),!1;if(!a.birthDate)return o("Data de nascimento √© obrigat√≥ria"),!1;const s=new Date(a.birthDate),r=new Date;let l=r.getFullYear()-s.getFullYear();const n=r.getMonth()-s.getMonth();return(n<0||n===0&&r.getDate()<s.getDate())&&l--,l<18?(o("Voc√™ deve ter pelo menos 18 anos para se cadastrar"),!1):a.phone.trim()?a.address.trim()?a.cpf&&!K(a.cpf)?(o("CPF inv√°lido"),!1):a.password?a.password.length<6?(o("A senha deve ter no m√≠nimo 6 caracteres"),!1):a.password!==a.confirmPassword?(o("As senhas n√£o coincidem"),!1):!0:(o("Senha √© obrigat√≥ria"),!1):(o("Endere√ßo √© obrigat√≥rio"),!1):(o("N√∫mero de contato √© obrigat√≥rio"),!1)},Y=async s=>{if(s.preventDefault(),console.log("üîµ [CadastroCliente] handleSubmit chamado"),o(""),D(!1),!_()){console.log("‚ùå [CadastroCliente] Valida√ß√£o falhou");return}console.log("‚úÖ [CadastroCliente] Valida√ß√£o passou, enviando dados..."),N(!0);const r=[a.address,a.addressNumber?`n¬∫ ${a.addressNumber}`:"",a.addressComplement?`- ${a.addressComplement}`:"",a.neighborhood?`- ${a.neighborhood}`:"",a.city?`- ${a.city}`:"",a.state?`- ${a.state}`:""].filter(Boolean).join(" ");try{console.log("üì§ [CadastroCliente] Enviando dados para backend:",{name:a.name.trim(),email:a.email.trim().toLowerCase(),birth_date:a.birthDate,phone:a.phone.replace(/\D/g,""),address:r||a.address.trim(),cpf:a.cpf?a.cpf.replace(/\D/g,""):null,password:a.password});const l=await j.functions.invoke("registerCustomer",{name:a.name.trim(),email:a.email.trim().toLowerCase(),birth_date:a.birthDate,phone:a.phone.replace(/\D/g,""),address:a.address.trim(),address_number:a.addressNumber||null,complement:a.addressComplement||null,neighborhood:a.neighborhood||null,city:a.city||null,state:a.state||null,zipcode:a.cep?a.cep.replace(/\D/g,""):null,cpf:a.cpf?a.cpf.replace(/\D/g,""):null,password:a.password,subscriber_email:T});if(console.log("üì• [CadastroCliente] Resposta recebida:",l),l.data?.success){D(!0),h.success("Cadastro realizado com sucesso!");try{(await j.auth.login(a.email.trim().toLowerCase(),a.password)).token?(h.success("Login realizado automaticamente!"),setTimeout(()=>{x(p?`/s/${p}`:"/Cardapio")},1500)):setTimeout(()=>{x("/login")},1500)}catch(n){console.error("Erro ao fazer login autom√°tico:",n),setTimeout(()=>{x("/login")},1500)}}else o(l.data?.error||"Erro ao realizar cadastro. Tente novamente."),h.error(l.data?.error||"Erro ao realizar cadastro.")}catch(l){console.error("Customer register error:",l);const n=l.message||"Erro ao realizar cadastro. Tente novamente.";o(n),h.error(n)}finally{N(!1)}},H=async()=>{try{let s="https://digimenu-backend-3m6t.onrender.com/api";s.endsWith("/api")&&(s=s.replace(/\/api$/,"")),!s.startsWith("http://")&&!s.startsWith("https://")&&(s=`http://${s}`),console.log("üîµ Redirecionando para Google OAuth:",`${s}/api/auth/google`),window.location.href=`${s}/api/auth/google`}catch(s){console.error("‚ùå Erro ao iniciar login Google:",s),h.error("Erro ao iniciar login com Google. Verifique a configura√ß√£o do backend.")}};return R?e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",style:{backgroundColor:"var(--bg-primary)"},children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs("div",{className:"rounded-2xl shadow-xl p-8 text-center",style:{backgroundColor:"var(--bg-card)",border:"1px solid var(--border-color)"},children:[e.jsx("div",{className:"w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Z,{className:"w-8 h-8 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",style:{color:"var(--text-primary)"},children:"Cadastro Realizado!"}),e.jsx("p",{className:"text-sm mb-4",style:{color:"var(--text-secondary)"},children:"Redirecionando para o card√°pio..."}),e.jsx(f,{className:"w-6 h-6 animate-spin text-orange-500 mx-auto"})]})})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 py-8",style:{backgroundColor:"var(--bg-primary)"},children:e.jsx("div",{className:"w-full max-w-2xl",children:e.jsxs("div",{className:"rounded-2xl shadow-xl p-6 md:p-8",style:{backgroundColor:"var(--bg-card)",border:"1px solid var(--border-color)"},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-orange-500 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(b,{className:"w-8 h-8 text-white"})}),e.jsx("h1",{className:"text-3xl font-bold mb-2",style:{color:"var(--text-primary)"},children:"Cadastro de Cliente"}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:"Preencha seus dados para acessar o card√°pio e hist√≥rico de pedidos"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs(E,{type:"button",variant:"outline",className:"w-full",onClick:H,disabled:t,children:[e.jsxs("svg",{className:"w-5 h-5 mr-2",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continuar com Google"]}),e.jsxs("div",{className:"relative my-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t",style:{borderColor:"var(--border-color)"}})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{style:{color:"var(--text-secondary)",backgroundColor:"var(--bg-card)",padding:"0 1rem"},children:"ou"})})]})]}),e.jsxs("form",{onSubmit:Y,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"name",style:{color:"var(--text-primary)"},children:["Nome Completo ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(b,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(c,{id:"name",type:"text",placeholder:"Seu nome completo",value:a.name,onChange:s=>i("name",s.target.value),disabled:t,className:"w-full pl-10",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"email",style:{color:"var(--text-primary)"},children:["Email ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(c,{id:"email",type:"email",placeholder:"seu@email.com",value:a.email,onChange:s=>i("email",s.target.value),disabled:t,className:"w-full pl-10",required:!0,autoComplete:"email"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"birthDate",style:{color:"var(--text-primary)"},children:["Data de Nascimento ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(c,{id:"birthDate",type:"date",value:a.birthDate,onChange:s=>i("birthDate",s.target.value),disabled:t,className:"w-full pl-10",required:!0,max:new Date(new Date().setFullYear(new Date().getFullYear()-18)).toISOString().split("T")[0]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"phone",style:{color:"var(--text-primary)"},children:["N√∫mero de Contato ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(c,{id:"phone",type:"tel",placeholder:"(00) 00000-0000",value:a.phone,onChange:s=>i("phone",V(s.target.value)),disabled:t,className:"w-full pl-10",required:!0,maxLength:15})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"cep",style:{color:"var(--text-primary)"},children:["CEP ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(c,{id:"cep",type:"text",placeholder:"00000-000",value:a.cep,onChange:s=>i("cep",G(s.target.value)),onBlur:O,disabled:t||C,className:"w-full pl-10",required:!0,maxLength:9}),C&&e.jsx(f,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 animate-spin text-gray-400"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Digite o CEP e aguarde o preenchimento autom√°tico"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsxs(d,{htmlFor:"address",style:{color:"var(--text-primary)"},children:["Rua/Logradouro ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(c,{id:"address",type:"text",placeholder:"Nome da rua",value:a.address,onChange:s=>i("address",s.target.value),disabled:t,className:"w-full pl-10",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"addressNumber",style:{color:"var(--text-primary)"},children:["N√∫mero ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(c,{id:"addressNumber",type:"text",placeholder:"123",value:a.addressNumber,onChange:s=>i("addressNumber",s.target.value),disabled:t,className:"w-full",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"addressComplement",style:{color:"var(--text-primary)"},children:["Complemento ",e.jsx("span",{className:"text-gray-500 text-xs",children:"(Opcional)"})]}),e.jsx(c,{id:"addressComplement",type:"text",placeholder:"Apartamento, bloco, etc.",value:a.addressComplement,onChange:s=>i("addressComplement",s.target.value),disabled:t,className:"w-full"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"neighborhood",style:{color:"var(--text-primary)"},children:["Bairro ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(c,{id:"neighborhood",type:"text",placeholder:"Bairro",value:a.neighborhood,onChange:s=>i("neighborhood",s.target.value),disabled:t,className:"w-full",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"city",style:{color:"var(--text-primary)"},children:["Cidade ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(c,{id:"city",type:"text",placeholder:"Cidade",value:a.city,onChange:s=>i("city",s.target.value),disabled:t,className:"w-full",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"state",style:{color:"var(--text-primary)"},children:["Estado ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(c,{id:"state",type:"text",placeholder:"UF",value:a.state,onChange:s=>i("state",s.target.value.toUpperCase()),disabled:t,className:"w-full",required:!0,maxLength:2})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"cpf",style:{color:"var(--text-primary)"},children:["CPF ",e.jsx("span",{className:"text-gray-500 text-xs",children:"(Opcional)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(c,{id:"cpf",type:"text",placeholder:"000.000.000-00",value:a.cpf,onChange:s=>i("cpf",U(s.target.value)),disabled:t,className:"w-full pl-10",maxLength:14})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"password",style:{color:"var(--text-primary)"},children:["Senha ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(F,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(c,{id:"password",type:u?"text":"password",placeholder:"M√≠nimo 6 caracteres",value:a.password,onChange:s=>i("password",s.target.value),disabled:t,className:"w-full pl-10 pr-10",required:!0,minLength:6,autoComplete:"new-password"}),e.jsx("button",{type:"button",onClick:()=>M(!u),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",disabled:t,children:u?e.jsx($,{className:"w-5 h-5"}):e.jsx(L,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"confirmPassword",style:{color:"var(--text-primary)"},children:["Confirmar Senha ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(F,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(c,{id:"confirmPassword",type:g?"text":"password",placeholder:"Confirme sua senha",value:a.confirmPassword,onChange:s=>i("confirmPassword",s.target.value),disabled:t,className:"w-full pl-10 pr-10",required:!0,minLength:6,autoComplete:"new-password"}),e.jsx("button",{type:"button",onClick:()=>B(!g),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",disabled:t,children:g?e.jsx($,{className:"w-5 h-5"}):e.jsx(L,{className:"w-5 h-5"})})]})]})]}),P&&e.jsx("div",{className:"p-3 rounded-lg bg-red-50 border border-red-200",children:e.jsx("p",{className:"text-sm text-red-600",children:P})}),e.jsx(E,{type:"submit",className:"w-full bg-orange-500 hover:bg-orange-600 text-white mt-6",disabled:t,children:t?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"w-4 h-4 mr-2 animate-spin"}),"Cadastrando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Criar Conta"]})})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t text-center",style:{borderColor:"var(--border-color)"},children:[e.jsxs("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:["J√° tem uma conta?"," ",e.jsx(y,{to:"/login",className:"text-orange-500 hover:text-orange-600 font-medium",children:"Fazer Login"})]}),e.jsxs("p",{className:"text-xs mt-2",style:{color:"var(--text-secondary)"},children:["√â um restaurante?"," ",e.jsx(y,{to:S("Cadastro"),className:"text-orange-500 hover:text-orange-600 font-medium",children:"Cadastre-se como Assinante"})]})]}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx(y,{to:S("Cardapio"),className:"text-sm",style:{color:"var(--text-secondary)"},children:"‚Üê Voltar para o Card√°pio"})})]})})})}export{Ne as default};
