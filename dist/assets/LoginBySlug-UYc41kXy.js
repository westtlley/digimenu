import{r,g as j,m as G,k as O,i as W,j as e,d,L as P,B as J,z as I}from"./main-AonIQAES.js";import{L as T,I as F}from"./input-BZMCG3xh.js";import{S as U}from"./store-DsTxvmXo.js";import{A as K}from"./arrow-left-DV30f_NT.js";import{E as Q,a as X}from"./eye-19zYHJ7x.js";import{L as Y}from"./log-in-CoiZseGk.js";import"./index-CXHrl_Fq.js";function Z(a){const[t,l]=r.useState(null),[N,m]=r.useState(!!a),[f,s]=r.useState(null),i=r.useCallback(async x=>{if(!x||!String(x).trim()){l(null),m(!1);return}m(!0),s(null);try{const u=await j.get(`/public/login-info/${encodeURIComponent(x)}`);l(u)}catch(u){s(u?.message||"Erro ao carregar dados do estabelecimento"),l({found:!1,slug:x})}finally{m(!1)}},[]);return r.useEffect(()=>{i(a)},[a,i]),{data:t,loading:N,error:f,refetch:()=>i(a)}}const S={primary:"#ea580c",primaryHover:"#c2410c",secondary:"#f97316",accent:"#fb923c"};function ee(a){if(!a?.found)return S;const t=a.theme_primary_color||S.primary,l=a.theme_secondary_color||a.theme_primary_color||S.secondary;return{primary:t,primaryHover:t,secondary:l,accent:a.theme_accent_color||l}}function ie({type:a}){const{slug:t,type:l}=G(),[N]=O(),m=N.get("returnUrl")||"",f=a??(l==="cliente"||l==="colaborador"?l:"assinante"),s=W(),{data:i,loading:x}=Z(t),[u,D]=r.useState(""),[w,V]=r.useState(""),[v,z]=r.useState(!1),[_,R]=r.useState(!0),[y,k]=r.useState(!1),[C,p]=r.useState(""),A=i?.found?i.name:"Estabelecimento",o=ee(i),b=t?`/s/${t}`:"";r.useEffect(()=>{t&&typeof localStorage<"u"&&localStorage.setItem("lastVisitedSlug",t)},[t]),r.useEffect(()=>{const c=localStorage.getItem("auto_login_enabled")!=="false";(async()=>{if(c)try{if(!await j.auth.isAuthenticated())return;const h=await j.auth.me();if(!h)return;if(h?.role==="customer"){s(t?`/s/${t}`:"/",{replace:!0});return}if((h?.profile_roles?.length?h.profile_roles:h?.profile_role?[h.profile_role]:[]).length>0){s("/colaborador",{replace:!0});return}if(h?.is_master){s("/Admin",{replace:!0});return}s(t?`/s/${t}/PainelAssinante`:"/PainelAssinante",{replace:!0})}catch{}})()},[t,s]);const q=async c=>{if(c.preventDefault(),p(""),k(!0),!u?.trim()||!w){p("Preencha email e senha"),k(!1);return}try{const g=await j.auth.login(u.trim(),w),n=g.user||g;if(g.token){localStorage.setItem("auto_login_enabled",_?"true":"false"),I.success("Login realizado com sucesso!");const $=(n?.profile_roles?.length?n.profile_roles:n?.profile_role?[n.profile_role]:[]).length>0;if(n?.role==="customer"){const H=m&&m.startsWith("/")&&!m.startsWith("//")?m:t?`/s/${t}`:"/";s(H,{replace:!0})}else $?s("/colaborador",{replace:!0}):n?.is_master?s("/Admin",{replace:!0}):s(t?`/s/${t}/PainelAssinante`:"/PainelAssinante",{replace:!0})}else p("Erro ao fazer login. Tente novamente.")}catch(g){const n=g?.message||"Credenciais inválidas. Tente novamente.";p(n),I.error(n)}finally{k(!1)}};if(!t)return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-gray-100 dark:bg-gray-900",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"URL inválida."}),e.jsx(d,{to:"/",className:"text-orange-600 hover:underline mt-2 inline-block",children:"Voltar ao início"})]})});if(x)return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-gray-100 dark:bg-gray-900",children:e.jsx(P,{className:"w-10 h-10 animate-spin text-orange-500"})});if(!i?.found)return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-gray-100 dark:bg-gray-900",children:e.jsxs("div",{className:"max-w-sm w-full text-center p-8 bg-white dark:bg-gray-800 rounded-2xl shadow-lg",children:[e.jsx(U,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Estabelecimento não encontrado"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-6",children:"O link de acesso não existe ou foi alterado."}),e.jsx(d,{to:"/",className:"text-orange-600 hover:text-orange-700 font-medium",children:"Voltar ao início"})]})});const E=f==="assinante",L=f==="cliente",M=f==="colaborador",B=E?"Entrar — Dono, gerente, colaborador ou cliente":L?"Entrar como cliente":"Acesso colaborador — Entregador, Cozinha, PDV, Garçom ou Gerente";return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 transition-colors",style:{background:`linear-gradient(135deg, ${o.primary}22 0%, ${o.secondary}18 50%, ${o.accent}22 100%)`},children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs("div",{className:"rounded-2xl shadow-2xl overflow-hidden bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"p-6 text-white text-center",style:{background:`linear-gradient(135deg, ${o.primary} 0%, ${o.secondary} 100%)`},children:[e.jsxs(d,{to:b,className:"inline-flex items-center gap-2 text-white/90 hover:text-white text-sm mb-4",children:[e.jsx(K,{className:"w-4 h-4"})," Cardápio"]}),i.logo?e.jsx("div",{className:"w-20 h-20 rounded-2xl overflow-hidden border-2 border-white/30 mx-auto mb-3 shadow-lg bg-white",children:e.jsx("img",{src:i.logo,alt:A,className:"w-full h-full object-contain"})}):e.jsx("div",{className:"w-20 h-20 rounded-2xl flex items-center justify-center mx-auto mb-3 border-2 border-white/30 shadow-lg",style:{backgroundColor:"rgba(0,0,0,0.15)"},children:e.jsx(U,{className:"w-10 h-10"})}),e.jsx("h1",{className:"text-xl font-bold truncate",children:A}),e.jsx("p",{className:"text-sm text-white/90 mt-1",children:B})]}),e.jsxs("div",{className:"p-6",children:[E&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center mb-4",children:"Use seu e-mail e senha. Você será direcionado ao painel correto conforme seu perfil."}),e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(T,{htmlFor:"email",className:"text-gray-700 dark:text-gray-300",children:"Email"}),e.jsx(F,{id:"email",type:"email",placeholder:"seu@email.com",value:u,onChange:c=>D(c.target.value),disabled:y,className:"mt-1.5 h-11",required:!0,autoComplete:"email"})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"password",className:"text-gray-700 dark:text-gray-300",children:"Senha"}),e.jsxs("div",{className:"relative mt-1.5",children:[e.jsx(F,{id:"password",type:v?"text":"password",placeholder:"Sua senha",value:w,onChange:c=>V(c.target.value),disabled:y,className:"pr-10 h-11",required:!0,autoComplete:"current-password"}),e.jsx("button",{type:"button",onClick:()=>z(!v),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500",disabled:y,children:v?e.jsx(Q,{className:"w-5 h-5"}):e.jsx(X,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"remember-me",type:"checkbox",checked:_,onChange:c=>R(c.target.checked),className:"h-4 w-4 rounded border-gray-300 text-orange-600 focus:ring-orange-500"}),e.jsx("label",{htmlFor:"remember-me",className:"ml-2 text-sm text-gray-600 dark:text-gray-400",children:"Manter conectado"})]}),C&&e.jsx("div",{className:"p-3 rounded-lg bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800",children:e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:C})}),e.jsx(J,{type:"submit",className:"w-full h-11 text-white font-semibold shadow-lg",style:{background:`linear-gradient(135deg, ${o.primary} 0%, ${o.secondary} 100%)`},disabled:y,children:y?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-4 h-4 mr-2 animate-spin"})," Entrando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-4 h-4 mr-2"})," Entrar"]})})]}),e.jsxs("div",{className:"mt-6 space-y-3 text-center",children:[e.jsx(d,{to:"/esqueci-senha",className:"block text-sm text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200",children:"Esqueci minha senha"}),E&&e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(d,{to:`${b}/cadastro-cliente`,className:"text-sm font-medium",style:{color:o.primary},children:"Não tem conta? Cadastre-se (cliente)"})}),e.jsx("div",{children:e.jsx(d,{to:"/assinar",className:"text-sm font-medium",style:{color:o.primary},children:"Não tem conta? Assine agora (estabelecimento)"})})]}),L&&e.jsx("div",{children:e.jsx(d,{to:`${b}/cadastro-cliente`,className:"text-sm font-medium",style:{color:o.primary},children:"Não tem conta? Cadastre-se"})}),M&&e.jsx("div",{children:e.jsx(d,{to:"/assinar",className:"text-sm font-medium",style:{color:o.primary},children:"Não tem conta? Assine agora"})}),e.jsx("div",{children:e.jsx(d,{to:b||"/",className:"text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:"← Voltar ao cardápio"})})]})]})]})})})}export{ie as default};
