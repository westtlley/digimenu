import{c as R,j as e,a as i,T as D,B as u,h as S,r as v,i as U,L,d as w,e as g,R as P,z as j,g as C}from"./main-BRmc9wuQ.js";import{u as F}from"./useQuery-DECqmSjD.js";import{C as p,c as b,a as A,b as k}from"./card-Ctp-7rs8.js";import{T as E}from"./trending-up-DfwTY8KU.js";import{T as M}from"./trending-down-BJcPmoiH.js";import{M as V}from"./minus-RtCrWvOr.js";import{m as n}from"./proxy-UArsdzLI.js";import{B as z}from"./badge-0XfQUglg.js";import{C as I}from"./clock-BVnf5BSk.js";import{C as $}from"./circle-check-big-BgD3Vilh.js";import{G as H}from"./gift-BmjwTkQk.js";import{U as N}from"./users-DLm2_Fp1.js";import{Z as _}from"./zap-Cci-1Hlx.js";import{C as G}from"./crown-8kI11_0z.js";import{U as q}from"./UserAuthButton-aEHoGetV.js";import{T as O}from"./ThemeToggle-Ipxhq542.js";import{f}from"./formatters-CvOEClq0.js";import{A as X}from"./arrow-left-CctukX1s.js";import{C as Z}from"./chart-column-AYplkH9h.js";import{C as K}from"./calendar-C_CZG2Mr.js";import{P as Q}from"./plus-DSv6Z-VR.js";import{D as T}from"./dollar-sign-Cy_CReDz.js";import{T as B}from"./target-DHqmp1St.js";import"./alert-dialog-WT2FZKvg.js";import"./index-Us3IJkK4.js";import"./index-DtU2aqBA.js";import"./index-Cj8IEuVO.js";import"./log-in-V4EDTWPP.js";import"./user-DROTyYEO.js";import"./power-CSJOf1Dk.js";import"./sun-DyPTta9R.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],J=R("UserX",W);function y({title:c,value:d,subtitle:m,change:o,icon:a,color:t="blue",loading:r=!1,onClick:l}){const s={blue:"from-blue-500 to-blue-600 text-blue-600",green:"from-green-500 to-green-600 text-green-600",orange:"from-orange-500 to-orange-600 text-orange-600",purple:"from-purple-500 to-purple-600 text-purple-600",red:"from-red-500 to-red-600 text-red-600",gray:"from-gray-500 to-gray-600 text-gray-600"},h={up:"text-green-600 bg-green-50",down:"text-red-600 bg-red-50",stable:"text-gray-600 bg-gray-50"},x=o?.trend==="up"?E:o?.trend==="down"?M:V;return r?e.jsx(p,{className:"overflow-hidden",children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-2/3"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]})})}):e.jsx(n.div,{whileHover:{scale:1.02,y:-2},transition:{type:"spring",stiffness:400,damping:25},children:e.jsx(p,{className:i("overflow-hidden border-2 shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer",l&&"hover:border-orange-500"),onClick:l,children:e.jsxs(b,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:c}),e.jsx(n.h3,{className:"text-3xl font-bold text-gray-900 tracking-tight",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:d})]}),a&&e.jsx(n.div,{whileHover:{rotate:360},transition:{duration:.5},className:i("w-12 h-12 rounded-xl bg-gradient-to-br flex items-center justify-center shadow-md",s[t]?.split(" ")[0]+" "+s[t]?.split(" ")[1]),children:e.jsx(a,{className:"w-6 h-6 text-white"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-xs text-gray-500",children:m}),o&&e.jsxs(n.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.2},className:i("flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold",h[o.trend]),children:[e.jsx(x,{className:"w-3 h-3"}),e.jsxs("span",{children:[Math.abs(o.value).toFixed(1),"%"]})]})]})]})})})}function Y({expiringCount:c=0,inactiveCount:d=0,activeTrialsCount:m=0,onViewExpiring:o,onViewInactive:a,onViewTrials:t}){const r=[{id:"expiring",icon:I,title:"Assinantes Expirando",count:c,description:"Expiram nos próximos 7 dias",color:"orange",bgColor:"bg-orange-50",textColor:"text-orange-700",borderColor:"border-orange-200",action:o,severity:c>0?"warning":"info"},{id:"inactive",icon:J,title:"Inativos Há 30+ Dias",count:d,description:"Podem estar abandonados",color:"red",bgColor:"bg-red-50",textColor:"text-red-700",borderColor:"border-red-200",action:a,severity:d>0?"error":"info"},{id:"trials",icon:M,title:"Trials Ativos",count:m,description:"Em período de teste agora",color:"blue",bgColor:"bg-blue-50",textColor:"text-blue-700",borderColor:"border-blue-200",action:t,severity:"info"}],l=r.some(s=>s.count>0);return e.jsxs(p,{className:"border-2 shadow-lg",children:[e.jsx(A,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(k,{className:"text-lg font-bold flex items-center gap-2",children:[l?e.jsx(D,{className:"w-5 h-5 text-orange-500"}):e.jsx($,{className:"w-5 h-5 text-green-500"}),"Atenção Necessária"]}),!l&&e.jsx(z,{className:"bg-green-100 text-green-700 border-green-200",children:"Tudo em ordem"})]})}),e.jsx(b,{className:"space-y-3",children:r.map((s,h)=>{const x=s.icon;return e.jsx(n.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:h*.1},children:e.jsxs("div",{className:i("flex items-center justify-between p-4 rounded-xl border-2 transition-all duration-200",s.bgColor,s.borderColor,s.count>0?"hover:shadow-md":"opacity-60"),children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:i("w-10 h-10 rounded-lg flex items-center justify-center",s.count>0?s.bgColor:"bg-gray-100"),children:e.jsx(x,{className:i("w-5 h-5",s.count>0?s.textColor:"text-gray-400")})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:i("font-semibold text-sm",s.count>0?s.textColor:"text-gray-500"),children:s.title}),e.jsx(z,{variant:"secondary",className:i("text-xs font-bold",s.count>0?s.textColor:"text-gray-500"),children:s.count})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-0.5",children:s.description})]})]}),s.count>0&&s.action&&e.jsxs(u,{variant:"ghost",size:"sm",onClick:s.action,className:i("hover:bg-white/50",s.textColor),children:["Ver",e.jsx(S,{className:"w-4 h-4 ml-1"})]})]})},s.id)})})]})}function ee({distribution:c={},loading:d=!1}){const m=[{key:"free",name:"Gratuito",icon:H,color:"bg-green-500",lightBg:"bg-green-50",textColor:"text-green-700"},{key:"basic",name:"Básico",icon:N,color:"bg-blue-500",lightBg:"bg-blue-50",textColor:"text-blue-700"},{key:"pro",name:"Pro",icon:_,color:"bg-orange-500",lightBg:"bg-orange-50",textColor:"text-orange-700"},{key:"ultra",name:"Ultra",icon:G,color:"bg-purple-500",lightBg:"bg-purple-50",textColor:"text-purple-700"}],o=Object.values(c).reduce((a,t)=>a+(t||0),0);return d?e.jsxs(p,{className:"border-2 shadow-lg",children:[e.jsx(A,{children:e.jsx(k,{children:"Distribuição por Plano"})}),e.jsx(b,{children:e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3,4].map(a=>e.jsx("div",{className:"h-16 bg-gray-200 rounded"},a))})})]}):e.jsxs(p,{className:"border-2 shadow-lg",children:[e.jsx(A,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(k,{className:"text-lg font-bold",children:"Distribuição por Plano"}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Total: ",e.jsx("span",{className:"font-bold text-gray-900",children:o})]})]})}),e.jsx(b,{className:"space-y-3",children:m.map((a,t)=>{const r=a.icon,l=c[a.key]||0,s=o>0?l/o*100:0;return e.jsxs(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.1},className:i("p-4 rounded-xl border-2 transition-all duration-200 hover:shadow-md",a.lightBg,l>0?"opacity-100":"opacity-60"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:i("w-10 h-10 rounded-lg flex items-center justify-center",a.color),children:e.jsx(r,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:i("font-semibold",a.textColor),children:a.name}),e.jsxs("p",{className:"text-xs text-gray-600",children:[l," ",l===1?"assinante":"assinantes"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("span",{className:i("text-2xl font-bold",a.textColor),children:[s.toFixed(0),"%"]})})]}),e.jsx("div",{className:"w-full bg-white rounded-full h-2 overflow-hidden",children:e.jsx(n.div,{initial:{width:0},animate:{width:`${s}%`},transition:{duration:.8,delay:t*.1+.3},className:i("h-full rounded-full",a.color)})})]},a.key)})})]})}function Re(){const[c,d]=v.useState(null),[m,o]=v.useState(!0),a=U();v.useEffect(()=>{(async()=>{try{const x=await C.auth.me();d(x),x.is_master||a("/admin",{replace:!0})}catch{C.auth.redirectToLogin()}finally{o(!1)}})()},[a]);const{data:t,isLoading:r,refetch:l}=F({queryKey:["saas-metrics"],queryFn:async()=>{const h=await fetch("https://digimenu-backend-3m6t.onrender.com/api/api/metrics/saas",{headers:{Authorization:`Bearer ${C.auth.getToken()}`}});if(!h.ok)throw new Error("Erro ao buscar métricas");return(await h.json()).data},enabled:!!c?.is_master,refetchInterval:6e4,refetchOnWindowFocus:!0}),s=async()=>{j.promise(l(),{loading:"Atualizando métricas...",success:"Métricas atualizadas!",error:"Erro ao atualizar métricas"})};return m?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx(L,{className:"w-8 h-8 animate-spin text-orange-500"})}):c?.is_master?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-orange-50/20",children:[e.jsx("header",{className:"bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900 text-white shadow-2xl sticky top-0 z-50",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 py-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(w,{to:g("Admin"),children:e.jsx(u,{variant:"ghost",size:"icon",className:"text-white hover:bg-white/10",children:e.jsx(X,{className:"w-5 h-5"})})}),e.jsxs(n.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-orange-400 to-orange-600 rounded-2xl flex items-center justify-center shadow-lg",children:e.jsx(Z,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-2xl tracking-tight",children:"Dashboard Executivo"}),e.jsxs("p",{className:"text-gray-300 text-sm flex items-center gap-2",children:[e.jsx(K,{className:"w-3 h-3"}),new Date().toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(u,{variant:"ghost",size:"sm",onClick:s,disabled:r,className:"text-white hover:bg-white/10",children:[e.jsx(P,{className:`w-4 h-4 mr-2 ${r?"animate-spin":""}`}),"Atualizar"]}),e.jsx(w,{to:g("Assinantes"),children:e.jsxs(u,{className:"bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 font-semibold shadow-lg",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Novo Assinante"]})}),e.jsx(O,{className:"text-white hover:bg-white/10"}),e.jsx(q,{})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 py-8 space-y-8",children:[e.jsxs(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(T,{className:"w-6 h-6 text-orange-500"}),"Métricas Chave"]}),e.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(y,{title:"MRR",value:f(t?.mrr||0),subtitle:"Receita Recorrente Mensal",change:t?.growth,icon:T,color:"green",loading:r}),e.jsx(y,{title:"ARR",value:f(t?.arr||0),subtitle:"Receita Recorrente Anual",icon:E,color:"blue",loading:r}),e.jsx(y,{title:"LTV",value:f(t?.ltv||0),subtitle:"Valor Vitalício do Cliente",icon:B,color:"purple",loading:r}),e.jsx(y,{title:"Assinantes",value:t?.payingSubscribers||0,subtitle:`${t?.totalSubscribers||0} total (${t?.activeSubscribers||0} ativos)`,icon:N,color:"orange",loading:r,onClick:()=>a(g("Assinantes"))})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsx(n.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.2},children:e.jsx(ee,{distribution:t?.planDistribution||{},loading:r})}),e.jsx(n.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.3},children:e.jsx(Y,{expiringCount:t?.expiringCount||0,inactiveCount:t?.inactiveCount||0,activeTrialsCount:t?.activeTrialsCount||0,onViewExpiring:()=>{a(g("Assinantes")),j.success('Filtrar por "Expirando em 7 dias"')},onViewInactive:()=>{a(g("Assinantes")),j.success('Filtrar por "Inativos"')},onViewTrials:()=>{a(g("Assinantes")),j.success('Filtrar por "Em Trial"')}})})]}),e.jsxs(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},className:"grid md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border-2 border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-700",children:"Taxa de Conversão"}),e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center",children:e.jsx(B,{className:"w-5 h-5 text-white"})})]}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:[(t?.trialConversion||0).toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Trial → Pagante"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border-2 border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-700",children:"Novos Este Mês"}),e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center",children:e.jsx(N,{className:"w-5 h-5 text-white"})})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:t?.newCustomersThisMonth||0}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Novos assinantes"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border-2 border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-700",children:"Ticket Médio"}),e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center",children:e.jsx(T,{className:"w-5 h-5 text-white"})})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:f(t?.payingSubscribers>0?t.mrr/t.payingSubscribers:0)}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Por assinante/mês"})]})]}),e.jsx(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.5},className:"bg-gradient-to-r from-orange-500 to-orange-600 rounded-2xl shadow-xl p-8 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold mb-2",children:"Pronto para crescer?"}),e.jsx("p",{className:"text-orange-100",children:"Gerencie seus assinantes, visualize relatórios e expanda seu SaaS."})]}),e.jsx("div",{className:"flex gap-3",children:e.jsx(w,{to:g("Assinantes"),children:e.jsxs(u,{className:"bg-white text-orange-600 hover:bg-orange-50 font-semibold shadow-lg",children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),"Ver Todos Assinantes"]})})})]})})]})]}):null}export{Re as default};
