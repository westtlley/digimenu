import{r as p,j as e,B as S,R as D,P as z,p as H,g as $}from"./main-AonIQAES.js";import{u as G}from"./useQuery-1B__UZCp.js";import{C as b,a as O,b as A,d as B,c as j}from"./card-GW57779a.js";import{B as Q}from"./badge-VNLW5sw5.js";import{L as I,I as R}from"./input-BZMCG3xh.js";import{S as f}from"./separator-DMZSH5Dc.js";import{R as N}from"./receipt-MH5-4Fa4.js";import{A as V}from"./index-C7_vRD1M.js";import{C as E}from"./circle-x-DUOrfIUD.js";import{C as F}from"./circle-check-Bh8q0Br5.js";import{C as X}from"./chef-hat-DUqumxLr.js";import{C as J}from"./clock-C5Rng7N-.js";import{m as C}from"./proxy-DNI-KLs9.js";import{C as W}from"./calendar-BWMBrEkL.js";import{U as Y}from"./user-BGJXDF4u.js";import{P as Z}from"./phone-CVcoPlft.js";import{M as ee}from"./map-pin-u_JGe0km.js";import{D as ae}from"./dollar-sign-B5ekxtL2.js";import{M as re}from"./message-square-OwMCnJSp.js";import{C as se}from"./circle-alert-BolcJOSC.js";const g={pending:{label:"Pendente",icon:J,color:"bg-yellow-500",textColor:"text-yellow-600 dark:text-yellow-400",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",borderColor:"border-yellow-200 dark:border-yellow-800",description:"Aguardando confirmaÃ§Ã£o"},confirmed:{label:"Confirmado",icon:F,color:"bg-blue-500",textColor:"text-blue-600 dark:text-blue-400",bgColor:"bg-blue-50 dark:bg-blue-900/20",borderColor:"border-blue-200 dark:border-blue-800",description:"Pedido confirmado"},preparing:{label:"Em Preparo",icon:X,color:"bg-purple-500",textColor:"text-purple-600 dark:text-purple-400",bgColor:"bg-purple-50 dark:bg-purple-900/20",borderColor:"border-purple-200 dark:border-purple-800",description:"Sendo preparado"},ready:{label:"Pronto",icon:z,color:"bg-green-500",textColor:"text-green-600 dark:text-green-400",bgColor:"bg-green-50 dark:bg-green-900/20",borderColor:"border-green-200 dark:border-green-800",description:"Pronto para retirada/entrega"},completed:{label:"ConcluÃ­do",icon:F,color:"bg-emerald-500",textColor:"text-emerald-600 dark:text-emerald-400",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",borderColor:"border-emerald-200 dark:border-emerald-800",description:"Pedido concluÃ­do"},cancelled:{label:"Cancelado",icon:E,color:"bg-red-500",textColor:"text-red-600 dark:text-red-400",bgColor:"bg-red-50 dark:bg-red-900/20",borderColor:"border-red-200 dark:border-red-800",description:"Pedido cancelado"}},T=o=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o||0),te=o=>o?new Date(o).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"";function _e({userEmail:o,showInput:q=!0}){const[n,L]=p.useState(""),[t,k]=p.useState(o||""),[h,v]=p.useState(!!o);p.useEffect(()=>{o&&o!==t&&(k(o),v(!0))},[o,t]);const{data:w=[],isLoading:_,refetch:M,isFetching:P}=G({queryKey:["customerOrders",t,n],queryFn:async()=>{if(!t&&!n)return[];try{console.log("ðŸ” Buscando pedidos:",{searchEmail:t,searchPhone:n});const a=$.entities.Order.list("-created_date").catch(r=>(console.error("Erro ao buscar Orders:",r),[])),c=$.entities.Comanda.list("-created_at").catch(r=>(console.error("Erro ao buscar Comandas:",r),[])),[s,m]=await Promise.all([a,c]);console.log("ðŸ“¦ Orders encontrados:",s?.length||0),console.log("ðŸ“‹ Comandas encontrados:",m?.length||0);const l=(Array.isArray(s)?s:[]).filter(r=>t&&(r.customer_email===t||r.created_by===t)||n&&r.customer_phone&&r.customer_phone.replace(/\D/g,"")===n.replace(/\D/g,"")).map(r=>({...r,type:"order"})),d=(Array.isArray(m)?m:[]).filter(r=>t&&r.customer_email===t||n&&r.customer_phone&&r.customer_phone.replace(/\D/g,"")===n.replace(/\D/g,"")).map(r=>({...r,type:"comanda"})),i=[...l,...d].sort((r,x)=>{const y=new Date(r.created_at||r.created_date||0);return new Date(x.created_at||x.created_date||0)-y});return console.log("âœ… Total de pedidos encontrados:",i.length),i}catch(a){return console.error("âŒ Erro ao buscar pedidos:",a),[]}},enabled:h&&(!!t||!!n),refetchInterval:3e4}),u=()=>{!t&&!n||v(!0)},K=({status:a})=>{const c=g[a]||g.pending,s=c.icon;return e.jsx("div",{className:`w-12 h-12 rounded-full ${c.color} flex items-center justify-center`,children:e.jsx(s,{className:"w-6 h-6 text-white"})})},U=({status:a})=>{const c=["pending","confirmed","preparing","ready","completed"],s=c.indexOf(a);return a==="cancelled"?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-full ${g.cancelled.bgColor} ${g.cancelled.borderColor} border-2`,children:[e.jsx(E,{className:"w-5 h-5 text-red-500"}),e.jsx("span",{className:"font-semibold text-red-600 dark:text-red-400",children:"Pedido Cancelado"})]})}):e.jsx("div",{className:"flex items-center justify-between px-4 py-6",children:c.map((l,d)=>{const i=g[l],r=i.icon,x=d<=s,y=d===s;return e.jsxs(H.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(C.div,{initial:{scale:.8,opacity:0},animate:{scale:y?1.1:1,opacity:x?1:.3},transition:{duration:.3},className:`w-10 h-10 rounded-full ${x?i.color:"bg-gray-300 dark:bg-gray-700"} flex items-center justify-center shadow-md`,children:e.jsx(r,{className:`w-5 h-5 ${x?"text-white":"text-gray-500"}`})}),e.jsx("span",{className:`text-xs font-medium ${x?i.textColor:"text-gray-400 dark:text-gray-600"} text-center max-w-[60px]`,children:i.label})]}),d<c.length-1&&e.jsx("div",{className:"flex-1 h-1 mx-2 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden",children:e.jsx(C.div,{initial:{width:0},animate:{width:d<s?"100%":"0%"},transition:{duration:.5},className:`h-full ${i.color}`})})]},l)})})};return e.jsxs("div",{className:"space-y-6",children:[q&&e.jsxs(b,{children:[e.jsxs(O,{children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(N,{className:"w-5 h-5 text-orange-500"}),"Acompanhar Pedido"]}),e.jsx(B,{children:"Digite seu email ou telefone para acompanhar seus pedidos"})]}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(I,{htmlFor:"email",children:"Email"}),e.jsx(R,{id:"email",type:"email",placeholder:"seu@email.com",value:t,onChange:a=>k(a.target.value),onKeyDown:a=>a.key==="Enter"&&u(),className:"mt-1.5"})]}),e.jsxs("div",{children:[e.jsx(I,{htmlFor:"phone",children:"Telefone"}),e.jsx(R,{id:"phone",type:"tel",placeholder:"(00) 00000-0000",value:n,onChange:a=>L(a.target.value.replace(/\D/g,"")),onKeyDown:a=>a.key==="Enter"&&u(),maxLength:11,className:"mt-1.5"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(S,{onClick:u,className:"flex-1 bg-orange-500 hover:bg-orange-600",disabled:!t&&!n,children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),"Buscar Pedidos"]}),h&&e.jsx(S,{onClick:()=>M(),variant:"outline",disabled:P,children:e.jsx(D,{className:`w-4 h-4 ${P?"animate-spin":""}`})})]})]})]}),_&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(D,{className:"w-8 h-8 animate-spin text-orange-500 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Buscando pedidos..."})]})}),!_&&h&&w.length===0&&e.jsx(b,{children:e.jsxs(j,{className:"py-12 text-center",children:[e.jsx(N,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Nenhum pedido encontrado"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"NÃ£o encontramos pedidos com os dados fornecidos"})]})}),e.jsx(V,{children:w.map((a,c)=>{const s=g[a.status]||g.pending,m=a.type==="comanda";return e.jsx(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:c*.1},children:e.jsxs(b,{className:`border-2 ${s.borderColor}`,children:[e.jsx(O,{className:`${s.bgColor} border-b ${s.borderColor}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(K,{status:a.status}),e.jsxs("div",{children:[e.jsx(A,{className:"text-lg",children:m?`Comanda #${a.number||a.id}`:`Pedido #${a.id}`}),e.jsxs(B,{className:"flex items-center gap-2 mt-1",children:[e.jsx(W,{className:"w-3 h-3"}),te(a.created_at)]})]})]}),e.jsx(Q,{variant:"outline",className:`${s.textColor} ${s.borderColor} border-2`,children:s.label})]})}),e.jsxs(j,{className:"pt-6 space-y-6",children:[e.jsx(U,{status:a.status}),e.jsx(f,{}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[a.customer_name&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Y,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:a.customer_name})]}),a.customer_phone&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Z,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:a.customer_phone})]}),a.delivery_address&&e.jsxs("div",{className:"flex items-start gap-2 text-sm sm:col-span-2",children:[e.jsx(ee,{className:"w-4 h-4 text-gray-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:a.delivery_address})]}),a.payment_method&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ae,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300 capitalize",children:a.payment_method.replace("_"," ")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Total:"}),e.jsx("span",{className:"text-lg font-bold text-orange-600 dark:text-orange-400",children:T(a.total)})]})]}),a.notes&&e.jsxs(e.Fragment,{children:[e.jsx(f,{}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(re,{className:"w-4 h-4 text-gray-500 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"ObservaÃ§Ãµes:"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:a.notes})]})]})]}),a.items&&a.items.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(f,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:"Itens do Pedido:"}),e.jsx("div",{className:"space-y-2",children:a.items.map((l,d)=>e.jsxs("div",{className:"flex justify-between items-start text-sm bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[l.quantity,"x ",l.name||l.dish?.name]}),l.notes&&e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:l.notes})]}),e.jsx("span",{className:"font-semibold text-gray-700 dark:text-gray-300 ml-4",children:T(l.price*l.quantity)})]},d))})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx(se,{className:"w-4 h-4 flex-shrink-0"}),e.jsxs("span",{children:["O status Ã© atualizado em tempo real pelo estabelecimento.",!m&&" VocÃª pode acompanhar seu pedido aqui."]})]})]})]})},a.id)})})]})}export{_e as O};
