const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/cloudinaryUpload-C4sUQLHO.js","assets/main-AonIQAES.js","assets/main-Cza1094E.css"])))=>i.map(i=>d[i]);
import{c as us,j as e,a as He,p as se,y as Br,r as w,v as xn,T as vo,P as ys,w as Qe,C as ar,e as js,d as Wr,B as D,u as es,z as W,g as _e,X as ws,F as Hr,q as yo,_ as tt,R as Fl,h as bo,t as pm,D as gm,L as Ta,x as os,o as fm}from"./main-AonIQAES.js";import{b as ae}from"./base44Client-DnnNNlVu.js";import{u as Ae}from"./useQuery-1B__UZCp.js";import{C as B,a as oe,b as ce,c as H,d as rs}from"./card-GW57779a.js";import{B as fe}from"./badge-VNLW5sw5.js";import{I as U,L as R}from"./input-BZMCG3xh.js";import{C as Ks,a as er}from"./dateUtils-DeGNBYqD.js";import{m as We}from"./proxy-DNI-KLs9.js";import{S as Es}from"./star-4jmeOV9l.js";import{u as jm,h as vm,i as ym,j as Ds,k as bm,l as Nm,m as it,w as Rl,n as No,o as wo,q as _o,r as Co,s as Us,D as ko,t as wm,E as _m,v as Sa,x as qr,A as So,y as Bs,z as fi,G as lr,H as Do,I as Mo,J as Kr,K as Ao,M as Po,N as Qr,O as Pr,Q as Cm,S as Eo,X as Aa,Y as Pa,U as Oo,T as km,R as Sm,B as Jn,a as Xn,P as Dm,b as Mm,C as Am,c as ji,p as vi,V as Pm,g as Em,F as Om}from"./FinancialDashboard-D0ts7ei8.js";import{S as Ce,a as ke,b as Se,c as De,d as Q}from"./select-BsJPtTd1.js";import{D as $a}from"./dollar-sign-B5ekxtL2.js";import{T as Ls}from"./trending-up-CEWXgtY8.js";import{T as zm}from"./target-BW04zVbK.js";import{C as or}from"./clock-C5Rng7N-.js";import{U as Et}from"./users-BZplJILV.js";import{C as lt}from"./credit-card-Baa4ESW4.js";import{S as Lt}from"./shopping-cart-Ur_1HrJq.js";import{C as It}from"./calendar-BWMBrEkL.js";import{u as Ze}from"./usePermission-CVnsvsYp.js";import{u as zo}from"./useSlugContext-CNsGQFhv.js";import{D as pn}from"./download-DZ9qjCkK.js";import{e as Ri,I as To,U as sa,P as Fo,E as gn,C as ot,G as cr,d as jr,b as Rs,c as Tm,R as Fm,L as Ro,T as ei,f as si,g as ai,h as ti,M as Ca,F as Ll}from"./EmptyState-B-2tmWOi.js";import{C as la}from"./circle-check-big-BQQ24GbH.js";import{S as Rm,b as fn,f as jn,c as vn,d as Li,e as Ii,P as Lm,B as Im,I as $m,F as qm,M as Ym,a as Il,w as Gm}from"./whatsappService-QA_X1zh_.js";import{u as le}from"./useMutation--pPw_T_d.js";import{C as Vm}from"./chart-column-5rcpA1LB.js";import{C as Lo}from"./calculator-CX78XC4C.js";import{S as ct}from"./settings-86dQDP0i.js";import{B as Um,f as Ot}from"./format-DzdVs_Wz.js";import{C as $i}from"./chef-hat-DUqumxLr.js";import{M as Fa}from"./menu-BozYSawS.js";import{A as dt}from"./index-C7_vRD1M.js";import{T as Ms}from"./textarea-DMRLefWJ.js";import{D as ze,a as Te,b as Fe,c as Re,d as Zr,e as Ws,f as Bm}from"./dialog-LI6mGNSb.js";import{S as Le}from"./switch-BA6NwbNY.js";import{e as dr,C as mr,P as ur,D as mt,a as ut,b as ht,c as ms,d as yi,t as Gs}from"./index-6vqeTrEz.js";import{S as _s}from"./search-Sb5SY96K.js";import{C as aa}from"./check-CPlY7ZZw.js";import{P as Ie}from"./plus-BWjW9AHH.js";import{P as yn,u as Wm}from"./useComandaWebSocket-RQFTL-2I.js";import{T as Ke}from"./trash-2-eTZTaYxL.js";import{S as $t}from"./differenceInCalendarDays-DRQCwW68.js";import{C as zt}from"./index-Diz3LxqQ.js";import{C as Ra}from"./chevron-down-W9Dhjl9M.js";import{F as oa}from"./filter-CHySxj5d.js";import{G as tr}from"./gift-CnUYH84S.js";import{u as Io,P as qi,K as Hm}from"./useManagerialAuth-_7bmlBU3.js";import{uploadToCloudinary as $l}from"./cloudinaryUpload-C4sUQLHO.js";import{f as ga}from"./formatters-CvOEClq0.js";import{L as $o,S as Km}from"./useDocumentHead-BHKxsTKl.js";import{T as Yi,a as Gi,b as ta,c as ra}from"./tabs-CmdXZfSo.js";import{c as qo,u as Vi,b as Yo,P as vr,a as Go,d as Qm,e as Jr,f as Zm}from"./index-CaNfpB9J.js";import{c as Jm,u as Xm}from"./index-BQa84rXG.js";import{S as rr}from"./sparkles-BpSaorR-.js";import{Z as Xr}from"./zap-D-FDPwOP.js";import{C as ft}from"./circle-alert-BolcJOSC.js";import{P as Qa}from"./phone-CVcoPlft.js";import{M as Ea}from"./map-pin-u_JGe0km.js";import{a as qa,E as eu}from"./eye-19zYHJ7x.js";import{M as Vo}from"./mail-DRqPzMLJ.js";import{B as Uo,T as ri}from"./ticket-DIxUtuYp.js";import{A as su,a as au,b as tu,c as ru,d as nu,e as iu,f as lu,g as ou}from"./alert-dialog-CykeUtNX.js";import{M as cu,S as du}from"./sun-CfH9NmRq.js";import{S as hr}from"./save-DRNwR1Re.js";import{R as La}from"./receipt-MH5-4Fa4.js";import{C as Za}from"./circle-x-DUOrfIUD.js";import{H as Yr}from"./history-Bm8QX0qR.js";import{C as rt}from"./circle-check-Bh8q0Br5.js";import{S as ql}from"./separator-DMZSH5Dc.js";import{S as ni}from"./store-DsTxvmXo.js";import{C as ii}from"./circle-help-WjA6p3fH.js";import{M as mu}from"./message-square-OwMCnJSp.js";import{A as uu}from"./arrow-left-DV30f_NT.js";import{T as Yl}from"./trending-down-DuhZkmIL.js";import{M as Gl}from"./message-circle-s-Hh0I0Z.js";import{B as hu}from"./bell-VrVpKCOv.js";import"./index-CXHrl_Fq.js";import{T as Bo}from"./truck-D6zUN2Zr.js";import{U as xu}from"./user-BGJXDF4u.js";import{C as pu}from"./ColaboradorProfile-CrcP53UQ.js";import{L as gu}from"./layout-dashboard-Dya9zxYj.js";import{U as fu}from"./user-plus-BLk7GxtB.js";import{S as en}from"./shield-D77XkyOi.js";import{S as ju}from"./smartphone-BxcPXTuQ.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vu=[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]],yu=us("ArrowDownRight",vu);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bu=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],Nu=us("ArrowUpRight",bu);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wu=[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]],_u=us("Banknote",wu);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cu=[["path",{d:"m9.06 11.9 8.07-8.06a2.85 2.85 0 1 1 4.03 4.03l-8.06 8.08",key:"1styjt"}],["path",{d:"M7.07 14.94c-1.66 0-3 1.35-3 3.02 0 1.33-2.5 1.52-2 2.02 1.08 1.1 2.49 2.02 4 2.02 2.2 0 4-1.8 4-4.04a3.01 3.01 0 0 0-3-3.02z",key:"z0l1mu"}]],ku=us("Brush",Cu);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Su=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],Qv=us("ClipboardList",Su);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Du=[["path",{d:"M20 7h-3a2 2 0 0 1-2-2V2",key:"x099mo"}],["path",{d:"M9 18a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h7l4 4v10a2 2 0 0 1-2 2Z",key:"18t6ie"}],["path",{d:"M3 7.6v12.8A1.6 1.6 0 0 0 4.6 22h9.8",key:"1nja0z"}]],Wo=us("Files",Du);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mu=[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]],Au=us("Flame",Mu);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pu=[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],sn=us("FolderPlus",Pu);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eu=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],an=us("Image",Eu);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ou=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],Ja=us("Layers",Ou);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zu=[["path",{d:"m3 11 18-5v12L3 14v-3z",key:"n962bs"}],["path",{d:"M11.6 16.8a3 3 0 1 1-5.8-1.6",key:"1yl0tm"}]],Zv=us("Megaphone",zu);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tu=[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]],Vl=us("Palette",Tu);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fu=[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Ul=us("PowerOff",Fu);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ru=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],Lu=us("QrCode",Ru);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Iu=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Bl=us("RotateCcw",Iu);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $u=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Jv=us("ShieldCheck",$u);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qu=[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2",key:"125lnx"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]],Yu=us("TestTube",qu);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gu=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]],Vu=us("UserCheck",Gu);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uu=[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]],Er=us("UserCog",Uu);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bu=[["path",{d:"M8 22h8",key:"rmew8v"}],["path",{d:"M7 10h10",key:"1101jm"}],["path",{d:"M12 15v7",key:"t2xh3l"}],["path",{d:"M12 15a5 5 0 0 0 5-5c0-2-.5-4-2-8H9c-1.5 4-2 6-2 8a5 5 0 0 0 5 5Z",key:"10ffi3"}]],Wu=us("Wine",Bu);function Or({icon:s,value:a,label:t,trend:r,trendValue:n,color:l="primary",className:c,delay:m=0}){const i={primary:{bg:"bg-gradient-to-br from-orange-400 to-orange-600",text:"text-orange-600",bgLight:"bg-orange-50",border:"border-orange-200",gradient:"from-orange-400/20 to-orange-600/20"},success:{bg:"bg-gradient-to-br from-green-400 to-green-600",text:"text-green-600",bgLight:"bg-green-50",border:"border-green-200",gradient:"from-green-400/20 to-green-600/20"},error:{bg:"bg-gradient-to-br from-red-400 to-red-600",text:"text-red-600",bgLight:"bg-red-50",border:"border-red-200",gradient:"from-red-400/20 to-red-600/20"},warning:{bg:"bg-gradient-to-br from-amber-400 to-amber-600",text:"text-amber-600",bgLight:"bg-amber-50",border:"border-amber-200",gradient:"from-amber-400/20 to-amber-600/20"},info:{bg:"bg-gradient-to-br from-blue-400 to-blue-600",text:"text-blue-600",bgLight:"bg-blue-50",border:"border-blue-200",gradient:"from-blue-400/20 to-blue-600/20"}},o=i[l]||i.primary;return e.jsxs(We.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:m,duration:.3},className:He("group relative overflow-hidden rounded-2xl","bg-gradient-to-br dark:from-slate-800 dark:to-slate-900 from-white to-gray-50","p-6 shadow-md border","dark:border-slate-700 border-gray-200","hover:shadow-xl hover:-translate-y-1","transition-all duration-300",c),children:[e.jsx("div",{className:He("absolute top-0 right-0 w-32 h-32 rounded-full -mr-16 -mt-16 blur-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500",`bg-gradient-to-br ${o.gradient}`)}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(We.div,{whileHover:{scale:1.1},whileTap:{scale:.95},className:He("w-14 h-14 rounded-xl flex items-center justify-center shadow-lg",o.bg),children:s&&e.jsx(s,{className:"w-7 h-7 text-white"})}),r&&n&&e.jsxs("div",{className:He("flex items-center gap-1 px-2 py-1 rounded-lg text-xs font-semibold",r==="up"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:[r==="up"?"↑":"↓"," ",n]})]}),e.jsxs("div",{children:[e.jsx(We.p,{initial:{scale:.8},animate:{scale:1},transition:{delay:m+.1,duration:.3},className:"text-4xl font-bold dark:text-slate-100 text-gray-900 mb-1",children:a}),e.jsx("p",{className:"text-sm font-semibold dark:text-slate-400 text-gray-600 uppercase tracking-wide",children:t})]})]})]})}var Hu=["x1","y1","x2","y2","key"],Ku=["offset"];function xt(s){"@babel/helpers - typeof";return xt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},xt(s)}function Wl(s,a){var t=Object.keys(s);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(s);a&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),t.push.apply(t,r)}return t}function vs(s){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?Wl(Object(t),!0).forEach(function(r){Qu(s,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(t)):Wl(Object(t)).forEach(function(r){Object.defineProperty(s,r,Object.getOwnPropertyDescriptor(t,r))})}return s}function Qu(s,a,t){return a=Zu(a),a in s?Object.defineProperty(s,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[a]=t,s}function Zu(s){var a=Ju(s,"string");return xt(a)=="symbol"?a:a+""}function Ju(s,a){if(xt(s)!="object"||!s)return s;var t=s[Symbol.toPrimitive];if(t!==void 0){var r=t.call(s,a);if(xt(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}function Xa(){return Xa=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(s[r]=t[r])}return s},Xa.apply(this,arguments)}function Hl(s,a){if(s==null)return{};var t=Xu(s,a),r,n;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(s);for(n=0;n<l.length;n++)r=l[n],!(a.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(s,r)&&(t[r]=s[r])}return t}function Xu(s,a){if(s==null)return{};var t={};for(var r in s)if(Object.prototype.hasOwnProperty.call(s,r)){if(a.indexOf(r)>=0)continue;t[r]=s[r]}return t}var eh=function(a){var t=a.fill;if(!t||t==="none")return null;var r=a.fillOpacity,n=a.x,l=a.y,c=a.width,m=a.height,i=a.ry;return se.createElement("rect",{x:n,y:l,ry:i,width:c,height:m,stroke:"none",fill:t,fillOpacity:r,className:"recharts-cartesian-grid-bg"})};function Ho(s,a){var t;if(se.isValidElement(s))t=se.cloneElement(s,a);else if(it(s))t=s(a);else{var r=a.x1,n=a.y1,l=a.x2,c=a.y2,m=a.key,i=Hl(a,Hu),o=Us(i,!1);o.offset;var d=Hl(o,Ku);t=se.createElement("line",Xa({},d,{x1:r,y1:n,x2:l,y2:c,fill:"none",key:m}))}return t}function sh(s){var a=s.x,t=s.width,r=s.horizontal,n=r===void 0?!0:r,l=s.horizontalPoints;if(!n||!l||!l.length)return null;var c=l.map(function(m,i){var o=vs(vs({},s),{},{x1:a,y1:m,x2:a+t,y2:m,key:"line-".concat(i),index:i});return Ho(n,o)});return se.createElement("g",{className:"recharts-cartesian-grid-horizontal"},c)}function ah(s){var a=s.y,t=s.height,r=s.vertical,n=r===void 0?!0:r,l=s.verticalPoints;if(!n||!l||!l.length)return null;var c=l.map(function(m,i){var o=vs(vs({},s),{},{x1:m,y1:a,x2:m,y2:a+t,key:"line-".concat(i),index:i});return Ho(n,o)});return se.createElement("g",{className:"recharts-cartesian-grid-vertical"},c)}function th(s){var a=s.horizontalFill,t=s.fillOpacity,r=s.x,n=s.y,l=s.width,c=s.height,m=s.horizontalPoints,i=s.horizontal,o=i===void 0?!0:i;if(!o||!a||!a.length)return null;var d=m.map(function(x){return Math.round(x+n-n)}).sort(function(x,f){return x-f});n!==d[0]&&d.unshift(0);var p=d.map(function(x,f){var v=!d[f+1],y=v?n+c-x:d[f+1]-x;if(y<=0)return null;var j=f%a.length;return se.createElement("rect",{key:"react-".concat(f),y:x,x:r,height:y,width:l,stroke:"none",fill:a[j],fillOpacity:t,className:"recharts-cartesian-grid-bg"})});return se.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},p)}function rh(s){var a=s.vertical,t=a===void 0?!0:a,r=s.verticalFill,n=s.fillOpacity,l=s.x,c=s.y,m=s.width,i=s.height,o=s.verticalPoints;if(!t||!r||!r.length)return null;var d=o.map(function(x){return Math.round(x+l-l)}).sort(function(x,f){return x-f});l!==d[0]&&d.unshift(0);var p=d.map(function(x,f){var v=!d[f+1],y=v?l+m-x:d[f+1]-x;if(y<=0)return null;var j=f%r.length;return se.createElement("rect",{key:"react-".concat(f),x,y:c,width:y,height:i,stroke:"none",fill:r[j],fillOpacity:n,className:"recharts-cartesian-grid-bg"})});return se.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},p)}var nh=function(a,t){var r=a.xAxis,n=a.width,l=a.height,c=a.offset;return No(wo(vs(vs(vs({},Co.defaultProps),r),{},{ticks:_o(r,!0),viewBox:{x:0,y:0,width:n,height:l}})),c.left,c.left+c.width,t)},ih=function(a,t){var r=a.yAxis,n=a.width,l=a.height,c=a.offset;return No(wo(vs(vs(vs({},Co.defaultProps),r),{},{ticks:_o(r,!0),viewBox:{x:0,y:0,width:n,height:l}})),c.top,c.top+c.height,t)},Nt={horizontal:!0,vertical:!0,stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function et(s){var a,t,r,n,l,c,m=jm(),i=vm(),o=ym(),d=vs(vs({},s),{},{stroke:(a=s.stroke)!==null&&a!==void 0?a:Nt.stroke,fill:(t=s.fill)!==null&&t!==void 0?t:Nt.fill,horizontal:(r=s.horizontal)!==null&&r!==void 0?r:Nt.horizontal,horizontalFill:(n=s.horizontalFill)!==null&&n!==void 0?n:Nt.horizontalFill,vertical:(l=s.vertical)!==null&&l!==void 0?l:Nt.vertical,verticalFill:(c=s.verticalFill)!==null&&c!==void 0?c:Nt.verticalFill,x:Ds(s.x)?s.x:o.left,y:Ds(s.y)?s.y:o.top,width:Ds(s.width)?s.width:o.width,height:Ds(s.height)?s.height:o.height}),p=d.x,x=d.y,f=d.width,v=d.height,y=d.syncWithTicks,j=d.horizontalValues,M=d.verticalValues,k=bm(),z=Nm();if(!Ds(f)||f<=0||!Ds(v)||v<=0||!Ds(p)||p!==+p||!Ds(x)||x!==+x)return null;var $=d.verticalCoordinatesGenerator||nh,u=d.horizontalCoordinatesGenerator||ih,g=d.horizontalPoints,T=d.verticalPoints;if((!g||!g.length)&&it(u)){var h=j&&j.length,b=u({yAxis:z?vs(vs({},z),{},{ticks:h?j:z.ticks}):void 0,width:m,height:i,offset:o},h?!0:y);Rl(Array.isArray(b),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(xt(b),"]")),Array.isArray(b)&&(g=b)}if((!T||!T.length)&&it($)){var L=M&&M.length,O=$({xAxis:k?vs(vs({},k),{},{ticks:L?M:k.ticks}):void 0,width:m,height:i,offset:o},L?!0:y);Rl(Array.isArray(O),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(xt(O),"]")),Array.isArray(O)&&(T=O)}return se.createElement("g",{className:"recharts-cartesian-grid"},se.createElement(eh,{fill:d.fill,fillOpacity:d.fillOpacity,x:d.x,y:d.y,width:d.width,height:d.height,ry:d.ry}),se.createElement(sh,Xa({},d,{offset:o,horizontalPoints:g,xAxis:k,yAxis:z})),se.createElement(ah,Xa({},d,{offset:o,verticalPoints:T,xAxis:k,yAxis:z})),se.createElement(th,Xa({},d,{horizontalPoints:g})),se.createElement(rh,Xa({},d,{verticalPoints:T})))}et.displayName="CartesianGrid";var lh=["type","layout","connectNulls","ref"],oh=["key"];function qt(s){"@babel/helpers - typeof";return qt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},qt(s)}function Kl(s,a){if(s==null)return{};var t=ch(s,a),r,n;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(s);for(n=0;n<l.length;n++)r=l[n],!(a.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(s,r)&&(t[r]=s[r])}return t}function ch(s,a){if(s==null)return{};var t={};for(var r in s)if(Object.prototype.hasOwnProperty.call(s,r)){if(a.indexOf(r)>=0)continue;t[r]=s[r]}return t}function nr(){return nr=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(s[r]=t[r])}return s},nr.apply(this,arguments)}function Ql(s,a){var t=Object.keys(s);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(s);a&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),t.push.apply(t,r)}return t}function Ps(s){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?Ql(Object(t),!0).forEach(function(r){Vs(s,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(t)):Ql(Object(t)).forEach(function(r){Object.defineProperty(s,r,Object.getOwnPropertyDescriptor(t,r))})}return s}function wt(s){return hh(s)||uh(s)||mh(s)||dh()}function dh(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mh(s,a){if(s){if(typeof s=="string")return bi(s,a);var t=Object.prototype.toString.call(s).slice(8,-1);if(t==="Object"&&s.constructor&&(t=s.constructor.name),t==="Map"||t==="Set")return Array.from(s);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return bi(s,a)}}function uh(s){if(typeof Symbol<"u"&&s[Symbol.iterator]!=null||s["@@iterator"]!=null)return Array.from(s)}function hh(s){if(Array.isArray(s))return bi(s)}function bi(s,a){(a==null||a>s.length)&&(a=s.length);for(var t=0,r=new Array(a);t<a;t++)r[t]=s[t];return r}function xh(s,a){if(!(s instanceof a))throw new TypeError("Cannot call a class as a function")}function Zl(s,a){for(var t=0;t<a.length;t++){var r=a[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(s,Qo(r.key),r)}}function ph(s,a,t){return a&&Zl(s.prototype,a),t&&Zl(s,t),Object.defineProperty(s,"prototype",{writable:!1}),s}function gh(s,a,t){return a=tn(a),fh(s,Ko()?Reflect.construct(a,t||[],tn(s).constructor):a.apply(s,t))}function fh(s,a){if(a&&(qt(a)==="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return jh(s)}function jh(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function Ko(){try{var s=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ko=function(){return!!s})()}function tn(s){return tn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tn(s)}function vh(s,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(a&&a.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),Object.defineProperty(s,"prototype",{writable:!1}),a&&Ni(s,a)}function Ni(s,a){return Ni=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},Ni(s,a)}function Vs(s,a,t){return a=Qo(a),a in s?Object.defineProperty(s,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[a]=t,s}function Qo(s){var a=yh(s,"string");return qt(a)=="symbol"?a:a+""}function yh(s,a){if(qt(s)!="object"||!s)return s;var t=s[Symbol.toPrimitive];if(t!==void 0){var r=t.call(s,a);if(qt(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}var Gt=(function(s){function a(){var t;xh(this,a);for(var r=arguments.length,n=new Array(r),l=0;l<r;l++)n[l]=arguments[l];return t=gh(this,a,[].concat(n)),Vs(t,"state",{isAnimationFinished:!0,totalLength:0}),Vs(t,"generateSimpleStrokeDasharray",function(c,m){return"".concat(m,"px ").concat(c-m,"px")}),Vs(t,"getStrokeDasharray",function(c,m,i){var o=i.reduce(function(M,k){return M+k});if(!o)return t.generateSimpleStrokeDasharray(m,c);for(var d=Math.floor(c/o),p=c%o,x=m-c,f=[],v=0,y=0;v<i.length;y+=i[v],++v)if(y+i[v]>p){f=[].concat(wt(i.slice(0,v)),[p-y]);break}var j=f.length%2===0?[0,x]:[x];return[].concat(wt(a.repeat(i,d)),wt(f),j).map(function(M){return"".concat(M,"px")}).join(", ")}),Vs(t,"id",Ao("recharts-line-")),Vs(t,"pathRef",function(c){t.mainCurve=c}),Vs(t,"handleAnimationEnd",function(){t.setState({isAnimationFinished:!0}),t.props.onAnimationEnd&&t.props.onAnimationEnd()}),Vs(t,"handleAnimationStart",function(){t.setState({isAnimationFinished:!1}),t.props.onAnimationStart&&t.props.onAnimationStart()}),t}return vh(a,s),ph(a,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var r=this.getTotalLength();this.setState({totalLength:r})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var r=this.getTotalLength();r!==this.state.totalLength&&this.setState({totalLength:r})}}},{key:"getTotalLength",value:function(){var r=this.mainCurve;try{return r&&r.getTotalLength&&r.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(r,n){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var l=this.props,c=l.points,m=l.xAxis,i=l.yAxis,o=l.layout,d=l.children,p=wm(d,_m);if(!p)return null;var x=function(y,j){return{x:y.x,y:y.y,value:y.value,errorVal:Kr(y.payload,j)}},f={clipPath:r?"url(#clipPath-".concat(n,")"):null};return se.createElement(Sa,f,p.map(function(v){return se.cloneElement(v,{key:"bar-".concat(v.props.dataKey),data:c,xAxis:m,yAxis:i,layout:o,dataPointFormatter:x})}))}},{key:"renderDots",value:function(r,n,l){var c=this.props.isAnimationActive;if(c&&!this.state.isAnimationFinished)return null;var m=this.props,i=m.dot,o=m.points,d=m.dataKey,p=Us(this.props,!1),x=Us(i,!0),f=o.map(function(y,j){var M=Ps(Ps(Ps({key:"dot-".concat(j),r:3},p),x),{},{index:j,cx:y.x,cy:y.y,value:y.value,dataKey:d,payload:y.payload,points:o});return a.renderDotItem(i,M)}),v={clipPath:r?"url(#clipPath-".concat(n?"":"dots-").concat(l,")"):null};return se.createElement(Sa,nr({className:"recharts-line-dots",key:"dots"},v),f)}},{key:"renderCurveStatically",value:function(r,n,l,c){var m=this.props,i=m.type,o=m.layout,d=m.connectNulls;m.ref;var p=Kl(m,lh),x=Ps(Ps(Ps({},Us(p,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:n?"url(#clipPath-".concat(l,")"):null,points:r},c),{},{type:i,layout:o,connectNulls:d});return se.createElement(qr,nr({},x,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(r,n){var l=this,c=this.props,m=c.points,i=c.strokeDasharray,o=c.isAnimationActive,d=c.animationBegin,p=c.animationDuration,x=c.animationEasing,f=c.animationId,v=c.animateNewValues,y=c.width,j=c.height,M=this.state,k=M.prevPoints,z=M.totalLength;return se.createElement(So,{begin:d,duration:p,isActive:o,easing:x,from:{t:0},to:{t:1},key:"line-".concat(f),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function($){var u=$.t;if(k){var g=k.length/m.length,T=m.map(function(P,F){var C=Math.floor(F*g);if(k[C]){var N=k[C],V=Bs(N.x,P.x),E=Bs(N.y,P.y);return Ps(Ps({},P),{},{x:V(u),y:E(u)})}if(v){var ee=Bs(y*2,P.x),ue=Bs(j/2,P.y);return Ps(Ps({},P),{},{x:ee(u),y:ue(u)})}return Ps(Ps({},P),{},{x:P.x,y:P.y})});return l.renderCurveStatically(T,r,n)}var h=Bs(0,z),b=h(u),L;if(i){var O="".concat(i).split(/[,\s]+/gim).map(function(P){return parseFloat(P)});L=l.getStrokeDasharray(b,z,O)}else L=l.generateSimpleStrokeDasharray(z,b);return l.renderCurveStatically(m,r,n,{strokeDasharray:L})})}},{key:"renderCurve",value:function(r,n){var l=this.props,c=l.points,m=l.isAnimationActive,i=this.state,o=i.prevPoints,d=i.totalLength;return m&&c&&c.length&&(!o&&d>0||!fi(o,c))?this.renderCurveWithAnimation(r,n):this.renderCurveStatically(c,r,n)}},{key:"render",value:function(){var r,n=this.props,l=n.hide,c=n.dot,m=n.points,i=n.className,o=n.xAxis,d=n.yAxis,p=n.top,x=n.left,f=n.width,v=n.height,y=n.isAnimationActive,j=n.id;if(l||!m||!m.length)return null;var M=this.state.isAnimationFinished,k=m.length===1,z=Br("recharts-line",i),$=o&&o.allowDataOverflow,u=d&&d.allowDataOverflow,g=$||u,T=lr(j)?this.id:j,h=(r=Us(c,!1))!==null&&r!==void 0?r:{r:3,strokeWidth:2},b=h.r,L=b===void 0?3:b,O=h.strokeWidth,P=O===void 0?2:O,F=Do(c)?c:{},C=F.clipDot,N=C===void 0?!0:C,V=L*2+P;return se.createElement(Sa,{className:z},$||u?se.createElement("defs",null,se.createElement("clipPath",{id:"clipPath-".concat(T)},se.createElement("rect",{x:$?x:x-f/2,y:u?p:p-v/2,width:$?f:f*2,height:u?v:v*2})),!N&&se.createElement("clipPath",{id:"clipPath-dots-".concat(T)},se.createElement("rect",{x:x-V/2,y:p-V/2,width:f+V,height:v+V}))):null,!k&&this.renderCurve(g,T),this.renderErrorBar(g,T),(k||c)&&this.renderDots(g,N,T),(!y||M)&&Mo.renderCallByParent(this.props,m))}}],[{key:"getDerivedStateFromProps",value:function(r,n){return r.animationId!==n.prevAnimationId?{prevAnimationId:r.animationId,curPoints:r.points,prevPoints:n.curPoints}:r.points!==n.curPoints?{curPoints:r.points}:null}},{key:"repeat",value:function(r,n){for(var l=r.length%2!==0?[].concat(wt(r),[0]):r,c=[],m=0;m<n;++m)c=[].concat(wt(c),wt(l));return c}},{key:"renderDotItem",value:function(r,n){var l;if(se.isValidElement(r))l=se.cloneElement(r,n);else if(it(r))l=r(n);else{var c=n.key,m=Kl(n,oh),i=Br("recharts-line-dot",typeof r!="boolean"?r.className:"");l=se.createElement(ko,nr({key:c},m,{className:i}))}return l}}])})(w.PureComponent);Vs(Gt,"displayName","Line");Vs(Gt,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!Po.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});Vs(Gt,"getComposedData",function(s){var a=s.props,t=s.xAxis,r=s.yAxis,n=s.xAxisTicks,l=s.yAxisTicks,c=s.dataKey,m=s.bandSize,i=s.displayedData,o=s.offset,d=a.layout,p=i.map(function(x,f){var v=Kr(x,c);return d==="horizontal"?{x:Qr({axis:t,ticks:n,bandSize:m,entry:x,index:f}),y:lr(v)?null:r.scale(v),value:v,payload:x}:{x:lr(v)?null:t.scale(v),y:Qr({axis:r,ticks:l,bandSize:m,entry:x,index:f}),value:v,payload:x}});return Ps({points:p,layout:d},o)});var bh=["layout","type","stroke","connectNulls","isRange","ref"],Nh=["key"],Zo;function Yt(s){"@babel/helpers - typeof";return Yt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Yt(s)}function Jo(s,a){if(s==null)return{};var t=wh(s,a),r,n;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(s);for(n=0;n<l.length;n++)r=l[n],!(a.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(s,r)&&(t[r]=s[r])}return t}function wh(s,a){if(s==null)return{};var t={};for(var r in s)if(Object.prototype.hasOwnProperty.call(s,r)){if(a.indexOf(r)>=0)continue;t[r]=s[r]}return t}function st(){return st=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(s[r]=t[r])}return s},st.apply(this,arguments)}function Jl(s,a){var t=Object.keys(s);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(s);a&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),t.push.apply(t,r)}return t}function ka(s){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?Jl(Object(t),!0).forEach(function(r){ia(s,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(t)):Jl(Object(t)).forEach(function(r){Object.defineProperty(s,r,Object.getOwnPropertyDescriptor(t,r))})}return s}function _h(s,a){if(!(s instanceof a))throw new TypeError("Cannot call a class as a function")}function Xl(s,a){for(var t=0;t<a.length;t++){var r=a[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(s,ec(r.key),r)}}function Ch(s,a,t){return a&&Xl(s.prototype,a),t&&Xl(s,t),Object.defineProperty(s,"prototype",{writable:!1}),s}function kh(s,a,t){return a=rn(a),Sh(s,Xo()?Reflect.construct(a,t||[],rn(s).constructor):a.apply(s,t))}function Sh(s,a){if(a&&(Yt(a)==="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Dh(s)}function Dh(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function Xo(){try{var s=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Xo=function(){return!!s})()}function rn(s){return rn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},rn(s)}function Mh(s,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(a&&a.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),Object.defineProperty(s,"prototype",{writable:!1}),a&&wi(s,a)}function wi(s,a){return wi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},wi(s,a)}function ia(s,a,t){return a=ec(a),a in s?Object.defineProperty(s,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[a]=t,s}function ec(s){var a=Ah(s,"string");return Yt(a)=="symbol"?a:a+""}function Ah(s,a){if(Yt(s)!="object"||!s)return s;var t=s[Symbol.toPrimitive];if(t!==void 0){var r=t.call(s,a);if(Yt(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}var Ya=(function(s){function a(){var t;_h(this,a);for(var r=arguments.length,n=new Array(r),l=0;l<r;l++)n[l]=arguments[l];return t=kh(this,a,[].concat(n)),ia(t,"state",{isAnimationFinished:!0}),ia(t,"id",Ao("recharts-area-")),ia(t,"handleAnimationEnd",function(){var c=t.props.onAnimationEnd;t.setState({isAnimationFinished:!0}),it(c)&&c()}),ia(t,"handleAnimationStart",function(){var c=t.props.onAnimationStart;t.setState({isAnimationFinished:!1}),it(c)&&c()}),t}return Mh(a,s),Ch(a,[{key:"renderDots",value:function(r,n,l){var c=this.props.isAnimationActive,m=this.state.isAnimationFinished;if(c&&!m)return null;var i=this.props,o=i.dot,d=i.points,p=i.dataKey,x=Us(this.props,!1),f=Us(o,!0),v=d.map(function(j,M){var k=ka(ka(ka({key:"dot-".concat(M),r:3},x),f),{},{index:M,cx:j.x,cy:j.y,dataKey:p,value:j.value,payload:j.payload,points:d});return a.renderDotItem(o,k)}),y={clipPath:r?"url(#clipPath-".concat(n?"":"dots-").concat(l,")"):null};return se.createElement(Sa,st({className:"recharts-area-dots"},y),v)}},{key:"renderHorizontalRect",value:function(r){var n=this.props,l=n.baseLine,c=n.points,m=n.strokeWidth,i=c[0].x,o=c[c.length-1].x,d=r*Math.abs(i-o),p=Pr(c.map(function(x){return x.y||0}));return Ds(l)&&typeof l=="number"?p=Math.max(l,p):l&&Array.isArray(l)&&l.length&&(p=Math.max(Pr(l.map(function(x){return x.y||0})),p)),Ds(p)?se.createElement("rect",{x:i<o?i:i-d,y:0,width:d,height:Math.floor(p+(m?parseInt("".concat(m),10):1))}):null}},{key:"renderVerticalRect",value:function(r){var n=this.props,l=n.baseLine,c=n.points,m=n.strokeWidth,i=c[0].y,o=c[c.length-1].y,d=r*Math.abs(i-o),p=Pr(c.map(function(x){return x.x||0}));return Ds(l)&&typeof l=="number"?p=Math.max(l,p):l&&Array.isArray(l)&&l.length&&(p=Math.max(Pr(l.map(function(x){return x.x||0})),p)),Ds(p)?se.createElement("rect",{x:0,y:i<o?i:i-d,width:p+(m?parseInt("".concat(m),10):1),height:Math.floor(d)}):null}},{key:"renderClipRect",value:function(r){var n=this.props.layout;return n==="vertical"?this.renderVerticalRect(r):this.renderHorizontalRect(r)}},{key:"renderAreaStatically",value:function(r,n,l,c){var m=this.props,i=m.layout,o=m.type,d=m.stroke,p=m.connectNulls,x=m.isRange;m.ref;var f=Jo(m,bh);return se.createElement(Sa,{clipPath:l?"url(#clipPath-".concat(c,")"):null},se.createElement(qr,st({},Us(f,!0),{points:r,connectNulls:p,type:o,baseLine:n,layout:i,stroke:"none",className:"recharts-area-area"})),d!=="none"&&se.createElement(qr,st({},Us(this.props,!1),{className:"recharts-area-curve",layout:i,type:o,connectNulls:p,fill:"none",points:r})),d!=="none"&&x&&se.createElement(qr,st({},Us(this.props,!1),{className:"recharts-area-curve",layout:i,type:o,connectNulls:p,fill:"none",points:n})))}},{key:"renderAreaWithAnimation",value:function(r,n){var l=this,c=this.props,m=c.points,i=c.baseLine,o=c.isAnimationActive,d=c.animationBegin,p=c.animationDuration,x=c.animationEasing,f=c.animationId,v=this.state,y=v.prevPoints,j=v.prevBaseLine;return se.createElement(So,{begin:d,duration:p,isActive:o,easing:x,from:{t:0},to:{t:1},key:"area-".concat(f),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(M){var k=M.t;if(y){var z=y.length/m.length,$=m.map(function(h,b){var L=Math.floor(b*z);if(y[L]){var O=y[L],P=Bs(O.x,h.x),F=Bs(O.y,h.y);return ka(ka({},h),{},{x:P(k),y:F(k)})}return h}),u;if(Ds(i)&&typeof i=="number"){var g=Bs(j,i);u=g(k)}else if(lr(i)||Cm(i)){var T=Bs(j,0);u=T(k)}else u=i.map(function(h,b){var L=Math.floor(b*z);if(j[L]){var O=j[L],P=Bs(O.x,h.x),F=Bs(O.y,h.y);return ka(ka({},h),{},{x:P(k),y:F(k)})}return h});return l.renderAreaStatically($,u,r,n)}return se.createElement(Sa,null,se.createElement("defs",null,se.createElement("clipPath",{id:"animationClipPath-".concat(n)},l.renderClipRect(k))),se.createElement(Sa,{clipPath:"url(#animationClipPath-".concat(n,")")},l.renderAreaStatically(m,i,r,n)))})}},{key:"renderArea",value:function(r,n){var l=this.props,c=l.points,m=l.baseLine,i=l.isAnimationActive,o=this.state,d=o.prevPoints,p=o.prevBaseLine,x=o.totalLength;return i&&c&&c.length&&(!d&&x>0||!fi(d,c)||!fi(p,m))?this.renderAreaWithAnimation(r,n):this.renderAreaStatically(c,m,r,n)}},{key:"render",value:function(){var r,n=this.props,l=n.hide,c=n.dot,m=n.points,i=n.className,o=n.top,d=n.left,p=n.xAxis,x=n.yAxis,f=n.width,v=n.height,y=n.isAnimationActive,j=n.id;if(l||!m||!m.length)return null;var M=this.state.isAnimationFinished,k=m.length===1,z=Br("recharts-area",i),$=p&&p.allowDataOverflow,u=x&&x.allowDataOverflow,g=$||u,T=lr(j)?this.id:j,h=(r=Us(c,!1))!==null&&r!==void 0?r:{r:3,strokeWidth:2},b=h.r,L=b===void 0?3:b,O=h.strokeWidth,P=O===void 0?2:O,F=Do(c)?c:{},C=F.clipDot,N=C===void 0?!0:C,V=L*2+P;return se.createElement(Sa,{className:z},$||u?se.createElement("defs",null,se.createElement("clipPath",{id:"clipPath-".concat(T)},se.createElement("rect",{x:$?d:d-f/2,y:u?o:o-v/2,width:$?f:f*2,height:u?v:v*2})),!N&&se.createElement("clipPath",{id:"clipPath-dots-".concat(T)},se.createElement("rect",{x:d-V/2,y:o-V/2,width:f+V,height:v+V}))):null,k?null:this.renderArea(g,T),(c||k)&&this.renderDots(g,N,T),(!y||M)&&Mo.renderCallByParent(this.props,m))}}],[{key:"getDerivedStateFromProps",value:function(r,n){return r.animationId!==n.prevAnimationId?{prevAnimationId:r.animationId,curPoints:r.points,curBaseLine:r.baseLine,prevPoints:n.curPoints,prevBaseLine:n.curBaseLine}:r.points!==n.curPoints||r.baseLine!==n.curBaseLine?{curPoints:r.points,curBaseLine:r.baseLine}:null}}])})(w.PureComponent);Zo=Ya;ia(Ya,"displayName","Area");ia(Ya,"defaultProps",{stroke:"#3182bd",fill:"#3182bd",fillOpacity:.6,xAxisId:0,yAxisId:0,legendType:"line",connectNulls:!1,points:[],dot:!1,activeDot:!0,hide:!1,isAnimationActive:!Po.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"});ia(Ya,"getBaseValue",function(s,a,t,r){var n=s.layout,l=s.baseValue,c=a.props.baseValue,m=c??l;if(Ds(m)&&typeof m=="number")return m;var i=n==="horizontal"?r:t,o=i.scale.domain();if(i.type==="number"){var d=Math.max(o[0],o[1]),p=Math.min(o[0],o[1]);return m==="dataMin"?p:m==="dataMax"||d<0?d:Math.max(Math.min(o[0],o[1]),0)}return m==="dataMin"?o[0]:m==="dataMax"?o[1]:o[0]});ia(Ya,"getComposedData",function(s){var a=s.props,t=s.item,r=s.xAxis,n=s.yAxis,l=s.xAxisTicks,c=s.yAxisTicks,m=s.bandSize,i=s.dataKey,o=s.stackedData,d=s.dataStartIndex,p=s.displayedData,x=s.offset,f=a.layout,v=o&&o.length,y=Zo.getBaseValue(a,t,r,n),j=f==="horizontal",M=!1,k=p.map(function($,u){var g;v?g=o[d+u]:(g=Kr($,i),Array.isArray(g)?M=!0:g=[y,g]);var T=g[1]==null||v&&Kr($,i)==null;return j?{x:Qr({axis:r,ticks:l,bandSize:m,entry:$,index:u}),y:T?null:n.scale(g[1]),value:g,payload:$}:{x:T?null:r.scale(g[1]),y:Qr({axis:n,ticks:c,bandSize:m,entry:$,index:u}),value:g,payload:$}}),z;return v||M?z=k.map(function($){var u=Array.isArray($.value)?$.value[0]:null;return j?{x:$.x,y:u!=null&&$.y!=null?n.scale(u):null}:{x:u!=null?r.scale(u):null,y:$.y}}):z=j?n.scale(y):r.scale(y),ka({points:k,baseLine:z,layout:f,isRange:M},x)});ia(Ya,"renderDotItem",function(s,a){var t;if(se.isValidElement(s))t=se.cloneElement(s,a);else if(it(s))t=s(a);else{var r=Br("recharts-area-dot",typeof s!="boolean"?s.className:""),n=a.key,l=Jo(a,Nh);t=se.createElement(ko,st({},l,{key:n,className:r}))}return t});var sc=Eo({chartName:"LineChart",GraphicalChild:Gt,axisComponents:[{axisType:"xAxis",AxisComp:Aa},{axisType:"yAxis",AxisComp:Pa}],formatAxisMap:Oo}),Ph=Eo({chartName:"AreaChart",GraphicalChild:Ya,axisComponents:[{axisType:"xAxis",AxisComp:Aa},{axisType:"yAxis",AxisComp:Pa}],formatAxisMap:Oo});function Eh(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}//! moment.js
//! version : 2.30.1
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
var ac;function J(){return ac.apply(null,arguments)}function Oh(s){ac=s}function Qs(s){return s instanceof Array||Object.prototype.toString.call(s)==="[object Array]"}function nt(s){return s!=null&&Object.prototype.toString.call(s)==="[object Object]"}function Ve(s,a){return Object.prototype.hasOwnProperty.call(s,a)}function Ui(s){if(Object.getOwnPropertyNames)return Object.getOwnPropertyNames(s).length===0;var a;for(a in s)if(Ve(s,a))return!1;return!0}function ks(s){return s===void 0}function ba(s){return typeof s=="number"||Object.prototype.toString.call(s)==="[object Number]"}function yr(s){return s instanceof Date||Object.prototype.toString.call(s)==="[object Date]"}function tc(s,a){var t=[],r,n=s.length;for(r=0;r<n;++r)t.push(a(s[r],r));return t}function Oa(s,a){for(var t in a)Ve(a,t)&&(s[t]=a[t]);return Ve(a,"toString")&&(s.toString=a.toString),Ve(a,"valueOf")&&(s.valueOf=a.valueOf),s}function da(s,a,t,r){return kc(s,a,t,r,!0).utc()}function zh(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}}function Pe(s){return s._pf==null&&(s._pf=zh()),s._pf}var _i;Array.prototype.some?_i=Array.prototype.some:_i=function(s){var a=Object(this),t=a.length>>>0,r;for(r=0;r<t;r++)if(r in a&&s.call(this,a[r],r,a))return!0;return!1};function Bi(s){var a=null,t=!1,r=s._d&&!isNaN(s._d.getTime());if(r&&(a=Pe(s),t=_i.call(a.parsedDateParts,function(n){return n!=null}),r=a.overflow<0&&!a.empty&&!a.invalidEra&&!a.invalidMonth&&!a.invalidWeekday&&!a.weekdayMismatch&&!a.nullInput&&!a.invalidFormat&&!a.userInvalidated&&(!a.meridiem||a.meridiem&&t),s._strict&&(r=r&&a.charsLeftOver===0&&a.unusedTokens.length===0&&a.bigHour===void 0)),Object.isFrozen==null||!Object.isFrozen(s))s._isValid=r;else return r;return s._isValid}function bn(s){var a=da(NaN);return s!=null?Oa(Pe(a),s):Pe(a).userInvalidated=!0,a}var eo=J.momentProperties=[],li=!1;function Wi(s,a){var t,r,n,l=eo.length;if(ks(a._isAMomentObject)||(s._isAMomentObject=a._isAMomentObject),ks(a._i)||(s._i=a._i),ks(a._f)||(s._f=a._f),ks(a._l)||(s._l=a._l),ks(a._strict)||(s._strict=a._strict),ks(a._tzm)||(s._tzm=a._tzm),ks(a._isUTC)||(s._isUTC=a._isUTC),ks(a._offset)||(s._offset=a._offset),ks(a._pf)||(s._pf=Pe(a)),ks(a._locale)||(s._locale=a._locale),l>0)for(t=0;t<l;t++)r=eo[t],n=a[r],ks(n)||(s[r]=n);return s}function br(s){Wi(this,s),this._d=new Date(s._d!=null?s._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),li===!1&&(li=!0,J.updateOffset(this),li=!1)}function Zs(s){return s instanceof br||s!=null&&s._isAMomentObject!=null}function rc(s){J.suppressDeprecationWarnings===!1&&typeof console<"u"&&console.warn&&console.warn("Deprecation warning: "+s)}function Is(s,a){var t=!0;return Oa(function(){if(J.deprecationHandler!=null&&J.deprecationHandler(null,s),t){var r=[],n,l,c,m=arguments.length;for(l=0;l<m;l++){if(n="",typeof arguments[l]=="object"){n+=`
[`+l+"] ";for(c in arguments[0])Ve(arguments[0],c)&&(n+=c+": "+arguments[0][c]+", ");n=n.slice(0,-2)}else n=arguments[l];r.push(n)}rc(s+`
Arguments: `+Array.prototype.slice.call(r).join("")+`
`+new Error().stack),t=!1}return a.apply(this,arguments)},a)}var so={};function nc(s,a){J.deprecationHandler!=null&&J.deprecationHandler(s,a),so[s]||(rc(a),so[s]=!0)}J.suppressDeprecationWarnings=!1;J.deprecationHandler=null;function ma(s){return typeof Function<"u"&&s instanceof Function||Object.prototype.toString.call(s)==="[object Function]"}function Th(s){var a,t;for(t in s)Ve(s,t)&&(a=s[t],ma(a)?this[t]=a:this["_"+t]=a);this._config=s,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function Ci(s,a){var t=Oa({},s),r;for(r in a)Ve(a,r)&&(nt(s[r])&&nt(a[r])?(t[r]={},Oa(t[r],s[r]),Oa(t[r],a[r])):a[r]!=null?t[r]=a[r]:delete t[r]);for(r in s)Ve(s,r)&&!Ve(a,r)&&nt(s[r])&&(t[r]=Oa({},t[r]));return t}function Hi(s){s!=null&&this.set(s)}var ki;Object.keys?ki=Object.keys:ki=function(s){var a,t=[];for(a in s)Ve(s,a)&&t.push(a);return t};var Fh={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function Rh(s,a,t){var r=this._calendar[s]||this._calendar.sameElse;return ma(r)?r.call(a,t):r}function ca(s,a,t){var r=""+Math.abs(s),n=a-r.length,l=s>=0;return(l?t?"+":"":"-")+Math.pow(10,Math.max(0,n)).toString().substr(1)+r}var Ki=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,zr=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,oi={},Tt={};function ye(s,a,t,r){var n=r;typeof r=="string"&&(n=function(){return this[r]()}),s&&(Tt[s]=n),a&&(Tt[a[0]]=function(){return ca(n.apply(this,arguments),a[1],a[2])}),t&&(Tt[t]=function(){return this.localeData().ordinal(n.apply(this,arguments),s)})}function Lh(s){return s.match(/\[[\s\S]/)?s.replace(/^\[|\]$/g,""):s.replace(/\\/g,"")}function Ih(s){var a=s.match(Ki),t,r;for(t=0,r=a.length;t<r;t++)Tt[a[t]]?a[t]=Tt[a[t]]:a[t]=Lh(a[t]);return function(n){var l="",c;for(c=0;c<r;c++)l+=ma(a[c])?a[c].call(n,s):a[c];return l}}function Gr(s,a){return s.isValid()?(a=ic(a,s.localeData()),oi[a]=oi[a]||Ih(a),oi[a](s)):s.localeData().invalidDate()}function ic(s,a){var t=5;function r(n){return a.longDateFormat(n)||n}for(zr.lastIndex=0;t>=0&&zr.test(s);)s=s.replace(zr,r),zr.lastIndex=0,t-=1;return s}var $h={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function qh(s){var a=this._longDateFormat[s],t=this._longDateFormat[s.toUpperCase()];return a||!t?a:(this._longDateFormat[s]=t.match(Ki).map(function(r){return r==="MMMM"||r==="MM"||r==="DD"||r==="dddd"?r.slice(1):r}).join(""),this._longDateFormat[s])}var Yh="Invalid date";function Gh(){return this._invalidDate}var Vh="%d",Uh=/\d{1,2}/;function Bh(s){return this._ordinal.replace("%d",s)}var Wh={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function Hh(s,a,t,r){var n=this._relativeTime[t];return ma(n)?n(s,a,t,r):n.replace(/%d/i,s)}function Kh(s,a){var t=this._relativeTime[s>0?"future":"past"];return ma(t)?t(a):t.replace(/%s/i,a)}var ao={D:"date",dates:"date",date:"date",d:"day",days:"day",day:"day",e:"weekday",weekdays:"weekday",weekday:"weekday",E:"isoWeekday",isoweekdays:"isoWeekday",isoweekday:"isoWeekday",DDD:"dayOfYear",dayofyears:"dayOfYear",dayofyear:"dayOfYear",h:"hour",hours:"hour",hour:"hour",ms:"millisecond",milliseconds:"millisecond",millisecond:"millisecond",m:"minute",minutes:"minute",minute:"minute",M:"month",months:"month",month:"month",Q:"quarter",quarters:"quarter",quarter:"quarter",s:"second",seconds:"second",second:"second",gg:"weekYear",weekyears:"weekYear",weekyear:"weekYear",GG:"isoWeekYear",isoweekyears:"isoWeekYear",isoweekyear:"isoWeekYear",w:"week",weeks:"week",week:"week",W:"isoWeek",isoweeks:"isoWeek",isoweek:"isoWeek",y:"year",years:"year",year:"year"};function $s(s){return typeof s=="string"?ao[s]||ao[s.toLowerCase()]:void 0}function Qi(s){var a={},t,r;for(r in s)Ve(s,r)&&(t=$s(r),t&&(a[t]=s[r]));return a}var Qh={date:9,day:11,weekday:11,isoWeekday:11,dayOfYear:4,hour:13,millisecond:16,minute:14,month:8,quarter:7,second:15,weekYear:1,isoWeekYear:1,week:5,isoWeek:5,year:1};function Zh(s){var a=[],t;for(t in s)Ve(s,t)&&a.push({unit:t,priority:Qh[t]});return a.sort(function(r,n){return r.priority-n.priority}),a}var lc=/\d/,Os=/\d\d/,oc=/\d{3}/,Zi=/\d{4}/,Nn=/[+-]?\d{6}/,as=/\d\d?/,cc=/\d\d\d\d?/,dc=/\d\d\d\d\d\d?/,wn=/\d{1,3}/,Ji=/\d{1,4}/,_n=/[+-]?\d{1,6}/,Vt=/\d+/,Cn=/[+-]?\d+/,Jh=/Z|[+-]\d\d:?\d\d/gi,kn=/Z|[+-]\d\d(?::?\d\d)?/gi,Xh=/[+-]?\d+(\.\d{1,3})?/,Nr=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,Ut=/^[1-9]\d?/,Xi=/^([1-9]\d|\d)/,nn;nn={};function he(s,a,t){nn[s]=ma(a)?a:function(r,n){return r&&t?t:a}}function ex(s,a){return Ve(nn,s)?nn[s](a._strict,a._locale):new RegExp(sx(s))}function sx(s){return va(s.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(a,t,r,n,l){return t||r||n||l}))}function va(s){return s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function Fs(s){return s<0?Math.ceil(s)||0:Math.floor(s)}function $e(s){var a=+s,t=0;return a!==0&&isFinite(a)&&(t=Fs(a)),t}var Si={};function Je(s,a){var t,r=a,n;for(typeof s=="string"&&(s=[s]),ba(a)&&(r=function(l,c){c[a]=$e(l)}),n=s.length,t=0;t<n;t++)Si[s[t]]=r}function wr(s,a){Je(s,function(t,r,n,l){n._w=n._w||{},a(t,n._w,n,l)})}function ax(s,a,t){a!=null&&Ve(Si,s)&&Si[s](a,t._a,t,s)}function Sn(s){return s%4===0&&s%100!==0||s%400===0}var bs=0,fa=1,na=2,xs=3,Hs=4,ja=5,at=6,tx=7,rx=8;ye("Y",0,0,function(){var s=this.year();return s<=9999?ca(s,4):"+"+s});ye(0,["YY",2],0,function(){return this.year()%100});ye(0,["YYYY",4],0,"year");ye(0,["YYYYY",5],0,"year");ye(0,["YYYYYY",6,!0],0,"year");he("Y",Cn);he("YY",as,Os);he("YYYY",Ji,Zi);he("YYYYY",_n,Nn);he("YYYYYY",_n,Nn);Je(["YYYYY","YYYYYY"],bs);Je("YYYY",function(s,a){a[bs]=s.length===2?J.parseTwoDigitYear(s):$e(s)});Je("YY",function(s,a){a[bs]=J.parseTwoDigitYear(s)});Je("Y",function(s,a){a[bs]=parseInt(s,10)});function ir(s){return Sn(s)?366:365}J.parseTwoDigitYear=function(s){return $e(s)+($e(s)>68?1900:2e3)};var mc=Bt("FullYear",!0);function nx(){return Sn(this.year())}function Bt(s,a){return function(t){return t!=null?(uc(this,s,t),J.updateOffset(this,a),this):xr(this,s)}}function xr(s,a){if(!s.isValid())return NaN;var t=s._d,r=s._isUTC;switch(a){case"Milliseconds":return r?t.getUTCMilliseconds():t.getMilliseconds();case"Seconds":return r?t.getUTCSeconds():t.getSeconds();case"Minutes":return r?t.getUTCMinutes():t.getMinutes();case"Hours":return r?t.getUTCHours():t.getHours();case"Date":return r?t.getUTCDate():t.getDate();case"Day":return r?t.getUTCDay():t.getDay();case"Month":return r?t.getUTCMonth():t.getMonth();case"FullYear":return r?t.getUTCFullYear():t.getFullYear();default:return NaN}}function uc(s,a,t){var r,n,l,c,m;if(!(!s.isValid()||isNaN(t))){switch(r=s._d,n=s._isUTC,a){case"Milliseconds":return void(n?r.setUTCMilliseconds(t):r.setMilliseconds(t));case"Seconds":return void(n?r.setUTCSeconds(t):r.setSeconds(t));case"Minutes":return void(n?r.setUTCMinutes(t):r.setMinutes(t));case"Hours":return void(n?r.setUTCHours(t):r.setHours(t));case"Date":return void(n?r.setUTCDate(t):r.setDate(t));case"FullYear":break;default:return}l=t,c=s.month(),m=s.date(),m=m===29&&c===1&&!Sn(l)?28:m,n?r.setUTCFullYear(l,c,m):r.setFullYear(l,c,m)}}function ix(s){return s=$s(s),ma(this[s])?this[s]():this}function lx(s,a){if(typeof s=="object"){s=Qi(s);var t=Zh(s),r,n=t.length;for(r=0;r<n;r++)this[t[r].unit](s[t[r].unit])}else if(s=$s(s),ma(this[s]))return this[s](a);return this}function ox(s,a){return(s%a+a)%a}var cs;Array.prototype.indexOf?cs=Array.prototype.indexOf:cs=function(s){var a;for(a=0;a<this.length;++a)if(this[a]===s)return a;return-1};function el(s,a){if(isNaN(s)||isNaN(a))return NaN;var t=ox(a,12);return s+=(a-t)/12,t===1?Sn(s)?29:28:31-t%7%2}ye("M",["MM",2],"Mo",function(){return this.month()+1});ye("MMM",0,0,function(s){return this.localeData().monthsShort(this,s)});ye("MMMM",0,0,function(s){return this.localeData().months(this,s)});he("M",as,Ut);he("MM",as,Os);he("MMM",function(s,a){return a.monthsShortRegex(s)});he("MMMM",function(s,a){return a.monthsRegex(s)});Je(["M","MM"],function(s,a){a[fa]=$e(s)-1});Je(["MMM","MMMM"],function(s,a,t,r){var n=t._locale.monthsParse(s,r,t._strict);n!=null?a[fa]=n:Pe(t).invalidMonth=s});var cx="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),hc="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),xc=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,dx=Nr,mx=Nr;function ux(s,a){return s?Qs(this._months)?this._months[s.month()]:this._months[(this._months.isFormat||xc).test(a)?"format":"standalone"][s.month()]:Qs(this._months)?this._months:this._months.standalone}function hx(s,a){return s?Qs(this._monthsShort)?this._monthsShort[s.month()]:this._monthsShort[xc.test(a)?"format":"standalone"][s.month()]:Qs(this._monthsShort)?this._monthsShort:this._monthsShort.standalone}function xx(s,a,t){var r,n,l,c=s.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],r=0;r<12;++r)l=da([2e3,r]),this._shortMonthsParse[r]=this.monthsShort(l,"").toLocaleLowerCase(),this._longMonthsParse[r]=this.months(l,"").toLocaleLowerCase();return t?a==="MMM"?(n=cs.call(this._shortMonthsParse,c),n!==-1?n:null):(n=cs.call(this._longMonthsParse,c),n!==-1?n:null):a==="MMM"?(n=cs.call(this._shortMonthsParse,c),n!==-1?n:(n=cs.call(this._longMonthsParse,c),n!==-1?n:null)):(n=cs.call(this._longMonthsParse,c),n!==-1?n:(n=cs.call(this._shortMonthsParse,c),n!==-1?n:null))}function px(s,a,t){var r,n,l;if(this._monthsParseExact)return xx.call(this,s,a,t);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),r=0;r<12;r++){if(n=da([2e3,r]),t&&!this._longMonthsParse[r]&&(this._longMonthsParse[r]=new RegExp("^"+this.months(n,"").replace(".","")+"$","i"),this._shortMonthsParse[r]=new RegExp("^"+this.monthsShort(n,"").replace(".","")+"$","i")),!t&&!this._monthsParse[r]&&(l="^"+this.months(n,"")+"|^"+this.monthsShort(n,""),this._monthsParse[r]=new RegExp(l.replace(".",""),"i")),t&&a==="MMMM"&&this._longMonthsParse[r].test(s))return r;if(t&&a==="MMM"&&this._shortMonthsParse[r].test(s))return r;if(!t&&this._monthsParse[r].test(s))return r}}function pc(s,a){if(!s.isValid())return s;if(typeof a=="string"){if(/^\d+$/.test(a))a=$e(a);else if(a=s.localeData().monthsParse(a),!ba(a))return s}var t=a,r=s.date();return r=r<29?r:Math.min(r,el(s.year(),t)),s._isUTC?s._d.setUTCMonth(t,r):s._d.setMonth(t,r),s}function gc(s){return s!=null?(pc(this,s),J.updateOffset(this,!0),this):xr(this,"Month")}function gx(){return el(this.year(),this.month())}function fx(s){return this._monthsParseExact?(Ve(this,"_monthsRegex")||fc.call(this),s?this._monthsShortStrictRegex:this._monthsShortRegex):(Ve(this,"_monthsShortRegex")||(this._monthsShortRegex=dx),this._monthsShortStrictRegex&&s?this._monthsShortStrictRegex:this._monthsShortRegex)}function jx(s){return this._monthsParseExact?(Ve(this,"_monthsRegex")||fc.call(this),s?this._monthsStrictRegex:this._monthsRegex):(Ve(this,"_monthsRegex")||(this._monthsRegex=mx),this._monthsStrictRegex&&s?this._monthsStrictRegex:this._monthsRegex)}function fc(){function s(i,o){return o.length-i.length}var a=[],t=[],r=[],n,l,c,m;for(n=0;n<12;n++)l=da([2e3,n]),c=va(this.monthsShort(l,"")),m=va(this.months(l,"")),a.push(c),t.push(m),r.push(m),r.push(c);a.sort(s),t.sort(s),r.sort(s),this._monthsRegex=new RegExp("^("+r.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+t.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+a.join("|")+")","i")}function vx(s,a,t,r,n,l,c){var m;return s<100&&s>=0?(m=new Date(s+400,a,t,r,n,l,c),isFinite(m.getFullYear())&&m.setFullYear(s)):m=new Date(s,a,t,r,n,l,c),m}function pr(s){var a,t;return s<100&&s>=0?(t=Array.prototype.slice.call(arguments),t[0]=s+400,a=new Date(Date.UTC.apply(null,t)),isFinite(a.getUTCFullYear())&&a.setUTCFullYear(s)):a=new Date(Date.UTC.apply(null,arguments)),a}function ln(s,a,t){var r=7+a-t,n=(7+pr(s,0,r).getUTCDay()-a)%7;return-n+r-1}function jc(s,a,t,r,n){var l=(7+t-r)%7,c=ln(s,r,n),m=1+7*(a-1)+l+c,i,o;return m<=0?(i=s-1,o=ir(i)+m):m>ir(s)?(i=s+1,o=m-ir(s)):(i=s,o=m),{year:i,dayOfYear:o}}function gr(s,a,t){var r=ln(s.year(),a,t),n=Math.floor((s.dayOfYear()-r-1)/7)+1,l,c;return n<1?(c=s.year()-1,l=n+ya(c,a,t)):n>ya(s.year(),a,t)?(l=n-ya(s.year(),a,t),c=s.year()+1):(c=s.year(),l=n),{week:l,year:c}}function ya(s,a,t){var r=ln(s,a,t),n=ln(s+1,a,t);return(ir(s)-r+n)/7}ye("w",["ww",2],"wo","week");ye("W",["WW",2],"Wo","isoWeek");he("w",as,Ut);he("ww",as,Os);he("W",as,Ut);he("WW",as,Os);wr(["w","ww","W","WW"],function(s,a,t,r){a[r.substr(0,1)]=$e(s)});function yx(s){return gr(s,this._week.dow,this._week.doy).week}var bx={dow:0,doy:6};function Nx(){return this._week.dow}function wx(){return this._week.doy}function _x(s){var a=this.localeData().week(this);return s==null?a:this.add((s-a)*7,"d")}function Cx(s){var a=gr(this,1,4).week;return s==null?a:this.add((s-a)*7,"d")}ye("d",0,"do","day");ye("dd",0,0,function(s){return this.localeData().weekdaysMin(this,s)});ye("ddd",0,0,function(s){return this.localeData().weekdaysShort(this,s)});ye("dddd",0,0,function(s){return this.localeData().weekdays(this,s)});ye("e",0,0,"weekday");ye("E",0,0,"isoWeekday");he("d",as);he("e",as);he("E",as);he("dd",function(s,a){return a.weekdaysMinRegex(s)});he("ddd",function(s,a){return a.weekdaysShortRegex(s)});he("dddd",function(s,a){return a.weekdaysRegex(s)});wr(["dd","ddd","dddd"],function(s,a,t,r){var n=t._locale.weekdaysParse(s,r,t._strict);n!=null?a.d=n:Pe(t).invalidWeekday=s});wr(["d","e","E"],function(s,a,t,r){a[r]=$e(s)});function kx(s,a){return typeof s!="string"?s:isNaN(s)?(s=a.weekdaysParse(s),typeof s=="number"?s:null):parseInt(s,10)}function Sx(s,a){return typeof s=="string"?a.weekdaysParse(s)%7||7:isNaN(s)?null:s}function sl(s,a){return s.slice(a,7).concat(s.slice(0,a))}var Dx="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),vc="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),Mx="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),Ax=Nr,Px=Nr,Ex=Nr;function Ox(s,a){var t=Qs(this._weekdays)?this._weekdays:this._weekdays[s&&s!==!0&&this._weekdays.isFormat.test(a)?"format":"standalone"];return s===!0?sl(t,this._week.dow):s?t[s.day()]:t}function zx(s){return s===!0?sl(this._weekdaysShort,this._week.dow):s?this._weekdaysShort[s.day()]:this._weekdaysShort}function Tx(s){return s===!0?sl(this._weekdaysMin,this._week.dow):s?this._weekdaysMin[s.day()]:this._weekdaysMin}function Fx(s,a,t){var r,n,l,c=s.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],r=0;r<7;++r)l=da([2e3,1]).day(r),this._minWeekdaysParse[r]=this.weekdaysMin(l,"").toLocaleLowerCase(),this._shortWeekdaysParse[r]=this.weekdaysShort(l,"").toLocaleLowerCase(),this._weekdaysParse[r]=this.weekdays(l,"").toLocaleLowerCase();return t?a==="dddd"?(n=cs.call(this._weekdaysParse,c),n!==-1?n:null):a==="ddd"?(n=cs.call(this._shortWeekdaysParse,c),n!==-1?n:null):(n=cs.call(this._minWeekdaysParse,c),n!==-1?n:null):a==="dddd"?(n=cs.call(this._weekdaysParse,c),n!==-1||(n=cs.call(this._shortWeekdaysParse,c),n!==-1)?n:(n=cs.call(this._minWeekdaysParse,c),n!==-1?n:null)):a==="ddd"?(n=cs.call(this._shortWeekdaysParse,c),n!==-1||(n=cs.call(this._weekdaysParse,c),n!==-1)?n:(n=cs.call(this._minWeekdaysParse,c),n!==-1?n:null)):(n=cs.call(this._minWeekdaysParse,c),n!==-1||(n=cs.call(this._weekdaysParse,c),n!==-1)?n:(n=cs.call(this._shortWeekdaysParse,c),n!==-1?n:null))}function Rx(s,a,t){var r,n,l;if(this._weekdaysParseExact)return Fx.call(this,s,a,t);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),r=0;r<7;r++){if(n=da([2e3,1]).day(r),t&&!this._fullWeekdaysParse[r]&&(this._fullWeekdaysParse[r]=new RegExp("^"+this.weekdays(n,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[r]=new RegExp("^"+this.weekdaysShort(n,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[r]=new RegExp("^"+this.weekdaysMin(n,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[r]||(l="^"+this.weekdays(n,"")+"|^"+this.weekdaysShort(n,"")+"|^"+this.weekdaysMin(n,""),this._weekdaysParse[r]=new RegExp(l.replace(".",""),"i")),t&&a==="dddd"&&this._fullWeekdaysParse[r].test(s))return r;if(t&&a==="ddd"&&this._shortWeekdaysParse[r].test(s))return r;if(t&&a==="dd"&&this._minWeekdaysParse[r].test(s))return r;if(!t&&this._weekdaysParse[r].test(s))return r}}function Lx(s){if(!this.isValid())return s!=null?this:NaN;var a=xr(this,"Day");return s!=null?(s=kx(s,this.localeData()),this.add(s-a,"d")):a}function Ix(s){if(!this.isValid())return s!=null?this:NaN;var a=(this.day()+7-this.localeData()._week.dow)%7;return s==null?a:this.add(s-a,"d")}function $x(s){if(!this.isValid())return s!=null?this:NaN;if(s!=null){var a=Sx(s,this.localeData());return this.day(this.day()%7?a:a-7)}else return this.day()||7}function qx(s){return this._weekdaysParseExact?(Ve(this,"_weekdaysRegex")||al.call(this),s?this._weekdaysStrictRegex:this._weekdaysRegex):(Ve(this,"_weekdaysRegex")||(this._weekdaysRegex=Ax),this._weekdaysStrictRegex&&s?this._weekdaysStrictRegex:this._weekdaysRegex)}function Yx(s){return this._weekdaysParseExact?(Ve(this,"_weekdaysRegex")||al.call(this),s?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(Ve(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=Px),this._weekdaysShortStrictRegex&&s?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)}function Gx(s){return this._weekdaysParseExact?(Ve(this,"_weekdaysRegex")||al.call(this),s?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(Ve(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=Ex),this._weekdaysMinStrictRegex&&s?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)}function al(){function s(d,p){return p.length-d.length}var a=[],t=[],r=[],n=[],l,c,m,i,o;for(l=0;l<7;l++)c=da([2e3,1]).day(l),m=va(this.weekdaysMin(c,"")),i=va(this.weekdaysShort(c,"")),o=va(this.weekdays(c,"")),a.push(m),t.push(i),r.push(o),n.push(m),n.push(i),n.push(o);a.sort(s),t.sort(s),r.sort(s),n.sort(s),this._weekdaysRegex=new RegExp("^("+n.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+r.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+t.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+a.join("|")+")","i")}function tl(){return this.hours()%12||12}function Vx(){return this.hours()||24}ye("H",["HH",2],0,"hour");ye("h",["hh",2],0,tl);ye("k",["kk",2],0,Vx);ye("hmm",0,0,function(){return""+tl.apply(this)+ca(this.minutes(),2)});ye("hmmss",0,0,function(){return""+tl.apply(this)+ca(this.minutes(),2)+ca(this.seconds(),2)});ye("Hmm",0,0,function(){return""+this.hours()+ca(this.minutes(),2)});ye("Hmmss",0,0,function(){return""+this.hours()+ca(this.minutes(),2)+ca(this.seconds(),2)});function yc(s,a){ye(s,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),a)})}yc("a",!0);yc("A",!1);function bc(s,a){return a._meridiemParse}he("a",bc);he("A",bc);he("H",as,Xi);he("h",as,Ut);he("k",as,Ut);he("HH",as,Os);he("hh",as,Os);he("kk",as,Os);he("hmm",cc);he("hmmss",dc);he("Hmm",cc);he("Hmmss",dc);Je(["H","HH"],xs);Je(["k","kk"],function(s,a,t){var r=$e(s);a[xs]=r===24?0:r});Je(["a","A"],function(s,a,t){t._isPm=t._locale.isPM(s),t._meridiem=s});Je(["h","hh"],function(s,a,t){a[xs]=$e(s),Pe(t).bigHour=!0});Je("hmm",function(s,a,t){var r=s.length-2;a[xs]=$e(s.substr(0,r)),a[Hs]=$e(s.substr(r)),Pe(t).bigHour=!0});Je("hmmss",function(s,a,t){var r=s.length-4,n=s.length-2;a[xs]=$e(s.substr(0,r)),a[Hs]=$e(s.substr(r,2)),a[ja]=$e(s.substr(n)),Pe(t).bigHour=!0});Je("Hmm",function(s,a,t){var r=s.length-2;a[xs]=$e(s.substr(0,r)),a[Hs]=$e(s.substr(r))});Je("Hmmss",function(s,a,t){var r=s.length-4,n=s.length-2;a[xs]=$e(s.substr(0,r)),a[Hs]=$e(s.substr(r,2)),a[ja]=$e(s.substr(n))});function Ux(s){return(s+"").toLowerCase().charAt(0)==="p"}var Bx=/[ap]\.?m?\.?/i,Wx=Bt("Hours",!0);function Hx(s,a,t){return s>11?t?"pm":"PM":t?"am":"AM"}var Nc={calendar:Fh,longDateFormat:$h,invalidDate:Yh,ordinal:Vh,dayOfMonthOrdinalParse:Uh,relativeTime:Wh,months:cx,monthsShort:hc,week:bx,weekdays:Dx,weekdaysMin:Mx,weekdaysShort:vc,meridiemParse:Bx},ts={},Jt={},fr;function Kx(s,a){var t,r=Math.min(s.length,a.length);for(t=0;t<r;t+=1)if(s[t]!==a[t])return t;return r}function to(s){return s&&s.toLowerCase().replace("_","-")}function Qx(s){for(var a=0,t,r,n,l;a<s.length;){for(l=to(s[a]).split("-"),t=l.length,r=to(s[a+1]),r=r?r.split("-"):null;t>0;){if(n=Dn(l.slice(0,t).join("-")),n)return n;if(r&&r.length>=t&&Kx(l,r)>=t-1)break;t--}a++}return fr}function Zx(s){return!!(s&&s.match("^[^/\\\\]*$"))}function Dn(s){var a=null,t;if(ts[s]===void 0&&typeof module<"u"&&module&&module.exports&&Zx(s))try{a=fr._abbr,t=Eh,t("./locale/"+s),Ia(a)}catch{ts[s]=null}return ts[s]}function Ia(s,a){var t;return s&&(ks(a)?t=Na(s):t=rl(s,a),t?fr=t:typeof console<"u"&&console.warn&&console.warn("Locale "+s+" not found. Did you forget to load it?")),fr._abbr}function rl(s,a){if(a!==null){var t,r=Nc;if(a.abbr=s,ts[s]!=null)nc("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),r=ts[s]._config;else if(a.parentLocale!=null)if(ts[a.parentLocale]!=null)r=ts[a.parentLocale]._config;else if(t=Dn(a.parentLocale),t!=null)r=t._config;else return Jt[a.parentLocale]||(Jt[a.parentLocale]=[]),Jt[a.parentLocale].push({name:s,config:a}),null;return ts[s]=new Hi(Ci(r,a)),Jt[s]&&Jt[s].forEach(function(n){rl(n.name,n.config)}),Ia(s),ts[s]}else return delete ts[s],null}function Jx(s,a){if(a!=null){var t,r,n=Nc;ts[s]!=null&&ts[s].parentLocale!=null?ts[s].set(Ci(ts[s]._config,a)):(r=Dn(s),r!=null&&(n=r._config),a=Ci(n,a),r==null&&(a.abbr=s),t=new Hi(a),t.parentLocale=ts[s],ts[s]=t),Ia(s)}else ts[s]!=null&&(ts[s].parentLocale!=null?(ts[s]=ts[s].parentLocale,s===Ia()&&Ia(s)):ts[s]!=null&&delete ts[s]);return ts[s]}function Na(s){var a;if(s&&s._locale&&s._locale._abbr&&(s=s._locale._abbr),!s)return fr;if(!Qs(s)){if(a=Dn(s),a)return a;s=[s]}return Qx(s)}function Xx(){return ki(ts)}function nl(s){var a,t=s._a;return t&&Pe(s).overflow===-2&&(a=t[fa]<0||t[fa]>11?fa:t[na]<1||t[na]>el(t[bs],t[fa])?na:t[xs]<0||t[xs]>24||t[xs]===24&&(t[Hs]!==0||t[ja]!==0||t[at]!==0)?xs:t[Hs]<0||t[Hs]>59?Hs:t[ja]<0||t[ja]>59?ja:t[at]<0||t[at]>999?at:-1,Pe(s)._overflowDayOfYear&&(a<bs||a>na)&&(a=na),Pe(s)._overflowWeeks&&a===-1&&(a=tx),Pe(s)._overflowWeekday&&a===-1&&(a=rx),Pe(s).overflow=a),s}var ep=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,sp=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,ap=/Z|[+-]\d\d(?::?\d\d)?/,Tr=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],ci=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],tp=/^\/?Date\((-?\d+)/i,rp=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,np={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function wc(s){var a,t,r=s._i,n=ep.exec(r)||sp.exec(r),l,c,m,i,o=Tr.length,d=ci.length;if(n){for(Pe(s).iso=!0,a=0,t=o;a<t;a++)if(Tr[a][1].exec(n[1])){c=Tr[a][0],l=Tr[a][2]!==!1;break}if(c==null){s._isValid=!1;return}if(n[3]){for(a=0,t=d;a<t;a++)if(ci[a][1].exec(n[3])){m=(n[2]||" ")+ci[a][0];break}if(m==null){s._isValid=!1;return}}if(!l&&m!=null){s._isValid=!1;return}if(n[4])if(ap.exec(n[4]))i="Z";else{s._isValid=!1;return}s._f=c+(m||"")+(i||""),ll(s)}else s._isValid=!1}function ip(s,a,t,r,n,l){var c=[lp(s),hc.indexOf(a),parseInt(t,10),parseInt(r,10),parseInt(n,10)];return l&&c.push(parseInt(l,10)),c}function lp(s){var a=parseInt(s,10);return a<=49?2e3+a:a<=999?1900+a:a}function op(s){return s.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function cp(s,a,t){if(s){var r=vc.indexOf(s),n=new Date(a[0],a[1],a[2]).getDay();if(r!==n)return Pe(t).weekdayMismatch=!0,t._isValid=!1,!1}return!0}function dp(s,a,t){if(s)return np[s];if(a)return 0;var r=parseInt(t,10),n=r%100,l=(r-n)/100;return l*60+n}function _c(s){var a=rp.exec(op(s._i)),t;if(a){if(t=ip(a[4],a[3],a[2],a[5],a[6],a[7]),!cp(a[1],t,s))return;s._a=t,s._tzm=dp(a[8],a[9],a[10]),s._d=pr.apply(null,s._a),s._d.setUTCMinutes(s._d.getUTCMinutes()-s._tzm),Pe(s).rfc2822=!0}else s._isValid=!1}function mp(s){var a=tp.exec(s._i);if(a!==null){s._d=new Date(+a[1]);return}if(wc(s),s._isValid===!1)delete s._isValid;else return;if(_c(s),s._isValid===!1)delete s._isValid;else return;s._strict?s._isValid=!1:J.createFromInputFallback(s)}J.createFromInputFallback=Is("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(s){s._d=new Date(s._i+(s._useUTC?" UTC":""))});function kt(s,a,t){return s??a??t}function up(s){var a=new Date(J.now());return s._useUTC?[a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate()]:[a.getFullYear(),a.getMonth(),a.getDate()]}function il(s){var a,t,r=[],n,l,c;if(!s._d){for(n=up(s),s._w&&s._a[na]==null&&s._a[fa]==null&&hp(s),s._dayOfYear!=null&&(c=kt(s._a[bs],n[bs]),(s._dayOfYear>ir(c)||s._dayOfYear===0)&&(Pe(s)._overflowDayOfYear=!0),t=pr(c,0,s._dayOfYear),s._a[fa]=t.getUTCMonth(),s._a[na]=t.getUTCDate()),a=0;a<3&&s._a[a]==null;++a)s._a[a]=r[a]=n[a];for(;a<7;a++)s._a[a]=r[a]=s._a[a]==null?a===2?1:0:s._a[a];s._a[xs]===24&&s._a[Hs]===0&&s._a[ja]===0&&s._a[at]===0&&(s._nextDay=!0,s._a[xs]=0),s._d=(s._useUTC?pr:vx).apply(null,r),l=s._useUTC?s._d.getUTCDay():s._d.getDay(),s._tzm!=null&&s._d.setUTCMinutes(s._d.getUTCMinutes()-s._tzm),s._nextDay&&(s._a[xs]=24),s._w&&typeof s._w.d<"u"&&s._w.d!==l&&(Pe(s).weekdayMismatch=!0)}}function hp(s){var a,t,r,n,l,c,m,i,o;a=s._w,a.GG!=null||a.W!=null||a.E!=null?(l=1,c=4,t=kt(a.GG,s._a[bs],gr(ss(),1,4).year),r=kt(a.W,1),n=kt(a.E,1),(n<1||n>7)&&(i=!0)):(l=s._locale._week.dow,c=s._locale._week.doy,o=gr(ss(),l,c),t=kt(a.gg,s._a[bs],o.year),r=kt(a.w,o.week),a.d!=null?(n=a.d,(n<0||n>6)&&(i=!0)):a.e!=null?(n=a.e+l,(a.e<0||a.e>6)&&(i=!0)):n=l),r<1||r>ya(t,l,c)?Pe(s)._overflowWeeks=!0:i!=null?Pe(s)._overflowWeekday=!0:(m=jc(t,r,n,l,c),s._a[bs]=m.year,s._dayOfYear=m.dayOfYear)}J.ISO_8601=function(){};J.RFC_2822=function(){};function ll(s){if(s._f===J.ISO_8601){wc(s);return}if(s._f===J.RFC_2822){_c(s);return}s._a=[],Pe(s).empty=!0;var a=""+s._i,t,r,n,l,c,m=a.length,i=0,o,d;for(n=ic(s._f,s._locale).match(Ki)||[],d=n.length,t=0;t<d;t++)l=n[t],r=(a.match(ex(l,s))||[])[0],r&&(c=a.substr(0,a.indexOf(r)),c.length>0&&Pe(s).unusedInput.push(c),a=a.slice(a.indexOf(r)+r.length),i+=r.length),Tt[l]?(r?Pe(s).empty=!1:Pe(s).unusedTokens.push(l),ax(l,r,s)):s._strict&&!r&&Pe(s).unusedTokens.push(l);Pe(s).charsLeftOver=m-i,a.length>0&&Pe(s).unusedInput.push(a),s._a[xs]<=12&&Pe(s).bigHour===!0&&s._a[xs]>0&&(Pe(s).bigHour=void 0),Pe(s).parsedDateParts=s._a.slice(0),Pe(s).meridiem=s._meridiem,s._a[xs]=xp(s._locale,s._a[xs],s._meridiem),o=Pe(s).era,o!==null&&(s._a[bs]=s._locale.erasConvertYear(o,s._a[bs])),il(s),nl(s)}function xp(s,a,t){var r;return t==null?a:s.meridiemHour!=null?s.meridiemHour(a,t):(s.isPM!=null&&(r=s.isPM(t),r&&a<12&&(a+=12),!r&&a===12&&(a=0)),a)}function pp(s){var a,t,r,n,l,c,m=!1,i=s._f.length;if(i===0){Pe(s).invalidFormat=!0,s._d=new Date(NaN);return}for(n=0;n<i;n++)l=0,c=!1,a=Wi({},s),s._useUTC!=null&&(a._useUTC=s._useUTC),a._f=s._f[n],ll(a),Bi(a)&&(c=!0),l+=Pe(a).charsLeftOver,l+=Pe(a).unusedTokens.length*10,Pe(a).score=l,m?l<r&&(r=l,t=a):(r==null||l<r||c)&&(r=l,t=a,c&&(m=!0));Oa(s,t||a)}function gp(s){if(!s._d){var a=Qi(s._i),t=a.day===void 0?a.date:a.day;s._a=tc([a.year,a.month,t,a.hour,a.minute,a.second,a.millisecond],function(r){return r&&parseInt(r,10)}),il(s)}}function fp(s){var a=new br(nl(Cc(s)));return a._nextDay&&(a.add(1,"d"),a._nextDay=void 0),a}function Cc(s){var a=s._i,t=s._f;return s._locale=s._locale||Na(s._l),a===null||t===void 0&&a===""?bn({nullInput:!0}):(typeof a=="string"&&(s._i=a=s._locale.preparse(a)),Zs(a)?new br(nl(a)):(yr(a)?s._d=a:Qs(t)?pp(s):t?ll(s):jp(s),Bi(s)||(s._d=null),s))}function jp(s){var a=s._i;ks(a)?s._d=new Date(J.now()):yr(a)?s._d=new Date(a.valueOf()):typeof a=="string"?mp(s):Qs(a)?(s._a=tc(a.slice(0),function(t){return parseInt(t,10)}),il(s)):nt(a)?gp(s):ba(a)?s._d=new Date(a):J.createFromInputFallback(s)}function kc(s,a,t,r,n){var l={};return(a===!0||a===!1)&&(r=a,a=void 0),(t===!0||t===!1)&&(r=t,t=void 0),(nt(s)&&Ui(s)||Qs(s)&&s.length===0)&&(s=void 0),l._isAMomentObject=!0,l._useUTC=l._isUTC=n,l._l=t,l._i=s,l._f=a,l._strict=r,fp(l)}function ss(s,a,t,r){return kc(s,a,t,r,!1)}var vp=Is("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var s=ss.apply(null,arguments);return this.isValid()&&s.isValid()?s<this?this:s:bn()}),yp=Is("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var s=ss.apply(null,arguments);return this.isValid()&&s.isValid()?s>this?this:s:bn()});function Sc(s,a){var t,r;if(a.length===1&&Qs(a[0])&&(a=a[0]),!a.length)return ss();for(t=a[0],r=1;r<a.length;++r)(!a[r].isValid()||a[r][s](t))&&(t=a[r]);return t}function bp(){var s=[].slice.call(arguments,0);return Sc("isBefore",s)}function Np(){var s=[].slice.call(arguments,0);return Sc("isAfter",s)}var wp=function(){return Date.now?Date.now():+new Date},Xt=["year","quarter","month","week","day","hour","minute","second","millisecond"];function _p(s){var a,t=!1,r,n=Xt.length;for(a in s)if(Ve(s,a)&&!(cs.call(Xt,a)!==-1&&(s[a]==null||!isNaN(s[a]))))return!1;for(r=0;r<n;++r)if(s[Xt[r]]){if(t)return!1;parseFloat(s[Xt[r]])!==$e(s[Xt[r]])&&(t=!0)}return!0}function Cp(){return this._isValid}function kp(){return Js(NaN)}function Mn(s){var a=Qi(s),t=a.year||0,r=a.quarter||0,n=a.month||0,l=a.week||a.isoWeek||0,c=a.day||0,m=a.hour||0,i=a.minute||0,o=a.second||0,d=a.millisecond||0;this._isValid=_p(a),this._milliseconds=+d+o*1e3+i*6e4+m*1e3*60*60,this._days=+c+l*7,this._months=+n+r*3+t*12,this._data={},this._locale=Na(),this._bubble()}function Vr(s){return s instanceof Mn}function Di(s){return s<0?Math.round(-1*s)*-1:Math.round(s)}function Sp(s,a,t){var r=Math.min(s.length,a.length),n=Math.abs(s.length-a.length),l=0,c;for(c=0;c<r;c++)$e(s[c])!==$e(a[c])&&l++;return l+n}function Dc(s,a){ye(s,0,0,function(){var t=this.utcOffset(),r="+";return t<0&&(t=-t,r="-"),r+ca(~~(t/60),2)+a+ca(~~t%60,2)})}Dc("Z",":");Dc("ZZ","");he("Z",kn);he("ZZ",kn);Je(["Z","ZZ"],function(s,a,t){t._useUTC=!0,t._tzm=ol(kn,s)});var Dp=/([\+\-]|\d\d)/gi;function ol(s,a){var t=(a||"").match(s),r,n,l;return t===null?null:(r=t[t.length-1]||[],n=(r+"").match(Dp)||["-",0,0],l=+(n[1]*60)+$e(n[2]),l===0?0:n[0]==="+"?l:-l)}function cl(s,a){var t,r;return a._isUTC?(t=a.clone(),r=(Zs(s)||yr(s)?s.valueOf():ss(s).valueOf())-t.valueOf(),t._d.setTime(t._d.valueOf()+r),J.updateOffset(t,!1),t):ss(s).local()}function Mi(s){return-Math.round(s._d.getTimezoneOffset())}J.updateOffset=function(){};function Mp(s,a,t){var r=this._offset||0,n;if(!this.isValid())return s!=null?this:NaN;if(s!=null){if(typeof s=="string"){if(s=ol(kn,s),s===null)return this}else Math.abs(s)<16&&!t&&(s=s*60);return!this._isUTC&&a&&(n=Mi(this)),this._offset=s,this._isUTC=!0,n!=null&&this.add(n,"m"),r!==s&&(!a||this._changeInProgress?Pc(this,Js(s-r,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,J.updateOffset(this,!0),this._changeInProgress=null)),this}else return this._isUTC?r:Mi(this)}function Ap(s,a){return s!=null?(typeof s!="string"&&(s=-s),this.utcOffset(s,a),this):-this.utcOffset()}function Pp(s){return this.utcOffset(0,s)}function Ep(s){return this._isUTC&&(this.utcOffset(0,s),this._isUTC=!1,s&&this.subtract(Mi(this),"m")),this}function Op(){if(this._tzm!=null)this.utcOffset(this._tzm,!1,!0);else if(typeof this._i=="string"){var s=ol(Jh,this._i);s!=null?this.utcOffset(s):this.utcOffset(0,!0)}return this}function zp(s){return this.isValid()?(s=s?ss(s).utcOffset():0,(this.utcOffset()-s)%60===0):!1}function Tp(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function Fp(){if(!ks(this._isDSTShifted))return this._isDSTShifted;var s={},a;return Wi(s,this),s=Cc(s),s._a?(a=s._isUTC?da(s._a):ss(s._a),this._isDSTShifted=this.isValid()&&Sp(s._a,a.toArray())>0):this._isDSTShifted=!1,this._isDSTShifted}function Rp(){return this.isValid()?!this._isUTC:!1}function Lp(){return this.isValid()?this._isUTC:!1}function Mc(){return this.isValid()?this._isUTC&&this._offset===0:!1}var Ip=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,$p=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function Js(s,a){var t=s,r=null,n,l,c;return Vr(s)?t={ms:s._milliseconds,d:s._days,M:s._months}:ba(s)||!isNaN(+s)?(t={},a?t[a]=+s:t.milliseconds=+s):(r=Ip.exec(s))?(n=r[1]==="-"?-1:1,t={y:0,d:$e(r[na])*n,h:$e(r[xs])*n,m:$e(r[Hs])*n,s:$e(r[ja])*n,ms:$e(Di(r[at]*1e3))*n}):(r=$p.exec(s))?(n=r[1]==="-"?-1:1,t={y:Ua(r[2],n),M:Ua(r[3],n),w:Ua(r[4],n),d:Ua(r[5],n),h:Ua(r[6],n),m:Ua(r[7],n),s:Ua(r[8],n)}):t==null?t={}:typeof t=="object"&&("from"in t||"to"in t)&&(c=qp(ss(t.from),ss(t.to)),t={},t.ms=c.milliseconds,t.M=c.months),l=new Mn(t),Vr(s)&&Ve(s,"_locale")&&(l._locale=s._locale),Vr(s)&&Ve(s,"_isValid")&&(l._isValid=s._isValid),l}Js.fn=Mn.prototype;Js.invalid=kp;function Ua(s,a){var t=s&&parseFloat(s.replace(",","."));return(isNaN(t)?0:t)*a}function ro(s,a){var t={};return t.months=a.month()-s.month()+(a.year()-s.year())*12,s.clone().add(t.months,"M").isAfter(a)&&--t.months,t.milliseconds=+a-+s.clone().add(t.months,"M"),t}function qp(s,a){var t;return s.isValid()&&a.isValid()?(a=cl(a,s),s.isBefore(a)?t=ro(s,a):(t=ro(a,s),t.milliseconds=-t.milliseconds,t.months=-t.months),t):{milliseconds:0,months:0}}function Ac(s,a){return function(t,r){var n,l;return r!==null&&!isNaN(+r)&&(nc(a,"moment()."+a+"(period, number) is deprecated. Please use moment()."+a+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),l=t,t=r,r=l),n=Js(t,r),Pc(this,n,s),this}}function Pc(s,a,t,r){var n=a._milliseconds,l=Di(a._days),c=Di(a._months);s.isValid()&&(r=r??!0,c&&pc(s,xr(s,"Month")+c*t),l&&uc(s,"Date",xr(s,"Date")+l*t),n&&s._d.setTime(s._d.valueOf()+n*t),r&&J.updateOffset(s,l||c))}var Yp=Ac(1,"add"),Gp=Ac(-1,"subtract");function Ec(s){return typeof s=="string"||s instanceof String}function Vp(s){return Zs(s)||yr(s)||Ec(s)||ba(s)||Bp(s)||Up(s)||s===null||s===void 0}function Up(s){var a=nt(s)&&!Ui(s),t=!1,r=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],n,l,c=r.length;for(n=0;n<c;n+=1)l=r[n],t=t||Ve(s,l);return a&&t}function Bp(s){var a=Qs(s),t=!1;return a&&(t=s.filter(function(r){return!ba(r)&&Ec(s)}).length===0),a&&t}function Wp(s){var a=nt(s)&&!Ui(s),t=!1,r=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"],n,l;for(n=0;n<r.length;n+=1)l=r[n],t=t||Ve(s,l);return a&&t}function Hp(s,a){var t=s.diff(a,"days",!0);return t<-6?"sameElse":t<-1?"lastWeek":t<0?"lastDay":t<1?"sameDay":t<2?"nextDay":t<7?"nextWeek":"sameElse"}function Kp(s,a){arguments.length===1&&(arguments[0]?Vp(arguments[0])?(s=arguments[0],a=void 0):Wp(arguments[0])&&(a=arguments[0],s=void 0):(s=void 0,a=void 0));var t=s||ss(),r=cl(t,this).startOf("day"),n=J.calendarFormat(this,r)||"sameElse",l=a&&(ma(a[n])?a[n].call(this,t):a[n]);return this.format(l||this.localeData().calendar(n,this,ss(t)))}function Qp(){return new br(this)}function Zp(s,a){var t=Zs(s)?s:ss(s);return this.isValid()&&t.isValid()?(a=$s(a)||"millisecond",a==="millisecond"?this.valueOf()>t.valueOf():t.valueOf()<this.clone().startOf(a).valueOf()):!1}function Jp(s,a){var t=Zs(s)?s:ss(s);return this.isValid()&&t.isValid()?(a=$s(a)||"millisecond",a==="millisecond"?this.valueOf()<t.valueOf():this.clone().endOf(a).valueOf()<t.valueOf()):!1}function Xp(s,a,t,r){var n=Zs(s)?s:ss(s),l=Zs(a)?a:ss(a);return this.isValid()&&n.isValid()&&l.isValid()?(r=r||"()",(r[0]==="("?this.isAfter(n,t):!this.isBefore(n,t))&&(r[1]===")"?this.isBefore(l,t):!this.isAfter(l,t))):!1}function eg(s,a){var t=Zs(s)?s:ss(s),r;return this.isValid()&&t.isValid()?(a=$s(a)||"millisecond",a==="millisecond"?this.valueOf()===t.valueOf():(r=t.valueOf(),this.clone().startOf(a).valueOf()<=r&&r<=this.clone().endOf(a).valueOf())):!1}function sg(s,a){return this.isSame(s,a)||this.isAfter(s,a)}function ag(s,a){return this.isSame(s,a)||this.isBefore(s,a)}function tg(s,a,t){var r,n,l;if(!this.isValid())return NaN;if(r=cl(s,this),!r.isValid())return NaN;switch(n=(r.utcOffset()-this.utcOffset())*6e4,a=$s(a),a){case"year":l=Ur(this,r)/12;break;case"month":l=Ur(this,r);break;case"quarter":l=Ur(this,r)/3;break;case"second":l=(this-r)/1e3;break;case"minute":l=(this-r)/6e4;break;case"hour":l=(this-r)/36e5;break;case"day":l=(this-r-n)/864e5;break;case"week":l=(this-r-n)/6048e5;break;default:l=this-r}return t?l:Fs(l)}function Ur(s,a){if(s.date()<a.date())return-Ur(a,s);var t=(a.year()-s.year())*12+(a.month()-s.month()),r=s.clone().add(t,"months"),n,l;return a-r<0?(n=s.clone().add(t-1,"months"),l=(a-r)/(r-n)):(n=s.clone().add(t+1,"months"),l=(a-r)/(n-r)),-(t+l)||0}J.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";J.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";function rg(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function ng(s){if(!this.isValid())return null;var a=s!==!0,t=a?this.clone().utc():this;return t.year()<0||t.year()>9999?Gr(t,a?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):ma(Date.prototype.toISOString)?a?this.toDate().toISOString():new Date(this.valueOf()+this.utcOffset()*60*1e3).toISOString().replace("Z",Gr(t,"Z")):Gr(t,a?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")}function ig(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var s="moment",a="",t,r,n,l;return this.isLocal()||(s=this.utcOffset()===0?"moment.utc":"moment.parseZone",a="Z"),t="["+s+'("]',r=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",n="-MM-DD[T]HH:mm:ss.SSS",l=a+'[")]',this.format(t+r+n+l)}function lg(s){s||(s=this.isUtc()?J.defaultFormatUtc:J.defaultFormat);var a=Gr(this,s);return this.localeData().postformat(a)}function og(s,a){return this.isValid()&&(Zs(s)&&s.isValid()||ss(s).isValid())?Js({to:this,from:s}).locale(this.locale()).humanize(!a):this.localeData().invalidDate()}function cg(s){return this.from(ss(),s)}function dg(s,a){return this.isValid()&&(Zs(s)&&s.isValid()||ss(s).isValid())?Js({from:this,to:s}).locale(this.locale()).humanize(!a):this.localeData().invalidDate()}function mg(s){return this.to(ss(),s)}function Oc(s){var a;return s===void 0?this._locale._abbr:(a=Na(s),a!=null&&(this._locale=a),this)}var zc=Is("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(s){return s===void 0?this.localeData():this.locale(s)});function Tc(){return this._locale}var on=1e3,Ft=60*on,cn=60*Ft,Fc=(365*400+97)*24*cn;function Rt(s,a){return(s%a+a)%a}function Rc(s,a,t){return s<100&&s>=0?new Date(s+400,a,t)-Fc:new Date(s,a,t).valueOf()}function Lc(s,a,t){return s<100&&s>=0?Date.UTC(s+400,a,t)-Fc:Date.UTC(s,a,t)}function ug(s){var a,t;if(s=$s(s),s===void 0||s==="millisecond"||!this.isValid())return this;switch(t=this._isUTC?Lc:Rc,s){case"year":a=t(this.year(),0,1);break;case"quarter":a=t(this.year(),this.month()-this.month()%3,1);break;case"month":a=t(this.year(),this.month(),1);break;case"week":a=t(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":a=t(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":a=t(this.year(),this.month(),this.date());break;case"hour":a=this._d.valueOf(),a-=Rt(a+(this._isUTC?0:this.utcOffset()*Ft),cn);break;case"minute":a=this._d.valueOf(),a-=Rt(a,Ft);break;case"second":a=this._d.valueOf(),a-=Rt(a,on);break}return this._d.setTime(a),J.updateOffset(this,!0),this}function hg(s){var a,t;if(s=$s(s),s===void 0||s==="millisecond"||!this.isValid())return this;switch(t=this._isUTC?Lc:Rc,s){case"year":a=t(this.year()+1,0,1)-1;break;case"quarter":a=t(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":a=t(this.year(),this.month()+1,1)-1;break;case"week":a=t(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":a=t(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":a=t(this.year(),this.month(),this.date()+1)-1;break;case"hour":a=this._d.valueOf(),a+=cn-Rt(a+(this._isUTC?0:this.utcOffset()*Ft),cn)-1;break;case"minute":a=this._d.valueOf(),a+=Ft-Rt(a,Ft)-1;break;case"second":a=this._d.valueOf(),a+=on-Rt(a,on)-1;break}return this._d.setTime(a),J.updateOffset(this,!0),this}function xg(){return this._d.valueOf()-(this._offset||0)*6e4}function pg(){return Math.floor(this.valueOf()/1e3)}function gg(){return new Date(this.valueOf())}function fg(){var s=this;return[s.year(),s.month(),s.date(),s.hour(),s.minute(),s.second(),s.millisecond()]}function jg(){var s=this;return{years:s.year(),months:s.month(),date:s.date(),hours:s.hours(),minutes:s.minutes(),seconds:s.seconds(),milliseconds:s.milliseconds()}}function vg(){return this.isValid()?this.toISOString():null}function yg(){return Bi(this)}function bg(){return Oa({},Pe(this))}function Ng(){return Pe(this).overflow}function wg(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}ye("N",0,0,"eraAbbr");ye("NN",0,0,"eraAbbr");ye("NNN",0,0,"eraAbbr");ye("NNNN",0,0,"eraName");ye("NNNNN",0,0,"eraNarrow");ye("y",["y",1],"yo","eraYear");ye("y",["yy",2],0,"eraYear");ye("y",["yyy",3],0,"eraYear");ye("y",["yyyy",4],0,"eraYear");he("N",dl);he("NN",dl);he("NNN",dl);he("NNNN",zg);he("NNNNN",Tg);Je(["N","NN","NNN","NNNN","NNNNN"],function(s,a,t,r){var n=t._locale.erasParse(s,r,t._strict);n?Pe(t).era=n:Pe(t).invalidEra=s});he("y",Vt);he("yy",Vt);he("yyy",Vt);he("yyyy",Vt);he("yo",Fg);Je(["y","yy","yyy","yyyy"],bs);Je(["yo"],function(s,a,t,r){var n;t._locale._eraYearOrdinalRegex&&(n=s.match(t._locale._eraYearOrdinalRegex)),t._locale.eraYearOrdinalParse?a[bs]=t._locale.eraYearOrdinalParse(s,n):a[bs]=parseInt(s,10)});function _g(s,a){var t,r,n,l=this._eras||Na("en")._eras;for(t=0,r=l.length;t<r;++t){switch(typeof l[t].since){case"string":n=J(l[t].since).startOf("day"),l[t].since=n.valueOf();break}switch(typeof l[t].until){case"undefined":l[t].until=1/0;break;case"string":n=J(l[t].until).startOf("day").valueOf(),l[t].until=n.valueOf();break}}return l}function Cg(s,a,t){var r,n,l=this.eras(),c,m,i;for(s=s.toUpperCase(),r=0,n=l.length;r<n;++r)if(c=l[r].name.toUpperCase(),m=l[r].abbr.toUpperCase(),i=l[r].narrow.toUpperCase(),t)switch(a){case"N":case"NN":case"NNN":if(m===s)return l[r];break;case"NNNN":if(c===s)return l[r];break;case"NNNNN":if(i===s)return l[r];break}else if([c,m,i].indexOf(s)>=0)return l[r]}function kg(s,a){var t=s.since<=s.until?1:-1;return a===void 0?J(s.since).year():J(s.since).year()+(a-s.offset)*t}function Sg(){var s,a,t,r=this.localeData().eras();for(s=0,a=r.length;s<a;++s)if(t=this.clone().startOf("day").valueOf(),r[s].since<=t&&t<=r[s].until||r[s].until<=t&&t<=r[s].since)return r[s].name;return""}function Dg(){var s,a,t,r=this.localeData().eras();for(s=0,a=r.length;s<a;++s)if(t=this.clone().startOf("day").valueOf(),r[s].since<=t&&t<=r[s].until||r[s].until<=t&&t<=r[s].since)return r[s].narrow;return""}function Mg(){var s,a,t,r=this.localeData().eras();for(s=0,a=r.length;s<a;++s)if(t=this.clone().startOf("day").valueOf(),r[s].since<=t&&t<=r[s].until||r[s].until<=t&&t<=r[s].since)return r[s].abbr;return""}function Ag(){var s,a,t,r,n=this.localeData().eras();for(s=0,a=n.length;s<a;++s)if(t=n[s].since<=n[s].until?1:-1,r=this.clone().startOf("day").valueOf(),n[s].since<=r&&r<=n[s].until||n[s].until<=r&&r<=n[s].since)return(this.year()-J(n[s].since).year())*t+n[s].offset;return this.year()}function Pg(s){return Ve(this,"_erasNameRegex")||ml.call(this),s?this._erasNameRegex:this._erasRegex}function Eg(s){return Ve(this,"_erasAbbrRegex")||ml.call(this),s?this._erasAbbrRegex:this._erasRegex}function Og(s){return Ve(this,"_erasNarrowRegex")||ml.call(this),s?this._erasNarrowRegex:this._erasRegex}function dl(s,a){return a.erasAbbrRegex(s)}function zg(s,a){return a.erasNameRegex(s)}function Tg(s,a){return a.erasNarrowRegex(s)}function Fg(s,a){return a._eraYearOrdinalRegex||Vt}function ml(){var s=[],a=[],t=[],r=[],n,l,c,m,i,o=this.eras();for(n=0,l=o.length;n<l;++n)c=va(o[n].name),m=va(o[n].abbr),i=va(o[n].narrow),a.push(c),s.push(m),t.push(i),r.push(c),r.push(m),r.push(i);this._erasRegex=new RegExp("^("+r.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+a.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+s.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+t.join("|")+")","i")}ye(0,["gg",2],0,function(){return this.weekYear()%100});ye(0,["GG",2],0,function(){return this.isoWeekYear()%100});function An(s,a){ye(0,[s,s.length],0,a)}An("gggg","weekYear");An("ggggg","weekYear");An("GGGG","isoWeekYear");An("GGGGG","isoWeekYear");he("G",Cn);he("g",Cn);he("GG",as,Os);he("gg",as,Os);he("GGGG",Ji,Zi);he("gggg",Ji,Zi);he("GGGGG",_n,Nn);he("ggggg",_n,Nn);wr(["gggg","ggggg","GGGG","GGGGG"],function(s,a,t,r){a[r.substr(0,2)]=$e(s)});wr(["gg","GG"],function(s,a,t,r){a[r]=J.parseTwoDigitYear(s)});function Rg(s){return Ic.call(this,s,this.week(),this.weekday()+this.localeData()._week.dow,this.localeData()._week.dow,this.localeData()._week.doy)}function Lg(s){return Ic.call(this,s,this.isoWeek(),this.isoWeekday(),1,4)}function Ig(){return ya(this.year(),1,4)}function $g(){return ya(this.isoWeekYear(),1,4)}function qg(){var s=this.localeData()._week;return ya(this.year(),s.dow,s.doy)}function Yg(){var s=this.localeData()._week;return ya(this.weekYear(),s.dow,s.doy)}function Ic(s,a,t,r,n){var l;return s==null?gr(this,r,n).year:(l=ya(s,r,n),a>l&&(a=l),Gg.call(this,s,a,t,r,n))}function Gg(s,a,t,r,n){var l=jc(s,a,t,r,n),c=pr(l.year,0,l.dayOfYear);return this.year(c.getUTCFullYear()),this.month(c.getUTCMonth()),this.date(c.getUTCDate()),this}ye("Q",0,"Qo","quarter");he("Q",lc);Je("Q",function(s,a){a[fa]=($e(s)-1)*3});function Vg(s){return s==null?Math.ceil((this.month()+1)/3):this.month((s-1)*3+this.month()%3)}ye("D",["DD",2],"Do","date");he("D",as,Ut);he("DD",as,Os);he("Do",function(s,a){return s?a._dayOfMonthOrdinalParse||a._ordinalParse:a._dayOfMonthOrdinalParseLenient});Je(["D","DD"],na);Je("Do",function(s,a){a[na]=$e(s.match(as)[0])});var $c=Bt("Date",!0);ye("DDD",["DDDD",3],"DDDo","dayOfYear");he("DDD",wn);he("DDDD",oc);Je(["DDD","DDDD"],function(s,a,t){t._dayOfYear=$e(s)});function Ug(s){var a=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return s==null?a:this.add(s-a,"d")}ye("m",["mm",2],0,"minute");he("m",as,Xi);he("mm",as,Os);Je(["m","mm"],Hs);var Bg=Bt("Minutes",!1);ye("s",["ss",2],0,"second");he("s",as,Xi);he("ss",as,Os);Je(["s","ss"],ja);var Wg=Bt("Seconds",!1);ye("S",0,0,function(){return~~(this.millisecond()/100)});ye(0,["SS",2],0,function(){return~~(this.millisecond()/10)});ye(0,["SSS",3],0,"millisecond");ye(0,["SSSS",4],0,function(){return this.millisecond()*10});ye(0,["SSSSS",5],0,function(){return this.millisecond()*100});ye(0,["SSSSSS",6],0,function(){return this.millisecond()*1e3});ye(0,["SSSSSSS",7],0,function(){return this.millisecond()*1e4});ye(0,["SSSSSSSS",8],0,function(){return this.millisecond()*1e5});ye(0,["SSSSSSSSS",9],0,function(){return this.millisecond()*1e6});he("S",wn,lc);he("SS",wn,Os);he("SSS",wn,oc);var za,qc;for(za="SSSS";za.length<=9;za+="S")he(za,Vt);function Hg(s,a){a[at]=$e(("0."+s)*1e3)}for(za="S";za.length<=9;za+="S")Je(za,Hg);qc=Bt("Milliseconds",!1);ye("z",0,0,"zoneAbbr");ye("zz",0,0,"zoneName");function Kg(){return this._isUTC?"UTC":""}function Qg(){return this._isUTC?"Coordinated Universal Time":""}var re=br.prototype;re.add=Yp;re.calendar=Kp;re.clone=Qp;re.diff=tg;re.endOf=hg;re.format=lg;re.from=og;re.fromNow=cg;re.to=dg;re.toNow=mg;re.get=ix;re.invalidAt=Ng;re.isAfter=Zp;re.isBefore=Jp;re.isBetween=Xp;re.isSame=eg;re.isSameOrAfter=sg;re.isSameOrBefore=ag;re.isValid=yg;re.lang=zc;re.locale=Oc;re.localeData=Tc;re.max=yp;re.min=vp;re.parsingFlags=bg;re.set=lx;re.startOf=ug;re.subtract=Gp;re.toArray=fg;re.toObject=jg;re.toDate=gg;re.toISOString=ng;re.inspect=ig;typeof Symbol<"u"&&Symbol.for!=null&&(re[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"});re.toJSON=vg;re.toString=rg;re.unix=pg;re.valueOf=xg;re.creationData=wg;re.eraName=Sg;re.eraNarrow=Dg;re.eraAbbr=Mg;re.eraYear=Ag;re.year=mc;re.isLeapYear=nx;re.weekYear=Rg;re.isoWeekYear=Lg;re.quarter=re.quarters=Vg;re.month=gc;re.daysInMonth=gx;re.week=re.weeks=_x;re.isoWeek=re.isoWeeks=Cx;re.weeksInYear=qg;re.weeksInWeekYear=Yg;re.isoWeeksInYear=Ig;re.isoWeeksInISOWeekYear=$g;re.date=$c;re.day=re.days=Lx;re.weekday=Ix;re.isoWeekday=$x;re.dayOfYear=Ug;re.hour=re.hours=Wx;re.minute=re.minutes=Bg;re.second=re.seconds=Wg;re.millisecond=re.milliseconds=qc;re.utcOffset=Mp;re.utc=Pp;re.local=Ep;re.parseZone=Op;re.hasAlignedHourOffset=zp;re.isDST=Tp;re.isLocal=Rp;re.isUtcOffset=Lp;re.isUtc=Mc;re.isUTC=Mc;re.zoneAbbr=Kg;re.zoneName=Qg;re.dates=Is("dates accessor is deprecated. Use date instead.",$c);re.months=Is("months accessor is deprecated. Use month instead",gc);re.years=Is("years accessor is deprecated. Use year instead",mc);re.zone=Is("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",Ap);re.isDSTShifted=Is("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",Fp);function Zg(s){return ss(s*1e3)}function Jg(){return ss.apply(null,arguments).parseZone()}function Yc(s){return s}var Ue=Hi.prototype;Ue.calendar=Rh;Ue.longDateFormat=qh;Ue.invalidDate=Gh;Ue.ordinal=Bh;Ue.preparse=Yc;Ue.postformat=Yc;Ue.relativeTime=Hh;Ue.pastFuture=Kh;Ue.set=Th;Ue.eras=_g;Ue.erasParse=Cg;Ue.erasConvertYear=kg;Ue.erasAbbrRegex=Eg;Ue.erasNameRegex=Pg;Ue.erasNarrowRegex=Og;Ue.months=ux;Ue.monthsShort=hx;Ue.monthsParse=px;Ue.monthsRegex=jx;Ue.monthsShortRegex=fx;Ue.week=yx;Ue.firstDayOfYear=wx;Ue.firstDayOfWeek=Nx;Ue.weekdays=Ox;Ue.weekdaysMin=Tx;Ue.weekdaysShort=zx;Ue.weekdaysParse=Rx;Ue.weekdaysRegex=qx;Ue.weekdaysShortRegex=Yx;Ue.weekdaysMinRegex=Gx;Ue.isPM=Ux;Ue.meridiem=Hx;function dn(s,a,t,r){var n=Na(),l=da().set(r,a);return n[t](l,s)}function Gc(s,a,t){if(ba(s)&&(a=s,s=void 0),s=s||"",a!=null)return dn(s,a,t,"month");var r,n=[];for(r=0;r<12;r++)n[r]=dn(s,r,t,"month");return n}function ul(s,a,t,r){typeof s=="boolean"?(ba(a)&&(t=a,a=void 0),a=a||""):(a=s,t=a,s=!1,ba(a)&&(t=a,a=void 0),a=a||"");var n=Na(),l=s?n._week.dow:0,c,m=[];if(t!=null)return dn(a,(t+l)%7,r,"day");for(c=0;c<7;c++)m[c]=dn(a,(c+l)%7,r,"day");return m}function Xg(s,a){return Gc(s,a,"months")}function ef(s,a){return Gc(s,a,"monthsShort")}function sf(s,a,t){return ul(s,a,t,"weekdays")}function af(s,a,t){return ul(s,a,t,"weekdaysShort")}function tf(s,a,t){return ul(s,a,t,"weekdaysMin")}Ia("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(s){var a=s%10,t=$e(s%100/10)===1?"th":a===1?"st":a===2?"nd":a===3?"rd":"th";return s+t}});J.lang=Is("moment.lang is deprecated. Use moment.locale instead.",Ia);J.langData=Is("moment.langData is deprecated. Use moment.localeData instead.",Na);var ha=Math.abs;function rf(){var s=this._data;return this._milliseconds=ha(this._milliseconds),this._days=ha(this._days),this._months=ha(this._months),s.milliseconds=ha(s.milliseconds),s.seconds=ha(s.seconds),s.minutes=ha(s.minutes),s.hours=ha(s.hours),s.months=ha(s.months),s.years=ha(s.years),this}function Vc(s,a,t,r){var n=Js(a,t);return s._milliseconds+=r*n._milliseconds,s._days+=r*n._days,s._months+=r*n._months,s._bubble()}function nf(s,a){return Vc(this,s,a,1)}function lf(s,a){return Vc(this,s,a,-1)}function no(s){return s<0?Math.floor(s):Math.ceil(s)}function of(){var s=this._milliseconds,a=this._days,t=this._months,r=this._data,n,l,c,m,i;return s>=0&&a>=0&&t>=0||s<=0&&a<=0&&t<=0||(s+=no(Ai(t)+a)*864e5,a=0,t=0),r.milliseconds=s%1e3,n=Fs(s/1e3),r.seconds=n%60,l=Fs(n/60),r.minutes=l%60,c=Fs(l/60),r.hours=c%24,a+=Fs(c/24),i=Fs(Uc(a)),t+=i,a-=no(Ai(i)),m=Fs(t/12),t%=12,r.days=a,r.months=t,r.years=m,this}function Uc(s){return s*4800/146097}function Ai(s){return s*146097/4800}function cf(s){if(!this.isValid())return NaN;var a,t,r=this._milliseconds;if(s=$s(s),s==="month"||s==="quarter"||s==="year")switch(a=this._days+r/864e5,t=this._months+Uc(a),s){case"month":return t;case"quarter":return t/3;case"year":return t/12}else switch(a=this._days+Math.round(Ai(this._months)),s){case"week":return a/7+r/6048e5;case"day":return a+r/864e5;case"hour":return a*24+r/36e5;case"minute":return a*1440+r/6e4;case"second":return a*86400+r/1e3;case"millisecond":return Math.floor(a*864e5)+r;default:throw new Error("Unknown unit "+s)}}function wa(s){return function(){return this.as(s)}}var Bc=wa("ms"),df=wa("s"),mf=wa("m"),uf=wa("h"),hf=wa("d"),xf=wa("w"),pf=wa("M"),gf=wa("Q"),ff=wa("y"),jf=Bc;function vf(){return Js(this)}function yf(s){return s=$s(s),this.isValid()?this[s+"s"]():NaN}function jt(s){return function(){return this.isValid()?this._data[s]:NaN}}var bf=jt("milliseconds"),Nf=jt("seconds"),wf=jt("minutes"),_f=jt("hours"),Cf=jt("days"),kf=jt("months"),Sf=jt("years");function Df(){return Fs(this.days()/7)}var pa=Math.round,At={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function Mf(s,a,t,r,n){return n.relativeTime(a||1,!!t,s,r)}function Af(s,a,t,r){var n=Js(s).abs(),l=pa(n.as("s")),c=pa(n.as("m")),m=pa(n.as("h")),i=pa(n.as("d")),o=pa(n.as("M")),d=pa(n.as("w")),p=pa(n.as("y")),x=l<=t.ss&&["s",l]||l<t.s&&["ss",l]||c<=1&&["m"]||c<t.m&&["mm",c]||m<=1&&["h"]||m<t.h&&["hh",m]||i<=1&&["d"]||i<t.d&&["dd",i];return t.w!=null&&(x=x||d<=1&&["w"]||d<t.w&&["ww",d]),x=x||o<=1&&["M"]||o<t.M&&["MM",o]||p<=1&&["y"]||["yy",p],x[2]=a,x[3]=+s>0,x[4]=r,Mf.apply(null,x)}function Pf(s){return s===void 0?pa:typeof s=="function"?(pa=s,!0):!1}function Ef(s,a){return At[s]===void 0?!1:a===void 0?At[s]:(At[s]=a,s==="s"&&(At.ss=a-1),!0)}function Of(s,a){if(!this.isValid())return this.localeData().invalidDate();var t=!1,r=At,n,l;return typeof s=="object"&&(a=s,s=!1),typeof s=="boolean"&&(t=s),typeof a=="object"&&(r=Object.assign({},At,a),a.s!=null&&a.ss==null&&(r.ss=a.s-1)),n=this.localeData(),l=Af(this,!t,r,n),t&&(l=n.pastFuture(+this,l)),n.postformat(l)}var di=Math.abs;function _t(s){return(s>0)-(s<0)||+s}function Pn(){if(!this.isValid())return this.localeData().invalidDate();var s=di(this._milliseconds)/1e3,a=di(this._days),t=di(this._months),r,n,l,c,m=this.asSeconds(),i,o,d,p;return m?(r=Fs(s/60),n=Fs(r/60),s%=60,r%=60,l=Fs(t/12),t%=12,c=s?s.toFixed(3).replace(/\.?0+$/,""):"",i=m<0?"-":"",o=_t(this._months)!==_t(m)?"-":"",d=_t(this._days)!==_t(m)?"-":"",p=_t(this._milliseconds)!==_t(m)?"-":"",i+"P"+(l?o+l+"Y":"")+(t?o+t+"M":"")+(a?d+a+"D":"")+(n||r||s?"T":"")+(n?p+n+"H":"")+(r?p+r+"M":"")+(s?p+c+"S":"")):"P0D"}var Ye=Mn.prototype;Ye.isValid=Cp;Ye.abs=rf;Ye.add=nf;Ye.subtract=lf;Ye.as=cf;Ye.asMilliseconds=Bc;Ye.asSeconds=df;Ye.asMinutes=mf;Ye.asHours=uf;Ye.asDays=hf;Ye.asWeeks=xf;Ye.asMonths=pf;Ye.asQuarters=gf;Ye.asYears=ff;Ye.valueOf=jf;Ye._bubble=of;Ye.clone=vf;Ye.get=yf;Ye.milliseconds=bf;Ye.seconds=Nf;Ye.minutes=wf;Ye.hours=_f;Ye.days=Cf;Ye.weeks=Df;Ye.months=kf;Ye.years=Sf;Ye.humanize=Of;Ye.toISOString=Pn;Ye.toString=Pn;Ye.toJSON=Pn;Ye.locale=Oc;Ye.localeData=Tc;Ye.toIsoString=Is("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Pn);Ye.lang=zc;ye("X",0,0,"unix");ye("x",0,0,"valueOf");he("x",Cn);he("X",Xh);Je("X",function(s,a,t){t._d=new Date(parseFloat(s)*1e3)});Je("x",function(s,a,t){t._d=new Date($e(s))});//! moment.js
J.version="2.30.1";Oh(ss);J.fn=re;J.min=bp;J.max=Np;J.now=wp;J.utc=da;J.unix=Zg;J.months=Xg;J.isDate=yr;J.locale=Ia;J.invalid=bn;J.duration=Js;J.isMoment=Zs;J.weekdays=sf;J.parseZone=Jg;J.localeData=Na;J.isDuration=Vr;J.monthsShort=ef;J.weekdaysMin=tf;J.defineLocale=rl;J.updateLocale=Jx;J.locales=Xx;J.weekdaysShort=af;J.normalizeUnits=$s;J.relativeTimeRounding=Pf;J.relativeTimeThreshold=Ef;J.calendarFormat=Hp;J.prototype=re;J.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"};function zf({orders:s=[],dishes:a=[],pdvSales:t=[]}){const r=w.useMemo(()=>{const c=J().startOf("day"),m=J().startOf("day").subtract(1,"day"),i=J().startOf("week"),o=J().startOf("week").subtract(1,"week"),d=J().startOf("month"),p=J().startOf("month").subtract(1,"month"),x=Z=>Z.status!=="cancelled",f=Z=>Z.status==="delivered",v=(s||[]).filter(Z=>J(Z.created_date).isSame(c,"day")&&x(Z)),y=v.filter(f).reduce((Z,S)=>Z+(S.total||0),0),j=(s||[]).filter(Z=>J(Z.created_date).isSame(m,"day")&&x(Z)),M=j.filter(f).reduce((Z,S)=>Z+(S.total||0),0),k=(s||[]).filter(Z=>J(Z.created_date).isSameOrAfter(i)&&x(Z)),z=k.filter(f).reduce((Z,S)=>Z+(S.total||0),0),u=(s||[]).filter(Z=>{const S=J(Z.created_date);return S.isSameOrAfter(o)&&S.isBefore(i)&&x(Z)}).filter(f).reduce((Z,S)=>Z+(S.total||0),0),g=(s||[]).filter(Z=>J(Z.created_date).isSameOrAfter(d)&&x(Z)),T=g.filter(f).reduce((Z,S)=>Z+(S.total||0),0),b=(s||[]).filter(Z=>{const S=J(Z.created_date);return S.isSameOrAfter(p)&&S.isBefore(d)&&x(Z)}).filter(f).reduce((Z,S)=>Z+(S.total||0),0),L=v.length>0?y/v.length:0,O=j.length>0?M/j.length:0,P=(Z,S)=>S===0?Z>0?100:0:(Z-S)/S*100,F=P(y,M),C=P(v.length,j.length),N=P(z,u),V=P(T,b),E=P(L,O),ee={};(s||[]).filter(x).forEach(Z=>{Z.items&&Z.items.forEach(S=>{const G=S.dish_id||S.dish?.id;G&&(ee[G]=(ee[G]||0)+(S.quantity||1))})});const ue=Object.entries(ee).sort(([,Z],[,S])=>S-Z).slice(0,3).map(([Z,S])=>({dish:a.find(q=>q.id===Z),count:S})).filter(Z=>Z.dish);return{today:{orders:v.length,revenue:y,avgTicket:L,growth:{revenue:F,orders:C,avgTicket:E}},week:{orders:k.length,revenue:z,growth:N},month:{orders:g.length,revenue:T,growth:V},topProducts:ue}},[s,a,t]),n=c=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(c||0),l=({value:c})=>{if(c===0)return null;const m=c>0,i=m?Nu:yu,o=m?"text-green-600 dark:text-green-300":"text-red-600 dark:text-red-300",d=m?"bg-green-50 dark:bg-green-950/50":"bg-red-50 dark:bg-red-950/50";return e.jsxs("div",{className:`flex items-center gap-1 text-xs ${o} ${d} px-2 py-1 rounded-full`,children:[e.jsx(i,{className:"w-3 h-3"}),e.jsxs("span",{className:"font-semibold",children:[Math.abs(c).toFixed(1),"%"]})]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(B,{className:"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200 dark:from-blue-950 dark:to-blue-900 dark:border-blue-800",children:[e.jsx(oe,{className:"pb-2",children:e.jsxs(ce,{className:"text-sm font-medium text-blue-700 dark:text-blue-200 flex items-center justify-between",children:["Faturamento Hoje",e.jsx(l,{value:r.today.growth.revenue})]})}),e.jsxs(H,{children:[e.jsx("div",{className:"text-3xl font-bold text-blue-900 dark:text-blue-50",children:n(r.today.revenue)}),e.jsxs("p",{className:"text-xs text-blue-600 dark:text-blue-300 mt-1",children:[r.today.orders," pedido(s)"]})]})]}),e.jsxs(B,{className:"bg-gradient-to-br from-green-50 to-green-100 border-green-200 dark:from-green-950 dark:to-green-900 dark:border-green-800",children:[e.jsx(oe,{className:"pb-2",children:e.jsxs(ce,{className:"text-sm font-medium text-green-700 dark:text-green-200 flex items-center justify-between",children:["Ticket Médio",e.jsx(l,{value:r.today.growth.avgTicket})]})}),e.jsxs(H,{children:[e.jsx("div",{className:"text-3xl font-bold text-green-900 dark:text-green-50",children:n(r.today.avgTicket)}),e.jsx("p",{className:"text-xs text-green-600 dark:text-green-300 mt-1",children:"Por pedido hoje"})]})]}),e.jsxs(B,{className:"bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200 dark:from-purple-950 dark:to-purple-900 dark:border-purple-800",children:[e.jsx(oe,{className:"pb-2",children:e.jsxs(ce,{className:"text-sm font-medium text-purple-700 dark:text-purple-200 flex items-center justify-between",children:["Pedidos Hoje",e.jsx(l,{value:r.today.growth.orders})]})}),e.jsxs(H,{children:[e.jsx("div",{className:"text-3xl font-bold text-purple-900 dark:text-purple-50",children:r.today.orders}),e.jsx("p",{className:"text-xs text-purple-600 dark:text-purple-300 mt-1",children:"Recebidos hoje"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(B,{className:"border-orange-200 dark:border-orange-800",style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(oe,{className:"pb-2",children:e.jsxs(ce,{className:"text-sm font-medium flex items-center justify-between",style:{color:"var(--text-primary)"},children:[e.jsx("span",{children:"Faturamento da Semana"}),e.jsx(l,{value:r.week.growth})]})}),e.jsxs(H,{children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--text-primary)"},children:n(r.week.revenue)}),e.jsxs("p",{className:"text-xs mt-1",style:{color:"var(--text-secondary)"},children:[r.week.orders," pedidos nesta semana"]})]})]}),e.jsxs(B,{className:"border-indigo-200 dark:border-indigo-800",style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(oe,{className:"pb-2",children:e.jsxs(ce,{className:"text-sm font-medium flex items-center justify-between",style:{color:"var(--text-primary)"},children:[e.jsx("span",{children:"Faturamento do Mês"}),e.jsx(l,{value:r.month.growth})]})}),e.jsxs(H,{children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--text-primary)"},children:n(r.month.revenue)}),e.jsxs("p",{className:"text-xs mt-1",style:{color:"var(--text-secondary)"},children:[r.month.orders," pedidos neste mês"]})]})]})]}),r.topProducts.length>0&&e.jsxs(B,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(oe,{children:e.jsxs(ce,{className:"text-base font-semibold flex items-center gap-2",style:{color:"var(--text-primary)"},children:[e.jsx(Es,{className:"w-5 h-5 text-yellow-500"}),"Produtos Mais Vendidos"]})}),e.jsx(H,{children:e.jsx("div",{className:"space-y-3",children:r.topProducts.map((c,m)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-orange-400 to-orange-600 flex items-center justify-center text-white font-bold text-sm",children:m+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",style:{color:"var(--text-primary)"},children:c.dish?.name||"Produto"}),e.jsxs("p",{className:"text-xs",style:{color:"var(--text-secondary)"},children:[c.count," venda(s)"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-xs",style:{color:"var(--text-secondary)"},children:["#",c.count]})})]},c.dish?.id||m))})})]})]})}const Tf={light:"",dark:".dark"},Wc=w.createContext(null);function Hc(){const s=w.useContext(Wc);if(!s)throw new Error("useChart must be used within a <ChartContainer />");return s}const Da=w.forwardRef(({id:s,className:a,children:t,config:r,...n},l)=>{const c=w.useId(),m=`chart-${s||c.replace(/:/g,"")}`;return e.jsx(Wc.Provider,{value:{config:r},children:e.jsxs("div",{"data-chart":m,ref:l,className:He("flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",a),...n,children:[e.jsx(Ff,{id:m,config:r}),e.jsx(Sm,{children:t})]})})});Da.displayName="Chart";const Ff=({id:s,config:a})=>{const t=Object.entries(a).filter(([,r])=>r.theme||r.color);return t.length?e.jsx("style",{dangerouslySetInnerHTML:{__html:Object.entries(Tf).map(([r,n])=>`
${n} [data-chart=${s}] {
${t.map(([l,c])=>{const m=c.theme?.[r]||c.color;return m?`  --color-${l}: ${m};`:null}).join(`
`)}
}
`).join(`
`)}}):null},Ka=km,Ma=w.forwardRef(({active:s,payload:a,className:t,indicator:r="dot",hideLabel:n=!1,hideIndicator:l=!1,label:c,labelFormatter:m,labelClassName:i,formatter:o,color:d,nameKey:p,labelKey:x},f)=>{const{config:v}=Hc(),y=w.useMemo(()=>{if(n||!a?.length)return null;const[M]=a,k=`${x||M.dataKey||M.name||"value"}`,z=Pi(v,M,k),$=!x&&typeof c=="string"?v[c]?.label||c:z?.label;return m?e.jsx("div",{className:He("font-medium",i),children:m($,a)}):$?e.jsx("div",{className:He("font-medium",i),children:$}):null},[c,m,a,n,i,v,x]);if(!s||!a?.length)return null;const j=a.length===1&&r!=="dot";return e.jsxs("div",{ref:f,className:He("grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",t),children:[j?null:y,e.jsx("div",{className:"grid gap-1.5",children:a.map((M,k)=>{const z=`${p||M.name||M.dataKey||"value"}`,$=Pi(v,M,z),u=d||M.payload.fill||M.color;return e.jsx("div",{className:He("flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground",r==="dot"&&"items-center"),children:o&&M?.value!==void 0&&M.name?o(M.value,M.name,M,k,M.payload):e.jsxs(e.Fragment,{children:[$?.icon?e.jsx($.icon,{}):!l&&e.jsx("div",{className:He("shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",{"h-2.5 w-2.5":r==="dot","w-1":r==="line","w-0 border-[1.5px] border-dashed bg-transparent":r==="dashed","my-0.5":j&&r==="dashed"}),style:{"--color-bg":u,"--color-border":u}}),e.jsxs("div",{className:He("flex flex-1 justify-between leading-none",j?"items-end":"items-center"),children:[e.jsxs("div",{className:"grid gap-1.5",children:[j?y:null,e.jsx("span",{className:"text-muted-foreground",children:$?.label||M.name})]}),M.value&&e.jsx("span",{className:"font-mono font-medium tabular-nums text-foreground",children:M.value.toLocaleString()})]})]})},M.dataKey)})})]})});Ma.displayName="ChartTooltip";const Rf=w.forwardRef(({className:s,hideIcon:a=!1,payload:t,verticalAlign:r="bottom",nameKey:n},l)=>{const{config:c}=Hc();return t?.length?e.jsx("div",{ref:l,className:He("flex items-center justify-center gap-4",r==="top"?"pb-3":"pt-3",s),children:t.map(m=>{const i=`${n||m.dataKey||"value"}`,o=Pi(c,m,i);return e.jsxs("div",{className:He("flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"),children:[o?.icon&&!a?e.jsx(o.icon,{}):e.jsx("div",{className:"h-2 w-2 shrink-0 rounded-[2px]",style:{backgroundColor:m.color}}),o?.label]},m.value)})}):null});Rf.displayName="ChartLegend";function Pi(s,a,t){if(typeof a!="object"||a===null)return;const r="payload"in a&&typeof a.payload=="object"&&a.payload!==null?a.payload:void 0;let n=t;return t in a&&typeof a[t]=="string"?n=a[t]:r&&t in r&&typeof r[t]=="string"&&(n=r[t]),n in s?s[n]:s[t]}const io=[{value:"7",label:"7 dias"},{value:"30",label:"30 dias"},{value:"12m",label:"12 meses"}];function Lf({orders:s=[],pdvSales:a=[]}){const[t,r]=w.useState("7"),{isDark:n}=xn(),l=w.useMemo(()=>{const d=t==="12m",p=d?12:t==="7"?7:30,x=Array.from({length:p},(y,j)=>{if(d){const k=J().subtract(11-j,"months");return{date:k.format("MMM/YY"),fullDate:k.toDate(),revenue:0,orders:0}}const M=J().subtract(p-1-j,"days");return{date:M.format("DD/MM"),fullDate:M.toDate(),revenue:0,orders:0}}),f=(y,j)=>d?y.isSame(j.fullDate,"month"):y.isSame(j.fullDate,"day");return(s||[]).filter(y=>y.status!=="cancelled").forEach(y=>{const j=J(y.created_date),M=x.findIndex(k=>f(j,k));M!==-1&&(y.status==="delivered"&&(x[M].revenue+=y.total||0),x[M].orders+=1)}),x},[s,a,t]),c={revenue:{label:"Faturamento",color:"hsl(var(--chart-1))"},orders:{label:"Pedidos",color:"hsl(var(--chart-2))"}},m=d=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0,maximumFractionDigits:0}).format(d||0),i=n?"#475569":"#e5e7eb",o=n?"#94a3b8":"#6b7280";return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(B,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs(ce,{className:"text-base font-semibold flex items-center gap-2",style:{color:"var(--text-primary)"},children:[e.jsx($a,{className:"w-5 h-5 text-green-600"}),"Faturamento"]}),e.jsxs(Ce,{value:t,onValueChange:r,children:[e.jsx(ke,{className:"w-[120px] h-8",children:e.jsx(Se,{})}),e.jsx(De,{children:io.map(d=>e.jsx(Q,{value:d.value,children:d.label},d.value))})]})]}),e.jsx(H,{children:e.jsx(Da,{config:c,className:"h-[300px]",children:e.jsxs(Ph,{data:l,margin:{top:10,right:10,left:0,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorRevenue",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#22c55e",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#22c55e",stopOpacity:0})]})}),e.jsx(et,{strokeDasharray:"3 3",stroke:i}),e.jsx(Aa,{dataKey:"date",stroke:o,fontSize:12,tickLine:!1,axisLine:!1}),e.jsx(Pa,{stroke:o,fontSize:12,tickLine:!1,axisLine:!1,tickFormatter:d=>d>=1e3?`R$ ${(d/1e3).toFixed(1)}k`:`R$ ${d}`}),e.jsx(Ka,{content:e.jsx(Ma,{formatter:d=>m(d)})}),e.jsx(Ya,{type:"monotone",dataKey:"revenue",stroke:"#22c55e",fillOpacity:1,fill:"url(#colorRevenue)",strokeWidth:2})]})})})]}),e.jsxs(B,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs(ce,{className:"text-base font-semibold flex items-center gap-2",style:{color:"var(--text-primary)"},children:[e.jsx(Ls,{className:"w-5 h-5 text-blue-600"}),"Pedidos"]}),e.jsx("span",{className:"text-xs",style:{color:"var(--text-secondary)"},children:io.find(d=>d.value===t)?.label})]}),e.jsx(H,{children:e.jsx(Da,{config:c,className:"h-[300px]",children:e.jsxs(sc,{data:l,margin:{top:10,right:10,left:0,bottom:0},children:[e.jsx(et,{strokeDasharray:"3 3",stroke:i}),e.jsx(Aa,{dataKey:"date",stroke:o,fontSize:12,tickLine:!1,axisLine:!1}),e.jsx(Pa,{stroke:o,fontSize:12,tickLine:!1,axisLine:!1}),e.jsx(Ka,{content:e.jsx(Ma,{})}),e.jsx(Gt,{type:"monotone",dataKey:"orders",stroke:"#3b82f6",strokeWidth:3,dot:{fill:"#3b82f6",r:4},activeDot:{r:6}})]})})})]})]})}const Fr=["#22c55e","#3b82f6","#f59e0b","#ef4444","#8b5cf6","#ec4899","#06b6d4"];function If({orders:s=[],dishes:a=[],categories:t=[]}){const[r,n]=w.useState("7"),[l,c]=w.useState(()=>{const g=localStorage.getItem("dashboard_revenue_target");return g?parseFloat(g):0}),{isDark:m}=xn();w.useEffect(()=>{l>0&&localStorage.setItem("dashboard_revenue_target",l.toString())},[l]);const i=w.useMemo(()=>{const g=Array.from({length:24},(h,b)=>({hour:b,orders:0,revenue:0}));return(s||[]).filter(h=>h.status!=="cancelled").forEach(h=>{const b=J(h.created_date).hour();g[b].orders+=1,h.status==="delivered"&&(g[b].revenue+=h.total||0)}),g.map(h=>({...h,label:`${h.hour.toString().padStart(2,"0")}:00`}))},[s]),o=w.useMemo(()=>{const g={};return(s||[]).filter(h=>h.status==="delivered").forEach(h=>{const b=h.payment_method||"Não informado";g[b]||(g[b]={name:b,count:0,revenue:0}),g[b].count+=1,g[b].revenue+=h.total||0}),Object.values(g).sort((h,b)=>b.revenue-h.revenue)},[s]),d=w.useMemo(()=>{const g={};return(s||[]).filter(h=>h.status!=="cancelled").forEach(h=>{h.items&&h.items.forEach(b=>{const L=a.find(O=>O.id===(b.dish_id||b.dish?.id));if(L&&L.category_id){const P=t.find(C=>C.id===L.category_id)?.name||"Sem categoria";g[P]||(g[P]={name:P,count:0,revenue:0});const F=b.quantity||1;g[P].count+=F,h.status==="delivered"&&(g[P].revenue+=(b.unit_price||L.price||0)*F)}})}),Object.values(g).sort((h,b)=>b.revenue-h.revenue).slice(0,5)},[s,a,t]),p=w.useMemo(()=>{const T=["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"].map((b,L)=>({day:b,orders:0,revenue:0}));return(s||[]).filter(b=>b.status!=="cancelled").forEach(b=>{const L=J(b.created_date).day();T[L].orders+=1,b.status==="delivered"&&(T[L].revenue+=b.total||0)}),T},[s]),x=w.useMemo(()=>{const g=s.length,T=s.filter(h=>h.status==="cancelled").length;return g>0?(T/g*100).toFixed(1):0},[s]),f=w.useMemo(()=>{const g=s.filter(h=>h.status==="delivered"&&h.created_date&&h.delivered_date);if(g.length===0)return null;const T=g.reduce((h,b)=>{const L=J(b.created_date),O=J(b.delivered_date);return h+O.diff(L,"minutes")},0);return Math.round(T/g.length)},[s]),v=w.useMemo(()=>{const g={};(s||[]).filter(L=>L.status!=="cancelled").forEach(L=>{const O=L.customer_phone||L.customer_name||"unknown";g[O]||(g[O]=0),g[O]+=1});const h=Object.values(g).filter(L=>L>1).length,b=Object.keys(g).length;return{count:h,percentage:b>0?(h/b*100).toFixed(1):0,total:b}},[s]),y=w.useMemo(()=>{const g=J().startOf("month"),h=(s||[]).filter(L=>J(L.created_date).isSameOrAfter(g)&&L.status==="delivered").reduce((L,O)=>L+(O.total||0),0),b=l>0?h/l*100:0;return{target:l,actual:h,progress:Math.min(b,100),remaining:Math.max(0,l-h)}},[s,l]),j=w.useMemo(()=>{let g=0,T=0;try{for(let L=0;L<localStorage.length;L++){const O=localStorage.key(L);if(O&&O.startsWith("cardapio_cart_")){const P=localStorage.getItem(O);if(P)try{const F=JSON.parse(P);F&&F.length>0&&g++}catch{}}}}catch(L){console.warn("Erro ao calcular carrinhos abandonados:",L)}T=(s||[]).filter(L=>L.status==="delivered").length;const h=g+T,b=h>0?(g/h*100).toFixed(1):0;return{abandoned:g,completed:T,rate:parseFloat(b),total:h}},[s]),M=w.useMemo(()=>{const T={},h=(s||[]).filter(P=>P.status==="delivered");for(let P=0;P<7;P++){const F=J().subtract(P,"days").startOf("day"),N=h.filter(V=>J(V.created_date).isSame(F,"day")).reduce((V,E)=>V+(E.total||0),0);T[F.format("YYYY-MM-DD")]=N}const b=Object.values(T),L=b.length>0?b.reduce((P,F)=>P+F,0)/b.length:0,O=[];for(let P=1;P<=7;P++){const F=J().add(P,"days");O.push({date:F.format("DD/MM"),predicted:L*(1+P*.02),confidence:Math.max(60,100-P*5)})}return{avgDailyRevenue:L,forecast:O,trend:b.length>=2?b[0]>b[b.length-1]?"up":"down":"stable"}},[s]),k=w.useMemo(()=>{const g=(s||[]).filter(b=>b.status!=="cancelled"),T=g.filter(b=>b.status==="delivered"),h=g.filter(b=>b.delivery_type==="delivery"||b.delivery_type==="entrega");return{total:g.length,delivered:T.length,delivery:h.length,rate:g.length>0?(T.length/g.length*100).toFixed(1):0,deliveryPercentage:g.length>0?(h.length/g.length*100).toFixed(1):0}},[s]),z=g=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0,maximumFractionDigits:0}).format(g||0),$=m?"#475569":"#e5e7eb",u=m?"#94a3b8":"#6b7280";return e.jsxs("div",{className:"space-y-6",children:[l>0&&e.jsxs(B,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(oe,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(ce,{className:"text-base font-semibold flex items-center gap-2",style:{color:"var(--text-primary)"},children:[e.jsx(zm,{className:"w-5 h-5 text-blue-500"}),"Meta de Faturamento do Mês"]}),e.jsx(U,{type:"number",value:l,onChange:g=>c(parseFloat(g.target.value)||0),className:"w-32",placeholder:"Meta (R$)"})]})}),e.jsx(H,{children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",style:{color:"var(--text-secondary)"},children:[e.jsxs("span",{children:["Realizado: ",z(y.actual)]}),e.jsxs("span",{children:["Meta: ",z(y.target)]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${y.progress>=100?"bg-green-500":y.progress>=75?"bg-blue-500":"bg-orange-500"}`,style:{width:`${Math.min(y.progress,100)}%`}})}),e.jsxs("div",{className:"text-xs mt-1",style:{color:"var(--text-secondary)"},children:[y.progress.toFixed(1),"% da meta",y.remaining>0&&e.jsxs("span",{className:"ml-2",children:["• Faltam ",z(y.remaining)]})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(B,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(oe,{className:"pb-2",children:e.jsxs(ce,{className:"text-sm font-medium flex items-center gap-2",style:{color:"var(--text-primary)"},children:[e.jsx(vo,{className:"w-4 h-4 text-orange-500"}),"Taxa de Cancelamento"]})}),e.jsxs(H,{children:[e.jsxs("div",{className:"text-2xl font-bold",style:{color:"var(--text-primary)"},children:[x,"%"]}),e.jsxs("p",{className:"text-xs mt-1",style:{color:"var(--text-secondary)"},children:[s.filter(g=>g.status==="cancelled").length," de ",s.length," pedidos"]})]})]}),e.jsxs(B,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(oe,{className:"pb-2",children:e.jsxs(ce,{className:"text-sm font-medium flex items-center gap-2",style:{color:"var(--text-primary)"},children:[e.jsx(or,{className:"w-4 h-4 text-blue-500"}),"Tempo Médio"]})}),e.jsxs(H,{children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--text-primary)"},children:f?`${f} min`:"N/A"}),e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--text-secondary)"},children:"Tempo de preparo"})]})]}),e.jsxs(B,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(oe,{className:"pb-2",children:e.jsxs(ce,{className:"text-sm font-medium flex items-center gap-2",style:{color:"var(--text-primary)"},children:[e.jsx(Et,{className:"w-4 h-4 text-green-500"}),"Clientes Recorrentes"]})}),e.jsxs(H,{children:[e.jsxs("div",{className:"text-2xl font-bold",style:{color:"var(--text-primary)"},children:[v.percentage,"%"]}),e.jsxs("p",{className:"text-xs mt-1",style:{color:"var(--text-secondary)"},children:[v.count," de ",v.total," clientes"]})]})]}),e.jsxs(B,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(oe,{className:"pb-2",children:e.jsxs(ce,{className:"text-sm font-medium flex items-center gap-2",style:{color:"var(--text-primary)"},children:[e.jsx(lt,{className:"w-4 h-4 text-purple-500"}),"Método Mais Usado"]})}),e.jsxs(H,{children:[e.jsx("div",{className:"text-lg font-bold",style:{color:"var(--text-primary)"},children:o[0]?.name||"N/A"}),e.jsxs("p",{className:"text-xs mt-1",style:{color:"var(--text-secondary)"},children:[o[0]?.count||0," pedidos"]})]})]}),e.jsxs(B,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(oe,{className:"pb-2",children:e.jsxs(ce,{className:"text-sm font-medium flex items-center gap-2",style:{color:"var(--text-primary)"},children:[e.jsx(Lt,{className:"w-4 h-4 text-red-500"}),"Abandono de Carrinho"]})}),e.jsxs(H,{children:[e.jsxs("div",{className:"text-2xl font-bold",style:{color:"var(--text-primary)"},children:[j.rate,"%"]}),e.jsxs("p",{className:"text-xs mt-1",style:{color:"var(--text-secondary)"},children:[j.abandoned," abandonados / ",j.total," total"]})]})]}),e.jsxs(B,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(oe,{className:"pb-2",children:e.jsxs(ce,{className:"text-sm font-medium flex items-center gap-2",style:{color:"var(--text-primary)"},children:[e.jsx(ys,{className:"w-4 h-4 text-indigo-500"}),"Taxa de Entrega"]})}),e.jsxs(H,{children:[e.jsxs("div",{className:"text-2xl font-bold",style:{color:"var(--text-primary)"},children:[k.rate,"%"]}),e.jsxs("p",{className:"text-xs mt-1",style:{color:"var(--text-secondary)"},children:[k.delivered," de ",k.total," pedidos"]})]})]})]}),e.jsxs(B,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(oe,{children:e.jsxs(ce,{className:"text-base font-semibold flex items-center gap-2",style:{color:"var(--text-primary)"},children:[e.jsx(Ls,{className:"w-5 h-5 text-green-500"}),"Previsão de Demanda (Próximos 7 dias)"]})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:"Receita Média Diária"}),e.jsx("p",{className:"text-2xl font-bold",style:{color:"var(--text-primary)"},children:z(M.avgDailyRevenue)})]}),e.jsx(fe,{variant:M.trend==="up"?"default":"secondary",children:M.trend==="up"?"Tendência de Alta":"Tendência de Baixa"})]}),e.jsx(Da,{config:{predicted:{label:"Previsão",color:"#22c55e"}},className:"h-[200px]",children:e.jsxs(sc,{data:M.forecast,margin:{top:10,right:10,left:0,bottom:0},children:[e.jsx(et,{strokeDasharray:"3 3",stroke:$}),e.jsx(Aa,{dataKey:"date",stroke:u,fontSize:11,tickLine:!1,axisLine:!1}),e.jsx(Pa,{stroke:u,fontSize:11,tickLine:!1,axisLine:!1,tickFormatter:g=>z(g)}),e.jsx(Ka,{content:e.jsx(Ma,{formatter:g=>z(g)})}),e.jsx(Gt,{type:"monotone",dataKey:"predicted",stroke:"#22c55e",strokeWidth:2,dot:{fill:"#22c55e",r:4}})]})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-7 gap-2",children:M.forecast.map((g,T)=>e.jsxs("div",{className:"text-center p-2 rounded",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("p",{className:"text-xs font-semibold",style:{color:"var(--text-primary)"},children:g.date}),e.jsx("p",{className:"text-xs",style:{color:"var(--text-secondary)"},children:z(g.predicted)}),e.jsxs("p",{className:"text-xs",style:{color:"var(--text-secondary)"},children:[g.confidence,"% confiança"]})]},T))})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(B,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(oe,{children:e.jsxs(ce,{className:"text-base font-semibold flex items-center gap-2",style:{color:"var(--text-primary)"},children:[e.jsx(or,{className:"w-5 h-5 text-orange-500"}),"Horários de Pico"]})}),e.jsx(H,{children:e.jsx(Da,{config:{orders:{label:"Pedidos",color:"#f97316"}},className:"h-[300px]",children:e.jsxs(Jn,{data:i,margin:{top:10,right:10,left:0,bottom:0},children:[e.jsx(et,{strokeDasharray:"3 3",stroke:$}),e.jsx(Aa,{dataKey:"label",stroke:u,fontSize:11,tickLine:!1,axisLine:!1}),e.jsx(Pa,{stroke:u,fontSize:11,tickLine:!1,axisLine:!1}),e.jsx(Ka,{content:e.jsx(Ma,{})}),e.jsx(Xn,{dataKey:"orders",fill:"#f97316",radius:[4,4,0,0]})]})})})]}),e.jsxs(B,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(oe,{children:e.jsxs(ce,{className:"text-base font-semibold flex items-center gap-2",style:{color:"var(--text-primary)"},children:[e.jsx(lt,{className:"w-5 h-5 text-green-500"}),"Métodos de Pagamento"]})}),e.jsx(H,{children:e.jsx(Da,{config:{revenue:{label:"Faturamento",color:"#22c55e"}},className:"h-[300px]",children:e.jsxs(Dm,{children:[e.jsx(Mm,{data:o,cx:"50%",cy:"50%",labelLine:!1,label:({name:g,percent:T})=>`${g}: ${(T*100).toFixed(0)}%`,outerRadius:100,fill:"#8884d8",dataKey:"revenue",children:o.map((g,T)=>e.jsx(Am,{fill:Fr[T%Fr.length]},`cell-${T}`))}),e.jsx(Ka,{content:e.jsx(Ma,{formatter:g=>z(g)})})]})})})]}),e.jsxs(B,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(oe,{children:e.jsxs(ce,{className:"text-base font-semibold flex items-center gap-2",style:{color:"var(--text-primary)"},children:[e.jsx(Ls,{className:"w-5 h-5 text-blue-500"}),"Categorias Mais Vendidas"]})}),e.jsx(H,{children:e.jsx(Da,{config:{revenue:{label:"Faturamento",color:"#3b82f6"}},className:"h-[300px]",children:e.jsxs(Jn,{data:d,layout:"vertical",margin:{top:10,right:10,left:60,bottom:0},children:[e.jsx(et,{strokeDasharray:"3 3",stroke:$}),e.jsx(Aa,{type:"number",stroke:u,fontSize:11,tickLine:!1,axisLine:!1,tickFormatter:g=>z(g)}),e.jsx(Pa,{type:"category",dataKey:"name",stroke:u,fontSize:11,tickLine:!1,axisLine:!1,width:50}),e.jsx(Ka,{content:e.jsx(Ma,{formatter:g=>z(g)})}),e.jsx(Xn,{dataKey:"revenue",fill:"#3b82f6",radius:[0,4,4,0]})]})})})]}),e.jsxs(B,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(oe,{children:e.jsxs(ce,{className:"text-base font-semibold flex items-center gap-2",style:{color:"var(--text-primary)"},children:[e.jsx(It,{className:"w-5 h-5 text-purple-500"}),"Performance por Dia da Semana"]})}),e.jsx(H,{children:e.jsx(Da,{config:{orders:{label:"Pedidos",color:"#8b5cf6"}},className:"h-[300px]",children:e.jsxs(Jn,{data:p,margin:{top:10,right:10,left:0,bottom:0},children:[e.jsx(et,{strokeDasharray:"3 3",stroke:$}),e.jsx(Aa,{dataKey:"day",stroke:u,fontSize:11,tickLine:!1,axisLine:!1}),e.jsx(Pa,{stroke:u,fontSize:11,tickLine:!1,axisLine:!1}),e.jsx(Ka,{content:e.jsx(Ma,{})}),e.jsx(Xn,{dataKey:"orders",fill:"#8b5cf6",radius:[4,4,0,0]})]})})})]})]}),o.length>0&&e.jsxs(B,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(oe,{children:e.jsx(ce,{className:"text-base font-semibold",style:{color:"var(--text-primary)"},children:"Detalhamento de Métodos de Pagamento"})}),e.jsx(H,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottomColor:"var(--border-color)"},children:[e.jsx("th",{className:"text-left py-2 px-3 text-sm font-semibold",style:{color:"var(--text-primary)"},children:"Método"}),e.jsx("th",{className:"text-right py-2 px-3 text-sm font-semibold",style:{color:"var(--text-primary)"},children:"Pedidos"}),e.jsx("th",{className:"text-right py-2 px-3 text-sm font-semibold",style:{color:"var(--text-primary)"},children:"Faturamento"}),e.jsx("th",{className:"text-right py-2 px-3 text-sm font-semibold",style:{color:"var(--text-primary)"},children:"%"})]})}),e.jsx("tbody",{children:o.map((g,T)=>{const h=o.reduce((L,O)=>L+O.revenue,0),b=h>0?(g.revenue/h*100).toFixed(1):0;return e.jsxs("tr",{style:{borderBottomColor:"var(--border-color)"},children:[e.jsx("td",{className:"py-2 px-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:Fr[T%Fr.length]}}),e.jsx("span",{style:{color:"var(--text-primary)"},children:g.name})]})}),e.jsx("td",{className:"text-right py-2 px-3",style:{color:"var(--text-primary)"},children:g.count}),e.jsx("td",{className:"text-right py-2 px-3 font-semibold",style:{color:"var(--text-primary)"},children:z(g.revenue)}),e.jsx("td",{className:"text-right py-2 px-3",children:e.jsxs(fe,{variant:"outline",children:[b,"%"]})})]},g.name)})})]})})})]})]})}async function En(s,a=8e3,t="Timeout ao buscar dados"){const r=new Promise((n,l)=>setTimeout(()=>l(new Error(t)),a));try{return await Promise.race([s,r])}catch(n){throw console.error("[safeFetch] Erro:",n),n}}function pt(s,a=[]){return Array.isArray(s)?s:a}function Wt(s={}){const{menuContext:a}=Ze(),{orderBy:t="-created_date",filters:r={},...n}=s;return Ae({queryKey:["orders",a?.type,a?.value,t,r],queryFn:async()=>{if(!a)return Qe.menu.warn("⚠️ [useOrders] menuContext não disponível"),[];try{Qe.menu.log("📦 [useOrders] Buscando pedidos...",a);const l={};a.type==="subscriber"&&a.value&&(l.as_subscriber=a.value);const c=ae.entities.Order.list(t,l),m=await En(c,1e4,"Timeout ao buscar pedidos");let i=pt(m);return Object.keys(r).length>0&&(i=i.filter(o=>Object.entries(r).every(([d,p])=>p==null?!0:o[d]===p))),Qe.menu.log("✅ [useOrders] Pedidos recebidos:",i.length),i}catch(l){return Qe.menu.error("❌ [useOrders] Erro ao buscar pedidos:",l),[]}},enabled:!!a&&n.enabled!==!1,initialData:[],retry:1,refetchOnMount:"always",staleTime:3e4,gcTime:6e4,...n})}async function Kc(s){try{Qe.menu.log("📦 [adminMenuService] Buscando pratos admin...",s);const a={};s.type==="subscriber"&&s.value&&(a.as_subscriber=s.value);const t=ae.entities.Dish.list("order",a),r=await En(t,1e4,"Timeout ao buscar pratos");return Qe.menu.log("✅ [adminMenuService] Pratos recebidos:",pt(r).length),pt(r)}catch(a){return Qe.menu.error("❌ [adminMenuService] Erro ao buscar pratos:",a),[]}}async function Qc(s){try{Qe.menu.log("📦 [adminMenuService] Buscando categorias admin...",s);const a={};s.type==="subscriber"&&s.value&&(a.as_subscriber=s.value);const t=ae.entities.Category.list("order",a),r=await En(t,1e4,"Timeout ao buscar categorias");return Qe.menu.log("✅ [adminMenuService] Categorias recebidas:",pt(r).length),pt(r)}catch(a){return Qe.menu.error("❌ [adminMenuService] Erro ao buscar categorias:",a),[]}}async function $f(s){try{Qe.menu.log("📦 [adminMenuService] Buscando grupos de complementos admin...",s);const a={};s.type==="subscriber"&&s.value&&(a.as_subscriber=s.value);const t=ae.entities.ComplementGroup.list("order",a),r=await En(t,1e4,"Timeout ao buscar grupos de complementos");return Qe.menu.log("✅ [adminMenuService] Grupos recebidos:",pt(r).length),pt(r)}catch(a){return Qe.menu.error("❌ [adminMenuService] Erro ao buscar grupos:",a),[]}}function Ht(s={}){const{menuContext:a}=Ze();return Ae({queryKey:["dishes",a?.type,a?.value],queryFn:async()=>a?await Kc(a):(Qe.menu.warn("⚠️ [useMenuDishes] menuContext não disponível"),[]),enabled:!!a&&s.enabled!==!1,initialData:[],placeholderData:ar,retry:1,refetchOnMount:"always",staleTime:3e4,gcTime:6e4,...s})}function Zc(s={}){const{menuContext:a}=Ze();return Ae({queryKey:["categories",a?.type,a?.value],queryFn:async()=>a?await Qc(a):(Qe.menu.warn("⚠️ [useMenuCategories] menuContext não disponível"),[]),enabled:!!a&&s.enabled!==!1,initialData:[],placeholderData:ar,retry:1,refetchOnMount:"always",staleTime:3e4,gcTime:6e4,...s})}function Xv({user:s,subscriberData:a,onNavigateToTab:t}){const[r,n]=w.useState(!1),{menuContext:l}=Ze(),{data:c=[]}=Ae({queryKey:["store",l?.type,l?.value],queryFn:async()=>{if(!l)return[];const N={};return l.type==="subscriber"&&l.value&&(N.as_subscriber=l.value),ae.entities.Store.list(null,N)},enabled:!!l}),m=c[0],{data:i=[]}=Wt({orderBy:"-created_date"}),{data:o=[]}=Ae({queryKey:["dashboardPDVSales",l?.type,l?.value],queryFn:async()=>{if(!l)return[];const N={};return l.type==="subscriber"&&l.value&&(N.as_subscriber=l.value),ae.entities.PedidoPDV.list("-created_date",N)},enabled:!!l}),{data:d=[]}=Ht(),{data:p=[]}=Zc(),x=J().startOf("day"),f=(i||[]).filter(N=>J(N.created_date).isSame(x,"day")&&N.status!=="cancelled");f.filter(N=>N.status==="delivered").reduce((N,V)=>N+(V.total||0),0);const v=J().startOf("month"),j=(i||[]).filter(N=>J(N.created_date).isSameOrAfter(v)&&N.status!=="cancelled").filter(N=>N.status==="delivered").reduce((N,V)=>N+(V.total||0),0),M=i.filter(N=>N.status==="new").length,k=i.filter(N=>["accepted","preparing"].includes(N.status)).length,z=i.filter(N=>N.status==="ready").length,$=i.filter(N=>N.status==="out_for_delivery").length,u=d.filter(N=>N.is_active!==!1).length;d.filter(N=>N.is_active===!1).length;const g=a?.expires_at?J(a.expires_at).diff(J(),"days"):null,T=N=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(N||0),{slug:h}=zo(),b=h||(s?.is_master?s?.slug:a?.slug),L=b?`${window.location.origin}/s/${b}`:`${window.location.origin}${js("Cardapio")}`,O=()=>{navigator.clipboard.writeText(L),n(!0),setTimeout(()=>n(!1),2e3)},P=()=>{window.open(`https://wa.me/?text=Confira nosso cardápio digital: ${L}`,"_blank")},F=N=>({new:"Novo",accepted:"Aceito",preparing:"Preparando",ready:"Pronto",out_for_delivery:"Em Rota",delivered:"Entregue",cancelled:"Cancelado"})[N]||N,C=()=>{const N=["Data","Código","Cliente","Status","Pagamento","Total"],V=i.map(S=>[er(S.created_date),S.order_code||S.id?.toString().slice(-6),S.customer_name||"",F(S.status),S.payment_method||"",(S.total||0).toFixed(2)]),E=[N,...V].map(S=>S.join(";")).join(`
`),ee="\uFEFF",ue=new Blob([ee+E],{type:"text/csv;charset=utf-8"}),Z=document.createElement("a");Z.href=URL.createObjectURL(ue),Z.download=`pedidos-${J().format("DD-MM-YYYY")}.csv`,Z.click(),URL.revokeObjectURL(Z.href)};return e.jsxs("div",{className:"space-y-4 sm:space-y-6 p-4 sm:p-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h2",{className:"text-xl sm:text-2xl font-bold truncate",style:{color:"var(--text-primary)"},children:["Boa ",J().hour()<12?"dia":J().hour()<18?"tarde":"noite",", ",a?.name?.split(" ")[0]||s?.full_name?.split(" ")[0]||"Usuário","!"]}),e.jsx("p",{className:"text-sm sm:text-base truncate",style:{color:"var(--text-secondary)"},children:m?.name||"Sua Loja"})]}),g!==null&&e.jsx(fe,{className:`px-2 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm font-semibold ${g<=7?"bg-red-500":"bg-green-500"} text-white flex-shrink-0`,children:g>0?`${g} dias restantes`:"Assinatura Expirada"})]}),e.jsx(zf,{orders:i,dishes:d,pdvSales:o}),(i.length>0||o.length>0)&&e.jsx(Lf,{orders:i,pdvSales:o}),i.length>0&&e.jsx(If,{orders:i,dishes:d,categories:p}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4",children:[e.jsx(Or,{icon:Lt,value:f.length,label:"Pedidos Hoje",color:"info",delay:0}),e.jsx(Or,{icon:$a,value:T(j),label:"Faturamento Mês",color:"success",delay:.1}),e.jsx(Or,{icon:or,value:M,label:"Novos Pedidos",color:"warning",delay:.2}),e.jsx(Or,{icon:ys,value:u,label:"Pratos Ativos",color:"primary",delay:.3})]}),e.jsxs(B,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(oe,{children:e.jsxs(ce,{className:"flex items-center gap-2",style:{color:"var(--text-primary)"},children:[e.jsx(ys,{className:"w-5 h-5"}),"Pedidos em Andamento"]})}),e.jsxs(H,{children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-4",children:[e.jsxs("div",{className:"rounded-lg p-4 text-center",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:M}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--text-secondary)"},children:"Novos"})]}),e.jsxs("div",{className:"rounded-lg p-4 text-center",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("p",{className:"text-3xl font-bold text-yellow-600",children:k}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--text-secondary)"},children:"Preparando"})]}),e.jsxs("div",{className:"rounded-lg p-4 text-center",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("p",{className:"text-3xl font-bold text-green-600",children:z}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--text-secondary)"},children:"Prontos"})]}),e.jsxs("div",{className:"rounded-lg p-4 text-center",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("p",{className:"text-3xl font-bold text-purple-600",children:$}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--text-secondary)"},children:"Em Entrega"})]})]}),e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row gap-2",children:[e.jsx(Wr,{to:js("GestorPedidos"),className:"flex-1",children:e.jsx(D,{className:"w-full min-h-touch",children:"Ver Todos os Pedidos"})}),e.jsxs(D,{variant:"outline",onClick:C,className:"flex-1 min-h-touch",children:[e.jsx(pn,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Exportar CSV"}),e.jsx("span",{className:"sm:hidden",children:"Exportar"})]})]})]})]}),e.jsxs(B,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ce,{className:"text-lg font-medium",style:{color:"var(--text-primary)"},children:"Cardápio Digital"}),e.jsx(Wr,{to:b?`/s/${b}`:js("Cardapio"),target:"_blank",children:e.jsxs(D,{variant:"outline",size:"sm",children:[e.jsx(Ri,{className:"w-4 h-4 mr-2"}),"Visualizar"]})})]}),e.jsxs(H,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(U,{value:L,readOnly:!0,className:"flex-1 text-xs sm:text-sm min-h-touch",style:{backgroundColor:"var(--bg-tertiary)",borderColor:"var(--border-color)",color:"var(--text-primary)"}}),e.jsx(D,{variant:"outline",size:"icon",onClick:O,className:"min-h-touch min-w-touch flex-shrink-0",children:r?e.jsx(la,{className:"w-4 h-4 text-green-500"}):e.jsx(Ks,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(D,{variant:"outline",size:"sm",onClick:P,className:"flex-1 min-h-touch",children:[e.jsx(Rm,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Compartilhar no WhatsApp"}),e.jsx("span",{className:"sm:hidden",children:"WhatsApp"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 sm:gap-4",children:[e.jsx(B,{className:"hover:shadow-lg transition-shadow cursor-pointer",onClick:()=>t?t("dishes"):window.location.href=js("Admin")+"?tab=dishes",style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:e.jsxs(H,{className:"p-4 sm:p-6 flex items-center gap-3 sm:gap-4 min-h-touch",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-lg flex items-center justify-center flex-shrink-0",style:{backgroundColor:"var(--bg-tertiary)"},children:e.jsx(ys,{className:"w-5 h-5 sm:w-6 sm:h-6 text-orange-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-sm sm:text-base truncate",style:{color:"var(--text-primary)"},children:"Gerenciar Cardápio"}),e.jsx("p",{className:"text-xs sm:text-sm truncate",style:{color:"var(--text-secondary)"},children:"Pratos, categorias e mais"})]})]})}),e.jsx(B,{className:"hover:shadow-lg transition-shadow cursor-pointer",onClick:()=>t?t("history"):window.location.href=js("Admin")+"?tab=history",style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:e.jsxs(H,{className:"p-4 sm:p-6 flex items-center gap-3 sm:gap-4 min-h-touch",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-lg flex items-center justify-center flex-shrink-0",style:{backgroundColor:"var(--bg-tertiary)"},children:e.jsx(Lt,{className:"w-5 h-5 sm:w-6 sm:h-6 text-blue-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-sm sm:text-base truncate",style:{color:"var(--text-primary)"},children:"Ver Pedidos"}),e.jsx("p",{className:"text-xs sm:text-sm truncate",style:{color:"var(--text-secondary)"},children:"Histórico completo"})]})]})}),e.jsx(B,{className:"hover:shadow-lg transition-shadow cursor-pointer",onClick:()=>t?t("store"):window.location.href=js("Admin")+"?tab=store",style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:e.jsxs(H,{className:"p-4 sm:p-6 flex items-center gap-3 sm:gap-4 min-h-touch",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-lg flex items-center justify-center flex-shrink-0",style:{backgroundColor:"var(--bg-tertiary)"},children:e.jsx(Et,{className:"w-5 h-5 sm:w-6 sm:h-6 text-green-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-sm sm:text-base truncate",style:{color:"var(--text-primary)"},children:"Configurações"}),e.jsx("p",{className:"text-xs sm:text-sm truncate",style:{color:"var(--text-secondary)"},children:"Loja e pagamentos"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs(B,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsxs(oe,{className:"flex flex-row items-center gap-2 space-y-0 pb-2",children:[e.jsx(To,{className:"w-5 h-5 text-blue-500"}),e.jsx(ce,{className:"text-lg font-medium",style:{color:"var(--text-primary)"},children:"Ajuda - Manual"})]}),e.jsxs(H,{children:[e.jsx("p",{className:"text-xs sm:text-sm mb-4",style:{color:"var(--text-secondary)"},children:"Está com alguma dúvida sobre como usar?"}),e.jsx(D,{variant:"outline",className:"w-full min-h-touch text-xs sm:text-sm",children:"ACESSAR MANUAL"})]})]}),e.jsxs(B,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsxs(oe,{className:"flex flex-row items-center gap-2 space-y-0 pb-2",children:[e.jsx(la,{className:"w-5 h-5 text-green-500"}),e.jsx(ce,{className:"text-lg font-medium",style:{color:"var(--text-primary)"},children:"Suporte"})]}),e.jsxs(H,{children:[e.jsx("p",{className:"text-xs sm:text-sm mb-4",style:{color:"var(--text-secondary)"},children:"Abra um chamado e receberá um contato"}),e.jsx("a",{href:"https://wa.me/5586988196114",target:"_blank",rel:"noopener noreferrer",className:"block",children:e.jsx(D,{className:"w-full bg-green-600 hover:bg-green-700 min-h-touch text-xs sm:text-sm",children:"ABRIR CHAMADO"})})]})]})]})]})}function lo({className:s="w-5 h-5",...a}){return e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:s,xmlns:"http://www.w3.org/2000/svg",...a,children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"})})}function ey({store:s,subscriber:a,compact:t=!1}){const r=es(),n=!!s?.id,l=!!a?.id&&!n,c=n?s?.send_whatsapp_commands!==!1:(a?.send_whatsapp_commands??a?.whatsapp_auto_enabled)!==!1,[m,i]=w.useState(c);w.useEffect(()=>{const f=n?s?.send_whatsapp_commands!==!1:(a?.send_whatsapp_commands??a?.whatsapp_auto_enabled)!==!1;i(f)},[n,s?.send_whatsapp_commands,a?.send_whatsapp_commands,a?.whatsapp_auto_enabled]);const o=le({mutationFn:async f=>s?.id?await _e.entities.Store.update(s.id,{send_whatsapp_commands:f}):Promise.reject(new Error("Loja não carregada.")),onSuccess:(f,v)=>{r.invalidateQueries({queryKey:["store"]}),r.invalidateQueries({queryKey:["stores"]}),W.success(v?"Comanda WhatsApp ativada!":"Comanda WhatsApp desativada!")},onError:()=>{i(f=>!f),W.error("Erro ao atualizar")}}),d=le({mutationFn:async f=>a?.id?await _e.entities.Subscriber.update(a.id,{send_whatsapp_commands:f}):Promise.reject(new Error("Assinante não carregado.")),onSuccess:(f,v)=>{r.invalidateQueries({queryKey:["subscriber"]}),r.invalidateQueries({queryKey:["permissions"]}),r.invalidateQueries({queryKey:["store"]}),W.success(v?"Comanda WhatsApp ativada!":"Comanda WhatsApp desativada!")},onError:()=>{i(f=>!f),W.error("Erro ao atualizar")}}),p=n?o:d,x=()=>{const f=!m;i(f),p.mutate(f)};return!n&&!l?null:t?e.jsx(D,{variant:"ghost",size:"icon",onClick:x,disabled:p.isPending,className:`min-h-touch min-w-touch ${m?"text-white bg-green-600/80 hover:bg-green-600":"text-white bg-gray-600/80 hover:bg-gray-600"}`,title:m?"Comanda WhatsApp: Ligado":"Comanda WhatsApp: Desligado",children:m?e.jsx(lo,{className:"w-5 h-5"}):e.jsx(Ul,{className:"w-4 h-4"})}):e.jsx(D,{variant:"ghost",size:"sm",onClick:x,disabled:p.isPending,className:`min-h-touch ${m?"text-white bg-green-600/80 hover:bg-green-600":"text-white bg-gray-600/80 hover:bg-gray-600"}`,title:m?"Desativar Comanda WhatsApp":"Ativar Comanda WhatsApp",children:m?e.jsxs(e.Fragment,{children:[e.jsx(lo,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"WhatsApp ON"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ul,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"WhatsApp OFF"})]})})}const mi=768;function On(){const[s,a]=w.useState(void 0);return w.useEffect(()=>{const t=window.matchMedia(`(max-width: ${mi-1}px)`),r=()=>{a(window.innerWidth<mi)};return t.addEventListener("change",r),a(window.innerWidth<mi),()=>t.removeEventListener("change",r)},[]),!!s}function sy({isMaster:s,hasGestorAccess:a,hasModuleAccess:t,slug:r,className:n=""}){const[l,c]=w.useState(!1),m=On(),i=d=>typeof t=="function"?t(d):!0,o=[...s?[{id:"dashboard",label:"Dashboard",icon:Vm,to:js("AdminMasterDashboard"),color:"from-orange-500 to-orange-600",hoverColor:"hover:from-orange-600 hover:to-orange-700"},{id:"assinantes",label:"Assinantes",icon:Et,to:js("Assinantes"),color:"from-purple-600 to-purple-700",hoverColor:"hover:from-purple-700 hover:to-purple-800"}]:[],{id:"cardapio",label:"Cardápio",icon:sa,to:r?js("Cardapio",r):js("Cardapio"),color:"from-green-600 to-green-700",hoverColor:"hover:from-green-700 hover:to-green-800"},...i("pdv")?[{id:"pdv",label:"PDV",icon:Lo,to:js("PDV"),color:"from-blue-600 to-blue-700",hoverColor:"hover:from-blue-700 hover:to-blue-800"}]:[],...a?[{id:"gestor",label:"Gestor de Pedidos",icon:ct,to:js("GestorPedidos"),color:"from-orange-600 to-orange-700",hoverColor:"hover:from-orange-700 hover:to-orange-800"}]:[],...i("orders")?[{id:"entregador",label:"Entregador",icon:Um,to:js("Entregador"),color:"from-cyan-600 to-cyan-700",hoverColor:"hover:from-cyan-700 hover:to-cyan-800"}]:[],...i("garcom")?[{id:"garcom",label:"Garçom",icon:Vu,to:js("Garcom"),color:"from-indigo-600 to-indigo-700",hoverColor:"hover:from-indigo-700 hover:to-indigo-800"}]:[],...i("colaboradores")?[{id:"cozinha",label:"Cozinha",icon:$i,to:js("Cozinha"),color:"from-orange-500 to-orange-600",hoverColor:"hover:from-orange-600 hover:to-orange-700"}]:[]];return o.length===0?null:m?e.jsxs(fn,{open:l,onOpenChange:c,children:[e.jsx(jn,{asChild:!0,children:e.jsx(D,{variant:"ghost",size:"icon",className:`text-white bg-white/10 hover:bg-white/20 backdrop-blur-sm min-h-touch min-w-touch ${n}`,title:"Menu Rápido",children:e.jsx(Fa,{className:"w-5 h-5"})})}),e.jsx(vn,{side:"bottom",className:"h-auto max-h-[85vh] rounded-t-3xl p-0 bg-gray-900/95 dark:bg-gray-900/95 backdrop-blur-xl border-t border-white/10 dark:border-gray-700/50 pb-[max(1rem,env(safe-area-inset-bottom,0px))] overflow-hidden",children:e.jsxs(We.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:50},transition:{type:"spring",damping:25,stiffness:300},className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 pb-3 border-b border-white/10",children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:"Menu Rápido"}),e.jsx(D,{variant:"ghost",size:"icon",onClick:()=>c(!1),className:"text-white hover:bg-white/10 min-h-touch min-w-touch",children:e.jsx(ws,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:o.map((d,p)=>{const x=d.icon;return e.jsx(We.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:p*.05,type:"spring",damping:20},children:e.jsx(Wr,{to:d.to,onClick:()=>c(!1),className:"block",children:e.jsxs(D,{variant:"ghost",className:`w-full h-20 sm:h-24 flex flex-col items-center justify-center gap-2 bg-gradient-to-br ${d.color} ${d.hoverColor} text-white shadow-lg transition-all min-h-touch active:scale-95 hover:scale-105 rounded-xl backdrop-blur-sm`,children:[e.jsx(x,{className:"w-6 h-6 sm:w-7 sm:h-7"}),e.jsx("span",{className:"text-xs sm:text-sm font-medium",children:d.label})]})})},d.id)})})]})})]}):e.jsxs("div",{className:"relative",children:[e.jsx(D,{variant:"ghost",size:"icon",onClick:()=>c(!l),className:`text-white bg-white/10 hover:bg-white/20 backdrop-blur-sm ${n}`,title:"Menu Rápido",children:e.jsx(Fa,{className:"w-5 h-5"})}),e.jsx(dt,{children:l&&e.jsxs(e.Fragment,{children:[e.jsx(We.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>c(!1),className:"fixed inset-0 z-40 bg-black/20 backdrop-blur-sm"}),e.jsxs(We.div,{initial:{opacity:0,scale:.9,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:-10},transition:{type:"spring",damping:25,stiffness:300},className:"fixed top-16 right-4 z-50 w-80 bg-white/95 dark:bg-gray-900/95 backdrop-blur-xl rounded-2xl shadow-2xl border border-white/20 dark:border-gray-700/50 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 pb-3 border-b border-gray-200/50 dark:border-gray-700/50",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Menu Rápido"}),e.jsx(D,{variant:"ghost",size:"icon",onClick:()=>c(!1),className:"h-8 w-8 text-gray-500 hover:text-gray-900 dark:hover:text-white",children:e.jsx(ws,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:o.map((d,p)=>{const x=d.icon;return e.jsx(We.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:p*.05},children:e.jsx(Wr,{to:d.to,onClick:()=>c(!1),className:"block",children:e.jsxs(D,{variant:"ghost",className:`w-full h-20 flex flex-col items-center justify-center gap-2 bg-gradient-to-br ${d.color} ${d.hoverColor} text-white shadow-lg transition-all hover:scale-105 active:scale-95 rounded-xl`,children:[e.jsx(x,{className:"w-6 h-6"}),e.jsx("span",{className:"text-xs font-medium",children:d.label})]})})},d.id)})})]})]})})]})}function qf({isOpen:s,onClose:a,onSelect:t,availableGroups:r,allDishes:n,currentDish:l}){const[c,m]=w.useState(""),[i,o]=w.useState([]),p=l?.complement_groups?l.complement_groups.map(v=>v.group_id):[],x=v=>n.filter(y=>y.complement_groups?.some(j=>j.group_id===v)),f=r.filter(v=>v.name.toLowerCase().includes(c.toLowerCase()));return e.jsx(ze,{open:s,onOpenChange:a,children:e.jsxs(Te,{className:"sm:max-w-2xl max-w-[95vw] max-h-[80vh] flex flex-col",children:[e.jsxs(Fe,{children:[e.jsx(Re,{children:"Copiar grupo"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Selecione um ou mais grupos para reutilizar"})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(_s,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(U,{placeholder:"Buscar grupos de complementos",value:c,onChange:v=>m(v.target.value),className:"pl-10"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-2",children:f.length===0?e.jsx("div",{className:"text-center py-8 text-gray-400",children:"Nenhum grupo encontrado"}):f.map(v=>{const y=x(v.id),j=i.includes(v.id),M=p.includes(v.id);return e.jsx("button",{onClick:()=>{M||o(j?k=>k.filter(z=>z!==v.id):k=>[...k,v.id])},disabled:M,className:`w-full p-4 border rounded-lg text-left transition-colors ${M?"bg-gray-100 border-gray-300 opacity-60 cursor-not-allowed":j?"bg-orange-50 border-orange-300":"hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-5 h-5 mt-0.5 border-2 rounded flex items-center justify-center flex-shrink-0 ${M?"bg-gray-400 border-gray-400":j?"bg-orange-500 border-orange-500":"border-gray-300"}`,children:M?e.jsx(aa,{className:"w-3 h-3 text-white"}):j?e.jsx(aa,{className:"w-3 h-3 text-white"}):null}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-base",children:v.name}),M&&e.jsx(fe,{variant:"outline",className:"text-xs bg-green-50 text-green-700 border-green-300",children:"Já adicionado"})]}),e.jsx("p",{className:"text-sm text-gray-500",children:M?"Este grupo já está adicionado a este prato":y.length>0?`Disponível em: ${y.map(k=>k.name).join(", ")}`:"Grupo disponível para uso"})]}),e.jsxs(fe,{variant:"outline",className:"ml-2 flex-shrink-0",children:[(v.options||[]).length," opções"]})]})},v.id)})}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsx("p",{className:"text-sm text-gray-600",children:i.length>0?`${i.length} grupo(s) selecionado(s)`:"Nenhum grupo selecionado"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(D,{variant:"outline",onClick:a,children:"Voltar"}),e.jsxs(D,{onClick:()=>{i.forEach(v=>t(v)),o([]),a()},disabled:i.length===0,className:"bg-orange-500 hover:bg-orange-600",children:["Confirmar ",i.length>0&&`(${i.length})`]})]})]})]})})}function Yf({template:s,displayName:a,onUse:t,onDelete:r,onEdit:n}){const[l,c]=w.useState(!1),[m,i]=w.useState(a),o=()=>{m.trim()&&m.trim()!==a&&n(m.trim()),c(!1)},d=()=>{i(a),c(!1)};return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"flex-1",children:l?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{value:m,onChange:p=>i(p.target.value),className:"flex-1 h-8",autoFocus:!0,onKeyDown:p=>{p.key==="Enter"&&o(),p.key==="Escape"&&d()}}),e.jsx(D,{size:"sm",variant:"ghost",onClick:o,className:"h-8 w-8 p-0",children:e.jsx(aa,{className:"w-4 h-4 text-green-600"})}),e.jsx(D,{size:"sm",variant:"ghost",onClick:d,className:"h-8 w-8 p-0",children:e.jsx(ws,{className:"w-4 h-4 text-gray-500"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium text-sm",children:a}),e.jsxs("p",{className:"text-xs text-gray-500",children:[s.options?.length||0," opções"]})]})}),!l&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{size:"sm",variant:"outline",onClick:()=>c(!0),title:"Editar nome",children:e.jsx(yn,{className:"w-4 h-4"})}),e.jsxs(D,{size:"sm",variant:"outline",onClick:t,children:[e.jsx(Ks,{className:"w-4 h-4 mr-1"}),"Usar"]}),e.jsx(D,{size:"sm",variant:"ghost",onClick:r,className:"text-red-500",children:e.jsx(Ke,{className:"w-4 h-4"})})]})]})}function Gf({isOpen:s,onClose:a,onUseTemplate:t}){const[r,n]=w.useState(""),[l,c]=w.useState([]),m=es(),{menuContext:i}=Ze(),{data:o=[]}=Ae({queryKey:["complementGroups",i?.type,i?.value],queryFn:async()=>{if(!i)return[];const j={};return i.type==="subscriber"&&i.value&&(j.as_subscriber=i.value),ae.entities.ComplementGroup.list("order",j)},enabled:!!i,refetchOnMount:"always"}),d=o.filter(j=>j.is_template===!0||j.name.includes("[TEMPLATE]")),p=o.filter(j=>!j.is_template&&!j.name.includes("[TEMPLATE]")),x=le({mutationFn:async j=>{const k=o.filter(z=>j.includes(z.id)).map(z=>ae.entities.ComplementGroup.create({...z,name:z.name,is_template:!0,id:void 0,created_date:void 0,updated_date:void 0}));return Promise.all(k)},onSuccess:()=>{m.invalidateQueries({queryKey:["complementGroups"]}),W.success("Template salvo com sucesso!"),c([])}}),f=le({mutationFn:j=>ae.entities.ComplementGroup.delete(j),onSuccess:()=>{m.invalidateQueries({queryKey:["complementGroups"]}),W.success("Template excluído")}}),v=le({mutationFn:async j=>{const M=o.find(z=>z.id===j);return M?await ae.entities.ComplementGroup.create({...M,name:M.name.replace("[TEMPLATE]","").trim(),is_template:!1,id:void 0,created_date:void 0,updated_date:void 0}):void 0},onSuccess:j=>{m.invalidateQueries({queryKey:["complementGroups"]}),W.success("Template aplicado!"),t(j),a()}}),y=le({mutationFn:async({id:j,name:M})=>{const k=o.find(z=>z.id===j);if(k)return ae.entities.ComplementGroup.update(j,{...k,name:M.trim()})},onSuccess:()=>{m.invalidateQueries({queryKey:["complementGroups"]}),W.success("Nome do template atualizado!")}});return e.jsx(ze,{open:s,onOpenChange:a,children:e.jsxs(Te,{className:"sm:max-w-2xl max-w-[95vw] max-h-[80vh] overflow-y-auto",children:[e.jsx(Fe,{children:e.jsxs(Re,{className:"flex items-center gap-2",children:[e.jsx(ji,{className:"w-5 h-5 text-orange-500"}),"Templates de Complementos"]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Templates Salvos"}),d.length===0?e.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:[e.jsx(ji,{className:"w-8 h-8 text-gray-300 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Nenhum template salvo ainda"})]}):e.jsx("div",{className:"space-y-2",children:d.map(j=>{const M=j.name.replace("[TEMPLATE]","").trim();return e.jsx(Yf,{template:j,displayName:M,onUse:()=>v.mutate(j.id),onDelete:()=>{confirm("Excluir este template?")&&f.mutate(j.id)},onEdit:k=>{y.mutate({id:j.id,name:k})}},j.id)})})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Criar Novo Template"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Selecione grupos de complementos existentes para salvar como template:"}),e.jsx("div",{className:"space-y-2 mb-4 max-h-48 overflow-y-auto",children:p.map(j=>e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.includes(j.id),onChange:M=>{M.target.checked?c(k=>[...k,j.id]):c(k=>k.filter(z=>z!==j.id))},className:"w-4 h-4"}),e.jsx("span",{className:"text-sm flex-1",children:j.name}),e.jsxs(fe,{variant:"outline",className:"text-xs",children:[j.options?.length||0," opções"]})]},j.id))}),e.jsxs(D,{onClick:()=>x.mutate(l),disabled:l.length===0||x.isPending,className:"w-full bg-orange-500 hover:bg-orange-600",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Salvar como Template (",l.length," selecionados)"]})]})]})]})})}function Vf({isOpen:s,onClose:a,group:t,onUpdate:r}){const[n,l]=w.useState([]),[c,m]=w.useState({type:"add",value:0}),i=()=>{n.length===t.options.length?l([]):l(t.options.map(p=>p.id))},o=()=>{const p=t.options.map(x=>{if(n.includes(x.id)){let f=x.price||0;return c.type==="add"?f+=parseFloat(c.value)||0:c.type==="multiply"?f*=parseFloat(c.value)||1:c.type==="set"&&(f=parseFloat(c.value)||0),{...x,price:Math.max(0,f)}}return x});r({...t,options:p}),W.success(`${n.length} opções atualizadas`),a()},d=p=>{const x=t.options.map(f=>n.includes(f.id)?{...f,is_active:p}:f);r({...t,options:x}),W.success(`${n.length} opções ${p?"ativadas":"desativadas"}`),a()};return e.jsx(ze,{open:s,onOpenChange:a,children:e.jsxs(Te,{className:"sm:max-w-2xl max-w-[95vw] max-h-[80vh] overflow-y-auto",children:[e.jsx(Fe,{children:e.jsxs(Re,{className:"flex items-center gap-2",children:[e.jsx($t,{className:"w-5 h-5 text-orange-500"}),"Edição em Massa - ",t?.name]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(R,{children:"Selecione as opções para editar:"}),e.jsx(D,{size:"sm",variant:"outline",onClick:i,children:n.length===t?.options?.length?"Desmarcar Todas":"Selecionar Todas"})]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto bg-gray-50 rounded-lg p-3",children:t?.options?.map(p=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-white rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.includes(p.id),onChange:x=>{x.target.checked?l(f=>[...f,p.id]):l(f=>f.filter(v=>v!==p.id))},className:"w-4 h-4"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm font-medium",children:p.name}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["R$ ",(p.price||0).toFixed(2)]})]}),e.jsx(fe,{variant:p.is_active!==!1?"default":"outline",className:"text-xs",children:p.is_active!==!1?"Ativo":"Inativo"})]},p.id))}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:[n.length," de ",t?.options?.length||0," opções selecionadas"]})]}),n.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-t pt-4",children:[e.jsx(R,{className:"mb-3 block",children:"Ajustar Preços"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("div",{children:e.jsxs("select",{value:c.type,onChange:p=>m(x=>({...x,type:p.target.value})),className:"w-full border rounded-lg px-3 py-2 text-sm",children:[e.jsx("option",{value:"add",children:"Adicionar"}),e.jsx("option",{value:"multiply",children:"Multiplicar por"}),e.jsx("option",{value:"set",children:"Definir como"})]})}),e.jsx("div",{children:e.jsx(U,{type:"number",step:"0.01",value:c.value,onChange:p=>m(x=>({...x,value:p.target.value})),placeholder:c.type==="multiply"?"1.10 (aumentar 10%)":"5.00"})})]}),e.jsxs(D,{onClick:o,className:"w-full mt-3 bg-blue-500 hover:bg-blue-600",children:[e.jsx($a,{className:"w-4 h-4 mr-2"}),"Aplicar Ajuste de Preço"]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx(R,{className:"mb-3 block",children:"Alterar Status"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(D,{onClick:()=>d(!0),variant:"outline",className:"border-green-500 text-green-600 hover:bg-green-50",children:[e.jsx(aa,{className:"w-4 h-4 mr-2"}),"Ativar Selecionadas"]}),e.jsxs(D,{onClick:()=>d(!1),variant:"outline",className:"border-red-500 text-red-600 hover:bg-red-50",children:[e.jsx(ws,{className:"w-4 h-4 mr-2"}),"Desativar Selecionadas"]})]})]})]})]})]})})}function Uf({isOpen:s,onClose:a,onSelectType:t,categoryId:r,categoryDishes:n=[],onRedirectToPizzas:l,hasPizzaService:c=!1,subscriberName:m="",onRequestPizzaService:i}){n.some(j=>!j.product_type||j.product_type==="preparado");const[o,d]=w.useState(!1),[p,x]=w.useState(!1),f=[{type:"preparado",icon:sa,title:"Preparado",description:"Produtos produzidos pela sua loja, como marmitas, bolos, lanches e etc.",available:!0},{type:"industrializado",icon:ys,title:"Industrializado",description:"Produtos prontos que sua loja não produz, como chocolates, chicletes, refrigerantes e etc.",available:!0},{type:"pizza",icon:Fo,title:"Pizza",description:c?'As pizzas são gerenciadas na aba "Pizzas". Clique aqui para ir até lá.':"O serviço de Pizza não faz parte do seu plano. Clique para solicitar.",available:!0}],v=(j,M)=>{if(M){if(j==="pizza"){if(!c){d(!0);return}a(),l&&l();return}t(j),a()}},y=async()=>{x(!0);try{i?await i():await ae.entities.ServiceRequest.create({type:"add_pizza_service",subscriber_name:m||"Assinante",status:"pending",requested_at:new Date().toISOString()}),W.success("Solicitação enviada! Entraremos em contato em breve."),d(!1),a()}catch{W.error("Erro ao enviar solicitação. Tente novamente.")}finally{x(!1)}};return e.jsx(ze,{open:s,onOpenChange:a,children:e.jsxs(Te,{className:"sm:max-w-2xl max-w-[95vw]",children:[e.jsx(Fe,{children:e.jsx(Re,{children:"Escolha um tipo de produto"})}),e.jsx("div",{className:"space-y-3",children:f.map(j=>{const M=j.icon,k=!j.available;return e.jsxs(We.button,{whileHover:k?{}:{scale:1.02},whileTap:k?{}:{scale:.98},onClick:()=>v(j.type,j.available),disabled:k,className:`w-full flex items-start gap-4 p-4 rounded-xl border-2 text-left transition-all ${k?"bg-gray-100 border-gray-200 cursor-not-allowed opacity-60":"bg-white border-gray-200 hover:border-orange-500 hover:shadow-md cursor-pointer"}`,children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${k?"bg-gray-200":"bg-orange-50"}`,children:e.jsx(M,{className:`w-6 h-6 ${k?"text-gray-400":"text-orange-600"}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`font-semibold text-base mb-1 ${k?"text-gray-500":"text-gray-900"}`,children:j.title}),e.jsx("p",{className:`text-sm ${k?"text-gray-400":"text-gray-600"}`,children:j.description})]}),!k&&e.jsx("div",{className:"flex items-center justify-center w-6 h-6 rounded-full border-2 border-orange-500",children:e.jsx("div",{className:"w-3 h-3 rounded-full bg-orange-500"})})]},j.type)})}),e.jsx("div",{className:"flex justify-end gap-3 pt-4 border-t",children:e.jsx("button",{onClick:a,className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:"Cancelar"})}),o&&e.jsxs("div",{className:"mt-4 p-4 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-amber-800 font-medium mb-2",children:"O serviço de Pizza não faz parte do seu plano atual."}),e.jsx("p",{className:"text-sm text-amber-700 mb-4",children:"Deseja solicitar a inclusão deste serviço? Enviaremos sua solicitação para análise."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>d(!1),className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:y,disabled:p,className:"px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 disabled:opacity-50",children:p?"Enviando...":"Sim, solicitar serviço"})]})]})]})})}function Bf(){const[s,a]=se.useState(null),[t,r]=w.useState(!1),[n,l]=w.useState(""),[c,m]=w.useState(""),i=es(),{menuContext:o}=Ze();se.useEffect(()=>{(async()=>{try{const g=await ae.auth.me();a(g)}catch(g){console.error("Error loading user:",g)}})()},[]);const{data:d=[]}=Zc({refetchOnMount:"always"}),{data:p=[]}=Ht(),x=(Array.isArray(p)?p:[]).filter(u=>u.product_type!=="pizza"),f=w.useMemo(()=>{const u=Array.isArray(d)?d:[];return c?u.filter(g=>g.name?.toLowerCase().includes(c.toLowerCase())):u},[d,c]),v=w.useMemo(()=>{const u=Array.isArray(d)?d:[],g=Array.isArray(x)?x:[],T=u.length,h=g.length,b=u.map(P=>({category:P,count:g.filter(F=>F.category_id===P.id).length})),L=b.filter(P=>P.count>0).length,O=T-L;return{totalCategories:T,totalDishes:h,categoriesWithDishes:L,emptyCategories:O,dishesByCategory:b}},[d,x]),y=le({mutationFn:async u=>{const g={...u,owner_email:s?.subscriber_email||s?.email};return o?.type==="subscriber"&&o?.value&&(g.as_subscriber=o.value),ae.entities.Category.create(g)},onSuccess:()=>{i.invalidateQueries({queryKey:["categories"]}),i.invalidateQueries({queryKey:["dishes"]}),r(!1),l(""),W.success("✅ Categoria criada!")},onError:u=>{W.error(u?.message||"Erro ao criar categoria")}}),j=()=>o?.type==="subscriber"&&o?.value?{as_subscriber:o.value}:{},M=le({mutationFn:({id:u,data:g})=>ae.entities.Category.update(u,g,j()),onSuccess:()=>i.invalidateQueries({queryKey:["categories"]})}),k=le({mutationFn:u=>ae.entities.Category.delete(u,j()),onSuccess:()=>i.invalidateQueries({queryKey:["categories"]})}),z=u=>{u.preventDefault(),n.trim()&&y.mutate({name:n.trim(),order:d.length})},$=(u,g)=>{const T=u+g;if(T<0||T>=d.length)return;const h=d[u],b=d[T];M.mutate({id:h.id,data:{...h,order:T}}),M.mutate({id:b.id,data:{...b,order:u}})};return e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(B,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total de Categorias"}),e.jsx("p",{className:"text-2xl font-bold",children:v.totalCategories})]}),e.jsx(Fa,{className:"w-8 h-8 text-orange-500"})]})})}),e.jsx(B,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Com Pratos"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:v.categoriesWithDishes})]}),e.jsx(ys,{className:"w-8 h-8 text-green-500"})]})})}),e.jsx(B,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Vazias"}),e.jsx("p",{className:"text-2xl font-bold text-gray-400",children:v.emptyCategories})]}),e.jsx(sn,{className:"w-8 h-8 text-gray-400"})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(_s,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(U,{placeholder:"Buscar categoria...",value:c,onChange:u=>m(u.target.value),className:"pl-10"})]}),e.jsxs(D,{onClick:()=>r(!0),className:"bg-orange-500 hover:bg-orange-600",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Adicionar Categoria"]})]}),e.jsx("div",{className:"max-w-xl mx-auto space-y-3",children:f.length===0?e.jsx(gn,{icon:sn,title:c?"Nenhuma categoria encontrada":"Organize melhor seu cardápio criando categorias",description:c?"Tente buscar com outro termo":"Categorias ajudam seus clientes a encontrar pratos mais facilmente",actionLabel:c?void 0:"Criar categoria",onAction:c?void 0:()=>r(!0)}):f.map((u,g)=>{const T=x.filter(h=>h.category_id===u.id).length;return e.jsxs("div",{className:"bg-white rounded-xl p-3 sm:p-4 shadow-sm flex items-center gap-2 sm:gap-4",children:[e.jsx(Fa,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("input",{type:"text",value:u.name||"",onChange:h=>M.mutate({id:u.id,data:{...u,name:h.target.value}}),className:"w-full font-medium bg-transparent border-b border-transparent hover:border-gray-300 focus:border-orange-500 focus:outline-none",placeholder:"Nome da categoria"}),e.jsxs(fe,{variant:"outline",className:"mt-1 text-xs",children:[T," ",T===1?"prato":"pratos"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>$(g,-1),disabled:g===0,className:"p-1 hover:bg-gray-100 rounded disabled:opacity-30",children:e.jsx(zt,{className:"w-4 h-4 text-gray-400"})}),e.jsx("button",{onClick:()=>$(g,1),disabled:g===d.length-1,className:"p-1 hover:bg-gray-100 rounded disabled:opacity-30",children:e.jsx(Ra,{className:"w-4 h-4 text-gray-400"})})]}),e.jsx(D,{size:"icon",variant:"ghost",className:"text-red-500 hover:text-red-700 hover:bg-red-50",onClick:()=>{T>0&&!confirm(`Esta categoria tem ${T} prato(s). Deseja realmente excluir?`)||(k.mutate(u.id),W.success("Categoria excluída"))},children:e.jsx(Ke,{className:"w-4 h-4"})})]},u.id)})}),e.jsx(ze,{open:t,onOpenChange:r,children:e.jsxs(Te,{className:"sm:max-w-sm max-w-[95vw]",children:[e.jsxs(Fe,{children:[e.jsx(Re,{children:"Adicionar Categoria"}),e.jsx(Zr,{className:"sr-only",children:"Formulário para criar uma nova categoria de produtos."})]}),e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome da Categoria"}),e.jsx(U,{value:n,onChange:u=>l(u.target.value),placeholder:"Ex: Tradicionais",required:!0})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(D,{type:"button",variant:"outline",onClick:()=>r(!1),className:"flex-1",children:"Cancelar"}),e.jsx(D,{type:"submit",className:"flex-1 bg-orange-500 hover:bg-orange-600",children:"Adicionar"})]})]})]})})]})}function Wf({option:s,group:a,optionIndex:t,provided:r,snapshot:n,onUpdate:l,onToggle:c,onRemove:m,canEdit:i}){const[o,d]=w.useState(s.name||""),[p,x]=w.useState(s.price?.toString()||"0"),f=()=>{o!==s.name&&l(a,s.id,"name",o)},v=()=>{const y=parseFloat(p)||0;y!==s.price&&l(a,s.id,"price",y)};return e.jsxs("div",{ref:r.innerRef,...r.draggableProps,...r.dragHandleProps,className:He("flex flex-wrap items-center gap-2 p-2 rounded-lg border transition-all",n.isDragging?"shadow-lg":"",s.is_active?"bg-white border-gray-200":"bg-gray-50 border-gray-100 opacity-60"),children:[e.jsx(cr,{className:"w-4 h-4 text-gray-400 flex-shrink-0 cursor-grab active:cursor-grabbing"}),e.jsx(U,{value:o,onChange:y=>d(y.target.value),onBlur:f,className:"flex-1 min-w-[120px] h-8 border-0 bg-transparent hover:bg-gray-50 focus:bg-white",placeholder:"Nome da opção"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xs text-gray-400",children:"R$"}),e.jsx(U,{type:"number",step:"0.01",value:p,onChange:y=>x(y.target.value),onBlur:v,className:"w-16 h-8 text-center"})]}),e.jsx(D,{size:"sm",variant:s.is_active?"default":"outline",className:He("h-7 text-xs",s.is_active?"bg-green-500 hover:bg-green-600":""),onClick:()=>c(a,s.id),disabled:!i,children:s.is_active?"ON":"OFF"}),e.jsx("button",{onClick:()=>m(a,s.id),className:"p-1 text-red-400 hover:text-red-600",disabled:!i,children:e.jsx(ws,{className:"w-4 h-4"})})]})}function Hf({group:s,groupIndex:a,provided:t,snapshot:r,updateMutation:n,deleteMutation:l,onAddOption:c,onToggleOption:m,onRemoveOption:i,onUpdateOption:o,onDragEndOptions:d,canEdit:p}){const[x,f]=w.useState(s.name||""),[v,y]=w.useState(s.max_selection?.toString()||"1"),j=()=>{x!==s.name&&n.mutate({id:s.id,data:{name:x}})},M=()=>{const k=parseInt(v)||1;k!==s.max_selection&&n.mutate({id:s.id,data:{max_selection:k}})};return e.jsxs("div",{ref:t.innerRef,...t.draggableProps,className:He("bg-white rounded-xl p-4 sm:p-5 shadow-sm border transition-all",r.isDragging?"shadow-2xl":""),children:[e.jsxs("div",{className:"flex items-start justify-between mb-4 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("div",{...t.dragHandleProps,className:"cursor-grab active:cursor-grabbing",children:e.jsx(cr,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("input",{type:"text",value:x,onChange:k=>f(k.target.value),onBlur:j,className:"font-bold text-lg bg-transparent border-b border-transparent hover:border-gray-300 focus:border-orange-500 focus:outline-none w-full",placeholder:"Nome do grupo"}),e.jsxs(fe,{variant:"outline",className:"text-xs mt-1",children:[(s.options||[]).length," itens"]})]})]}),e.jsx(D,{size:"icon",variant:"ghost",className:"text-red-500 hover:text-red-700 flex-shrink-0",onClick:()=>{const k=dishes.filter(z=>z.complement_groups?.some($=>$.group_id===s.id));if(k.length>0){if(!confirm(`Este grupo está sendo usado em ${k.length} prato(s). Deseja realmente excluir?`))return}else if(!confirm("Excluir este grupo?"))return;l.mutate(s.id),W.success("Grupo excluído")},children:e.jsx(Ke,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-4 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx(ot,{checked:s.is_required,onCheckedChange:k=>n.mutate({id:s.id,data:{is_required:k}})}),e.jsx("span",{children:"Obrigatório?"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-500",children:"Máx:"}),e.jsx(U,{type:"number",min:"1",value:v,onChange:k=>y(k.target.value),onBlur:M,className:"w-16 h-8 text-center"})]})]}),e.jsx(dr,{onDragEnd:k=>d(k,s),children:e.jsx(mr,{droppableId:`options-${s.id}`,children:k=>e.jsxs("div",{...k.droppableProps,ref:k.innerRef,className:"space-y-2",children:[(s.options||[]).map((z,$)=>e.jsx(ur,{draggableId:z.id,index:$,children:(u,g)=>e.jsx(Wf,{option:z,group:s,optionIndex:$,provided:u,snapshot:g,onUpdate:o,onToggle:m,onRemove:i,canEdit:p})},z.id)),k.placeholder]})})}),e.jsx("button",{onClick:()=>c(s),className:"w-full mt-3 py-2 border-2 border-dashed border-orange-300 rounded-lg text-orange-500 hover:bg-orange-50 text-sm font-medium",children:"+ Adicionar Opção"})]})}function Kf(){const[s,a]=se.useState(null),[t,r]=w.useState(!1),[n,l]=w.useState(""),[c,m]=w.useState("all"),[i,o]=w.useState({name:"",is_required:!0,max_selection:1}),d=es();se.useEffect(()=>{(async()=>{try{const P=await ae.auth.me();a(P)}catch(P){console.error("Error loading user:",P)}})()},[]);const{menuContext:p}=Ze(),{data:x=[]}=Ae({queryKey:["complementGroups",p?.type,p?.value],queryFn:async()=>{if(!p)return[];try{const O={};p.type==="subscriber"&&p.value&&(O.as_subscriber=p.value);const P=await ae.entities.ComplementGroup.list("order",O);return Array.isArray(P)?P:[]}catch(O){return console.error("Erro ao buscar grupos:",O),[]}},enabled:!!p,initialData:[],refetchOnMount:"always"}),{data:f=[]}=Ht(),v=w.useMemo(()=>Array.isArray(x)?x.filter(P=>{const F=!n||P.name?.toLowerCase().includes(n.toLowerCase())||(P.options||[]).some(N=>N.name?.toLowerCase().includes(n.toLowerCase())),C=c==="all"||c==="required"&&P.is_required||c==="optional"&&!P.is_required;return F&&C}):[],[x,n,c]),y=w.useMemo(()=>{const O=Array.isArray(x)?x:[],P=Array.isArray(f)?f:[],F=O.length,C=O.reduce((E,ee)=>E+(ee.options?.length||0),0),N=O.reduce((E,ee)=>E+(ee.options?.filter(ue=>ue.is_active!==!1).length||0),0),V=O.filter(E=>P.some(ee=>ee.complement_groups?.some(ue=>ue.group_id===E.id))).length;return{totalGroups:F,totalOptions:C,activeOptions:N,groupsInUse:V}},[x,f]),j=le({mutationFn:async O=>{const P={...O,owner_email:s?.subscriber_email||s?.email};return ae.entities.ComplementGroup.create(P)},onSuccess:()=>{d.invalidateQueries({queryKey:["complementGroups"]}),r(!1),o({name:"",is_required:!0,max_selection:1}),W.success("✅ Grupo criado!")}}),M=le({mutationFn:({id:O,data:P})=>ae.entities.ComplementGroup.update(O,P),onSuccess:()=>{d.invalidateQueries({queryKey:["complementGroups"]}),W.success("✅ Salvo!")}}),k=le({mutationFn:O=>ae.entities.ComplementGroup.delete(O),onSuccess:()=>d.invalidateQueries({queryKey:["complementGroups"]})}),z=O=>{O.preventDefault(),j.mutate({...i,options:[],order:x.length})},$=async O=>{if(!L||!O.destination||O.source.index===O.destination.index)return;const P=Array.from(x),[F]=P.splice(O.source.index,1);P.splice(O.destination.index,0,F),d.setQueryData(["complementGroups"],P.map((N,V)=>({...N,order:V})));const C=P.map((N,V)=>ae.entities.ComplementGroup.update(N.id,{order:V}));try{await Promise.all(C),d.invalidateQueries({queryKey:["complementGroups"]}),W.success("✅ Ordem atualizada!")}catch(N){console.error("Erro ao reordenar grupos:",N),d.invalidateQueries({queryKey:["complementGroups"]})}},u=(O,P)=>{if(!O.destination)return;const F=Array.from(P.options||[]),[C]=F.splice(O.source.index,1);F.splice(O.destination.index,0,C),M.mutate({id:P.id,data:{options:F}})},g=O=>{const P=prompt("Nome da opção:");if(!P)return;const F=parseFloat(prompt("Preço (0 para grátis):","0"))||0,C={id:Date.now().toString(),name:P,price:F,is_active:!0};M.mutate({id:O.id,data:{options:[...O.options||[],C]}})},T=(O,P)=>{const F=(O.options||[]).map(C=>C.id===P?{...C,is_active:!C.is_active}:C);M.mutate({id:O.id,data:{options:F}})},h=(O,P)=>{if(!confirm("Remover esta opção?"))return;const F=(O.options||[]).filter(C=>C.id!==P);M.mutate({id:O.id,data:{options:F}})},b=(O,P,F,C)=>{const N=(O.options||[]).map(V=>V.id===P?{...V,[F]:C}:V);M.mutate({id:O.id,data:{options:N}})},L=s?.is_master||s?.can_edit;return e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(B,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Grupos"}),e.jsx("p",{className:"text-2xl font-bold",children:y.totalGroups})]}),e.jsx(ys,{className:"w-8 h-8 text-gray-500"})]})})}),e.jsx(B,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Opções"}),e.jsx("p",{className:"text-2xl font-bold",children:y.totalOptions})]}),e.jsx(ys,{className:"w-8 h-8 text-blue-500"})]})})}),e.jsx(B,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Ativas"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:y.activeOptions})]}),e.jsx(ys,{className:"w-8 h-8 text-green-500"})]})})}),e.jsx(B,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Em Uso"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:y.groupsInUse})]}),e.jsx(ys,{className:"w-8 h-8 text-orange-500"})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(_s,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(U,{placeholder:"Buscar grupo ou opção...",value:n,onChange:O=>l(O.target.value),className:"pl-10"})]}),e.jsxs(Ce,{value:c,onValueChange:m,children:[e.jsxs(ke,{className:"w-[180px]",children:[e.jsx(oa,{className:"w-4 h-4 mr-2"}),e.jsx(Se,{})]}),e.jsxs(De,{children:[e.jsx(Q,{value:"all",children:"Todos"}),e.jsx(Q,{value:"required",children:"Obrigatórios"}),e.jsx(Q,{value:"optional",children:"Opcionais"})]})]}),e.jsxs(D,{onClick:()=>r(!0),className:"bg-gray-800 hover:bg-gray-900",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Criar Novo Grupo"]})]}),e.jsx(dr,{onDragEnd:$,children:e.jsx(mr,{droppableId:"groups",children:O=>e.jsxs("div",{...O.droppableProps,ref:O.innerRef,className:"grid gap-6",children:[v.length===0?e.jsx("div",{className:"text-center py-12 text-gray-400 border-2 border-dashed rounded-xl",children:n||c!=="all"?"Nenhum grupo encontrado com os filtros aplicados":"Nenhum grupo de complementos cadastrado ainda."}):v.map((P,F)=>{const C=x.findIndex(N=>N.id===P.id);return e.jsx(ur,{draggableId:P.id,index:F,children:(N,V)=>e.jsx(Hf,{group:P,groupIndex:C,provided:N,snapshot:V,updateMutation:M,deleteMutation:k,onAddOption:g,onToggleOption:T,onRemoveOption:h,onUpdateOption:b,onDragEndOptions:u,canEdit:L})},P.id)}),O.placeholder]})})}),e.jsx(ze,{open:t,onOpenChange:r,children:e.jsxs(Te,{className:"sm:max-w-sm max-w-[95vw]",children:[e.jsx(Fe,{children:e.jsx(Re,{children:"Criar Novo Grupo"})}),e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome do Grupo"}),e.jsx(U,{value:i.name,onChange:O=>o(P=>({...P,name:O.target.value})),placeholder:"Ex: Arroz, Feijão, Guarnições...",required:!0})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx(ot,{checked:i.is_required,onCheckedChange:O=>o(P=>({...P,is_required:O}))}),e.jsx("span",{children:"Obrigatório"})]})}),e.jsxs("div",{children:[e.jsx(R,{children:"Máximo de seleções"}),e.jsx(U,{type:"number",min:"1",value:i.max_selection,onChange:O=>o(P=>({...P,max_selection:parseInt(O.target.value)||1}))})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(D,{type:"button",variant:"outline",onClick:()=>r(!1),className:"flex-1",children:"Cancelar"}),e.jsx(D,{type:"submit",className:"flex-1 bg-gray-800 hover:bg-gray-900",children:"Criar Grupo"})]})]})]})})]})}function oo({dish:s,onEdit:a,onDuplicate:t,onDelete:r,onToggleActive:n,onToggleHighlight:l,onToggleComplements:c,complementGroupsCount:m=0,formatCurrency:i,canEdit:o=!0}){const d=s.stock!==null&&s.stock!==void 0&&s.stock<=0,p=s.original_price&&s.original_price>s.price;return e.jsx("div",{className:"bg-white rounded-2xl overflow-hidden shadow-sm border border-gray-100 active:scale-[0.98] transition-transform",children:e.jsxs("div",{className:"flex items-center gap-3 p-3",children:[e.jsxs("div",{className:"relative w-20 h-20 flex-shrink-0 rounded-xl overflow-hidden bg-gray-100",children:[s.image?e.jsx("img",{src:s.image,alt:s.name,className:"w-full h-full object-cover",loading:"lazy"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-300 text-2xl",children:"🍽️"}),d&&e.jsx("div",{className:"absolute inset-0 bg-red-500/90 flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"Esgotado"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-sm leading-tight line-clamp-1 flex-1",children:s.name}),e.jsx("button",{onClick:x=>{x.stopPropagation(),o&&l(!s.is_highlight)},disabled:!o,className:`p-1.5 rounded-lg transition-colors flex-shrink-0 disabled:opacity-50 ${s.is_highlight?"bg-amber-100 text-amber-600":"bg-gray-100 text-gray-400 hover:bg-gray-200"}`,children:e.jsx(Es,{className:`w-4 h-4 ${s.is_highlight?"fill-amber-600":""}`})})]}),s.description&&e.jsx("p",{className:"text-xs text-gray-500 line-clamp-1 mb-2",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[p&&e.jsx("span",{className:"text-xs text-gray-400 line-through block",children:i(s.original_price)}),e.jsx("span",{className:`font-bold text-base ${p?"text-green-600":"text-gray-900"}`,children:i(s.price)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{checked:s.is_active!==!1,onCheckedChange:x=>{o&&n(x)},disabled:!o,className:"data-[state=checked]:bg-green-500"}),e.jsxs(mt,{children:[e.jsx(ut,{asChild:!0,children:e.jsx("button",{className:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-100 active:bg-gray-200 transition-colors",children:e.jsx(jr,{className:"w-4 h-4 text-gray-600"})})}),e.jsxs(ht,{align:"end",className:"w-48",children:[e.jsxs(ms,{onClick:a,children:[e.jsx(Rs,{className:"w-4 h-4 mr-2"}),"Editar"]}),e.jsxs(ms,{onClick:t,children:[e.jsx(Ks,{className:"w-4 h-4 mr-2"}),"Duplicar"]}),e.jsxs(ms,{onClick:r,className:"text-red-600",children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),"Excluir"]})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1.5",children:[(s.portion||s.prep_time)&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[s.portion&&e.jsx("span",{children:s.portion}),s.prep_time&&e.jsxs("span",{children:["⏱️ ",s.prep_time,"min"]})]}),c&&e.jsxs("button",{onClick:c,className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg bg-gray-100 hover:bg-gray-200 active:bg-gray-300 transition-colors ml-auto",children:[e.jsx(ys,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:m})]})]})]})]})})}function co({category:s,dishCount:a,isExpanded:t,onToggle:r,onAddDish:n,onEdit:l,onDuplicate:c,onDelete:m,children:i}){return e.jsxs("div",{className:"bg-white rounded-2xl overflow-hidden shadow-sm border border-gray-100",children:[e.jsxs("button",{onClick:r,className:"w-full flex items-center justify-between p-4 active:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-orange-100 to-orange-50 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-lg",children:"📁"})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("h3",{className:"font-bold text-base text-gray-900 truncate",children:s.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[a," ",a===1?"item":"itens"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs(mt,{children:[e.jsx(ut,{asChild:!0,onClick:o=>o.stopPropagation(),children:e.jsx("button",{className:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-100 active:bg-gray-200 transition-colors",children:e.jsx(jr,{className:"w-4 h-4 text-gray-600"})})}),e.jsxs(ht,{align:"end",className:"w-48",children:[e.jsxs(ms,{onClick:n,children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Adicionar prato"]}),e.jsxs(ms,{onClick:l,children:[e.jsx(Rs,{className:"w-4 h-4 mr-2"}),"Editar categoria"]}),e.jsxs(ms,{onClick:c,children:[e.jsx(Ks,{className:"w-4 h-4 mr-2"}),"Duplicar categoria"]}),e.jsxs(ms,{onClick:m,className:"text-red-600",children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),"Excluir categoria"]})]})]}),e.jsx(We.div,{animate:{rotate:t?180:0},transition:{duration:.2},children:e.jsx(Ra,{className:"w-5 h-5 text-gray-400"})})]})]}),e.jsx(dt,{children:t&&e.jsx(We.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:e.jsx("div",{className:"p-3 pt-0 space-y-2",children:i})})})]})}function Qf({onAddDish:s,onAddCategory:a,onAddCombo:t}){const[r,n]=w.useState(!1),l=[{icon:sa,label:"Novo Prato",onClick:()=>{s?.(),n(!1)},color:"bg-orange-500"},{icon:sn,label:"Nova Categoria",onClick:()=>{a?.(),n(!1)},color:"bg-blue-500"},...t?[{icon:tr,label:"Novo Combo",onClick:()=>{t(),n(!1)},color:"bg-purple-500"}]:[]];return e.jsxs(e.Fragment,{children:[e.jsx(dt,{children:r&&e.jsx(We.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/40 z-40",onClick:()=>n(!1)})}),e.jsxs("div",{className:"fixed bottom-6 right-6 z-50",children:[e.jsx(dt,{children:r&&e.jsx(We.div,{className:"flex flex-col-reverse gap-3 mb-3",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},children:l.map((c,m)=>e.jsxs(We.button,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{delay:m*.05},onClick:c.onClick,className:`${c.color} text-white shadow-lg rounded-full flex items-center gap-3 pr-5 pl-4 py-3 active:scale-95 transition-transform`,children:[e.jsx(c.icon,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium text-sm whitespace-nowrap",children:c.label})]},c.label))})}),e.jsx(We.button,{whileTap:{scale:.9},onClick:()=>n(!r),className:`w-14 h-14 rounded-full shadow-lg flex items-center justify-center transition-all ${r?"bg-gray-800 rotate-45":"bg-gradient-to-br from-orange-500 to-orange-600"}`,children:e.jsx(Ie,{className:"w-6 h-6 text-white"})})]})]})}function Zf({filters:s,onRemoveFilter:a,onClearAll:t}){return s.length===0?null:e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto scrollbar-hide pb-2",children:[s.map((r,n)=>e.jsxs(We.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{delay:n*.05},className:"flex items-center gap-1.5 bg-orange-100 text-orange-700 px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap flex-shrink-0",children:[e.jsx("span",{children:r.label}),e.jsx("button",{onClick:()=>a(r.key),className:"w-4 h-4 flex items-center justify-center rounded-full hover:bg-orange-200 transition-colors",children:e.jsx(ws,{className:"w-3 h-3"})})]},r.key)),s.length>1&&e.jsx("button",{onClick:t,className:"text-xs text-gray-500 px-3 py-1.5 hover:text-gray-700 whitespace-nowrap flex-shrink-0",children:"Limpar tudo"})]})}function Jf({isOpen:s,onClose:a,title:t,children:r}){return e.jsx(dt,{children:s&&e.jsxs(e.Fragment,{children:[e.jsx(We.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50",onClick:a}),e.jsxs(We.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:30,stiffness:300},className:"fixed inset-x-0 bottom-0 z-50 bg-white rounded-t-3xl shadow-2xl max-h-[85vh] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"flex justify-center pt-3 pb-2",children:e.jsx("div",{className:"w-10 h-1 bg-gray-300 rounded-full"})}),e.jsxs("div",{className:"flex items-center justify-between px-6 py-3 border-b border-gray-100",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:t}),e.jsx("button",{onClick:a,className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 active:bg-gray-200 transition-colors",children:e.jsx(ws,{className:"w-5 h-5 text-gray-600"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:r})]})]})})}function Xf({isOpen:s,onClose:a,availableGroups:t,onConfirm:r,currentDish:n=null}){const[l,c]=w.useState(""),[m,i]=w.useState([]);n?.complement_groups?n.complement_groups.map(v=>v.group_id):[];const d=t.filter(v=>v.name?.toLowerCase().includes(l.toLowerCase())),p=v=>{i(y=>y.includes(v)?y.filter(j=>j!==v):[...y,v])},x=()=>{r(m),i([]),c(""),a()},f=()=>{i([]),c(""),a()};return s?e.jsx(dt,{children:e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx(We.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:f,className:"absolute inset-0 bg-black/50"}),e.jsxs(We.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"relative w-full max-w-md bg-white rounded-2xl shadow-xl overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Copiar grupo"}),e.jsx("button",{onClick:f,className:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(ws,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Selecione um ou mais grupos para reutilizar"})]}),e.jsx("div",{className:"px-6 py-4 border-b border-gray-100",children:e.jsxs("div",{className:"relative",children:[e.jsx(_s,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(U,{placeholder:"Buscar grupos de complementos",value:l,onChange:v=>c(v.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"px-6 py-4 max-h-96 overflow-y-auto",children:d.length===0?e.jsx("div",{className:"text-center py-8 text-gray-400",children:e.jsx("p",{className:"text-sm",children:"Nenhum grupo encontrado"})}):e.jsx("div",{className:"space-y-2",children:d.map(v=>{const y=m.includes(v.id),j=v.options?.length||0;return e.jsx("button",{onClick:()=>p(v.id),className:`w-full p-4 rounded-xl border-2 transition-all text-left ${y?"border-orange-500 bg-orange-50":"border-gray-200 bg-white hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center flex-shrink-0 mt-0.5 transition-colors ${y?"border-orange-500 bg-orange-500":"border-gray-300"}`,children:y&&e.jsx(aa,{className:"w-3 h-3 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm text-gray-900 mb-1",children:v.name}),e.jsx("p",{className:"text-xs text-gray-500",children:"Grupo disponível para uso"})]}),e.jsxs(fe,{variant:"outline",className:"text-xs flex-shrink-0",children:[j," ",j===1?"opção":"opções"]})]})},v.id)})})}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-100 bg-gray-50",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:m.length===0?"Nenhum grupo selecionado":`${m.length} ${m.length===1?"grupo selecionado":"grupos selecionados"}`}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(D,{variant:"outline",onClick:f,className:"flex-1",children:"Voltar"}),e.jsx(D,{onClick:x,disabled:m.length===0,className:"flex-1 bg-orange-500 hover:bg-orange-600 disabled:opacity-50",children:"Confirmar"})]})]})]})]})}):null}function e0({option:s,groupId:a,onToggle:t,onRemove:r,onUpdateName:n,onUpdatePrice:l,onUpdateImage:c,formatCurrency:m}){const[i,o]=w.useState(!1),[d,p]=w.useState(!1),[x,f]=w.useState(s.name),[v,y]=w.useState(s.price?.toString()||"0"),j=()=>{x.trim()&&n(a,s.id,x),o(!1)},M=()=>{l(a,s.id,v),p(!1)};return e.jsxs("div",{className:`flex items-center gap-3 p-2 rounded-xl ${s.is_active!==!1?"bg-white":"bg-red-50"}`,children:[e.jsxs("label",{className:"cursor-pointer relative",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg overflow-hidden bg-gray-100 flex-shrink-0",children:s.image?e.jsx("img",{src:s.image,alt:s.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-300 text-xs",children:"🍽️"})}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:k=>{const z=k.target.files?.[0];z&&c(a,s.id,z)}})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[i?e.jsx("input",{type:"text",value:x,onChange:k=>f(k.target.value),onBlur:j,onKeyDown:k=>{k.key==="Enter"&&j(),k.key==="Escape"&&o(!1)},className:"font-medium text-sm text-gray-900 w-full border rounded px-2 py-1",autoFocus:!0}):e.jsx("p",{className:"font-medium text-sm text-gray-900 truncate cursor-pointer hover:text-orange-600",onClick:()=>{f(s.name),o(!0)},children:s.name}),d?e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:v,onChange:k=>y(k.target.value),onBlur:M,onKeyDown:k=>{k.key==="Enter"&&M(),k.key==="Escape"&&p(!1)},className:"text-xs text-gray-500 w-20 border rounded px-1 py-0.5",autoFocus:!0})]}):e.jsx("p",{className:"text-xs text-gray-500 cursor-pointer hover:text-orange-600",onClick:()=>{y(s.price?.toString()||"0"),p(!0)},children:s.price>0?`+ ${m(s.price)}`:"Sem custo (clique para editar)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Le,{checked:s.is_active!==!1,onCheckedChange:()=>t(a,s.id,s.is_active!==!1),className:"data-[state=checked]:bg-green-500"}),e.jsx("button",{onClick:()=>{confirm("Remover este complemento?")&&r(a,s.id)},className:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-red-100 active:bg-red-200 transition-colors",children:e.jsx(Ke,{className:"w-4 h-4 text-red-600"})})]})]})}function s0({isOpen:s,onClose:a,dish:t,complementGroups:r,onAddOption:n,onToggleOption:l,onRemoveOption:c,onEditGroup:m,onRemoveGroup:i,onAddGroup:o,onReuseGroup:d,onToggleRequired:p,onUpdateOptionName:x,onUpdateOptionPrice:f,onUpdateOptionImage:v,onReorderGroups:y,onCopyGroups:j,formatCurrency:M}){const[k,z]=w.useState(!1),[$,u]=w.useState(!1),g=(t?.complement_groups||[]).map(h=>r.find(b=>b.id===h.group_id)).filter(Boolean);r.filter(h=>!t?.complement_groups?.some(b=>b.group_id===h.id));const T=h=>{if(!h.destination||h.source.index===h.destination.index)return;const b=Array.from(t.complement_groups||[]),[L]=b.splice(h.source.index,1);b.splice(h.destination.index,0,L),y(b)};return e.jsxs(dt,{children:[s&&e.jsxs(e.Fragment,{children:[e.jsx(We.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50",onClick:a}),e.jsxs(We.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:30,stiffness:300},className:"fixed inset-x-0 bottom-0 z-50 bg-white rounded-t-3xl shadow-2xl max-h-[85vh] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"flex justify-center pt-3 pb-2",children:e.jsx("div",{className:"w-10 h-1 bg-gray-300 rounded-full"})}),e.jsx("div",{className:"px-6 py-3 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Complementos"}),e.jsx("p",{className:"text-sm text-gray-500",children:t?.name})]}),e.jsx("button",{onClick:a,className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 active:bg-gray-200 transition-colors",children:e.jsx(ws,{className:"w-5 h-5 text-gray-600"})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[g.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Ie,{className:"w-8 h-8 text-gray-400"})}),e.jsx("p",{className:"text-gray-500 text-sm mb-4",children:"Nenhum grupo de complementos"}),e.jsxs(D,{onClick:()=>o(t?.id),className:"bg-orange-500",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Adicionar Grupo"]})]}):e.jsx(dr,{onDragEnd:T,children:e.jsx(mr,{droppableId:"mobile-complement-groups",children:h=>e.jsxs("div",{...h.droppableProps,ref:h.innerRef,className:"space-y-4",children:[g.map((b,L)=>{const O=t.complement_groups?.find(P=>P.group_id===b.id);return e.jsx(ur,{draggableId:b.id,index:L,children:(P,F)=>e.jsxs("div",{ref:P.innerRef,...P.draggableProps,className:`rounded-2xl p-4 border-2 transition-shadow ${F.isDragging?"shadow-lg":""} ${O?.is_required?"bg-red-50 border-red-200":"bg-blue-50 border-blue-200"}`,children:[e.jsxs("div",{className:"flex items-start gap-2 mb-3",children:[e.jsx("div",{...P.dragHandleProps,className:"pt-1",children:e.jsx(cr,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-bold text-sm text-gray-900",children:b.name}),e.jsx(fe,{className:`text-xs ${O?.is_required?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700"}`,children:O?.is_required?"Obrigatório":"Opcional"})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Máximo: ",b.max_selection||1," ",b.max_selection===1?"opção":"opções"]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>m(b),className:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-200 active:bg-gray-300 transition-colors",children:e.jsx(ct,{className:"w-4 h-4 text-gray-600"})}),e.jsx("button",{onClick:()=>i(b.id),className:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-red-100 active:bg-red-200 transition-colors",children:e.jsx(Ke,{className:"w-4 h-4 text-red-600"})})]})]}),e.jsx("div",{className:"space-y-2",children:(b.options||[]).map(C=>e.jsx(e0,{option:C,groupId:b.id,onToggle:l,onRemove:c,onUpdateName:x,onUpdatePrice:f,onUpdateImage:v,formatCurrency:M},C.id))}),e.jsxs(D,{onClick:()=>n(b.id),variant:"outline",size:"sm",className:"w-full mt-3",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Adicionar opção"]})]})},b.id)}),h.placeholder]})})}),g.length>0&&e.jsx("div",{className:"mt-4",children:e.jsxs(mt,{open:k,onOpenChange:z,children:[e.jsx(ut,{asChild:!0,children:e.jsxs(D,{variant:"outline",className:"w-full",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Adicionar Grupo de Complementos"]})}),e.jsxs(ht,{className:"w-full",align:"center",children:[e.jsxs(ms,{onClick:()=>{o(t?.id),z(!1)},children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Criar novo grupo"]}),r.length>0&&e.jsxs(ms,{onClick:()=>{u(!0),z(!1)},children:[e.jsx(Ks,{className:"w-4 h-4 mr-2"}),"Copiar grupo de complementos"]})]})]})})]})]})]}),e.jsx(Xf,{isOpen:$,onClose:()=>u(!1),availableGroups:r,onConfirm:j,currentDish:t})]})}function Rr({icon:s,title:a,description:t,actionLabel:r,onAction:n}){return e.jsxs(We.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-gray-100 to-gray-200 rounded-full flex items-center justify-center mb-6",children:e.jsx(s,{className:"w-12 h-12 text-gray-400"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2 text-center",children:a}),t&&e.jsx("p",{className:"text-gray-500 text-center mb-6 max-w-md",children:t}),r&&n&&e.jsx(D,{onClick:n,className:"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700",children:r})]})}function a0(){return e.jsxs("div",{className:"px-6 pb-6 space-y-4",children:[e.jsxs("div",{className:"flex gap-3 mb-6 animate-pulse",children:[e.jsx("div",{className:"w-32 h-10 bg-gray-200 rounded"}),e.jsx("div",{className:"w-32 h-10 bg-gray-200 rounded"}),e.jsx("div",{className:"w-32 h-10 bg-gray-200 rounded"})]}),e.jsx("div",{className:"bg-white rounded-xl p-4 mb-6 animate-pulse",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"h-10 bg-gray-200 rounded"}),e.jsx("div",{className:"h-10 bg-gray-200 rounded"}),e.jsx("div",{className:"h-10 bg-gray-200 rounded"}),e.jsx("div",{className:"h-10 bg-gray-200 rounded"})]})}),[1,2,3].map(s=>e.jsxs(We.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:s*.1},className:"bg-gray-50 rounded-xl overflow-hidden animate-pulse",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded"}),e.jsx("div",{className:"w-32 h-6 bg-gray-200 rounded"}),e.jsx("div",{className:"w-16 h-5 bg-gray-200 rounded-full"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-32 h-9 bg-gray-200 rounded"}),e.jsx("div",{className:"w-9 h-9 bg-gray-200 rounded"})]})]}),e.jsx("div",{className:"p-4 space-y-3",children:[1,2].map(a=>e.jsx("div",{className:"bg-white border rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"w-40 h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"w-full h-3 bg-gray-200 rounded"}),e.jsx("div",{className:"w-24 h-3 bg-gray-200 rounded"})]}),e.jsx("div",{className:"w-20 h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"w-10 h-6 bg-gray-200 rounded-full"})]})},a))})]},s))]})}function mo({dish:s,complementGroups:a,expanded:t,onToggleExpand:r,onEdit:n,onDelete:l,onDuplicate:c,onUpdate:m,onToggleOption:i,onUpdateOptionName:o,onUpdateOptionImage:d,onUpdateOptionPrice:p,onRemoveOption:x,onAddOption:f,onAddGroup:v,onReuseGroup:y,onRemoveGroup:j,onOpenReuseModal:M,allComplementGroups:k,allDishes:z,onEditGroup:$,getGroupUsageInfo:u,formatCurrency:g,updateDishMutation:T,updateComplementGroupMutation:h,createComplementGroupMutation:b,isSelected:L,onToggleSelection:O,canEdit:P,canCreate:F,canDelete:C,setBulkEditGroup:N,setShowBulkEditModal:V}){const[E,ee]=w.useState(null),[ue,Z]=w.useState(""),[S,G]=w.useState(null),[q,ne]=w.useState(""),[Me,Y]=w.useState(null),[A,X]=w.useState(!1),[ge,xe]=w.useState(!1),[Ee,K]=w.useState(""),[me,Be]=w.useState(""),ds=Array.isArray(a)?a:[],ns=(s.complement_groups||[]).map(je=>ds.find(ve=>ve.id===je.group_id)).filter(Boolean),ie=s.stock!==null&&s.stock!==void 0&&s.stock!==""&&s.stock<=0,Ge=s.original_price&&s.original_price>s.price;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:`bg-white border rounded-lg overflow-hidden hover:shadow-sm transition-shadow ${L?"ring-2 ring-blue-500":""}`,children:[e.jsxs("div",{className:"flex items-center gap-3 p-3",children:[e.jsx("input",{type:"checkbox",checked:L,onChange:O,className:"w-4 h-4 rounded",onClick:je=>je.stopPropagation()}),e.jsxs("div",{className:"w-16 h-16 flex-shrink-0 bg-gray-100 rounded overflow-hidden relative",children:[s.image?e.jsx("img",{src:s.image,alt:s.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400 text-xs",children:"Sem foto"}),ie&&e.jsx("div",{className:"absolute inset-0 bg-red-500/80 flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"Esgotado"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start gap-2 mb-1",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("h3",{className:"font-medium text-sm",children:[s.name," ",s.portion&&e.jsxs("span",{className:"text-gray-400",children:["(",s.portion,")"]})]}),s.is_new&&e.jsx(fe,{variant:"outline",className:"text-xs bg-green-50 text-green-700",children:"✨ Novo"}),s.is_popular&&e.jsx(fe,{variant:"outline",className:"text-xs bg-purple-50 text-purple-700",children:"🔥 Popular"})]}),e.jsx("p",{className:"text-xs text-gray-500 line-clamp-1",children:s.description}),s.tags&&s.tags.length>0&&e.jsxs("div",{className:"flex gap-1 mt-1",children:[s.tags.slice(0,3).map(je=>e.jsx("span",{className:"text-xs px-1 py-0.5 bg-gray-100 rounded",children:je},je)),s.tags.length>3&&e.jsxs("span",{className:"text-xs text-gray-400",children:["+",s.tags.length-3]})]}),s.internal_notes&&e.jsxs("p",{className:"text-xs text-orange-600 mt-1",children:["📝 ",s.internal_notes]})]}),e.jsx(fe,{className:`text-xs ${P?"cursor-pointer hover:bg-yellow-200":"cursor-default"} transition-all ${s.is_highlight?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-500"}`,onClick:je=>{je.stopPropagation(),P&&m({is_highlight:!s.is_highlight})},children:s.is_highlight?"⭐ Destaque":"Destaque"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[s.stock!==null&&s.stock!==void 0&&s.stock!==""&&e.jsxs("span",{children:["Estoque: ",s.stock]}),(s.stock===null||s.stock===void 0||s.stock==="")&&e.jsx("span",{className:"text-green-600",children:"Estoque: Ilimitado"}),s.prep_time&&e.jsxs("span",{children:["⏱️ ",s.prep_time,"min"]})]})]}),e.jsxs("button",{onClick:r,className:"flex items-center gap-1 px-2 sm:px-3 py-1.5 text-sm border rounded hover:bg-gray-50",children:[e.jsx(Ja,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline text-xs",children:"Complementos"}),e.jsx(fe,{variant:"outline",className:"text-xs",children:ns.length}),t?e.jsx(zt,{className:"w-4 h-4"}):e.jsx(Ra,{className:"w-4 h-4"})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[Ge&&e.jsx("span",{className:"text-xs text-gray-400 line-through",children:g(s.original_price)}),A?e.jsx(U,{type:"number",step:"0.01",value:Ee,onChange:je=>K(je.target.value),onBlur:()=>{m({price:parseFloat(Ee)||s.price}),X(!1)},onKeyDown:je=>{je.key==="Enter"&&(m({price:parseFloat(Ee)||s.price}),X(!1)),je.key==="Escape"&&X(!1)},className:"h-7 w-24 text-sm",autoFocus:!0}):e.jsx("span",{className:`font-semibold text-sm whitespace-nowrap ${P?"cursor-pointer hover:bg-gray-100":""} px-2 py-1 rounded ${Ge?"text-green-600":""}`,onClick:()=>{P&&(K(s.price?.toString()||"0"),X(!0))},title:P?"Clique para editar":"",children:g(s.price)}),s.stock!==null&&s.stock!==void 0&&s.stock!==""&&(ge?e.jsx(U,{type:"number",value:me,onChange:je=>Be(je.target.value),onBlur:()=>{m({stock:parseFloat(me)||0}),xe(!1)},onKeyDown:je=>{je.key==="Enter"&&(m({stock:parseFloat(me)||0}),xe(!1)),je.key==="Escape"&&xe(!1)},className:"h-6 w-20 text-xs",autoFocus:!0}):e.jsxs("span",{className:`text-xs text-gray-500 ${P?"cursor-pointer hover:bg-gray-100":""} px-2 py-0.5 rounded`,onClick:()=>{P&&(Be(s.stock?.toString()||"0"),xe(!0))},title:P?"Clique para editar estoque":"",children:["Est: ",s.stock]}))]}),e.jsx(Le,{checked:s.is_active!==!1,onCheckedChange:je=>{P&&m({is_active:je})},disabled:!P}),e.jsxs(mt,{children:[e.jsx(ut,{asChild:!0,children:e.jsx(D,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(jr,{className:"w-4 h-4"})})}),e.jsxs(ht,{align:"end",children:[P&&e.jsxs(ms,{onClick:n,children:[e.jsx(Rs,{className:"w-4 h-4 mr-2"}),"Editar item"]}),F&&e.jsxs(ms,{onClick:c,children:[e.jsx(Wo,{className:"w-4 h-4 mr-2"}),"Duplicar item"]}),(P||F||C)&&e.jsx(yi,{}),C&&e.jsxs(ms,{onClick:()=>confirm("Excluir?")&&l(),className:"text-red-600",children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),"Remover item"]})]})]})]}),t&&e.jsxs("div",{className:"border-t bg-gray-50 p-4 space-y-3",children:[e.jsx(dr,{onDragEnd:je=>{if(!P||!je.destination||je.source.index===je.destination.index)return;const ve=Array.from(s.complement_groups||[]),[zs]=ve.splice(je.source.index,1);ve.splice(je.destination.index,0,zs),T.mutate({id:s.id,data:{complement_groups:ve}})},children:e.jsx(mr,{droppableId:`dish-groups-${s.id}`,children:je=>e.jsxs("div",{...je.droppableProps,ref:je.innerRef,className:"space-y-3",children:[ns.map((ve,zs)=>{const Ga=s.complement_groups?.find(ea=>ea.group_id===ve.id),ps=u(ve.id).firstDishId===s.id;return e.jsx(ur,{draggableId:`group-${s.id}-${ve.id}`,index:zs,children:(ea,As)=>e.jsxs("div",{ref:ea.innerRef,...ea.draggableProps,className:`bg-white rounded-lg p-3 border transition-all ${As.isDragging?"shadow-lg ring-2 ring-orange-500":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[P&&e.jsx("div",{...ea.dragHandleProps,className:"cursor-grab active:cursor-grabbing",children:e.jsx(cr,{className:"w-5 h-5 text-gray-400"})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-sm",children:ve.name}),e.jsx(fe,{variant:"outline",className:`text-xs ${P?"cursor-pointer hover:bg-red-200":"cursor-default"} transition-colors ${Ga?.is_required?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"}`,onClick:qe=>{if(!P)return;qe.stopPropagation();const be=(s.complement_groups||[]).map(ls=>ls.group_id===ve.id?{...ls,is_required:!Ga?.is_required}:ls);T.mutate({id:s.id,data:{complement_groups:be}})},children:Ga?.is_required?"✓ Obrigatório":"Opcional"}),ps?e.jsx(fe,{variant:"outline",className:"text-xs bg-green-50 text-green-700",children:"Original"}):e.jsx(fe,{variant:"outline",className:"text-xs bg-blue-50 text-blue-700",children:"Reutilizado"})]})}),e.jsxs("div",{className:"flex gap-1",children:[P&&e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>$(ve),title:"Configurações",children:e.jsx(ct,{className:"w-4 h-4"})}),P&&e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>{N(ve),V(!0)},title:"Edição em massa",children:e.jsx($t,{className:"w-4 h-4"})}),F&&e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>f(ve.id),title:"Adicionar opção",children:e.jsx(Ie,{className:"w-4 h-4"})}),F&&e.jsx(D,{variant:"ghost",size:"sm",onClick:async()=>{const qe={name:`${ve.name} (Cópia)`,is_required:ve.is_required,max_selection:ve.max_selection,options:ve.options||[],order:k.length};await b.mutateAsync(qe)},title:"Duplicar grupo",children:e.jsx(Ks,{className:"w-4 h-4"})}),C&&e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>j(ve.id),className:"text-red-500 hover:text-red-700",title:"Remover grupo",children:e.jsx(Ke,{className:"w-4 h-4"})})]})]}),e.jsx(dr,{onDragEnd:qe=>{if(!P||!qe.destination)return;const be=Array.from(ve.options||[]),[ls]=be.splice(qe.source.index,1);be.splice(qe.destination.index,0,ls),h.mutate({id:ve.id,data:{...ve,options:be}})},children:e.jsx(mr,{droppableId:`options-${ve.id}`,children:qe=>e.jsxs("div",{...qe.droppableProps,ref:qe.innerRef,className:"space-y-2",children:[(ve.options||[]).map((be,ls)=>e.jsx(ur,{draggableId:be.id,index:ls,children:(_a,Rn)=>e.jsxs("div",{ref:_a.innerRef,..._a.draggableProps,..._a.dragHandleProps,className:`flex items-center gap-3 p-2 rounded transition-all ${Rn.isDragging?"shadow-lg":""} ${be.is_active!==!1?"bg-white":"bg-red-50"}`,children:[P&&e.jsx(cr,{className:"w-4 h-4 text-gray-400 flex-shrink-0 cursor-grab active:cursor-grabbing"}),P?e.jsxs("label",{className:"cursor-pointer relative",children:[be.image?e.jsx("img",{src:be.image,alt:be.name,className:"w-12 h-12 rounded object-cover"}):e.jsx("div",{className:"w-12 h-12 rounded bg-gray-200 flex items-center justify-center text-gray-400 text-xs",children:"+"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:qs=>{const Ne=qs.target.files?.[0];Ne&&(Y(be.id),d(ve.id,be.id,Ne).then(()=>{Y(null)}))}})]}):be.image?e.jsx("img",{src:be.image,alt:be.name,className:"w-12 h-12 rounded object-cover"}):e.jsx("div",{className:"w-12 h-12 rounded bg-gray-200 flex items-center justify-center text-gray-400 text-xs",children:"-"}),e.jsx("div",{className:"flex-1 min-w-0",children:E===be.id?e.jsx(U,{value:ue,onChange:qs=>Z(qs.target.value),onBlur:()=>{o(ve.id,be.id,ue),ee(null)},onKeyDown:qs=>{qs.key==="Enter"&&(o(ve.id,be.id,ue),ee(null))},className:"h-8 text-sm",autoFocus:!0}):e.jsxs("div",{children:[e.jsx("span",{className:`text-sm font-medium ${P?"cursor-pointer hover:text-blue-600":""} block`,onClick:()=>{P&&(ee(be.id),Z(be.name))},children:be.name}),S===be.id?e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"R$"}),e.jsx(U,{type:"number",step:"0.01",value:q,onChange:qs=>ne(qs.target.value),onBlur:()=>{p(ve.id,be.id,q),G(null)},onKeyDown:qs=>{qs.key==="Enter"&&(p(ve.id,be.id,q),G(null))},className:"h-6 w-20 text-xs",autoFocus:!0})]}):e.jsx("span",{className:`text-xs text-gray-500 ${P?"cursor-pointer hover:text-blue-600":""}`,onClick:()=>{P&&(G(be.id),ne((be.price||0).toString()))},children:be.price>0?g(be.price):"+ Adicionar preço"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{checked:be.is_active!==!1,onCheckedChange:()=>{P&&i(ve.id,be.id,be.is_active!==!1)},disabled:!P}),C&&e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>x(ve.id,be.id),className:"text-red-500 hover:text-red-700 h-8 w-8 p-0",children:e.jsx(ws,{className:"w-4 h-4"})})]})]})},be.id)),qe.placeholder]})})})]})},ve.id)}),je.placeholder]})})}),F&&e.jsxs(mt,{children:[e.jsx(ut,{asChild:!0,children:e.jsxs(D,{variant:"outline",className:"w-full",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Adicionar Grupo de Complementos"]})}),e.jsxs(ht,{className:"w-56",children:[e.jsxs(ms,{onClick:v,children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Criar novo grupo"]}),e.jsx(yi,{}),e.jsxs(ms,{onClick:M,children:[e.jsx(Ks,{className:"w-4 h-4 mr-2"}),"Copiar grupo existente"]})]})]})]})]})})}function ay({onNavigateToPizzas:s,initialTab:a="dishes"}){Qe.admin.log("🍽️ [DishesTab] Componente montado, initialTab:",a);const[t,r]=se.useState(null),[n,l]=w.useState(!1),[c,m]=w.useState(!1),[i,o]=w.useState(!1),[d,p]=w.useState(!1),[x,f]=w.useState(!1),[v,y]=w.useState(null),[j,M]=w.useState(null),[k,z]=w.useState(!1),[$,u]=w.useState(null),[g,T]=w.useState(null),[h,b]=w.useState(null),[L,O]=w.useState({}),[P,F]=w.useState({}),[C,N]=w.useState({name:"",description:"",price:"",original_price:"",image:"",category_id:"",stock:"",portion:"",is_highlight:!1,is_active:!0,complement_groups:[],is_new:!1,is_popular:!1,prep_time:"",tags:[],internal_notes:"",product_type:"preparado",video_url:"",video_autoplay:!0}),[V,E]=w.useState(""),[ee,ue]=w.useState(null),[Z,S]=w.useState(""),[G,q]=w.useState(!1),[ne,Me]=w.useState(null),[Y,A]=w.useState(null),[X,ge]=w.useState(!1),[xe,Ee]=w.useState(""),[K,me]=w.useState("all"),[Be,ds]=w.useState("all"),[ns,ie]=w.useState("all"),[Ge,je]=w.useState(!1),[ve,zs]=w.useState([]),[Ga,vt]=w.useState(!1),[ps,ea]=w.useState(null),[As,qe]=w.useState(a);w.useEffect(()=>{a&&qe(a)},[a]);const{canCreate:be,canUpdate:ls,canDelete:_a,hasModuleAccess:Rn,subscriberData:qs,menuContext:Ne,user:_r,loading:Ud}=Ze(),Nl=Rn("pizza_config"),Bd=ls("dishes");Qe.admin.log("🍽️ [DishesTab] Permissões:",{canCreate:be("dishes"),canUpdate:ls("dishes"),canDelete:_a("dishes"),hasPizzaService:Nl,canEdit:Bd,menuContext:Ne}),se.useEffect(()=>{_r?(r(_r),Qe.admin.log("🍽️ [DishesTab] Usuário do usePermission:",_r?.email)):(async()=>{try{Qe.admin.log("🍽️ [DishesTab] Carregando usuário...");const I=await ae.auth.me();Qe.admin.log("🍽️ [DishesTab] Usuário carregado:",I?.email),r(I)}catch(I){Qe.admin.error("🍽️ [DishesTab] Error loading user:",I)}})()},[_r]);const Cs=es(),Ns=()=>Ne?Ne.type==="subscriber"&&Ne.value?Ne.value:Ne.type==="slug"?null:t?.email||null:t?.email||null,{data:wl=[],isLoading:Wd,error:Ln}=Ae({queryKey:["dishes",Ne?.type,Ne?.value],queryFn:async()=>Ne?await Kc(Ne):(Qe.admin.warn("🍽️ [DishesTab] menuContext não disponível, retornando array vazio"),[]),enabled:!!Ne,initialData:[],placeholderData:ar,retry:1,refetchOnMount:"always",staleTime:3e4,gcTime:6e4}),{data:_l=[],isLoading:Hd,error:In}=Ae({queryKey:["categories",Ne?.type,Ne?.value],queryFn:async()=>Ne?await Qc(Ne):(Qe.admin.warn("🍽️ [DishesTab] menuContext não disponível, retornando array vazio"),[]),enabled:!!Ne,initialData:[],placeholderData:ar,retry:1,refetchOnMount:"always",staleTime:3e4,gcTime:6e4}),{data:Cl=[],isLoading:Kd,error:$n}=Ae({queryKey:["complementGroups",Ne?.type,Ne?.value],queryFn:async()=>Ne?await $f(Ne):(Qe.admin.warn("🍽️ [DishesTab] menuContext não disponível, retornando array vazio"),[]),enabled:!!Ne,initialData:[],placeholderData:ar,retry:2,refetchOnMount:"always",staleTime:3e4,gcTime:6e4}),kl=le({mutationFn:async _=>{const I=Ns(),te={..._,...I&&{as_subscriber:I,owner_email:I}};return ae.entities.Dish.create(te)},onSuccess:()=>{Cs.invalidateQueries({queryKey:["dishes",Ne?.type,Ne?.value]}),W.success("Prato adicionado com sucesso!"),Yn()},onError:()=>{W.error("Erro ao adicionar prato")}}),gs=le({mutationFn:({id:_,data:I})=>{const te=Ns()?{as_subscriber:Ns()}:{};return ae.entities.Dish.update(_,I,te)},onMutate:async({id:_,data:I})=>{const te=["dishes",Ne?.type,Ne?.value];await Cs.cancelQueries({queryKey:te});const pe=Cs.getQueryData(te);return Cs.setQueryData(te,de=>Array.isArray(de)?de.map(we=>we.id===_||String(we.id)===String(_)?{...we,...I}:we):de),{prev:pe}},onError:(_,I,te)=>{te?.prev&&Cs.setQueryData(["dishes",Ne?.type,Ne?.value],te.prev),W.error("Erro ao atualizar prato")},onSuccess:()=>W.success("Prato atualizado!"),onSettled:()=>{Cs.invalidateQueries({queryKey:["dishes",Ne?.type,Ne?.value]})}}),Sl=le({mutationFn:_=>{const I=Ns()?{as_subscriber:Ns()}:{};return ae.entities.Dish.delete(_,I)},onSuccess:()=>{Cs.invalidateQueries({queryKey:["dishes",Ne?.type,Ne?.value]}),W.success("Prato excluído")},onError:()=>W.error("Erro ao excluir prato")}),Dl=le({mutationFn:async _=>{const I=Ns();return ae.entities.Category.create({..._,...I&&{as_subscriber:I,owner_email:I}})},onSuccess:()=>{Cs.invalidateQueries({queryKey:["categories",Ne?.type,Ne?.value]}),W.success("Categoria criada com sucesso!"),m(!1),b(null)},onError:()=>W.error("Erro ao criar categoria")}),yt=le({mutationFn:({id:_,data:I})=>{const te=Ns()?{as_subscriber:Ns()}:{};return ae.entities.Category.update(_,I,te)},onSuccess:()=>{Cs.invalidateQueries({queryKey:["categories",Ne?.type,Ne?.value]}),W.success("Categoria atualizada!"),m(!1),b(null)},onError:()=>W.error("Erro ao atualizar categoria")}),Qd=le({mutationFn:_=>{const I=Ns()?{as_subscriber:Ns()}:{};return ae.entities.Category.delete(_,I)},onSuccess:()=>{Cs.invalidateQueries({queryKey:["categories",Ne?.type,Ne?.value]}),Cs.invalidateQueries({queryKey:["dishes",Ne?.type,Ne?.value]}),W.success("Categoria excluída")},onError:()=>W.error("Erro ao excluir categoria")}),{requireAuthorization:qn,modal:Zd}=Io(),Cr=_=>qn("excluir",()=>{confirm("Excluir este prato?")&&Sl.mutate(_)}),Ml=_=>qn("excluir",()=>{confirm("Excluir categoria e seus pratos?")&&Qd.mutate(_)}),Jd=()=>qn("excluir",()=>{ve.length!==0&&confirm(`Excluir ${ve.length} pratos selecionados?`)&&(ve.forEach(_=>Sl.mutate(_)),zs([]))}),kr=le({mutationFn:async _=>{const I=Ns();return ae.entities.ComplementGroup.create({..._,...I&&{as_subscriber:I,owner_email:I}})},onSuccess:_=>(Cs.invalidateQueries({queryKey:["complementGroups",Ne?.type,Ne?.value]}),_)}),Ts=le({mutationFn:({id:_,data:I})=>{const te=Ns()?{as_subscriber:Ns()}:{};return ae.entities.ComplementGroup.update(_,I,te)},onSuccess:()=>Cs.invalidateQueries({queryKey:["complementGroups",Ne?.type,Ne?.value]})}),hs=(Array.isArray(wl)?wl:[]).filter(_=>_.product_type!=="pizza"),Xe=Array.isArray(_l)?_l:[],fs=Array.isArray(Cl)?Cl:[],Va=(_=null,I="",te="preparado")=>{_?(M(_),N({name:_.name||"",description:_.description||"",price:_.price?.toString()||"",original_price:_.original_price?.toString()||"",image:_.image||"",category_id:_.category_id||"",is_highlight:_.is_highlight||!1,is_active:_.is_active!==!1,complement_groups:_.complement_groups||[],stock:_.stock===null||_.stock===void 0?"":_.stock.toString(),portion:_.portion||"",is_new:_.is_new||!1,is_popular:_.is_popular||!1,prep_time:_.prep_time?.toString()||"",tags:_.tags||[],internal_notes:_.internal_notes||"",product_type:_.product_type||"preparado",video_url:_.video_url||"",video_autoplay:_.video_autoplay!==!1}),ue(null)):(M(null),N({name:"",description:"",price:"",original_price:"",image:"",category_id:I,is_highlight:!1,is_active:!0,complement_groups:[],stock:"",portion:"",is_new:!1,is_popular:!1,prep_time:"",tags:[],internal_notes:"",product_type:te,video_url:"",video_autoplay:!0}),ue(null),S("")),l(!0)},Kt=_=>{u(_),z(!0)},Xd=_=>{z(!1),Va(null,$,_)},em=()=>{s&&s()},Yn=()=>{l(!1),M(null),ue(null),S("")},sm=_=>{if(_.preventDefault(),!C.name.trim()){W.error("O nome do prato é obrigatório");return}if(!C.price||parseFloat(C.price)<0){W.error("Informe um preço válido");return}if(C.original_price&&parseFloat(C.original_price)<parseFloat(C.price)){W.error("O preço original não pode ser menor que o preço atual");return}let I=C.complement_groups;if(!j&&ee==="copy"&&Z){const pe=hs.find(de=>de.id===Z);pe?.complement_groups&&(I=pe.complement_groups)}const te={...C,price:parseFloat(C.price)||0,original_price:C.original_price?parseFloat(C.original_price):null,stock:C.stock===""?null:C.stock?parseFloat(C.stock):null,prep_time:C.prep_time?parseFloat(C.prep_time):null,complement_groups:I,video_url:C.video_url||"",video_autoplay:C.video_autoplay!==!1};j?(gs.mutate({id:j.id,data:te}),Yn()):kl.mutate(te)},am=async _=>{const I=_.target.files?.[0];if(I)try{const te=await $l(I,"dishes");N(pe=>({...pe,image:te})),W.success("Imagem enviada com sucesso!")}catch(te){console.error("Erro ao fazer upload:",te),W.error("Erro ao fazer upload da imagem")}},Sr=_=>{O(I=>({...I,[_]:!I[_]}))},Al=_=>{F(I=>({...I,[_]:!I[_]}))},Gn=(_,I,te)=>{const pe=fs.find(we=>we.id===_);if(!pe)return;const de=(pe.options||[]).map(we=>we.id===I?{...we,is_active:!te}:we);Ts.mutate({id:_,data:{...pe,options:de}})},Vn=(_,I,te)=>{const pe=fs.find(we=>we.id===_);if(!pe)return;const de=(pe.options||[]).map(we=>we.id===I?{...we,name:te}:we);Ts.mutate({id:_,data:{...pe,options:de}})},Un=_=>{const I=prompt("Nome da opção:");if(!I)return;const te=prompt("Preço adicional (deixe em branco para R$ 0,00):","0"),pe=parseFloat(te)||0,de=fs.find(Ys=>Ys.id===_);if(!de)return;const we={id:Date.now().toString(),name:I,price:pe,image:"",is_active:!0};Ts.mutate({id:_,data:{...de,options:[...de.options||[],we]}})},Bn=async(_,I,te)=>{try{const pe=await $l(te,"complements"),de=fs.find(Ys=>Ys.id===_);if(!de)return;const we=(de.options||[]).map(Ys=>Ys.id===I?{...Ys,image:pe}:Ys);Ts.mutate({id:_,data:{...de,options:we}}),W.success("Imagem atualizada!")}catch(pe){console.error("Erro ao fazer upload:",pe),W.error("Erro ao fazer upload da imagem")}},Wn=(_,I,te)=>{const pe=fs.find(we=>we.id===_);if(!pe)return;const de=(pe.options||[]).map(we=>we.id===I?{...we,price:parseFloat(te)||0}:we);Ts.mutate({id:_,data:{...pe,options:de}})},Pl=_=>{const I=hs.filter(pe=>pe.complement_groups?.some(de=>de.group_id===_));if(I.length===0)return{type:"original",count:0};const te=I.sort((pe,de)=>new Date(pe.created_date)-new Date(de.created_date))[0];return{type:I.length>1?"reused":"original",count:I.length,firstDishId:te.id}},Hn=async _=>{const I=prompt("Nome do grupo de complementos:");if(!I)return;const te={name:I,is_required:!1,max_selection:1,options:[],order:fs.length},pe=await kr.mutateAsync(te);setTimeout(()=>{const de=hs.find(we=>we.id===_);if(de&&pe){const we=[...de.complement_groups||[],{group_id:pe.id,is_required:!1}];gs.mutate({id:_,data:{...de,complement_groups:we}})}},300)},Dr=(_,I)=>{const te=hs.find(we=>we.id===_);if(!te)return;if(te.complement_groups?.some(we=>we.group_id===I)){alert("Este grupo já está vinculado a este prato");return}const de=[...te.complement_groups||[],{group_id:I,is_required:!1}];gs.mutate({id:_,data:{...te,complement_groups:de}},{onSettled:()=>Cs.invalidateQueries({queryKey:["complementGroups",Ne?.type,Ne?.value]})})},Kn=(_,I)=>{if(!confirm("Remover este grupo de complementos?"))return;const te=hs.find(de=>de.id===_);if(!te)return;const pe=(te.complement_groups||[]).filter(de=>de.group_id!==I);gs.mutate({id:_,data:{...te,complement_groups:pe}})},Qn=(_,I)=>{if(!confirm("Remover este complemento?"))return;const te=fs.find(de=>de.id===_);if(!te)return;const pe=(te.options||[]).filter(de=>de.id!==I);Ts.mutate({id:_,data:{...te,options:pe}})},Zn=(_,I)=>{T({..._,dishId:I}),o(!0)},tm=()=>{if(g){if(Ts.mutate({id:g.id,data:{name:g.name,max_selection:g.max_selection,options:g.options,order:g.order}}),g.dishId){const _=hs.find(I=>I.id===g.dishId);if(_){const I=(_.complement_groups||[]).map(te=>te.group_id===g.id?{...te,is_required:g.is_required}:te);gs.mutate({id:g.dishId,data:{..._,complement_groups:I}})}}o(!1),T(null)}},Mr=async _=>{const I=Ns(),te={..._,name:`${_.name} (Cópia)`,...I&&{as_subscriber:I,owner_email:I},id:void 0,created_date:void 0,updated_date:void 0};kl.mutate(te)},El=async _=>{const I=Ns();Dl.mutate({name:`${_.name} (Cópia)`,order:Xe.length,...I&&{as_subscriber:I,owner_email:I}})},Ol=_=>{b(_),m(!0)},rm=_=>{h?yt.mutate({id:h.id,data:{...h,..._}}):Dl.mutate(_)},Qt=hs.filter(_=>{const I=!xe||_.name?.toLowerCase().includes(xe.toLowerCase())||_.description?.toLowerCase().includes(xe.toLowerCase()),te=K==="all"||_.category_id===K,pe=Be==="all"||Be==="active"&&_.is_active!==!1||Be==="inactive"&&_.is_active===!1,de=ns==="all"||ns==="highlight"&&_.is_highlight||ns==="new"&&_.is_new||ns==="popular"&&_.is_popular;return I&&te&&pe&&de}),Zt={};Xe.forEach(_=>{Zt[_.id]=Qt.filter(I=>I.category_id===_.id)});const bt=Qt.filter(_=>!_.category_id||!Xe.some(I=>I.id===_.category_id)),zl=_=>{ve.length!==0&&(ve.forEach(I=>{const te=hs.find(pe=>pe.id===I);te&&gs.mutate({id:I,data:{...te,is_active:_}})}),zs([]))},Tl=_=>{zs(I=>I.includes(_)?I.filter(te=>te!==_):[...I,_])},nm=_=>{N(I=>({...I,tags:I.tags.includes(_)?I.tags.filter(te=>te!==_):[...I.tags,_]}))},im=()=>{const _=[];if(xe&&_.push({key:"search",label:`"${xe}"`}),K!=="all"){const I=Xe.find(te=>te.id===K);I&&_.push({key:"category",label:I.name})}if(Be!=="all"&&_.push({key:"status",label:Be==="active"?"Ativos":"Inativos"}),ns!=="all"){const I={highlight:"Destaques",new:"Novos",popular:"Populares"};_.push({key:"type",label:I[ns]})}return _},lm=_=>{_==="search"&&Ee(""),_==="category"&&me("all"),_==="status"&&ds("all"),_==="type"&&ie("all")},om=["vegetariano","vegano","sem_gluten","picante","fit"],cm={vegetariano:"🥗 Vegetariano",vegano:"🌱 Vegano",sem_gluten:"🌾 Sem Glúten",picante:"🌶️ Picante",fit:"💪 Fit"},dm=_=>{if(_===0)return;const I=Xe[_],te=Xe[_-1];I&&te&&(yt.mutate({id:I.id,data:{...I,order:_-1}}),yt.mutate({id:te.id,data:{...te,order:_}}))},mm=_=>{if(_===Xe.length-1)return;const I=Xe[_],te=Xe[_+1];I&&te&&(yt.mutate({id:I.id,data:{...I,order:_+1}}),yt.mutate({id:te.id,data:{...te,order:_}}))},Ar=im(),um=Ud||!Ne||Wd||Hd||Kd,hm=Ln||In||$n;return um?e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx(a0,{})}):hm?(Qe.admin.error("🍽️ [DishesTab] Erro ao carregar:",{dishesError:Ln,categoriesError:In,groupsError:$n}),e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-500 mb-4",children:"Erro ao carregar dados"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:Ln?.message||In?.message||$n?.message||"Erro desconhecido"}),e.jsx(D,{onClick:()=>window.location.reload(),children:"Recarregar página"})]})})):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(Hr,{position:"top-center"}),e.jsxs("div",{className:"lg:hidden sticky top-0 z-30 bg-white border-b border-gray-100 px-4 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Cardápio"}),e.jsxs("button",{onClick:()=>vt(!0),className:"flex items-center gap-2 px-3 py-2 rounded-xl bg-gray-100 active:bg-gray-200 transition-colors",children:[e.jsx(_s,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Filtros"}),Ar.length>0&&e.jsx("span",{className:"w-5 h-5 bg-orange-500 text-white text-xs rounded-full flex items-center justify-center",children:Ar.length})]})]}),Ar.length>0&&e.jsx(Zf,{filters:Ar,onRemoveFilter:lm,onClearAll:()=>{Ee(""),me("all"),ds("all"),ie("all")}})]}),e.jsx("div",{className:"hidden lg:block border-b bg-white",children:e.jsxs("div",{className:"px-6 flex gap-1",children:[e.jsxs("button",{onClick:()=>qe("dishes"),className:`px-4 py-3 text-sm font-medium border-b-2 transition-colors ${As==="dishes"?"border-orange-500 text-orange-500":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(sa,{className:"w-4 h-4 inline mr-2"}),"Pratos"]}),e.jsxs("button",{onClick:()=>qe("categories"),className:`px-4 py-3 text-sm font-medium border-b-2 transition-colors ${As==="categories"?"border-orange-500 text-orange-500":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(Ja,{className:"w-4 h-4 inline mr-2"}),"Categorias"]}),e.jsxs("button",{onClick:()=>qe("complements"),className:`px-4 py-3 text-sm font-medium border-b-2 transition-colors ${As==="complements"?"border-orange-500 text-orange-500":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx($o,{className:"w-4 h-4 inline mr-2"}),"Complementos"]})]})}),e.jsx("div",{className:"lg:hidden border-b bg-white sticky top-[73px] z-20",children:e.jsxs("div",{className:"flex overflow-x-auto scrollbar-hide",children:[e.jsx("button",{onClick:()=>qe("dishes"),className:`px-4 py-3 text-xs font-medium border-b-2 transition-colors flex-shrink-0 ${As==="dishes"?"border-orange-500 text-orange-500":"border-transparent text-gray-500"}`,children:"Pratos"}),e.jsx("button",{onClick:()=>qe("categories"),className:`px-4 py-3 text-xs font-medium border-b-2 transition-colors flex-shrink-0 ${As==="categories"?"border-orange-500 text-orange-500":"border-transparent text-gray-500"}`,children:"Categorias"}),e.jsx("button",{onClick:()=>qe("complements"),className:`px-4 py-3 text-xs font-medium border-b-2 transition-colors flex-shrink-0 ${As==="complements"?"border-orange-500 text-orange-500":"border-transparent text-gray-500"}`,children:"Complementos"})]})}),As==="categories"?e.jsx(Bf,{}):As==="complements"?e.jsx(Kf,{}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden lg:block p-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-3 mb-6",children:[be("dishes")&&e.jsxs(D,{onClick:()=>m(!0),variant:"outline",children:[e.jsx(sn,{className:"w-4 h-4 mr-2"}),"Nova Categoria"]}),ls("dishes")&&e.jsxs(D,{onClick:()=>ge(!0),variant:"outline",children:[e.jsx(Fa,{className:"w-4 h-4 mr-2"}),"Reordenar"]}),be("dishes")&&e.jsxs(D,{onClick:()=>p(!0),variant:"outline",children:[e.jsx(ji,{className:"w-4 h-4 mr-2"}),"Templates"]}),be("dishes")&&e.jsxs(D,{variant:"outline",className:"ml-auto",onClick:()=>setShowComboModal(!0),children:[e.jsx(tr,{className:"w-4 h-4 mr-2"}),"Criar Combo"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(B,{className:"border-l-4 border-l-blue-500",children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total de Pratos"}),e.jsx("p",{className:"text-2xl font-bold",children:hs.length})]}),e.jsx(ys,{className:"w-8 h-8 text-blue-500"})]})})}),e.jsx(B,{className:"border-l-4 border-l-green-500",children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Ativos"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:hs.filter(_=>_.is_active!==!1).length})]}),e.jsx(la,{className:"w-8 h-8 text-green-500"})]})})}),e.jsx(B,{className:"border-l-4 border-l-orange-500",children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Categorias"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:Xe.length})]}),e.jsx(Ja,{className:"w-8 h-8 text-orange-500"})]})})}),e.jsx(B,{className:"border-l-4 border-l-purple-500",children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Complementos"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:fs.length})]}),e.jsx(ct,{className:"w-8 h-8 text-purple-500"})]})})})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 mb-6 space-y-4 shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(U,{placeholder:"🔍 Buscar pratos...",value:xe,onChange:_=>Ee(_.target.value)}),e.jsxs(Ce,{value:K,onValueChange:me,children:[e.jsx(ke,{children:e.jsx(Se,{placeholder:"Todas categorias"})}),e.jsxs(De,{children:[e.jsx(Q,{value:"all",children:"Todas categorias"}),Xe.map(_=>e.jsx(Q,{value:_.id,children:_.name},_.id))]})]}),e.jsxs(Ce,{value:Be,onValueChange:ds,children:[e.jsx(ke,{children:e.jsx(Se,{placeholder:"Status"})}),e.jsxs(De,{children:[e.jsx(Q,{value:"all",children:"Todos os status"}),e.jsx(Q,{value:"active",children:"✓ Ativos"}),e.jsx(Q,{value:"inactive",children:"✗ Inativos"})]})]}),e.jsxs(Ce,{value:ns,onValueChange:ie,children:[e.jsx(ke,{children:e.jsx(Se,{placeholder:"Tipo"})}),e.jsxs(De,{children:[e.jsx(Q,{value:"all",children:"Todos os tipos"}),e.jsx(Q,{value:"highlight",children:"⭐ Destaques"}),e.jsx(Q,{value:"new",children:"✨ Novos"}),e.jsx(Q,{value:"popular",children:"🔥 Populares"})]})]})]}),(xe||K!=="all"||Be!=="all"||ns!=="all")&&e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:[Qt.length," prato",Qt.length!==1?"s":""," encontrado",Qt.length!==1?"s":""]}),e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>{Ee(""),me("all"),ds("all"),ie("all")},children:"Limpar filtros"})]})]})]}),ve.length>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-blue-900",children:[ve.length," prato",ve.length!==1?"s":""," selecionado",ve.length!==1?"s":""]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{variant:"outline",size:"sm",onClick:()=>zl(!0),children:"Ativar"}),e.jsx(D,{variant:"outline",size:"sm",onClick:()=>zl(!1),children:"Desativar"}),e.jsx(D,{variant:"outline",size:"sm",onClick:Jd,className:"text-red-600",children:"Excluir"}),e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>zs([]),children:"Cancelar"})]})]}),e.jsxs("div",{className:"lg:hidden px-4 pb-24 space-y-3",children:[bt.length>0&&e.jsx(co,{category:{id:"__sem_categoria__",name:"Sem categoria"},dishCount:bt.length,isExpanded:L.__sem_categoria__!==!1,onToggle:()=>Sr("__sem_categoria__"),onAddDish:()=>Kt(Xe[0]?.id||""),onEdit:()=>{},onDuplicate:()=>{},onDelete:()=>{},children:bt.map(_=>e.jsx(oo,{dish:_,onEdit:()=>Va(_),onDuplicate:()=>Mr(_),onDelete:()=>{Cr(_.id)},onToggleActive:I=>{ls("dishes")&&gs.mutate({id:_.id,data:{is_active:I}})},onToggleHighlight:I=>{ls("dishes")&&gs.mutate({id:_.id,data:{is_highlight:I}})},onToggleComplements:()=>ea(_),complementGroupsCount:_.complement_groups?.length||0,formatCurrency:ga,canEdit:ls("dishes")},_.id))},"__sem_categoria__"),Xe.map(_=>{const I=Zt[_.id]||[],te=L[_.id]!==!1;return e.jsx(co,{category:_,dishCount:I.length,isExpanded:te,onToggle:()=>Sr(_.id),onAddDish:()=>Kt(_.id),onEdit:()=>Ol(_),onDuplicate:()=>El(_),onDelete:()=>Ml(_.id),children:I.length===0?e.jsx("div",{className:"text-center py-8 text-gray-400 text-sm",children:"Nenhum prato nesta categoria"}):I.map(pe=>e.jsx(oo,{dish:pe,onEdit:()=>Va(pe),onDuplicate:()=>Mr(pe),onDelete:()=>Cr(pe.id),onToggleActive:de=>{ls("dishes")&&gs.mutate({id:pe.id,data:{is_active:de}})},onToggleHighlight:de=>{ls("dishes")&&gs.mutate({id:pe.id,data:{is_highlight:de}})},onToggleComplements:()=>ea(pe),complementGroupsCount:pe.complement_groups?.length||0,formatCurrency:ga,canEdit:ls("dishes")},pe.id))},_.id)}),Xe.length===0&&hs.length===0&&e.jsx(Rr,{icon:sa,title:"Você ainda não cadastrou nenhum prato",description:"Comece criando categorias e adicionando seus pratos ao cardápio",actionLabel:"Criar primeira categoria",onAction:()=>m(!0)}),Xe.length>0&&hs.length===0&&e.jsx(Rr,{icon:sa,title:"Você ainda não cadastrou nenhum prato",description:"Adicione pratos às categorias criadas para começar a vender",actionLabel:"Cadastrar primeiro prato",onAction:()=>Va(null,Xe[0]?.id||"")})]}),e.jsxs("div",{className:"hidden lg:block px-6 pb-6 space-y-4",children:[bt.length>0&&e.jsxs("div",{className:"bg-gray-50 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white border-b cursor-pointer hover:bg-gray-50",onClick:()=>Sr("__sem_categoria__"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Fa,{className:"w-5 h-5 text-gray-400"}),e.jsx("h2",{className:"font-bold text-lg",children:"Sem categoria"}),e.jsxs(fe,{variant:"secondary",className:"text-xs",children:[bt.length," itens"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[be("dishes")&&e.jsxs(D,{variant:"outline",size:"sm",onClick:_=>{_.stopPropagation(),Kt(Xe[0]?.id||"")},children:[e.jsx(Ie,{className:"w-4 h-4 mr-1"}),"Adicionar prato"]}),L.__sem_categoria__!==!1?e.jsx(zt,{className:"w-5 h-5"}):e.jsx(Ra,{className:"w-5 h-5"})]})]}),L.__sem_categoria__!==!1&&e.jsx("div",{className:"p-4 space-y-3",children:bt.map(_=>e.jsx(mo,{dish:_,isSelected:ve.includes(_.id),onToggleSelection:()=>Tl(_.id),complementGroups:fs,expanded:P[_.id],onToggleExpand:()=>Al(_.id),onEdit:()=>Va(_),onDelete:()=>Cr(_.id),onDuplicate:()=>Mr(_),onUpdate:I=>gs.mutate({id:_.id,data:I}),onToggleOption:Gn,onUpdateOptionName:Vn,onUpdateOptionPrice:Wn,onUpdateOptionImage:Bn,onRemoveOption:Qn,onAddOption:Un,onAddGroup:()=>Hn(_.id),onReuseGroup:I=>Dr(_.id,I),onRemoveGroup:I=>Kn(_.id,I),onOpenReuseModal:()=>{Me(_.id),q(!0)},allComplementGroups:fs,allDishes:hs,onEditGroup:I=>{const te=_.complement_groups?.find(pe=>pe.group_id===I.id);Zn({...I,is_required:te?.is_required||!1},_.id)},getGroupUsageInfo:Pl,formatCurrency:ga,updateDishMutation:gs,updateComplementGroupMutation:Ts,createComplementGroupMutation:kr,canEdit:ls("dishes"),canCreate:be("dishes"),canDelete:_a("dishes"),setBulkEditGroup:y,setShowBulkEditModal:f},_.id))})]}),Xe.map((_,I)=>{const te=Zt[_.id]||[],pe=L[_.id]!==!1;return e.jsxs("div",{className:"bg-gray-50 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white border-b cursor-pointer hover:bg-gray-50",onClick:()=>Sr(_.id),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[ls("dishes")&&e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("button",{onClick:de=>{de.stopPropagation(),dm(I)},disabled:I===0,className:"p-0.5 hover:bg-gray-200 rounded disabled:opacity-30",children:e.jsx(zt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:de=>{de.stopPropagation(),mm(I)},disabled:I===Xe.length-1,className:"p-0.5 hover:bg-gray-200 rounded disabled:opacity-30",children:e.jsx(Ra,{className:"w-4 h-4"})})]}),e.jsx(Fa,{className:"w-5 h-5 text-gray-400"}),e.jsx("h2",{className:"font-bold text-lg",children:_.name}),e.jsxs(fe,{variant:"secondary",className:"text-xs",children:[te.length," itens"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[ve.length>0&&e.jsxs(D,{variant:"outline",size:"sm",onClick:de=>{de.stopPropagation();const we=te.map(ua=>ua.id),Ys=we.every(ua=>ve.includes(ua));zs(Ys?ua=>ua.filter(xm=>!we.includes(xm)):ua=>[...new Set([...ua,...we])])},children:[te.every(de=>ve.includes(de.id))?"☑":"☐"," Selecionar todos"]}),be("dishes")&&e.jsxs(D,{variant:"outline",size:"sm",onClick:de=>{de.stopPropagation(),Kt(_.id)},children:[e.jsx(Ie,{className:"w-4 h-4 mr-1"}),"Adicionar prato"]}),e.jsxs(mt,{children:[e.jsx(ut,{asChild:!0,onClick:de=>de.stopPropagation(),children:e.jsx(D,{variant:"ghost",size:"icon",children:e.jsx(jr,{className:"w-4 h-4"})})}),e.jsxs(ht,{align:"end",children:[ls("dishes")&&e.jsxs(ms,{onClick:()=>Ol(_),children:[e.jsx(Rs,{className:"w-4 h-4 mr-2"}),"Editar categoria"]}),be("dishes")&&e.jsxs(ms,{onClick:()=>El(_),children:[e.jsx(Wo,{className:"w-4 h-4 mr-2"}),"Duplicar categoria"]}),_a("dishes")&&e.jsxs(e.Fragment,{children:[e.jsx(yi,{}),e.jsxs(ms,{onClick:()=>Ml(_.id),className:"text-red-600",children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),"Remover categoria"]})]})]})]}),pe?e.jsx(zt,{className:"w-5 h-5"}):e.jsx(Ra,{className:"w-5 h-5"})]})]}),pe&&e.jsx("div",{className:"p-4 space-y-3",children:te.length===0?e.jsx("div",{className:"p-4 text-center text-gray-400 text-sm",children:"Nenhum prato nesta categoria"}):te.map(de=>e.jsx(mo,{dish:de,isSelected:ve.includes(de.id),onToggleSelection:()=>Tl(de.id),complementGroups:fs,expanded:P[de.id],onToggleExpand:()=>Al(de.id),onEdit:()=>Va(de),onDelete:()=>Cr(de.id),onDuplicate:()=>Mr(de),onUpdate:we=>gs.mutate({id:de.id,data:we}),onToggleOption:Gn,onUpdateOptionName:Vn,onUpdateOptionImage:Bn,onUpdateOptionPrice:Wn,onRemoveOption:Qn,onAddOption:Un,onAddGroup:()=>Hn(de.id),onReuseGroup:we=>Dr(de.id,we),onRemoveGroup:we=>Kn(de.id,we),onOpenReuseModal:()=>{Me(de.id),q(!0)},allComplementGroups:fs,allDishes:hs,onEditGroup:we=>{const Ys=de.complement_groups?.find(ua=>ua.group_id===we.id);Zn({...we,is_required:Ys?.is_required||!1},de.id)},getGroupUsageInfo:Pl,formatCurrency:ga,updateDishMutation:gs,updateComplementGroupMutation:Ts,createComplementGroupMutation:kr,canEdit:ls("dishes"),canCreate:be("dishes"),canDelete:_a("dishes"),setBulkEditGroup:y,setShowBulkEditModal:f},de.id))})]},_.id)}),Xe.length===0&&hs.length===0&&e.jsx(Rr,{icon:sa,title:"Você ainda não cadastrou nenhum prato",description:"Comece criando categorias e adicionando seus pratos ao cardápio",actionLabel:"Criar primeira categoria",onAction:()=>m(!0)}),Xe.length>0&&hs.length===0&&e.jsx(Rr,{icon:sa,title:"Você ainda não cadastrou nenhum prato",description:"Adicione pratos às categorias criadas para começar a vender",actionLabel:"Cadastrar primeiro prato",onAction:()=>Va(null,Xe[0]?.id||"")})]}),be("dishes")&&e.jsx("div",{className:"lg:hidden",children:e.jsx(Qf,{onAddDish:()=>Kt(Xe[0]?.id||""),onAddCategory:()=>m(!0)})}),e.jsx(Uf,{isOpen:k,onClose:()=>z(!1),onSelectType:Xd,categoryId:$,categoryDishes:Array.isArray(Zt[$])?Zt[$]:[],onRedirectToPizzas:em,hasPizzaService:Nl,subscriberName:qs?.name||t?.full_name||""}),e.jsx(s0,{isOpen:!!ps,onClose:()=>ea(null),dish:ps,complementGroups:fs,onAddOption:Un,onToggleOption:Gn,onRemoveOption:Qn,onEditGroup:_=>{const I=ps.complement_groups?.find(te=>te.group_id===_.id);Zn({..._,is_required:I?.is_required||!1},ps?.id)},onRemoveGroup:_=>Kn(ps?.id,_),onAddGroup:()=>Hn(ps?.id),onReuseGroup:_=>Dr(ps?.id,_),onToggleRequired:_=>{const I=(ps.complement_groups||[]).map(te=>te.group_id===_?{...te,is_required:!te.is_required}:te);gs.mutate({id:ps.id,data:{complement_groups:I}})},onReorderGroups:_=>{gs.mutate({id:ps.id,data:{complement_groups:_}})},onCopyGroups:async _=>{for(const I of _){const te=fs.find(pe=>pe.id===I);if(te){const pe={name:`${te.name} (Cópia)`,is_required:te.is_required,max_selection:te.max_selection,options:te.options||[],order:fs.length},de=await kr.mutateAsync(pe);if(de&&ps){const we=[...ps.complement_groups||[],{group_id:de.id,is_required:!1}];gs.mutate({id:ps.id,data:{complement_groups:we}})}}}},onUpdateOptionName:Vn,onUpdateOptionPrice:Wn,onUpdateOptionImage:Bn,formatCurrency:ga}),e.jsx(Jf,{isOpen:Ga,onClose:()=>vt(!1),title:"Filtros",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Buscar"}),e.jsx(U,{placeholder:"Digite para buscar...",value:xe,onChange:_=>Ee(_.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Categoria"}),e.jsxs(Ce,{value:K,onValueChange:me,children:[e.jsx(ke,{children:e.jsx(Se,{placeholder:"Todas categorias"})}),e.jsxs(De,{children:[e.jsx(Q,{value:"all",children:"Todas categorias"}),Xe.map(_=>e.jsx(Q,{value:_.id,children:_.name},_.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Status"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["all","active","inactive"].map(_=>e.jsx("button",{onClick:()=>ds(_),className:`py-2 px-3 rounded-xl text-sm font-medium transition-colors ${Be===_?"bg-orange-500 text-white":"bg-gray-100 text-gray-700 active:bg-gray-200"}`,children:_==="all"?"Todos":_==="active"?"Ativos":"Inativos"},_))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Tipo"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{value:"all",label:"Todos"},{value:"highlight",label:"⭐ Destaques"},{value:"new",label:"✨ Novos"},{value:"popular",label:"🔥 Populares"}].map(_=>e.jsx("button",{onClick:()=>ie(_.value),className:`py-2 px-3 rounded-xl text-sm font-medium transition-colors ${ns===_.value?"bg-orange-500 text-white":"bg-gray-100 text-gray-700 active:bg-gray-200"}`,children:_.label},_.value))})]}),e.jsx(D,{onClick:()=>vt(!1),className:"w-full bg-orange-500 hover:bg-orange-600",children:"Aplicar Filtros"})]})})]}),e.jsx(Tm,{isOpen:c,onClose:()=>{m(!1),b(null)},onSubmit:rm,category:h,categoriesCount:Xe.length}),e.jsx(ze,{open:n,onOpenChange:l,children:e.jsxs(Te,{className:"sm:max-w-2xl max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Fe,{children:[e.jsx(Re,{children:j?"Editar Prato":"Adicionar Prato"}),e.jsx(Zr,{className:"sr-only",children:"Formulário para adicionar ou editar um prato do cardápio."})]}),e.jsxs("form",{onSubmit:sm,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Nome *"}),e.jsx(U,{value:C.name,onChange:_=>N(I=>({...I,name:_.target.value})),required:!0,className:"min-h-touch"})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Categoria *"}),e.jsxs(Ce,{value:C.category_id,onValueChange:_=>N(I=>({...I,category_id:_})),required:!0,children:[e.jsx(ke,{className:"min-h-touch",children:e.jsx(Se,{placeholder:"Selecione"})}),e.jsx(De,{children:Xe.map(_=>e.jsx(Q,{value:_.id,children:_.name},_.id))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Preço de (R$)"}),e.jsx(U,{type:"number",step:"0.01",value:C.original_price,onChange:_=>N(I=>({...I,original_price:_.target.value})),placeholder:"Preço original",className:"min-h-touch"})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Por (R$) *"}),e.jsx(U,{type:"number",step:"0.01",value:C.price,onChange:_=>N(I=>({...I,price:_.target.value})),required:!0,placeholder:"Preço atual",className:"min-h-touch"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Estoque"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{type:"number",value:C.stock,onChange:_=>N(I=>({...I,stock:_.target.value})),placeholder:"Ex: 10",disabled:C.stock==="",className:`min-h-touch ${C.stock===""?"bg-gray-100":""}`}),e.jsxs("div",{className:"flex items-center gap-1 whitespace-nowrap",children:[e.jsx(Le,{checked:C.stock==="",onCheckedChange:_=>N(I=>({...I,stock:_?"":"0"}))}),e.jsx("span",{className:"text-xs text-gray-600",children:"Ilimitado"})]})]})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Porção"}),e.jsx(U,{value:C.portion,onChange:_=>N(I=>({...I,portion:_.target.value})),placeholder:"Ex: 180g, 500ml",className:"min-h-touch"})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Tipo de Produto"}),e.jsx("div",{className:"flex gap-2 mt-2",children:e.jsx(fe,{variant:C.product_type==="preparado"?"default":"outline",className:"cursor-default",children:C.product_type==="preparado"?"🍳 Preparado":C.product_type==="industrializado"?"📦 Industrializado":"🍕 Pizza"})})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Descrição"}),e.jsx(Ms,{value:C.description,onChange:_=>N(I=>({...I,description:_.target.value})),rows:3,className:"min-h-[80px]"})]}),C.product_type!=="industrializado"&&e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Tempo de Preparo (minutos)"}),e.jsx(U,{type:"number",value:C.prep_time,onChange:_=>N(I=>({...I,prep_time:_.target.value})),placeholder:"Ex: 30",className:"min-h-touch"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:om.map(_=>e.jsx(fe,{variant:C.tags.includes(_)?"default":"outline",className:"cursor-pointer",onClick:()=>nm(_),children:cm[_]},_))})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Observações Internas (não visíveis ao cliente)"}),e.jsx(Ms,{value:C.internal_notes,onChange:_=>N(I=>({...I,internal_notes:_.target.value})),rows:3,placeholder:"Notas para a equipe...",className:"min-h-[80px]"})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Imagem"}),e.jsx(U,{type:"file",accept:"image/*",onChange:am,className:"min-h-touch"}),C.image&&e.jsx("img",{src:C.image,alt:"",className:"mt-2 w-20 h-20 sm:w-24 sm:h-24 object-cover rounded"})]}),e.jsxs("div",{className:"p-4 border-2 border-orange-300 dark:border-orange-700 rounded-lg bg-orange-50 dark:bg-orange-900/30 shadow-sm",children:[e.jsx(R,{htmlFor:"video_url",className:"text-base font-semibold mb-2 block text-orange-700 dark:text-orange-300",children:"🎥 Link do Vídeo (YouTube ou Vimeo)"}),e.jsx(U,{id:"video_url",type:"url",value:C.video_url||"",onChange:_=>N(I=>({...I,video_url:_.target.value})),placeholder:"Ex: https://www.youtube.com/watch?v=...",className:"w-full bg-white dark:bg-gray-800"}),e.jsx("p",{className:"text-xs text-orange-600 dark:text-orange-400 mt-2",children:"O vídeo aparece no cardápio ao clicar na imagem do prato."}),C.video_url&&e.jsxs("div",{className:"mt-3 flex items-center justify-between p-3 bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx(R,{htmlFor:"video_autoplay",className:"cursor-pointer text-sm font-medium",children:"Reprodução automática"}),e.jsx(Le,{id:"video_autoplay",checked:C.video_autoplay!==!1,onCheckedChange:_=>N(I=>({...I,video_autoplay:_}))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4 bg-gray-50 rounded min-h-touch",children:[e.jsx(R,{className:"text-sm font-medium",children:"⭐ Destaque"}),e.jsx(Le,{checked:C.is_highlight,onCheckedChange:_=>N(I=>({...I,is_highlight:_}))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4 bg-gray-50 rounded min-h-touch",children:[e.jsx(R,{className:"text-sm font-medium",children:"✨ Novo"}),e.jsx(Le,{checked:C.is_new,onCheckedChange:_=>N(I=>({...I,is_new:_}))})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4 bg-gray-50 rounded min-h-touch",children:[e.jsx(R,{className:"text-sm font-medium",children:"🔥 Mais Vendido"}),e.jsx(Le,{checked:C.is_popular,onCheckedChange:_=>N(I=>({...I,is_popular:_}))})]}),C.image&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(R,{children:"Visualização"}),e.jsx(D,{type:"button",variant:"outline",size:"sm",onClick:()=>je(!Ge),children:Ge?"Ocultar":"Ver como cliente"})]}),Ge&&e.jsx("div",{className:"border rounded-lg p-4 bg-gray-50",children:e.jsxs("div",{className:"max-w-sm mx-auto bg-white rounded-xl shadow-sm overflow-hidden",children:[e.jsx("img",{src:C.image,alt:C.name,className:"w-full h-48 object-cover"}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:C.name||"Nome do Prato"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:C.description||"Descrição..."}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xl font-bold text-orange-500",children:ga(parseFloat(C.price)||0)}),e.jsx(D,{size:"sm",className:"bg-orange-500",children:"Adicionar"})]})]})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[e.jsx(D,{type:"button",variant:"outline",onClick:Yn,className:"flex-1 min-h-touch",children:"Cancelar"}),e.jsx(D,{type:"submit",className:"flex-1 min-h-touch bg-orange-500",children:j?"Salvar":"Adicionar"})]})]})]})}),e.jsx(qf,{isOpen:G,onClose:()=>{q(!1),Me(null)},currentDish:ne?hs.find(_=>_.id===ne):null,onSelect:_=>{ne&&Dr(ne,_)},availableGroups:fs,allDishes:hs}),e.jsx(ze,{open:i,onOpenChange:o,children:e.jsxs(Te,{className:"sm:max-w-md max-w-[95vw]",children:[e.jsxs(Fe,{children:[e.jsx(Re,{children:"Configurações do Grupo"}),e.jsx(Zr,{className:"sr-only",children:"Configurações do grupo de complementos."})]}),g&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome do Grupo"}),e.jsx(U,{value:g.name,onChange:_=>T(I=>({...I,name:_.target.value}))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx(R,{className:"font-medium",children:"Obrigatório"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Cliente deve escolher este grupo"})]}),e.jsx(Le,{checked:g.is_required,onCheckedChange:_=>T(I=>({...I,is_required:_}))})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Máximo de Seleções"}),e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Quantas opções o cliente pode escolher"}),e.jsx(U,{type:"number",min:"1",value:g.max_selection||1,onChange:_=>T(I=>({...I,max_selection:parseInt(_.target.value)||1}))})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(D,{type:"button",variant:"outline",onClick:()=>o(!1),className:"flex-1",children:"Cancelar"}),e.jsx(D,{type:"button",onClick:tm,className:"flex-1 bg-orange-500",children:"Salvar"})]})]})]})}),e.jsx(Fm,{isOpen:X,onClose:()=>ge(!1),categories:Xe,dishes:hs,complementGroups:fs,onSave:_=>{_.categories.forEach(I=>{yt.mutate({id:I.id,data:I})}),_.dishes.forEach(I=>{gs.mutate({id:I.id,data:I})}),_.groups.forEach(I=>{Ts.mutate({id:I.id,data:I})}),Object.entries(_.groupOptions).forEach(([I,te])=>{const pe=fs.find(de=>de.id===I);pe&&Ts.mutate({id:I,data:{...pe,options:te}})}),W.success("Ordem atualizada com sucesso!"),ge(!1)}}),e.jsx(Gf,{isOpen:d,onClose:()=>p(!1),onUseTemplate:_=>{}}),v&&e.jsx(Vf,{isOpen:x,onClose:()=>{f(!1),y(null)},group:v,onUpdate:_=>{Ts.mutate({id:_.id,data:_})}})]}),Zd]})}var zn="Collapsible",[t0,Jc]=qo(zn),[r0,hl]=t0(zn),Xc=w.forwardRef((s,a)=>{const{__scopeCollapsible:t,open:r,defaultOpen:n,disabled:l,onOpenChange:c,...m}=s,[i,o]=Vi({prop:r,defaultProp:n??!1,onChange:c,caller:zn});return e.jsx(r0,{scope:t,disabled:l,contentId:Yo(),open:i,onOpenToggle:w.useCallback(()=>o(d=>!d),[o]),children:e.jsx(vr.div,{"data-state":pl(i),"data-disabled":l?"":void 0,...m,ref:a})})});Xc.displayName=zn;var ed="CollapsibleTrigger",sd=w.forwardRef((s,a)=>{const{__scopeCollapsible:t,...r}=s,n=hl(ed,t);return e.jsx(vr.button,{type:"button","aria-controls":n.contentId,"aria-expanded":n.open||!1,"data-state":pl(n.open),"data-disabled":n.disabled?"":void 0,disabled:n.disabled,...r,ref:a,onClick:Go(s.onClick,n.onOpenToggle)})});sd.displayName=ed;var xl="CollapsibleContent",ad=w.forwardRef((s,a)=>{const{forceMount:t,...r}=s,n=hl(xl,s.__scopeCollapsible);return e.jsx(Qm,{present:t||n.open,children:({present:l})=>e.jsx(n0,{...r,ref:a,present:l})})});ad.displayName=xl;var n0=w.forwardRef((s,a)=>{const{__scopeCollapsible:t,present:r,children:n,...l}=s,c=hl(xl,t),[m,i]=w.useState(r),o=w.useRef(null),d=yo(a,o),p=w.useRef(0),x=p.current,f=w.useRef(0),v=f.current,y=c.open||m,j=w.useRef(y),M=w.useRef(void 0);return w.useEffect(()=>{const k=requestAnimationFrame(()=>j.current=!1);return()=>cancelAnimationFrame(k)},[]),Jr(()=>{const k=o.current;if(k){M.current=M.current||{transitionDuration:k.style.transitionDuration,animationName:k.style.animationName},k.style.transitionDuration="0s",k.style.animationName="none";const z=k.getBoundingClientRect();p.current=z.height,f.current=z.width,j.current||(k.style.transitionDuration=M.current.transitionDuration,k.style.animationName=M.current.animationName),i(r)}},[c.open,r]),e.jsx(vr.div,{"data-state":pl(c.open),"data-disabled":c.disabled?"":void 0,id:c.contentId,hidden:!y,...l,ref:d,style:{"--radix-collapsible-content-height":x?`${x}px`:void 0,"--radix-collapsible-content-width":v?`${v}px`:void 0,...s.style},children:y&&n})});function pl(s){return s?"open":"closed"}var i0=Xc,l0=sd,o0=ad,Xs="Accordion",c0=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[gl,d0,m0]=Jm(Xs),[Tn]=qo(Xs,[m0,Jc]),fl=Jc(),td=se.forwardRef((s,a)=>{const{type:t,...r}=s,n=r,l=r;return e.jsx(gl.Provider,{scope:s.__scopeAccordion,children:t==="multiple"?e.jsx(p0,{...l,ref:a}):e.jsx(x0,{...n,ref:a})})});td.displayName=Xs;var[rd,u0]=Tn(Xs),[nd,h0]=Tn(Xs,{collapsible:!1}),x0=se.forwardRef((s,a)=>{const{value:t,defaultValue:r,onValueChange:n=()=>{},collapsible:l=!1,...c}=s,[m,i]=Vi({prop:t,defaultProp:r??"",onChange:n,caller:Xs});return e.jsx(rd,{scope:s.__scopeAccordion,value:se.useMemo(()=>m?[m]:[],[m]),onItemOpen:i,onItemClose:se.useCallback(()=>l&&i(""),[l,i]),children:e.jsx(nd,{scope:s.__scopeAccordion,collapsible:l,children:e.jsx(id,{...c,ref:a})})})}),p0=se.forwardRef((s,a)=>{const{value:t,defaultValue:r,onValueChange:n=()=>{},...l}=s,[c,m]=Vi({prop:t,defaultProp:r??[],onChange:n,caller:Xs}),i=se.useCallback(d=>m((p=[])=>[...p,d]),[m]),o=se.useCallback(d=>m((p=[])=>p.filter(x=>x!==d)),[m]);return e.jsx(rd,{scope:s.__scopeAccordion,value:c,onItemOpen:i,onItemClose:o,children:e.jsx(nd,{scope:s.__scopeAccordion,collapsible:!0,children:e.jsx(id,{...l,ref:a})})})}),[g0,Fn]=Tn(Xs),id=se.forwardRef((s,a)=>{const{__scopeAccordion:t,disabled:r,dir:n,orientation:l="vertical",...c}=s,m=se.useRef(null),i=yo(m,a),o=d0(t),p=Xm(n)==="ltr",x=Go(s.onKeyDown,f=>{if(!c0.includes(f.key))return;const v=f.target,y=o().filter(h=>!h.ref.current?.disabled),j=y.findIndex(h=>h.ref.current===v),M=y.length;if(j===-1)return;f.preventDefault();let k=j;const z=0,$=M-1,u=()=>{k=j+1,k>$&&(k=z)},g=()=>{k=j-1,k<z&&(k=$)};switch(f.key){case"Home":k=z;break;case"End":k=$;break;case"ArrowRight":l==="horizontal"&&(p?u():g());break;case"ArrowDown":l==="vertical"&&u();break;case"ArrowLeft":l==="horizontal"&&(p?g():u());break;case"ArrowUp":l==="vertical"&&g();break}const T=k%M;y[T].ref.current?.focus()});return e.jsx(g0,{scope:t,disabled:r,direction:n,orientation:l,children:e.jsx(gl.Slot,{scope:t,children:e.jsx(vr.div,{...c,"data-orientation":l,ref:i,onKeyDown:r?void 0:x})})})}),mn="AccordionItem",[f0,jl]=Tn(mn),ld=se.forwardRef((s,a)=>{const{__scopeAccordion:t,value:r,...n}=s,l=Fn(mn,t),c=u0(mn,t),m=fl(t),i=Yo(),o=r&&c.value.includes(r)||!1,d=l.disabled||s.disabled;return e.jsx(f0,{scope:t,open:o,disabled:d,triggerId:i,children:e.jsx(i0,{"data-orientation":l.orientation,"data-state":hd(o),...m,...n,ref:a,disabled:d,open:o,onOpenChange:p=>{p?c.onItemOpen(r):c.onItemClose(r)}})})});ld.displayName=mn;var od="AccordionHeader",cd=se.forwardRef((s,a)=>{const{__scopeAccordion:t,...r}=s,n=Fn(Xs,t),l=jl(od,t);return e.jsx(vr.h3,{"data-orientation":n.orientation,"data-state":hd(l.open),"data-disabled":l.disabled?"":void 0,...r,ref:a})});cd.displayName=od;var Ei="AccordionTrigger",dd=se.forwardRef((s,a)=>{const{__scopeAccordion:t,...r}=s,n=Fn(Xs,t),l=jl(Ei,t),c=h0(Ei,t),m=fl(t);return e.jsx(gl.ItemSlot,{scope:t,children:e.jsx(l0,{"aria-disabled":l.open&&!c.collapsible||void 0,"data-orientation":n.orientation,id:l.triggerId,...m,...r,ref:a})})});dd.displayName=Ei;var md="AccordionContent",ud=se.forwardRef((s,a)=>{const{__scopeAccordion:t,...r}=s,n=Fn(Xs,t),l=jl(md,t),c=fl(t);return e.jsx(o0,{role:"region","aria-labelledby":l.triggerId,"data-orientation":n.orientation,...c,...r,ref:a,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...s.style}})});ud.displayName=md;function hd(s){return s?"open":"closed"}var j0=td,v0=ld,y0=cd,xd=dd,pd=ud;const b0=j0,St=w.forwardRef(({className:s,...a},t)=>e.jsx(v0,{ref:t,className:He("border-b",s),...a}));St.displayName="AccordionItem";const Dt=w.forwardRef(({className:s,children:a,...t},r)=>e.jsx(y0,{className:"flex",children:e.jsxs(xd,{ref:r,className:He("flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline text-left [&[data-state=open]>svg]:rotate-180",s),...t,children:[a,e.jsx(Ra,{className:"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200"})]})}));Dt.displayName=xd.displayName;const Mt=w.forwardRef(({className:s,children:a,...t},r)=>e.jsx(pd,{ref:r,className:"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...t,children:e.jsx("div",{className:He("pb-4 pt-0",s),children:a})}));Mt.displayName=pd.displayName;function N0(){const s=es(),{menuContext:a}=Ze(),{data:t,isLoading:r}=Ae({queryKey:["store",a?.type,a?.value],queryFn:async()=>{if(!a)return null;const i={};return a.type==="subscriber"&&a.value&&(i.as_subscriber=a.value),(await _e.entities.Store.list(null,i))[0]},enabled:!!a}),[n,l]=w.useState(!0);se.useEffect(()=>{t!==void 0&&l(t?.enable_premium_pizza_visualization!==!1)},[t?.enable_premium_pizza_visualization]);const c=le({mutationFn:async i=>{if(!t?.id)throw new Error("Loja não encontrada");return await _e.entities.Store.update(t.id,{enable_premium_pizza_visualization:i})},onSuccess:()=>{s.invalidateQueries({queryKey:["store"]}),W.success("Configuração salva com sucesso!")},onError:i=>{W.error("Erro ao salvar configuração"),console.error(i)}}),m=i=>{l(i),c.mutate(i)};return r?e.jsx(B,{className:"border-2 border-gray-200 dark:border-gray-700",children:e.jsx(oe,{children:e.jsx(ce,{children:"Carregando..."})})}):e.jsxs(B,{className:"border-2 border-orange-500/20 dark:border-orange-500/30 bg-gradient-to-br from-white to-orange-50/30 dark:from-gray-900 dark:to-orange-950/20",children:[e.jsx(oe,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center shadow-lg",children:e.jsx(rr,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsxs(ce,{className:"text-xl flex items-center gap-2",children:["Visualização Premium de Pizza",n&&e.jsx(We.span,{animate:{rotate:[0,10,-10,0]},transition:{duration:2,repeat:1/0},children:"✨"})]}),e.jsx(rs,{className:"mt-1",children:"Ative animações épicas e efeitos especiais para impressionar seus clientes"})]})]})}),e.jsxs(H,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-xl bg-white/50 dark:bg-gray-800/50 border-2 border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(R,{htmlFor:"premium-mode",className:"text-base font-semibold cursor-pointer",children:"Modo Premium"}),e.jsx(To,{className:"w-4 h-4 text-gray-500"})]}),e.jsx(Le,{id:"premium-mode",checked:n,onCheckedChange:m,disabled:c.isPending})]}),e.jsx("div",{className:"p-4 rounded-xl bg-blue-50 dark:bg-blue-950/20 border-2 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(an,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-900 dark:text-blue-100 mb-1",children:"Imagem da Borda"}),e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:["Para adicionar imagem à borda, vá em ",e.jsx("strong",{children:"Pizza → Sabores e Bordas"})," e edite a borda desejada. Cada borda pode ter sua própria imagem que preencherá o círculo da borda na pizza."]})]})]})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:`p-4 rounded-xl border-2 transition-all ${n?"border-gray-300 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-900/50":"border-green-500 bg-green-50/50 dark:bg-green-950/20"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gray-500 flex items-center justify-center text-white text-sm",children:"🍕"}),e.jsx("h4",{className:"font-semibold",children:"Modo Normal"})]}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsx("span",{children:"Animações básicas"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsx("span",{children:"Carregamento mais rápido"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsx("span",{children:"Funcional e limpo"})]})]})]}),e.jsxs("div",{className:`p-4 rounded-xl border-2 transition-all ${n?"border-orange-500 bg-gradient-to-br from-orange-50 to-yellow-50 dark:from-orange-950/30 dark:to-yellow-950/20":"border-gray-300 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-900/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center text-white text-sm shadow-lg",children:"✨"}),e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:["Modo Premium",e.jsx(Es,{className:"w-4 h-4 text-yellow-500 fill-current"})]})]}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Xr,{className:"w-4 h-4 text-orange-500 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Ingredientes caindo"})," ao montar"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Au,{className:"w-4 h-4 text-orange-500 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Fumaça e vapor"})," na borda recheada"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(rr,{className:"w-4 h-4 text-yellow-500 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Sparkles e brilhos"})," animados"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Es,{className:"w-4 h-4 text-yellow-500 flex-shrink-0 mt-0.5 fill-current"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Efeito de forno"})," com calor radiante"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-orange-500 font-bold",children:"🎉"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Experiência premium"})," que vende mais"]})]})]})]})]}),e.jsx(We.div,{className:"p-4 rounded-xl bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-950/20 dark:to-purple-950/20 border-2 border-blue-200 dark:border-blue-800",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white flex-shrink-0",children:"💡"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-900 dark:text-white mb-1",children:"Dica de Especialista SaaS"}),e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Restaurantes que usam o ",e.jsx("strong",{children:"Modo Premium"})," reportam até ",e.jsx("strong",{className:"text-orange-600 dark:text-orange-400",children:"35% mais engajamento"})," dos clientes e ",e.jsx("strong",{className:"text-orange-600 dark:text-orange-400",children:"aumento de 20% no ticket médio"}),". As animações épicas criam uma experiência memorável que faz o cliente voltar!"]})]})]})}),e.jsx("div",{className:"flex justify-center pt-2",children:e.jsxs(D,{onClick:()=>window.open("/s/demo-pizzaria","_blank"),variant:"outline",className:"gap-2",children:[e.jsx(rr,{className:"w-4 h-4"}),"Ver Demo Interativa"]})})]})]})}const sr=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s||0);function w0(){const[s,a]=w.useState(null),[t,r]=w.useState(!1),[n,l]=w.useState(null),c=es(),{menuContext:m}=Ze();se.useEffect(()=>{(async()=>{try{const g=await _e.auth.me();a(g)}catch(g){console.error("Error loading user:",g)}})()},[]);const{data:i=[]}=Ht(),o=(i||[]).filter(u=>u.product_type==="pizza"),{data:d=[]}=Ae({queryKey:["pizzaSizes",m?.type,m?.value],queryFn:async()=>{if(!m)return[];const u={};return m.type==="subscriber"&&m.value&&(u.as_subscriber=m.value),_e.entities.PizzaSize.list("order",u)},enabled:!!m}),{data:p=[]}=Ae({queryKey:["pizzaFlavors",m?.type,m?.value],queryFn:async()=>{if(!m)return[];const u={};return m.type==="subscriber"&&m.value&&(u.as_subscriber=m.value),_e.entities.PizzaFlavor.list("order",u)},enabled:!!m}),{data:x=[]}=Ae({queryKey:["pizzaEdges",m?.type,m?.value],queryFn:async()=>{if(!m)return[];const u={};return m.type==="subscriber"&&m.value&&(u.as_subscriber=m.value),_e.entities.PizzaEdge.list("order",u)},enabled:!!m}),{data:f=[]}=Ae({queryKey:["pizzaExtras"],queryFn:()=>_e.entities.PizzaExtra.list("order")}),{data:v=[]}=Ae({queryKey:["categories"],queryFn:()=>_e.entities.Category.list("order")}),{data:y=[]}=Ae({queryKey:["pizzaCategories"],queryFn:()=>_e.entities.PizzaCategory.list("order")}),j=le({mutationFn:u=>_e.entities.Dish.create({...u,product_type:"pizza",subscriber_email:s?.subscriber_email||s?.email}),onSuccess:()=>{c.invalidateQueries({queryKey:["pizzas"]}),c.invalidateQueries({queryKey:["dishes"]}),W.success("Pizza criada!"),r(!1),l(null)}}),M=le({mutationFn:({id:u,data:g})=>_e.entities.Dish.update(u,g),onSuccess:()=>{c.invalidateQueries({queryKey:["pizzas"]}),c.invalidateQueries({queryKey:["dishes"]}),W.success("Pizza atualizada!"),r(!1),l(null)}}),k=le({mutationFn:u=>_e.entities.Dish.delete(u),onSuccess:()=>{c.invalidateQueries({queryKey:["pizzas"]}),c.invalidateQueries({queryKey:["dishes"]}),W.success("Pizza excluída!")}}),z=d.length>0&&p.length>0,$=(u=null)=>{l(u||null),r(!0)};return e.jsxs("div",{className:"space-y-4",children:[!z&&e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-xl p-4 flex items-start gap-3",children:[e.jsx(ft,{className:"w-5 h-5 text-orange-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-orange-900",children:"Configure os itens necessários primeiro"}),e.jsx("p",{className:"text-sm text-orange-700 mt-1",children:"Para criar pizzas, você precisa cadastrar pelo menos:"}),e.jsxs("ul",{className:"text-sm text-orange-700 mt-2 space-y-1",children:[d.length===0&&e.jsx("li",{children:"• 1 Tamanho na seção Tamanhos (à direita)"}),p.length===0&&e.jsx("li",{children:"• 1 Sabor na seção Sabores (à direita)"})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Minhas Pizzas"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Gerencie as pizzas do seu cardápio"})]}),e.jsxs(D,{onClick:()=>$(),className:"bg-orange-500",disabled:!z,children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Nova Pizza"]})]}),e.jsxs("div",{className:"space-y-6",children:[o.length>0&&(()=>{const u={},g=[...y||[]].sort((h,b)=>(h.order??999)-(b.order??999));return g.forEach(h=>{u[h.id]={category:h,pizzas:[]}}),u._sem_categoria={category:{name:"Sem categoria",id:"_sem_categoria"},pizzas:[]},o.forEach(h=>{const b=h.pizza_category_id||"_sem_categoria";u[b]||(u[b]={category:{name:"Outros",id:b},pizzas:[]}),u[b].pizzas.push(h)}),g.map(h=>u[h.id]).filter(Boolean).concat(u._sem_categoria.pizzas.length>0?[u._sem_categoria]:[]).map(({category:h,pizzas:b})=>e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-600 dark:text-gray-400 mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-1 h-4 rounded bg-orange-500"}),h.name,e.jsx(fe,{variant:"secondary",className:"text-xs",children:b.length})]}),e.jsx("div",{className:"grid gap-4",children:b.map(L=>e.jsx("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-xl border dark:border-gray-700",children:e.jsxs("div",{className:"flex items-start gap-4",children:[L.image&&e.jsx("img",{src:L.image,alt:L.name,className:"w-24 h-24 rounded-lg object-cover"}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:L.name}),L.description&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:L.description}),L.pizza_config?.sizes&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:L.pizza_config.sizes.map(O=>e.jsxs(fe,{variant:"outline",className:"text-xs",children:[O.name,": ",sr(O.price_tradicional)]},O.id))}),L.is_highlight&&e.jsx(fe,{className:"mt-2 bg-yellow-100 text-yellow-700",children:"⭐ Destaque"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{checked:L.is_active!==!1,onCheckedChange:O=>M.mutate({id:L.id,data:{is_active:O}})}),e.jsx(D,{variant:"ghost",size:"icon",onClick:()=>$(L),children:e.jsx(Rs,{className:"w-4 h-4"})}),e.jsx(D,{variant:"ghost",size:"icon",onClick:()=>{confirm("Excluir esta pizza?")&&k.mutate(L.id)},className:"text-red-500",children:e.jsx(Ke,{className:"w-4 h-4"})})]})]})})]})},L.id))})]},h.id))})(),o.length===0&&z&&e.jsxs("div",{className:"text-center py-12 text-gray-400",children:[e.jsx("p",{children:"Nenhuma pizza cadastrada ainda"}),e.jsx("p",{className:"text-sm mt-1",children:'Clique em "Nova Pizza" para começar'})]})]}),e.jsx(_0,{isOpen:t,onClose:()=>{r(!1),l(null)},onSubmit:u=>{n?M.mutate({id:n.id,data:u}):j.mutate(u)},pizza:n,sizes:d,flavors:p,edges:x,extras:f,categories:v,pizzaCategories:y})]})}function _0({isOpen:s,onClose:a,onSubmit:t,pizza:r,sizes:n,flavors:l,edges:c,extras:m,categories:i,pizzaCategories:o=[]}){const[d,p]=w.useState(null),[x,f]=w.useState({name:"",description:"",image:"",category_id:"",pizza_category_id:"",default_flavor_id:"",division_mode:"slices",is_highlight:!1,is_active:!0,is_new:!1,is_popular:!1,pizza_config:{sizes:[],flavor_ids:[],edges:[],extras:[]}});se.useEffect(()=>{if(r){const u=l.find(g=>g.id===r.default_flavor_id);p(u),f({name:r.name||"",description:r.description||"",image:r.image||"",category_id:r.category_id||"",pizza_category_id:r.pizza_category_id||"",default_flavor_id:r.default_flavor_id||"",division_mode:r.division_mode||"slices",is_highlight:r.is_highlight||!1,is_active:r.is_active!==!1,is_new:r.is_new||!1,is_popular:r.is_popular||!1,pizza_config:r.pizza_config||{sizes:[],flavor_ids:[],edges:[],extras:[]}})}else p(null),f({name:"",description:"",image:"",category_id:i[0]?.id||"",pizza_category_id:o[0]?.id||"",default_flavor_id:"",division_mode:"slices",is_highlight:!1,is_active:!0,is_new:!1,is_popular:!1,pizza_config:{sizes:n.map(u=>({id:u.id,name:u.name,slices:u.slices,max_flavors:u.max_flavors,price_tradicional:u.price_tradicional,price_premium:u.price_premium})),flavor_ids:l.filter(u=>u.is_active!==!1).map(u=>u.id),edges:c.filter(u=>u.is_active!==!1).map(u=>({id:u.id,name:u.name,price:u.price,is_active:u.is_active,is_popular:u.is_popular})),extras:m.filter(u=>u.is_active!==!1).map(u=>({id:u.id,name:u.name,price:u.price,is_active:u.is_active}))}})},[r,s,n,l,c,m,i,o]);const v=u=>{p(u),f(g=>({...g,name:`Pizza ${u.name}`,default_flavor_id:u.id,image:u.image||g.image,description:u.description||g.description}))},y=async u=>{const g=u.target.files?.[0];if(g)try{const{uploadToCloudinary:T}=await tt(async()=>{const{uploadToCloudinary:b}=await import("./cloudinaryUpload-C4sUQLHO.js");return{uploadToCloudinary:b}},__vite__mapDeps([0,1,2])),h=await T(g,"dishes");if(!h){W.error("Erro ao obter URL da imagem");return}f(b=>({...b,image:h}))}catch(T){console.error(T),W.error("Falha ao enviar imagem")}},j=u=>{if(u.preventDefault(),!d&&!r){W.error("Selecione o sabor base da pizza");return}if(!x.pizza_config.sizes||x.pizza_config.sizes.length===0){W.error("Selecione pelo menos um tamanho");return}if(!x.pizza_config.flavor_ids||x.pizza_config.flavor_ids.length===0){W.error("Selecione pelo menos um sabor");return}const g={...x};if(o.length>0&&g.pizza_category_id&&!g.category_id){const T=i.find(h=>h.name?.toLowerCase().includes("pizza"))||i[0];g.category_id=T?.id||""}t(g)},M=u=>{const g=x.pizza_config.sizes||[],T=g.find(h=>h.id===u.id);f(T?h=>({...h,pizza_config:{...h.pizza_config,sizes:g.filter(b=>b.id!==u.id)}}):h=>({...h,pizza_config:{...h.pizza_config,sizes:[...g,{id:u.id,name:u.name,slices:u.slices,max_flavors:u.max_flavors,price_tradicional:u.price_tradicional,price_premium:u.price_premium}]}}))},k=u=>{const g=x.pizza_config.flavor_ids||[];g.includes(u)?f(T=>({...T,pizza_config:{...T.pizza_config,flavor_ids:g.filter(h=>h!==u)}})):f(T=>({...T,pizza_config:{...T.pizza_config,flavor_ids:[...g,u]}}))},z=u=>{const g=x.pizza_config.edges||[],T=g.find(h=>h.id===u.id);f(T?h=>({...h,pizza_config:{...h.pizza_config,edges:g.filter(b=>b.id!==u.id)}}):h=>({...h,pizza_config:{...h.pizza_config,edges:[...g,{id:u.id,name:u.name,price:u.price,is_active:u.is_active,is_popular:u.is_popular}]}}))},$=u=>{const g=x.pizza_config.extras||[],T=g.find(h=>h.id===u.id);f(T?h=>({...h,pizza_config:{...h.pizza_config,extras:g.filter(b=>b.id!==u.id)}}):h=>({...h,pizza_config:{...h.pizza_config,extras:[...g,{id:u.id,name:u.name,price:u.price,is_active:u.is_active}]}}))};return e.jsx(ze,{open:s,onOpenChange:a,children:e.jsxs(Te,{className:"sm:max-w-3xl max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsx(Fe,{children:e.jsxs(Re,{children:[r?"Editar":"Nova"," Pizza"]})}),e.jsxs("form",{onSubmit:j,className:"space-y-6",children:[!r&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-1 text-gray-900 dark:text-gray-100",children:"Sabor Padrão da Pizza *"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-3",children:"Escolha qual sabor será o base desta pizza"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:"🍕 Tradicionais"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:l.filter(u=>u.category==="tradicional"&&u.is_active).map(u=>e.jsx("button",{type:"button",onClick:()=>v(u),className:`p-3 rounded-lg border-2 text-left transition-all ${d?.id===u.id?"border-orange-500 bg-orange-50 dark:bg-orange-900/30 dark:border-orange-400":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 bg-white dark:bg-gray-800"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[u.image&&e.jsx("img",{src:u.image,alt:u.name,className:"w-12 h-12 rounded object-cover"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:u.name}),d?.id===u.id&&e.jsx(fe,{className:"text-xs mt-1 bg-orange-500 dark:bg-orange-600",children:"Selecionado"})]})]})},u.id))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:"⭐ Premium"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:l.filter(u=>u.category==="premium"&&u.is_active).map(u=>e.jsx("button",{type:"button",onClick:()=>v(u),className:`p-3 rounded-lg border-2 text-left transition-all ${d?.id===u.id?"border-orange-500 bg-orange-50 dark:bg-orange-900/30 dark:border-orange-400":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 bg-white dark:bg-gray-800"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[u.image&&e.jsx("img",{src:u.image,alt:u.name,className:"w-12 h-12 rounded object-cover"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:u.name}),d?.id===u.id&&e.jsx(fe,{className:"text-xs mt-1 bg-orange-500 dark:bg-orange-600",children:"Selecionado"})]})]})},u.id))})]})]}),d&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Informações da Pizza"}),e.jsx("div",{className:"bg-orange-50 dark:bg-orange-900/30 border border-orange-200 dark:border-orange-800 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-orange-800 dark:text-orange-200",children:["✓ Sabor base: ",e.jsx("strong",{children:d.name})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Categoria *"}),e.jsxs(Ce,{value:o.length>0?x.pizza_category_id||"":x.category_id||"",onValueChange:u=>f(g=>o.length>0?{...g,pizza_category_id:u}:{...g,category_id:u}),children:[e.jsx(ke,{children:e.jsx(Se,{placeholder:o.length?"Ex: Pizza M 1 sabor":"Selecione"})}),e.jsx(De,{children:o.length>0?o.map(u=>{const g=n.find(h=>h.id===u.size_id),T=u.name||(g?`${g.name} • ${u.max_flavors||1} sabor(es)`:u.id);return e.jsx(Q,{value:u.id,children:T},u.id)}):i.map(u=>e.jsx(Q,{value:u.id,children:u.name},u.id))})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:o.length?"Por tamanho e quantidade de sabores (Configuração > Categorias)":"Sem categorias de pizza. Crie em Configuração > Categorias"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Modo de Divisão *"}),e.jsxs(Ce,{value:x.division_mode,onValueChange:u=>f(g=>({...g,division_mode:u})),children:[e.jsx(ke,{children:e.jsx(Se,{})}),e.jsxs(De,{children:[e.jsx(Q,{value:"slices",children:"🔧 Por Fatias (Livre)"}),e.jsx(Q,{value:"exact",children:"⚖️ Divisão Exata (Automática)"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:x.division_mode==="slices"?"Cliente escolhe quantas fatias de cada sabor":"Divisão automática igual entre sabores"})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Descrição (opcional)"}),e.jsx(Ms,{value:x.description,onChange:u=>f(g=>({...g,description:u.target.value})),placeholder:"Personalize a descrição...",rows:2})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Imagem (opcional)"}),e.jsx(U,{type:"file",accept:"image/*",onChange:y}),x.image&&e.jsx("img",{src:x.image,alt:"",className:"mt-2 w-20 h-20 object-cover rounded"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Se não enviar, será usada a imagem do sabor base"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded",children:[e.jsx(R,{className:"text-gray-900 dark:text-gray-100",children:"⭐ Destaque"}),e.jsx(Le,{checked:x.is_highlight,onCheckedChange:u=>f(g=>({...g,is_highlight:u}))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded",children:[e.jsx(R,{className:"text-gray-900 dark:text-gray-100",children:"✨ Novo"}),e.jsx(Le,{checked:x.is_new,onCheckedChange:u=>f(g=>({...g,is_new:u}))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded",children:[e.jsx(R,{className:"text-gray-900 dark:text-gray-100",children:"🔥 Popular"}),e.jsx(Le,{checked:x.is_popular,onCheckedChange:u=>f(g=>({...g,is_popular:u}))})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Tamanhos Disponíveis *"}),e.jsx("div",{className:"grid gap-2",children:n.map(u=>{const g=x.pizza_config.sizes?.some(T=>T.id===u.id);return e.jsxs("label",{className:`flex items-center justify-between p-3 rounded-lg border-2 cursor-pointer transition-all ${g?"border-orange-500 bg-orange-50 dark:bg-orange-900/30 dark:border-orange-400":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 bg-white dark:bg-gray-800"}`,onClick:()=>M(u),children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:u.name}),e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:[u.slices," fatias • Até ",u.max_flavors," sabores"]})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-green-600 dark:text-green-400 font-semibold",children:sr(u.price_tradicional)}),e.jsx("p",{className:"text-orange-600 dark:text-orange-400 font-semibold",children:sr(u.price_premium)})]})]},u.id)})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Sabores Disponíveis *"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:l.map(u=>{const g=x.pizza_config.flavor_ids?.includes(u.id);return e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all ${g?"border-orange-500 bg-orange-50 dark:bg-orange-900/30 dark:border-orange-400":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 bg-white dark:bg-gray-800"}`,onClick:()=>k(u.id),children:[u.image&&e.jsx("img",{src:u.image,alt:u.name,className:"w-12 h-12 rounded object-cover"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:u.name}),e.jsx(fe,{variant:"outline",className:"text-xs mt-1 dark:border-gray-600 dark:text-gray-300",children:u.category==="premium"?"⭐ Premium":"🍕 Tradicional"})]})]},u.id)})})]}),c.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Bordas Disponíveis (opcional)"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:c.map(u=>{const g=x.pizza_config.edges?.some(T=>T.id===u.id);return e.jsxs("label",{className:`flex items-center justify-between p-3 rounded-lg border-2 cursor-pointer transition-all ${g?"border-orange-500 bg-orange-50 dark:bg-orange-900/30 dark:border-orange-400":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 bg-white dark:bg-gray-800"}`,onClick:()=>z(u),children:[e.jsx("p",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:u.name}),e.jsx("p",{className:"text-sm text-orange-600 dark:text-orange-400 font-semibold",children:sr(u.price)})]},u.id)})})]}),m.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Extras Disponíveis (opcional)"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:m.map(u=>{const g=x.pizza_config.extras?.some(T=>T.id===u.id);return e.jsxs("label",{className:`flex items-center justify-between p-3 rounded-lg border-2 cursor-pointer transition-all ${g?"border-orange-500 bg-orange-50 dark:bg-orange-900/30 dark:border-orange-400":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 bg-white dark:bg-gray-800"}`,onClick:()=>$(u),children:[e.jsx("p",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:u.name}),e.jsx("p",{className:"text-sm text-orange-600 dark:text-orange-400 font-semibold",children:sr(u.price)})]},u.id)})})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(D,{type:"button",variant:"outline",onClick:a,className:"flex-1 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700",children:"Cancelar"}),e.jsx(D,{type:"submit",className:"flex-1 bg-orange-500 hover:bg-orange-600 dark:bg-orange-600 dark:hover:bg-orange-700 text-white",children:r?"Salvar":"Criar Pizza"})]})]})]})})}const ui=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s||0);function ty(){const[s,a]=se.useState(null),[t,r]=w.useState("pizzas"),[n,l]=w.useState(""),[c,m]=w.useState(!1),[i,o]=w.useState(!1),[d,p]=w.useState(!1),[x,f]=w.useState(!1),[v,y]=w.useState(!1),[j,M]=w.useState(null),[k,z]=w.useState(null),[$,u]=w.useState(null),[g,T]=w.useState(null),[h,b]=w.useState(null),L=es(),{menuContext:O}=Ze();se.useEffect(()=>{(async()=>{try{const me=await _e.auth.me();a(me)}catch(me){console.error("Error loading user:",me)}})()},[]);const{data:P=[]}=Ae({queryKey:["pizzaSizes",O?.type,O?.value],queryFn:async()=>{if(!O)return[];const K={};return O.type==="subscriber"&&O.value&&(K.as_subscriber=O.value),_e.entities.PizzaSize.list("order",K)},enabled:!!O}),{data:F=[]}=Ae({queryKey:["pizzaFlavors",O?.type,O?.value],queryFn:async()=>{if(!O)return[];const K={};return O.type==="subscriber"&&O.value&&(K.as_subscriber=O.value),_e.entities.PizzaFlavor.list("order",K)},enabled:!!O}),{data:C=[]}=Ae({queryKey:["pizzaEdges",O?.type,O?.value],queryFn:async()=>{if(!O)return[];const K={};return O.type==="subscriber"&&O.value&&(K.as_subscriber=O.value),_e.entities.PizzaEdge.list("order",K)},enabled:!!O}),{data:N=[]}=Ae({queryKey:["pizzaExtras",O?.type,O?.value],queryFn:async()=>{if(!O)return[];const K={};return O.type==="subscriber"&&O.value&&(K.as_subscriber=O.value),_e.entities.PizzaExtra.list("order",K)},enabled:!!O}),{data:V=[]}=Ae({queryKey:["pizzaCategories",O?.type,O?.value],queryFn:async()=>{if(!O)return[];const K={};return O.type==="subscriber"&&O.value&&(K.as_subscriber=O.value),_e.entities.PizzaCategory.list("order",K)},enabled:!!O}),E=le({mutationFn:K=>_e.entities.PizzaSize.create({...K,subscriber_email:s?.subscriber_email||s?.email}),onSuccess:()=>{L.invalidateQueries({queryKey:["pizzaSizes"]}),W.success("Tamanho criado!"),m(!1),M(null)}}),ee=le({mutationFn:({id:K,data:me})=>_e.entities.PizzaSize.update(K,me),onSuccess:()=>{L.invalidateQueries({queryKey:["pizzaSizes"]}),W.success("Tamanho atualizado!"),m(!1),M(null)}}),ue=le({mutationFn:K=>_e.entities.PizzaSize.delete(K),onSuccess:()=>{L.invalidateQueries({queryKey:["pizzaSizes"]}),W.success("Tamanho excluído!")}}),Z=le({mutationFn:K=>_e.entities.PizzaFlavor.create({...K,subscriber_email:s?.subscriber_email||s?.email}),onSuccess:()=>{L.invalidateQueries({queryKey:["pizzaFlavors"]}),W.success("Sabor criado!"),o(!1),z(null)}}),S=le({mutationFn:({id:K,data:me})=>_e.entities.PizzaFlavor.update(K,me),onSuccess:()=>{L.invalidateQueries({queryKey:["pizzaFlavors"]}),W.success("Sabor atualizado!"),o(!1),z(null)}}),G=le({mutationFn:K=>_e.entities.PizzaFlavor.delete(K),onSuccess:()=>{L.invalidateQueries({queryKey:["pizzaFlavors"]}),W.success("Sabor excluído!")}}),q=le({mutationFn:K=>_e.entities.PizzaEdge.create({...K,subscriber_email:s?.subscriber_email||s?.email}),onSuccess:()=>{L.invalidateQueries({queryKey:["pizzaEdges"]}),W.success("Borda criada!"),p(!1),u(null)}}),ne=le({mutationFn:({id:K,data:me})=>_e.entities.PizzaEdge.update(K,me),onSuccess:()=>{L.invalidateQueries({queryKey:["pizzaEdges"]}),W.success("Borda atualizada!"),p(!1),u(null)}}),Me=le({mutationFn:K=>_e.entities.PizzaEdge.delete(K),onSuccess:()=>{L.invalidateQueries({queryKey:["pizzaEdges"]}),W.success("Borda excluída!")}}),Y=le({mutationFn:K=>_e.entities.PizzaExtra.create({...K,subscriber_email:s?.subscriber_email||s?.email}),onSuccess:()=>{L.invalidateQueries({queryKey:["pizzaExtras"]}),W.success("Extra criado!"),f(!1),T(null)}}),A=le({mutationFn:({id:K,data:me})=>_e.entities.PizzaExtra.update(K,me),onSuccess:()=>{L.invalidateQueries({queryKey:["pizzaExtras"]}),W.success("Extra atualizado!"),f(!1),T(null)}}),X=le({mutationFn:K=>_e.entities.PizzaExtra.delete(K),onSuccess:()=>{L.invalidateQueries({queryKey:["pizzaExtras"]}),W.success("Extra excluído!")}}),ge=le({mutationFn:K=>_e.entities.PizzaCategory.create({...K,subscriber_email:s?.subscriber_email||s?.email}),onSuccess:()=>{L.invalidateQueries({queryKey:["pizzaCategories"]}),W.success("Categoria criada!"),y(!1),b(null)}}),xe=le({mutationFn:({id:K,data:me})=>_e.entities.PizzaCategory.update(K,me),onSuccess:()=>{L.invalidateQueries({queryKey:["pizzaCategories"]}),W.success("Categoria atualizada!"),y(!1),b(null)}}),Ee=le({mutationFn:K=>_e.entities.PizzaCategory.delete(K),onSuccess:()=>{L.invalidateQueries({queryKey:["pizzaCategories"]}),W.success("Categoria excluída!")}});return e.jsxs("div",{className:"p-6",children:[e.jsx(Hr,{position:"top-center"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Configuração de Pizzas"}),e.jsx("p",{className:"text-gray-600",children:"Gerencie tamanhos, sabores, bordas e extras para suas pizzas"})]}),e.jsxs(Yi,{value:t,onValueChange:r,children:[e.jsxs(Gi,{className:"grid grid-cols-2 w-full max-w-xs",children:[e.jsx(ta,{value:"pizzas",children:"Minhas Pizzas"}),e.jsxs(ta,{value:"visual",children:[e.jsx(ct,{className:"w-4 h-4 mr-1"}),"Visual"]})]}),e.jsx(ra,{value:"pizzas",className:"mt-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1fr_300px] gap-4",children:[e.jsx(w0,{}),e.jsxs(B,{className:"p-4 h-fit",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Configuração"}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Tamanhos, sabores, bordas e extras"}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"relative",children:[e.jsx(_s,{className:"absolute left-2 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(U,{placeholder:"Buscar sabores, bordas ou extras...",value:n,onChange:K=>{l(K.target.value)},className:"pl-8 text-sm"})]})}),e.jsxs(b0,{type:"multiple",defaultValue:["categories","sizes","flavors"],className:"w-full",children:[e.jsxs(St,{value:"categories",className:"border rounded-lg px-2",children:[e.jsxs(Dt,{className:"py-2 text-sm font-medium hover:no-underline",children:["Categorias (",V.length,") — como em Pratos"]}),e.jsxs(Mt,{className:"pb-2",children:[e.jsx("p",{className:"text-[10px] text-gray-500 mb-2",children:"Ex: Pizza M 1 sabor, Pizza G 2 sabores. Separam pizzas no cardápio. Reordene com as setas."}),e.jsxs(D,{size:"sm",onClick:()=>{b(null),y(!0)},className:"mb-2 w-full",children:[e.jsx(Ie,{className:"w-3 h-3 mr-1"}),"Nova Categoria"]}),e.jsx("div",{className:"space-y-1",children:V.map((K,me)=>{const Be=P.find(ns=>ns.id===K.size_id),ds=ns=>{const ie=ns==="up"?me-1:me+1;if(ie<0||ie>=V.length)return;const Ge=V[me],je=V[ie];xe.mutate({id:Ge.id,data:{...Ge,order:ie}}),xe.mutate({id:je.id,data:{...je,order:me}})};return e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded border text-xs group",children:[e.jsxs("div",{className:"flex flex-col opacity-60 group-hover:opacity-100",children:[e.jsx("button",{type:"button",onClick:()=>ds("up"),disabled:me===0,className:"p-0.5 disabled:opacity-30",children:e.jsx(zt,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:()=>ds("down"),disabled:me===V.length-1,className:"p-0.5 disabled:opacity-30",children:e.jsx(Ra,{className:"w-4 h-4"})})]}),e.jsxs("span",{className:"flex-1 truncate",children:[K.name||"Sem nome"," ",Be&&`(${Be.name} • ${K.max_flavors||1} sabor${(K.max_flavors||1)>1?"es":""})`]}),e.jsx(D,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>{b(K),y(!0)},children:e.jsx(Rs,{className:"w-3 h-3"})}),e.jsx(D,{variant:"ghost",size:"icon",className:"h-6 w-6 text-red-500",onClick:()=>{confirm("Excluir?")&&Ee.mutate(K.id)},children:e.jsx(Ke,{className:"w-3 h-3"})})]},K.id)})})]})]}),e.jsxs(St,{value:"sizes",className:"border rounded-lg px-2",children:[e.jsxs(Dt,{className:"py-2 text-sm font-medium hover:no-underline",children:["Tamanhos (",P.length,")"]}),e.jsxs(Mt,{className:"pb-2",children:[e.jsx("p",{className:"text-[10px] text-gray-500 mb-2",children:"Base: P, M, G com preço e fatias. Usados pelas categorias."}),e.jsxs(D,{size:"sm",onClick:()=>{M(null),m(!0)},className:"mb-2 w-full",children:[e.jsx(Ie,{className:"w-3 h-3 mr-1"}),"Novo Tamanho"]}),e.jsx("div",{className:"space-y-1",children:P.map(K=>e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded border text-xs",children:[e.jsxs("span",{className:"flex-1 truncate",children:[K.name," • ",K.slices,"f • ",ui(K.price_tradicional)]}),e.jsx(Le,{checked:K.is_active,onCheckedChange:me=>ee.mutate({id:K.id,data:{...K,is_active:me}}),className:"scale-75"}),e.jsx(D,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>{M(K),m(!0)},children:e.jsx(Rs,{className:"w-3 h-3"})}),e.jsx(D,{variant:"ghost",size:"icon",className:"h-6 w-6 text-red-500",onClick:()=>{confirm("Excluir?")&&ue.mutate(K.id)},children:e.jsx(Ke,{className:"w-3 h-3"})})]},K.id))})]})]}),e.jsxs(St,{value:"flavors",className:"border rounded-lg px-2",children:[e.jsxs(Dt,{className:"py-2 text-sm font-medium hover:no-underline",children:["Sabores (",F.length,")"]}),e.jsxs(Mt,{className:"pb-2",children:[e.jsxs(D,{size:"sm",onClick:()=>{z(null),o(!0)},className:"mb-2 w-full",children:[e.jsx(Ie,{className:"w-3 h-3 mr-1"}),"Novo"]}),e.jsx("div",{className:"space-y-1",children:F.map(K=>e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded border text-xs",children:[K.image&&e.jsx("img",{src:K.image,alt:"",className:"w-8 h-8 rounded object-cover flex-shrink-0"}),e.jsx("span",{className:"flex-1 truncate",children:K.name}),e.jsx(fe,{variant:"outline",className:"text-[10px]",children:K.category==="premium"?"⭐":"🍕"}),e.jsx(Le,{checked:K.is_active,onCheckedChange:me=>S.mutate({id:K.id,data:{...K,is_active:me}}),className:"scale-75"}),e.jsx(D,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>{z(K),o(!0)},children:e.jsx(Rs,{className:"w-3 h-3"})}),e.jsx(D,{variant:"ghost",size:"icon",className:"h-6 w-6 text-red-500",onClick:()=>{confirm("Excluir?")&&G.mutate(K.id)},children:e.jsx(Ke,{className:"w-3 h-3"})})]},K.id))})]})]}),e.jsxs(St,{value:"edges",className:"border rounded-lg px-2",children:[e.jsxs(Dt,{className:"py-2 text-sm font-medium hover:no-underline",children:["Bordas (",C.length,")"]}),e.jsxs(Mt,{className:"pb-2",children:[e.jsxs(D,{size:"sm",onClick:()=>{u(null),p(!0)},className:"mb-2 w-full",children:[e.jsx(Ie,{className:"w-3 h-3 mr-1"}),"Nova"]}),e.jsx("div",{className:"space-y-1",children:C.map(K=>e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded border text-xs",children:[K.image&&e.jsx("img",{src:K.image,alt:"",className:"w-8 h-8 rounded object-cover flex-shrink-0"}),e.jsxs("span",{className:"flex-1 truncate",children:[K.name," ",ui(K.price)]}),e.jsx(Le,{checked:K.is_active,onCheckedChange:me=>ne.mutate({id:K.id,data:{...K,is_active:me}}),className:"scale-75"}),e.jsx(D,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>{u(K),p(!0)},children:e.jsx(Rs,{className:"w-3 h-3"})}),e.jsx(D,{variant:"ghost",size:"icon",className:"h-6 w-6 text-red-500",onClick:()=>{confirm("Excluir?")&&Me.mutate(K.id)},children:e.jsx(Ke,{className:"w-3 h-3"})})]},K.id))})]})]}),e.jsxs(St,{value:"extras",className:"border rounded-lg px-2",children:[e.jsxs(Dt,{className:"py-2 text-sm font-medium hover:no-underline",children:["Extras (",N.length,")"]}),e.jsxs(Mt,{className:"pb-2",children:[e.jsxs(D,{size:"sm",onClick:()=>{T(null),f(!0)},className:"mb-2 w-full",children:[e.jsx(Ie,{className:"w-3 h-3 mr-1"}),"Novo"]}),e.jsx("div",{className:"space-y-1 max-h-96 overflow-y-auto",children:(n&&searchType==="extras"?filteredExtras:N).map(K=>e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded border text-xs",children:[K.image&&e.jsx("img",{src:K.image,alt:"",className:"w-8 h-8 rounded object-cover flex-shrink-0"}),e.jsxs("span",{className:"flex-1 truncate",children:[K.name," ",ui(K.price)]}),e.jsx(Le,{checked:K.is_active,onCheckedChange:me=>A.mutate({id:K.id,data:{...K,is_active:me}}),className:"scale-75"}),e.jsx(D,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>{T(K),f(!0)},children:e.jsx(Rs,{className:"w-3 h-3"})}),e.jsx(D,{variant:"ghost",size:"icon",className:"h-6 w-6 text-red-500",onClick:()=>{confirm("Excluir?")&&X.mutate(K.id)},children:e.jsx(Ke,{className:"w-3 h-3"})})]},K.id))})]})]})]})]})]})}),e.jsx(ra,{value:"visual",className:"mt-4",children:e.jsx(N0,{})})]}),e.jsx(C0,{isOpen:c,onClose:()=>{m(!1),M(null)},onSubmit:K=>{j?ee.mutate({id:j.id,data:K}):E.mutate({...K,order:P.length})},size:j}),e.jsx(k0,{isOpen:i,onClose:()=>{o(!1),z(null)},onSubmit:K=>{k?S.mutate({id:k.id,data:K}):Z.mutate({...K,order:F.length})},flavor:k}),e.jsx(S0,{isOpen:d,onClose:()=>{p(!1),u(null)},onSubmit:K=>{$?ne.mutate({id:$.id,data:K}):q.mutate({...K,order:C.length})},edge:$}),e.jsx(D0,{isOpen:x,onClose:()=>{f(!1),T(null)},onSubmit:K=>{g?A.mutate({id:g.id,data:K}):Y.mutate({...K,order:N.length})},extra:g}),e.jsx(M0,{isOpen:v,onClose:()=>{y(!1),b(null)},onSubmit:K=>{h?xe.mutate({id:h.id,data:K}):ge.mutate({...K,order:V.length})},category:h,sizes:P})]})}function C0({isOpen:s,onClose:a,onSubmit:t,size:r}){const[n,l]=w.useState({name:"",slices:"",max_flavors:"",max_extras:"3",diameter_cm:"",price_tradicional:"",price_premium:"",is_active:!0});se.useEffect(()=>{l(r?{name:r.name||"",slices:r.slices?.toString()||"",max_flavors:r.max_flavors?.toString()||"",max_extras:r.max_extras?.toString()||"3",diameter_cm:r.diameter_cm?.toString()||"",price_tradicional:r.price_tradicional?.toString()||"",price_premium:r.price_premium?.toString()||"",is_active:r.is_active!==!1}:{name:"",slices:"",max_flavors:"",max_extras:"3",diameter_cm:"",price_tradicional:"",price_premium:"",is_active:!0})},[r,s]);const c=m=>{m.preventDefault(),t({...n,slices:parseInt(n.slices),max_flavors:parseInt(n.max_flavors),max_extras:parseInt(n.max_extras)||3,diameter_cm:parseFloat(n.diameter_cm),price_tradicional:parseFloat(n.price_tradicional),price_premium:parseFloat(n.price_premium)})};return e.jsx(ze,{open:s,onOpenChange:a,children:e.jsxs(Te,{className:"sm:max-w-md max-w-[95vw]",children:[e.jsx(Fe,{children:e.jsxs(Re,{children:[r?"Editar":"Novo"," Tamanho"]})}),e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome *"}),e.jsx(U,{value:n.name,onChange:m=>l(i=>({...i,name:m.target.value})),placeholder:"Ex: Pequena, Média, Grande",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Fatias *"}),e.jsx(U,{type:"number",value:n.slices,onChange:m=>l(i=>({...i,slices:m.target.value})),placeholder:"Ex: 4",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Máx. Sabores (1-4) *"}),e.jsx(U,{type:"number",min:1,max:4,value:n.max_flavors,onChange:m=>l(i=>({...i,max_flavors:m.target.value})),placeholder:"Ex: 2",required:!0})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Máx. Extras"}),e.jsx(U,{type:"number",min:0,max:10,value:n.max_extras,onChange:m=>l(i=>({...i,max_extras:m.target.value})),placeholder:"Ex: 3"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Diâmetro (cm)"}),e.jsx(U,{type:"number",value:n.diameter_cm,onChange:m=>l(i=>({...i,diameter_cm:m.target.value})),placeholder:"Ex: 35"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Preço Tradicional *"}),e.jsx(U,{type:"number",step:"0.01",value:n.price_tradicional,onChange:m=>l(i=>({...i,price_tradicional:m.target.value})),placeholder:"0.00",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Preço Premium *"}),e.jsx(U,{type:"number",step:"0.01",value:n.price_premium,onChange:m=>l(i=>({...i,price_premium:m.target.value})),placeholder:"0.00",required:!0})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(D,{type:"button",variant:"outline",onClick:a,className:"flex-1",children:"Cancelar"}),e.jsx(D,{type:"submit",className:"flex-1 bg-orange-500",children:"Salvar"})]})]})]})})}function k0({isOpen:s,onClose:a,onSubmit:t,flavor:r}){const[n,l]=w.useState({name:"",description:"",image:"",category:"tradicional",prep_time:"",is_active:!0,is_popular:!1});se.useEffect(()=>{l(r?{name:r.name||"",description:r.description||"",image:r.image||"",category:r.category||"tradicional",prep_time:r.prep_time?.toString()||"",is_active:r.is_active!==!1,is_popular:r.is_popular||!1}:{name:"",description:"",image:"",category:"tradicional",prep_time:"",is_active:!0,is_popular:!1})},[r,s]);const c=async i=>{console.log("🖼️ [PizzaConfigTab] handleImageUpload chamado:",{event:i,target:i.target,files:i.target.files,filesLength:i.target.files?.length});const o=i.target.files?.[0];if(console.log("🖼️ [PizzaConfigTab] Arquivo extraído:",{file:o,isFile:o instanceof File,fileName:o?.name,fileSize:o?.size,fileType:o?.type}),!o){console.error("❌ [PizzaConfigTab] Nenhum arquivo encontrado no evento"),alert("Nenhum arquivo selecionado");return}if(!(o instanceof File)){console.error("❌ [PizzaConfigTab] Arquivo não é instância de File:",typeof o),alert("Arquivo inválido");return}try{console.log("📤 [PizzaConfigTab] Iniciando upload...");const{uploadToCloudinary:d}=await tt(async()=>{const{uploadToCloudinary:x}=await import("./cloudinaryUpload-C4sUQLHO.js");return{uploadToCloudinary:x}},__vite__mapDeps([0,1,2])),p=await d(o,"pizza-config");console.log("✅ [PizzaConfigTab] Upload concluído, URL:",p),l(x=>({...x,image:p}))}catch(d){console.error("❌ [PizzaConfigTab] Erro ao fazer upload:",d),alert("Erro ao fazer upload da imagem: "+d.message)}},m=i=>{i.preventDefault(),t({...n,prep_time:n.prep_time?parseInt(n.prep_time):null})};return e.jsx(ze,{open:s,onOpenChange:a,children:e.jsxs(Te,{className:"sm:max-w-md max-w-[95vw]",children:[e.jsx(Fe,{children:e.jsxs(Re,{children:[r?"Editar":"Novo"," Sabor"]})}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome *"}),e.jsx(U,{value:n.name,onChange:i=>l(o=>({...o,name:i.target.value})),placeholder:"Ex: Calabresa, Marguerita",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Descrição"}),e.jsx(Ms,{value:n.description,onChange:i=>l(o=>({...o,description:i.target.value})),placeholder:"Ingredientes do sabor...",rows:2})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Categoria *"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{type:"button",onClick:()=>l(i=>({...i,category:"tradicional"})),className:`flex-1 py-3 px-4 rounded-lg border-2 font-medium transition-all ${n.category==="tradicional"?"border-orange-500 bg-orange-50 text-orange-700":"border-gray-200 hover:border-gray-300"}`,children:"🍕 Tradicional"}),e.jsx("button",{type:"button",onClick:()=>l(i=>({...i,category:"premium"})),className:`flex-1 py-3 px-4 rounded-lg border-2 font-medium transition-all ${n.category==="premium"?"border-orange-500 bg-orange-50 text-orange-700":"border-gray-200 hover:border-gray-300"}`,children:"⭐ Premium"})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Tempo de Preparo (min)"}),e.jsx(U,{type:"number",value:n.prep_time,onChange:i=>l(o=>({...o,prep_time:i.target.value})),placeholder:"Ex: 20"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Imagem"}),e.jsx(U,{type:"file",accept:"image/*",onChange:c}),n.image&&e.jsx("img",{src:n.image,alt:"",className:"mt-2 w-20 h-20 object-cover rounded"})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx(Le,{checked:n.is_popular,onCheckedChange:i=>l(o=>({...o,is_popular:i}))}),e.jsx("span",{className:"text-sm",children:"⭐ Popular"})]})}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(D,{type:"button",variant:"outline",onClick:a,className:"flex-1",children:"Cancelar"}),e.jsx(D,{type:"submit",className:"flex-1 bg-orange-500",children:"Salvar"})]})]})]})})}function S0({isOpen:s,onClose:a,onSubmit:t,edge:r}){const[n,l]=w.useState({name:"",description:"",price:"",image:"",is_active:!0,is_popular:!1});se.useEffect(()=>{l(r?{name:r.name||"",description:r.description||"",price:r.price?.toString()||"",image:r.image||"",is_active:r.is_active!==!1,is_popular:r.is_popular||!1}:{name:"",description:"",price:"",image:"",is_active:!0,is_popular:!1})},[r,s]);const c=async i=>{console.log("🖼️ [PizzaConfigTab] handleImageUpload chamado:",{event:i,target:i.target,files:i.target.files,filesLength:i.target.files?.length});const o=i.target.files?.[0];if(console.log("🖼️ [PizzaConfigTab] Arquivo extraído:",{file:o,isFile:o instanceof File,fileName:o?.name,fileSize:o?.size,fileType:o?.type}),!o){console.error("❌ [PizzaConfigTab] Nenhum arquivo encontrado no evento"),alert("Nenhum arquivo selecionado");return}if(!(o instanceof File)){console.error("❌ [PizzaConfigTab] Arquivo não é instância de File:",typeof o),alert("Arquivo inválido");return}try{console.log("📤 [PizzaConfigTab] Iniciando upload...");const{uploadToCloudinary:d}=await tt(async()=>{const{uploadToCloudinary:x}=await import("./cloudinaryUpload-C4sUQLHO.js");return{uploadToCloudinary:x}},__vite__mapDeps([0,1,2])),p=await d(o,"pizza-config");console.log("✅ [PizzaConfigTab] Upload concluído, URL:",p),l(x=>({...x,image:p}))}catch(d){console.error("❌ [PizzaConfigTab] Erro ao fazer upload:",d),alert("Erro ao fazer upload da imagem: "+d.message)}},m=i=>{i.preventDefault(),t({...n,price:parseFloat(n.price)})};return e.jsx(ze,{open:s,onOpenChange:a,children:e.jsxs(Te,{className:"sm:max-w-md max-w-[95vw]",children:[e.jsx(Fe,{children:e.jsxs(Re,{children:[r?"Editar":"Nova"," Borda"]})}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome *"}),e.jsx(U,{value:n.name,onChange:i=>l(o=>({...o,name:i.target.value})),placeholder:"Ex: Catupiry, Cheddar",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Descrição"}),e.jsx(Ms,{value:n.description,onChange:i=>l(o=>({...o,description:i.target.value})),placeholder:"Descrição da borda...",rows:2})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Preço *"}),e.jsx(U,{type:"number",step:"0.01",value:n.price,onChange:i=>l(o=>({...o,price:i.target.value})),placeholder:"0.00",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Imagem"}),e.jsx(U,{type:"file",accept:"image/*",onChange:c}),n.image&&e.jsx("img",{src:n.image,alt:"",className:"mt-2 w-20 h-20 object-cover rounded"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(D,{type:"button",variant:"outline",onClick:a,className:"flex-1",children:"Cancelar"}),e.jsx(D,{type:"submit",className:"flex-1 bg-orange-500",children:"Salvar"})]})]})]})})}function D0({isOpen:s,onClose:a,onSubmit:t,extra:r}){const[n,l]=w.useState({name:"",description:"",price:"",image:"",is_active:!0});se.useEffect(()=>{l(r?{name:r.name||"",description:r.description||"",price:r.price?.toString()||"",image:r.image||"",is_active:r.is_active!==!1}:{name:"",description:"",price:"",image:"",is_active:!0})},[r,s]);const c=async i=>{console.log("🖼️ [PizzaConfigTab] handleImageUpload chamado:",{event:i,target:i.target,files:i.target.files,filesLength:i.target.files?.length});const o=i.target.files?.[0];if(console.log("🖼️ [PizzaConfigTab] Arquivo extraído:",{file:o,isFile:o instanceof File,fileName:o?.name,fileSize:o?.size,fileType:o?.type}),!o){console.error("❌ [PizzaConfigTab] Nenhum arquivo encontrado no evento"),alert("Nenhum arquivo selecionado");return}if(!(o instanceof File)){console.error("❌ [PizzaConfigTab] Arquivo não é instância de File:",typeof o),alert("Arquivo inválido");return}try{console.log("📤 [PizzaConfigTab] Iniciando upload...");const{uploadToCloudinary:d}=await tt(async()=>{const{uploadToCloudinary:x}=await import("./cloudinaryUpload-C4sUQLHO.js");return{uploadToCloudinary:x}},__vite__mapDeps([0,1,2])),p=await d(o,"pizza-config");console.log("✅ [PizzaConfigTab] Upload concluído, URL:",p),l(x=>({...x,image:p}))}catch(d){console.error("❌ [PizzaConfigTab] Erro ao fazer upload:",d),alert("Erro ao fazer upload da imagem: "+d.message)}},m=i=>{i.preventDefault(),t({...n,price:parseFloat(n.price)})};return e.jsx(ze,{open:s,onOpenChange:a,children:e.jsxs(Te,{className:"sm:max-w-md max-w-[95vw]",children:[e.jsx(Fe,{children:e.jsxs(Re,{children:[r?"Editar":"Novo"," Extra"]})}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome *"}),e.jsx(U,{value:n.name,onChange:i=>l(o=>({...o,name:i.target.value})),placeholder:"Ex: Azeitonas, Bacon",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Descrição"}),e.jsx(Ms,{value:n.description,onChange:i=>l(o=>({...o,description:i.target.value})),placeholder:"Descrição do extra...",rows:2})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Preço *"}),e.jsx(U,{type:"number",step:"0.01",value:n.price,onChange:i=>l(o=>({...o,price:i.target.value})),placeholder:"0.00",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Imagem"}),e.jsx(U,{type:"file",accept:"image/*",onChange:c}),n.image&&e.jsx("img",{src:n.image,alt:"",className:"mt-2 w-20 h-20 object-cover rounded"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(D,{type:"button",variant:"outline",onClick:a,className:"flex-1",children:"Cancelar"}),e.jsx(D,{type:"submit",className:"flex-1 bg-orange-500",children:"Salvar"})]})]})]})})}function M0({isOpen:s,onClose:a,onSubmit:t,category:r,sizes:n=[]}){const[l,c]=w.useState({name:"",size_id:"",max_flavors:"1"});se.useEffect(()=>{c(r?{name:r.name||"",size_id:r.size_id||"",max_flavors:(r.max_flavors||1).toString()}:{name:"",size_id:n[0]?.id||"",max_flavors:"1"})},[r,n,s]);const m=i=>{i.preventDefault(),t({...l,max_flavors:parseInt(l.max_flavors)||1})};return e.jsx(ze,{open:s,onOpenChange:a,children:e.jsxs(Te,{className:"sm:max-w-md max-w-[95vw]",children:[e.jsx(Fe,{children:e.jsxs(Re,{children:[r?"Editar":"Nova"," Categoria"]})}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome da categoria *"}),e.jsx(U,{value:l.name,onChange:i=>c(o=>({...o,name:i.target.value})),placeholder:"Ex: Pizza M 1 sabor, Pizza G 2 sabores",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Tamanho *"}),e.jsxs("select",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm",value:l.size_id,onChange:i=>c(o=>({...o,size_id:i.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"Selecione..."}),(n||[]).filter(i=>i&&i.is_active!==!1).map(i=>e.jsxs("option",{value:i.id,children:[i.name," - ",i.slices," fatias"]},i.id))]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Máx. sabores (1-4) *"}),e.jsx(U,{type:"number",min:1,max:4,value:l.max_flavors,onChange:i=>c(o=>({...o,max_flavors:i.target.value})),required:!0})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(D,{type:"button",variant:"outline",onClick:a,className:"flex-1",children:"Cancelar"}),e.jsx(D,{type:"submit",className:"flex-1 bg-orange-500",children:"Salvar"})]})]})]})})}function A0(){return e.jsxs("div",{className:"p-4 sm:p-6 space-y-3 sm:space-y-4",children:[e.jsx("div",{className:"bg-white p-3 sm:p-4 rounded-xl shadow-sm animate-pulse",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"w-24 h-10 bg-gray-200 rounded"}),e.jsx("div",{className:"w-32 h-10 bg-gray-200 rounded"})]})}),[1,2,3].map(s=>e.jsxs(We.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:s*.1},className:"bg-white rounded-xl p-3 sm:p-5 shadow-sm border animate-pulse",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start justify-between mb-3 sm:mb-4 gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-20 h-6 bg-gray-200 rounded"}),e.jsx("div",{className:"w-16 h-6 bg-gray-200 rounded-full"})]}),e.jsx("div",{className:"w-40 h-6 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"w-32 h-4 bg-gray-200 rounded"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded"}),e.jsx("div",{className:"w-32 h-10 bg-gray-200 rounded"}),e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-3 mb-4",children:[e.jsx("div",{className:"w-full h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"w-full h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"w-full h-4 bg-gray-200 rounded"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 mb-4 space-y-2",children:[e.jsx("div",{className:"w-32 h-4 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"w-full h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"w-full h-4 bg-gray-200 rounded"})]}),e.jsxs("div",{className:"flex justify-end gap-6",children:[e.jsx("div",{className:"w-32 h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"w-32 h-4 bg-gray-200 rounded"})]})]},s))]})}function vl(s,a={}){const{threshold:t=80,resistance:r=2.5,disabled:n=!1}=a,[l,c]=w.useState(!1),[m,i]=w.useState(0),[o,d]=w.useState(0),[p,x]=w.useState(!1);return w.useEffect(()=>{if(n||typeof window>"u")return;let f=0,v=0,y=!1;const j=z=>{window.scrollY>0||(f=z.touches[0].clientY,y=!0,i(f))},M=z=>{if(!y)return;v=z.touches[0].clientY;const $=v-f;$>0&&window.scrollY===0&&(z.preventDefault(),x(!0),d($/r))},k=async()=>{if(!y)return;if(y=!1,v-f>t&&window.scrollY===0){c(!0),x(!1),d(0);try{await s()}finally{c(!1)}}else x(!1),d(0)};return document.addEventListener("touchstart",j,{passive:!1}),document.addEventListener("touchmove",M,{passive:!1}),document.addEventListener("touchend",k),()=>{document.removeEventListener("touchstart",j),document.removeEventListener("touchmove",M),document.removeEventListener("touchend",k)}},[s,t,r,n]),{isRefreshing:l,isPulling:p,pullDistance:o,canRefresh:o>t}}function uo({mutationFn:s,entityType:a,successMessage:t="Operação realizada com sucesso!",errorMessage:r="Erro ao realizar operação",onSuccess:n,onError:l,invalidateQueries:c=!0}){const m=es(),{menuContext:i}=Ze();return le({mutationFn:async(...o)=>{try{Qe.api.log(`🔄 [useEntityMutation] Executando mutation para ${a}...`);const d=await s(...o);return Qe.api.log(`✅ [useEntityMutation] Mutation bem-sucedida para ${a}`),d}catch(d){throw Qe.api.error(`❌ [useEntityMutation] Erro na mutation para ${a}:`,d),d}},onSuccess:(o,d,p)=>{c&&(Array.isArray(a)?a:[a]).forEach(f=>{i&&m.invalidateQueries({queryKey:[f,i.type,i.value]}),m.invalidateQueries({queryKey:[f]})}),t&&W.success(t,{duration:3e3,position:"top-center"}),n&&n(o,d,p)},onError:(o,d,p)=>{const x=o?.message||r;W.error(x,{duration:5e3,position:"top-center"}),l&&l(o,d,p)}})}const Ct={new:{label:"Novo",color:"bg-red-100 text-red-800"},accepted:{label:"Aceito",color:"bg-yellow-100 text-yellow-800"},preparing:{label:"Preparando",color:"bg-purple-100 text-purple-800"},ready:{label:"Pronto",color:"bg-green-100 text-green-800"},out_for_delivery:{label:"Em Entrega",color:"bg-blue-100 text-blue-800"},delivered:{label:"Entregue",color:"bg-gray-100 text-gray-800"},cancelled:{label:"Cancelado",color:"bg-gray-300 text-gray-600"}},ho={pix:"PIX",dinheiro:"Dinheiro",cartao_credito:"Cartão de Crédito",cartao_debito:"Cartão de Débito"},hi=s=>!!(s?.order_code?.startsWith("PDV-")||s?.delivery_method==="balcao");function ry({isMaster:s,user:a,subscriberData:t}){const[r,n]=w.useState(""),[l,c]=w.useState("all"),[m,i]=w.useState(!1),o=es(),d=On(),{subscriberData:p,isMaster:x}=Ze(),v=(t?.plan||p?.plan||"").toLowerCase(),y=s||x||["pro","ultra"].includes(v),{data:j=[],isLoading:M}=Wt({orderBy:"-created_date"}),{isRefreshing:k}=vl(()=>o.invalidateQueries({queryKey:["orders"]})),z=uo({mutationFn:({id:h,data:b})=>ae.entities.Order.update(h,b),entityType:"orders",successMessage:"Pedido atualizado com sucesso!",errorMessage:"Erro ao atualizar pedido"}),$=uo({mutationFn:h=>ae.entities.Order.delete(h),entityType:"orders",successMessage:"Pedido excluído com sucesso!",errorMessage:"Erro ao excluir pedido"}),u=h=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(h||0),g=h=>{const b=new Pm({unit:"mm",format:[80,297]}),L=5,O=70,P=4.5,F=(E,ee=!1)=>{if(!E)return;b.setFont("courier",ee?"bold":"normal"),b.splitTextToSize(String(E),O).forEach(Z=>{b.text(Z,L,C),C+=P})};let C=10;b.setFontSize(12),b.setFont("courier","bold"),b.text("COMANDA",40,C,{align:"center"}),C+=8,b.setFontSize(9),b.setFont("courier","normal"),F(`Pedido: #${h.order_code||h.id?.slice(-6).toUpperCase()}`);const N=h.created_at||h.created_date;F(`Data: ${N?Ot(new Date(N),"dd/MM/yyyy HH:mm"):"—"}`),C+=2,F(`Cliente: ${h.customer_name||""}`),F(`Tel: ${h.customer_phone||""}`);const V=Em(h);h.delivery_method==="delivery"&&V?F(`Entrega: ${V}`):h.delivery_method!=="delivery"&&F("Retirada no local"),F(`Pagamento: ${ho[h.payment_method]||h.payment_method}`),h.payment_method==="dinheiro"&&h.needs_change&&h.change_amount&&F(`Troco para: ${u(h.change_amount)}`),h.scheduled_date&&h.scheduled_time&&F(`AGENDADO: ${h.scheduled_date} às ${h.scheduled_time}`),C+=2,b.text("--------------------------------",L,C),C+=P,(h.items||[]).forEach((E,ee)=>{const ue=E.dish?.product_type==="pizza",Z=E.size||E.selections?.size,S=E.flavors||E.selections?.flavors,G=E.edge||E.selections?.edge,q=E.extras||E.selections?.extras;if(F(`${ee+1}. ${E.dish?.name||"Item"} x${E.quantity||1} - ${u((E.totalPrice||0)*(E.quantity||1))}`),ue&&Z){if(F(`   ${Z.name} (${Z.slices||""} fatias)`),S?.length){const ne=S.reduce((Me,Y)=>(Me[Y.name]=(Me[Y.name]||0)+1,Me),{});Object.entries(ne).forEach(([Me,Y])=>F(`   • ${Y}/${Z.slices||""} ${Me}`))}G&&F(`   Borda: ${G.name}`),q?.length&&q.forEach(ne=>F(`   + ${ne.name}`))}else E.selections&&Object.keys(E.selections).length>0&&Object.values(E.selections).forEach(ne=>{Array.isArray(ne)?ne.forEach(Me=>Me?.name&&F(`   • ${Me.name}`)):ne?.name&&F(`   • ${ne.name}`)});E.specifications&&F(`   Obs: ${E.specifications}`),E.observations&&F(`   Obs: ${E.observations}`)}),b.text("--------------------------------",L,C),C+=P,F(`Subtotal: ${u(h.subtotal)}`),h.delivery_fee>0&&F(`Taxa: ${u(h.delivery_fee)}`),h.discount>0&&F(`Desconto: -${u(h.discount)}`),b.setFont("courier","bold"),F(`TOTAL: ${u(h.total)}`,!0),b.save(`comanda-${h.order_code||h.id?.slice(-6)}.pdf`)},T=j.filter(h=>{const b=h.created_at||h.created_date,L=!r||b&&Ot(new Date(b),"yyyy-MM-dd")===r,O=hi(h);return L&&(l==="all"||l==="pdv"&&O||l==="delivery"&&!O)});return M?e.jsx(A0,{}):j.length===0?e.jsx("div",{className:"p-6",children:e.jsx(gn,{icon:Lt,title:"Você ainda não possui pedidos",description:"Os pedidos feitos pelos clientes aparecerão aqui automaticamente",actionLabel:"Ir para o Cardápio",action:()=>{const h=a?.is_master?a?.slug:t?.slug,b=h?`/s/${h}`:js("Cardapio");window.open(b,"_blank")}})}):e.jsxs("div",{className:"p-4 sm:p-6 relative",children:[k&&e.jsxs("div",{className:"fixed top-20 left-1/2 -translate-x-1/2 z-50 bg-orange-500 text-white px-4 py-2 rounded-full shadow-lg flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm font-medium",children:"Atualizando..."})]}),d?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mb-4 flex items-center justify-between bg-white p-3 rounded-xl shadow-sm",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[T.length," pedido(s)"]})}),e.jsxs(fn,{open:m,onOpenChange:i,children:[e.jsx(jn,{asChild:!0,children:e.jsxs(D,{variant:"outline",size:"sm",className:"min-h-touch",children:[e.jsx(oa,{className:"w-4 h-4 mr-2"}),"Filtros"]})}),e.jsxs(vn,{side:"bottom",className:"h-auto max-h-[80vh] rounded-t-2xl",children:[e.jsx(Li,{children:e.jsx(Ii,{children:"Filtros"})}),e.jsxs("div",{className:"space-y-4 mt-4 pb-safe",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Data"}),e.jsx(U,{type:"date",value:r,onChange:h=>n(h.target.value),className:"min-h-touch"}),r&&e.jsxs(D,{variant:"ghost",size:"sm",onClick:()=>n(""),className:"mt-2 w-full",children:[e.jsx(ws,{className:"w-4 h-4 mr-2"}),"Limpar Data"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Tipo"}),e.jsxs(Ce,{value:l,onValueChange:c,children:[e.jsx(ke,{className:"min-h-touch",children:e.jsx(Se,{})}),e.jsxs(De,{children:[e.jsx(Q,{value:"all",children:"Todos"}),e.jsx(Q,{value:"delivery",children:"Delivery"}),e.jsx(Q,{value:"pdv",children:"PDV"})]})]})]}),e.jsx(D,{onClick:()=>i(!1),className:"w-full min-h-touch",children:"Aplicar Filtros"})]})]})]})]})}):e.jsxs("div",{className:"mb-4 sm:mb-6 flex flex-wrap items-center gap-2 sm:gap-4 bg-white p-3 sm:p-4 rounded-xl shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oa,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-600",children:"Data:"})]}),e.jsx(U,{type:"date",value:r,onChange:h=>n(h.target.value),className:"w-auto text-sm"}),e.jsxs(Ce,{value:l,onValueChange:c,children:[e.jsx(ke,{className:"w-32",children:e.jsx(Se,{})}),e.jsxs(De,{children:[e.jsx(Q,{value:"all",children:"Todos"}),e.jsx(Q,{value:"delivery",children:"Delivery"}),e.jsx(Q,{value:"pdv",children:"PDV"})]})]}),r&&e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>n(""),className:"text-xs",children:"Limpar"}),e.jsxs("span",{className:"text-xs sm:text-sm text-gray-400 ml-auto",children:[T.length," pedido(s)"]})]}),e.jsx("div",{className:"space-y-3 sm:space-y-4",children:T.map(h=>e.jsxs("div",{className:"bg-white rounded-xl p-3 sm:p-5 shadow-sm border hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start justify-between mb-3 sm:mb-4 gap-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-1",children:[e.jsxs("span",{className:"text-xs font-mono bg-gray-100 px-2 py-1 rounded",children:["#",h.order_code||h.id.slice(-6).toUpperCase()]}),e.jsx(fe,{variant:"outline",className:`text-xs ${hi(h)?"border-orange-300 text-orange-700":"border-blue-300 text-blue-700"}`,children:hi(h)?"PDV":"Delivery"}),e.jsx(fe,{className:(Ct[h.status]||Ct.new).color+" text-xs",children:(Ct[h.status]||Ct.new).label})]}),e.jsx("h3",{className:"font-bold text-base sm:text-lg",children:h.customer_name}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500",children:(h.created_at||h.created_date)&&Ot(new Date(h.created_at||h.created_date),"dd/MM/yyyy 'às' HH:mm",{locale:vi})})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(D,{size:"icon",variant:"outline",onClick:()=>g(h),title:"Imprimir Comanda",className:"min-h-touch min-w-touch",children:e.jsx(qi,{className:"w-4 h-4"})}),e.jsxs(Ce,{value:Ct[h.status]?h.status:"new",onValueChange:b=>z.mutate({id:h.id,data:{...h,status:b}}),children:[e.jsx(ke,{className:"w-28 sm:w-36 text-xs sm:text-sm min-h-touch",children:e.jsx(Se,{})}),e.jsx(De,{children:Object.entries(Ct).map(([b,{label:L}])=>e.jsx(Q,{value:b,children:L},b))})]}),y&&e.jsx(D,{size:"icon",variant:"ghost",className:"text-red-500 hover:text-red-700 min-h-touch min-w-touch",onClick:()=>{confirm("Excluir este pedido?")&&$.mutate(h.id)},title:"Excluir pedido (apenas Pro e Ultra)",children:e.jsx(Ke,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2 sm:gap-3 mb-4 text-xs sm:text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Qa,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:h.customer_phone})]}),h.address&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Ea,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:h.address})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(lt,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:ho[h.payment_method]||h.payment_method})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 mb-4",children:[e.jsx("h4",{className:"font-medium text-sm mb-2 text-gray-700",children:"Itens do Pedido:"}),(h.items||[]).map((b,L)=>e.jsxs("div",{className:"text-sm py-2 border-b border-gray-100 last:border-0 border-l-2 border-gray-300 pl-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:b.dish?.name||"Item"}),e.jsxs("span",{className:"text-gray-500",children:[b.quantity>1&&e.jsxs("span",{className:"text-gray-400 mr-2",children:["x",b.quantity]}),u(b.totalPrice*(b.quantity||1))]})]}),b.selections&&Object.keys(b.selections).length>0&&e.jsx("div",{className:"text-xs text-gray-600 ml-3 mt-1 space-y-0.5",children:Object.entries(b.selections).map(([O,P])=>Array.isArray(P)?P.map((F,C)=>e.jsxs("p",{children:["• ",F.name]},C)):P?e.jsxs("p",{children:["• ",P.name]},O):null)})]},L))]}),e.jsx("div",{className:"flex flex-col sm:flex-row justify-end gap-2 sm:gap-6 text-xs sm:text-sm pt-3 border-t",children:e.jsxs("div",{className:"flex justify-between sm:justify-end gap-4 sm:gap-6",children:[e.jsxs("div",{className:"text-gray-500",children:["Subtotal: ",u(h.subtotal)]}),h.delivery_fee>0&&e.jsxs("div",{className:"text-gray-500",children:["Entrega: ",u(h.delivery_fee)]}),e.jsxs("div",{className:"font-bold text-green-600",children:["Total: ",u(h.total)]})]})})]},h.id))})]})}function P0(){return e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsx("div",{className:"bg-white rounded-xl p-4 mb-6 shadow-sm animate-pulse",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsx("div",{className:"w-40 h-10 bg-gray-200 rounded"}),e.jsx("div",{className:"w-40 h-10 bg-gray-200 rounded"}),e.jsx("div",{className:"w-32 h-10 bg-gray-200 rounded ml-auto"})]})}),e.jsx("div",{className:"space-y-3",children:[1,2,3,4,5].map(s=>e.jsx(We.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:s*.05},className:"bg-white rounded-xl p-4 shadow-sm border animate-pulse",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"w-48 h-5 bg-gray-200 rounded"}),e.jsx("div",{className:"w-24 h-4 bg-gray-200 rounded"})]}),e.jsx("div",{className:"w-full h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"w-3/4 h-4 bg-gray-200 rounded"})]})]})},s))})]})}const xa={new:{label:"Novo",color:"bg-blue-500"},accepted:{label:"Aceito",color:"bg-green-500"},preparing:{label:"Preparando",color:"bg-yellow-500"},ready:{label:"Pronto",color:"bg-purple-500"},out_for_delivery:{label:"Em Rota",color:"bg-indigo-500"},delivered:{label:"Entregue",color:"bg-green-600"},cancelled:{label:"Cancelado",color:"bg-red-500"}},Ba=s=>!!(s?.order_code?.startsWith("PDV-")||s?.delivery_method==="balcao");function ny(){const{subscriberData:s,isMaster:a}=Ze(),[t,r]=w.useState(""),[n,l]=w.useState("all"),[c,m]=w.useState("all"),[i,o]=w.useState("all"),[d,p]=w.useState("today"),[x,f]=w.useState(""),[v,y]=w.useState(""),[j,M]=w.useState(null),[k,z]=w.useState(!1),[$,u]=w.useState(!1),g=es(),T=On(),h=a||s?.plan&&["pro","ultra"].includes(s.plan.toLowerCase()),{data:b=[],isLoading:L}=Wt({orderBy:"-created_date"}),{isRefreshing:O}=vl(()=>g.invalidateQueries({queryKey:["orderHistory"]})),P=E=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(E||0),F=E=>{if(!E.created_date)return!1;const ee=new Date(E.created_date),ue=new Date;if(d==="custom"){if(!x||!v)return!1;const Z=new Date(x),S=new Date(v);return S.setHours(23,59,59,999),ee>=Z&&ee<=S}switch(d){case"today":return ee.toDateString()===ue.toDateString();case"week":const Z=new Date(ue);return Z.setDate(ue.getDate()-7),ee>=Z;case"month":const S=new Date(ue);return S.setMonth(ue.getMonth()-1),ee>=S;case"all":return!0;default:return!0}},C=b.filter(E=>{const ee=!t||E.customer_name?.toLowerCase().includes(t.toLowerCase())||E.order_code?.toLowerCase().includes(t.toLowerCase())||E.customer_phone?.includes(t),ue=n==="all"||E.status===n,Z=c==="all"||E.payment_method===c,S=F(E),G=Ba(E);return ee&&ue&&Z&&S&&(i==="all"||i==="pdv"&&G||i==="delivery"&&!G)}),N=C.filter(E=>E.status!=="cancelled").reduce((E,ee)=>E+(ee.total||0),0),V=()=>{const E=["Data","Código","Cliente","Status","Pagamento","Total"],ee=C.map(A=>[er(A.created_date),A.order_code||A.id?.slice(-6),A.customer_name,xa[A.status]?.label||A.status,A.payment_method,A.total]),ue=[E,...ee].map(A=>A.join(",")).join(`
`),Z=new Blob([ue],{type:"text/csv"}),S=URL.createObjectURL(Z),G=document.createElement("a");G.href=S;const q=new Date,ne=String(q.getDate()).padStart(2,"0"),Me=String(q.getMonth()+1).padStart(2,"0"),Y=q.getFullYear();G.download=`pedidos-${ne}-${Me}-${Y}.csv`,G.click()};return L?e.jsx(P0,{}):e.jsxs("div",{className:"p-4 sm:p-6 space-y-4 sm:space-y-6 relative",children:[O&&e.jsxs("div",{className:"fixed top-20 left-1/2 -translate-x-1/2 z-50 bg-orange-500 text-white px-4 py-2 rounded-full shadow-lg flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm font-medium",children:"Atualizando..."})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold",children:"Histórico de Pedidos"}),h&&e.jsxs(D,{onClick:V,variant:"outline",size:"sm",className:"min-h-touch",title:"Exportar CSV (apenas Pro e Ultra)",children:[e.jsx(pn,{className:"w-4 h-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Exportar CSV"})]})]}),T?e.jsxs("div",{className:"flex items-center justify-between bg-white p-3 rounded-xl shadow-sm",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[C.length," pedido(s)"]})}),e.jsxs(fn,{open:$,onOpenChange:u,children:[e.jsx(jn,{asChild:!0,children:e.jsxs(D,{variant:"outline",size:"sm",className:"min-h-touch",children:[e.jsx(oa,{className:"w-4 h-4 mr-2"}),"Filtros"]})}),e.jsxs(vn,{side:"bottom",className:"h-auto max-h-[85vh] rounded-t-2xl overflow-y-auto",children:[e.jsx(Li,{children:e.jsx(Ii,{children:"Filtros"})}),e.jsxs("div",{className:"space-y-4 mt-4 pb-safe",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Buscar"}),e.jsxs("div",{className:"relative",children:[e.jsx(_s,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(U,{placeholder:"Cliente, código, telefone...",value:t,onChange:E=>r(E.target.value),className:"pl-10 min-h-touch"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Período"}),e.jsxs(Ce,{value:d,onValueChange:p,children:[e.jsx(ke,{className:"min-h-touch",children:e.jsx(Se,{})}),e.jsxs(De,{children:[e.jsx(Q,{value:"today",children:"Hoje"}),e.jsx(Q,{value:"week",children:"Últimos 7 dias"}),e.jsx(Q,{value:"month",children:"Último mês"}),e.jsx(Q,{value:"custom",children:"Período Customizado"}),e.jsx(Q,{value:"all",children:"Todos"})]})]})]}),d==="custom"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Data Inicial"}),e.jsx(U,{type:"date",value:x,onChange:E=>f(E.target.value),className:"min-h-touch"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Data Final"}),e.jsx(U,{type:"date",value:v,onChange:E=>y(E.target.value),className:"min-h-touch"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Status"}),e.jsxs(Ce,{value:n,onValueChange:l,children:[e.jsx(ke,{className:"min-h-touch",children:e.jsx(Se,{})}),e.jsxs(De,{children:[e.jsx(Q,{value:"all",children:"Todos"}),Object.entries(xa).map(([E,ee])=>e.jsx(Q,{value:E,children:ee.label},E))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Pagamento"}),e.jsxs(Ce,{value:c,onValueChange:m,children:[e.jsx(ke,{className:"min-h-touch",children:e.jsx(Se,{})}),e.jsxs(De,{children:[e.jsx(Q,{value:"all",children:"Todos"}),e.jsx(Q,{value:"pix",children:"PIX"}),e.jsx(Q,{value:"dinheiro",children:"Dinheiro"}),e.jsx(Q,{value:"cartao_credito",children:"Cartão de Crédito"}),e.jsx(Q,{value:"cartao_debito",children:"Cartão de Débito"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Tipo"}),e.jsxs(Ce,{value:i,onValueChange:o,children:[e.jsx(ke,{className:"min-h-touch",children:e.jsx(Se,{})}),e.jsxs(De,{children:[e.jsx(Q,{value:"all",children:"Todos"}),e.jsx(Q,{value:"delivery",children:"Delivery"}),e.jsx(Q,{value:"pdv",children:"PDV"})]})]})]}),e.jsx(D,{onClick:()=>u(!1),className:"w-full min-h-touch",children:"Aplicar Filtros"})]})]})]})]}):e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Buscar"}),e.jsxs("div",{className:"relative",children:[e.jsx(_s,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(U,{placeholder:"Cliente, código, telefone...",value:t,onChange:E=>r(E.target.value),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Período"}),e.jsxs(Ce,{value:d,onValueChange:p,children:[e.jsx(ke,{children:e.jsx(Se,{})}),e.jsxs(De,{children:[e.jsx(Q,{value:"today",children:"Hoje"}),e.jsx(Q,{value:"week",children:"Últimos 7 dias"}),e.jsx(Q,{value:"month",children:"Último mês"}),e.jsx(Q,{value:"custom",children:"Período Customizado"}),e.jsx(Q,{value:"all",children:"Todos"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Status"}),e.jsxs(Ce,{value:n,onValueChange:l,children:[e.jsx(ke,{children:e.jsx(Se,{})}),e.jsxs(De,{children:[e.jsx(Q,{value:"all",children:"Todos"}),Object.entries(xa).map(([E,ee])=>e.jsx(Q,{value:E,children:ee.label},E))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Pagamento"}),e.jsxs(Ce,{value:c,onValueChange:m,children:[e.jsx(ke,{children:e.jsx(Se,{})}),e.jsxs(De,{children:[e.jsx(Q,{value:"all",children:"Todos"}),e.jsx(Q,{value:"pix",children:"PIX"}),e.jsx(Q,{value:"dinheiro",children:"Dinheiro"}),e.jsx(Q,{value:"cartao_credito",children:"Cartão de Crédito"}),e.jsx(Q,{value:"cartao_debito",children:"Cartão de Débito"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Tipo"}),e.jsxs(Ce,{value:i,onValueChange:o,children:[e.jsx(ke,{children:e.jsx(Se,{})}),e.jsxs(De,{children:[e.jsx(Q,{value:"all",children:"Todos"}),e.jsx(Q,{value:"delivery",children:"Delivery"}),e.jsx(Q,{value:"pdv",children:"PDV"})]})]})]})]}),d==="custom"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4 pt-4 border-t",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Data Inicial"}),e.jsx(U,{type:"date",value:x,onChange:E=>f(E.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Data Final"}),e.jsx(U,{type:"date",value:v,onChange:E=>y(E.target.value)})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-xl p-4 border border-blue-200",children:[e.jsx("p",{className:"text-sm text-blue-600 mb-1",children:"Total de Pedidos"}),e.jsx("p",{className:"text-3xl font-bold text-blue-700",children:C.length})]}),e.jsxs("div",{className:"bg-green-50 rounded-xl p-4 border border-green-200",children:[e.jsx("p",{className:"text-sm text-green-600 mb-1",children:"Faturamento"}),e.jsx("p",{className:"text-3xl font-bold text-green-700",children:P(N)})]}),e.jsxs("div",{className:"bg-purple-50 rounded-xl p-4 border border-purple-200",children:[e.jsx("p",{className:"text-sm text-purple-600 mb-1",children:"Ticket Médio"}),e.jsx("p",{className:"text-3xl font-bold text-purple-700",children:P(C.length>0?N/C.length:0)})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border overflow-hidden",children:C.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(oa,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-gray-500",children:"Nenhum pedido encontrado"})]}):T?e.jsx("div",{className:"p-3 sm:p-4 space-y-3",children:C.map(E=>e.jsx(B,{className:"hover:shadow-md transition-shadow cursor-pointer",onClick:()=>{M(E),z(!0)},children:e.jsxs(H,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3 gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-2",children:[e.jsxs("span",{className:"text-xs font-mono bg-gray-100 px-2 py-1 rounded",children:["#",E.order_code||E.id?.slice(-6)]}),e.jsx(fe,{variant:"outline",className:`text-xs ${Ba(E)?"border-orange-300 text-orange-700":"border-blue-300 text-blue-700"}`,children:Ba(E)?"PDV":"Delivery"}),e.jsx(fe,{className:`text-xs ${xa[E.status]?.color||"bg-gray-500"}`,children:xa[E.status]?.label||E.status})]}),e.jsx("h3",{className:"font-bold text-sm mb-1 truncate",children:E.customer_name}),e.jsx("p",{className:"text-xs text-gray-500",children:E.created_date&&er(E.created_date)})]}),e.jsx(D,{variant:"ghost",size:"icon",className:"flex-shrink-0 min-h-touch min-w-touch",onClick:ee=>{ee.stopPropagation(),M(E),z(!0)},children:e.jsx(qa,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2 text-xs mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Qa,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:E.customer_phone||"-"})]}),E.address&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Ea,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:E.address})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(lt,{className:"w-3 h-3"}),e.jsx("span",{className:"capitalize",children:E.payment_method?.replace("_"," ")})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:[(E.items||[]).length," item(ns)"]}),e.jsx("div",{className:"font-bold text-green-600 text-sm",children:P(E.total)})]})]})},E.id))}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Data"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Código"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Cliente"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Itens"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Pagamento"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Ações"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:C.map(E=>e.jsxs("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>{M(E),z(!0)},children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:E.created_date&&er(E.created_date)}),e.jsxs("td",{className:"px-4 py-3 text-sm font-medium",children:["#",E.order_code||E.id?.slice(-6)]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(fe,{variant:"outline",className:Ba(E)?"border-orange-300 text-orange-700":"border-blue-300 text-blue-700",children:Ba(E)?"PDV":"Delivery"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:E.customer_name}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"text-sm space-y-2 max-w-xs",children:(E.items||[]).map((ee,ue)=>e.jsxs("div",{className:"border-l-2 border-gray-300 pl-2",children:[e.jsxs("div",{className:"font-medium text-gray-900 text-xs",children:[ee.quantity||1,"x ",ee.dish?.name]}),ee.selections&&Object.keys(ee.selections).length>0&&e.jsx("div",{className:"text-xs text-gray-600 ml-3 mt-1 space-y-0.5",children:Object.entries(ee.selections).map(([Z,S])=>Array.isArray(S)?S.map((G,q)=>e.jsxs("p",{children:["• ",G.name]},q)):S?e.jsxs("p",{children:["• ",S.name]},Z):null)})]},ue))})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx(fe,{className:xa[E.status]?.color||"bg-gray-500",children:xa[E.status]?.label||E.status})}),e.jsx("td",{className:"px-4 py-3 text-sm capitalize",children:E.payment_method?.replace("_"," ")}),e.jsx("td",{className:"px-4 py-3 text-sm font-bold text-green-600",children:P(E.total)}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(D,{variant:"ghost",size:"sm",onClick:ee=>{ee.stopPropagation(),M(E),z(!0)},children:e.jsx(qa,{className:"w-4 h-4"})})})]},E.id))})]})})}),e.jsx(ze,{open:k,onOpenChange:z,children:e.jsxs(Te,{className:"sm:max-w-3xl max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsx(Fe,{children:e.jsxs(Re,{className:"flex items-center gap-2 text-base sm:text-lg",children:[e.jsx(ys,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsxs("span",{className:"truncate",children:["Detalhes do Pedido #",j?.order_code||j?.id?.slice(-6)]})]})}),j&&e.jsxs("div",{className:"space-y-3 sm:space-y-4 py-2 sm:py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mb-1",children:"Cliente"}),e.jsx("p",{className:"font-semibold text-sm sm:text-base truncate",children:j.customer_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mb-1",children:"Telefone"}),e.jsx("p",{className:"font-semibold text-sm sm:text-base",children:j.customer_phone||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mb-1",children:"Data"}),e.jsx("p",{className:"font-semibold text-xs sm:text-sm",children:er(j.created_date)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mb-1",children:"Status"}),e.jsx(fe,{className:`text-xs ${xa[j.status]?.color||"bg-gray-500"}`,children:xa[j.status]?.label||j.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mb-1",children:"Pagamento"}),e.jsx("p",{className:"font-semibold text-sm sm:text-base capitalize",children:j.payment_method?.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mb-1",children:"Tipo"}),e.jsx(fe,{variant:"outline",className:`text-xs ${Ba(j)?"border-orange-300 text-orange-700":"border-blue-300 text-blue-700"}`,children:Ba(j)?"PDV":"Delivery"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm font-semibold mb-2",children:"Itens do Pedido"}),e.jsx("div",{className:"space-y-2",children:(j.items||[]).map((E,ee)=>e.jsxs("div",{className:"border rounded-lg p-2 sm:p-3",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2 gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"font-semibold text-sm sm:text-base truncate",children:[E.quantity||1,"x ",E.dish?.name||E.dish_name]}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-600",children:[P(E.unit_price||E.total_price)," un."]})]}),e.jsx("p",{className:"font-bold text-green-600 text-sm sm:text-base flex-shrink-0",children:P((E.total_price||E.unit_price||0)*(E.quantity||1))})]}),E.selections&&Object.keys(E.selections).length>0&&e.jsx("div",{className:"text-xs text-gray-600 ml-3 mt-2 space-y-0.5",children:Object.entries(E.selections).map(([ue,Z])=>Array.isArray(Z)?Z.map((S,G)=>e.jsxs("p",{children:["• ",S.name]},G)):Z?e.jsxs("p",{children:["• ",Z.name]},ue):null)}),E.observations&&e.jsxs("p",{className:"text-xs text-gray-600 italic mt-2",children:["📝 ",E.observations]})]},ee))})]}),e.jsxs("div",{className:"border-t pt-3 sm:pt-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{className:"font-semibold",children:P(j.subtotal||j.total)})]}),j.delivery_fee>0&&e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm",children:[e.jsx("span",{children:"Taxa de Entrega"}),e.jsx("span",{className:"font-semibold",children:P(j.delivery_fee)})]}),j.discount>0&&e.jsxs("div",{className:"flex justify-between text-red-600 text-xs sm:text-sm",children:[e.jsx("span",{children:"Desconto"}),e.jsxs("span",{className:"font-semibold",children:["-",P(j.discount)]})]}),e.jsxs("div",{className:"flex justify-between text-base sm:text-lg font-bold border-t pt-2",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"text-green-600",children:P(j.total)})]})]}),j.delivery_method==="delivery"&&j.address&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm font-semibold mb-2",children:"Endereço de Entrega"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 break-words",children:j.address})]})]}),e.jsx(Ws,{className:"flex-col sm:flex-row gap-2",children:e.jsx(D,{variant:"outline",onClick:()=>z(!1),className:"w-full sm:w-auto min-h-touch",children:"Fechar"})})]})})]})}function E0(){return e.jsxs("div",{className:"p-4 sm:p-6 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center animate-pulse",children:[e.jsx("div",{className:"w-32 sm:w-48 h-6 sm:h-8 bg-gray-200 rounded"}),e.jsx("div",{className:"w-24 sm:w-32 h-8 sm:h-10 bg-gray-200 rounded"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[1,2,3].map(s=>e.jsxs("div",{className:"bg-white rounded-xl p-4 sm:p-6 shadow-sm border animate-pulse",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"w-20 sm:w-24 h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded"})]}),e.jsx("div",{className:"w-24 sm:w-32 h-8 sm:h-10 bg-gray-200 rounded"})]},s))}),e.jsx("div",{className:"bg-white p-3 sm:p-4 rounded-xl shadow-sm animate-pulse",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx("div",{className:"w-20 sm:w-32 h-10 bg-gray-200 rounded flex-1"}),e.jsx("div",{className:"w-24 sm:w-32 h-10 bg-gray-200 rounded"})]})}),e.jsx("div",{className:"space-y-3",children:[1,2,3,4,5].map(s=>e.jsxs(We.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:s*.05},className:"bg-white rounded-xl p-4 shadow-sm border animate-pulse",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"w-32 sm:w-40 h-5 bg-gray-200 rounded"}),e.jsx("div",{className:"w-24 sm:w-32 h-4 bg-gray-200 rounded"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"hidden sm:block space-y-1 text-right",children:[e.jsx("div",{className:"w-20 h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"w-24 h-4 bg-gray-200 rounded"})]}),e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded"})]})]}),e.jsxs("div",{className:"sm:hidden mt-3 pt-3 border-t flex items-center justify-between",children:[e.jsx("div",{className:"w-20 h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"w-24 h-4 bg-gray-200 rounded"})]})]},s))})]})}function iy(){const[s,a]=w.useState(""),[t,r]=w.useState("recent"),[n,l]=w.useState(null),[c,m]=w.useState(!1),[i,o]=w.useState(!1),d=es(),p=On(),{data:x=[],isLoading:f}=Wt({orderBy:"-created_date"}),{isRefreshing:v}=vl(()=>d.invalidateQueries({queryKey:["clientOrders"]})),y=w.useMemo(()=>{const u={};return x.forEach(g=>{const T=g.customer_email||g.created_by||"sem-email",h=g.customer_name||"Cliente",b=g.customer_phone||"";u[T]||(u[T]={email:T,name:h,phone:b,orders:[],totalSpent:0,lastOrderDate:null}),u[T].orders.push(g),u[T].totalSpent+=g.total||0;const L=J(g.created_date);(!u[T].lastOrderDate||L.isAfter(u[T].lastOrderDate))&&(u[T].lastOrderDate=L)}),Object.values(u)},[x]),j=w.useMemo(()=>{let u=y.filter(g=>g.name.toLowerCase().includes(s.toLowerCase())||g.email.toLowerCase().includes(s.toLowerCase())||g.phone.includes(s));return t==="spending"?u.sort((g,T)=>T.totalSpent-g.totalSpent):t==="frequency"?u.sort((g,T)=>T.orders.length-g.orders.length):u.sort((g,T)=>g.lastOrderDate?T.lastOrderDate?T.lastOrderDate.diff(g.lastOrderDate):-1:1),u},[y,s,t]),M=u=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(u||0),k=y.length,z=y.reduce((u,g)=>u+g.totalSpent,0),$=k>0?z/k:0;return f?e.jsx(E0,{}):e.jsxs("div",{className:"space-y-4 sm:space-y-6 relative",children:[v&&e.jsxs("div",{className:"fixed top-20 left-1/2 -translate-x-1/2 z-50 bg-orange-500 text-white px-4 py-2 rounded-full shadow-lg flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm font-medium",children:"Atualizando..."})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-800 mb-2",children:"Clientes"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600",children:"Gerencie seus clientes e veja estatísticas"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(B,{children:e.jsxs(H,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total de Clientes"}),e.jsx(Et,{className:"w-5 h-5 text-blue-500"})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:k})]})}),e.jsx(B,{children:e.jsxs(H,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Ticket Médio"}),e.jsx($a,{className:"w-5 h-5 text-green-500"})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:M($)})]})}),e.jsx(B,{children:e.jsxs(H,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Faturamento Total"}),e.jsx(Ls,{className:"w-5 h-5 text-purple-500"})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:M(z)})]})})]}),p?e.jsxs("div",{className:"flex items-center justify-between bg-white p-3 rounded-xl shadow-sm",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[j.length," cliente(s)"]})}),e.jsxs(fn,{open:i,onOpenChange:o,children:[e.jsx(jn,{asChild:!0,children:e.jsxs(D,{variant:"outline",size:"sm",className:"min-h-touch",children:[e.jsx(oa,{className:"w-4 h-4 mr-2"}),"Filtros"]})}),e.jsxs(vn,{side:"bottom",className:"h-auto max-h-[80vh] rounded-t-2xl",children:[e.jsx(Li,{children:e.jsx(Ii,{children:"Filtros"})}),e.jsxs("div",{className:"space-y-4 mt-4 pb-safe",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Buscar"}),e.jsxs("div",{className:"relative",children:[e.jsx(_s,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(U,{placeholder:"Nome, email ou telefone...",value:s,onChange:u=>a(u.target.value),className:"pl-10 min-h-touch"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Ordenar por"}),e.jsxs(Ce,{value:t,onValueChange:r,children:[e.jsx(ke,{className:"min-h-touch",children:e.jsx(Se,{placeholder:"Ordenar por"})}),e.jsxs(De,{children:[e.jsx(Q,{value:"recent",children:"Mais Recentes"}),e.jsx(Q,{value:"spending",children:"Maior Gasto"}),e.jsx(Q,{value:"frequency",children:"Mais Pedidos"})]})]})]}),e.jsx(D,{onClick:()=>o(!1),className:"w-full min-h-touch",children:"Aplicar Filtros"})]})]})]})]}):e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(_s,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(U,{placeholder:"Buscar por nome, email ou telefone...",value:s,onChange:u=>a(u.target.value),className:"pl-10"})]}),e.jsxs(Ce,{value:t,onValueChange:r,children:[e.jsx(ke,{className:"w-full sm:w-48",children:e.jsx(Se,{placeholder:"Ordenar por"})}),e.jsxs(De,{children:[e.jsx(Q,{value:"recent",children:"Mais Recentes"}),e.jsx(Q,{value:"spending",children:"Maior Gasto"}),e.jsx(Q,{value:"frequency",children:"Mais Pedidos"})]})]})]}),e.jsx("div",{className:"space-y-3",children:j.length===0?e.jsx(B,{children:e.jsxs(H,{className:"p-12 text-center",children:[e.jsx(Et,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-600 mb-2",children:"Nenhum cliente encontrado"}),e.jsx("p",{className:"text-gray-400",children:"Os clientes aparecerão aqui após o primeiro pedido"})]})}):j.map(u=>e.jsx(B,{className:"hover:shadow-md transition-shadow",children:e.jsxs(H,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center text-white font-bold text-lg flex-shrink-0",children:u.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-900 truncate",children:u.name}),e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-sm text-gray-500 mt-1",children:[u.phone&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Qa,{className:"w-3 h-3"}),u.phone]}),u.email!=="sem-email"&&e.jsxs("span",{className:"flex items-center gap-1 truncate",children:[e.jsx(Vo,{className:"w-3 h-3"}),u.email]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right hidden sm:block",children:[e.jsxs("div",{className:"flex items-center gap-2 justify-end mb-1",children:[e.jsx(Lt,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"font-semibold",children:[u.orders.length," pedidos"]})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx($a,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"font-bold text-green-600",children:M(u.totalSpent)})]}),u.lastOrderDate&&e.jsxs("div",{className:"flex items-center gap-1 justify-end mt-1 text-xs text-gray-400",children:[e.jsx(or,{className:"w-3 h-3"}),u.lastOrderDate.fromNow()]})]}),e.jsxs(mt,{children:[e.jsx(ut,{asChild:!0,children:e.jsx(D,{variant:"ghost",size:"icon",children:e.jsx(jr,{className:"w-4 h-4"})})}),e.jsxs(ht,{align:"end",children:[e.jsxs(ms,{onClick:()=>{l(u),m(!0)},children:[e.jsx(qa,{className:"w-4 h-4 mr-2"}),"Ver Detalhes"]}),e.jsxs(ms,{onClick:()=>window.open(`https://wa.me/55${u.phone?.replace(/\D/g,"")}`,"_blank"),children:[e.jsx(Qa,{className:"w-4 h-4 mr-2"}),"WhatsApp"]}),e.jsxs(ms,{className:"text-red-600",children:[e.jsx(Uo,{className:"w-4 h-4 mr-2"}),"Bloquear Cliente"]})]})]})]})]}),e.jsxs("div",{className:"sm:hidden mt-3 pt-3 border-t flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Lt,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"font-semibold",children:[u.orders.length," pedidos"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"font-bold text-green-600",children:M(u.totalSpent)})})]})]})},u.email))}),e.jsx(ze,{open:c,onOpenChange:m,children:e.jsxs(Te,{className:"sm:max-w-4xl max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsx(Fe,{children:e.jsxs(Re,{className:"flex items-center gap-2 text-base sm:text-lg",children:[e.jsx(Et,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"truncate",children:n?.name})]})}),n&&e.jsxs("div",{className:"space-y-4 sm:space-y-6 py-2 sm:py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsx(B,{children:e.jsxs(H,{className:"p-3 sm:p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center text-white font-bold text-xl sm:text-2xl flex-shrink-0",children:n.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-base sm:text-lg truncate",children:n.name}),n.email!=="sem-email"&&e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 truncate",children:n.email})]})]}),n.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[e.jsx(Qa,{className:"w-3 h-3 sm:w-4 sm:h-4 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:n.phone})]})]})}),e.jsx(B,{children:e.jsx(H,{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-600",children:"Total Gasto"}),e.jsx("span",{className:"text-lg sm:text-2xl font-bold text-green-600",children:M(n.totalSpent)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-600",children:"Pedidos"}),e.jsx("span",{className:"text-base sm:text-xl font-semibold",children:n.orders.length})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-600",children:"Ticket Médio"}),e.jsx("span",{className:"text-sm sm:text-lg font-semibold",children:M(n.orders.length>0?n.totalSpent/n.orders.length:0)})]}),n.lastOrderDate&&e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-600",children:"Último Pedido"}),e.jsx("span",{className:"text-xs sm:text-sm font-medium",children:n.lastOrderDate.fromNow()})]})]})})})]}),e.jsxs("div",{children:[e.jsx(oe,{className:"p-3 sm:p-6",children:e.jsxs(ce,{className:"flex items-center gap-2 text-base sm:text-lg",children:[e.jsx(ys,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"Histórico de Pedidos (",n.orders.length,")"]})}),e.jsx(H,{className:"p-3 sm:p-6 pt-0",children:e.jsx("div",{className:"space-y-2 sm:space-y-3 max-h-64 sm:max-h-96 overflow-y-auto",children:n.orders.length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Nenhum pedido registrado"}):n.orders.sort((u,g)=>new Date(g.created_date)-new Date(u.created_date)).map(u=>e.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs(fe,{variant:"outline",className:"font-mono",children:["#",u.order_code||u.id?.slice(-6)]}),e.jsx(fe,{className:u.status==="delivered"?"bg-green-500":u.status==="cancelled"?"bg-red-500":"bg-yellow-500",children:u.status==="delivered"?"Entregue":u.status==="cancelled"?"Cancelado":u.status})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx(It,{className:"w-3 h-3 inline mr-1"}),J(u.created_date).format("DD/MM/YYYY HH:mm")]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold text-green-600",children:M(u.total)}),e.jsx("p",{className:"text-xs text-gray-500 capitalize",children:u.payment_method?.replace("_"," ")})]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Itens:"})," ",(u.items||[]).length]}),u.delivery_method&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tipo:"})," ",u.delivery_method==="delivery"?"Entrega 🚴":"Retirada 🏪"]})]})]},u.id))})})]})]}),e.jsxs(Ws,{children:[e.jsx(D,{variant:"outline",onClick:()=>m(!1),children:"Fechar"}),n?.phone&&e.jsxs(D,{onClick:()=>window.open(`https://wa.me/55${n.phone.replace(/\D/g,"")}`,"_blank"),children:[e.jsx(Qa,{className:"w-4 h-4 mr-2"}),"WhatsApp"]})]})]})})]})}function O0(){return e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[1,2,3,4].map(s=>e.jsxs(We.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:s*.05},className:"bg-white rounded-xl p-6 shadow-sm border animate-pulse",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-lg"}),e.jsx("div",{className:"w-12 h-5 bg-gray-200 rounded-full"})]}),e.jsx("div",{className:"w-24 h-8 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"w-32 h-4 bg-gray-200 rounded"})]},s))}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border mb-6 animate-pulse",children:[e.jsx("div",{className:"w-48 h-6 bg-gray-200 rounded mb-4"}),e.jsx("div",{className:"h-64 bg-gray-100 rounded"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b animate-pulse",children:e.jsx("div",{className:"w-48 h-6 bg-gray-200 rounded"})}),[1,2,3,4,5].map(s=>e.jsx(We.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:s*.05},className:"p-4 border-b last:border-b-0 animate-pulse",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-lg"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-40 h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"w-24 h-3 bg-gray-200 rounded"})]})]}),e.jsx("div",{className:"w-24 h-6 bg-gray-200 rounded"})]})},s))]})]})}function ly(){const{menuContext:s}=Ze(),{data:a=[],isLoading:t}=Wt({orderBy:"-created_date"}),{data:r=[],isLoading:n}=Ae({queryKey:["pedidosPDV",s?.type,s?.value],queryFn:async()=>{if(!s)return[];const c={};return s.type==="subscriber"&&s.value&&(c.as_subscriber=s.value),ae.entities.PedidoPDV.list("-created_date",c)},enabled:!!s});return t||n?e.jsx(O0,{}):e.jsx(Om,{orders:a,pdvSales:r})}function oy(){const[s,a]=w.useState(!1),[t,r]=w.useState(""),[n,l]=w.useState("all"),[c,m]=w.useState({neighborhood:"",fee:"",is_active:!0}),[i,o]=w.useState({delivery_fee_mode:"zone",delivery_fee:0,min_order_value:0,latitude:null,longitude:null,delivery_base_fee:0,delivery_price_per_km:0,delivery_min_fee:0,delivery_max_fee:null,delivery_free_distance:null}),d=es(),{menuContext:p}=Ze(),{data:x=[]}=Ae({queryKey:["store",p?.type,p?.value],queryFn:async()=>{if(!p)return[];const h={};return p.type==="subscriber"&&p.value&&(h.as_subscriber=p.value),ae.entities.Store.list(null,h)},enabled:!!p}),f=x[0];w.useEffect(()=>{f&&o({delivery_fee_mode:f.delivery_fee_mode||"zone",delivery_fee:f.delivery_fee||0,min_order_value:f.min_order_value||f.min_order_price||0,latitude:f.latitude||null,longitude:f.longitude||null,delivery_base_fee:f.delivery_base_fee||0,delivery_price_per_km:f.delivery_price_per_km||0,delivery_min_fee:f.delivery_min_fee||0,delivery_max_fee:f.delivery_max_fee??null,delivery_free_distance:f.delivery_free_distance??null})},[f]);const v=le({mutationFn:({data:h})=>ae.entities.Store.update(f.id,h),onSuccess:()=>{d.invalidateQueries({queryKey:["store"]}),W.success("Configuração de entrega salva")},onError:h=>W.error(h?.message||"Erro ao salvar")}),{data:y=[]}=Ae({queryKey:["deliveryZones",p?.type,p?.value],queryFn:async()=>{if(!p)return[];try{const h={};p.type==="subscriber"&&p.value&&(h.as_subscriber=p.value);const b=await ae.entities.DeliveryZone.list("neighborhood",h);return Array.isArray(b)?b:[]}catch(h){return console.error("Erro ao buscar zonas:",h),[]}},enabled:!!p,initialData:[],refetchOnMount:"always"}),j=w.useMemo(()=>Array.isArray(y)?y.filter(h=>{const b=!t||h.neighborhood?.toLowerCase().includes(t.toLowerCase()),L=n==="all"||n==="active"&&h.is_active||n==="inactive"&&!h.is_active;return b&&L}):[],[y,t,n]),M=w.useMemo(()=>{const h=Array.isArray(y)?y:[],b=h.filter(F=>F.is_active).length,L=h.filter(F=>!F.is_active).length,O=h.reduce((F,C)=>{const N=parseFloat(C.fee||0);return F+(isNaN(N)?0:N)},0),P=b>0?O/b:0;return{total:h.length,active:b,inactive:L,avgFee:P}},[y]),k=le({mutationFn:h=>ae.entities.DeliveryZone.create(h),onSuccess:()=>{d.invalidateQueries({queryKey:["deliveryZones"]}),u();const h=document.createElement("div");h.className="fixed top-4 right-4 z-[9999] bg-green-600 text-white px-6 py-4 rounded-xl shadow-2xl",h.innerHTML="✅ Zona criada!",document.body.appendChild(h),setTimeout(()=>h.remove(),2e3)}}),z=le({mutationFn:({id:h,data:b})=>ae.entities.DeliveryZone.update(h,b),onSuccess:()=>{d.invalidateQueries({queryKey:["deliveryZones"]}),W.success("✅ Salvo!")}}),$=le({mutationFn:h=>ae.entities.DeliveryZone.delete(h),onSuccess:()=>d.invalidateQueries({queryKey:["deliveryZones"]})}),u=()=>{a(!1),m({neighborhood:"",fee:"",is_active:!0})},g=h=>{h.preventDefault(),k.mutate({...c,fee:parseFloat(c.fee)||0})},T=h=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(h||0);return e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[f&&e.jsxs(B,{children:[e.jsxs(oe,{children:[e.jsx(ce,{children:"Configuração de entrega"}),e.jsx(rs,{children:"Modo de cálculo, taxa padrão e pedido mínimo. Taxas por bairro abaixo."})]}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{className:"mb-2 block",children:"Modo de cálculo"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{type:"button",variant:i.delivery_fee_mode==="zone"?"default":"outline",size:"sm",onClick:()=>o(h=>({...h,delivery_fee_mode:"zone"})),children:"Por zona/bairro"}),e.jsx(D,{type:"button",variant:i.delivery_fee_mode==="distance"?"default":"outline",size:"sm",onClick:()=>o(h=>({...h,delivery_fee_mode:"distance"})),children:"Por distância (km)"})]})]}),i.delivery_fee_mode==="zone"&&e.jsxs("div",{children:[e.jsx(R,{children:"Taxa padrão (R$)"}),e.jsx(U,{type:"number",step:"0.01",value:i.delivery_fee,onChange:h=>o(b=>({...b,delivery_fee:parseFloat(h.target.value)||0}))})]}),i.delivery_fee_mode==="distance"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Latitude"}),e.jsx(U,{type:"number",step:"0.000001",value:i.latitude||"",onChange:h=>o(b=>({...b,latitude:h.target.value?parseFloat(h.target.value):null})),placeholder:"-5.08"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Longitude"}),e.jsx(U,{type:"number",step:"0.000001",value:i.longitude||"",onChange:h=>o(b=>({...b,longitude:h.target.value?parseFloat(h.target.value):null})),placeholder:"-42.80"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Taxa base (R$)"}),e.jsx(U,{type:"number",step:"0.01",value:i.delivery_base_fee,onChange:h=>o(b=>({...b,delivery_base_fee:parseFloat(h.target.value)||0}))})]}),e.jsxs("div",{children:[e.jsx(R,{children:"R$ por km"}),e.jsx(U,{type:"number",step:"0.01",value:i.delivery_price_per_km,onChange:h=>o(b=>({...b,delivery_price_per_km:parseFloat(h.target.value)||0}))})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Taxa mín (R$)"}),e.jsx(U,{type:"number",step:"0.01",value:i.delivery_min_fee,onChange:h=>o(b=>({...b,delivery_min_fee:parseFloat(h.target.value)||0}))})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Taxa máx (R$)"}),e.jsx(U,{type:"number",step:"0.01",value:i.delivery_max_fee??"",onChange:h=>o(b=>({...b,delivery_max_fee:h.target.value?parseFloat(h.target.value):null}))})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Grátis até (km)"}),e.jsx(U,{type:"number",step:"0.1",value:i.delivery_free_distance??"",onChange:h=>o(b=>({...b,delivery_free_distance:h.target.value?parseFloat(h.target.value):null}))})]})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Pedido mínimo (R$)"}),e.jsx(U,{type:"number",step:"0.01",value:i.min_order_value,onChange:h=>o(b=>({...b,min_order_value:parseFloat(h.target.value)||0}))})]}),e.jsx(D,{onClick:()=>v.mutate({data:i}),disabled:v.isPending,children:"Salvar configuração"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(B,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total de Zonas"}),e.jsx("p",{className:"text-2xl font-bold",children:M.total})]}),e.jsx(Ea,{className:"w-8 h-8 text-blue-500"})]})})}),e.jsx(B,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Ativas"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:M.active})]}),e.jsx(Ls,{className:"w-8 h-8 text-green-500"})]})})}),e.jsx(B,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Inativas"}),e.jsx("p",{className:"text-2xl font-bold text-gray-400",children:M.inactive})]}),e.jsx(ys,{className:"w-8 h-8 text-gray-400"})]})})}),e.jsx(B,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Taxa Média"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:T(M.avgFee)})]}),e.jsx(Ls,{className:"w-8 h-8 text-orange-500"})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(_s,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(U,{placeholder:"Buscar zona por bairro...",value:t,onChange:h=>r(h.target.value),className:"pl-10"})]}),e.jsxs(Ce,{value:n,onValueChange:l,children:[e.jsxs(ke,{className:"w-[140px]",children:[e.jsx(oa,{className:"w-4 h-4 mr-2"}),e.jsx(Se,{})]}),e.jsxs(De,{children:[e.jsx(Q,{value:"all",children:"Todas"}),e.jsx(Q,{value:"active",children:"Ativas"}),e.jsx(Q,{value:"inactive",children:"Inativas"})]})]}),e.jsxs(D,{onClick:()=>a(!0),className:"bg-orange-500 hover:bg-orange-600",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Nova Zona"]})]}),e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4",children:j.length===0?e.jsx("div",{className:"col-span-full",children:e.jsx(gn,{icon:Ea,title:"Defina as zonas de entrega para calcular taxas corretamente",description:"Configure taxas por bairro para cobrar valores justos e transparentes",actionLabel:"Criar zona de entrega",onAction:()=>a(!0)})}):y.map(h=>e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(Ea,{className:"w-5 h-5 text-blue-600"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("input",{type:"text",value:h.neighborhood,onChange:b=>z.mutate({id:h.id,data:{...h,neighborhood:b.target.value}}),className:"font-semibold text-base bg-transparent border-b border-transparent hover:border-gray-300 focus:border-orange-500 focus:outline-none w-full"})})]}),e.jsx(Le,{checked:h.is_active,onCheckedChange:b=>z.mutate({id:h.id,data:{...h,is_active:b}})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(R,{className:"text-xs text-gray-500",children:"Taxa de Entrega"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:h.fee,onChange:b=>z.mutate({id:h.id,data:{...h,fee:parseFloat(b.target.value)||0}}),className:"flex-1 px-2 py-1 border rounded text-sm"})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t",children:[e.jsx("span",{className:"text-lg font-bold text-green-600",children:T(h.fee)}),e.jsx(D,{size:"icon",variant:"ghost",className:"h-8 w-8 text-red-500 hover:text-red-700",onClick:()=>{confirm(`Excluir a zona "${h.neighborhood}"?`)&&$.mutate(h.id)},children:e.jsx(Ke,{className:"w-4 h-4"})})]})]},h.id))}),e.jsx(ze,{open:s,onOpenChange:a,children:e.jsxs(Te,{className:"sm:max-w-sm max-w-[95vw]",children:[e.jsx(Fe,{children:e.jsxs(Re,{className:"flex items-center gap-2",children:[e.jsx(Ea,{className:"w-5 h-5"}),"Nova Zona de Entrega"]})}),e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome do Bairro"}),e.jsx(U,{value:c.neighborhood,onChange:h=>m(b=>({...b,neighborhood:h.target.value})),placeholder:"Ex: Centro, Jardins...",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Taxa de Entrega (R$)"}),e.jsx(U,{type:"number",step:"0.01",value:c.fee,onChange:h=>m(b=>({...b,fee:h.target.value})),placeholder:"0.00",required:!0})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx(R,{children:"Zona ativa"}),e.jsx(Le,{checked:c.is_active,onCheckedChange:h=>m(b=>({...b,is_active:h}))})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(D,{type:"button",variant:"outline",onClick:u,className:"flex-1",children:"Cancelar"}),e.jsx(D,{type:"submit",className:"flex-1 bg-orange-500 hover:bg-orange-600",children:"Criar"})]})]})]})})]})}function cy(){const[s,a]=w.useState(!1),[t,r]=w.useState(""),[n,l]=w.useState("all"),[c,m]=w.useState("all"),[i,o]=w.useState({code:"",discount_type:"percentage",discount_value:"",min_order_value:"",max_uses:"",is_active:!0,expires_at:""}),d=es(),{menuContext:p}=Ze(),{data:x=[]}=Ae({queryKey:["coupons",p?.type,p?.value],queryFn:async()=>{if(!p)return[];const h={};return p.type==="subscriber"&&p.value&&(h.as_subscriber=p.value),ae.entities.Coupon.list("-created_date",h)},enabled:!!p}),f=le({mutationFn:h=>ae.entities.Coupon.create(h),onSuccess:()=>{d.invalidateQueries({queryKey:["coupons"]}),j(),Gs.success("Cupom criado com sucesso!")}}),v=le({mutationFn:({id:h,data:b})=>ae.entities.Coupon.update(h,b),onSuccess:()=>d.invalidateQueries({queryKey:["coupons"]})}),y=le({mutationFn:h=>ae.entities.Coupon.delete(h),onSuccess:()=>{d.invalidateQueries({queryKey:["coupons"]}),Gs.success("Cupom excluído!")}}),j=()=>{a(!1),o({code:"",discount_type:"percentage",discount_value:"",min_order_value:"",max_uses:"",is_active:!0,expires_at:""})},M=h=>{h.preventDefault(),f.mutate({...i,code:i.code.toUpperCase(),discount_value:parseFloat(i.discount_value)||0,min_order_value:parseFloat(i.min_order_value)||0,max_uses:parseInt(i.max_uses)||0,current_uses:0})},k=()=>{const h="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let b="";for(let L=0;L<8;L++)b+=h.charAt(Math.floor(Math.random()*h.length));o(L=>({...L,code:b}))},z=h=>{navigator.clipboard.writeText(h),Gs.success("Código copiado!")},$=h=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(h||0),u=h=>{if(!h)return!1;try{const b=new Date(h);return!isNaN(b.getTime())&&b<new Date}catch{return!1}},g=w.useMemo(()=>Array.isArray(x)?x.filter(h=>{const b=!t||h.code?.toLowerCase().includes(t.toLowerCase()),L=u(h.expires_at),O=h.max_uses>0&&h.current_uses>=h.max_uses,P=h.is_active&&!L&&!O,F=n==="all"||n==="active"&&P||n==="inactive"&&!h.is_active||n==="expired"&&L||n==="exhausted"&&O,C=c==="all"||h.discount_type===c;return b&&F&&C}):[],[x,t,n,c]),T=w.useMemo(()=>{const b=(Array.isArray(x)?x:[]).filter(N=>{const V=u(N.expires_at),E=N.max_uses>0&&N.current_uses>=N.max_uses;return N.is_active&&!V&&!E}).length,L=x.filter(N=>u(N.expires_at)).length,O=x.filter(N=>N.max_uses>0&&N.current_uses>=N.max_uses).length,P=x.filter(N=>N.discount_type==="percentage").length,F=x.filter(N=>N.discount_type==="fixed").length,C=x.reduce((N,V)=>N+(V.current_uses||0),0);return{total:x.length,active:b,expired:L,exhausted:O,percentage:P,fixed:F,totalUses:C}},[x,u]);return e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(B,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold",children:T.total})]}),e.jsx(ri,{className:"w-8 h-8 text-orange-500"})]})})}),e.jsx(B,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Ativos"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:T.active})]}),e.jsx(Ls,{className:"w-8 h-8 text-green-500"})]})})}),e.jsx(B,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Expirados"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:T.expired})]}),e.jsx(It,{className:"w-8 h-8 text-red-500"})]})})}),e.jsx(B,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Usos Totais"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:T.totalUses})]}),e.jsx($a,{className:"w-8 h-8 text-blue-500"})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(_s,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(U,{placeholder:"Buscar cupom por código...",value:t,onChange:h=>r(h.target.value),className:"pl-10 font-mono"})]}),e.jsxs(Ce,{value:n,onValueChange:l,children:[e.jsxs(ke,{className:"w-[140px]",children:[e.jsx(oa,{className:"w-4 h-4 mr-2"}),e.jsx(Se,{})]}),e.jsxs(De,{children:[e.jsx(Q,{value:"all",children:"Todos"}),e.jsx(Q,{value:"active",children:"Ativos"}),e.jsx(Q,{value:"inactive",children:"Inativos"}),e.jsx(Q,{value:"expired",children:"Expirados"}),e.jsx(Q,{value:"exhausted",children:"Esgotados"})]})]}),e.jsxs(Ce,{value:c,onValueChange:m,children:[e.jsx(ke,{className:"w-[160px]",children:e.jsx(Se,{})}),e.jsxs(De,{children:[e.jsx(Q,{value:"all",children:"Todos os tipos"}),e.jsx(Q,{value:"percentage",children:"Porcentagem"}),e.jsx(Q,{value:"fixed",children:"Valor Fixo"})]})]}),e.jsxs(D,{onClick:()=>a(!0),className:"bg-orange-500 hover:bg-orange-600",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Novo Cupom"]})]}),e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4",children:g.length===0?e.jsxs("div",{className:"col-span-full text-center py-12 text-gray-400 border-2 border-dashed rounded-xl",children:[e.jsx(ri,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Nenhum cupom cadastrado ainda"})]}):g.map(h=>{const b=u(h.expires_at),L=h.max_uses>0&&h.current_uses>=h.max_uses,O=h.is_active&&!b&&!L;return e.jsxs("div",{className:`bg-white rounded-xl p-4 shadow-sm border-2 ${O?"border-green-200":"border-gray-200 opacity-60"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${h.discount_type==="percentage"?"bg-purple-100":"bg-green-100"}`,children:h.discount_type==="percentage"?e.jsx(Lm,{className:"w-5 h-5 text-purple-600"}):e.jsx($a,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>z(h.code),className:"font-mono font-bold text-lg hover:text-orange-500 flex items-center gap-1",children:[h.code,e.jsx(Ks,{className:"w-3 h-3"})]}),e.jsx("p",{className:"text-sm text-gray-500",children:h.discount_type==="percentage"?`${h.discount_value}% de desconto`:`${$(h.discount_value)} de desconto`})]})]}),e.jsx(Le,{checked:h.is_active,onCheckedChange:P=>v.mutate({id:h.id,data:{...h,is_active:P}})})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[h.min_order_value>0&&e.jsxs("div",{className:"flex justify-between text-gray-500",children:[e.jsx("span",{children:"Pedido mínimo:"}),e.jsx("span",{children:$(h.min_order_value)})]}),h.max_uses>0&&e.jsxs("div",{className:"flex justify-between text-gray-500",children:[e.jsx("span",{children:"Usos:"}),e.jsxs("span",{children:[h.current_uses||0," / ",h.max_uses]})]}),h.expires_at&&e.jsxs("div",{className:"flex justify-between text-gray-500",children:[e.jsx("span",{children:"Expira em:"}),e.jsx("span",{className:b?"text-red-500":"",children:Ot(new Date(h.expires_at),"dd/MM/yyyy")})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-3 border-t",children:[e.jsxs("div",{className:"flex gap-1",children:[!O&&e.jsx(fe,{variant:"outline",className:"text-xs text-red-500 border-red-200",children:b?"Expirado":L?"Esgotado":"Inativo"}),O&&e.jsx(fe,{className:"bg-green-100 text-green-700 text-xs",children:"Ativo"})]}),e.jsx(D,{size:"icon",variant:"ghost",className:"h-8 w-8 text-red-500 hover:text-red-700",onClick:()=>{confirm("Excluir este cupom?")&&y.mutate(h.id)},children:e.jsx(Ke,{className:"w-4 h-4"})})]})]},h.id)})}),e.jsx(ze,{open:s,onOpenChange:a,children:e.jsxs(Te,{className:"sm:max-w-md max-w-[95vw]",children:[e.jsx(Fe,{children:e.jsxs(Re,{className:"flex items-center gap-2",children:[e.jsx(ri,{className:"w-5 h-5"})," Criar Cupom"]})}),e.jsxs("form",{onSubmit:M,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Código do Cupom"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(U,{value:i.code,onChange:h=>o(b=>({...b,code:h.target.value.toUpperCase()})),placeholder:"Ex: DESCONTO10",className:"font-mono uppercase",required:!0}),e.jsx(D,{type:"button",variant:"outline",onClick:k,children:"Gerar"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Tipo de Desconto"}),e.jsxs(Ce,{value:i.discount_type,onValueChange:h=>o(b=>({...b,discount_type:h})),children:[e.jsx(ke,{children:e.jsx(Se,{})}),e.jsxs(De,{children:[e.jsx(Q,{value:"percentage",children:"Porcentagem (%)"}),e.jsx(Q,{value:"fixed",children:"Valor Fixo (R$)"})]})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Valor do Desconto"}),e.jsx(U,{type:"number",step:"0.01",value:i.discount_value,onChange:h=>o(b=>({...b,discount_value:h.target.value})),placeholder:i.discount_type==="percentage"?"10":"5.00",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Pedido Mínimo (R$)"}),e.jsx(U,{type:"number",step:"0.01",value:i.min_order_value,onChange:h=>o(b=>({...b,min_order_value:h.target.value})),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Limite de Usos"}),e.jsx(U,{type:"number",value:i.max_uses,onChange:h=>o(b=>({...b,max_uses:h.target.value})),placeholder:"Ilimitado"})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Data de Expiração"}),e.jsx(U,{type:"date",value:i.expires_at,onChange:h=>o(b=>({...b,expires_at:h.target.value}))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx(R,{children:"Ativar cupom"}),e.jsx(Le,{checked:i.is_active,onCheckedChange:h=>o(b=>({...b,is_active:h}))})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(D,{type:"button",variant:"outline",onClick:j,className:"flex-1",children:"Cancelar"}),e.jsx(D,{type:"submit",className:"flex-1 bg-orange-500 hover:bg-orange-600",children:"Criar Cupom"})]})]})]})})]})}const Lr=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s||0);function z0({isOpen:s,onClose:a,onSubmit:t,combo:r,dishes:n=[],pizzas:l=[],beverages:c=[]}){const m=(n||[]).filter(u=>u.product_type!=="pizza"&&u.product_type!=="beverage"),i=(l||[]).filter(u=>u.product_type==="pizza"),o=(c||[]).filter(u=>u.product_type==="beverage"),d=i.length>0,p=o.length>0,[x,f]=w.useState(r||{name:"",description:"",type:"bundle_discount",combo_mode:"dishes_beverages",combo_action:"add",dishes:[],beverages:[],original_price:0,combo_price:0,discount_type:"percentage",discount_value:0,buy_quantity:3,pay_quantity:2,is_active:!0,is_highlight:!1,valid_until:""});se.useEffect(()=>{f(r?{...r,dishes:r.dishes||[],beverages:r.beverages||[],combo_mode:r.combo_mode||"dishes_beverages",combo_action:r.combo_action||"add"}:{name:"",description:"",type:"bundle_discount",combo_mode:d?"pizzas_beverages":"dishes_beverages",combo_action:"add",dishes:[],beverages:[],original_price:0,combo_price:0,discount_type:"percentage",discount_value:0,buy_quantity:3,pay_quantity:2,is_active:!0,is_highlight:!1,valid_until:""})},[r,s,d]);const v=x.combo_mode==="pizzas_beverages"?i:m,y=(u,g)=>{const T=x.combo_mode==="pizzas_beverages"?i:m,h=(u||[]).reduce((L,O)=>{const P=T.find(C=>C.id===O.dish_id),F=P?.pizza_config?.sizes?.[0]?.price_tradicional??P?.price??0;return L+(F||0)*O.quantity},0),b=(g||[]).reduce((L,O)=>{const P=o.find(F=>F.id===O.dish_id);return L+(P?.price||0)*O.quantity},0);f(L=>({...L,original_price:h+b}))},j=u=>{const g=x.dishes||[],T=g.find(b=>b.dish_id===u);let h;T?h=g.map(b=>b.dish_id===u?{...b,quantity:b.quantity+1}:b):h=[...g,{dish_id:u,quantity:1}],f(b=>({...b,dishes:h})),y(h,x.beverages)},M=u=>{const g=x.beverages||[],T=g.find(b=>b.dish_id===u);let h;T?h=g.map(b=>b.dish_id===u?{...b,quantity:b.quantity+1}:b):h=[...g,{dish_id:u,quantity:1}],f(b=>({...b,beverages:h})),y(x.dishes,h)},k=u=>{const g=(x.dishes||[]).filter(T=>T.dish_id!==u);f(T=>({...T,dishes:g})),y(g,x.beverages)},z=u=>{const g=(x.beverages||[]).filter(T=>T.dish_id!==u);f(T=>({...T,beverages:g})),y(x.dishes,g)},$=u=>{u.preventDefault(),t(x)};return e.jsx(ze,{open:s,onOpenChange:a,children:e.jsxs(Te,{className:"sm:max-w-3xl max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsx(Fe,{children:e.jsxs(Re,{className:"flex items-center gap-2",children:[e.jsx("span",{children:r?"Editar Combo":"Criar Combo"}),e.jsx(fe,{variant:"outline",children:"Promoções"})]})}),e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(R,{children:"Nome do Combo *"}),e.jsx(U,{value:x.name,onChange:u=>f(g=>({...g,name:u.target.value})),placeholder:"Ex: Combo Executivo",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Tipo de Combinação"}),e.jsxs(Ce,{value:x.combo_mode,onValueChange:u=>f(g=>({...g,combo_mode:u,dishes:[]})),children:[e.jsx(ke,{children:e.jsx(Se,{})}),e.jsxs(De,{children:[e.jsxs(Q,{value:"dishes_beverages",children:[e.jsx(sa,{className:"w-4 h-4 mr-2 inline"})," Pratos + Bebidas"]}),d&&e.jsxs(Q,{value:"pizzas_beverages",children:[e.jsx(Fo,{className:"w-4 h-4 mr-2 inline"})," Pizzas + Bebidas"]})]})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Ação no Carrinho"}),e.jsxs(Ce,{value:x.combo_action,onValueChange:u=>f(g=>({...g,combo_action:u})),children:[e.jsx(ke,{children:e.jsx(Se,{})}),e.jsxs(De,{children:[e.jsx(Q,{value:"add",children:"Adicionar combo ao pedido"}),e.jsx(Q,{value:"replace",children:"Substituir item pelo combo"})]})]})]})]}),e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50 dark:bg-gray-800/50",children:[e.jsx(R,{className:"mb-2 block",children:x.combo_mode==="pizzas_beverages"?"Pizzas":"Pratos"}),e.jsxs(Ce,{onValueChange:j,children:[e.jsx(ke,{children:e.jsx(Se,{placeholder:`Adicionar ${x.combo_mode==="pizzas_beverages"?"pizza":"prato"}`})}),e.jsx(De,{children:v.filter(u=>u.is_active!==!1).map(u=>e.jsxs(Q,{value:u.id,children:[u.name," - ",Lr(u.pizza_config?.sizes?.[0]?.price_tradicional??u.price)]},u.id))})]}),e.jsx("div",{className:"mt-2 space-y-2",children:(x.dishes||[]).map(u=>{const g=v.find(h=>h.id===u.dish_id);if(!g)return null;const T=g.pizza_config?.sizes?.[0]?.price_tradicional??g.price;return e.jsxs("div",{className:"flex items-center justify-between bg-white dark:bg-gray-900 p-2 rounded border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[g.image&&e.jsx("img",{src:g.image,alt:"",className:"w-10 h-10 rounded object-cover"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:g.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[Lr(T)," x ",u.quantity]})]})]}),e.jsx(D,{type:"button",size:"sm",variant:"ghost",onClick:()=>k(u.dish_id),children:e.jsx(ws,{className:"w-4 h-4 text-red-500"})})]},u.dish_id)})})]}),p&&e.jsxs("div",{className:"border rounded-lg p-4 bg-cyan-50/50 dark:bg-cyan-900/10",children:[e.jsxs(R,{className:"mb-2 block flex items-center gap-2",children:[e.jsx(Wu,{className:"w-4 h-4"})," Bebidas"]}),e.jsxs(Ce,{onValueChange:M,children:[e.jsx(ke,{children:e.jsx(Se,{placeholder:"Adicionar bebida"})}),e.jsx(De,{children:o.filter(u=>u.is_active!==!1).map(u=>e.jsxs(Q,{value:u.id,children:[u.name," ",u.volume_ml?`(${u.volume_ml}ml)`:""," - ",Lr(u.price)]},u.id))})]}),e.jsx("div",{className:"mt-2 space-y-2",children:(x.beverages||[]).map(u=>{const g=o.find(T=>T.id===u.dish_id);return g?e.jsxs("div",{className:"flex items-center justify-between bg-white dark:bg-gray-900 p-2 rounded border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[g.image&&e.jsx("img",{src:g.image,alt:"",className:"w-10 h-10 rounded object-cover"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:g.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[Lr(g.price)," x ",u.quantity]})]})]}),e.jsx(D,{type:"button",size:"sm",variant:"ghost",onClick:()=>z(u.dish_id),children:e.jsx(ws,{className:"w-4 h-4 text-red-500"})})]},u.dish_id):null})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Preço Original"}),e.jsx(U,{type:"number",step:"0.01",value:x.original_price,readOnly:!0,className:"bg-gray-100"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Preço do Combo *"}),e.jsx(U,{type:"number",step:"0.01",value:x.combo_price,onChange:u=>f(g=>({...g,combo_price:parseFloat(u.target.value)||0})),required:!0})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Descrição"}),e.jsx(Ms,{value:x.description,onChange:u=>f(g=>({...g,description:u.target.value})),rows:2,placeholder:"Descreva o combo..."})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded",children:[e.jsx(R,{children:"Destacar no cardápio"}),e.jsx(Le,{checked:x.is_highlight,onCheckedChange:u=>f(g=>({...g,is_highlight:u}))})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(D,{type:"button",variant:"outline",onClick:a,className:"flex-1",children:"Cancelar"}),e.jsx(D,{type:"submit",className:"flex-1 bg-orange-500",children:r?"Salvar":"Criar Combo"})]})]})]})})}const xo={enabled:!0,beverage_offer:{enabled:!0,trigger_product_types:["pizza"],min_cart_value:0,dish_id:null,title:"🥤 Que tal uma bebida?",message:"Pizza sem bebida? Adicione {product_name} por apenas {product_price}",discount_percent:0},dessert_offer:{enabled:!0,min_cart_value:40,dish_id:null,title:"🍰 Que tal uma sobremesa?",message:"Complete seu pedido com {product_name} por apenas {product_price}",discount_percent:0},combo_offer:{enabled:!0,min_pizzas:2,dish_id:null,title:"🔥 Oferta Especial!",message:"Compre {min_pizzas} pizzas e ganhe {product_name} GRÁTIS!",discount_percent:100}};function dy(){const[s,a]=w.useState(!1),[t,r]=w.useState(!1),[n,l]=w.useState(null),[c,m]=w.useState(""),[i,o]=w.useState("all"),[d,p]=w.useState("all"),[x,f]=w.useState({name:"",type:"add",trigger_min_value:"",offer_dish_id:"",offer_price:"",original_price:"",description:"",is_active:!0}),v=es(),{menuContext:y}=Ze(),{data:j=[]}=Ae({queryKey:["promotions",y?.type,y?.value],queryFn:async()=>{if(!y)return[];const S={};return y.type==="subscriber"&&y.value&&(S.as_subscriber=y.value),ae.entities.Promotion.list(null,S)},enabled:!!y}),{data:M=[]}=Ht(),{data:k=[]}=Ae({queryKey:["combos",y?.type,y?.value],queryFn:async()=>{if(!y)return[];const S={};return y.type==="subscriber"&&y.value&&(S.as_subscriber=y.value),ae.entities.Combo.list(null,S)},enabled:!!y}),{data:z=[]}=Ae({queryKey:["store",y?.type,y?.value],queryFn:async()=>{if(!y)return[];const S={};return y.type==="subscriber"&&y.value&&(S.as_subscriber=y.value),ae.entities.Store.list(null,S)},enabled:!!y}),$=z[0],[u,g]=w.useState(xo);w.useEffect(()=>{$?.cross_sell_config&&g(S=>({...xo,...$.cross_sell_config}))},[$?.id,$?.cross_sell_config]);const T=le({mutationFn:async S=>{if(!$?.id)throw new Error("Loja não encontrada");const G=y?.type==="subscriber"&&y?.value?{as_subscriber:y.value}:{};return ae.entities.Store.update($.id,{cross_sell_config:S},G)},onSuccess:()=>{v.invalidateQueries({queryKey:["store"]}),Gs.success("Ofertas Inteligentes salvas")},onError:S=>Gs.error(S?.message||"Erro ao salvar")}),h=le({mutationFn:S=>ae.entities.Promotion.create(S),onSuccess:()=>{v.invalidateQueries({queryKey:["promotions"]}),C(),Gs.success("Promoção criada!")}}),b=le({mutationFn:({id:S,data:G})=>ae.entities.Promotion.update(S,G),onSuccess:()=>{v.invalidateQueries({queryKey:["promotions"]}),Gs.success("Promoção atualizada!")}}),L=le({mutationFn:S=>ae.entities.Promotion.delete(S),onSuccess:()=>{v.invalidateQueries({queryKey:["promotions"]}),Gs.success("Promoção excluída!")}}),O=le({mutationFn:S=>ae.entities.Combo.create(S),onSuccess:()=>{v.invalidateQueries({queryKey:["combos"]}),r(!1),l(null),Gs.success("Combo criado!")}}),P=le({mutationFn:({id:S,data:G})=>ae.entities.Combo.update(S,G),onSuccess:()=>{v.invalidateQueries({queryKey:["combos"]}),r(!1),l(null),Gs.success("Combo atualizado!")}}),F=le({mutationFn:S=>ae.entities.Combo.delete(S),onSuccess:()=>{v.invalidateQueries({queryKey:["combos"]}),Gs.success("Combo excluído!")}}),C=()=>{a(!1),f({name:"",type:"add",trigger_min_value:"",offer_dish_id:"",offer_price:"",original_price:"",description:"",is_active:!0})},N=S=>{S.preventDefault(),h.mutate({...x,trigger_min_value:parseFloat(x.trigger_min_value)||0,offer_price:parseFloat(x.offer_price)||0,original_price:parseFloat(x.original_price)||0})},V=S=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(S||0),E=Array.isArray(M)?M:[],ee=w.useMemo(()=>S=>E.find(G=>G.id===S)?.name||"Prato não encontrado",[E]),ue=w.useMemo(()=>Array.isArray(j)?j.filter(S=>{const G=!c||S.name?.toLowerCase().includes(c.toLowerCase())||ee(S.offer_dish_id).toLowerCase().includes(c.toLowerCase()),q=i==="all"||i==="active"&&S.is_active||i==="inactive"&&!S.is_active,ne=d==="all"||S.type===d;return G&&q&&ne}):[],[j,c,i,d,ee]),Z=w.useMemo(()=>{const S=Array.isArray(j)?j:[],G=S.filter(Y=>Y.is_active).length,q=S.filter(Y=>!Y.is_active).length,ne=S.filter(Y=>Y.type==="add").length,Me=S.filter(Y=>Y.type==="replace").length;return{total:S.length,active:G,inactive:q,addType:ne,replaceType:Me}},[j]);return e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[$&&e.jsxs(B,{children:[e.jsxs(oe,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(rr,{className:"w-5 h-5 text-orange-500"}),"Ofertas Inteligentes (Cross-sell)"]}),e.jsx(rs,{children:"Configure ofertas automáticas que aparecem quando o cliente adiciona itens ao carrinho"})]}),e.jsxs(H,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl",children:[e.jsx(Le,{checked:u?.enabled!==!1,onCheckedChange:S=>g(G=>({...G,enabled:S}))}),e.jsxs("div",{className:"flex-1",children:[e.jsx(R,{className:"font-semibold cursor-pointer",children:"Ativar Ofertas Inteligentes"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:"Sugerir produtos complementares automaticamente para aumentar o ticket médio"})]})]}),u?.enabled!==!1&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50 dark:bg-gray-800/50 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"🥤"}),e.jsx(R,{className:"text-base font-semibold",children:"Oferta de Bebida"})]}),e.jsx(Le,{checked:u?.beverage_offer?.enabled!==!1,onCheckedChange:S=>g(G=>({...G,beverage_offer:{...G.beverage_offer,enabled:S}}))})]}),u?.beverage_offer?.enabled!==!1&&e.jsxs("div",{className:"space-y-4 pl-8 border-l-2 border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Produto a Sugerir"}),e.jsxs(Ce,{value:u?.beverage_offer?.dish_id||"",onValueChange:S=>g(G=>({...G,beverage_offer:{...G.beverage_offer,dish_id:S||null}})),children:[e.jsx(ke,{children:e.jsx(Se,{placeholder:"Selecione uma bebida"})}),e.jsx(De,{children:M.filter(S=>S.product_type==="beverage"||S.category?.toLowerCase().includes("bebida")||S.name?.toLowerCase().match(/(coca|pepsi|refrigerante|suco|água|bebida)/i)).map(S=>e.jsxs(Q,{value:S.id,children:[S.name," - ",V(S.price||0)]},S.id))})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Quando o cliente adicionar pizza, esta bebida será sugerida"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Título da Oferta"}),e.jsx(U,{value:u?.beverage_offer?.title||"",onChange:S=>g(G=>({...G,beverage_offer:{...G.beverage_offer,title:S.target.value}})),placeholder:"Ex: 🥤 Que tal uma bebida?"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Mensagem"}),e.jsx(Ms,{value:u?.beverage_offer?.message||"",onChange:S=>g(G=>({...G,beverage_offer:{...G.beverage_offer,message:S.target.value}})),placeholder:"Use {product_name} e {product_price} para valores dinâmicos",rows:2}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Variáveis disponíveis: ","{product_name}",", ","{product_price}"]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx(R,{children:"Desconto (%)"}),e.jsx(U,{type:"number",min:"0",max:"100",value:u?.beverage_offer?.discount_percent||0,onChange:S=>g(G=>({...G,beverage_offer:{...G.beverage_offer,discount_percent:parseInt(S.target.value)||0}}))})]})})]})]}),e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50 dark:bg-gray-800/50 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"🍰"}),e.jsx(R,{className:"text-base font-semibold",children:"Oferta de Sobremesa"})]}),e.jsx(Le,{checked:u?.dessert_offer?.enabled!==!1,onCheckedChange:S=>g(G=>({...G,dessert_offer:{...G.dessert_offer,enabled:S}}))})]}),u?.dessert_offer?.enabled!==!1&&e.jsxs("div",{className:"space-y-4 pl-8 border-l-2 border-purple-200 dark:border-purple-800",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Produto a Sugerir"}),e.jsxs(Ce,{value:u?.dessert_offer?.dish_id||"",onValueChange:S=>g(G=>({...G,dessert_offer:{...G.dessert_offer,dish_id:S||null}})),children:[e.jsx(ke,{children:e.jsx(Se,{placeholder:"Selecione uma sobremesa"})}),e.jsx(De,{children:M.filter(S=>S.category?.toLowerCase().includes("sobremesa")||S.tags?.includes("dessert")||S.name?.toLowerCase().match(/(pudim|brigadeiro|sorvete|açaí|sobremesa)/i)).map(S=>e.jsxs(Q,{value:S.id,children:[S.name," - ",V(S.price||0)]},S.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Valor Mínimo do Carrinho (R$)"}),e.jsx(U,{type:"number",step:"0.01",value:u?.dessert_offer?.min_cart_value||40,onChange:S=>g(G=>({...G,dessert_offer:{...G.dessert_offer,min_cart_value:parseFloat(S.target.value)||0}}))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Oferta aparece quando carrinho ≥ este valor"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Desconto (%)"}),e.jsx(U,{type:"number",min:"0",max:"100",value:u?.dessert_offer?.discount_percent||0,onChange:S=>g(G=>({...G,dessert_offer:{...G.dessert_offer,discount_percent:parseInt(S.target.value)||0}}))})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Título da Oferta"}),e.jsx(U,{value:u?.dessert_offer?.title||"",onChange:S=>g(G=>({...G,dessert_offer:{...G.dessert_offer,title:S.target.value}})),placeholder:"Ex: 🍰 Que tal uma sobremesa?"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Mensagem"}),e.jsx(Ms,{value:u?.dessert_offer?.message||"",onChange:S=>g(G=>({...G,dessert_offer:{...G.dessert_offer,message:S.target.value}})),placeholder:"Use {product_name} e {product_price} para valores dinâmicos",rows:2})]})]})]}),e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50 dark:bg-gray-800/50 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"🔥"}),e.jsx(R,{className:"text-base font-semibold",children:"Oferta de Combo Especial"})]}),e.jsx(Le,{checked:u?.combo_offer?.enabled!==!1,onCheckedChange:S=>g(G=>({...G,combo_offer:{...G.combo_offer,enabled:S}}))})]}),u?.combo_offer?.enabled!==!1&&e.jsxs("div",{className:"space-y-4 pl-8 border-l-2 border-orange-200 dark:border-orange-800",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Produto Grátis"}),e.jsxs(Ce,{value:u?.combo_offer?.dish_id||"",onValueChange:S=>g(G=>({...G,combo_offer:{...G.combo_offer,dish_id:S||null}})),children:[e.jsx(ke,{children:e.jsx(Se,{placeholder:"Selecione o produto grátis"})}),e.jsx(De,{children:M.filter(S=>S.is_active!==!1).map(S=>e.jsxs(Q,{value:S.id,children:[S.name," - ",V(S.price||0)]},S.id))})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Produto que será oferecido grátis no combo"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx(R,{children:"Mínimo de Pizzas"}),e.jsx(U,{type:"number",min:"1",value:u?.combo_offer?.min_pizzas||2,onChange:S=>g(G=>({...G,combo_offer:{...G.combo_offer,min_pizzas:parseInt(S.target.value)||2}}))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Oferta aparece quando cliente tem esta quantidade de pizzas"})]})}),e.jsxs("div",{children:[e.jsx(R,{children:"Título da Oferta"}),e.jsx(U,{value:u?.combo_offer?.title||"",onChange:S=>g(G=>({...G,combo_offer:{...G.combo_offer,title:S.target.value}})),placeholder:"Ex: 🔥 Oferta Especial!"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Mensagem"}),e.jsx(Ms,{value:u?.combo_offer?.message||"",onChange:S=>g(G=>({...G,combo_offer:{...G.combo_offer,message:S.target.value}})),placeholder:"Use {product_name}, {min_pizzas} para valores dinâmicos",rows:2}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Variáveis: ","{product_name}",", ","{min_pizzas}"]})]})]})]})]}),e.jsx(D,{onClick:()=>T.mutate(u),disabled:T.isPending,children:T.isPending?"Salvando...":"Salvar Ofertas Inteligentes"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(B,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold",children:Z.total})]}),e.jsx(Xr,{className:"w-8 h-8 text-orange-500"})]})})}),e.jsx(B,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Ativas"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:Z.active})]}),e.jsx(Ls,{className:"w-8 h-8 text-green-500"})]})})}),e.jsx(B,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Adicionar"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:Z.addType})]}),e.jsx(Ie,{className:"w-8 h-8 text-blue-500"})]})})}),e.jsx(B,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Substituir"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:Z.replaceType})]}),e.jsx(Fl,{className:"w-8 h-8 text-purple-500"})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(_s,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(U,{placeholder:"Buscar promoção ou prato...",value:c,onChange:S=>m(S.target.value),className:"pl-10"})]}),e.jsxs(Ce,{value:i,onValueChange:o,children:[e.jsxs(ke,{className:"w-[140px]",children:[e.jsx(oa,{className:"w-4 h-4 mr-2"}),e.jsx(Se,{})]}),e.jsxs(De,{children:[e.jsx(Q,{value:"all",children:"Todos"}),e.jsx(Q,{value:"active",children:"Ativas"}),e.jsx(Q,{value:"inactive",children:"Inativas"})]})]}),e.jsxs(Ce,{value:d,onValueChange:p,children:[e.jsx(ke,{className:"w-[160px]",children:e.jsx(Se,{})}),e.jsxs(De,{children:[e.jsx(Q,{value:"all",children:"Todos os tipos"}),e.jsx(Q,{value:"add",children:"Adicionar"}),e.jsx(Q,{value:"replace",children:"Substituir"})]})]}),e.jsxs(D,{onClick:()=>a(!0),className:"bg-orange-500 hover:bg-orange-600",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Nova Promoção"]}),e.jsxs(D,{variant:"outline",onClick:()=>{l(null),r(!0)},className:"border-purple-300 text-purple-700 hover:bg-purple-50",children:[e.jsx(tr,{className:"w-4 h-4 mr-2"}),"Criar Combo"]})]}),e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4",children:ue.length===0?e.jsxs("div",{className:"col-span-full text-center py-12 text-gray-400 border-2 border-dashed rounded-xl",children:[e.jsx(Xr,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Nenhuma promoção cadastrada"})]}):ue.map(S=>e.jsxs("div",{className:`bg-white rounded-xl p-4 shadow-sm border-2 ${S.is_active?"border-green-200":"border-gray-200 opacity-60"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs(fe,{className:S.type==="add"?"bg-blue-500":"bg-purple-500",children:[S.type==="add"?e.jsx(Ie,{className:"w-3 h-3 mr-1"}):e.jsx(Fl,{className:"w-3 h-3 mr-1"}),S.type==="add"?"Adicionar":"Substituir"]}),e.jsx("h3",{className:"font-bold mt-2",children:S.name})]}),e.jsx(Le,{checked:S.is_active,onCheckedChange:G=>b.mutate({id:S.id,data:{...S,is_active:G}})})]}),e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:ee(S.offer_dish_id)}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[S.original_price>S.offer_price&&e.jsx("span",{className:"text-sm text-gray-400 line-through",children:V(S.original_price)}),e.jsx("span",{className:"font-bold text-green-600",children:V(S.offer_price)})]}),S.trigger_min_value>0&&e.jsxs("p",{className:"text-xs text-gray-400",children:["Pedido mínimo: ",V(S.trigger_min_value)]}),e.jsx("div",{className:"mt-3 pt-3 border-t flex justify-end",children:e.jsx(D,{size:"sm",variant:"ghost",className:"text-red-500 hover:text-red-700",onClick:()=>{confirm("Excluir esta promoção?")&&L.mutate(S.id)},children:e.jsx(Ke,{className:"w-4 h-4"})})})]},S.id))}),e.jsxs(B,{className:"mt-8",children:[e.jsxs(oe,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(tr,{className:"w-5 h-5"}),"Combos"]}),e.jsx(rs,{children:"Pratos + Bebidas ou Pizzas + Bebidas. Adicionar ao carrinho ou substituir item."})]}),e.jsx(H,{children:e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4",children:Array.isArray(k)&&k.length===0?e.jsxs("div",{className:"col-span-full text-center py-8 text-gray-500 border-2 border-dashed rounded-xl",children:[e.jsx(tr,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Nenhum combo cadastrado"}),e.jsx(D,{variant:"outline",className:"mt-3",onClick:()=>r(!0),children:"Criar primeiro combo"})]}):(k||[]).map(S=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 border flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"font-bold",children:S.name}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(D,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{l(S),r(!0)},children:e.jsx(Rs,{className:"w-4 h-4"})}),e.jsx(D,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-500",onClick:()=>confirm("Excluir combo?")&&F.mutate(S.id),children:e.jsx(Ke,{className:"w-4 h-4"})})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mb-2",children:[S.combo_mode==="pizzas_beverages"?"Pizzas + Bebidas":"Pratos + Bebidas"," · ",S.combo_action==="replace"?"Substituir":"Adicionar"]}),e.jsx("p",{className:"font-bold text-green-600",children:V(S.combo_price)}),S.original_price>S.combo_price&&e.jsx("p",{className:"text-xs text-gray-400 line-through",children:V(S.original_price)})]},S.id))})})]}),e.jsx(z0,{isOpen:t,onClose:()=>{r(!1),l(null)},onSubmit:S=>n?P.mutate({id:n.id,data:S}):O.mutate(S),combo:n,dishes:E,pizzas:(M||[]).filter(S=>S.product_type==="pizza"),beverages:(M||[]).filter(S=>S.product_type==="beverage")}),e.jsx(ze,{open:s,onOpenChange:a,children:e.jsxs(Te,{className:"sm:max-w-md max-w-[95vw]",children:[e.jsx(Fe,{children:e.jsx(Re,{children:"Nova Promoção Upsell"})}),e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome da Promoção"}),e.jsx(U,{value:x.name,onChange:S=>f(G=>({...G,name:S.target.value})),placeholder:"Ex: Adicione uma sobremesa!",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Tipo"}),e.jsxs(Ce,{value:x.type,onValueChange:S=>f(G=>({...G,type:S})),children:[e.jsx(ke,{children:e.jsx(Se,{})}),e.jsxs(De,{children:[e.jsx(Q,{value:"add",children:"Adicionar ao pedido"}),e.jsx(Q,{value:"replace",children:"Substituir item"})]})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Prato Oferecido"}),e.jsxs(Ce,{value:x.offer_dish_id,onValueChange:S=>{const G=E.find(q=>q.id===S);f(q=>({...q,offer_dish_id:S,original_price:G?.price?.toString()||""}))},children:[e.jsx(ke,{children:e.jsx(Se,{placeholder:"Selecione um prato"})}),e.jsx(De,{children:(Array.isArray(M)?M:[]).filter(S=>S.is_active!==!1).map(S=>e.jsxs(Q,{value:S.id,children:[S.name," - ",V(S.price)]},S.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Preço Original"}),e.jsx(U,{type:"number",step:"0.01",value:x.original_price,onChange:S=>f(G=>({...G,original_price:S.target.value})),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Preço Promocional"}),e.jsx(U,{type:"number",step:"0.01",value:x.offer_price,onChange:S=>f(G=>({...G,offer_price:S.target.value})),placeholder:"0.00",required:!0})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Pedido Mínimo (opcional)"}),e.jsx(U,{type:"number",step:"0.01",value:x.trigger_min_value,onChange:S=>f(G=>({...G,trigger_min_value:S.target.value})),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Descrição"}),e.jsx(Ms,{value:x.description,onChange:S=>f(G=>({...G,description:S.target.value})),placeholder:"Descrição opcional..."})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(D,{type:"button",variant:"outline",onClick:C,className:"flex-1",children:"Cancelar"}),e.jsx(D,{type:"submit",className:"flex-1 bg-orange-500 hover:bg-orange-600",children:"Criar"})]})]})]})})]})}async function gd(s){return new Promise((a,t)=>{const r=new Image;r.crossOrigin="anonymous",r.onload=()=>{try{const n=document.createElement("canvas"),l=n.getContext("2d"),c=200,m=Math.min(c/r.width,c/r.height,1);n.width=r.width*m,n.height=r.height*m,l.drawImage(r,0,0,n.width,n.height);const o=l.getImageData(0,0,n.width,n.height).data,d=new Map,p=4;for(let k=0;k<o.length;k+=p*4){const z=o[k],$=o[k+1],u=o[k+2];if(o[k+3]<128||z>250&&$>250&&u>250||z<5&&$<5&&u<5)continue;const T=Math.floor(z/32)*32,h=Math.floor($/32)*32,b=Math.floor(u/32)*32,L=`${T},${h},${b}`;d.has(L)?d.set(L,d.get(L)+1):d.set(L,1)}const x=Array.from(d.entries()).sort((k,z)=>z[1]-k[1]).slice(0,10);if(x.length===0){a({primary:"#8b5cf6",secondary:"#1e1b4b",accent:"#a855f7"});return}const f=x.map(([k,z])=>{const[$,u,g]=k.split(",").map(Number);return{hex:`#${[$,u,g].map(T=>{const h=T.toString(16);return h.length===1?"0"+h:h}).join("")}`,count:z}}),v=f[0].hex;let y=f[1]?.hex||f[0].hex;const j=un(y);j&&j.r+j.g+j.b>500&&(y=F0(y,.6));let M=f.find(k=>{const z=un(k.hex);return z?T0(z)>.5:!1})?.hex||v;M===v&&(M=R0(v,.2)),a({primary:v,secondary:y,accent:M})}catch(n){console.error("Erro ao extrair cores:",n),t(n)}},r.onerror=()=>{t(new Error("Erro ao carregar imagem"))},r.src=s})}function un(s){const a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(s);return a?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null}function T0(s){const a=Math.max(s.r,s.g,s.b),t=Math.min(s.r,s.g,s.b),r=a-t;return a===0?0:r/a}function F0(s,a){const t=un(s);return t?`#${[t.r,t.g,t.b].map(r=>Math.max(0,Math.floor(r*a))).map(r=>{const n=r.toString(16);return n.length===1?"0"+n:n}).join("")}`:s}function R0(s,a){const t=un(s);return t?`#${[t.r,t.g,t.b].map(r=>Math.min(255,Math.floor(r+(255-r)*a))).map(r=>{const n=r.toString(16);return n.length===1?"0"+n:n}).join("")}`:s}const L0=[{name:"Laranja",primary:"#f97316",secondary:"#1f2937",accent:"#eab308"},{name:"Verde",primary:"#22c55e",secondary:"#1f2937",accent:"#10b981"},{name:"Azul",primary:"#3b82f6",secondary:"#1e293b",accent:"#0ea5e9"},{name:"Vermelho",primary:"#ef4444",secondary:"#1f2937",accent:"#f97316"},{name:"Roxo",primary:"#8b5cf6",secondary:"#1e1b4b",accent:"#a855f7"},{name:"Rosa",primary:"#ec4899",secondary:"#1f2937",accent:"#f472b6"}],I0=[{name:"Sunset",start:"#ff6b6b",end:"#ffd93d",direction:"to-br"},{name:"Ocean",start:"#667eea",end:"#764ba2",direction:"to-r"},{name:"Fire",start:"#ff416c",end:"#ff4b2b",direction:"to-r"},{name:"Forest",start:"#134e5e",end:"#71b280",direction:"to-br"},{name:"Aurora",start:"#a8edea",end:"#fed6e3",direction:"to-r"},{name:"Royal",start:"#141e30",end:"#243b55",direction:"to-br"}],$0={"to-r":"→ Horizontal","to-br":"↘ Diagonal SE","to-b":"↓ Vertical","to-bl":"↙ Diagonal SO","to-l":"← Horizontal Inv.","to-tl":"↖ Diagonal NO","to-t":"↑ Vertical Inv.","to-tr":"↗ Diagonal NE"};function my(){const{currentTheme:s,activeTheme:a,customTheme:t,setTheme:r,setCustomThemeColors:n,resetToPreset:l,themes:c}=xn(),[m,i]=w.useState({theme_primary_color:"#f97316",theme_secondary_color:"#1f2937",theme_accent_color:"#eab308",theme_gradient_enabled:!1,theme_gradient_start:"#f97316",theme_gradient_end:"#ef4444",theme_gradient_direction:"to-r",theme_button_style:"rounded",theme_shadow_enabled:!0,menu_layout:"grid"}),[o,d]=w.useState({bgPrimary:a.colors.bgPrimary,bgSecondary:a.colors.bgSecondary,bgCard:a.colors.bgCard,textPrimary:a.colors.textPrimary,textSecondary:a.colors.textSecondary,borderColor:a.colors.borderColor,accent:a.colors.accent}),[p,x]=w.useState(!1),[f,v]=w.useState(!1),y=es(),{menuContext:j}=Ze(),{data:M=[]}=Ae({queryKey:["store",j?.type,j?.value],queryFn:async()=>{if(!j)return[];const N={};return j.type==="subscriber"&&j.value&&(N.as_subscriber=j.value),ae.entities.Store.list(null,N)},enabled:!!j}),k=M[0];w.useEffect(()=>{k&&i({theme_primary_color:k.theme_primary_color||"#f97316",theme_secondary_color:k.theme_secondary_color||"#1f2937",theme_accent_color:k.theme_accent_color||"#eab308",theme_gradient_enabled:k.theme_gradient_enabled||!1,theme_gradient_start:k.theme_gradient_start||"#f97316",theme_gradient_end:k.theme_gradient_end||"#ef4444",theme_gradient_direction:k.theme_gradient_direction||"to-r",theme_button_style:k.theme_button_style||"rounded",theme_shadow_enabled:k.theme_shadow_enabled!==!1,menu_layout:k.menu_layout||"grid"})},[k]),w.useEffect(()=>{d({bgPrimary:a.colors.bgPrimary,bgSecondary:a.colors.bgSecondary,bgCard:a.colors.bgCard,textPrimary:a.colors.textPrimary,textSecondary:a.colors.textSecondary,borderColor:a.colors.borderColor,accent:a.colors.accent})},[a]);const z=le({mutationFn:N=>ae.entities.Store.update(k.id,N),onSuccess:()=>{y.invalidateQueries({queryKey:["store"]}),v(!1),W.success("Tema salvo com sucesso!")}}),$=(N,V)=>{i(E=>({...E,[N]:V})),v(!0)},u=(N,V)=>{const E={...o,[N]:V};d(E),n(E),v(!0)},g=N=>{i(V=>({...V,theme_primary_color:N.primary,theme_secondary_color:N.secondary,theme_accent_color:N.accent})),v(!0)},T=N=>{i(V=>({...V,theme_gradient_start:N.start,theme_gradient_end:N.end,theme_gradient_direction:N.direction,theme_gradient_enabled:!0})),v(!0)},[h,b]=w.useState(!1),L=async()=>{if(!k?.logo){W.error("Por favor, adicione uma logo primeiro em Configurações da Loja");return}b(!0);try{const N=await gd(k.logo);i(V=>({...V,theme_primary_color:N.primary,theme_secondary_color:N.secondary,theme_accent_color:N.accent})),v(!0),W.success("Cores extraídas da logo com sucesso!")}catch(N){console.error("Erro ao extrair cores:",N),W.error("Erro ao extrair cores da logo. Verifique se a imagem está acessível.")}finally{b(!1)}},O=()=>{x(!0)},P=()=>{z.mutate({...k,...m}),x(!1)},F=()=>m.theme_gradient_enabled?{background:`linear-gradient(${{"to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left","to-t":"to top","to-tr":"to top right"}[m.theme_gradient_direction]}, ${m.theme_gradient_start}, ${m.theme_gradient_end})`}:{backgroundColor:m.theme_primary_color},C=()=>{const N="px-4 py-2 text-white font-medium transition-all",V=m.theme_shadow_enabled?"shadow-lg hover:shadow-xl":"",E={rounded:"rounded-lg",square:"rounded-none",pill:"rounded-full"}[m.theme_button_style];return`${N} ${E} ${V}`};return e.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"relative rounded-2xl p-6 sm:p-8 overflow-hidden",style:{background:`linear-gradient(135deg, ${a.colors.accent}15, ${a.colors.accent}05)`,border:`1px solid ${a.colors.borderColor}`},children:[e.jsx("div",{className:"relative z-10",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg",style:{backgroundColor:`${a.colors.accent}20`},children:e.jsx(Vl,{className:"w-6 h-6",style:{color:a.colors.accent}})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",style:{color:a.colors.textPrimary},children:"Personalização de Temas"}),e.jsx("p",{className:"text-sm",style:{color:a.colors.textSecondary},children:"Configure a aparência do seu painel administrativo"})]})]})}),e.jsx("div",{className:"absolute inset-0 opacity-5",style:{backgroundImage:`radial-gradient(circle at 20% 50%, ${a.colors.accent} 0%, transparent 50%)`}})]}),e.jsxs(Yi,{defaultValue:"presets",className:"w-full",children:[e.jsxs(Gi,{className:"grid w-full grid-cols-5 mb-6",style:{backgroundColor:a.colors.bgSecondary},children:[e.jsxs(ta,{value:"presets",className:"data-[state=active]:bg-white dark:data-[state=active]:bg-gray-800",children:[e.jsx(Es,{className:"w-4 h-4 mr-2"}),"Temas"]}),e.jsxs(ta,{value:"colors",className:"data-[state=active]:bg-white dark:data-[state=active]:bg-gray-800",children:[e.jsx(Vl,{className:"w-4 h-4 mr-2"}),"Cores"]}),e.jsxs(ta,{value:"gradient",className:"data-[state=active]:bg-white dark:data-[state=active]:bg-gray-800",children:[e.jsx(rr,{className:"w-4 h-4 mr-2"}),"Gradientes"]}),e.jsxs(ta,{value:"layout",className:"data-[state=active]:bg-white dark:data-[state=active]:bg-gray-800",children:[e.jsx(Ja,{className:"w-4 h-4 mr-2"}),"Layout"]}),e.jsxs(ta,{value:"advanced",className:"data-[state=active]:bg-white dark:data-[state=active]:bg-gray-800",children:[e.jsx(ct,{className:"w-4 h-4 mr-2"}),"Avançado"]})]}),e.jsx(ra,{value:"presets",className:"space-y-6",children:e.jsxs(B,{style:{backgroundColor:a.colors.bgCard,borderColor:a.colors.borderColor},children:[e.jsxs(oe,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Ja,{className:"w-5 h-5"}),"Temas Pré-definidos"]}),e.jsx(rs,{children:"Escolha um tema pronto ou personalize suas cores"})]}),e.jsxs(H,{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(c).map(([N,V])=>e.jsxs("button",{onClick:()=>{r(N),l()},className:`relative p-4 rounded-xl border-2 transition-all text-left group ${s===N&&!t?"ring-2 ring-offset-2":"hover:border-opacity-60"}`,style:{backgroundColor:V.colors.bgCard,borderColor:s===N&&!t?a.colors.accent:a.colors.borderColor,ringColor:a.colors.accent},children:[s===N&&!t&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsxs(fe,{className:"bg-green-500 text-white",style:{backgroundColor:a.colors.accent},children:[e.jsx(aa,{className:"w-3 h-3 mr-1"}),"Ativo"]})}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[V.mode==="dark"?e.jsx(cu,{className:"w-5 h-5",style:{color:V.colors.accent}}):e.jsx(du,{className:"w-5 h-5",style:{color:V.colors.accent}}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",style:{color:V.colors.textPrimary},children:V.name}),e.jsx("p",{className:"text-xs",style:{color:V.colors.textSecondary},children:V.mode==="dark"?"Modo Escuro":"Modo Claro"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg",style:{backgroundColor:V.colors.bgPrimary}}),e.jsx("div",{className:"w-8 h-8 rounded-lg",style:{backgroundColor:V.colors.bgSecondary}}),e.jsx("div",{className:"w-8 h-8 rounded-lg",style:{backgroundColor:V.colors.accent}})]})]},N))}),t&&e.jsx("div",{className:"mt-6 p-4 rounded-lg border-2 border-dashed",style:{borderColor:a.colors.borderColor},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",style:{color:a.colors.textPrimary},children:"Tema Personalizado"}),e.jsx("p",{className:"text-sm",style:{color:a.colors.textSecondary},children:"Você está usando um tema customizado"})]}),e.jsxs(D,{variant:"outline",onClick:l,size:"sm",children:[e.jsx(Bl,{className:"w-4 h-4 mr-2"}),"Resetar"]})]})})]})]})}),e.jsxs(ra,{value:"colors",className:"space-y-6",children:[e.jsxs(B,{style:{backgroundColor:a.colors.bgCard,borderColor:a.colors.borderColor},children:[e.jsx(oe,{children:e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(qa,{className:"w-5 h-5"}),"Preview em Tempo Real"]})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-3 items-center flex-wrap",children:[e.jsx("div",{className:C(),style:F(),children:"Botão Primário"}),e.jsx("div",{className:"px-4 py-2 rounded-lg text-white font-medium",style:{backgroundColor:m.theme_secondary_color},children:"Secundário"}),e.jsx("div",{className:"px-4 py-2 rounded-lg text-white font-medium",style:{backgroundColor:m.theme_accent_color},children:"Destaque"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:m.theme_primary_color},children:[e.jsx("p",{className:"text-white text-sm font-medium",children:"Primária"}),e.jsx("p",{className:"text-white text-xs opacity-80",children:m.theme_primary_color})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:m.theme_secondary_color},children:[e.jsx("p",{className:"text-white text-sm font-medium",children:"Secundária"}),e.jsx("p",{className:"text-white text-xs opacity-80",children:m.theme_secondary_color})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:m.theme_accent_color},children:[e.jsx("p",{className:"text-white text-sm font-medium",children:"Destaque"}),e.jsx("p",{className:"text-white text-xs opacity-80",children:m.theme_accent_color})]})]})]})})]}),k?.logo&&e.jsxs(B,{style:{backgroundColor:a.colors.bgCard,borderColor:a.colors.borderColor},children:[e.jsxs(oe,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(an,{className:"w-5 h-5"}),"Extrair Cores da Logo"]}),e.jsx(rs,{children:"Extrai automaticamente as cores principais da sua logo para usar como tema"})]}),e.jsx(H,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-lg overflow-hidden border-2 flex-shrink-0",style:{borderColor:a.colors.borderColor},children:e.jsx("img",{src:k.logo,alt:"Logo",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm mb-3",style:{color:a.colors.textSecondary},children:"Clique no botão abaixo para extrair as cores dominantes da sua logo e aplicá-las automaticamente como tema."}),e.jsx(D,{onClick:L,disabled:h,style:{backgroundColor:a.colors.accent},children:h?e.jsxs(e.Fragment,{children:[e.jsx(Xr,{className:"w-4 h-4 mr-2 animate-spin"}),"Extraindo cores..."]}):e.jsxs(e.Fragment,{children:[e.jsx(an,{className:"w-4 h-4 mr-2"}),"Extrair Cores da Logo"]})})]})]})})]}),e.jsxs(B,{style:{backgroundColor:a.colors.bgCard,borderColor:a.colors.borderColor},children:[e.jsxs(oe,{children:[e.jsx(ce,{children:"Temas de Cores Prontos"}),e.jsx(rs,{children:"Escolha uma paleta de cores pré-definida"})]}),e.jsx(H,{children:e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-6 gap-3",children:L0.map(N=>e.jsxs("button",{onClick:()=>g(N),className:`p-3 rounded-xl border-2 hover:border-opacity-60 transition-all text-center group ${m.theme_primary_color===N.primary?"ring-2 ring-offset-2":""}`,style:{borderColor:m.theme_primary_color===N.primary?a.colors.accent:a.colors.borderColor,ringColor:a.colors.accent},children:[e.jsxs("div",{className:"flex gap-1 justify-center mb-2",children:[e.jsx("div",{className:"w-5 h-5 rounded-full border-2 border-white shadow-sm",style:{backgroundColor:N.primary}}),e.jsx("div",{className:"w-5 h-5 rounded-full border-2 border-white shadow-sm",style:{backgroundColor:N.secondary}}),e.jsx("div",{className:"w-5 h-5 rounded-full border-2 border-white shadow-sm",style:{backgroundColor:N.accent}})]}),e.jsx("span",{className:"text-xs font-medium",children:N.name}),m.theme_primary_color===N.primary&&e.jsx(aa,{className:"w-3 h-3 mx-auto mt-1",style:{color:a.colors.accent}})]},N.name))})})]}),e.jsxs(B,{style:{backgroundColor:a.colors.bgCard,borderColor:a.colors.borderColor},children:[e.jsxs(oe,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(ku,{className:"w-5 h-5"}),"Cores Personalizadas"]}),e.jsx(rs,{children:"Ajuste cada cor individualmente"})]}),e.jsx(H,{children:e.jsxs("div",{className:"grid sm:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Cor Primária"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:m.theme_primary_color,onChange:N=>$("theme_primary_color",N.target.value),className:"w-14 h-12 rounded-lg border-2 cursor-pointer",style:{borderColor:a.colors.borderColor}}),e.jsx(U,{value:m.theme_primary_color,onChange:N=>$("theme_primary_color",N.target.value),className:"font-mono uppercase text-sm"})]})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Cor Secundária"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:m.theme_secondary_color,onChange:N=>$("theme_secondary_color",N.target.value),className:"w-14 h-12 rounded-lg border-2 cursor-pointer",style:{borderColor:a.colors.borderColor}}),e.jsx(U,{value:m.theme_secondary_color,onChange:N=>$("theme_secondary_color",N.target.value),className:"font-mono uppercase text-sm"})]})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Cor de Destaque"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:m.theme_accent_color,onChange:N=>$("theme_accent_color",N.target.value),className:"w-14 h-12 rounded-lg border-2 cursor-pointer",style:{borderColor:a.colors.borderColor}}),e.jsx(U,{value:m.theme_accent_color,onChange:N=>$("theme_accent_color",N.target.value),className:"font-mono uppercase text-sm"})]})]})]})})]}),e.jsxs(B,{style:{backgroundColor:a.colors.bgCard,borderColor:a.colors.borderColor},children:[e.jsxs(oe,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(ct,{className:"w-5 h-5"}),"Cores Avançadas do Tema"]}),e.jsx(rs,{children:"Personalize cores de fundo, texto e bordas"})]}),e.jsx(H,{children:e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-4 gap-4",children:Object.entries(o).map(([N,V])=>e.jsxs("div",{children:[e.jsx(R,{className:"text-xs font-medium mb-2 block capitalize",children:N.replace(/([A-Z])/g," $1").trim()}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:V,onChange:E=>u(N,E.target.value),className:"w-12 h-10 rounded-lg border-2 cursor-pointer",style:{borderColor:a.colors.borderColor}}),e.jsx(U,{value:V,onChange:E=>u(N,E.target.value),className:"font-mono text-xs"})]})]},N))})})]})]}),e.jsxs(ra,{value:"gradient",className:"space-y-6",children:[e.jsx(B,{style:{backgroundColor:a.colors.bgCard,borderColor:a.colors.borderColor},children:e.jsx(oe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ce,{children:"Habilitar Gradiente"}),e.jsx(rs,{children:"Aplica efeito de gradiente nos botões primários"})]}),e.jsx(Le,{checked:m.theme_gradient_enabled,onCheckedChange:N=>$("theme_gradient_enabled",N)})]})})}),m.theme_gradient_enabled&&e.jsxs(e.Fragment,{children:[e.jsxs(B,{style:{backgroundColor:a.colors.bgCard,borderColor:a.colors.borderColor},children:[e.jsx(oe,{children:e.jsx(ce,{children:"Preview do Gradiente"})}),e.jsx(H,{children:e.jsx("div",{className:"w-full h-32 rounded-xl flex items-center justify-center text-white text-lg font-bold shadow-lg",style:F(),children:"Gradiente Aplicado"})})]}),e.jsxs(B,{style:{backgroundColor:a.colors.bgCard,borderColor:a.colors.borderColor},children:[e.jsxs(oe,{children:[e.jsx(ce,{children:"Gradientes Prontos"}),e.jsx(rs,{children:"Escolha um gradiente pré-definido"})]}),e.jsx(H,{children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:I0.map(N=>e.jsxs("button",{onClick:()=>T(N),className:"group relative overflow-hidden rounded-xl border-2 transition-all",style:{borderColor:m.theme_gradient_start===N.start&&m.theme_gradient_end===N.end?a.colors.accent:a.colors.borderColor},children:[e.jsx("div",{className:"h-20 flex items-center justify-center text-white font-medium",style:{background:`linear-gradient(${N.direction==="to-r"?"to right":N.direction==="to-br"?"to bottom right":"to right"}, ${N.start}, ${N.end})`},children:N.name}),m.theme_gradient_start===N.start&&m.theme_gradient_end===N.end&&e.jsx("div",{className:"absolute top-2 right-2 bg-white rounded-full p-1",children:e.jsx(aa,{className:"w-3 h-3",style:{color:a.colors.accent}})})]},N.name))})})]}),e.jsxs(B,{style:{backgroundColor:a.colors.bgCard,borderColor:a.colors.borderColor},children:[e.jsx(oe,{children:e.jsx(ce,{children:"Gradiente Personalizado"})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Cor Inicial"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:m.theme_gradient_start,onChange:N=>$("theme_gradient_start",N.target.value),className:"w-14 h-12 rounded-lg border-2 cursor-pointer",style:{borderColor:a.colors.borderColor}}),e.jsx(U,{value:m.theme_gradient_start,onChange:N=>$("theme_gradient_start",N.target.value),className:"font-mono uppercase text-sm"})]})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Cor Final"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:m.theme_gradient_end,onChange:N=>$("theme_gradient_end",N.target.value),className:"w-14 h-12 rounded-lg border-2 cursor-pointer",style:{borderColor:a.colors.borderColor}}),e.jsx(U,{value:m.theme_gradient_end,onChange:N=>$("theme_gradient_end",N.target.value),className:"font-mono uppercase text-sm"})]})]})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Direção do Gradiente"}),e.jsxs(Ce,{value:m.theme_gradient_direction,onValueChange:N=>$("theme_gradient_direction",N),children:[e.jsx(ke,{children:e.jsx(Se,{})}),e.jsx(De,{children:Object.entries($0).map(([N,V])=>e.jsx(Q,{value:N,children:V},N))})]})]})]})})]})]})]}),e.jsxs(ra,{value:"advanced",className:"space-y-6",children:[e.jsxs(B,{style:{backgroundColor:a.colors.bgCard,borderColor:a.colors.borderColor},children:[e.jsx(oe,{children:e.jsx(ce,{children:"Estilo dos Botões"})}),e.jsx(H,{children:e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{value:"rounded",label:"Arredondado",class:"rounded-lg"},{value:"square",label:"Quadrado",class:"rounded-none"},{value:"pill",label:"Pílula",class:"rounded-full"}].map(N=>e.jsxs("button",{onClick:()=>$("theme_button_style",N.value),className:`p-4 border-2 transition-all ${m.theme_button_style===N.value?"ring-2 ring-offset-2":""}`,style:{borderColor:m.theme_button_style===N.value?a.colors.accent:a.colors.borderColor,ringColor:a.colors.accent},children:[e.jsx("div",{className:`w-full h-10 ${N.class} mb-2 flex items-center justify-center text-white text-xs font-medium`,style:{backgroundColor:a.colors.accent},children:"Exemplo"}),e.jsx("span",{className:"text-xs font-medium",children:N.label}),m.theme_button_style===N.value&&e.jsx(aa,{className:"w-3 h-3 mx-auto mt-1",style:{color:a.colors.accent}})]},N.value))})})]}),e.jsxs(B,{style:{backgroundColor:a.colors.bgCard,borderColor:a.colors.borderColor},children:[e.jsx(oe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ce,{children:"Sombras nos Elementos"}),e.jsx(rs,{children:"Adiciona profundidade visual aos botões e cards"})]}),e.jsx(Le,{checked:m.theme_shadow_enabled,onCheckedChange:N=>$("theme_shadow_enabled",N)})]})}),e.jsx(H,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{className:`p-4 text-white rounded-lg text-center font-medium ${m.theme_shadow_enabled?"shadow-lg":""}`,style:{backgroundColor:a.colors.accent},children:"Com Sombra"}),e.jsx("div",{className:"p-4 text-white rounded-lg text-center font-medium",style:{backgroundColor:a.colors.accent},children:"Sem Sombra"})]})})]})]}),e.jsx(ra,{value:"layout",className:"space-y-6",children:e.jsxs(B,{style:{backgroundColor:a.colors.bgCard,borderColor:a.colors.borderColor},children:[e.jsxs(oe,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Ja,{className:"w-5 h-5"}),"Layout do Cardápio"]}),e.jsx(rs,{children:"Escolha como os pratos serão exibidos no cardápio digital"})]}),e.jsx(H,{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(R,{className:"mb-3 block",children:"Estilo de Apresentação"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("button",{onClick:()=>$("menu_layout","grid"),className:`p-4 rounded-xl border-2 transition-all text-left ${m.menu_layout==="grid"?"border-orange-500 bg-orange-50 dark:bg-orange-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx($o,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"Grid (Padrão)"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Blocos lado a lado, ideal para visualização rápida"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"h-16 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-16 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-16 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-16 bg-gray-200 dark:bg-gray-700 rounded"})]})]}),e.jsxs("button",{onClick:()=>$("menu_layout","list"),className:`p-4 rounded-xl border-2 transition-all text-left ${m.menu_layout==="list"?"border-orange-500 bg-orange-50 dark:bg-orange-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Fa,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"Lista"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Lista horizontal com imagens, mais compacta"}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"h-12 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-12 bg-gray-200 dark:bg-gray-700 rounded"})]})]}),e.jsxs("button",{onClick:()=>$("menu_layout","carousel"),className:`p-4 rounded-xl border-2 transition-all text-left ${m.menu_layout==="carousel"?"border-orange-500 bg-orange-50 dark:bg-orange-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(qa,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"Carrossel"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Deslize horizontalmente pelos pratos"}),e.jsxs("div",{className:"mt-3 flex gap-2 overflow-hidden",children:[e.jsx("div",{className:"h-20 w-32 bg-gray-200 dark:bg-gray-700 rounded flex-shrink-0"}),e.jsx("div",{className:"h-20 w-32 bg-gray-200 dark:bg-gray-700 rounded flex-shrink-0"})]})]}),e.jsxs("button",{onClick:()=>$("menu_layout","magazine"),className:`p-4 rounded-xl border-2 transition-all text-left ${m.menu_layout==="magazine"?"border-orange-500 bg-orange-50 dark:bg-orange-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Im,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"Cardápio Impresso"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Como folhear um cardápio físico, página por página"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"h-20 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-20 bg-gray-200 dark:bg-gray-700 rounded"})]})]}),e.jsxs("button",{onClick:()=>$("menu_layout","masonry"),className:`p-4 rounded-xl border-2 transition-all text-left ${m.menu_layout==="masonry"?"border-orange-500 bg-orange-50 dark:bg-orange-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ja,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"Masonry"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Layout estilo Pinterest, colunas com alturas variadas"}),e.jsxs("div",{className:"mt-3 columns-2 gap-2",children:[e.jsx("div",{className:"h-16 bg-gray-200 dark:bg-gray-700 rounded mb-2"}),e.jsx("div",{className:"h-24 bg-gray-200 dark:bg-gray-700 rounded mb-2"})]})]})]})]})})]})})]}),e.jsxs("div",{className:"flex gap-3 sticky bottom-0 bg-white dark:bg-gray-900 p-4 -mx-4 sm:-mx-6 border-t",style:{backgroundColor:a.colors.bgPrimary,borderColor:a.colors.borderColor},children:[e.jsxs(D,{onClick:()=>window.location.reload(),variant:"outline",className:"flex-1",children:[e.jsx(Bl,{className:"w-4 h-4 mr-2"}),"Resetar"]}),e.jsxs(D,{onClick:O,disabled:!f,className:"flex-1",style:{backgroundColor:f?a.colors.accent:void 0,opacity:f?1:.5},children:[e.jsx(hr,{className:"w-4 h-4 mr-2"}),"Salvar Alterações"]})]}),e.jsx(su,{open:p,onOpenChange:x,children:e.jsxs(au,{children:[e.jsxs(tu,{children:[e.jsx(ru,{children:"Confirmar Alterações"}),e.jsx(nu,{children:"Tem certeza que deseja salvar as novas configurações de tema? As alterações serão aplicadas imediatamente no cardápio."})]}),e.jsxs(iu,{children:[e.jsx(lu,{children:"Cancelar"}),e.jsxs(ou,{onClick:P,style:{backgroundColor:a.colors.accent},children:[e.jsx(aa,{className:"w-4 h-4 mr-2"}),"Confirmar"]})]})]})})]})}const fd=[{value:"pix",label:"PIX"},{value:"dinheiro",label:"Dinheiro"},{value:"cartao_credito",label:"Cartão de Crédito"},{value:"cartao_debito",label:"Cartão de Débito"}],Ss=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s||0),q0=s=>s?new Date(s).toLocaleString("pt-BR",{dateStyle:"short",timeStyle:"short"}):"";function uy({subscriberEmail:s=null}){const a=es(),[t,r]=w.useState("all"),[n,l]=w.useState(""),[c,m]=w.useState(!1),[i,o]=w.useState(!1),[d,p]=w.useState(null),[x,f]=w.useState("create"),[v,y]=w.useState(!1),[j,M]=w.useState(null),[k,z]=w.useState(!1),[$,u]=w.useState(null),{menuContext:g}=Ze(),h=s||(g?.type==="subscriber"&&g.value?g.value:null);Wm({subscriberEmail:h,onComandaUpdate:G=>{a.setQueryData(["Comanda",g?.type,g?.value,t],q=>{if(!q)return[G];const ne=q.findIndex(Me=>Me.id===G.id);if(ne>=0){const Me=[...q];return Me[ne]=G,Me}return[...q,G]})},onComandaCreated:G=>{a.invalidateQueries({queryKey:["Comanda",g?.type,g?.value]})},enableNotifications:!1});const{data:b=[],isLoading:L}=Ae({queryKey:["Comanda",g?.type,g?.value,t],queryFn:async()=>{if(!g)return[];const G=t&&t!=="all"?{status:t}:{};return g.type==="subscriber"&&g.value&&(G.as_subscriber=g.value),ae.entities.Comanda.list("-created_at",G)},enabled:!!g}),{data:O=[]}=Ht(),P=Array.isArray(O)?O.filter(G=>G.is_active!==!1):[],F=le({mutationFn:G=>ae.entities.Comanda.create(G),onSuccess:()=>{a.invalidateQueries({queryKey:["Comanda"]}),m(!1),p(null),W.success("Comanda criada")},onError:G=>W.error(G?.message||"Erro ao criar")}),C=le({mutationFn:({id:G,data:q})=>ae.entities.Comanda.update(G,q),onSuccess:()=>{a.invalidateQueries({queryKey:["Comanda"]}),m(!1),p(null),W.success("Comanda atualizada")},onError:G=>W.error(G?.message||"Erro ao atualizar")}),N=()=>{p(null),f("create"),m(!0)},V=G=>{p(G),f("edit"),m(!0)},E=G=>{M(G),y(!0)},ee=()=>{j&&(p(j),f("close"),m(!0),y(!1),M(null))},ue=G=>{p(G),o(!0)},Z=b.filter(G=>t==="all"?!0:(G.status||"open")===t),S=w.useMemo(()=>{const G=Array.isArray(b)?b:[],q=G.filter(Y=>(Y.status||"open")==="open").length,ne=G.filter(Y=>Y.status==="closed").length,Me=G.reduce((Y,A)=>{const X=parseFloat(A.total||A.total_value||0);return Y+(isNaN(X)?0:X)},0);return{open:q,closed:ne,totalValue:Me}},[b]);return e.jsxs("div",{className:"space-y-6 p-4 md:p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",style:{color:"var(--text-primary)"},children:"Comandas"}),!L&&b.length>0&&e.jsxs("p",{className:"text-sm mt-1",style:{color:"var(--text-secondary)"},children:[S.open," abertas · ",S.closed," fechadas · Total: ",Ss(S.totalValue)]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(Ce,{value:t,onValueChange:r,children:[e.jsx(ke,{className:"w-[140px]",children:e.jsx(Se,{})}),e.jsxs(De,{children:[e.jsx(Q,{value:"all",children:"Todas"}),e.jsx(Q,{value:"open",children:"Abertas"}),e.jsx(Q,{value:"closed",children:"Fechadas"}),e.jsx(Q,{value:"cancelled",children:"Canceladas"})]})]}),e.jsxs(D,{onClick:N,children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Nova Comanda"]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(_s,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx(U,{value:n,onChange:G=>l(G.target.value),placeholder:"Buscar por código, mesa ou cliente...",className:"pl-10 pr-10",style:{backgroundColor:"var(--bg-input)",borderColor:"var(--border-color)",color:"var(--text-primary)"}}),n&&e.jsx("button",{onClick:()=>l(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(ws,{className:"w-4 h-4"})})]}),L?e.jsx("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:"Carregando..."}):Z.length===0?e.jsx(B,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:e.jsxs(H,{className:"py-12 text-center",children:[e.jsx(La,{className:"w-12 h-12 mx-auto mb-3 opacity-50",style:{color:"var(--text-muted)"}}),e.jsx("p",{className:"font-medium",style:{color:"var(--text-primary)"},children:"Nenhuma comanda encontrada"}),e.jsxs("p",{className:"text-sm mt-1",style:{color:"var(--text-secondary)"},children:[t!=="all"?"Altere o filtro ou":""," crie uma nova comanda."]}),e.jsxs(D,{onClick:N,className:"mt-4",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Nova Comanda"]})]})}):e.jsx("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:Z.map(G=>{const q=G.status||"open",ne=q==="open";return e.jsxs(B,{className:"overflow-hidden",style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsxs(oe,{className:"pb-2 flex flex-row items-center justify-between",children:[e.jsxs(ce,{className:"text-base flex items-center gap-2",children:[e.jsx(La,{className:"w-4 h-4"}),e.jsx("span",{style:{color:"var(--text-primary)"},children:G.code||`#${G.id}`})]}),e.jsx(fe,{variant:ne?"default":"secondary",className:ne?"bg-green-600":q==="cancelled"?"bg-red-600":"",children:q==="open"?"Aberta":q==="closed"?"Fechada":"Cancelada"})]}),e.jsxs(H,{className:"space-y-1 text-sm",children:[e.jsxs("p",{style:{color:"var(--text-secondary)"},children:[G.table_name?`Mesa ${G.table_name}`:"—"," ",G.customer_name?` · ${G.customer_name}`:""]}),e.jsx("p",{className:"font-semibold",style:{color:"var(--text-primary)"},children:Ss(G.total)}),e.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:q0(G.created_at)}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2",children:[ne&&e.jsxs(e.Fragment,{children:[e.jsxs(D,{size:"sm",variant:"outline",onClick:()=>V(G),children:[e.jsx(yn,{className:"w-3 h-3 mr-1"}),"Editar"]}),e.jsxs(D,{size:"sm",variant:"outline",onClick:()=>E(G),children:[e.jsx(Za,{className:"w-3 h-3 mr-1"}),"Fechar"]}),e.jsxs(D,{size:"sm",variant:"outline",onClick:()=>handleTransfer(G),children:[e.jsx(bo,{className:"w-3 h-3 mr-1"}),"Transferir"]})]}),e.jsxs(D,{size:"sm",variant:"ghost",onClick:()=>ue(G),children:[e.jsx(Yr,{className:"w-3 h-3 mr-1"}),"Histórico"]}),ne&&e.jsxs(D,{size:"sm",variant:"ghost",onClick:()=>handlePrintComanda(G),children:[e.jsx(qi,{className:"w-3 h-3 mr-1"}),"Imprimir"]})]})]})]},G.id)})}),e.jsx(Y0,{open:c,onOpenChange:m,mode:x,comanda:d,dishes:P,onCreate:F.mutate,onUpdate:C.mutate,isCreating:F.isPending,isUpdating:C.isPending}),e.jsx(G0,{open:i,onOpenChange:o,comanda:d}),e.jsx(ze,{open:v,onOpenChange:y,children:e.jsxs(Te,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(Fe,{children:e.jsxs(Re,{style:{color:"var(--text-primary)"},className:"flex items-center gap-2",children:[e.jsx(ft,{className:"w-5 h-5"}),"Confirmar fechamento"]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{style:{color:"var(--text-primary)"},children:["Tem certeza que deseja fechar a comanda ",e.jsx("strong",{children:j?.code||`#${j?.id}`}),"?"]}),j&&e.jsxs("div",{className:"p-3 rounded-lg",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsxs("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:[e.jsx("strong",{children:"Total:"})," ",Ss(j.total||0)]}),e.jsxs("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:[e.jsx("strong",{children:"Itens:"})," ",Array.isArray(j.items)?j.items.length:0]})]})]}),e.jsxs(Ws,{children:[e.jsx(D,{variant:"outline",onClick:()=>y(!1),children:"Cancelar"}),e.jsxs(D,{onClick:ee,children:[e.jsx(rt,{className:"w-4 h-4 mr-2"}),"Confirmar"]})]})]})})]})}function Y0({open:s,onOpenChange:a,mode:t,comanda:r,dishes:n,onCreate:l,onUpdate:c,isCreating:m,isUpdating:i}){const[o,d]=w.useState(""),[p,x]=w.useState(""),[f,v]=w.useState(""),[y,j]=w.useState([]),[M,k]=w.useState([{method:"pix",amount:""}]),[z,$]=w.useState({type:"none",value:""}),[u,g]=w.useState(1),[T,h]=w.useState(!1),b=JSON.parse(localStorage.getItem("user")||"{}");se.useEffect(()=>{s&&(r?(d(r.table_name||""),x(r.customer_name||""),v(r.customer_phone||""),j(Array.isArray(r.items)?r.items:[]),k(Array.isArray(r.payments)&&r.payments.length?r.payments.map(A=>({method:A.method||"pix",amount:String(A.amount||"")})):[{method:"pix",amount:""}])):(d(""),x(""),v(""),j([]),k([{method:"pix",amount:""}])))},[s,r]);const L=y.reduce((A,X)=>A+(Number(X.quantity)||0)*(Number(X.unit_price)||0),0),O=z.type==="percent"?L*(parseFloat(z.value)||0)/100:z.type==="fixed"&&parseFloat(z.value)||0,P=L+O,F=M.reduce((A,X)=>A+(parseFloat(X.amount)||0),0),C=F>=P&&P>0,N=T&&u>0?P/u:P,V=()=>{const A=n[0];j(X=>[...X,{dish_id:A?.id,dish_name:A?.name||"Item",quantity:1,unit_price:A?.price??A?.unit_price??0,observations:""}])},E=A=>{j(X=>X.filter((ge,xe)=>xe!==A))},ee=(A,X,ge)=>{j(xe=>{const Ee=[...xe];return Ee[A]={...Ee[A],[X]:ge},Ee})},ue=(A,X)=>{const ge=n.find(xe=>xe.id===X||String(xe.id)===String(X));ge&&j(xe=>{const Ee=[...xe];return Ee[A]={...Ee[A],dish_id:ge.id,dish_name:ge.name,unit_price:ge.price??ge.unit_price??0},Ee})},Z=()=>k(A=>[...A,{method:"pix",amount:""}]),S=A=>k(X=>X.filter((ge,xe)=>xe!==A)),G=(A,X,ge)=>{k(xe=>{const Ee=[...xe];return Ee[A]={...Ee[A],[X]:ge},Ee})},q=(A,X,ge)=>[...Array.isArray(A)?A:[],{at:new Date().toISOString(),by:b?.email||"sistema",action:X,details:ge||{}}],ne=A=>{if(A.preventDefault(),t==="create"){const X=q([],"created",{});l({code:void 0,status:"open",table_name:o.trim()||null,customer_name:p.trim()||null,customer_phone:f.trim()||null,items:y,payments:[],total:L,created_by:b?.email,history:X})}else if(t==="close"&&r){const X=M.filter(xe=>parseFloat(xe.amount)>0).map(xe=>({method:xe.method,amount:parseFloat(xe.amount),created_at:new Date().toISOString(),created_by:b?.email})),ge=q(r.history||[],"closed",{payments:X,tip:O>0?z:null,tip_amount:O,split_count:T?u:null});c({id:r.id,data:{...r,status:"closed",closed_at:new Date().toISOString(),closed_by:b?.email,payments:X,total:P,tip:O>0?z:null,tip_amount:O,split_count:T?u:null,history:ge}})}else if(t==="edit"&&r){const X=q(r.history||[],"updated",{summary:"Alteração de itens ou dados"});c({id:r.id,data:{...r,table_name:o.trim()||null,customer_name:p.trim()||null,customer_phone:f.trim()||null,items:y,total:L,history:X}})}},Me=t==="close",Y=m||i;return e.jsx(ze,{open:s,onOpenChange:a,children:e.jsxs(Te,{className:"sm:max-w-lg max-w-[95vw] max-h-[85vh] overflow-y-auto",style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(Fe,{children:e.jsxs(Re,{style:{color:"var(--text-primary)"},children:[t==="create"&&"Nova Comanda",t==="edit"&&`Editar ${r?.code||""}`,t==="close"&&`Fechar Comanda ${r?.code||""}`]})}),e.jsxs("form",{onSubmit:ne,className:"space-y-4",children:[!Me&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Mesa"}),e.jsx(U,{value:o,onChange:A=>d(A.target.value),placeholder:"Ex: 1",className:"min-h-touch",style:{backgroundColor:"var(--bg-input)",borderColor:"var(--border-color)",color:"var(--text-primary)"}})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Cliente"}),e.jsx(U,{value:p,onChange:A=>x(A.target.value),placeholder:"Nome",className:"min-h-touch",style:{backgroundColor:"var(--bg-input)",borderColor:"var(--border-color)",color:"var(--text-primary)"}})]})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Telefone"}),e.jsx(U,{value:f,onChange:A=>v(A.target.value),placeholder:"(00) 00000-0000",className:"min-h-touch",style:{backgroundColor:"var(--bg-input)",borderColor:"var(--border-color)",color:"var(--text-primary)"}})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx(R,{children:"Itens"}),e.jsxs(D,{type:"button",variant:"outline",size:"sm",onClick:V,disabled:!n.length,children:[e.jsx(Ie,{className:"w-3 h-3 mr-1"})," Adicionar"]})]}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:y.length===0?e.jsx("div",{className:"text-center py-4 text-sm",style:{color:"var(--text-muted)"},children:'Nenhum item adicionado. Clique em "Adicionar" para começar.'}):y.map((A,X)=>{const ge=(Number(A.quantity)||0)*(Number(A.unit_price)||0);return e.jsxs("div",{className:"flex gap-2 flex-wrap items-end p-3 rounded border hover:bg-gray-50 dark:hover:bg-gray-900/50 transition-colors",style:{borderColor:"var(--border-color)"},children:[e.jsxs(Ce,{value:A.dish_id,onValueChange:xe=>ue(X,xe),children:[e.jsx(ke,{className:"flex-1 min-w-[140px]",children:e.jsx(Se,{placeholder:"Selecione o prato"})}),e.jsx(De,{children:n.map(xe=>e.jsxs(Q,{value:xe.id,children:[xe.name," ",xe.price?`- ${Ss(xe.price)}`:""]},xe.id))})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(R,{className:"text-xs",style:{color:"var(--text-muted)"},children:"Qtd:"}),e.jsx(U,{type:"number",min:1,value:A.quantity,onChange:xe=>ee(X,"quantity",parseInt(xe.target.value,10)||1),className:"w-16 text-center",style:{backgroundColor:"var(--bg-input)",borderColor:"var(--border-color)",color:"var(--text-primary)"}})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(R,{className:"text-xs",style:{color:"var(--text-muted)"},children:"R$:"}),e.jsx(U,{type:"number",step:"0.01",value:A.unit_price,onChange:xe=>ee(X,"unit_price",parseFloat(xe.target.value)||0),className:"w-24",style:{backgroundColor:"var(--bg-input)",borderColor:"var(--border-color)",color:"var(--text-primary)"}})]}),e.jsx("div",{className:"flex items-center gap-2 px-2 py-1 rounded",style:{backgroundColor:"var(--bg-secondary)"},children:e.jsx("span",{className:"text-xs font-medium",style:{color:"var(--text-primary)"},children:Ss(ge)})}),e.jsx(D,{type:"button",variant:"ghost",size:"icon",onClick:()=>E(X),className:"text-red-500 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20",children:e.jsx(Ke,{className:"w-4 h-4"})})]},X)})})]})]}),e.jsxs("div",{className:"p-3 rounded-lg border",style:{backgroundColor:"var(--bg-secondary)",borderColor:"var(--border-color)"},children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold text-lg",style:{color:"var(--text-primary)"},children:"Total:"}),e.jsx("span",{className:"font-bold text-xl",style:{color:"var(--text-primary)"},children:Ss(Me?r?.total:L)})]}),!Me&&y.length>0&&e.jsxs("p",{className:"text-xs mt-1",style:{color:"var(--text-muted)"},children:[y.length," ",y.length===1?"item":"itens"," · ",y.reduce((A,X)=>A+(Number(X.quantity)||0),0)," unidades"]})]}),Me&&e.jsxs("div",{children:[e.jsx(R,{children:"Pagamentos"}),e.jsxs("div",{className:"space-y-2 mt-2",children:[M.map((A,X)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs(Ce,{value:A.method,onValueChange:ge=>G(X,"method",ge),children:[e.jsx(ke,{className:"w-[160px]",children:e.jsx(Se,{})}),e.jsx(De,{children:fd.map(ge=>e.jsx(Q,{value:ge.value,children:ge.label},ge.value))})]}),e.jsx(U,{type:"number",step:"0.01",placeholder:"0,00",value:A.amount,onChange:ge=>G(X,"amount",ge.target.value),style:{backgroundColor:"var(--bg-input)",borderColor:"var(--border-color)",color:"var(--text-primary)"}}),e.jsx(D,{type:"button",variant:"ghost",size:"icon",onClick:()=>S(X),children:e.jsx(Ke,{className:"w-4 h-4"})})]},X)),e.jsxs(D,{type:"button",variant:"outline",size:"sm",onClick:Z,children:[e.jsx(Ie,{className:"w-3 h-3 mr-1"})," Forma de pagamento"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 rounded",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:"Subtotal:"}),e.jsx("span",{className:"text-sm font-bold",style:{color:"var(--text-primary)"},children:Ss(L)})]}),O>0&&e.jsxs("div",{className:"flex justify-between items-center p-2 rounded",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:"Gorjeta:"}),e.jsx("span",{className:"text-sm font-bold",style:{color:"var(--text-primary)"},children:Ss(O)})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 rounded border-t",style:{borderColor:"var(--border-color)"},children:[e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:"Total:"}),e.jsx("span",{className:"text-sm font-bold",style:{color:"var(--text-primary)"},children:Ss(P)})]}),T&&u>1&&e.jsxs("div",{className:"flex justify-between items-center p-2 rounded border border-blue-200 dark:border-blue-800",style:{backgroundColor:"rgba(59, 130, 246, 0.1)"},children:[e.jsxs("span",{className:"text-sm font-medium text-blue-700 dark:text-blue-300",children:["Por pessoa (",u,"):"]}),e.jsx("span",{className:"text-sm font-bold text-blue-700 dark:text-blue-300",children:Ss(N)})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 rounded",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:"Total pago:"}),e.jsx("span",{className:`text-sm font-bold ${F>=P?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:Ss(F)})]}),F>P&&e.jsxs("div",{className:"flex justify-between items-center p-2 rounded border border-green-200 dark:border-green-800",style:{backgroundColor:"rgba(34, 197, 94, 0.1)"},children:[e.jsx("span",{className:"text-sm font-medium text-green-700 dark:text-green-300",children:"Troco:"}),e.jsx("span",{className:"text-sm font-bold text-green-700 dark:text-green-300",children:Ss(F-P)})]}),!C&&P>0&&e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded border border-red-200 dark:border-red-800",style:{backgroundColor:"rgba(239, 68, 68, 0.1)"},children:[e.jsx(ft,{className:"w-4 h-4 text-red-600 dark:text-red-400"}),e.jsxs("span",{className:"text-xs text-red-600 dark:text-red-400",children:["Valor pago insuficiente. Faltam ",Ss(P-F)]})]})]})]}),e.jsxs(Ws,{children:[e.jsx(D,{type:"button",variant:"outline",onClick:()=>a(!1),children:"Cancelar"}),e.jsx(D,{type:"submit",disabled:Y||Me&&!C&&L>0,children:Y?"Salvando...":t==="create"?"Criar":t==="close"?"Fechar comanda":"Salvar"})]})]})]})})}function G0({open:s,onOpenChange:a,comanda:t}){const r=Array.isArray(t?.history)?t.history:[],n=m=>m?new Date(m).toLocaleString("pt-BR"):"",l=m=>{switch(m){case"created":return e.jsx(Ie,{className:"w-4 h-4 text-green-600 dark:text-green-400"});case"updated":return e.jsx(yn,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"});case"closed":return e.jsx(rt,{className:"w-4 h-4 text-teal-600 dark:text-teal-400"});case"cancelled":return e.jsx(Za,{className:"w-4 h-4 text-red-600 dark:text-red-400"});default:return e.jsx(Yr,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"})}},c=m=>({created:"Criada",updated:"Atualizada",closed:"Fechada",cancelled:"Cancelada"})[m]||m;return e.jsx(ze,{open:s,onOpenChange:a,children:e.jsxs(Te,{className:"sm:max-w-md max-w-[95vw] max-h-[85vh] overflow-y-auto",style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(Fe,{children:e.jsxs(Re,{style:{color:"var(--text-primary)"},className:"flex items-center gap-2",children:[e.jsx(Yr,{className:"w-5 h-5"}),"Histórico — ",t?.code||`#${t?.id}`]})}),e.jsx("div",{className:"space-y-3",children:r.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Yr,{className:"w-12 h-12 mx-auto mb-3 opacity-30",style:{color:"var(--text-muted)"}}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:"Nenhuma alteração registrada."})]}):r.map((m,i)=>e.jsxs("div",{className:"flex gap-3 p-3 rounded-lg border hover:bg-gray-50 dark:hover:bg-gray-900/50 transition-colors",style:{borderColor:"var(--border-color)"},children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:l(m.action)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:c(m.action)}),e.jsx("span",{className:"text-xs",style:{color:"var(--text-muted)"},children:n(m.at)})]}),e.jsxs("p",{className:"text-xs mb-1",style:{color:"var(--text-muted)"},children:["Por: ",m.by||"Sistema"]}),m.details&&Object.keys(m.details).length>0&&e.jsxs("div",{className:"mt-2 p-2 rounded text-xs overflow-x-auto",style:{backgroundColor:"var(--bg-secondary)",color:"var(--text-secondary)"},children:[m.details.payments&&Array.isArray(m.details.payments)&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:"Pagamentos:"}),m.details.payments.map((o,d)=>e.jsxs("p",{className:"pl-2",children:[fd.find(p=>p.value===o.method)?.label||o.method,": ",Ss(o.amount)]},d))]}),m.details.summary&&e.jsx("p",{className:"italic",children:m.details.summary}),!m.details.payments&&!m.details.summary&&e.jsx("pre",{className:"text-xs",children:JSON.stringify(m.details,null,2)})]})]})]},i))})]})})}function V0({user:s}){const[a,t]=w.useState(""),[r,n]=w.useState(!1),l=es();w.useEffect(()=>{s?.slug&&t(s.slug)},[s]);const c=le({mutationFn:async d=>{const p=String(d||"").trim().toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"");return await _e.functions.invoke("updateMasterSlug",{slug:p||null})},onSuccess:()=>{l.invalidateQueries(["user"]),W.success("✅ Link do cardápio atualizado!")},onError:d=>{W.error(d?.message||"Erro ao atualizar link")}}),m=()=>{if(!a.trim()){W.error("Digite um link válido");return}c.mutate(a)},i=()=>{if(!a){W.error("Configure um link primeiro");return}const d=`${window.location.origin}/s/${a}`;navigator.clipboard.writeText(d),n(!0),W.success("Link copiado!"),setTimeout(()=>n(!1),2e3)},o=a?`${window.location.origin}/s/${a}`:null;return e.jsxs(B,{children:[e.jsxs(oe,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Ro,{className:"w-5 h-5 text-orange-500"}),"Meu Cardápio"]}),e.jsx(rs,{children:"Configure o link do seu cardápio para compartilhar com seus clientes"})]}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"master-slug",children:"Link do Cardápio"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 flex items-center gap-2 px-3 py-2 border rounded-md bg-gray-50 dark:bg-gray-900",children:[e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[window.location.origin,"/s/"]}),e.jsx(U,{id:"master-slug",value:a,onChange:d=>t(d.target.value),placeholder:"meu-restaurante",className:"border-0 bg-transparent p-0 h-auto focus-visible:ring-0"})]}),e.jsx(D,{onClick:m,disabled:c.isPending,children:c.isPending?"Salvando...":"Salvar"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Use apenas letras minúsculas, números e hífens. Ex: meu-restaurante"})]}),o&&e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-green-900 dark:text-green-100",children:"Link do seu cardápio:"}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300 truncate font-mono",children:o})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{variant:"outline",size:"sm",onClick:i,className:"flex-1",children:r?e.jsxs(e.Fragment,{children:[e.jsx(rt,{className:"w-4 h-4 mr-2"}),"Copiado!"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ks,{className:"w-4 h-4 mr-2"}),"Copiar Link"]})}),e.jsxs(D,{variant:"outline",size:"sm",onClick:()=>window.open(o,"_blank"),className:"flex-1",children:[e.jsx(Ri,{className:"w-4 h-4 mr-2"}),"Visualizar"]})]})]})]})]})}const U0=[{value:0,label:"Dom"},{value:1,label:"Seg"},{value:2,label:"Ter"},{value:3,label:"Qua"},{value:4,label:"Qui"},{value:5,label:"Sex"},{value:6,label:"Sáb"}];function hy(){const{subscriberData:s,isMaster:a,refresh:t,menuContext:r}=Ze(),[n,l]=se.useState(null),[c,m]=w.useState(""),[i,o]=w.useState({name:"",logo:"",whatsapp:"",address:"",slogan:"",instagram:"",facebook:"",tiktok:"",theme_primary_color:"",theme_secondary_color:"",theme_accent_color:"",is_open:null,accepting_orders:!0,pause_message:"",opening_time:"08:00",closing_time:"18:00",working_days:[1,2,3,4,5],cross_sell_config:{enabled:!0,beverage_offer:{enabled:!0,trigger_product_types:["pizza"],min_cart_value:0,dish_id:null,title:"🥤 Que tal uma bebida?",message:"Pizza sem bebida? Adicione {product_name} por apenas {product_price}",discount_percent:0},dessert_offer:{enabled:!0,min_cart_value:40,dish_id:null,title:"🍰 Que tal uma sobremesa?",message:"Complete seu pedido com {product_name} por apenas {product_price}",discount_percent:0},combo_offer:{enabled:!0,min_pizzas:2,dish_id:null,title:"🔥 Oferta Especial!",message:"Compre {min_pizzas} pizzas e ganhe {product_name} GRÁTIS!",discount_percent:100}}}),d=es();se.useEffect(()=>{(async()=>{try{const N=await ae.auth.me();l(N)}catch(N){console.error("Error loading user:",N)}})()},[]),w.useEffect(()=>{s?.slug!=null&&m(s.slug)},[s?.slug]);const p=le({mutationFn:async C=>{const N=String(C||"").trim().toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"");await ae.put(`/subscribers/${s.id}`,{slug:N||null})},onSuccess:()=>{t(),W.success("Link do cardápio atualizado.")},onError:C=>W.error(C?.message||"Erro ao salvar link")}),{data:x=[]}=Ae({queryKey:["store",r?.type,r?.value],queryFn:async()=>{if(!r)return[];const C={};return r.type==="subscriber"&&r.value&&(C.as_subscriber=r.value),ae.entities.Store.list(null,C)},enabled:!!r}),f=x[0],v=Array.isArray(f?.banners)?f.banners:[],y=le({mutationFn:async C=>{if(!f?.id)throw new Error("Loja não encontrada");const N=r?.type==="subscriber"&&r?.value?{as_subscriber:r.value}:{};return ae.entities.Store.update(f.id,C,N)},onSuccess:()=>{d.invalidateQueries({queryKey:["store"]}),d.invalidateQueries({queryKey:["store",r?.type,r?.value]}),W.success("Banners salvos")},onError:C=>W.error(C?.message||"Erro ao salvar banners")}),j=async C=>{const N=C.target.files?.[0];if(N)try{const{uploadToCloudinary:V}=await tt(async()=>{const{uploadToCloudinary:ee}=await import("./cloudinaryUpload-C4sUQLHO.js");return{uploadToCloudinary:ee}},__vite__mapDeps([0,1,2])),E=await V(N,"store");y.mutate({banner_image:E})}catch{W.error("Erro no upload")}},M=()=>{const C=[...v,{image:"",title:"",subtitle:"",link:"",active:!0}];y.mutate({banners:C})},k=(C,N,V)=>{const E=v.map((ee,ue)=>ue===C?{...ee,[N]:V}:ee);y.mutate({banners:E})},z=C=>{const N=v.filter((V,E)=>E!==C);y.mutate({banners:N})},$=async(C,N)=>{const V=C.target.files?.[0];if(V)try{const{uploadToCloudinary:E}=await tt(async()=>{const{uploadToCloudinary:ue}=await import("./cloudinaryUpload-C4sUQLHO.js");return{uploadToCloudinary:ue}},__vite__mapDeps([0,1,2])),ee=await E(V,"store");k(N,"image",ee)}catch{W.error("Erro no upload")}};w.useEffect(()=>{f&&o(C=>({...C,name:f.name||"",logo:f.logo||"",whatsapp:f.whatsapp||"",address:f.address||"",slogan:f.slogan||"",instagram:f.instagram||"",facebook:f.facebook||"",theme_primary_color:f.theme_primary_color||"",theme_secondary_color:f.theme_secondary_color||"",theme_accent_color:f.theme_accent_color||"",is_open:f.is_open===null||f.is_open===void 0?null:f.is_open,accepting_orders:f.accepting_orders!==!1,pause_message:f.pause_message||"",opening_time:f.opening_time||"08:00",closing_time:f.closing_time||"18:00",working_days:f.working_days||[1,2,3,4,5],cross_sell_config:f.cross_sell_config||C.cross_sell_config}))},[f]);const u=le({mutationFn:async C=>{console.log("Criando loja:",C);const V={...Object.keys(C).reduce((E,ee)=>{const ue=C[ee];return ue===void 0||(Array.isArray(ue)?E[ee]=ue.filter(Z=>Z!=null):E[ee]=ue),E},{}),owner_email:n?.subscriber_email||n?.email};console.log("Dados limpos a serem criados:",V);try{const E=await ae.entities.Store.create(V);return console.log("Loja criada:",E),{success:!0,store:E}}catch(E){throw console.error("Erro ao criar loja:",E),console.error("Stack:",E.stack),E}},onSuccess:()=>{d.invalidateQueries({queryKey:["store"]}),d.invalidateQueries({queryKey:["stores"]}),d.refetchQueries({queryKey:["store"]}),W.success("✅ Loja criada com sucesso!",{duration:3e3,position:"top-center"}),setTimeout(()=>{window.location.reload()},1e3)},onError:C=>{console.error("Erro ao criar:",C),W.error("❌ Erro ao criar: "+(C?.message||"Desconhecido"),{duration:5e3,position:"top-center"})}}),g=le({mutationFn:async({data:C})=>{console.log("💾 [StoreTab] Salvando dados da loja:",C);const V={...Object.keys(C).reduce((E,ee)=>{const ue=C[ee];return ue===void 0||(Array.isArray(ue)?E[ee]=ue.filter(Z=>Z!=null):E[ee]=ue),E},{}),owner_email:n?.subscriber_email||n?.email};console.log("✅ [StoreTab] Dados limpos a serem salvos:",JSON.stringify(V,null,2));try{const E=await ae.entities.Store.list();if(console.log("📋 [StoreTab] Lojas encontradas:",E.length,E),E.length===0){console.log("➕ [StoreTab] Criando nova loja...");const ee=await ae.entities.Store.create(V);return console.log("✅ [StoreTab] Loja criada com sucesso:",ee),{success:!0,store:ee}}else{console.log("🔄 [StoreTab] Atualizando loja existente (ID:",E[0].id,")..."),console.log("📤 [StoreTab] Enviando dados:",JSON.stringify(V,null,2));const ee=await ae.entities.Store.update(E[0].id,V);return console.log("✅ [StoreTab] Loja atualizada com sucesso:",ee),{success:!0,store:ee}}}catch(E){throw console.error("❌ [StoreTab] Erro ao salvar loja:",E),console.error("❌ [StoreTab] Detalhes do erro:",{message:E.message,stack:E.stack,response:E.response,data:E.data}),E}},onSuccess:C=>{console.log("Sucesso ao salvar:",C),d.invalidateQueries({queryKey:["store"]}),d.invalidateQueries({queryKey:["stores"]}),d.refetchQueries({queryKey:["store"]}),W.success("✅ Configurações da loja salvas com sucesso!",{duration:3e3,position:"top-center"}),setTimeout(()=>{window.location.reload()},1e3)},onError:C=>{console.error("❌ Erro ao salvar loja:",C),console.error("❌ Erro detalhado:",{message:C?.message,stack:C?.stack,response:C?.response,data:C?.data});const N=C?.message||C?.response?.data?.message||C?.toString()||"Erro desconhecido";W.error("❌ Erro ao salvar as configurações da loja. "+N,{duration:5e3,position:"top-center"})}}),T=C=>{C.preventDefault(),f?g.mutate({data:i}):u.mutate(i)},h=async C=>{const N=C.target.files?.[0];if(N)try{const{uploadToCloudinary:V}=await tt(async()=>{const{uploadToCloudinary:ee}=await import("./cloudinaryUpload-C4sUQLHO.js");return{uploadToCloudinary:ee}},__vite__mapDeps([0,1,2])),E=await V(N,"store");o(ee=>({...ee,logo:E}));try{const ee=await gd(E),ue={theme_primary_color:ee.primary,theme_secondary_color:ee.secondary,theme_accent_color:ee.accent};if(o(Z=>({...Z,logo:E,...ue})),f?.id){const Z=r?.type==="subscriber"&&r?.value?{as_subscriber:r.value}:{};await ae.entities.Store.update(f.id,{logo:E,...ue},Z),d.invalidateQueries({queryKey:["store"]}),d.invalidateQueries({queryKey:["stores"]}),d.invalidateQueries({queryKey:["store",r?.type,r?.value]}),W.success("Logo e cores do tema atualizados a partir da logo.")}else W.success("Logo atualizada. Cores do tema serão aplicadas ao salvar.")}catch(ee){console.warn("Extração de cores da logo:",ee),W.success("Logo atualizada! Ela será exibida no cardápio digital.")}}catch(V){console.error("Erro ao fazer upload:",V),W.error("Erro ao fazer upload do logotipo")}},b=C=>{o(N=>{const V=N.working_days||[];return V.includes(C)?{...N,working_days:V.filter(E=>E!==C)}:{...N,working_days:[...V,C].sort()}})},L=()=>i.is_open===!0?"open":i.is_open===!1?"closed":"auto",O=C=>{o(C==="open"?N=>({...N,is_open:!0}):C==="closed"?N=>({...N,is_open:!1}):N=>({...N,is_open:null}))},P=L(),F=w.useMemo(()=>{const C=!!i.logo,N=!!i.name?.trim(),V=!!i.whatsapp?.trim(),E=!!i.address?.trim(),ee=C&&N&&V,ue=(i.working_days||[]).length,Z=P==="open"||P==="auto"&&ue>0;return{hasLogo:C,hasName:N,hasWhatsApp:V,hasAddress:E,isConfigured:ee,workingDaysCount:ue,isOpen:Z}},[i,P]);return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-6 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Configurações da Loja"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Gerencie as informações e funcionamento do seu restaurante"})]}),a&&n&&e.jsx("div",{className:"mb-6",children:e.jsx(V0,{user:n})}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4 mb-4 sm:mb-6",children:[e.jsx(B,{className:F.hasLogo?"border-green-200":"border-gray-200",children:e.jsx(H,{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:"Logo"}),e.jsx("p",{className:"text-base sm:text-lg font-bold",children:F.hasLogo?"✓":"✗"})]}),F.hasLogo?e.jsx(rt,{className:"w-5 h-5 sm:w-6 sm:h-6 text-green-500"}):e.jsx(Za,{className:"w-5 h-5 sm:w-6 sm:h-6 text-gray-400"})]})})}),e.jsx(B,{className:F.hasName?"border-green-200":"border-gray-200",children:e.jsx(H,{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:"Nome"}),e.jsx("p",{className:"text-base sm:text-lg font-bold",children:F.hasName?"✓":"✗"})]}),F.hasName?e.jsx(rt,{className:"w-5 h-5 sm:w-6 sm:h-6 text-green-500"}):e.jsx(Za,{className:"w-5 h-5 sm:w-6 sm:h-6 text-gray-400"})]})})}),e.jsx(B,{className:F.hasWhatsApp?"border-green-200":"border-gray-200",children:e.jsx(H,{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:"WhatsApp"}),e.jsx("p",{className:"text-base sm:text-lg font-bold",children:F.hasWhatsApp?"✓":"✗"})]}),F.hasWhatsApp?e.jsx(rt,{className:"w-5 h-5 sm:w-6 sm:h-6 text-green-500"}):e.jsx(Za,{className:"w-5 h-5 sm:w-6 sm:h-6 text-gray-400"})]})})}),e.jsx(B,{className:F.isOpen?"border-green-200":"border-red-200",children:e.jsx(H,{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:"Status"}),e.jsx("p",{className:"text-xs sm:text-base font-bold",children:F.isOpen?"Aberta":"Fechada"})]}),F.isOpen?e.jsx(Ls,{className:"w-5 h-5 sm:w-6 sm:h-6 text-green-500"}):e.jsx(Za,{className:"w-5 h-5 sm:w-6 sm:h-6 text-red-500"})]})})})]}),e.jsxs("form",{onSubmit:T,className:"space-y-6",children:[e.jsxs(B,{children:[e.jsxs(oe,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(ni,{className:"w-5 h-5 text-orange-500"}),"Identidade da Loja"]}),e.jsx(rs,{children:"Nome, logo e informações de contato"})]}),e.jsxs(H,{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-32 h-32 bg-gray-100 rounded-xl flex items-center justify-center mb-3 overflow-hidden border-2 border-dashed border-gray-300 hover:border-orange-400 transition-colors",children:i.logo?e.jsx("img",{src:i.logo,alt:"Logo",className:"w-full h-full object-cover"}):e.jsx(ni,{className:"w-12 h-12 text-gray-400"})}),e.jsxs("label",{className:"text-sm text-orange-600 cursor-pointer hover:text-orange-700 font-medium flex items-center gap-2",children:[e.jsx(an,{className:"w-4 h-4"}),e.jsx("input",{type:"file",accept:"image/*",onChange:h,className:"hidden"}),"Alterar Logotipo"]}),e.jsx("span",{className:"text-xs text-gray-500 mt-1",children:"Recomendado: 500x500px"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Esta logo será exibida no cardápio digital"})]}),e.jsx(ql,{}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(R,{htmlFor:"store-name",className:"flex items-center gap-2 mb-2",children:[e.jsx(ni,{className:"w-4 h-4 text-gray-500"}),"Nome da Loja *",e.jsx(ei,{children:e.jsxs(si,{children:[e.jsx(ai,{asChild:!0,children:e.jsx(ii,{className:"w-4 h-4 text-gray-400 hover:text-gray-600 cursor-help"})}),e.jsx(ti,{className:"max-w-xs",children:e.jsx("p",{className:"text-xs",children:"Nome que aparecerá no cardápio digital e nos pedidos dos clientes"})})]})})]}),e.jsx(Ca,{id:"store-name",value:i.name,onChange:C=>o(N=>({...N,name:C.target.value})),placeholder:"Ex: Restaurante Raiz",required:!0,className:i.name?.trim()?"":"border-red-300"}),!i.name?.trim()&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Nome da loja é obrigatório"})]}),e.jsxs("div",{children:[e.jsxs(R,{htmlFor:"whatsapp",className:"flex items-center gap-2 mb-2",children:[e.jsx(mu,{className:"w-4 h-4 text-gray-500"}),"WhatsApp",e.jsx(ei,{children:e.jsxs(si,{children:[e.jsx(ai,{asChild:!0,children:e.jsx(ii,{className:"w-4 h-4 text-gray-400 hover:text-gray-600 cursor-help"})}),e.jsx(ti,{className:"max-w-xs",children:e.jsx("p",{className:"text-xs",children:"Número usado para receber pedidos via WhatsApp. Formato: DDD + número completo"})})]})})]}),e.jsx(Ca,{id:"whatsapp",value:i.whatsapp,onChange:C=>{const N=C.target.value.replace(/\D/g,"");o(V=>({...V,whatsapp:N}))},placeholder:"5586999999999",maxLength:15}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Formato: DDD + número (apenas números)",i.whatsapp&&i.whatsapp.length<10&&e.jsx("span",{className:"text-red-500 ml-2",children:"Número muito curto"})]})]})]}),e.jsxs("div",{children:[e.jsxs(R,{htmlFor:"address",className:"flex items-center gap-2 mb-2",children:[e.jsx(Ea,{className:"w-4 h-4 text-gray-500"}),"Endereço"]}),e.jsx(Ca,{id:"address",value:i.address,onChange:C=>o(N=>({...N,address:C.target.value})),placeholder:"Rua, número, bairro, cidade"})]}),e.jsxs("div",{children:[e.jsxs(R,{htmlFor:"slogan",className:"mb-2 flex items-center gap-2",children:["Frase do Restaurante",e.jsx(ei,{children:e.jsxs(si,{children:[e.jsx(ai,{asChild:!0,children:e.jsx(ii,{className:"w-4 h-4 text-gray-400 hover:text-gray-600 cursor-help"})}),e.jsx(ti,{className:"max-w-xs",children:e.jsx("p",{className:"text-xs",children:"Slogan ou frase que aparece no topo do cardápio digital para atrair clientes"})})]})})]}),e.jsx(Ca,{id:"slogan",value:i.slogan,onChange:C=>o(N=>({...N,slogan:C.target.value})),placeholder:"Ex: O melhor sabor da região!"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs(R,{htmlFor:"instagram",className:"flex items-center gap-2 mb-2 text-sm font-medium",children:[e.jsx($m,{className:"w-4 h-4 text-gray-500"}),"Instagram"]}),e.jsx(Ca,{id:"instagram",value:i.instagram,onChange:C=>o(N=>({...N,instagram:C.target.value})),placeholder:"@seurestaurante"})]}),e.jsxs("div",{children:[e.jsxs(R,{htmlFor:"facebook",className:"flex items-center gap-2 mb-2 text-sm font-medium",children:[e.jsx(qm,{className:"w-4 h-4 text-gray-500"}),"Facebook"]}),e.jsx(Ca,{id:"facebook",value:i.facebook,onChange:C=>o(N=>({...N,facebook:C.target.value})),placeholder:"Link da página"})]}),e.jsxs("div",{children:[e.jsxs(R,{htmlFor:"tiktok",className:"flex items-center gap-2 mb-2 text-sm font-medium",children:[e.jsx(Ym,{className:"w-4 h-4 text-gray-500"}),"TikTok"]}),e.jsx(Ca,{id:"tiktok",value:i.tiktok,onChange:C=>o(N=>({...N,tiktok:C.target.value})),placeholder:"@seurestaurante"})]})]})]})]}),e.jsxs(B,{children:[e.jsxs(oe,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(or,{className:"w-5 h-5 text-orange-500"}),"Funcionamento"]}),e.jsx(rs,{children:"Defina quando sua loja está aberta"})]}),e.jsxs(H,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(R,{className:"mb-3 block font-semibold",children:"Modo de Funcionamento"}),e.jsxs("div",{className:"grid sm:grid-cols-3 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>O("auto"),className:`p-4 rounded-xl border-2 transition-all text-left ${P==="auto"?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${P==="auto"?"bg-blue-500":"bg-gray-300"}`}),e.jsx("span",{className:"font-semibold text-sm",children:"🔵 Automático"})]}),e.jsx("p",{className:"text-xs text-gray-600",children:"Baseado em horários e dias configurados"})]}),e.jsxs("button",{type:"button",onClick:()=>O("open"),className:`p-4 rounded-xl border-2 transition-all text-left ${P==="open"?"border-green-500 bg-green-50":"border-gray-200 hover:border-gray-300 bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${P==="open"?"bg-green-500":"bg-gray-300"}`}),e.jsx("span",{className:"font-semibold text-sm",children:"🟢 Sempre Aberta"})]}),e.jsx("p",{className:"text-xs text-gray-600",children:"Ignora horários, aberto 24h"})]}),e.jsxs("button",{type:"button",onClick:()=>O("closed"),className:`p-4 rounded-xl border-2 transition-all text-left ${P==="closed"?"border-red-500 bg-red-50":"border-gray-200 hover:border-gray-300 bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${P==="closed"?"bg-red-500":"bg-gray-300"}`}),e.jsx("span",{className:"font-semibold text-sm",children:"🔴 Fechada"})]}),e.jsx("p",{className:"text-xs text-gray-600",children:"Loja fechada independente do horário"})]})]})]}),P==="auto"&&e.jsxs(e.Fragment,{children:[e.jsx(ql,{}),e.jsxs("div",{children:[e.jsx(R,{className:"mb-3 block font-semibold",children:"Horário de Funcionamento"}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{htmlFor:"opening-time",className:"text-sm text-gray-600 mb-2 block",children:"Abertura"}),e.jsx(U,{id:"opening-time",type:"time",value:i.opening_time,onChange:C=>o(N=>({...N,opening_time:C.target.value}))})]}),e.jsxs("div",{children:[e.jsx(R,{htmlFor:"closing-time",className:"text-sm text-gray-600 mb-2 block",children:"Fechamento"}),e.jsx(U,{id:"closing-time",type:"time",value:i.closing_time,onChange:C=>o(N=>({...N,closing_time:C.target.value}))})]})]})]}),e.jsxs("div",{children:[e.jsx(R,{className:"mb-3 block font-semibold",children:"Dias de Funcionamento"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:U0.map(C=>e.jsx("button",{type:"button",onClick:()=>b(C.value),className:`w-14 h-12 rounded-lg border-2 font-semibold text-sm transition-all ${(i.working_days||[]).includes(C.value)?"bg-orange-500 border-orange-500 text-white":"bg-white border-gray-200 text-gray-600 hover:border-orange-300"}`,children:C.label},C.value))})]})]})]})]}),e.jsxs(B,{children:[e.jsxs(oe,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(ft,{className:"w-5 h-5 text-orange-500"}),"Pausa Temporária de Pedidos"]}),e.jsx(rs,{children:"Bloqueie pedidos sem fechar a loja"})]}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-yellow-50 border border-yellow-200 rounded-xl",children:[e.jsx(ot,{id:"pause-orders",checked:i.accepting_orders===!1,onCheckedChange:C=>o(N=>({...N,accepting_orders:!C}))}),e.jsxs("div",{className:"flex-1",children:[e.jsx(R,{htmlFor:"pause-orders",className:"font-semibold cursor-pointer",children:"Pausar Pedidos Temporariamente"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"A loja continua visível, mas os clientes não poderão fazer pedidos"})]})]}),i.accepting_orders===!1&&e.jsxs("div",{className:"pl-7",children:[e.jsx(R,{htmlFor:"pause-message",className:"text-sm mb-2 block",children:"Mensagem para clientes"}),e.jsx(U,{id:"pause-message",value:i.pause_message||"",onChange:C=>o(N=>({...N,pause_message:C.target.value})),placeholder:"Ex: Voltamos em 30 minutos"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2 p-3 bg-gray-50 rounded-lg border",children:[e.jsx("strong",{children:"Prévia:"})," ",i.pause_message||"Voltamos em breve."]})]})]})]}),f&&e.jsxs(B,{children:[e.jsxs(oe,{children:[e.jsx(ce,{children:"Banners do cardápio"}),e.jsx(rs,{children:"Foto de capa e banners promocionais exibidos no cardápio"})]}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Foto de capa (banner superior)"}),e.jsx("div",{className:"mt-1 w-full h-32 bg-gray-100 rounded-lg flex items-center justify-center overflow-hidden border-2 border-dashed",children:f.banner_image?e.jsx("img",{src:f.banner_image,alt:"Capa",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-gray-400 text-sm",children:"Nenhuma"})}),e.jsxs("label",{className:"mt-2 inline-block text-sm text-orange-600 cursor-pointer",children:["Alterar ",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:j})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx(R,{children:"Banners promocionais"}),e.jsx(D,{type:"button",size:"sm",variant:"outline",onClick:M,children:"+ Adicionar"})]}),(v||[]).map((C,N)=>e.jsxs("div",{className:"p-3 border rounded-lg mb-2 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-sm font-medium",children:["Banner ",N+1]}),e.jsx(D,{type:"button",variant:"ghost",size:"sm",className:"text-red-600",onClick:()=>z(N),children:"Remover"})]}),e.jsx("div",{className:"h-20 bg-gray-100 rounded flex items-center justify-center overflow-hidden",children:C.image?e.jsx("img",{src:C.image,alt:"",className:"max-h-full object-contain"}):e.jsx("span",{className:"text-gray-400 text-xs",children:"Sem imagem"})}),e.jsxs("label",{className:"text-xs text-orange-600 cursor-pointer",children:["Upload ",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:V=>$(V,N)})]}),e.jsx(U,{placeholder:"Título",value:C.title||"",onChange:V=>k(N,"title",V.target.value)}),e.jsx(U,{placeholder:"Subtítulo",value:C.subtitle||"",onChange:V=>k(N,"subtitle",V.target.value)}),e.jsx(U,{placeholder:"Link",value:C.link||"",onChange:V=>k(N,"link",V.target.value)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{checked:C.active!==!1,onCheckedChange:V=>k(N,"active",V)}),e.jsx(R,{className:"text-xs",children:"Ativo"})]})]},N))]})]})]}),!a&&s&&e.jsxs(B,{children:[e.jsxs(oe,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Ro,{className:"w-5 h-5"}),"Link do seu cardápio"]}),e.jsx(rs,{children:"Este é o link que seus clientes usam para ver o cardápio. Compartilhe no WhatsApp, redes sociais, etc."})]}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Seu link"}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx(U,{readOnly:!0,value:typeof window<"u"?`${window.location.origin}/s/${s?.slug||"..."}`:"",className:"font-mono text-xs sm:text-sm min-h-touch"}),e.jsx(D,{type:"button",variant:"outline",size:"icon",onClick:()=>{const C=`${window.location.origin}/s/${s?.slug||""}`;C&&navigator.clipboard&&navigator.clipboard.writeText(C).then(()=>W.success("Link copiado!"))},className:"min-h-touch min-w-touch",children:e.jsx(Ks,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Personalize o final do link (ex: meu-restaurante)"}),e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Apenas letras minúsculas, números e hífen. Deixe em branco para remover."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ca,{placeholder:"ex: meu-restaurante",value:c,onChange:C=>m(C.target.value),className:"font-mono"}),e.jsx(D,{type:"button",onClick:()=>p.mutate(c),disabled:p.isPending,className:"min-h-touch",children:p.isPending?"Salvando…":"Salvar"})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 pt-4 pb-6 bg-gray-50 z-10",children:e.jsxs(D,{type:"submit",size:"lg",className:"w-full bg-orange-500 hover:bg-orange-600 shadow-lg min-h-touch",disabled:g.isPending||u.isPending,children:[e.jsx(hr,{className:`w-4 h-4 sm:w-5 sm:h-5 mr-2 ${g.isPending||u.isPending?"animate-spin":""}`}),e.jsx("span",{className:"text-sm sm:text-base",children:g.isPending||u.isPending?"Salvando...":"Salvar Alterações"})]})})]})]})})}const B0=[{id:"dinheiro",name:"Dinheiro",icon:"💵",type:"presencial",active:!0},{id:"cartao_debito",name:"Cartão de Débito",icon:"💳",type:"presencial",active:!0},{id:"cartao_credito",name:"Cartão de Crédito",icon:"💳",type:"presencial",active:!0},{id:"pix",name:"Pix",icon:"📱",type:"presencial",active:!0},{id:"picpay",name:"PicPay",icon:"💚",type:"presencial",active:!1},{id:"vale_refeicao",name:"Vale - Refeição",icon:"🍽️",type:"presencial",active:!1},{id:"vale_vale_card",name:"Vale - Vale Card",icon:"💳",type:"presencial",active:!1},{id:"vale_green_card",name:"Vale - Green Card",icon:"💳",type:"presencial",active:!1},{id:"vale_verocard",name:"Vale - Verocard",icon:"💳",type:"presencial",active:!1},{id:"vale_vr_smart",name:"Vale - VR Smart",icon:"💳",type:"presencial",active:!1},{id:"vale_cooper_card",name:"Vale - Cooper Card",icon:"💳",type:"presencial",active:!1},{id:"ben_visa_refeicao",name:"Ben Visa Refeição",icon:"💳",type:"presencial",active:!1},{id:"vale_sodexo",name:"Vale - Sodexo",icon:"💳",type:"presencial",active:!1},{id:"vale_alelo_refeicao",name:"Vale - Alelo Refeição",icon:"💳",type:"presencial",active:!1},{id:"vale_green_card_2",name:"Vale - Green Card",icon:"💳",type:"presencial",active:!1},{id:"visa_refeicao",name:"Visa Refeição",icon:"💳",type:"presencial",active:!1},{id:"nutricash_refeicao",name:"Nutricash Refeição",icon:"💳",type:"presencial",active:!1}];function xy(){const[s,a]=w.useState(B0),[t,r]=w.useState(!1),[n,l]=w.useState(!1),[c,m]=w.useState(""),[i,o]=w.useState("all"),[d,p]=w.useState({name:"",icon:"💳",type:"presencial"}),[x,f]=w.useState({name:"",image:""}),v=es(),{menuContext:y}=Ze(),{data:j=[]}=Ae({queryKey:["store",y?.type,y?.value],queryFn:async()=>{if(!y)return[];const F={};return y.type==="subscriber"&&y.value&&(F.as_subscriber=y.value),ae.entities.Store.list(null,F)},enabled:!!y}),M=j[0],k=Array.isArray(M?.payment_methods)?M.payment_methods:[],z=le({mutationFn:F=>ae.entities.Store.update(M.id,{payment_methods:F}),onSuccess:()=>{v.invalidateQueries({queryKey:["store"]}),W.success("Formas de pagamento atualizadas")},onError:F=>W.error(F?.message||"Erro")}),$=()=>{x.name&&(z.mutate([...k,{name:x.name,image:x.image||""}]),f({name:"",image:""}))},u=F=>{const C=k.filter((N,V)=>V!==F);z.mutate(C)},g=le({mutationFn:F=>M?.id?ae.entities.Store.update(M.id,{payment_methods_config:JSON.stringify(F)}):Promise.resolve(),onSuccess:()=>{v.invalidateQueries({queryKey:["store"]}),W.success("Métodos de pagamento salvos")},onError:()=>W.error("Erro ao salvar métodos")});w.useEffect(()=>{if(M?.payment_methods_config)try{const F=JSON.parse(M.payment_methods_config);Array.isArray(F)&&F.length>0&&a(F)}catch(F){console.error("Erro ao carregar métodos salvos:",F)}},[M?.payment_methods_config]);const T=F=>{const C=s.map(N=>N.id===F?{...N,active:!N.active}:N);a(C),M?.id&&g.mutate(C)},h=()=>{const F=Date.now().toString(),C=[...s,{...d,id:F,active:!0}];a(C),r(!1),p({name:"",icon:"💳",type:"presencial"}),M?.id&&g.mutate(C)},b=F=>{const C=s.find(N=>N.id===F);if(confirm(`Remover forma de pagamento "${C?.name}"?`)){const N=s.filter(V=>V.id!==F);a(N),M?.id&&g.mutate(N),W.success("Método removido")}},L=w.useMemo(()=>s.filter(F=>{if(F.type!=="presencial")return!1;const C=!c||F.name?.toLowerCase().includes(c.toLowerCase()),N=i==="all"||i==="active"&&F.active||i==="inactive"&&!F.active;return C&&N}),[s,c,i]),P=w.useMemo(()=>{const F=s.filter(E=>E.type==="presencial"),C=F.filter(E=>E.active).length,N=F.filter(E=>!E.active).length;return{total:F.length,active:C,inactive:N}},[s]).active;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Pagamentos"}),e.jsx("p",{className:"text-gray-600",children:"Defina as opções de pagamento que seu cliente poderá escolher na hora de fazer o pedido."})]}),e.jsxs("div",{className:"flex gap-4 border-b",children:[e.jsx("button",{className:"px-4 py-2 font-medium border-b-2 border-red-500 text-red-500",children:"CONFIGURAÇÕES"}),e.jsx("button",{onClick:()=>l(!0),className:"px-4 py-2 font-medium text-gray-500 hover:text-gray-700",children:"EXTRATO PAGAMENTO ONLINE"})]}),M&&e.jsxs(B,{children:[e.jsxs(oe,{children:[e.jsx(ce,{children:"Formas de pagamento aceitas (cardápio)"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Exibidas no checkout. Nome e imagem da bandeira."})]}),e.jsxs(H,{className:"space-y-3",children:[k.map((F,C)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 border rounded-lg",children:[F.image&&e.jsx("img",{src:F.image,alt:"",className:"h-8 object-contain"}),e.jsx("span",{className:"flex-1 font-medium",children:F.name}),e.jsx(D,{type:"button",variant:"ghost",size:"sm",className:"text-red-600",onClick:()=>u(C),children:"Remover"})]},C)),e.jsxs("div",{className:"p-3 border-2 border-dashed rounded-lg space-y-2",children:[e.jsx(U,{placeholder:"Nome (ex: PIX, Visa, Mastercard)",value:x.name,onChange:F=>f(C=>({...C,name:F.target.value}))}),e.jsx(U,{placeholder:"URL da imagem da bandeira",value:x.image,onChange:F=>f(C=>({...C,image:F.target.value}))}),e.jsx(D,{type:"button",onClick:$,disabled:!x.name||z.isPending,children:"Adicionar"})]})]})]}),e.jsxs(B,{className:"bg-blue-50 border-blue-200",children:[e.jsx(oe,{className:"pb-3",children:e.jsx(ce,{className:"text-sm",children:"Pagamento Online"})}),e.jsxs(H,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(fe,{className:"bg-blue-500",children:"Recomendamos que use 2 dias úteis"}),e.jsx("span",{className:"text-sm",children:"- Financeiro WhatsApp (19) 9 9736-0573"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[e.jsx("span",{className:"text-sm font-medium",children:"Pix Online"}),e.jsx(Le,{})]})]})]}),e.jsxs(B,{children:[e.jsxs(oe,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ce,{children:"Pagamento Presencial"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[P," formas de pagamento ativas"]})]}),e.jsxs(D,{onClick:()=>r(!0),className:"bg-green-600 hover:bg-green-700",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"ADICIONAR NOVO TIPO DE PAGAMENTO"]})]}),e.jsx(H,{children:P===0?e.jsx(gn,{icon:lt,title:"Configure métodos de pagamento para começar a vender",description:"Ative pelo menos uma forma de pagamento para que seus clientes possam fazer pedidos",actionLabel:"Ativar pagamentos",onAction:()=>{const F=s.find(C=>C.type==="presencial");F&&T(F.id)}}):L.length===0?e.jsx("div",{className:"text-center py-12 text-gray-400 border-2 border-dashed rounded-xl",children:c||i!=="all"?"Nenhum método encontrado com os filtros aplicados":"Nenhum método de pagamento cadastrado"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:L.map(F=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:F.icon}),e.jsx("span",{className:"font-medium",children:F.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:F.active?"bg-green-100 text-green-700":"bg-red-100 text-red-700",children:F.active?"ATIVO":"PASSIVO"}),e.jsx(D,{size:"icon",variant:"ghost",onClick:()=>T(F.id),className:"h-8 w-8",children:e.jsx($t,{className:"w-4 h-4"})}),e.jsx(D,{size:"icon",variant:"ghost",onClick:()=>b(F.id),className:"h-8 w-8 text-red-500",children:e.jsx(Ke,{className:"w-4 h-4"})})]})]},F.id))})})]}),e.jsx(ze,{open:t,onOpenChange:r,children:e.jsxs(Te,{children:[e.jsx(Fe,{children:e.jsx(Re,{children:"Adicionar Forma de Pagamento"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome"}),e.jsx(U,{value:d.name,onChange:F=>p({...d,name:F.target.value}),placeholder:"Ex: Credicard"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Ícone (Emoji)"}),e.jsx(U,{value:d.icon,onChange:F=>p({...d,icon:F.target.value}),placeholder:"💳"})]})]}),e.jsxs(Ws,{children:[e.jsx(D,{variant:"outline",onClick:()=>r(!1),children:"Cancelar"}),e.jsx(D,{onClick:h,disabled:!d.name,className:"bg-green-600 hover:bg-green-700",children:"Adicionar"})]})]})}),e.jsx(ze,{open:n,onOpenChange:l,children:e.jsxs(Te,{className:"sm:max-w-2xl max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsx(Fe,{children:e.jsx(Re,{children:"Extrato Pagamento Online"})}),e.jsx("div",{className:"py-4",children:e.jsx("p",{className:"text-center text-gray-500",children:"Nenhuma transação encontrada"})})]})})]})}function py(){const[s,a]=w.useState(!1),t=es(),{menuContext:r}=Ze(),{data:n=[]}=Ae({queryKey:["printerConfig",r?.type,r?.value],queryFn:async()=>{if(!r)return[];const v={};return r.type==="subscriber"&&r.value&&(v.as_subscriber=r.value),ae.entities.PrinterConfig.list(null,v)},enabled:!!r}),l=n[0]||{printer_name:"",printer_type:"termica",connection_type:"usb",paper_width:"80mm",margin_top:5,margin_bottom:5,margin_left:5,margin_right:5,line_spacing:1.5,font_size:12,auto_cut:!0,open_drawer:!1},[c,m]=w.useState(l),i=le({mutationFn:v=>l.id?ae.entities.PrinterConfig.update(l.id,v):ae.entities.PrinterConfig.create(v),onSuccess:()=>{t.invalidateQueries({queryKey:["printerConfig"]}),W.success("✅ Configuração salva com sucesso!")},onError:v=>W.error("Erro ao salvar: "+(v?.message||"Desconhecido"))}),o=()=>{i.mutate(c)},d=()=>{if(!c.printer_name?.trim()){W.error("Configure o nome da impressora antes de testar");return}const v=x();f(v),W.success("Enviando para impressora...",{duration:3e3,icon:"🖨️"})},p=w.useMemo(()=>!!c.printer_name?.trim(),[c.printer_name]),x=()=>`
============================
       TESTE DE IMPRESSÃO
============================

Impressora: ${c.printer_name}
Tipo: ${c.printer_type}
Largura: ${c.paper_width}

--- Teste de Texto ---
Este é um teste de impressão.
Fonte: ${c.font_size}pt
Espaçamento: ${c.line_spacing}

============================
       DATA/HORA TESTE
    ${new Date().toLocaleString("pt-BR")}
============================
`.trim(),f=v=>{const y=window.open("","_blank"),j=`
      <style>
        @page { 
          margin: ${c.margin_top}mm ${c.margin_right}mm ${c.margin_bottom}mm ${c.margin_left}mm; 
          size: ${c.paper_width==="58mm"?"58mm":c.paper_width==="80mm"?"80mm":"auto"} auto;
        }
        body { 
          font-family: 'Courier New', monospace; 
          font-size: ${c.font_size}pt;
          line-height: ${c.line_spacing};
          white-space: pre-wrap;
        }
      </style>
    `;y.document.write(j+"<pre>"+v+"</pre>"),y.document.close(),setTimeout(()=>{y.print(),c.auto_cut&&y.close()},250)};return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(qi,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Configuração de Impressora"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Configure sua impressora para receitas e comandas"})]})]}),e.jsx(B,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Status da Configuração"}),e.jsx("p",{className:"text-lg font-bold",children:p?"Configurada":"Não Configurada"})]}),p?e.jsx(rt,{className:"w-8 h-8 text-green-500"}):e.jsx(ft,{className:"w-8 h-8 text-yellow-500"})]})})}),e.jsxs(B,{children:[e.jsxs(oe,{children:[e.jsx(ce,{children:"Configurações Básicas"}),e.jsx(rs,{children:"Informações principais da impressora"})]}),e.jsxs(H,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome da Impressora *"}),e.jsx(U,{value:c.printer_name,onChange:v=>m({...c,printer_name:v.target.value}),placeholder:"Ex: Epson TM-T20",required:!0,className:c.printer_name?.trim()?"":"border-red-300"}),!c.printer_name?.trim()&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Nome da impressora é obrigatório"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Tipo de Impressora"}),e.jsxs(Ce,{value:c.printer_type,onValueChange:v=>m({...c,printer_type:v}),children:[e.jsx(ke,{children:e.jsx(Se,{})}),e.jsxs(De,{children:[e.jsx(Q,{value:"termica",children:"Térmica"}),e.jsx(Q,{value:"laser",children:"Laser"}),e.jsx(Q,{value:"jato_tinta",children:"Jato de Tinta"})]})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Tipo de Conexão"}),e.jsxs(Ce,{value:c.connection_type,onValueChange:v=>m({...c,connection_type:v}),children:[e.jsx(ke,{children:e.jsx(Se,{})}),e.jsxs(De,{children:[e.jsx(Q,{value:"usb",children:"USB"}),e.jsx(Q,{value:"rede",children:"Rede"}),e.jsx(Q,{value:"bluetooth",children:"Bluetooth"})]})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Largura do Papel"}),e.jsxs(Ce,{value:c.paper_width,onValueChange:v=>m({...c,paper_width:v}),children:[e.jsx(ke,{children:e.jsx(Se,{})}),e.jsxs(De,{children:[e.jsx(Q,{value:"58mm",children:"58mm"}),e.jsx(Q,{value:"80mm",children:"80mm"}),e.jsx(Q,{value:"custom",children:"Personalizado"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(R,{className:"mb-2 block",children:"Margens (mm)"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx(R,{className:"text-xs text-gray-500",children:"Superior"}),e.jsx(U,{type:"number",value:c.margin_top,onChange:v=>m({...c,margin_top:parseFloat(v.target.value)})})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-xs text-gray-500",children:"Inferior"}),e.jsx(U,{type:"number",value:c.margin_bottom,onChange:v=>m({...c,margin_bottom:parseFloat(v.target.value)})})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-xs text-gray-500",children:"Esquerda"}),e.jsx(U,{type:"number",value:c.margin_left,onChange:v=>m({...c,margin_left:parseFloat(v.target.value)})})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-xs text-gray-500",children:"Direita"}),e.jsx(U,{type:"number",value:c.margin_right,onChange:v=>m({...c,margin_right:parseFloat(v.target.value)})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Espaçamento entre Linhas"}),e.jsx(U,{type:"number",step:"0.1",value:c.line_spacing,onChange:v=>m({...c,line_spacing:parseFloat(v.target.value)})})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Tamanho da Fonte (pt)"}),e.jsx(U,{type:"number",value:c.font_size,onChange:v=>m({...c,font_size:parseInt(v.target.value)})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ot,{checked:c.auto_cut,onCheckedChange:v=>m({...c,auto_cut:v})}),e.jsx(R,{children:"Corte automático do papel"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ot,{checked:c.open_drawer,onCheckedChange:v=>m({...c,open_drawer:v})}),e.jsx(R,{children:"Abrir gaveta de dinheiro (se suportado)"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[e.jsxs(D,{onClick:o,className:"flex-1 bg-green-600 hover:bg-green-700",disabled:!p||i.isPending,children:[e.jsx(hr,{className:"w-4 h-4 mr-2"}),i.isPending?"Salvando...":"Salvar Configuração"]}),e.jsxs(D,{onClick:()=>a(!0),variant:"outline",disabled:!p,children:[e.jsx(qa,{className:"w-4 h-4 mr-2"}),"Visualizar"]}),e.jsxs(D,{onClick:d,variant:"outline",disabled:!p,children:[e.jsx(Yu,{className:"w-4 h-4 mr-2"}),"Testar Impressão"]})]})]})]}),e.jsx(ze,{open:s,onOpenChange:a,children:e.jsxs(Te,{className:"max-w-md",children:[e.jsx(Fe,{children:e.jsx(Re,{children:"Preview da Comanda"})}),e.jsx("div",{className:"bg-white border-2 border-dashed p-4 font-mono text-xs overflow-auto max-h-96",style:{fontSize:`${c.font_size}pt`,lineHeight:c.line_spacing},children:e.jsx("pre",{children:x()})})]})})]})}function gy(){const[s,a]=w.useState(!1),[t,r]=w.useState(!1),[n,l]=w.useState(!1),[c,m]=w.useState(!1),[i,o]=w.useState(null),[d,p]=w.useState(""),[x,f]=w.useState(""),[v,y]=w.useState({amount:"",reason:""}),[j,M]=w.useState({amount:"",reason:""}),[k,z]=w.useState(""),[$,u]=w.useState("all"),[g,T]=w.useState(""),h=es(),{menuContext:b}=Ze(),{requireAuthorization:L,modal:O}=Io(),{data:P=[]}=Ae({queryKey:["caixas",b?.type,b?.value],queryFn:async()=>{if(!b)return[];const A={};return b.type==="subscriber"&&b.value&&(A.as_subscriber=b.value),ae.entities.Caixa.list("-opening_date",A)},enabled:!!b}),{data:F=[]}=Ae({queryKey:["caixaOperations",b?.type,b?.value],queryFn:async()=>{if(!b)return[];const A={};return b.type==="subscriber"&&b.value&&(A.as_subscriber=b.value),ae.entities.CaixaOperation.list("-date",A)},enabled:!!b}),{data:C=[]}=Ae({queryKey:["pdvSessions",b?.type,b?.value],queryFn:async()=>{if(!b)return[];const A={ended_at:"null"};return b.type==="subscriber"&&b.value&&(A.as_subscriber=b.value),ae.entities.PDVSession.list("-created_at",A).catch(()=>[])},enabled:!!b}),N=Array.isArray(C)?C.filter(A=>!A.ended_at):[],V=le({mutationFn:async A=>{const X=await ae.auth.me();return ae.entities.Caixa.create({...A,owner_email:X.subscriber_email||X.email,opened_by:X.email})},onSuccess:()=>{h.invalidateQueries({queryKey:["caixas"]}),a(!1),p(""),W.success("✅ Caixa aberto com sucesso!")}}),E=le({mutationFn:async({id:A,freshCaixa:X,totals:ge,closingCash:xe,closingNotes:Ee})=>{const K=await ae.auth.me(),me={...X,opening_amount_cash:Number(X.opening_amount_cash)||0,status:"closed",total_cash:ge.cash,total_pix:ge.pix,total_debit:ge.debit,total_credit:ge.credit,total_other:ge.other,closing_amount_cash:Number(xe)||0,closing_notes:Ee||"",closed_by:K.email,closing_date:new Date().toISOString()};return delete me.id,delete me.created_date,delete me.updated_date,delete me.created_by,ae.entities.Caixa.update(A,me)},onSuccess:()=>{h.invalidateQueries({queryKey:["caixas"]}),r(!1),o(null),f(""),W.success("✅ Caixa fechado com sucesso!")},onError:A=>{console.error("Erro ao fechar caixa:",A),W.error("Erro ao fechar caixa: "+A.message)}}),ee=le({mutationFn:async A=>{const X=await ae.auth.me();return ae.entities.CaixaOperation.create({...A,operator:X.email,date:new Date().toISOString()})},onSuccess:()=>{h.invalidateQueries({queryKey:["caixaOperations"]}),h.invalidateQueries({queryKey:["caixas"]})}}),ue=()=>{if(P.filter(X=>X.status==="open").length>0){W.error("❌ Já existe um caixa aberto!");return}V.mutate({opening_amount_cash:parseFloat(d)||0,opening_date:new Date().toISOString(),status:"open",total_cash:0,total_pix:0,total_debit:0,total_credit:0,total_other:0,withdrawals:0,supplies:0})},Z=async()=>{if(!v.amount||!v.reason){W.error("Preencha todos os campos");return}const A=F.filter(je=>je.caixa_id===i.id),X=A.filter(je=>je.type==="venda_pdv"),ge=A.filter(je=>je.type==="sangria"),xe=A.filter(je=>je.type==="suprimento"),Ee=X.filter(je=>je.payment_method==="dinheiro").reduce((je,ve)=>je+ve.amount,0),K=ge.reduce((je,ve)=>je+ve.amount,0),me=xe.reduce((je,ve)=>je+ve.amount,0),Be=(i.opening_amount_cash||0)+Ee+me-K;if(parseFloat(v.amount)>Be){W.error(`⚠️ Saldo insuficiente! Saldo atual: ${q(Be)}`);return}await ee.mutateAsync({caixa_id:i.id,type:"sangria",description:`Sangria: ${v.reason}`,amount:parseFloat(v.amount),payment_method:"dinheiro",reason:v.reason});const ie=(await ae.entities.Caixa.list()).find(je=>je.id===i.id);if(!ie){W.error("Caixa não encontrado");return}const Ge={...ie,withdrawals:(ie.withdrawals||0)+parseFloat(v.amount)};delete Ge.id,delete Ge.created_date,delete Ge.updated_date,delete Ge.created_by,await ae.entities.Caixa.update(i.id,Ge),h.invalidateQueries({queryKey:["caixas"]}),l(!1),y({amount:"",reason:""}),W.success("💰 Sangria registrada")},S=async()=>{if(!j.amount||!j.reason){W.error("Preencha todos os campos");return}await ee.mutateAsync({caixa_id:i.id,type:"suprimento",description:`Suprimento: ${j.reason}`,amount:parseFloat(j.amount),payment_method:"dinheiro",reason:j.reason});const X=(await ae.entities.Caixa.list()).find(xe=>xe.id===i.id);if(!X){W.error("Caixa não encontrado");return}const ge={...X,supplies:(X.supplies||0)+parseFloat(j.amount)};delete ge.id,delete ge.created_date,delete ge.updated_date,delete ge.created_by,await ae.entities.Caixa.update(i.id,ge),h.invalidateQueries({queryKey:["caixas"]}),m(!1),M({amount:"",reason:""}),W.success("💵 Suprimento registrado")},G=async()=>{if(!i||!g){W.error("Informe o valor em dinheiro físico para fechamento");return}const A=F.filter(me=>me.caixa_id===i.id&&me.type==="venda_pdv"),X={cash:A.filter(me=>me.payment_method==="dinheiro").reduce((me,Be)=>me+Be.amount,0),pix:A.filter(me=>me.payment_method==="pix").reduce((me,Be)=>me+Be.amount,0),debit:A.filter(me=>me.payment_method==="debito").reduce((me,Be)=>me+Be.amount,0),credit:A.filter(me=>me.payment_method==="credito").reduce((me,Be)=>me+Be.amount,0),other:A.filter(me=>me.payment_method==="outro").reduce((me,Be)=>me+Be.amount,0)},xe=(await ae.entities.Caixa.list()).find(me=>me.id===i.id);if(!xe){W.error("Caixa não encontrado");return}const Ee=(xe.opening_amount_cash||0)+X.cash+(xe.supplies||0)-(xe.withdrawals||0),K=parseFloat(g);E.mutate({id:i.id,freshCaixa:xe,totals:X,closingCash:K,closingNotes:x+(K!==Ee?`

Diferença: ${q(K-Ee)}`:"")})},q=A=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(A||0),ne=P.filter(A=>A.status==="open"),Me=ne[0],Y=P.filter(A=>{const X=!k||A.id?.toString().includes(k)||J(A.opening_date).format("DD/MM/YYYY").includes(k),ge=$==="all"||$==="open"&&A.status==="open"||$==="closed"&&A.status==="closed";return X&&ge});if(i){const A=F.filter(ie=>ie.caixa_id===i.id),X=A.filter(ie=>ie.type==="venda_pdv"),ge=A.filter(ie=>ie.type==="sangria"),xe=A.filter(ie=>ie.type==="suprimento"),Ee=X.reduce((ie,Ge)=>ie+Ge.amount,0),K=ge.reduce((ie,Ge)=>ie+Ge.amount,0),me=xe.reduce((ie,Ge)=>ie+Ge.amount,0),Be=X.filter(ie=>ie.payment_method==="dinheiro").reduce((ie,Ge)=>ie+Ge.amount,0),ds=(i.opening_amount_cash||0)+Be+me-K,ns=i.status==="closed";return e.jsxs(e.Fragment,{children:[e.jsx(Hr,{position:"top-center"}),e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(D,{variant:"ghost",onClick:()=>o(null),children:[e.jsx(uu,{className:"w-4 h-4 mr-2"}),"Voltar"]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Detalhes do Caixa"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Aberto em ",J(i.opening_date).format("DD/MM/YYYY HH:mm"),i.opened_by&&e.jsxs(e.Fragment,{children:[" por ",i.opened_by]})]}),ns&&i.closed_by&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Fechado por: ",i.closed_by]})]})]}),e.jsx(fe,{className:ns?"bg-gray-500":"bg-green-500",children:ns?"🔒 Fechado":"✅ Aberto"})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs(B,{children:[e.jsx(oe,{className:"pb-3",children:e.jsx(ce,{className:"text-sm text-gray-600",children:"💵 Dinheiro"})}),e.jsx(H,{children:e.jsx("p",{className:"text-2xl font-bold",children:q(Be)})})]}),e.jsxs(B,{children:[e.jsx(oe,{className:"pb-3",children:e.jsx(ce,{className:"text-sm text-gray-600",children:"📲 PIX"})}),e.jsx(H,{children:e.jsx("p",{className:"text-2xl font-bold",children:q(X.filter(ie=>ie.payment_method==="pix").reduce((ie,Ge)=>ie+Ge.amount,0))})})]}),e.jsxs(B,{children:[e.jsx(oe,{className:"pb-3",children:e.jsx(ce,{className:"text-sm text-gray-600",children:"💳 Débito"})}),e.jsx(H,{children:e.jsx("p",{className:"text-2xl font-bold",children:q(X.filter(ie=>ie.payment_method==="debito").reduce((ie,Ge)=>ie+Ge.amount,0))})})]}),e.jsxs(B,{children:[e.jsx(oe,{className:"pb-3",children:e.jsx(ce,{className:"text-sm text-gray-600",children:"💳 Crédito"})}),e.jsx(H,{children:e.jsx("p",{className:"text-2xl font-bold",children:q(X.filter(ie=>ie.payment_method==="credito").reduce((ie,Ge)=>ie+Ge.amount,0))})})]}),e.jsxs(B,{children:[e.jsx(oe,{className:"pb-3",children:e.jsx(ce,{className:"text-sm text-gray-600",children:"🧾 Outros"})}),e.jsx(H,{children:e.jsx("p",{className:"text-2xl font-bold",children:q(X.filter(ie=>ie.payment_method==="outro").reduce((ie,Ge)=>ie+Ge.amount,0))})})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs(B,{className:"lg:col-span-2",children:[e.jsx(oe,{children:e.jsx(ce,{children:"Controle de Dinheiro Físico"})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Fundo Inicial"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:q(i.opening_amount_cash)})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Vendas em Dinheiro"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:q(Be)})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Suprimentos"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-600",children:["+",q(me)]})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Sangrias"}),e.jsxs("p",{className:"text-2xl font-bold text-red-600",children:["-",q(K)]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-green-500 to-green-600 p-6 rounded-xl text-white",children:[e.jsx("p",{className:"text-sm opacity-90 mb-2",children:"💵 Saldo Atual em Dinheiro"}),e.jsx("p",{className:"text-4xl font-bold",children:q(ds)})]}),!ns&&e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(D,{onClick:()=>L("suprimento",()=>m(!0)),className:"bg-orange-500 hover:bg-orange-600 h-12",children:[e.jsx(Ls,{className:"w-4 h-4 mr-2"}),"Suprimento"]}),e.jsxs(D,{onClick:()=>L("sangria",()=>l(!0)),className:"bg-red-500 hover:bg-red-600 h-12",children:[e.jsx(Yl,{className:"w-4 h-4 mr-2"}),"Sangria"]})]})]})]}),e.jsxs(B,{children:[e.jsx(oe,{children:e.jsx(ce,{children:"Total de Vendas"})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"text-center py-6",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Total Geral"}),e.jsx("p",{className:"text-4xl font-bold text-green-600",children:q(Ee)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[X.length," vendas registradas"]})]}),!ns&&e.jsx(D,{onClick:()=>L("fechar_caixa",()=>r(!0)),className:"w-full bg-gray-900 hover:bg-gray-800 h-14 text-lg",children:"🔒 Fechar Caixa"})]})]})]}),e.jsxs(B,{children:[e.jsx(oe,{children:e.jsx(ce,{children:"Histórico de Movimentações"})}),e.jsx(H,{children:A.length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Nenhuma movimentação registrada"}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:A.map(ie=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[ie.type==="venda_pdv"&&e.jsx(_u,{className:"w-5 h-5 text-green-600"}),ie.type==="sangria"&&e.jsx(Yl,{className:"w-5 h-5 text-red-600"}),ie.type==="suprimento"&&e.jsx(Ls,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:ie.description}),e.jsxs("p",{className:"text-xs text-gray-500",children:[J(ie.date).format("DD/MM HH:mm"),ie.operator&&e.jsxs(e.Fragment,{children:[" · Operador: ",ie.operator]})]}),ie.type==="venda_pdv"&&e.jsxs("div",{className:"text-xs text-gray-600 mt-1 space-y-0.5",children:[e.jsxs("div",{children:["💳 ",ie.payment_method]}),ie.payment_amount&&e.jsxs("div",{children:["💵 Recebido: ",q(ie.payment_amount)]}),ie.change>0&&e.jsxs("div",{children:["💸 Troco: ",q(ie.change)]})]})]})]}),e.jsxs("span",{className:`font-bold ${ie.type==="sangria"?"text-red-600":"text-green-600"}`,children:[ie.type==="sangria"?"-":"+",q(ie.amount)]})]},ie.id))})})]})]}),e.jsx(ze,{open:t,onOpenChange:ie=>{r(ie),ie||(T(""),f(""))},children:e.jsxs(Te,{children:[e.jsx(Fe,{children:e.jsx(Re,{children:"Confirmar Fechamento do Caixa"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 p-4 rounded-lg",children:e.jsx("p",{className:"text-sm text-yellow-800",children:"⚠️ Após o fechamento, o caixa não poderá ser editado"})}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total em Vendas"}),e.jsx("span",{className:"font-bold",children:q(Ee)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Saldo Esperado em Dinheiro"}),e.jsx("span",{className:"font-bold text-blue-600",children:q(ds)})]})]}),e.jsxs("div",{children:[e.jsx(R,{className:"font-semibold",children:"Valor Real em Dinheiro Físico (R$) *"}),e.jsx(U,{type:"number",step:"0.01",value:g,onChange:ie=>T(ie.target.value),placeholder:"0,00",className:"text-xl font-bold h-14 text-center border-2",autoFocus:!0}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Informe o valor físico contado no caixa"}),g&&parseFloat(g)!==ds&&e.jsx("div",{className:`mt-2 p-3 rounded-lg ${parseFloat(g)>ds?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:e.jsxs("p",{className:`text-sm font-semibold ${parseFloat(g)>ds?"text-green-800":"text-red-800"}`,children:[parseFloat(g)>ds?"✅":"⚠️"," Diferença: ",q(Math.abs(parseFloat(g)-ds)),parseFloat(g)>ds?" (Sobra)":" (Falta)"]})})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Observações (opcional)"}),e.jsx(Ms,{value:x,onChange:ie=>f(ie.target.value),placeholder:"Adicione observações sobre o fechamento...",rows:3})]})]}),e.jsxs(Ws,{children:[e.jsx(D,{variant:"outline",onClick:()=>{r(!1),T(""),f("")},children:"Cancelar"}),e.jsx(D,{onClick:G,disabled:!g,className:"bg-gray-900",children:"Confirmar Fechamento"})]})]})}),e.jsx(ze,{open:n,onOpenChange:l,children:e.jsxs(Te,{children:[e.jsx(Fe,{children:e.jsx(Re,{children:"Registrar Sangria"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Valor (R$)"}),e.jsx(U,{type:"number",step:"0.01",value:v.amount,onChange:ie=>y({...v,amount:ie.target.value}),placeholder:"0,00",className:"text-lg font-semibold"}),v.amount&&i&&(()=>{const ie=F.filter(qe=>qe.caixa_id===i.id),Ge=ie.filter(qe=>qe.type==="venda_pdv"),je=ie.filter(qe=>qe.type==="sangria"),ve=ie.filter(qe=>qe.type==="suprimento"),zs=Ge.filter(qe=>qe.payment_method==="dinheiro").reduce((qe,be)=>qe+be.amount,0),Ga=je.reduce((qe,be)=>qe+be.amount,0),vt=ve.reduce((qe,be)=>qe+be.amount,0),ps=(i.opening_amount_cash||0)+zs+vt-Ga,As=parseFloat(v.amount)<=ps;return e.jsxs("div",{className:`mt-2 p-2 rounded text-xs ${As?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:["Saldo disponível: ",q(ps),!As&&e.jsx("span",{className:"block font-semibold mt-1",children:"⚠️ Valor excede o saldo disponível!"})]})})()]}),e.jsxs("div",{children:[e.jsx(R,{children:"Motivo"}),e.jsx(U,{value:v.reason,onChange:ie=>y({...v,reason:ie.target.value}),placeholder:"Ex: Depósito bancário, pagamento fornecedor..."})]})]}),e.jsxs(Ws,{children:[e.jsx(D,{variant:"outline",onClick:()=>l(!1),children:"Cancelar"}),e.jsx(D,{onClick:Z,className:"bg-red-600",children:"Registrar Sangria"})]})]})}),e.jsx(ze,{open:c,onOpenChange:m,children:e.jsxs(Te,{children:[e.jsx(Fe,{children:e.jsx(Re,{children:"Registrar Suprimento"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Valor (R$)"}),e.jsx(U,{type:"number",step:"0.01",value:j.amount,onChange:ie=>M({...j,amount:ie.target.value}),placeholder:"0,00"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Motivo"}),e.jsx(U,{value:j.reason,onChange:ie=>M({...j,reason:ie.target.value}),placeholder:"Ex: Fundo adicional, reforço de caixa..."})]})]}),e.jsxs(Ws,{children:[e.jsx(D,{variant:"outline",onClick:()=>m(!1),children:"Cancelar"}),e.jsx(D,{onClick:S,className:"bg-orange-600",children:"Registrar Suprimento"})]})]})})]})}return e.jsxs(e.Fragment,{children:[e.jsx(Hr,{position:"top-center"}),e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"💰 Controle de Caixa"}),e.jsx("p",{className:"text-gray-600",children:"Gerencie abertura, fechamento e movimentações diárias"})]}),e.jsxs(D,{onClick:()=>L("abrir_caixa",()=>a(!0)),disabled:ne.length>0,className:"bg-green-600 hover:bg-green-700 h-12",children:[e.jsx(la,{className:"w-5 h-5 mr-2"}),"Abrir Caixa"]})]}),e.jsxs(B,{children:[e.jsxs(oe,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Lo,{className:"w-5 h-5"}),"Sessões PDV ativas"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Colaboradores logados em cada terminal PDV"})]}),e.jsx(H,{children:N.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"Nenhuma sessão PDV ativa no momento."}):e.jsx("ul",{className:"space-y-2",children:N.map(A=>e.jsxs("li",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-0",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:A.terminal_name||A.terminal_id||"PDV"}),e.jsxs("span",{className:"text-gray-600 text-sm ml-2",children:["— ",A.operator_name||A.operator_email||"Operador"]})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["desde ",A.started_at?J(A.started_at).format("DD/MM HH:mm"):"-"]})]},A.id))})})]}),ne.length>0&&e.jsx(B,{className:"border-green-500 border-2 bg-green-50",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-green-500 rounded-full flex items-center justify-center",children:e.jsx($a,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx(fe,{className:"bg-green-500 mb-2",children:"✅ Caixa Aberto"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Aberto em ",J(Me.opening_date).format("DD/MM/YYYY HH:mm"),Me.opened_by&&e.jsxs(e.Fragment,{children:[" por ",Me.opened_by]})]}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["Fundo Inicial: ",q(Me.opening_amount_cash)]})]})]}),e.jsxs(D,{onClick:()=>o(Me),size:"lg",children:["Gerenciar Caixa",e.jsx(bo,{className:"w-4 h-4 ml-2"})]})]})})}),ne.length===0&&e.jsx(B,{className:"border-gray-300 border-dashed border-2",children:e.jsxs(H,{className:"p-12 text-center",children:[e.jsx(vo,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-gray-600 mb-2",children:"Nenhum caixa aberto"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"Abra um caixa para começar a registrar vendas"})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(_s,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(U,{placeholder:"Buscar por data ou ID...",value:k,onChange:A=>z(A.target.value),className:"pl-10"})]}),e.jsxs(Ce,{value:$,onValueChange:u,children:[e.jsxs(ke,{className:"w-[180px]",children:[e.jsx(oa,{className:"w-4 h-4 mr-2"}),e.jsx(Se,{})]}),e.jsxs(De,{children:[e.jsx(Q,{value:"all",children:"Todos"}),e.jsx(Q,{value:"open",children:"Abertos"}),e.jsx(Q,{value:"closed",children:"Fechados"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"📋 Histórico de Caixas"}),Y.filter(A=>A.status==="closed").length===0?e.jsx(B,{children:e.jsx(H,{className:"p-8 text-center text-gray-500",children:"Nenhum caixa fechado ainda"})}):e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:Y.filter(A=>A.status==="closed").slice(0,12).map(A=>e.jsx(B,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>o(A),children:e.jsxs(H,{className:"p-4",children:[e.jsx(fe,{className:"bg-gray-500 mb-3",children:"🔒 Fechado"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:J(A.opening_date).format("DD/MM/YYYY")}),(A.opened_by||A.closed_by)&&e.jsxs("p",{className:"text-xs text-gray-500 mb-2",children:[A.opened_by&&e.jsxs(e.Fragment,{children:["Aberto por: ",A.opened_by]}),A.opened_by&&A.closed_by&&" · ",A.closed_by&&e.jsxs(e.Fragment,{children:["Fechado por: ",A.closed_by]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Vendas"}),e.jsx("span",{className:"font-bold",children:q((A.total_cash||0)+(A.total_pix||0)+(A.total_debit||0)+(A.total_credit||0)+(A.total_other||0))})]}),e.jsxs("div",{className:"flex justify-between text-sm pt-2 border-t",children:[e.jsx("span",{className:"font-medium",children:"Fechamento"}),e.jsx("span",{className:"font-bold text-green-600",children:q(A.closing_amount_cash)})]})]})]})},A.id))})]}),e.jsx(ze,{open:s,onOpenChange:a,children:e.jsxs(Te,{children:[e.jsx(Fe,{children:e.jsx(Re,{children:"Abrir Novo Caixa"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 p-4 rounded-lg",children:e.jsx("p",{className:"text-sm text-blue-800",children:"💡 Informe o valor em dinheiro físico que você está colocando no caixa para começar o dia"})}),e.jsxs("div",{children:[e.jsx(R,{children:"Fundo de Caixa Inicial (R$)"}),e.jsx(U,{type:"number",step:"0.01",value:d,onChange:A=>p(A.target.value),placeholder:"0,00",className:"text-xl font-bold h-14",autoFocus:!0})]})]}),e.jsxs(Ws,{children:[e.jsx(D,{variant:"outline",onClick:()=>a(!1),children:"Cancelar"}),e.jsx(D,{onClick:ue,disabled:!d,className:"bg-green-600",children:"Abrir Caixa"})]})]})})]}),O]})}function fy(){const[s,a]=w.useState("config"),[t,r]=w.useState(()=>{const i=localStorage.getItem("whatsapp_templates");return i?JSON.parse(i):[{id:1,name:"Pedido Confirmado",message:"Olá! Seu pedido foi confirmado e está sendo preparado. 🍽️"},{id:2,name:"Pedido Pronto",message:"Seu pedido está pronto para retirada! 🎉"},{id:3,name:"Pedido em Rota",message:"Seu pedido saiu para entrega! 🚴"}]}),[n,l]=w.useState(null),[c,m]=w.useState({name:"",message:""});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"WhatsApp"}),e.jsx("p",{className:"text-gray-600",children:"Configurações de notificações e automação"})]}),e.jsxs("div",{className:"flex gap-2 border-b",children:[e.jsx("button",{onClick:()=>a("config"),className:`px-4 py-2 font-medium border-b-2 transition-colors ${s==="config"?"border-red-500 text-red-500":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"CONFIGURAÇÃO E PLANO"}),e.jsx("button",{onClick:()=>a("notifications"),className:`px-4 py-2 font-medium border-b-2 transition-colors ${s==="notifications"?"border-red-500 text-red-500":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"NOTIFICAÇÕES"}),e.jsx("button",{onClick:()=>a("auto"),className:`px-4 py-2 font-medium border-b-2 transition-colors ${s==="auto"?"border-red-500 text-red-500":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"RESPOSTA AUTOMÁTICA"}),e.jsx("button",{onClick:()=>a("summary"),className:`px-4 py-2 font-medium border-b-2 transition-colors ${s==="summary"?"border-red-500 text-red-500":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"RESUMO DIÁRIO E SEMANAL"})]}),s==="config"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(B,{className:"bg-green-50 border-green-200",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-green-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(Gl,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Pedido de Teste"}),e.jsx("p",{className:"text-gray-700 mb-4",children:"Quer receber uma notificação para testar? Faça um pedido de teste e receba as notificações no teu celular."}),e.jsxs(D,{className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(Gl,{className:"w-4 h-4 mr-2"}),"PEDIDO DE TESTE"]})]})]})})}),e.jsxs(B,{children:[e.jsx(oe,{className:"bg-gradient-to-r from-yellow-400 to-orange-500 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Il,{className:"w-8 h-8"}),e.jsxs("div",{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:["Plano BeeBot",e.jsx(fe,{className:"bg-yellow-300 text-yellow-900",children:"WhatsApp Web Integrado"})]}),e.jsx("p",{className:"text-sm opacity-90 mt-1",children:"Envio de Notificações e Resposta Automática"})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Es,{className:"w-5 h-5"}),e.jsx(Es,{className:"w-5 h-5"}),e.jsx(Es,{className:"w-5 h-5"})]})})]})}),e.jsxs(H,{className:"p-6",children:[e.jsxs("ul",{className:"space-y-3",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Es,{className:"w-5 h-5 text-yellow-500 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Envio de Notificações Automáticas."})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Es,{className:"w-5 h-5 text-yellow-500 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"As mensagens são enviadas por um número próprio."})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Es,{className:"w-5 h-5 text-yellow-500 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"É possível também responder os clientes através de um Chat."})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Es,{className:"w-5 h-5 text-yellow-500 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Auto atendimento com todas informações para o cliente."})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Es,{className:"w-5 h-5 text-yellow-500 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Sinaliza quando uma conversa precisa de atenção."})]})]}),e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsxs(D,{className:"w-full bg-red-500 hover:bg-red-600 text-white",children:[e.jsx(Ri,{className:"w-4 h-4 mr-2"}),"ACESSAR BEEBOT"]}),e.jsxs(D,{variant:"outline",className:"w-full",children:[e.jsx(Ll,{className:"w-4 h-4 mr-2"}),"MANUAL DE AJUDA"]})]})]})]})]}),s==="notifications"&&e.jsx("div",{className:"space-y-4",children:e.jsxs(B,{children:[e.jsx(oe,{children:e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(hu,{className:"w-5 h-5"}),"Templates de Mensagens"]})}),e.jsxs(H,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3",children:t.map(i=>e.jsx(B,{className:"border-l-4 border-l-green-500",children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold mb-1",children:i.name}),e.jsx("p",{className:"text-sm text-gray-600 whitespace-pre-wrap",children:i.message})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>{const o=prompt("Digite o número do WhatsApp (apenas números):");o&&(Gm.sendToWhatsApp(o,i.message),W.success("Abrindo WhatsApp..."))},children:e.jsx(Km,{className:"w-4 h-4"})}),e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>{navigator.clipboard.writeText(i.message),W.success("Mensagem copiada!")},children:e.jsx(Ks,{className:"w-4 h-4"})}),e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>l(i),children:e.jsx(yn,{className:"w-4 h-4"})}),e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>{const o=t.filter(d=>d.id!==i.id);r(o),localStorage.setItem("whatsapp_templates",JSON.stringify(o)),W.success("Template removido")},children:e.jsx(Ke,{className:"w-4 h-4 text-red-500"})})]})]})})},i.id))}),!n&&e.jsx(B,{className:"border-dashed",children:e.jsxs(H,{className:"p-4",children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Adicionar Novo Template"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome do Template"}),e.jsx(U,{value:c.name,onChange:i=>m({...c,name:i.target.value}),placeholder:"Ex: Pedido Confirmado"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Mensagem"}),e.jsx(Ms,{value:c.message,onChange:i=>m({...c,message:i.target.value}),placeholder:"Digite a mensagem do template...",rows:4})]}),e.jsxs(D,{onClick:()=>{if(!c.name||!c.message){W.error("Preencha todos os campos");return}const i=[...t,{id:Date.now(),...c}];r(i),localStorage.setItem("whatsapp_templates",JSON.stringify(i)),m({name:"",message:""}),W.success("Template adicionado!")},className:"w-full",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Adicionar Template"]})]})]})}),n&&e.jsx(B,{className:"border-2 border-blue-500",children:e.jsxs(H,{className:"p-4",children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Editar Template"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome do Template"}),e.jsx(U,{value:n.name,onChange:i=>l({...n,name:i.target.value})})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Mensagem"}),e.jsx(Ms,{value:n.message,onChange:i=>l({...n,message:i.target.value}),rows:4})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{onClick:()=>{const i=t.map(o=>o.id===n.id?n:o);r(i),localStorage.setItem("whatsapp_templates",JSON.stringify(i)),l(null),W.success("Template atualizado!")},className:"flex-1",children:"Salvar"}),e.jsx(D,{variant:"outline",onClick:()=>l(null),className:"flex-1",children:"Cancelar"})]})]})]})})]})]})}),s==="auto"&&e.jsx(B,{children:e.jsxs(H,{className:"p-12 text-center",children:[e.jsx(Il,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-600 mb-2",children:"Resposta Automática"}),e.jsx("p",{className:"text-gray-400",children:"Configure respostas automáticas para seus clientes"})]})}),s==="summary"&&e.jsx(B,{children:e.jsxs(H,{className:"p-12 text-center",children:[e.jsx(Ll,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-600 mb-2",children:"Resumo Diário"}),e.jsx("p",{className:"text-gray-400",children:"Receba resumos automáticos de suas vendas"})]})})]})}function W0(s,a=[]){let t=[];function r(l,c){const m=w.createContext(c);m.displayName=l+"Context";const i=t.length;t=[...t,c];const o=p=>{const{scope:x,children:f,...v}=p,y=x?.[s]?.[i]||m,j=w.useMemo(()=>v,Object.values(v));return e.jsx(y.Provider,{value:j,children:f})};o.displayName=l+"Provider";function d(p,x){const f=x?.[s]?.[i]||m,v=w.useContext(f);if(v)return v;if(c!==void 0)return c;throw new Error(`\`${p}\` must be used within \`${l}\``)}return[o,d]}const n=()=>{const l=t.map(c=>w.createContext(c));return function(m){const i=m?.[s]||l;return w.useMemo(()=>({[`__scope${s}`]:{...m,[s]:i}}),[m,i])}};return n.scopeName=s,[r,H0(n,...a)]}function H0(...s){const a=s[0];if(s.length===1)return a;const t=()=>{const r=s.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(l){const c=r.reduce((m,{useScope:i,scopeName:o})=>{const p=i(l)[`__scope${o}`];return{...m,...p}},{});return w.useMemo(()=>({[`__scope${a.scopeName}`]:c}),[c])}};return t.scopeName=a.scopeName,t}var K0=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],yl=K0.reduce((s,a)=>{const t=pm(`Primitive.${a}`),r=w.forwardRef((n,l)=>{const{asChild:c,...m}=n,i=c?t:a;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(i,{...m,ref:l})});return r.displayName=`Primitive.${a}`,{...s,[a]:r}},{}),xi={exports:{}},pi={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var po;function Q0(){if(po)return pi;po=1;var s=gm();function a(p,x){return p===x&&(p!==0||1/p===1/x)||p!==p&&x!==x}var t=typeof Object.is=="function"?Object.is:a,r=s.useState,n=s.useEffect,l=s.useLayoutEffect,c=s.useDebugValue;function m(p,x){var f=x(),v=r({inst:{value:f,getSnapshot:x}}),y=v[0].inst,j=v[1];return l(function(){y.value=f,y.getSnapshot=x,i(y)&&j({inst:y})},[p,f,x]),n(function(){return i(y)&&j({inst:y}),p(function(){i(y)&&j({inst:y})})},[p]),c(f),f}function i(p){var x=p.getSnapshot;p=p.value;try{var f=x();return!t(p,f)}catch{return!0}}function o(p,x){return x()}var d=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?o:m;return pi.useSyncExternalStore=s.useSyncExternalStore!==void 0?s.useSyncExternalStore:d,pi}var go;function Z0(){return go||(go=1,xi.exports=Q0()),xi.exports}var J0=Z0();function X0(){return J0.useSyncExternalStore(ej,()=>!0,()=>!1)}function ej(){return()=>{}}var bl="Avatar",[sj]=W0(bl),[aj,jd]=sj(bl),vd=w.forwardRef((s,a)=>{const{__scopeAvatar:t,...r}=s,[n,l]=w.useState("idle");return e.jsx(aj,{scope:t,imageLoadingStatus:n,onImageLoadingStatusChange:l,children:e.jsx(yl.span,{...r,ref:a})})});vd.displayName=bl;var yd="AvatarImage",bd=w.forwardRef((s,a)=>{const{__scopeAvatar:t,src:r,onLoadingStatusChange:n=()=>{},...l}=s,c=jd(yd,t),m=tj(r,l),i=Zm(o=>{n(o),c.onImageLoadingStatusChange(o)});return Jr(()=>{m!=="idle"&&i(m)},[m,i]),m==="loaded"?e.jsx(yl.img,{...l,ref:a,src:r}):null});bd.displayName=yd;var Nd="AvatarFallback",wd=w.forwardRef((s,a)=>{const{__scopeAvatar:t,delayMs:r,...n}=s,l=jd(Nd,t),[c,m]=w.useState(r===void 0);return w.useEffect(()=>{if(r!==void 0){const i=window.setTimeout(()=>m(!0),r);return()=>window.clearTimeout(i)}},[r]),c&&l.imageLoadingStatus!=="loaded"?e.jsx(yl.span,{...n,ref:a}):null});wd.displayName=Nd;function fo(s,a){return s?a?(s.src!==a&&(s.src=a),s.complete&&s.naturalWidth>0?"loaded":"loading"):"error":"idle"}function tj(s,{referrerPolicy:a,crossOrigin:t}){const r=X0(),n=w.useRef(null),l=r?(n.current||(n.current=new window.Image),n.current):null,[c,m]=w.useState(()=>fo(l,s));return Jr(()=>{m(fo(l,s))},[l,s]),Jr(()=>{const i=p=>()=>{m(p)};if(!l)return;const o=i("loaded"),d=i("error");return l.addEventListener("load",o),l.addEventListener("error",d),a&&(l.referrerPolicy=a),typeof t=="string"&&(l.crossOrigin=t),()=>{l.removeEventListener("load",o),l.removeEventListener("error",d)}},[l,t,a]),c}var _d=vd,Cd=bd,kd=wd;const Sd=w.forwardRef(({className:s,...a},t)=>e.jsx(_d,{ref:t,className:He("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...a}));Sd.displayName=_d.displayName;const Dd=w.forwardRef(({className:s,...a},t)=>e.jsx(Cd,{ref:t,className:He("aspect-square h-full w-full",s),...a}));Dd.displayName=Cd.displayName;const Md=w.forwardRef(({className:s,...a},t)=>e.jsx(kd,{ref:t,className:He("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...a}));Md.displayName=kd.displayName;const rj={entregador:"Entregador",cozinha:"Cozinha",pdv:"PDV",garcom:"Garçom"},nj={entregador:Bo,cozinha:$i,pdv:lt,garcom:La};function ij({colaboradorEmail:s,onClose:a,onEdit:t}){const[r,n]=w.useState(null),[l,c]=w.useState(!0),{data:m=[]}=Ae({queryKey:["colaboradores"],queryFn:()=>_e.get("/colaboradores").then(p=>Array.isArray(p)?p:p.data||[])}),i=m.find(p=>(p.email||"").toLowerCase().trim()===(s||"").toLowerCase().trim());if(w.useEffect(()=>{if(!s)return;(async()=>{c(!0);try{const[x,f]=await Promise.all([_e.entities.Order.list("-created_date").catch(()=>[]),_e.entities.Comanda.list("-created_at").catch(()=>[])]),v=s.toLowerCase().trim(),y=Array.isArray(x)?x.filter(h=>h.entregador_email?.toLowerCase().trim()===v||h.entregador_id):[],j=y.filter(h=>h.status==="delivered"||h.status==="out_for_delivery").length,M=y.filter(h=>h.status==="cancelled"&&h.cancelled_by?.toLowerCase().trim()===v).length,k=y.filter(h=>{const b=new Date().toDateString(),L=h.created_date||h.created_at;return L&&new Date(L).toDateString()===b}).length,z=Array.isArray(f)?f.filter(h=>h.created_by?.toLowerCase().trim()===v||h.closed_by?.toLowerCase().trim()===v):[],$=z.filter(h=>h.created_by?.toLowerCase().trim()===v).length,u=z.filter(h=>(Array.isArray(h.history)?h.history:[]).some(L=>L.by?.toLowerCase().trim()===v&&L.action==="updated")).length,g=z.filter(h=>h.status==="closed"&&h.closed_by?.toLowerCase().trim()===v).length,T=new Set(z.filter(h=>h.table_id||h.table_name).map(h=>h.table_id||h.table_name)).size;n({entregador:{totalEntregas:y.length,entregasAceitas:j,entregasCanceladas:M,entregasHoje:k,taxaSucesso:y.length>0?Math.round(j/y.length*100):0},garcom:{totalComandas:z.length,comandasCriadas:$,comandasEditadas:u,comandasFinalizadas:g,mesasGerenciadas:T}})}catch(x){console.error("Erro ao carregar estatísticas:",x)}finally{c(!1)}})()},[s]),!i)return e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(Ta,{className:"w-8 h-8 animate-spin text-orange-500"})});const o=i.profile_roles||[i.profile_role].filter(Boolean),d=i.photo||i.google_photo;return e.jsxs("div",{className:"space-y-6",children:[e.jsx(B,{children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start gap-6",children:[e.jsxs(Sd,{className:"w-32 h-32 border-4 border-orange-500",children:[e.jsx(Dd,{src:d,alt:i.full_name}),e.jsx(Md,{className:"bg-gradient-to-br from-orange-400 to-orange-600 text-white text-4xl",children:i.full_name?.charAt(0)?.toUpperCase()||"U"})]}),e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:i.full_name||i.email}),e.jsx("div",{className:"flex flex-wrap items-center gap-2 justify-center md:justify-start mb-4",children:o.map(p=>{const x=nj[p]||xu;return e.jsxs(fe,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(x,{className:"w-3 h-3"}),rj[p]||p]},p)})}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-2 justify-center md:justify-start",children:[e.jsx(Vo,{className:"w-4 h-4"}),e.jsx("span",{children:i.email})]}),i.phone&&e.jsxs("div",{className:"flex items-center gap-2 justify-center md:justify-start",children:[e.jsx(Qa,{className:"w-4 h-4"}),e.jsx("span",{children:i.phone})]}),i.address&&e.jsxs("div",{className:"flex items-center gap-2 justify-center md:justify-start",children:[e.jsx(Ea,{className:"w-4 h-4"}),e.jsxs("span",{children:[i.address,i.city?`, ${i.city}`:""]})]}),i.created_at&&e.jsxs("div",{className:"flex items-center gap-2 justify-center md:justify-start",children:[e.jsx(It,{className:"w-4 h-4"}),e.jsxs("span",{children:["Membro desde ",Ot(new Date(i.created_at),"dd 'de' MMMM 'de' yyyy",{locale:vi})]})]})]})]}),t&&e.jsxs(D,{onClick:t,variant:"outline",size:"sm",children:[e.jsx($t,{className:"w-4 h-4 mr-2"}),"Editar"]})]})})}),l?e.jsx(B,{children:e.jsxs(H,{className:"p-8 text-center",children:[e.jsx(Ta,{className:"w-8 h-8 animate-spin text-orange-500 mx-auto"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-2",children:"Carregando estatísticas..."})]})}):r&&e.jsxs(Yi,{defaultValue:o.includes("entregador")?"entregador":o[0]||"geral",children:[e.jsxs(Gi,{className:"grid w-full grid-cols-3",children:[o.includes("entregador")&&e.jsx(ta,{value:"entregador",children:"Entregador"}),o.includes("garcom")&&e.jsx(ta,{value:"garcom",children:"Garçom"}),e.jsx(ta,{value:"geral",children:"Geral"})]}),o.includes("entregador")&&e.jsxs(ra,{value:"entregador",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(B,{children:e.jsxs(H,{className:"p-4 text-center",children:[e.jsx(ys,{className:"w-8 h-8 text-blue-500 mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold",children:r.entregador.totalEntregas}),e.jsx("div",{className:"text-xs text-gray-500",children:"Total de Entregas"})]})}),e.jsx(B,{children:e.jsxs(H,{className:"p-4 text-center",children:[e.jsx(la,{className:"w-8 h-8 text-green-500 mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold",children:r.entregador.entregasAceitas}),e.jsx("div",{className:"text-xs text-gray-500",children:"Aceitas"})]})}),e.jsx(B,{children:e.jsxs(H,{className:"p-4 text-center",children:[e.jsx(Za,{className:"w-8 h-8 text-red-500 mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold",children:r.entregador.entregasCanceladas}),e.jsx("div",{className:"text-xs text-gray-500",children:"Canceladas"})]})}),e.jsx(B,{children:e.jsxs(H,{className:"p-4 text-center",children:[e.jsx(Ls,{className:"w-8 h-8 text-orange-500 mx-auto mb-2"}),e.jsxs("div",{className:"text-2xl font-bold",children:[r.entregador.taxaSucesso,"%"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Taxa de Sucesso"})]})})]}),e.jsxs(B,{children:[e.jsx(oe,{children:e.jsx(ce,{className:"text-lg",children:"Entregas de Hoje"})}),e.jsx(H,{children:e.jsx("div",{className:"text-3xl font-bold text-orange-600",children:r.entregador.entregasHoje})})]})]}),o.includes("garcom")&&e.jsxs(ra,{value:"garcom",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(B,{children:e.jsxs(H,{className:"p-4 text-center",children:[e.jsx(La,{className:"w-8 h-8 text-indigo-500 mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold",children:r.garcom.totalComandas}),e.jsx("div",{className:"text-xs text-gray-500",children:"Total de Comandas"})]})}),e.jsx(B,{children:e.jsxs(H,{className:"p-4 text-center",children:[e.jsx(sa,{className:"w-8 h-8 text-green-500 mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold",children:r.garcom.comandasCriadas}),e.jsx("div",{className:"text-xs text-gray-500",children:"Criadas"})]})}),e.jsx(B,{children:e.jsxs(H,{className:"p-4 text-center",children:[e.jsx($t,{className:"w-8 h-8 text-blue-500 mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold",children:r.garcom.comandasEditadas}),e.jsx("div",{className:"text-xs text-gray-500",children:"Editadas"})]})}),e.jsx(B,{children:e.jsxs(H,{className:"p-4 text-center",children:[e.jsx(la,{className:"w-8 h-8 text-orange-500 mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold",children:r.garcom.comandasFinalizadas}),e.jsx("div",{className:"text-xs text-gray-500",children:"Finalizadas"})]})})]}),e.jsxs(B,{children:[e.jsx(oe,{children:e.jsx(ce,{className:"text-lg",children:"Mesas Gerenciadas"})}),e.jsx(H,{children:e.jsx("div",{className:"text-3xl font-bold text-indigo-600",children:r.garcom.mesasGerenciadas})})]})]}),e.jsx(ra,{value:"geral",className:"space-y-4",children:e.jsxs(B,{children:[e.jsx(oe,{children:e.jsx(ce,{className:"text-lg",children:"Informações do Perfil"})}),e.jsxs(H,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Email:"}),e.jsx("span",{className:"font-medium",children:i.email})]}),i.phone&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Telefone:"}),e.jsx("span",{className:"font-medium",children:i.phone})]}),i.document&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"CPF/CNPJ:"}),e.jsx("span",{className:"font-medium",children:i.document})]}),i.birth_date&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Data de Nascimento:"}),e.jsx("span",{className:"font-medium",children:Ot(new Date(i.birth_date),"dd/MM/yyyy",{locale:vi})})]}),i.address&&e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Endereço:"}),e.jsxs("span",{className:"font-medium text-right max-w-xs",children:[i.address,i.city&&`, ${i.city}`,i.state&&` - ${i.state}`]})]})]})]})})]})]})}const Ir={entregador:"Entregador",cozinha:"Cozinha",pdv:"PDV",garcom:"Garçom",gerente:"Gerente"},gi={entregador:Bo,cozinha:$i,pdv:lt,garcom:La,gerente:gu},Oi=["entregador","cozinha","pdv","garcom","gerente"],lj=Oi.filter(s=>s!=="gerente");function jy({isGerentePanel:s=!1}){const[a,t]=w.useState(!1),[r,n]=w.useState(!1),[l,c]=w.useState(!1),[m,i]=w.useState(!1),[o,d]=w.useState(null),[p,x]=w.useState(null),[f,v]=w.useState(null),[y,j]=w.useState({name:"",email:"",password:"",roles:["pdv"]}),[M,k]=w.useState({roles:[]}),[z,$]=w.useState(!1),u=es(),{menuContext:g,isMaster:T}=Ze(),h=s?null:g?.type==="subscriber"?g?.value:null,b=s?lj:Oi,{data:L=[],isLoading:O}=Ae({queryKey:["colaboradores",h],queryFn:()=>_e.get("/colaboradores",h?{as_subscriber:h}:{}).then(Y=>Array.isArray(Y)?Y:Y.data||[])}),P=se.useMemo(()=>{const Y={};return L.forEach(A=>{const X=(A.email||"").toLowerCase().trim();if(!Y[X])Y[X]={email:A.email,full_name:A.full_name,roles:A.profile_roles||[A.profile_role].filter(Boolean),ids:A.ids||[A.id].filter(Boolean),created_at:A.created_at,updated_at:A.updated_at,active:A.active!==!1,id:A.id};else{const ge=Y[X].roles;(A.profile_roles||[A.profile_role].filter(Boolean)).forEach(Ee=>{ge.includes(Ee)||ge.push(Ee)}),A.active===!1&&(Y[X].active=!1),A.active===!1&&(Y[X].active=!1)}}),Object.values(Y)},[L]),F=le({mutationFn:Y=>{const A=h?`/colaboradores?as_subscriber=${encodeURIComponent(h)}`:"/colaboradores";return _e.post(A,Y)},onSuccess:()=>{u.invalidateQueries({queryKey:["colaboradores"]}),t(!1),j({name:"",email:"",password:"",roles:["pdv"]}),x(null),W.success("Colaborador adicionado.")},onError:Y=>W.error(Y?.message||"Erro ao criar")}),C=le({mutationFn:({email:Y,roles:A})=>{const X=h?`?as_subscriber=${encodeURIComponent(h)}`:"";return _e.post(`/colaboradores/${encodeURIComponent(Y)}/add-roles${X}`,{roles:A})},onSuccess:()=>{u.invalidateQueries({queryKey:["colaboradores"]}),n(!1),v(null),k({roles:[]}),W.success("Perfis adicionados com sucesso.")},onError:Y=>W.error(Y?.message||"Erro ao adicionar perfis")}),N=le({mutationFn:({id:Y,...A})=>{const X={name:A.name};return A.role&&(X.role=A.role),A.newPassword&&(X.newPassword=A.newPassword),_e.patch(`/colaboradores/${Y}`,X)},onSuccess:()=>{u.invalidateQueries({queryKey:["colaboradores"]}),t(!1),j({name:"",email:"",password:"",roles:["pdv"]}),x(null),W.success("Colaborador atualizado.")},onError:Y=>W.error(Y?.message||"Erro ao atualizar")}),V=le({mutationFn:Y=>_e.delete(`/colaboradores/${Y}`),onSuccess:()=>{u.invalidateQueries({queryKey:["colaboradores"]}),W.success("Colaborador removido.")},onError:Y=>W.error(Y?.message||"Erro ao remover")}),E=()=>{x(null),j({name:"",email:"",password:"",roles:["pdv"]}),$(!1),t(!0)},ee=Y=>{x(Y),j({name:Y.full_name||"",email:Y.email||"",password:"",roles:Y.roles||[Y.profile_role].filter(Boolean)}),$(!1),t(!0)},ue=Y=>{v(Y);const A=Y.roles||[];Oi.filter(X=>!A.includes(X)),k({roles:[]}),n(!0)},Z=Y=>{t(Y),Y||(x(null),j({name:"",email:"",password:"",roles:["pdv"]}),$(!1))},S=Y=>{n(Y),Y||(v(null),k({roles:[]}))},G=()=>{if(p){const Y={name:y.name};y.password&&(Y.newPassword=y.password),y.roles&&y.roles.length>0&&(Y.role=y.roles[0]),N.mutate({id:p.ids?.[0]||p.id,...Y})}else{if(!y.email?.trim()){W.error("Email é obrigatório");return}if(!y.password||y.password.length<6){W.error("Senha com no mínimo 6 caracteres");return}if(!y.roles||y.roles.length===0){W.error("Selecione pelo menos um perfil");return}F.mutate({name:y.name,email:y.email.trim(),password:y.password,roles:y.roles})}},q=()=>{if(f){if(!M.roles||M.roles.length===0){W.error("Selecione pelo menos um perfil para adicionar");return}C.mutate({email:f.email,roles:M.roles})}},ne=Y=>{j(A=>({...A,roles:A.roles.includes(Y)?A.roles.filter(X=>X!==Y):[...A.roles,Y]}))},Me=Y=>{k(A=>({...A,roles:A.roles.includes(Y)?A.roles.filter(X=>X!==Y):[...A.roles,Y]}))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Er,{className:"w-5 h-5 text-orange-500"}),"Colaboradores"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:"Perfis com acesso limitado: Entregador, Cozinha, PDV, Garçom e Gerente. Apenas planos Pro e Ultra. Os colaboradores são sempre do estabelecimento (assinante) com seu slug — liberados pelo assinante."}),T&&!h&&e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400 mt-1",children:"Como master: selecione um estabelecimento em Assinantes (Ver dados completos ou editar) para listar e adicionar colaboradores desse estabelecimento."})]}),e.jsxs(D,{onClick:E,className:"bg-orange-500 hover:bg-orange-600",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Adicionar"]})]}),O?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(Ta,{className:"w-8 h-8 animate-spin text-orange-500"})}):L.length===0?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-8 text-center",children:[e.jsx(Er,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:T&&!h?"Selecione um estabelecimento em Assinantes para ver os colaboradores.":"Nenhum colaborador cadastrado."}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:T&&!h?"O acesso de colaboradores é liberado pelo assinante (estabelecimento) com seu slug.":"Adicione perfis para funcionários acessarem Entregador, Cozinha, PDV, Garçom ou Gerente."}),h&&e.jsxs(D,{onClick:E,className:"mt-4 bg-orange-500 hover:bg-orange-600",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Adicionar colaborador"]})]}):e.jsx("div",{className:"grid gap-3",children:P.map(Y=>e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 p-4 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center flex-shrink-0",children:e.jsx(Er,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:Y.full_name||Y.email}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:Y.email}),e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-2",children:Y.roles.map(A=>{const X=gi[A]||Er;return e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium px-2 py-0.5 rounded bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300",children:[e.jsx(X,{className:"w-3 h-3"}),Ir[A]||A]},A)})})]})]}),e.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[e.jsxs(D,{variant:"outline",size:"sm",onClick:async()=>{try{const A=await _e.get("/colaboradores"),X=Array.isArray(A)?A.find(ge=>(ge.email||"").toLowerCase().trim()===(Y.email||"").toLowerCase().trim()):A.data?.find(ge=>(ge.email||"").toLowerCase().trim()===(Y.email||"").toLowerCase().trim());d(X||Y),c(!0)}catch{d(Y),c(!0)}},children:[e.jsx(qa,{className:"w-4 h-4 mr-1"}),"Ver Perfil"]}),e.jsxs(D,{variant:"outline",size:"sm",onClick:()=>ue(Y),disabled:Y.roles.length>=b.length,children:[e.jsx(fu,{className:"w-4 h-4 mr-1"}),"Adicionar Perfis"]}),!(s&&Y.roles.includes("gerente"))&&e.jsxs(e.Fragment,{children:[e.jsxs(D,{variant:"outline",size:"sm",onClick:()=>ee(Y),children:[e.jsx(Rs,{className:"w-4 h-4 mr-1"}),"Editar"]}),e.jsx(D,{variant:"outline",size:"sm",onClick:()=>{const A=Y.ids?.[0]||Y.id;A&&toggleActiveMu.mutate({id:A,active:!Y.active})},className:Y.active?"text-orange-600 hover:text-orange-700":"text-green-600 hover:text-green-700",children:Y.active?e.jsxs(e.Fragment,{children:[e.jsx(Uo,{className:"w-4 h-4 mr-1"}),"Desativar"]}):e.jsxs(e.Fragment,{children:[e.jsx(la,{className:"w-4 h-4 mr-1"}),"Ativar"]})}),e.jsxs(D,{variant:"outline",size:"sm",onClick:()=>{const A=Y.ids?.[0]||Y.id;A&&confirm(`Tem certeza que deseja excluir o acesso de ${Y.full_name||Y.email}? Esta ação não pode ser desfeita.`)&&V.mutate(A)},className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx(Ke,{className:"w-4 h-4 mr-1"}),"Excluir"]})]})]})]},Y.email))}),e.jsx(ze,{open:a,onOpenChange:Z,children:e.jsxs(Te,{className:"sm:max-w-lg max-w-[90vw] max-h-[90vh] overflow-y-auto",children:[e.jsx(Fe,{children:e.jsx(Re,{children:p?"Editar colaborador":"Adicionar colaborador"})}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome"}),e.jsx(U,{value:y.name,onChange:Y=>j(A=>({...A,name:Y.target.value})),placeholder:"Nome do colaborador"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Email"}),e.jsx(U,{type:"email",value:y.email,onChange:Y=>j(A=>({...A,email:Y.target.value})),placeholder:"email@exemplo.com",disabled:!!p})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Perfis (selecione um ou mais)"}),e.jsx("div",{className:"space-y-2 mt-2",children:b.map(Y=>{const A=gi[Y];return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ot,{id:`role-${Y}`,checked:y.roles.includes(Y),onCheckedChange:()=>ne(Y)}),e.jsxs(R,{htmlFor:`role-${Y}`,className:"flex items-center gap-2 cursor-pointer flex-1",children:[e.jsx(A,{className:"w-4 h-4"}),Ir[Y]]})]},Y)})}),y.roles.length===0&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:"Selecione pelo menos um perfil"})]}),e.jsxs("div",{children:[e.jsx(R,{children:p?"Nova senha (deixe em branco para não alterar)":"Senha (mín. 6)"}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{type:z?"text":"password",value:y.password,onChange:Y=>j(A=>({...A,password:Y.target.value})),placeholder:p?"••••••••":"Senha de acesso"}),e.jsx("button",{type:"button",className:"absolute right-2.5 top-1/2 -translate-y-1/2 text-gray-500",onClick:()=>$(Y=>!Y),children:z?e.jsx(eu,{className:"w-4 h-4"}):e.jsx(qa,{className:"w-4 h-4"})})]})]})]}),e.jsxs(Ws,{children:[e.jsx(D,{variant:"outline",onClick:()=>t(!1),children:"Cancelar"}),e.jsxs(D,{onClick:G,disabled:F.isPending||N.isPending,className:"bg-orange-500 hover:bg-orange-600",children:[(F.isPending||N.isPending)&&e.jsx(Ta,{className:"w-4 h-4 mr-2 animate-spin"}),p?"Salvar":"Adicionar"]})]})]})}),e.jsx(ze,{open:r,onOpenChange:S,children:e.jsxs(Te,{className:"sm:max-w-lg max-w-[90vw] max-h-[90vh] overflow-y-auto",children:[e.jsx(Fe,{children:e.jsxs(Re,{children:["Adicionar perfis a ",f?.full_name||f?.email]})}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Perfis atuais: ",f?.roles?.map(Y=>Ir[Y]||Y).join(", ")||"Nenhum"]}),e.jsxs("div",{children:[e.jsx(R,{children:"Selecione os perfis para adicionar"}),e.jsx("div",{className:"space-y-2 mt-2",children:b.filter(Y=>!f?.roles?.includes(Y)).map(Y=>{const A=gi[Y];return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ot,{id:`add-role-${Y}`,checked:M.roles.includes(Y),onCheckedChange:()=>Me(Y)}),e.jsxs(R,{htmlFor:`add-role-${Y}`,className:"flex items-center gap-2 cursor-pointer flex-1",children:[e.jsx(A,{className:"w-4 h-4"}),Ir[Y]]})]},Y)})}),b.filter(Y=>!f?.roles?.includes(Y)).length===0&&e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Este colaborador já possui todos os perfis disponíveis."})]})]}),e.jsxs(Ws,{children:[e.jsx(D,{variant:"outline",onClick:()=>n(!1),children:"Cancelar"}),e.jsxs(D,{onClick:q,disabled:C.isPending||M.roles.length===0,className:"bg-orange-500 hover:bg-orange-600",children:[C.isPending&&e.jsx(Ta,{className:"w-4 h-4 mr-2 animate-spin"}),"Adicionar Perfis"]})]})]})}),l&&o&&e.jsx(ze,{open:l,onOpenChange:c,children:e.jsxs(Te,{className:"sm:max-w-4xl max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsx(Fe,{children:e.jsx(Re,{children:"Perfil do Colaborador"})}),e.jsx(ij,{colaboradorEmail:o.email,onClose:()=>{c(!1),d(null)},onEdit:async()=>{try{const Y=await _e.get("/colaboradores"),A=Array.isArray(Y)?Y.find(X=>(X.email||"").toLowerCase().trim()===(o.email||"").toLowerCase().trim()):Y.data?.find(X=>(X.email||"").toLowerCase().trim()===(o.email||"").toLowerCase().trim());if(A?.id||A?.ids?.[0]){const X=A.id||A.ids[0],ge=await _e.get("/colaboradores").then(xe=>(Array.isArray(xe)?xe:xe.data||[]).find(K=>String(K.id)===String(X)));d(ge||A)}else d(A||o);c(!1),i(!0)}catch{c(!1),i(!0)}}})]})}),m&&o&&e.jsx(pu,{user:o,profileRole:o.profile_role||o.roles?.[0],onClose:()=>{i(!1),d(null),u.invalidateQueries({queryKey:["colaboradores"]})},onUpdate:Y=>{d(Y),u.invalidateQueries({queryKey:["colaboradores"]})}})]})}function vy({user:s}){const a=es(),[t,r]=w.useState(""),[n,l]=w.useState(null),[c,m]=w.useState([]),{data:i}=Ae({queryKey:["user2FA",s?.email],queryFn:async()=>{try{return await ae.entities.User2FA.filter({user_email:s?.email})}catch{return[]}},enabled:!!s?.email}),o=i?.[0]?.enabled||!1,d=()=>Array.from(crypto.getRandomValues(new Uint8Array(16))).map(y=>y.toString(16).padStart(2,"0")).join("").toUpperCase(),p=(y,j)=>/^\d{6}$/.test(y),x=le({mutationFn:async()=>{const y=d(),j=fm,M=s?.email||"user",k=`otpauth://totp/${j}:${M}?secret=${y}&issuer=${j}`,z=`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(k)}`;l(z),localStorage.setItem("temp_2fa_secret",y);const $=Array.from({length:10},()=>Math.random().toString(36).substring(2,8).toUpperCase());return m($),{secret:y,qrCodeDataUrl:z,backupCodes:$}},onError:y=>{os.error("Erro ao gerar QR Code: "+y.message)}}),f=le({mutationFn:async({code:y})=>{const j=localStorage.getItem("temp_2fa_secret");if(!j)throw new Error("Secret não encontrado");if(!p(y))throw new Error("Código inválido");return await ae.entities.User2FA.create({user_email:s.email,secret:j,enabled:!0,backup_codes:c,created_at:new Date().toISOString()}),localStorage.removeItem("temp_2fa_secret"),!0},onSuccess:()=>{a.invalidateQueries(["user2FA"]),os.success("2FA ativado com sucesso!"),l(null),r("")},onError:y=>{os.error("Erro ao ativar 2FA: "+y.message)}}),v=le({mutationFn:async()=>(i?.[0]?.id&&await ae.entities.User2FA.update(i[0].id,{enabled:!1}),!0),onSuccess:()=>{a.invalidateQueries(["user2FA"]),os.success("2FA desativado")},onError:y=>{os.error("Erro ao desativar 2FA: "+y.message)}});return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(en,{className:"w-6 h-6"}),"Autenticação de Dois Fatores (2FA)"]}),e.jsx("p",{className:"text-gray-500",children:"Proteja sua conta com 2FA"})]})}),e.jsxs(B,{children:[e.jsx(oe,{children:e.jsxs(ce,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Status da Segurança"}),e.jsx(fe,{variant:o?"default":"secondary",children:o?e.jsxs(e.Fragment,{children:[e.jsx(la,{className:"w-4 h-4 mr-1"}),"Ativo"]}):e.jsxs(e.Fragment,{children:[e.jsx(ft,{className:"w-4 h-4 mr-1"}),"Inativo"]})})]})}),e.jsx(H,{className:"space-y-4",children:o?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-900 mb-2",children:[e.jsx(la,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"2FA está ativo"})]}),e.jsx("p",{className:"text-sm text-green-800",children:"Sua conta está protegida com autenticação de dois fatores."})]}),e.jsx(D,{variant:"destructive",onClick:()=>{window.confirm("Tem certeza que deseja desativar o 2FA? Isso reduzirá a segurança da sua conta.")&&v.mutate()},disabled:v.isLoading,className:"w-full",children:"Desativar 2FA"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"O que é 2FA?"}),e.jsx("p",{className:"text-sm text-blue-800",children:"A autenticação de dois fatores adiciona uma camada extra de segurança. Além da senha, você precisará de um código do aplicativo autenticador."})]}),e.jsxs(D,{onClick:()=>x.mutate(),disabled:x.isLoading,className:"w-full",children:[e.jsx(ju,{className:"w-4 h-4 mr-2"}),"Ativar 2FA"]}),n&&e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(R,{children:"1. Escaneie o QR Code com seu app autenticador"}),e.jsx("div",{className:"mt-2 flex justify-center",children:e.jsx("img",{src:n,alt:"QR Code 2FA",className:"border rounded"})})]}),e.jsxs("div",{children:[e.jsx(R,{children:"2. Digite o código de 6 dígitos do app"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(U,{type:"text",value:t,onChange:y=>r(y.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",maxLength:6,className:"text-center text-2xl tracking-widest"}),e.jsx(D,{onClick:()=>f.mutate({code:t}),disabled:t.length!==6||f.isLoading,children:"Verificar"})]})]}),c.length>0&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx(R,{className:"text-yellow-900 font-semibold",children:"⚠️ Códigos de Backup (guarde em local seguro)"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2",children:c.map((y,j)=>e.jsx("code",{className:"text-sm bg-white p-2 rounded border",children:y},j))}),e.jsx("p",{className:"text-xs text-yellow-800 mt-2",children:"Use estes códigos se perder acesso ao app autenticador"})]})]})]})})]}),e.jsxs(B,{children:[e.jsx(oe,{children:e.jsx(ce,{children:"Apps Autenticadores Recomendados"})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Google Authenticator"})," (iOS/Android)"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Microsoft Authenticator"})," (iOS/Android)"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Authy"})," (iOS/Android/Desktop)"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"1Password"})," (iOS/Android/Desktop)"]})]})})]})]})}const Ad=w.forwardRef(({className:s,...a},t)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:t,className:He("w-full caption-bottom text-sm",s),...a})}));Ad.displayName="Table";const Pd=w.forwardRef(({className:s,...a},t)=>e.jsx("thead",{ref:t,className:He("[&_tr]:border-b",s),...a}));Pd.displayName="TableHeader";const Ed=w.forwardRef(({className:s,...a},t)=>e.jsx("tbody",{ref:t,className:He("[&_tr:last-child]:border-0",s),...a}));Ed.displayName="TableBody";const oj=w.forwardRef(({className:s,...a},t)=>e.jsx("tfoot",{ref:t,className:He("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...a}));oj.displayName="TableFooter";const zi=w.forwardRef(({className:s,...a},t)=>e.jsx("tr",{ref:t,className:He("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...a}));zi.displayName="TableRow";const Wa=w.forwardRef(({className:s,...a},t)=>e.jsx("th",{ref:t,className:He("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...a}));Wa.displayName="TableHead";const Ha=w.forwardRef(({className:s,...a},t)=>e.jsx("td",{ref:t,className:He("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...a}));Ha.displayName="TableCell";const cj=w.forwardRef(({className:s,...a},t)=>e.jsx("caption",{ref:t,className:He("mt-4 text-sm text-muted-foreground",s),...a}));cj.displayName="TableCaption";function yy(){const s=es(),{menuContext:a}=Ze(),[t,r]=w.useState(null),{data:n=[]}=Ae({queryKey:["customers",a?.type,a?.value],queryFn:async()=>{if(!a)return[];const o={};return a.type==="subscriber"&&a.value&&(o.as_subscriber=a.value),ae.entities.Customer.list(null,o)},enabled:!!a}),{data:l=[]}=Wt(),c=le({mutationFn:async o=>{const d=n.find(j=>j.id===o);if(!d)throw new Error("Cliente não encontrado");const p=l.filter(j=>j.customer_email===d.email||j.customer_phone===d.phone),x={customer:{id:d.id,name:d.name,email:d.email,phone:d.phone,address:d.address,created_at:d.created_at},orders:p.map(j=>({id:j.id,order_code:j.order_code,total:j.total,status:j.status,created_date:j.created_date,items:j.items||[]})),exported_at:new Date().toISOString()},f=new Blob([JSON.stringify(x,null,2)],{type:"application/json"}),v=URL.createObjectURL(f),y=document.createElement("a");return y.href=v,y.download=`dados-cliente-${d.email||d.id}-${Date.now()}.json`,document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(v),x},onSuccess:()=>{os.success("Dados exportados com sucesso!")},onError:o=>{os.error("Erro ao exportar dados: "+o.message)}}),m=le({mutationFn:async o=>{const d=n.find(x=>x.id===o);if(!d)throw new Error("Cliente não encontrado");await ae.entities.Customer.update(o,{name:"[Dados Removidos]",email:`removed_${Date.now()}@deleted.local`,phone:null,address:null,lgpd_deleted:!0,lgpd_deleted_at:new Date().toISOString()});const p=l.filter(x=>x.customer_email===d.email||x.customer_phone===d.phone);for(const x of p)await ae.entities.Order.update(x.id,{customer_name:"[Dados Removidos]",customer_email:`removed_${Date.now()}@deleted.local`,customer_phone:null,customer_address:null});return!0},onSuccess:()=>{s.invalidateQueries(["customers"]),s.invalidateQueries(["orders"]),os.success("Dados removidos conforme LGPD")},onError:o=>{os.error("Erro ao remover dados: "+o.message)}}),i=o=>{window.confirm("Tem certeza? Esta ação irá anonimizar todos os dados do cliente conforme LGPD. Esta ação não pode ser desfeita.")&&m.mutate(o)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(en,{className:"w-6 h-6"}),"Conformidade LGPD"]}),e.jsx("p",{className:"text-gray-500",children:"Gerencie direitos de dados dos clientes"})]})}),e.jsx(B,{className:"bg-blue-50 border-blue-200",children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(en,{className:"w-8 h-8 text-blue-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"Direitos do Cliente (LGPD)"}),e.jsxs("ul",{className:"space-y-1 text-sm text-blue-800",children:[e.jsxs("li",{children:["✅ ",e.jsx("strong",{children:"Acesso:"})," Cliente pode solicitar seus dados"]}),e.jsxs("li",{children:["✅ ",e.jsx("strong",{children:"Portabilidade:"})," Exportar dados em formato JSON"]}),e.jsxs("li",{children:["✅ ",e.jsx("strong",{children:"Esquecimento:"})," Solicitar remoção/anonymização de dados"]}),e.jsxs("li",{children:["✅ ",e.jsx("strong",{children:"Correção:"})," Atualizar dados incorretos"]})]})]})]})})}),e.jsxs(B,{children:[e.jsx(oe,{children:e.jsx(ce,{children:"Clientes e Dados"})}),e.jsx(H,{children:e.jsxs(Ad,{children:[e.jsx(Pd,{children:e.jsxs(zi,{children:[e.jsx(Wa,{children:"Nome"}),e.jsx(Wa,{children:"Email"}),e.jsx(Wa,{children:"Telefone"}),e.jsx(Wa,{children:"Pedidos"}),e.jsx(Wa,{children:"Status LGPD"}),e.jsx(Wa,{children:"Ações"})]})}),e.jsx(Ed,{children:n.map(o=>{const d=l.filter(x=>x.customer_email===o.email||x.customer_phone===o.phone),p=o.lgpd_deleted;return e.jsxs(zi,{children:[e.jsx(Ha,{children:p?e.jsx("span",{className:"text-gray-400 italic",children:"[Dados Removidos]"}):o.name}),e.jsx(Ha,{children:p?e.jsx("span",{className:"text-gray-400 italic",children:"[Removido]"}):o.email}),e.jsx(Ha,{children:o.phone||"—"}),e.jsx(Ha,{children:d.length}),e.jsx(Ha,{children:p?e.jsxs(fe,{variant:"destructive",children:[e.jsx(Ke,{className:"w-3 h-3 mr-1"}),"Removido"]}):e.jsxs(fe,{variant:"default",children:[e.jsx(la,{className:"w-3 h-3 mr-1"}),"Ativo"]})}),e.jsx(Ha,{children:e.jsx("div",{className:"flex gap-2",children:!p&&e.jsxs(e.Fragment,{children:[e.jsxs(D,{size:"sm",variant:"outline",onClick:()=>c.mutate(o.id),disabled:c.isLoading,children:[e.jsx(pn,{className:"w-4 h-4 mr-1"}),"Exportar"]}),e.jsxs(D,{size:"sm",variant:"destructive",onClick:()=>i(o.id),disabled:m.isLoading,children:[e.jsx(Ke,{className:"w-4 h-4 mr-1"}),"Remover"]})]})})})]},o.id)})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(B,{children:[e.jsx(oe,{className:"pb-2",children:e.jsx(ce,{className:"text-sm font-medium",children:"Total de Clientes"})}),e.jsx(H,{children:e.jsx("div",{className:"text-2xl font-bold",children:n.length})})]}),e.jsxs(B,{children:[e.jsx(oe,{className:"pb-2",children:e.jsx(ce,{className:"text-sm font-medium",children:"Dados Removidos"})}),e.jsx(H,{children:e.jsx("div",{className:"text-2xl font-bold text-red-600",children:n.filter(o=>o.lgpd_deleted).length})})]}),e.jsxs(B,{children:[e.jsx(oe,{className:"pb-2",children:e.jsx(ce,{className:"text-sm font-medium",children:"Exportações"})}),e.jsx(H,{children:e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:n.filter(o=>o.lgpd_exported).length})})]})]})]})}var dj=Object.defineProperty,hn=Object.getOwnPropertySymbols,Od=Object.prototype.hasOwnProperty,zd=Object.prototype.propertyIsEnumerable,jo=(s,a,t)=>a in s?dj(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t,Ti=(s,a)=>{for(var t in a||(a={}))Od.call(a,t)&&jo(s,t,a[t]);if(hn)for(var t of hn(a))zd.call(a,t)&&jo(s,t,a[t]);return s},Fi=(s,a)=>{var t={};for(var r in s)Od.call(s,r)&&a.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&hn)for(var r of hn(s))a.indexOf(r)<0&&zd.call(s,r)&&(t[r]=s[r]);return t};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var gt;(s=>{const a=class Oe{constructor(i,o,d,p){if(this.version=i,this.errorCorrectionLevel=o,this.modules=[],this.isFunction=[],i<Oe.MIN_VERSION||i>Oe.MAX_VERSION)throw new RangeError("Version value out of range");if(p<-1||p>7)throw new RangeError("Mask value out of range");this.size=i*4+17;let x=[];for(let v=0;v<this.size;v++)x.push(!1);for(let v=0;v<this.size;v++)this.modules.push(x.slice()),this.isFunction.push(x.slice());this.drawFunctionPatterns();const f=this.addEccAndInterleave(d);if(this.drawCodewords(f),p==-1){let v=1e9;for(let y=0;y<8;y++){this.applyMask(y),this.drawFormatBits(y);const j=this.getPenaltyScore();j<v&&(p=y,v=j),this.applyMask(y)}}n(0<=p&&p<=7),this.mask=p,this.applyMask(p),this.drawFormatBits(p),this.isFunction=[]}static encodeText(i,o){const d=s.QrSegment.makeSegments(i);return Oe.encodeSegments(d,o)}static encodeBinary(i,o){const d=s.QrSegment.makeBytes(i);return Oe.encodeSegments([d],o)}static encodeSegments(i,o,d=1,p=40,x=-1,f=!0){if(!(Oe.MIN_VERSION<=d&&d<=p&&p<=Oe.MAX_VERSION)||x<-1||x>7)throw new RangeError("Invalid value");let v,y;for(v=d;;v++){const z=Oe.getNumDataCodewords(v,o)*8,$=c.getTotalBits(i,v);if($<=z){y=$;break}if(v>=p)throw new RangeError("Data too long")}for(const z of[Oe.Ecc.MEDIUM,Oe.Ecc.QUARTILE,Oe.Ecc.HIGH])f&&y<=Oe.getNumDataCodewords(v,z)*8&&(o=z);let j=[];for(const z of i){t(z.mode.modeBits,4,j),t(z.numChars,z.mode.numCharCountBits(v),j);for(const $ of z.getData())j.push($)}n(j.length==y);const M=Oe.getNumDataCodewords(v,o)*8;n(j.length<=M),t(0,Math.min(4,M-j.length),j),t(0,(8-j.length%8)%8,j),n(j.length%8==0);for(let z=236;j.length<M;z^=253)t(z,8,j);let k=[];for(;k.length*8<j.length;)k.push(0);return j.forEach((z,$)=>k[$>>>3]|=z<<7-($&7)),new Oe(v,o,k,x)}getModule(i,o){return 0<=i&&i<this.size&&0<=o&&o<this.size&&this.modules[o][i]}getModules(){return this.modules}drawFunctionPatterns(){for(let d=0;d<this.size;d++)this.setFunctionModule(6,d,d%2==0),this.setFunctionModule(d,6,d%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const i=this.getAlignmentPatternPositions(),o=i.length;for(let d=0;d<o;d++)for(let p=0;p<o;p++)d==0&&p==0||d==0&&p==o-1||d==o-1&&p==0||this.drawAlignmentPattern(i[d],i[p]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(i){const o=this.errorCorrectionLevel.formatBits<<3|i;let d=o;for(let x=0;x<10;x++)d=d<<1^(d>>>9)*1335;const p=(o<<10|d)^21522;n(p>>>15==0);for(let x=0;x<=5;x++)this.setFunctionModule(8,x,r(p,x));this.setFunctionModule(8,7,r(p,6)),this.setFunctionModule(8,8,r(p,7)),this.setFunctionModule(7,8,r(p,8));for(let x=9;x<15;x++)this.setFunctionModule(14-x,8,r(p,x));for(let x=0;x<8;x++)this.setFunctionModule(this.size-1-x,8,r(p,x));for(let x=8;x<15;x++)this.setFunctionModule(8,this.size-15+x,r(p,x));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let i=this.version;for(let d=0;d<12;d++)i=i<<1^(i>>>11)*7973;const o=this.version<<12|i;n(o>>>18==0);for(let d=0;d<18;d++){const p=r(o,d),x=this.size-11+d%3,f=Math.floor(d/3);this.setFunctionModule(x,f,p),this.setFunctionModule(f,x,p)}}drawFinderPattern(i,o){for(let d=-4;d<=4;d++)for(let p=-4;p<=4;p++){const x=Math.max(Math.abs(p),Math.abs(d)),f=i+p,v=o+d;0<=f&&f<this.size&&0<=v&&v<this.size&&this.setFunctionModule(f,v,x!=2&&x!=4)}}drawAlignmentPattern(i,o){for(let d=-2;d<=2;d++)for(let p=-2;p<=2;p++)this.setFunctionModule(i+p,o+d,Math.max(Math.abs(p),Math.abs(d))!=1)}setFunctionModule(i,o,d){this.modules[o][i]=d,this.isFunction[o][i]=!0}addEccAndInterleave(i){const o=this.version,d=this.errorCorrectionLevel;if(i.length!=Oe.getNumDataCodewords(o,d))throw new RangeError("Invalid argument");const p=Oe.NUM_ERROR_CORRECTION_BLOCKS[d.ordinal][o],x=Oe.ECC_CODEWORDS_PER_BLOCK[d.ordinal][o],f=Math.floor(Oe.getNumRawDataModules(o)/8),v=p-f%p,y=Math.floor(f/p);let j=[];const M=Oe.reedSolomonComputeDivisor(x);for(let z=0,$=0;z<p;z++){let u=i.slice($,$+y-x+(z<v?0:1));$+=u.length;const g=Oe.reedSolomonComputeRemainder(u,M);z<v&&u.push(0),j.push(u.concat(g))}let k=[];for(let z=0;z<j[0].length;z++)j.forEach(($,u)=>{(z!=y-x||u>=v)&&k.push($[z])});return n(k.length==f),k}drawCodewords(i){if(i.length!=Math.floor(Oe.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let o=0;for(let d=this.size-1;d>=1;d-=2){d==6&&(d=5);for(let p=0;p<this.size;p++)for(let x=0;x<2;x++){const f=d-x,y=(d+1&2)==0?this.size-1-p:p;!this.isFunction[y][f]&&o<i.length*8&&(this.modules[y][f]=r(i[o>>>3],7-(o&7)),o++)}}n(o==i.length*8)}applyMask(i){if(i<0||i>7)throw new RangeError("Mask value out of range");for(let o=0;o<this.size;o++)for(let d=0;d<this.size;d++){let p;switch(i){case 0:p=(d+o)%2==0;break;case 1:p=o%2==0;break;case 2:p=d%3==0;break;case 3:p=(d+o)%3==0;break;case 4:p=(Math.floor(d/3)+Math.floor(o/2))%2==0;break;case 5:p=d*o%2+d*o%3==0;break;case 6:p=(d*o%2+d*o%3)%2==0;break;case 7:p=((d+o)%2+d*o%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[o][d]&&p&&(this.modules[o][d]=!this.modules[o][d])}}getPenaltyScore(){let i=0;for(let x=0;x<this.size;x++){let f=!1,v=0,y=[0,0,0,0,0,0,0];for(let j=0;j<this.size;j++)this.modules[x][j]==f?(v++,v==5?i+=Oe.PENALTY_N1:v>5&&i++):(this.finderPenaltyAddHistory(v,y),f||(i+=this.finderPenaltyCountPatterns(y)*Oe.PENALTY_N3),f=this.modules[x][j],v=1);i+=this.finderPenaltyTerminateAndCount(f,v,y)*Oe.PENALTY_N3}for(let x=0;x<this.size;x++){let f=!1,v=0,y=[0,0,0,0,0,0,0];for(let j=0;j<this.size;j++)this.modules[j][x]==f?(v++,v==5?i+=Oe.PENALTY_N1:v>5&&i++):(this.finderPenaltyAddHistory(v,y),f||(i+=this.finderPenaltyCountPatterns(y)*Oe.PENALTY_N3),f=this.modules[j][x],v=1);i+=this.finderPenaltyTerminateAndCount(f,v,y)*Oe.PENALTY_N3}for(let x=0;x<this.size-1;x++)for(let f=0;f<this.size-1;f++){const v=this.modules[x][f];v==this.modules[x][f+1]&&v==this.modules[x+1][f]&&v==this.modules[x+1][f+1]&&(i+=Oe.PENALTY_N2)}let o=0;for(const x of this.modules)o=x.reduce((f,v)=>f+(v?1:0),o);const d=this.size*this.size,p=Math.ceil(Math.abs(o*20-d*10)/d)-1;return n(0<=p&&p<=9),i+=p*Oe.PENALTY_N4,n(0<=i&&i<=2568888),i}getAlignmentPatternPositions(){if(this.version==1)return[];{const i=Math.floor(this.version/7)+2,o=this.version==32?26:Math.ceil((this.version*4+4)/(i*2-2))*2;let d=[6];for(let p=this.size-7;d.length<i;p-=o)d.splice(1,0,p);return d}}static getNumRawDataModules(i){if(i<Oe.MIN_VERSION||i>Oe.MAX_VERSION)throw new RangeError("Version number out of range");let o=(16*i+128)*i+64;if(i>=2){const d=Math.floor(i/7)+2;o-=(25*d-10)*d-55,i>=7&&(o-=36)}return n(208<=o&&o<=29648),o}static getNumDataCodewords(i,o){return Math.floor(Oe.getNumRawDataModules(i)/8)-Oe.ECC_CODEWORDS_PER_BLOCK[o.ordinal][i]*Oe.NUM_ERROR_CORRECTION_BLOCKS[o.ordinal][i]}static reedSolomonComputeDivisor(i){if(i<1||i>255)throw new RangeError("Degree out of range");let o=[];for(let p=0;p<i-1;p++)o.push(0);o.push(1);let d=1;for(let p=0;p<i;p++){for(let x=0;x<o.length;x++)o[x]=Oe.reedSolomonMultiply(o[x],d),x+1<o.length&&(o[x]^=o[x+1]);d=Oe.reedSolomonMultiply(d,2)}return o}static reedSolomonComputeRemainder(i,o){let d=o.map(p=>0);for(const p of i){const x=p^d.shift();d.push(0),o.forEach((f,v)=>d[v]^=Oe.reedSolomonMultiply(f,x))}return d}static reedSolomonMultiply(i,o){if(i>>>8||o>>>8)throw new RangeError("Byte out of range");let d=0;for(let p=7;p>=0;p--)d=d<<1^(d>>>7)*285,d^=(o>>>p&1)*i;return n(d>>>8==0),d}finderPenaltyCountPatterns(i){const o=i[1];n(o<=this.size*3);const d=o>0&&i[2]==o&&i[3]==o*3&&i[4]==o&&i[5]==o;return(d&&i[0]>=o*4&&i[6]>=o?1:0)+(d&&i[6]>=o*4&&i[0]>=o?1:0)}finderPenaltyTerminateAndCount(i,o,d){return i&&(this.finderPenaltyAddHistory(o,d),o=0),o+=this.size,this.finderPenaltyAddHistory(o,d),this.finderPenaltyCountPatterns(d)}finderPenaltyAddHistory(i,o){o[0]==0&&(i+=this.size),o.pop(),o.unshift(i)}};a.MIN_VERSION=1,a.MAX_VERSION=40,a.PENALTY_N1=3,a.PENALTY_N2=3,a.PENALTY_N3=40,a.PENALTY_N4=10,a.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],a.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],s.QrCode=a;function t(m,i,o){if(i<0||i>31||m>>>i)throw new RangeError("Value out of range");for(let d=i-1;d>=0;d--)o.push(m>>>d&1)}function r(m,i){return(m>>>i&1)!=0}function n(m){if(!m)throw new Error("Assertion error")}const l=class is{constructor(i,o,d){if(this.mode=i,this.numChars=o,this.bitData=d,o<0)throw new RangeError("Invalid argument");this.bitData=d.slice()}static makeBytes(i){let o=[];for(const d of i)t(d,8,o);return new is(is.Mode.BYTE,i.length,o)}static makeNumeric(i){if(!is.isNumeric(i))throw new RangeError("String contains non-numeric characters");let o=[];for(let d=0;d<i.length;){const p=Math.min(i.length-d,3);t(parseInt(i.substring(d,d+p),10),p*3+1,o),d+=p}return new is(is.Mode.NUMERIC,i.length,o)}static makeAlphanumeric(i){if(!is.isAlphanumeric(i))throw new RangeError("String contains unencodable characters in alphanumeric mode");let o=[],d;for(d=0;d+2<=i.length;d+=2){let p=is.ALPHANUMERIC_CHARSET.indexOf(i.charAt(d))*45;p+=is.ALPHANUMERIC_CHARSET.indexOf(i.charAt(d+1)),t(p,11,o)}return d<i.length&&t(is.ALPHANUMERIC_CHARSET.indexOf(i.charAt(d)),6,o),new is(is.Mode.ALPHANUMERIC,i.length,o)}static makeSegments(i){return i==""?[]:is.isNumeric(i)?[is.makeNumeric(i)]:is.isAlphanumeric(i)?[is.makeAlphanumeric(i)]:[is.makeBytes(is.toUtf8ByteArray(i))]}static makeEci(i){let o=[];if(i<0)throw new RangeError("ECI assignment value out of range");if(i<128)t(i,8,o);else if(i<16384)t(2,2,o),t(i,14,o);else if(i<1e6)t(6,3,o),t(i,21,o);else throw new RangeError("ECI assignment value out of range");return new is(is.Mode.ECI,0,o)}static isNumeric(i){return is.NUMERIC_REGEX.test(i)}static isAlphanumeric(i){return is.ALPHANUMERIC_REGEX.test(i)}getData(){return this.bitData.slice()}static getTotalBits(i,o){let d=0;for(const p of i){const x=p.mode.numCharCountBits(o);if(p.numChars>=1<<x)return 1/0;d+=4+x+p.bitData.length}return d}static toUtf8ByteArray(i){i=encodeURI(i);let o=[];for(let d=0;d<i.length;d++)i.charAt(d)!="%"?o.push(i.charCodeAt(d)):(o.push(parseInt(i.substring(d+1,d+3),16)),d+=2);return o}};l.NUMERIC_REGEX=/^[0-9]*$/,l.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,l.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let c=l;s.QrSegment=l})(gt||(gt={}));(s=>{(a=>{const t=class{constructor(n,l){this.ordinal=n,this.formatBits=l}};t.LOW=new t(0,1),t.MEDIUM=new t(1,0),t.QUARTILE=new t(2,3),t.HIGH=new t(3,2),a.Ecc=t})(s.QrCode||(s.QrCode={}))})(gt||(gt={}));(s=>{(a=>{const t=class{constructor(n,l){this.modeBits=n,this.numBitsCharCount=l}numCharCountBits(n){return this.numBitsCharCount[Math.floor((n+7)/17)]}};t.NUMERIC=new t(1,[10,12,14]),t.ALPHANUMERIC=new t(2,[9,11,13]),t.BYTE=new t(4,[8,16,16]),t.KANJI=new t(8,[8,10,12]),t.ECI=new t(7,[0,0,0]),a.Mode=t})(s.QrSegment||(s.QrSegment={}))})(gt||(gt={}));var Pt=gt;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var mj={L:Pt.QrCode.Ecc.LOW,M:Pt.QrCode.Ecc.MEDIUM,Q:Pt.QrCode.Ecc.QUARTILE,H:Pt.QrCode.Ecc.HIGH},Td=128,Fd="L",Rd="#FFFFFF",Ld="#000000",Id=!1,$d=1,uj=4,hj=0,xj=.1;function qd(s,a=0){const t=[];return s.forEach(function(r,n){let l=null;r.forEach(function(c,m){if(!c&&l!==null){t.push(`M${l+a} ${n+a}h${m-l}v1H${l+a}z`),l=null;return}if(m===r.length-1){if(!c)return;l===null?t.push(`M${m+a},${n+a} h1v1H${m+a}z`):t.push(`M${l+a},${n+a} h${m+1-l}v1H${l+a}z`);return}c&&l===null&&(l=m)})}),t.join("")}function Yd(s,a){return s.slice().map((t,r)=>r<a.y||r>=a.y+a.h?t:t.map((n,l)=>l<a.x||l>=a.x+a.w?n:!1))}function pj(s,a,t,r){if(r==null)return null;const n=s.length+t*2,l=Math.floor(a*xj),c=n/a,m=(r.width||l)*c,i=(r.height||l)*c,o=r.x==null?s.length/2-m/2:r.x*c,d=r.y==null?s.length/2-i/2:r.y*c,p=r.opacity==null?1:r.opacity;let x=null;if(r.excavate){let v=Math.floor(o),y=Math.floor(d),j=Math.ceil(m+o-v),M=Math.ceil(i+d-y);x={x:v,y,w:j,h:M}}const f=r.crossOrigin;return{x:o,y:d,h:i,w:m,excavation:x,opacity:p,crossOrigin:f}}function gj(s,a){return a!=null?Math.max(Math.floor(a),0):s?uj:hj}function Gd({value:s,level:a,minVersion:t,includeMargin:r,marginSize:n,imageSettings:l,size:c,boostLevel:m}){let i=se.useMemo(()=>{const v=(Array.isArray(s)?s:[s]).reduce((y,j)=>(y.push(...Pt.QrSegment.makeSegments(j)),y),[]);return Pt.QrCode.encodeSegments(v,mj[a],t,void 0,void 0,m)},[s,a,t,m]);const{cells:o,margin:d,numCells:p,calculatedImageSettings:x}=se.useMemo(()=>{let f=i.getModules();const v=gj(r,n),y=f.length+v*2,j=pj(f,c,v,l);return{cells:f,margin:v,numCells:y,calculatedImageSettings:j}},[i,c,l,r,n]);return{qrcode:i,margin:d,cells:o,numCells:p,calculatedImageSettings:x}}var fj=(function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0})(),jj=se.forwardRef(function(a,t){const r=a,{value:n,size:l=Td,level:c=Fd,bgColor:m=Rd,fgColor:i=Ld,includeMargin:o=Id,minVersion:d=$d,boostLevel:p,marginSize:x,imageSettings:f}=r,y=Fi(r,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:j}=y,M=Fi(y,["style"]),k=f?.src,z=se.useRef(null),$=se.useRef(null),u=se.useCallback(C=>{z.current=C,typeof t=="function"?t(C):t&&(t.current=C)},[t]),[g,T]=se.useState(!1),{margin:h,cells:b,numCells:L,calculatedImageSettings:O}=Gd({value:n,level:c,minVersion:d,boostLevel:p,includeMargin:o,marginSize:x,imageSettings:f,size:l});se.useEffect(()=>{if(z.current!=null){const C=z.current,N=C.getContext("2d");if(!N)return;let V=b;const E=$.current,ee=O!=null&&E!==null&&E.complete&&E.naturalHeight!==0&&E.naturalWidth!==0;ee&&O.excavation!=null&&(V=Yd(b,O.excavation));const ue=window.devicePixelRatio||1;C.height=C.width=l*ue;const Z=l/L*ue;N.scale(Z,Z),N.fillStyle=m,N.fillRect(0,0,L,L),N.fillStyle=i,fj?N.fill(new Path2D(qd(V,h))):b.forEach(function(S,G){S.forEach(function(q,ne){q&&N.fillRect(ne+h,G+h,1,1)})}),O&&(N.globalAlpha=O.opacity),ee&&N.drawImage(E,O.x+h,O.y+h,O.w,O.h)}}),se.useEffect(()=>{T(!1)},[k]);const P=Ti({height:l,width:l},j);let F=null;return k!=null&&(F=se.createElement("img",{src:k,key:k,style:{display:"none"},onLoad:()=>{T(!0)},ref:$,crossOrigin:O?.crossOrigin})),se.createElement(se.Fragment,null,se.createElement("canvas",Ti({style:P,height:l,width:l,ref:u,role:"img"},M)),F)});jj.displayName="QRCodeCanvas";var Vd=se.forwardRef(function(a,t){const r=a,{value:n,size:l=Td,level:c=Fd,bgColor:m=Rd,fgColor:i=Ld,includeMargin:o=Id,minVersion:d=$d,boostLevel:p,title:x,marginSize:f,imageSettings:v}=r,y=Fi(r,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:j,cells:M,numCells:k,calculatedImageSettings:z}=Gd({value:n,level:c,minVersion:d,boostLevel:p,includeMargin:o,marginSize:f,imageSettings:v,size:l});let $=M,u=null;v!=null&&z!=null&&(z.excavation!=null&&($=Yd(M,z.excavation)),u=se.createElement("image",{href:v.src,height:z.h,width:z.w,x:z.x+j,y:z.y+j,preserveAspectRatio:"none",opacity:z.opacity,crossOrigin:z.crossOrigin}));const g=qd($,j);return se.createElement("svg",Ti({height:l,width:l,viewBox:`0 0 ${k} ${k}`,ref:t,role:"img"},y),!!x&&se.createElement("title",null,x),se.createElement("path",{fill:m,d:`M0,0 h${k}v${k}H0z`,shapeRendering:"crispEdges"}),se.createElement("path",{fill:i,d:g,shapeRendering:"crispEdges"}),u)});Vd.displayName="QRCodeSVG";const $r={available:{label:"Disponível",color:"bg-green-500"},occupied:{label:"Ocupada",color:"bg-yellow-500"},reserved:{label:"Reservada",color:"bg-blue-500"},cleaning:{label:"Limpeza",color:"bg-gray-500"}};function wy(){const{isDark:s}=xn(),a=es(),{menuContext:t}=Ze(),{slug:r}=zo(),[n,l]=w.useState(!1),[c,m]=w.useState(null),[i,o]=w.useState({table_number:"",capacity:4,status:"available",qr_code:"",location:""}),[d,p]=w.useState(null),[x,f]=w.useState(!1),[v,y]=w.useState(null),[j,M]=w.useState(!1),[k,z]=w.useState(null),[$,u]=w.useState({customer_name:"",customer_phone:"",reservation_date:"",reservation_time:"",guests:1}),{data:g=[]}=Ae({queryKey:["tables",t?.type,t?.value],queryFn:async()=>{if(!t)return[];const q={};return t.type==="subscriber"&&t.value&&(q.as_subscriber=t.value),ae.entities.Table.list(null,q)},enabled:!!t}),{data:T=[]}=Ae({queryKey:["Comanda",t?.type,t?.value],queryFn:async()=>{if(!t)return[];const q={status:"open"};return t.type==="subscriber"&&t.value&&(q.as_subscriber=t.value),ae.entities.Comanda.list("-created_at",q)},enabled:!!t}),h=r||"",b=le({mutationFn:async q=>{if(!q.qr_code){const ne=window.location.origin;q.qr_code=`${ne}/mesa/${q.table_number}${h?`?slug=${h}`:""}`}return ae.entities.Table.create(q)},onSuccess:()=>{a.invalidateQueries(["tables"]),os.success("Mesa criada com sucesso!"),l(!1),N()},onError:q=>{os.error("Erro ao criar mesa: "+(q.message||"Erro desconhecido"))}}),L=le({mutationFn:async({id:q,data:ne})=>ae.entities.Table.update(q,ne),onSuccess:()=>{a.invalidateQueries(["tables"]),os.success("Mesa atualizada com sucesso!"),l(!1),N()},onError:q=>{os.error("Erro ao atualizar mesa: "+(q.message||"Erro desconhecido"))}}),O=le({mutationFn:async q=>ae.entities.Table.delete(q),onSuccess:()=>{a.invalidateQueries(["tables"]),os.success("Mesa deletada com sucesso!")},onError:q=>{os.error("Erro ao deletar mesa: "+(q.message||"Erro desconhecido"))}}),P=le({mutationFn:async({tableId:q,...ne})=>ae.entities.Table.update(q,{status:"reserved",reservation_date:ne.reservation_date,reservation_time:ne.reservation_time,reservation_customer_name:ne.customer_name,reservation_customer_phone:ne.customer_phone||"",reservation_guests:ne.guests||1}),onSuccess:()=>{a.invalidateQueries(["tables"]),os.success("Reserva confirmada!"),M(!1),z(null),u({customer_name:"",customer_phone:"",reservation_date:"",reservation_time:"",guests:1})},onError:q=>{os.error("Erro ao criar reserva: "+(q.message||"Erro desconhecido"))}}),F=le({mutationFn:async q=>ae.entities.Table.update(q.id,{status:"available",reservation_date:null,reservation_time:null,reservation_customer_name:null,reservation_customer_phone:null,reservation_guests:null}),onSuccess:()=>{a.invalidateQueries(["tables"]),os.success("Reserva cancelada.")},onError:q=>{os.error("Erro ao cancelar reserva: "+(q.message||"Erro desconhecido"))}}),C=q=>{z(q),u({customer_name:"",customer_phone:"",reservation_date:"",reservation_time:"",guests:1}),M(!0)},N=()=>{o({table_number:"",capacity:4,status:"available",qr_code:"",location:""}),m(null)},V=q=>{m(q),o({table_number:q.table_number||"",capacity:q.capacity||4,status:q.status||"available",qr_code:q.qr_code||"",location:q.location||""}),l(!0)},E=q=>{q.preventDefault(),c?L.mutate({id:c.id,data:i}):b.mutate(i)},ee=q=>{window.confirm("Tem certeza que deseja deletar esta mesa?")&&O.mutate(q)},ue=q=>{p(q)},Z=q=>{const ne=document.getElementById(`qr-${q.id}`);if(ne){const Me=ne.toDataURL("image/png"),Y=document.createElement("a");Y.download=`qr-mesa-${q.table_number}.png`,Y.href=Me,Y.click()}},S=q=>{y(q),f(!0)},G=q=>T.filter(ne=>ne.table_id&&String(ne.table_id)===String(q.id)||ne.table_number&&String(ne.table_number)===String(q.table_number)||ne.table_name&&String(ne.table_name)===String(q.table_number));return e.jsxs("div",{className:"space-y-6",children:[!h&&e.jsxs("div",{className:"rounded-lg bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 p-3 text-sm text-amber-800 dark:text-amber-200",children:[e.jsx("strong",{children:"Dica:"})," Para o QR Code abrir o cardápio correto, defina o ",e.jsx("strong",{children:"slug do estabelecimento"})," (ex.: link do cardápio /s/meu-restaurante) em Loja ou no seu perfil. Assim o link da mesa ficará: /mesa/N?slug=meu-restaurante"]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Gestão de Mesas"}),e.jsx("p",{className:"text-gray-500",children:"Gerencie mesas, QR Codes e status"})]}),e.jsxs(ze,{open:n,onOpenChange:l,children:[e.jsx(Bm,{asChild:!0,children:e.jsxs(D,{onClick:N,children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Nova Mesa"]})}),e.jsxs(Te,{className:"sm:max-w-md max-w-[95vw]",children:[e.jsxs(Fe,{children:[e.jsx(Re,{children:c?"Editar Mesa":"Nova Mesa"}),e.jsx(Zr,{className:"sr-only",children:"Formulário para criar ou editar uma mesa."})]}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Número da Mesa *"}),e.jsx(U,{value:i.table_number,onChange:q=>o(ne=>({...ne,table_number:q.target.value})),placeholder:"Ex: 1, 2, 3...",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Capacidade"}),e.jsx(U,{type:"number",value:i.capacity,onChange:q=>o(ne=>({...ne,capacity:parseInt(q.target.value)||4})),min:"1"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Status"}),e.jsxs(Ce,{value:i.status,onValueChange:q=>o(ne=>({...ne,status:q})),children:[e.jsx(ke,{children:e.jsx(Se,{})}),e.jsx(De,{children:Object.entries($r).map(([q,{label:ne}])=>e.jsx(Q,{value:q,children:ne},q))})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Localização (opcional)"}),e.jsx(U,{value:i.location,onChange:q=>o(ne=>({...ne,location:q.target.value})),placeholder:"Ex: Salão principal, Varanda..."})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(D,{type:"button",variant:"outline",onClick:()=>l(!1),children:"Cancelar"}),e.jsx(D,{type:"submit",disabled:b.isLoading||L.isLoading,children:c?"Atualizar":"Criar"})]})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:g.map(q=>{const ne=$r[q.status]||$r.available;return e.jsxs(B,{children:[e.jsx(oe,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs(ce,{className:"text-xl",children:["Mesa ",q.table_number]}),e.jsx(fe,{className:ne.color,children:ne.label})]})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Capacidade:"})," ",q.capacity," pessoas"]}),q.location&&e.jsxs("div",{children:[e.jsx("strong",{children:"Localização:"})," ",q.location]}),q.status==="reserved"&&q.reservation_date&&e.jsxs("div",{className:"p-2 rounded bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-700 dark:text-blue-300 text-xs",children:[e.jsx(It,{className:"w-3 h-3"}),e.jsx("span",{className:"font-medium",children:"Reservada"})]}),q.reservation_customer_name&&e.jsxs("p",{className:"text-xs mt-1 text-blue-600 dark:text-blue-400",children:["Cliente: ",q.reservation_customer_name]}),e.jsxs("p",{className:"text-xs text-blue-600 dark:text-blue-400",children:[new Date(q.reservation_date).toLocaleDateString("pt-BR")," às ",q.reservation_time||"--:--"]}),q.reservation_guests&&e.jsxs("p",{className:"text-xs text-blue-600 dark:text-blue-400",children:["Convidados: ",q.reservation_guests]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(D,{size:"sm",variant:"outline",onClick:()=>V(q),children:[e.jsx($t,{className:"w-4 h-4 mr-1"}),"Editar"]}),e.jsxs(D,{size:"sm",variant:"outline",onClick:()=>ue(q),children:[e.jsx(Lu,{className:"w-4 h-4 mr-1"}),"QR Code"]}),e.jsxs(D,{size:"sm",variant:"outline",onClick:()=>S(q),children:[e.jsx(La,{className:"w-4 h-4 mr-1"}),"Comandas"]}),q.status!=="reserved"&&e.jsxs(D,{size:"sm",variant:"outline",onClick:()=>C(q),children:[e.jsx(It,{className:"w-4 h-4 mr-1"}),"Reservar"]}),q.status==="reserved"&&e.jsxs(D,{size:"sm",variant:"outline",onClick:()=>{window.confirm("Cancelar reserva desta mesa?")&&F.mutate(q)},children:[e.jsx(ws,{className:"w-4 h-4 mr-1"}),"Cancelar"]}),e.jsx(D,{size:"sm",variant:"destructive",onClick:()=>ee(q.id),children:e.jsx(Ke,{className:"w-4 h-4"})})]})]})]},q.id)})}),d&&e.jsx(ze,{open:!!d,onOpenChange:()=>p(null),children:e.jsxs(Te,{className:"sm:max-w-sm max-w-[95vw]",children:[e.jsx(Fe,{children:e.jsxs(Re,{children:["QR Code - Mesa ",d.table_number]})}),e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg",children:e.jsx(Vd,{value:d.qr_code||`${window.location.origin}/mesa/${d.table_number}${h?`?slug=${h}`:""}`,size:200,level:"H"})}),e.jsxs(D,{onClick:()=>Z(d),children:[e.jsx(pn,{className:"w-4 h-4 mr-2"}),"Baixar QR Code"]})]})]})}),e.jsx(ze,{open:x,onOpenChange:f,children:e.jsxs(Te,{className:"sm:max-w-2xl max-w-[95vw] max-h-[85vh] overflow-y-auto",children:[e.jsx(Fe,{children:e.jsxs(Re,{children:["Comandas - Mesa ",v?.table_number]})}),v&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-3 rounded-lg border bg-gray-50 dark:bg-gray-800",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",$r[v.status]?.label||v.status]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Capacidade:"})," ",v.capacity," pessoas"]}),v.location&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("strong",{children:"Localização:"})," ",v.location]})]})}),(()=>{const q=G(v),ne=q.reduce((Y,A)=>Y+(A.total||0),0),Me=q.reduce((Y,A)=>Y+(Array.isArray(A.items)?A.items.length:0),0);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 p-3 rounded-lg border bg-blue-50 dark:bg-blue-900/20",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Comandas Abertas"}),e.jsx("p",{className:"text-lg font-bold",children:q.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Total de Itens"}),e.jsx("p",{className:"text-lg font-bold",children:Me})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Valor Total"}),e.jsx("p",{className:"text-lg font-bold",children:ga(ne)})]})]}),q.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(La,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Nenhuma comanda aberta nesta mesa"})]}):e.jsx("div",{className:"space-y-3",children:q.map(Y=>e.jsxs(B,{className:"border",children:[e.jsx(oe,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ce,{className:"text-base flex items-center gap-2",children:[e.jsx(La,{className:"w-4 h-4"}),Y.code||`#${Y.id}`]}),e.jsx(fe,{className:"bg-green-600",children:"Aberta"})]})}),e.jsxs(H,{className:"space-y-2",children:[Y.customer_name&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Cliente: ",Y.customer_name]}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"font-medium",children:["Itens (",Array.isArray(Y.items)?Y.items.length:0,"):"]}),e.jsxs("ul",{className:"list-disc list-inside text-gray-600 dark:text-gray-400 mt-1",children:[Array.isArray(Y.items)&&Y.items.slice(0,3).map((A,X)=>e.jsxs("li",{className:"text-xs",children:[A.quantity,"x ",A.dish_name||"Item"," - ",ga((A.quantity||0)*(A.unit_price||0))]},X)),Y.items.length>3&&e.jsxs("li",{className:"text-xs text-gray-500",children:["... e mais ",Y.items.length-3," item(ns)"]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total:"}),e.jsx("span",{className:"text-lg font-bold",children:ga(Y.total||0)})]})]})]},Y.id))})]})})()]})]})}),e.jsx(ze,{open:j,onOpenChange:M,children:e.jsxs(Te,{className:"sm:max-w-md max-w-[95vw]",children:[e.jsx(Fe,{children:e.jsxs(Re,{children:["Reservar Mesa ",k?.table_number]})}),e.jsxs("form",{onSubmit:q=>{if(q.preventDefault(),!$.customer_name||!$.reservation_date||!$.reservation_time){os.error("Preencha todos os campos obrigatórios");return}if(!k?.id){os.error("Mesa não identificada.");return}P?.mutate?.({tableId:k.id,...$})},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome do Cliente *"}),e.jsx(U,{value:$.customer_name,onChange:q=>u(ne=>({...ne,customer_name:q.target.value})),placeholder:"Nome completo",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Telefone"}),e.jsx(U,{value:$.customer_phone,onChange:q=>u(ne=>({...ne,customer_phone:q.target.value})),placeholder:"(00) 00000-0000"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Data da Reserva *"}),e.jsx(U,{type:"date",value:$.reservation_date,onChange:q=>u(ne=>({...ne,reservation_date:q.target.value})),min:new Date().toISOString().split("T")[0],required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Horário *"}),e.jsx(U,{type:"time",value:$.reservation_time,onChange:q=>u(ne=>({...ne,reservation_time:q.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Número de Convidados"}),e.jsx(U,{type:"number",min:"1",max:k?.capacity||10,value:$.guests,onChange:q=>u(ne=>({...ne,guests:parseInt(q.target.value)||1}))})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(D,{type:"button",variant:"outline",onClick:()=>M(!1),children:"Cancelar"}),e.jsx(D,{type:"submit",disabled:P?.isPending,children:P?.isPending?"Salvando...":"Confirmar Reserva"})]})]})]})})]})}function _y(){const s=es(),{user:a,menuContext:t}=Ze(),r=t?.type==="subscriber"?t.value:a?.subscriber_email||a?.email,n=!a?.is_master&&(a?.email||"").toLowerCase()===(r||"").toLowerCase(),l=n||a?.is_master&&!!r,m=(a?.profile_roles?.length?a.profile_roles:a?.profile_role?[a.profile_role]:[]).includes("gerente"),{data:i,isLoading:o}=Ae({queryKey:["managerial-auth",r],queryFn:()=>_e.get("/managerial-auth",r?{as_subscriber:r}:{})}),[d,p]=w.useState({matricula:"",password:"",expirable:!1,expires_at:""}),[x,f]=w.useState({matricula:"",password:"",expirable:!1,expires_at:""}),v=le({mutationFn:({role:y,matricula:j,password:M,expirable:k,expires_at:z})=>{const $={role:y,matricula:j,password:M,expirable:!!k,expires_at:k&&z?z:null};return a?.is_master&&r&&($.as_subscriber=r),_e.post("/managerial-auth",$)},onSuccess:(y,j)=>{s.invalidateQueries({queryKey:["managerial-auth"]}),W.success(j.role==="gerente"?"Autorização do Gerente salva.":"Sua autorização foi salva."),j.role==="assinante"?p({matricula:"",password:"",expirable:!1,expires_at:""}):f({matricula:"",password:"",expirable:!1,expires_at:""})},onError:y=>W.error(y?.message||"Erro ao salvar")});return o?e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsx(Ta,{className:"w-8 h-8 animate-spin text-orange-500"})}):!n&&m?e.jsx("div",{className:"max-w-2xl space-y-4",children:e.jsxs(B,{children:[e.jsxs(oe,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Hm,{className:"w-5 h-5"}),"Autorização gerencial"]}),e.jsx(rs,{children:"A matrícula e a senha de autorização são definidas pelo dono do estabelecimento. Quando você realizar ações sensíveis (abrir caixa, excluir, exportar, etc.), será solicitada sua matrícula e senha."})]}),e.jsx(H,{children:e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:i?.gerente?.configured?"Sua autorização está configurada. Use sua matrícula e senha quando o sistema solicitar.":"O dono do estabelecimento ainda não configurou sua autorização. Peça que ele acesse esta aba e defina sua matrícula e senha."})})]})}):l?e.jsxs("div",{className:"max-w-3xl space-y-6",children:[a?.is_master&&r&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 rounded-lg bg-gray-100 dark:bg-gray-800 px-3 py-2",children:["Configurando autorização para o estabelecimento: ",e.jsx("strong",{children:r})]}),e.jsx(B,{children:e.jsxs(oe,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(en,{className:"w-5 h-5"}),"Autorização gerencial"]}),e.jsx(rs,{children:"Defina matrícula e senha para validar ações sensíveis: editar, excluir, duplicar, importar, exportar, abrir caixa e funções financeiras. Você pode tornar a senha expirável ou permanente e alterá-la a qualquer momento."})]})}),e.jsxs(B,{children:[e.jsxs(oe,{children:[e.jsx(ce,{children:"Minha autorização (Assinante)"}),e.jsx(rs,{children:"Usada quando você realizar ações que exigem confirmação."})]}),e.jsxs(H,{className:"space-y-4",children:[i?.assinante?.configured&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Matrícula configurada. Expira em: ",i.assinante.expires_at?new Date(i.assinante.expires_at).toLocaleDateString("pt-BR"):"Permanente","."]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Código de matrícula"}),e.jsx(U,{value:d.matricula,onChange:y=>p(j=>({...j,matricula:y.target.value})),placeholder:"Ex.: 001"})]}),e.jsxs("div",{children:[e.jsxs(R,{children:["Senha ",i?.assinante?.configured?"(nova, para alterar)":""]}),e.jsx(U,{type:"password",value:d.password,onChange:y=>p(j=>({...j,password:y.target.value})),placeholder:"Mín. 6 caracteres"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{checked:d.expirable,onCheckedChange:y=>p(j=>({...j,expirable:y}))}),e.jsx(R,{children:"Senha expirável"})]}),d.expirable&&e.jsxs("div",{children:[e.jsx(R,{className:"mr-2",children:"Válida até"}),e.jsx(U,{type:"date",value:d.expires_at,onChange:y=>p(j=>({...j,expires_at:y.target.value}))})]})]}),e.jsxs(D,{disabled:!d.matricula.trim()||d.password.length<6||v.isPending,onClick:()=>v.mutate({role:"assinante",matricula:d.matricula.trim(),password:d.password,expirable:d.expirable,expires_at:d.expires_at||null}),children:[v.isPending?e.jsx(Ta,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(hr,{className:"w-4 h-4 mr-2"}),i?.assinante?.configured?"Alterar senha":"Salvar"]})]})]}),e.jsxs(B,{children:[e.jsxs(oe,{children:[e.jsx(ce,{children:"Autorização do Gerente"}),e.jsx(rs,{children:"Matrícula e senha que o gerente usará para validar ações sensíveis."})]}),e.jsxs(H,{className:"space-y-4",children:[i?.gerente?.configured&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Matrícula configurada. Expira em: ",i.gerente.expires_at?new Date(i.gerente.expires_at).toLocaleDateString("pt-BR"):"Permanente","."]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Código de matrícula"}),e.jsx(U,{value:x.matricula,onChange:y=>f(j=>({...j,matricula:y.target.value})),placeholder:"Ex.: 002"})]}),e.jsxs("div",{children:[e.jsxs(R,{children:["Senha ",i?.gerente?.configured?"(nova, para alterar)":""]}),e.jsx(U,{type:"password",value:x.password,onChange:y=>f(j=>({...j,password:y.target.value})),placeholder:"Mín. 6 caracteres"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{checked:x.expirable,onCheckedChange:y=>f(j=>({...j,expirable:y}))}),e.jsx(R,{children:"Senha expirável"})]}),x.expirable&&e.jsxs("div",{children:[e.jsx(R,{className:"mr-2",children:"Válida até"}),e.jsx(U,{type:"date",value:x.expires_at,onChange:y=>f(j=>({...j,expires_at:y.target.value}))})]})]}),e.jsxs(D,{disabled:!x.matricula.trim()||x.password.length<6||v.isPending,onClick:()=>v.mutate({role:"gerente",matricula:x.matricula.trim(),password:x.password,expirable:x.expirable,expires_at:x.expires_at||null}),children:[v.isPending?e.jsx(Ta,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(hr,{className:"w-4 h-4 mr-2"}),i?.gerente?.configured?"Alterar senha":"Salvar"]})]})]}),e.jsxs("div",{className:"flex items-start gap-2 p-4 rounded-lg bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800",children:[e.jsx(ft,{className:"w-5 h-5 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-amber-800 dark:text-amber-200",children:"Quando a autorização estiver configurada, ao abrir caixa, exportar, excluir itens ou realizar outras ações sensíveis, o sistema solicitará a matrícula e a senha para validar."})]})]}):e.jsx("div",{className:"max-w-2xl",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Apenas o dono do estabelecimento pode configurar as autorizações gerenciais. Selecione um estabelecimento no menu para configurar em nome dele."})})}export{Wt as A,jy as C,Xv as D,ly as F,yy as L,sy as M,ny as O,py as P,Lu as Q,hy as S,vy as T,Er as U,ey as W,_y as a,fy as b,xy as c,my as d,wy as e,uy as f,dy as g,cy as h,oy as i,ty as j,ay as k,iy as l,ry as m,gy as n,Qv as o,Wu as p,Vl as q,Jv as r,Zv as s,Ad as t,Ht as u,Pd as v,zi as w,Wa as x,Ed as y,Ha as z};
