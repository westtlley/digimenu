import{c as pe,r as m,u as fe,p as Se,z as $,j as e,B as j,P as ke,x as T,T as we}from"./main-AonIQAES.js";import{b as p}from"./base44Client-DnnNNlVu.js";import{u as se}from"./useQuery-1B__UZCp.js";import{u as R}from"./useMutation--pPw_T_d.js";import{I as f,L as o}from"./input-BZMCG3xh.js";import{T as Ie}from"./textarea-DMRLefWJ.js";import{D as te,a as re,b as ne,c as le,f as De}from"./dialog-LI6mGNSb.js";import{B as L}from"./badge-VNLW5sw5.js";import{S as xe}from"./switch-BA6NwbNY.js";import{C as w,c as I,a as q,b as E}from"./card-GW57779a.js";import{S as V,a as K,b as U,c as H,d as _}from"./select-BsJPtTd1.js";import{uploadToCloudinary as Be}from"./cloudinaryUpload-C4sUQLHO.js";import{u as ve}from"./usePermission-CVnsvsYp.js";import{u as be,p as ye,t as ce,v as de,w as O,x as u,y as oe,z as h,A as Te}from"./ManagerialAuthTab-fHbenCnM.js";import{P as me}from"./plus-BWjW9AHH.js";import{S as qe}from"./search-Sb5SY96K.js";import{b as Ee}from"./EmptyState-B-2tmWOi.js";import{T as Fe}from"./trash-2-eTZTaYxL.js";import{S as Ne}from"./shopping-cart-Ur_1HrJq.js";import{S as Me}from"./differenceInCalendarDays-DRQCwW68.js";import{T as Ae,a as Re,b as je,c as ge}from"./tabs-CmdXZfSo.js";import{U as ze}from"./users-BZplJILV.js";import{T as Pe}from"./trending-up-CEWXgtY8.js";import{D as _e}from"./dollar-sign-B5ekxtL2.js";import{C as Qe}from"./dateUtils-DeGNBYqD.js";import{S as Oe}from"./settings-86dQDP0i.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]],$e=pe("Droplets",Le);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=[["path",{d:"m10 20-1.25-2.5L6 18",key:"18frcb"}],["path",{d:"M10 4 8.75 6.5 6 6",key:"7mghy3"}],["path",{d:"M10.585 15H10",key:"4nqulp"}],["path",{d:"M2 12h6.5L10 9",key:"kv9z4n"}],["path",{d:"M20 14.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0z",key:"yu0u2z"}],["path",{d:"m4 10 1.5 2L4 14",key:"k9enpj"}],["path",{d:"m7 21 3-6-1.5-3",key:"j8hb9u"}],["path",{d:"m7 3 3 6h2",key:"1bbqgq"}]],Ke=pe("ThermometerSnowflake",Ve);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]],He=pe("Thermometer",Ue),Ge=v=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(v||0);function Ns(){const[v,n]=m.useState(null),[G,y]=m.useState(!1),[z,C]=m.useState(!1),[g,P]=m.useState(null),[F,J]=m.useState(null),[N,D]=m.useState(""),[i,c]=m.useState("all"),[x,b]=m.useState(""),[l,d]=m.useState({name:"",description:"",image:"",price:"",category_id:"",beverage_type:"industrial",volume_ml:"",serving_temp:"cold",ean:"",sugar_free:!1,alcoholic:!1,caffeine:!1,dietary_tags:[],is_active:!0,is_highlight:!1,order:0}),B=fe();Se.useEffect(()=>{p.auth.me().then(n).catch(()=>{})},[]);const{menuContext:M}=ve(),{data:ae=[]}=be(),Z=m.useMemo(()=>(ae||[]).filter(s=>s.product_type==="beverage"),[ae]),{data:A=[]}=se({queryKey:["beverageCategories",M?.type,M?.value],queryFn:async()=>{if(!M)return[];const s={};return M.type==="subscriber"&&M.value&&(s.as_subscriber=M.value),p.entities.BeverageCategory.list("order",s)},enabled:!!M}),ue=R({mutationFn:s=>p.entities.Dish.create({...s,product_type:"beverage",subscriber_email:v?.subscriber_email||v?.email}),onSuccess:()=>{B.invalidateQueries({queryKey:["dishes"]}),$.success("Bebida criada!"),a()}}),ie=R({mutationFn:({id:s,data:t})=>p.entities.Dish.update(s,t),onSuccess:()=>{B.invalidateQueries({queryKey:["dishes"]}),$.success("Bebida atualizada!"),a()}}),he=R({mutationFn:s=>p.entities.Dish.delete(s),onSuccess:()=>{B.invalidateQueries({queryKey:["dishes"]}),$.success("Bebida excluída!")}}),W=R({mutationFn:s=>p.entities.BeverageCategory.create({...s,subscriber_email:v?.subscriber_email||v?.email}),onSuccess:()=>{B.invalidateQueries({queryKey:["beverageCategories"]}),C(!1),b(""),$.success("Categoria criada!")}}),Y=m.useMemo(()=>{let s=Z;return i!=="all"&&(s=s.filter(t=>t.category_id===i)),N&&(s=s.filter(t=>(t.name||"").toLowerCase().includes(N.toLowerCase()))),s},[Z,i,N]),a=()=>{y(!1),P(null),d({name:"",description:"",image:"",price:"",category_id:"",beverage_type:"industrial",volume_ml:"",serving_temp:"cold",ean:"",sugar_free:!1,alcoholic:!1,caffeine:!1,dietary_tags:[],is_active:!0,is_highlight:!1,order:0})},r=(s=null)=>{s?(P(s),d({name:s.name||"",description:s.description||"",image:s.image||"",price:String(s.price??""),category_id:s.category_id||"",beverage_type:s.beverage_type||"industrial",volume_ml:String(s.volume_ml??""),serving_temp:s.serving_temp||"cold",ean:s.ean||"",sugar_free:!!s.sugar_free,alcoholic:!!s.alcoholic,caffeine:!!s.caffeine,dietary_tags:Array.isArray(s.dietary_tags)?s.dietary_tags:[],is_active:s.is_active!==!1,is_highlight:!!s.is_highlight,order:s.order??0})):(P(null),d({...l,category_id:A[0]?.id||"",order:Z.length})),y(!0)},S=s=>{s.preventDefault();const t={...l,price:parseFloat(l.price)||0,volume_ml:parseInt(l.volume_ml,10)||null};g?ie.mutate({id:g.id,data:t}):ue.mutate(t)},k=async s=>{const t=s.target.files?.[0];if(t)try{const ee=await Be(t,"dishes");ee?d(Ce=>({...Ce,image:ee})):$.error("Erro no upload")}catch{$.error("Falha ao enviar imagem")}},Q=s=>{d(t=>({...t,dietary_tags:t.dietary_tags.includes(s)?t.dietary_tags.filter(ee=>ee!==s):[...t.dietary_tags,s]}))},X=[{id:"vegano",label:"Vegano"},{id:"sem_lactose",label:"Sem lactose"},{id:"sem_gluten",label:"Sem glúten"},{id:"zero_acucar",label:"Zero açúcar"}];return e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(ye,{className:"w-6 h-6 text-cyan-500"}),"Bebidas"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Cadastre refrigerantes, sucos, águas e outras bebidas"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>C(!0),children:[e.jsx(me,{className:"w-4 h-4 mr-1"})," Categoria"]}),e.jsxs(j,{className:"bg-cyan-600 hover:bg-cyan-700",onClick:()=>r(),children:[e.jsx(me,{className:"w-4 h-4 mr-2"})," Nova Bebida"]})]})]}),e.jsx(w,{children:e.jsxs(I,{className:"p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(qe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(f,{placeholder:"Buscar bebidas...",value:N,onChange:s=>D(s.target.value),className:"pl-9"})]}),e.jsxs(V,{value:i,onValueChange:c,children:[e.jsx(K,{className:"w-full sm:w-[200px]",children:e.jsx(U,{placeholder:"Categoria"})}),e.jsxs(H,{children:[e.jsx(_,{value:"all",children:"Todas"}),A.map(s=>e.jsx(_,{value:s.id,children:s.name},s.id))]})]})]}),e.jsx("div",{className:"grid gap-3",children:Y.map(s=>e.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-lg border bg-gray-50/50 dark:bg-gray-800/30",children:[s.image&&e.jsx("img",{src:s.image,alt:"",className:"w-14 h-14 rounded-lg object-cover"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:s.name}),s.volume_ml&&e.jsxs(L,{variant:"outline",className:"text-xs",children:[s.volume_ml,"ml"]}),s.beverage_type==="natural"&&e.jsx(L,{className:"bg-green-100 text-green-800 text-xs",children:"Natural"}),s.serving_temp==="cold"&&e.jsx(Ke,{className:"w-4 h-4 text-blue-500"}),s.serving_temp==="hot"&&e.jsx(He,{className:"w-4 h-4 text-orange-500"})]}),e.jsxs("p",{className:"text-sm text-gray-500 truncate",children:[A.find(t=>t.id===s.category_id)?.name," · ",Ge(s.price)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{checked:s.is_active!==!1,onCheckedChange:t=>ie.mutate({id:s.id,data:{...s,is_active:t}})}),e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>r(s),children:e.jsx(Ee,{className:"w-4 h-4"})}),e.jsx(j,{variant:"ghost",size:"icon",className:"text-red-500",onClick:()=>confirm("Excluir?")&&he.mutate(s.id),children:e.jsx(Fe,{className:"w-4 h-4"})})]})]},s.id))}),Y.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(ye,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Nenhuma bebida cadastrada"}),e.jsx(j,{variant:"outline",className:"mt-3",onClick:()=>r(),children:"Cadastrar primeira bebida"})]})]})}),e.jsx(te,{open:G,onOpenChange:s=>!s&&a(),children:e.jsxs(re,{className:"sm:max-w-2xl max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsx(ne,{children:e.jsx(le,{children:g?"Editar Bebida":"Nova Bebida"})}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Nome *"}),e.jsx(f,{value:l.name,onChange:s=>d(t=>({...t,name:s.target.value})),placeholder:"Ex: Refrigerante Coca-Cola",required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Categoria"}),e.jsxs(V,{value:l.category_id,onValueChange:s=>d(t=>({...t,category_id:s})),children:[e.jsx(K,{children:e.jsx(U,{placeholder:"Selecione"})}),e.jsx(H,{children:A.map(s=>e.jsx(_,{value:s.id,children:s.name},s.id))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Tipo"}),e.jsxs(V,{value:l.beverage_type,onValueChange:s=>d(t=>({...t,beverage_type:s})),children:[e.jsx(K,{children:e.jsx(U,{})}),e.jsxs(H,{children:[e.jsxs(_,{value:"industrial",children:[e.jsx(ke,{className:"w-4 h-4 mr-2 inline"})," Industrializado"]}),e.jsxs(_,{value:"natural",children:[e.jsx($e,{className:"w-4 h-4 mr-2 inline"})," Natural"]})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Volume (ml)"}),e.jsx(f,{type:"number",min:"1",value:l.volume_ml,onChange:s=>d(t=>({...t,volume_ml:s.target.value})),placeholder:"350"})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Temperatura"}),e.jsxs(V,{value:l.serving_temp,onValueChange:s=>d(t=>({...t,serving_temp:s})),children:[e.jsx(K,{children:e.jsx(U,{})}),e.jsxs(H,{children:[e.jsx(_,{value:"cold",children:"Gelado"}),e.jsx(_,{value:"room",children:"Ambiente"}),e.jsx(_,{value:"hot",children:"Quente"})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{children:"EAN (código de barras)"}),e.jsx(f,{value:l.ean,onChange:s=>d(t=>({...t,ean:s.target.value})),placeholder:"7891234567890"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Preço *"}),e.jsx(f,{type:"number",step:"0.01",value:l.price,onChange:s=>d(t=>({...t,price:s.target.value})),placeholder:"5.00",required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Foto"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[l.image&&e.jsx("img",{src:l.image,alt:"",className:"w-16 h-16 rounded object-cover"}),e.jsxs("label",{className:"text-sm text-cyan-600 cursor-pointer",children:["Upload ",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:k})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium w-full",children:"Características"}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:l.sugar_free,onChange:s=>d(t=>({...t,sugar_free:s.target.checked}))})," Sem açúcar"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:l.alcoholic,onChange:s=>d(t=>({...t,alcoholic:s.target.checked}))})," Alcoólico"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:l.caffeine,onChange:s=>d(t=>({...t,caffeine:s.target.checked}))})," Cafeína"]}),X.map(s=>e.jsx(L,{variant:l.dietary_tags.includes(s.id)?"default":"outline",className:"cursor-pointer",onClick:()=>Q(s.id),children:s.label},s.id))]}),e.jsxs("div",{children:[e.jsx(o,{children:"Descrição"}),e.jsx(Ie,{value:l.description,onChange:s=>d(t=>({...t,description:s.target.value})),rows:2,placeholder:"Descrição opcional"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded",children:[e.jsx(o,{children:"Ativo"}),e.jsx(xe,{checked:l.is_active,onCheckedChange:s=>d(t=>({...t,is_active:s}))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded",children:[e.jsx(o,{children:"Destacar no cardápio"}),e.jsx(xe,{checked:l.is_highlight,onCheckedChange:s=>d(t=>({...t,is_highlight:s}))})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(j,{type:"button",variant:"outline",onClick:a,className:"flex-1",children:"Cancelar"}),e.jsx(j,{type:"submit",className:"flex-1 bg-cyan-600 hover:bg-cyan-700",children:g?"Salvar":"Criar"})]})]})]})}),e.jsx(te,{open:z,onOpenChange:C,children:e.jsxs(re,{children:[e.jsx(ne,{children:e.jsx(le,{children:"Nova Categoria de Bebidas"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Nome"}),e.jsx(f,{value:x,onChange:s=>b(s.target.value),placeholder:"Ex: Refrigerantes, Sucos, Águas"})]}),e.jsx(j,{onClick:()=>x.trim()&&W.mutate({name:x.trim(),order:A.length}),className:"w-full",children:"Criar"})]})]})})]})}function _s(){const v=fe(),{menuContext:n}=ve(),[G,y]=m.useState(!1),[z,C]=m.useState(!1),[g,P]=m.useState(null),[F,J]=m.useState(null),[N,D]=m.useState({name:"",unit:"unidade",current_stock:0,min_stock:5,cost_per_unit:0,expiration_date:null}),[i,c]=m.useState({ingredient_id:"",quantity:1}),{data:x=[]}=se({queryKey:["ingredients",n?.type,n?.value],queryFn:async()=>{if(!n)return[];const a={};return n.type==="subscriber"&&n.value&&(a.as_subscriber=n.value),p.entities.Ingredient.list(null,a)},enabled:!!n}),{data:b=[]}=be(),{data:l=[]}=se({queryKey:["dishIngredients",n?.type,n?.value],queryFn:async()=>{if(!n)return[];const a={};return n.type==="subscriber"&&n.value&&(a.as_subscriber=n.value),p.entities.DishIngredient.list(null,a)},enabled:!!n}),d=m.useMemo(()=>{const a={};return x.forEach(r=>{a[r.id]={...r,available:r.current_stock||0,reserved:0,lowStock:(r.current_stock||0)<=(r.min_stock||5)}}),a},[x]),B=m.useMemo(()=>x.filter(a=>(a.current_stock||0)<=(a.min_stock||5)),[x]);m.useMemo(()=>{const a=[];return B.forEach(r=>{const S=l.filter(k=>k.ingredient_id===r.id).map(k=>{const Q=b.find(X=>X.id===k.dish_id);return Q?{...Q,requiredQuantity:k.quantity}:null}).filter(Boolean);a.push(...S)}),a},[B,l,b]);const M=R({mutationFn:async a=>p.entities.Ingredient.create(a),onSuccess:()=>{v.invalidateQueries(["ingredients"]),T.success("Ingrediente criado com sucesso!"),y(!1),A()},onError:a=>{T.error("Erro ao criar ingrediente: "+(a.message||"Erro desconhecido"))}}),ae=R({mutationFn:async({id:a,data:r})=>p.entities.Ingredient.update(a,r),onSuccess:()=>{v.invalidateQueries(["ingredients"]),T.success("Ingrediente atualizado com sucesso!"),y(!1),A()},onError:a=>{T.error("Erro ao atualizar ingrediente: "+(a.message||"Erro desconhecido"))}});R({mutationFn:async a=>p.entities.Ingredient.delete(a),onSuccess:()=>{v.invalidateQueries(["ingredients"]),T.error("Ingrediente deletado com sucesso!")},onError:a=>{T.error("Erro ao deletar ingrediente: "+(a.message||"Erro desconhecido"))}});const Z=R({mutationFn:async a=>p.entities.DishIngredient.create({...a,dish_id:F.id}),onSuccess:()=>{v.invalidateQueries(["dishIngredients"]),T.success("Ingrediente adicionado ao prato!"),C(!1),ue()},onError:a=>{T.error("Erro ao adicionar ingrediente: "+(a.message||"Erro desconhecido"))}}),A=()=>{D({name:"",unit:"unidade",current_stock:0,min_stock:5,cost_per_unit:0,expiration_date:null}),P(null)},ue=()=>{c({ingredient_id:"",quantity:1})},ie=a=>{P(a),D({name:a.name||"",unit:a.unit||"unidade",current_stock:a.current_stock||0,min_stock:a.min_stock||5,cost_per_unit:a.cost_per_unit||0,expiration_date:a.expiration_date||null}),y(!0)},he=a=>{a.preventDefault(),g?ae.mutate({id:g.id,data:N}):M.mutate(N)},W=(a,r,S)=>{p.entities.StockMovement.create({ingredient_id:a,type:r,quantity:S,created_at:new Date().toISOString()}).then(()=>{const Q=(x.find(X=>X.id===a).current_stock||0)+S;p.entities.Ingredient.update(a,{current_stock:Q}).then(()=>{v.invalidateQueries(["ingredients"]),T.success("Estoque atualizado!")})})},Y=m.useMemo(()=>B.map(a=>({...a,suggestedQuantity:(a.min_stock||5)*3,estimatedCost:(a.min_stock||5)*3*(a.cost_per_unit||0)})),[B]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Gestão de Estoque"}),e.jsx("p",{className:"text-gray-500",children:"Rastreie ingredientes e gerencie estoque"})]}),e.jsxs(te,{open:G,onOpenChange:y,children:[e.jsx(De,{asChild:!0,children:e.jsxs(j,{onClick:A,children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Novo Ingrediente"]})}),e.jsxs(re,{className:"sm:max-w-md max-w-[95vw]",children:[e.jsx(ne,{children:e.jsx(le,{children:g?"Editar Ingrediente":"Novo Ingrediente"})}),e.jsxs("form",{onSubmit:he,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Nome *"}),e.jsx(f,{value:N.name,onChange:a=>D(r=>({...r,name:a.target.value})),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Unidade"}),e.jsxs(V,{value:N.unit,onValueChange:a=>D(r=>({...r,unit:a})),children:[e.jsx(K,{children:e.jsx(U,{})}),e.jsxs(H,{children:[e.jsx(_,{value:"unidade",children:"Unidade"}),e.jsx(_,{value:"kg",children:"Quilograma"}),e.jsx(_,{value:"g",children:"Grama"}),e.jsx(_,{value:"l",children:"Litro"}),e.jsx(_,{value:"ml",children:"Mililitro"})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Estoque Atual"}),e.jsx(f,{type:"number",value:N.current_stock,onChange:a=>D(r=>({...r,current_stock:parseFloat(a.target.value)||0})),min:"0"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Estoque Mínimo"}),e.jsx(f,{type:"number",value:N.min_stock,onChange:a=>D(r=>({...r,min_stock:parseFloat(a.target.value)||5})),min:"0"})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Custo por Unidade (R$)"}),e.jsx(f,{type:"number",step:"0.01",value:N.cost_per_unit,onChange:a=>D(r=>({...r,cost_per_unit:parseFloat(a.target.value)||0})),min:"0"})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>y(!1),children:"Cancelar"}),e.jsx(j,{type:"submit",children:g?"Atualizar":"Criar"})]})]})]})]})]}),B.length>0&&e.jsxs(w,{className:"border-red-200 bg-red-50",children:[e.jsx(q,{children:e.jsxs(E,{className:"flex items-center gap-2 text-red-700",children:[e.jsx(we,{className:"w-5 h-5"}),"Alertas de Estoque Baixo"]})}),e.jsx(I,{children:e.jsx("div",{className:"space-y-2",children:B.map(a=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-white rounded",children:[e.jsxs("div",{children:[e.jsx("strong",{children:a.name}),e.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["Estoque: ",a.current_stock," ",a.unit," (Mínimo: ",a.min_stock,")"]})]}),e.jsxs(j,{size:"sm",onClick:()=>W(a.id,"entry",a.min_stock*3),children:[e.jsx(Ne,{className:"w-4 h-4 mr-1"}),"Comprar"]})]},a.id))})})]}),Y.length>0&&e.jsxs(w,{children:[e.jsx(q,{children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5"}),"Sugestões de Compra"]})}),e.jsx(I,{children:e.jsxs(ce,{children:[e.jsx(de,{children:e.jsxs(O,{children:[e.jsx(u,{children:"Ingrediente"}),e.jsx(u,{children:"Quantidade Sugerida"}),e.jsx(u,{children:"Custo Estimado"}),e.jsx(u,{children:"Ação"})]})}),e.jsx(oe,{children:Y.map(a=>e.jsxs(O,{children:[e.jsx(h,{children:a.name}),e.jsxs(h,{children:[a.suggestedQuantity," ",a.unit]}),e.jsxs(h,{children:["R$ ",a.estimatedCost.toFixed(2)]}),e.jsx(h,{children:e.jsx(j,{size:"sm",onClick:()=>W(a.id,"entry",a.suggestedQuantity),children:"Adicionar ao Estoque"})})]},a.id))})]})})]}),e.jsxs(w,{children:[e.jsx(q,{children:e.jsx(E,{children:"Ingredientes"})}),e.jsx(I,{children:e.jsxs(ce,{children:[e.jsx(de,{children:e.jsxs(O,{children:[e.jsx(u,{children:"Nome"}),e.jsx(u,{children:"Estoque"}),e.jsx(u,{children:"Mínimo"}),e.jsx(u,{children:"Status"}),e.jsx(u,{children:"Ações"})]})}),e.jsx(oe,{children:x.map(a=>{const r=d[a.id];return e.jsxs(O,{children:[e.jsx(h,{children:a.name}),e.jsxs(h,{children:[a.current_stock||0," ",a.unit]}),e.jsxs(h,{children:[a.min_stock||5," ",a.unit]}),e.jsx(h,{children:r?.lowStock?e.jsx(L,{variant:"destructive",children:"Estoque Baixo"}):e.jsx(L,{variant:"default",children:"OK"})}),e.jsx(h,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{size:"sm",variant:"outline",onClick:()=>ie(a),children:e.jsx(Me,{className:"w-4 h-4"})}),e.jsx(j,{size:"sm",variant:"outline",onClick:()=>W(a.id,"entry",10),children:"+10"})]})})]},a.id)})})]})})]}),e.jsxs(w,{children:[e.jsx(q,{children:e.jsx(E,{children:"Ingredientes por Prato"})}),e.jsx(I,{children:e.jsx("div",{className:"space-y-4",children:b.map(a=>{const r=l.filter(S=>S.dish_id===a.id);return e.jsxs("div",{className:"border rounded p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("strong",{children:a.name}),e.jsxs(j,{size:"sm",onClick:()=>{J(a),C(!0)},children:[e.jsx(me,{className:"w-4 h-4 mr-1"}),"Adicionar Ingrediente"]})]}),r.length>0?e.jsx("ul",{className:"list-disc list-inside space-y-1",children:r.map(S=>{const k=x.find(Q=>Q.id===S.ingredient_id);return k?e.jsxs("li",{children:[k.name," - ",S.quantity," ",k.unit,d[k.id]?.lowStock&&e.jsx(L,{variant:"destructive",className:"ml-2",children:"Estoque Baixo"})]},S.id):null})}):e.jsx("p",{className:"text-gray-500 text-sm",children:"Nenhum ingrediente cadastrado"})]},a.id)})})})]}),e.jsx(te,{open:z,onOpenChange:C,children:e.jsxs(re,{children:[e.jsx(ne,{children:e.jsxs(le,{children:["Adicionar Ingrediente - ",F?.name]})}),e.jsxs("form",{onSubmit:a=>{a.preventDefault(),Z.mutate(i)},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Ingrediente"}),e.jsxs(V,{value:i.ingredient_id,onValueChange:a=>c(r=>({...r,ingredient_id:a})),children:[e.jsx(K,{children:e.jsx(U,{placeholder:"Selecione um ingrediente"})}),e.jsx(H,{children:x.map(a=>e.jsxs(_,{value:a.id,children:[a.name," (",a.unit,")"]},a.id))})]})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Quantidade"}),e.jsx(f,{type:"number",value:i.quantity,onChange:a=>c(r=>({...r,quantity:parseFloat(a.target.value)||1})),min:"0.01",step:"0.01"})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>C(!1),children:"Cancelar"}),e.jsx(j,{type:"submit",children:"Adicionar"})]})]})]})})]})}function bs(){const v=fe(),{menuContext:n}=ve(),G=()=>{const i=localStorage.getItem("affiliateSettings");if(i)try{return JSON.parse(i)}catch{}return{referrerBonus:20,referredBonus:10,commissionRate:10,minPayout:50}},[y,z]=m.useState(G()),{data:C=[]}=se({queryKey:["affiliates",n?.type,n?.value],queryFn:async()=>{if(!n)return[];const i={};return n.type==="subscriber"&&n.value&&(i.as_subscriber=n.value),p.entities.Affiliate.list(null,i)},enabled:!!n}),{data:g=[]}=se({queryKey:["referrals",n?.type,n?.value],queryFn:async()=>{if(!n)return[];const i={};return n.type==="subscriber"&&n.value&&(i.as_subscriber=n.value),p.entities.Referral.list(null,i)},enabled:!!n}),{data:P=[]}=Te({orderBy:"-created_date"}),F={totalAffiliates:C.length,totalReferrals:g.length,activeReferrals:g.filter(i=>i.status==="completed").length,totalCommissions:g.filter(i=>i.status==="completed").reduce((i,c)=>i+(c.commission||0),0),pendingPayouts:g.filter(i=>i.status==="completed"&&!i.paid).reduce((i,c)=>i+(c.commission||0),0)},J=R({mutationFn:async i=>(localStorage.setItem("affiliateSettings",JSON.stringify(i)),{success:!0,settings:i}),onSuccess:()=>{v.invalidateQueries(["affiliateSettings"]),T.success("Configurações atualizadas!")}}),N=i=>{const c=window.location.origin,x=localStorage.getItem("currentSlug")||"";return`${c}/cardapio?ref=${i}${x?`&slug=${x}`:""}`},D=i=>{navigator.clipboard.writeText(i),T.success("Link copiado!")};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Programa de Afiliados"}),e.jsx("p",{className:"text-gray-500",children:"Gerencie indicações e comissões"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(w,{children:[e.jsx(q,{className:"pb-2",children:e.jsxs(E,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ze,{className:"w-4 h-4 text-blue-500"}),"Total de Afiliados"]})}),e.jsx(I,{children:e.jsx("div",{className:"text-2xl font-bold",children:F.totalAffiliates})})]}),e.jsxs(w,{children:[e.jsx(q,{className:"pb-2",children:e.jsxs(E,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-green-500"}),"Indicações Ativas"]})}),e.jsxs(I,{children:[e.jsx("div",{className:"text-2xl font-bold",children:F.activeReferrals}),e.jsxs("p",{className:"text-xs text-gray-500",children:[F.totalReferrals," total"]})]})]}),e.jsxs(w,{children:[e.jsx(q,{className:"pb-2",children:e.jsxs(E,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4 text-yellow-500"}),"Comissões Totais"]})}),e.jsx(I,{children:e.jsxs("div",{className:"text-2xl font-bold",children:["R$ ",F.totalCommissions.toFixed(2)]})})]}),e.jsxs(w,{children:[e.jsx(q,{className:"pb-2",children:e.jsxs(E,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4 text-orange-500"}),"Pendentes"]})}),e.jsx(I,{children:e.jsxs("div",{className:"text-2xl font-bold",children:["R$ ",F.pendingPayouts.toFixed(2)]})})]})]}),e.jsxs(Ae,{defaultValue:"affiliates",className:"space-y-4",children:[e.jsxs(Re,{children:[e.jsx(je,{value:"affiliates",children:"Afiliados"}),e.jsx(je,{value:"referrals",children:"Indicações"}),e.jsx(je,{value:"settings",children:"Configurações"})]}),e.jsx(ge,{value:"affiliates",children:e.jsxs(w,{children:[e.jsx(q,{children:e.jsx(E,{children:"Afiliados Cadastrados"})}),e.jsx(I,{children:e.jsxs(ce,{children:[e.jsx(de,{children:e.jsxs(O,{children:[e.jsx(u,{children:"Nome"}),e.jsx(u,{children:"Email"}),e.jsx(u,{children:"Link de Indicação"}),e.jsx(u,{children:"Indicações"}),e.jsx(u,{children:"Comissões"}),e.jsx(u,{children:"Status"})]})}),e.jsx(oe,{children:C.map(i=>{const c=g.filter(l=>l.affiliate_id===i.id),x=c.filter(l=>l.status==="completed").reduce((l,d)=>l+(d.commission||0),0),b=N(i.id);return e.jsxs(O,{children:[e.jsx(h,{children:i.name||i.email}),e.jsx(h,{children:i.email}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{value:b,readOnly:!0,className:"w-64 text-xs"}),e.jsx(j,{size:"sm",variant:"outline",onClick:()=>D(b),children:e.jsx(Qe,{className:"w-4 h-4"})})]})}),e.jsx(h,{children:c.length}),e.jsxs(h,{children:["R$ ",x.toFixed(2)]}),e.jsx(h,{children:e.jsx(L,{variant:i.status==="active"?"default":"secondary",children:i.status==="active"?"Ativo":"Inativo"})})]},i.id)})})]})})]})}),e.jsx(ge,{value:"referrals",children:e.jsxs(w,{children:[e.jsx(q,{children:e.jsx(E,{children:"Indicações e Comissões"})}),e.jsx(I,{children:e.jsxs(ce,{children:[e.jsx(de,{children:e.jsxs(O,{children:[e.jsx(u,{children:"Afiliado"}),e.jsx(u,{children:"Cliente Indicado"}),e.jsx(u,{children:"Pedido"}),e.jsx(u,{children:"Valor"}),e.jsx(u,{children:"Comissão"}),e.jsx(u,{children:"Status"})]})}),e.jsx(oe,{children:g.map(i=>{const c=P.find(b=>b.id===i.order_id),x=C.find(b=>b.id===i.affiliate_id);return e.jsxs(O,{children:[e.jsx(h,{children:x?.name||x?.email||"N/A"}),e.jsx(h,{children:i.referred_email||i.referred_name||"N/A"}),e.jsxs(h,{children:["#",c?.order_code||i.order_id]}),e.jsxs(h,{children:["R$ ",c?.total?.toFixed(2)||"0,00"]}),e.jsxs(h,{children:["R$ ",i.commission?.toFixed(2)||"0,00"]}),e.jsx(h,{children:e.jsx(L,{variant:i.status==="completed"?"default":i.status==="pending"?"secondary":"destructive",children:i.status==="completed"?"Concluído":i.status==="pending"?"Pendente":"Cancelado"})})]},i.id)})})]})})]})}),e.jsx(ge,{value:"settings",children:e.jsxs(w,{children:[e.jsx(q,{children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"w-5 h-5"}),"Configurações do Programa"]})}),e.jsxs(I,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Bônus para Quem Indica (%)"}),e.jsx(f,{type:"number",value:y.referrerBonus,onChange:i=>z(c=>({...c,referrerBonus:parseFloat(i.target.value)||0}))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Desconto no próximo pedido"})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Bônus para Indicado (R$)"}),e.jsx(f,{type:"number",value:y.referredBonus,onChange:i=>z(c=>({...c,referredBonus:parseFloat(i.target.value)||0}))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Desconto na primeira compra"})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Taxa de Comissão (%)"}),e.jsx(f,{type:"number",value:y.commissionRate,onChange:i=>z(c=>({...c,commissionRate:parseFloat(i.target.value)||0}))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"% sobre cada venda"})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Valor Mínimo para Saque (R$)"}),e.jsx(f,{type:"number",value:y.minPayout,onChange:i=>z(c=>({...c,minPayout:parseFloat(i.target.value)||0}))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Mínimo para solicitar pagamento"})]})]}),e.jsx(j,{onClick:()=>J.mutate(y),disabled:J.isLoading,children:"Salvar Configurações"})]})]})})]})]})}export{bs as A,Ns as B,_s as I};
