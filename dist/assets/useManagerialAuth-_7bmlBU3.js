import{c as w,r as s,j as a,B as C,L,g as v,z as I}from"./main-AonIQAES.js";import{u as E}from"./useQuery-1B__UZCp.js";import{u as M}from"./usePermission-CVnsvsYp.js";import{D as z,a as A,b as D,c as F,e as P}from"./dialog-LI6mGNSb.js";import{L as N,I as _}from"./input-BZMCG3xh.js";import{C as V}from"./circle-alert-BolcJOSC.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],K=w("Key",q);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]],J=w("Printer",T);function B({open:t,onOpenChange:f,title:c="Confirmação necessária",description:j="Informe sua matrícula e senha para autorizar esta ação.",onValidate:g,actionLabel:i="Validar"}){const[n,p]=s.useState(""),[u,h]=s.useState(""),[d,o]=s.useState(""),[l,x]=s.useState(!1),m=e=>{e||(p(""),h(""),o("")),f(e)},y=async e=>{if(e.preventDefault(),o(""),!n.trim()||!u){o("Preencha matrícula e senha.");return}x(!0);try{await g({matricula:n.trim(),password:u})?m(!1):o("Matrícula ou senha incorretos. Tente novamente.")}catch(r){o(r?.message||"Erro ao validar. Tente novamente.")}finally{x(!1)}};return a.jsx(z,{open:t,onOpenChange:m,children:a.jsxs(A,{className:"sm:max-w-md",children:[a.jsx(D,{children:a.jsxs(F,{className:"flex items-center gap-2",children:[a.jsx(K,{className:"w-5 h-5 text-orange-500"}),c]})}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:j}),a.jsxs("form",{onSubmit:y,className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(N,{htmlFor:"ma-matricula",children:"Código de matrícula"}),a.jsx(_,{id:"ma-matricula",value:n,onChange:e=>p(e.target.value),placeholder:"Ex.: 001",autoComplete:"off",disabled:l})]}),a.jsxs("div",{children:[a.jsx(N,{htmlFor:"ma-password",children:"Senha"}),a.jsx(_,{id:"ma-password",type:"password",value:u,onChange:e=>h(e.target.value),placeholder:"••••••••",autoComplete:"off",disabled:l})]}),d&&a.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/20 rounded-lg p-2",children:[a.jsx(V,{className:"w-4 h-4 flex-shrink-0"}),d]}),a.jsxs(P,{className:"gap-2 sm:gap-0",children:[a.jsx(C,{type:"button",variant:"outline",onClick:()=>m(!1),disabled:l,children:"Cancelar"}),a.jsxs(C,{type:"submit",disabled:l,children:[l?a.jsx(L,{className:"w-4 h-4 animate-spin mr-2"}):null,i]})]})]})]})})}const k={abrir_caixa:{title:"Abrir caixa",description:"Informe sua matrícula e senha para abrir o caixa."},fechar_caixa:{title:"Fechar caixa",description:"Informe sua matrícula e senha para fechar o caixa."},sangria:{title:"Sangria (retirada)",description:"Informe sua matrícula e senha para realizar retirada do caixa."},suprimento:{title:"Suprimento (adicionar troco)",description:"Informe sua matrícula e senha para adicionar troco ao caixa."},editar:{title:"Editar",description:"Informe sua matrícula e senha para confirmar a edição."},duplicar:{title:"Duplicar",description:"Informe sua matrícula e senha para duplicar."},excluir:{title:"Excluir",description:"Informe sua matrícula e senha para confirmar a exclusão."},importar:{title:"Importar",description:"Informe sua matrícula e senha para importar dados."},exportar:{title:"Exportar",description:"Informe sua matrícula e senha para exportar dados."},funcoes_financeiras:{title:"Funções financeiras",description:"Informe sua matrícula e senha para esta ação."},default:{title:"Confirmação necessária",description:"Informe sua matrícula e senha para autorizar esta ação."}};function U(){const{user:t,menuContext:f}=M(),c=f?.type==="subscriber"?f.value:t?.subscriber_email||t?.email,g=(t?.profile_roles?.length?t.profile_roles:t?.profile_role?[t.profile_role]:[]).includes("gerente"),i=!!t?.is_master,n=s.useRef(null),[p,u]=s.useState({open:!1,actionName:"default"}),{data:h}=E({queryKey:["managerial-auth",c],queryFn:()=>v.get("/managerial-auth",c?{as_subscriber:c}:{}),enabled:!!c&&!i}),d=i?!0:g?!!h?.gerente?.configured:!!h?.assinante?.configured,o=s.useCallback(async({matricula:e,password:r})=>!!(await v.post("/managerial-auth/validate",{matricula:e,password:r}))?.valid,[]),l=s.useCallback((e,r)=>{if(i){r?.();return}if(!d){I.error("Configure a autorização gerencial em Sistema > Autorização gerencial para usar esta ação.");return}n.current=typeof r=="function"?r:null,u({open:!0,actionName:e||"default"})},[d,i]),x=async e=>{const r=await o(e),b=n.current;if(r&&b){n.current=null;try{b()}catch(S){I.error(S?.message||"Erro ao executar a ação.")}}return r},m=k[p.actionName]||k.default,y=a.jsx(B,{open:p.open,onOpenChange:e=>u(r=>({...r,open:e})),title:m.title,description:m.description,onValidate:x,actionLabel:"Validar"});return{requireAuthorization:l,configured:d,isMaster:i,modal:y}}export{K,J as P,U as u};
