import{c as es,r as N,j as e,a as me,b as ra,T as Ye,X as $e,L as ue,B as f,A as Cs,u as Ls,P as qs,z as k,d as Ss,e as us,l as C,R as ns,_ as ia,f as na,g as je}from"./main-BRmc9wuQ.js";import{u as os}from"./useQuery-DECqmSjD.js";import{u as ls}from"./useMutation-7mrcm5kq.js";import{u as la}from"./useDebounce-BgzXfq22.js";import{L as R,I as F}from"./input-BSSWZZVM.js";import{B as L}from"./badge-0XfQUglg.js";import{D as ve,a as fe,b as ye,c as Ne,d as $s,e as Ze}from"./dialog-DJhUD2H1.js";import{S as ne,a as le,b as oe,c as ce,d as M}from"./select-VIQuVK7X.js";import{t as Te,D as Vs,a as Is,b as Gs,c as he,d as ks}from"./index-BKuSiZNQ.js";import{A as oa,a as ca,b as da,c as ma,d as xa,e as pa,f as ua,g as ha}from"./alert-dialog-WT2FZKvg.js";import{U as ga,P as ja,C as Bs,a as Xe,I as va,G as fa,b as Ge,c as ya,R as Na,F as Us,E as ba,d as wa,e as _a,T as Ca,f as Be,g as Ue,h as Qe,L as As}from"./EmptyState-DgqMtCRe.js";import{U as Sa}from"./UserAuthButton-aEHoGetV.js";import{b as J}from"./base44Client-DNwoQjfp.js";import{v as ka,g as Oe}from"./PlanPresets-fSTeTi4m.js";import{C as xe,a as He,b as Je,c as Ke}from"./card-Ctp-7rs8.js";import{C as bs}from"./circle-check-CbUoTSmp.js";import{C as Aa}from"./circle-x-BoXIGvxl.js";import{C as qe}from"./check-B8wFGgpR.js";import{C as Ea}from"./index-Deio2Puc.js";import{C as Pa}from"./chevron-down-Br9th1QV.js";import{T as Da,a as Ta,b as Se,c as ke}from"./tabs-854nsuxe.js";import{T as js}from"./textarea-BVLzEUED.js";import{S as Ae}from"./switch-gnnivmk-.js";import{C as Oa}from"./circle-check-big-BgD3Vilh.js";import{A as Qs}from"./arrow-left-CctukX1s.js";import{D as ws}from"./download-BLDsYadX.js";import{S as za}from"./shopping-cart-DFfB9Dsc.js";import{D as Hs}from"./dollar-sign-Cy_CReDz.js";import{C as Js}from"./clock-BVnf5BSk.js";import{G as Ma}from"./gift-BmjwTkQk.js";import{P as Ee}from"./plus-DSv6Z-VR.js";import{T as ze}from"./trash-2-BCVOf2oN.js";import{d as Fa,S as Es}from"./differenceInCalendarDays-m29H_lYP.js";import{t as vs}from"./constants-CG7Neo-X.js";import{C as cs}from"./circle-alert-BZWE3mVm.js";import{C as fs}from"./calendar-C_CZG2Mr.js";import{P as Ra,a as La,b as qa}from"./popover-dlYatlIR.js";import{F as $a}from"./filter-B-ySBKey.js";import{C as Ks,f as Va}from"./dateUtils-BbzTuuJw.js";import{U as ys}from"./users-DLm2_Fp1.js";import{T as Ia}from"./trending-up-DfwTY8KU.js";import{T as Ga}from"./ThemeToggle-Ipxhq542.js";import{m as Le}from"./proxy-UArsdzLI.js";import{C as Ba}from"./chart-column-AYplkH9h.js";import{S as Ua}from"./search-BzcCetuR.js";import{M as Qa}from"./mail-BNh_3Nbk.js";import{P as hs}from"./phone-BNGqqYl8.js";import{C as Ha}from"./chevron-left-dEb2H1jL.js";import{C as Ja}from"./chevron-right-nMC1nZWH.js";import{C as We}from"./circle-help-wMU4n52T.js";import"./index-DtU2aqBA.js";import"./index-Cj8IEuVO.js";import"./index-Us3IJkK4.js";import"./index-Clzu_iyV.js";import"./index-Crj2I8cN.js";import"./log-in-V4EDTWPP.js";import"./user-DROTyYEO.js";import"./power-CSJOf1Dk.js";import"./sun-DyPTta9R.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ka=[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]],Ps=es("Building2",Ka);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]],Ya=es("FileJson",Wa);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Za=[["path",{d:"M21 10.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.5",key:"1uzm8b"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Ws=es("SquareCheckBig",Za);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xa=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],Ys=es("Square",Xa);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],Ds=es("Tag",et);function st(r){return N.useMemo(()=>{if(!r||typeof r!="object")return{totalModules:0,activeModules:0,totalPermissions:0,permissionsByModule:{},hasPermission:()=>!1};const x={};let d=0,c=0;Object.entries(r).forEach(([m,j])=>{Array.isArray(j)&&j.length>0?(c++,d+=j.length,x[m]={count:j.length,actions:j}):x[m]={count:0,actions:[]}});const g=(m,j)=>{const p=x[m];return!!(p&&Array.isArray(p.actions)&&p.actions.includes(j))};return{totalModules:Object.keys(r).length,activeModules:c,totalPermissions:d,permissionsByModule:x,hasPermission:g}},[r])}const at=ra("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Me=N.forwardRef(({className:r,variant:l,...x},d)=>e.jsx("div",{ref:d,role:"alert",className:me(at({variant:l}),r),...x}));Me.displayName="Alert";const tt=N.forwardRef(({className:r,...l},x)=>e.jsx("h5",{ref:x,className:me("mb-1 font-medium leading-none tracking-tight",r),...l}));tt.displayName="AlertTitle";const Fe=N.forwardRef(({className:r,...l},x)=>e.jsx("div",{ref:x,className:me("text-sm [&_p]:leading-relaxed",r),...l}));Fe.displayName="AlertDescription";const Ts={dashboard:"Dashboard",pdv:"PDV",gestor_pedidos:"Gestor de Pedidos",caixa:"Caixa",whatsapp:"WhatsApp",dishes:"Pratos",pizza_config:"Pizzas",delivery_zones:"Zonas de Entrega",coupons:"Cupons",promotions:"Promo√ß√µes",theme:"Tema",store:"Loja",payments:"Pagamentos",graficos:"Gr√°ficos",orders:"Pedidos",history:"Hist√≥rico",clients:"Clientes",financial:"Financeiro",printer:"Impressora",mais:"Mais Fun√ß√µes"},rt={view:"Ver",create:"Criar",update:"Editar",delete:"Excluir"};function it({permissions:r={}}){const l={totalModules:Object.keys(r).length,activeModules:Object.keys(r).filter(c=>r[c]&&Array.isArray(r[c])&&r[c].length>0).length,totalPermissions:Object.values(r).reduce((c,g)=>c+(Array.isArray(g)?g.length:0),0),viewOnly:Object.entries(r).filter(([c,g])=>Array.isArray(g)&&g.length===1&&g.includes("view")).length},x=Object.entries(r).filter(([c,g])=>Array.isArray(g)&&g.length>0).map(([c,g])=>({moduleId:c,moduleName:Ts[c]||c,actions:g||[]})),d=Object.entries(r).filter(([c,g])=>!Array.isArray(g)||g.length===0).map(([c])=>({moduleId:c,moduleName:Ts[c]||c}));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(xe,{className:"p-4 bg-gradient-to-br from-blue-50 to-purple-50 border-blue-200",children:[e.jsx("h4",{className:"font-semibold text-sm mb-3 flex items-center gap-2",children:"üìä Resumo das Permiss√µes"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:l.activeModules}),e.jsx("div",{className:"text-xs text-gray-600",children:"M√≥dulos Ativos"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:l.totalPermissions}),e.jsx("div",{className:"text-xs text-gray-600",children:"Permiss√µes"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:l.viewOnly}),e.jsx("div",{className:"text-xs text-gray-600",children:"Somente Leitura"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:l.totalModules-l.activeModules}),e.jsx("div",{className:"text-xs text-gray-600",children:"Bloqueados"})]})]})]}),x.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-sm mb-2 flex items-center gap-2",children:[e.jsx(bs,{className:"w-4 h-4 text-green-600"}),"M√≥dulos Acess√≠veis (",x.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:x.map(({moduleId:c,moduleName:g,actions:m})=>e.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-sm text-gray-900",children:g}),e.jsxs(L,{variant:"outline",className:"bg-green-100 text-green-700 border-green-300 text-xs",children:[m.length," permiss√£o",m.length>1?"√µes":""]})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:m.map(j=>e.jsx(L,{variant:"secondary",className:"text-xs bg-green-200 text-green-800",children:rt[j]||j},j))})]},c))})]}),d.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-sm mb-2 flex items-center gap-2",children:[e.jsx(Aa,{className:"w-4 h-4 text-red-600"}),"M√≥dulos Bloqueados (",d.length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:d.map(({moduleId:c,moduleName:g})=>e.jsx(L,{variant:"outline",className:"bg-red-50 text-red-700 border-red-200 text-xs",children:g},c))})]}),l.totalPermissions===0&&e.jsxs(Me,{variant:"destructive",children:[e.jsx(Ye,{className:"h-4 w-4"}),e.jsx(Fe,{className:"text-sm",children:"‚ö†Ô∏è Nenhuma permiss√£o configurada! O assinante n√£o ter√° acesso a nenhum m√≥dulo."})]}),l.viewOnly===l.activeModules&&l.activeModules>0&&e.jsxs(Me,{children:[e.jsx(Ye,{className:"h-4 w-4"}),e.jsx(Fe,{className:"text-sm",children:"‚ÑπÔ∏è Todas as permiss√µes s√£o somente leitura. O assinante poder√° visualizar mas n√£o modificar dados."})]})]})}function nt({plans:r=[],currentPlan:l,onSelectPlan:x}){if(r.length<2)return null;const d=[{id:"dashboard",label:"Dashboard",icon:"üìä"},{id:"dishes",label:"Pratos",icon:"üçΩÔ∏è"},{id:"pizza_config",label:"Pizzas",icon:"üçï"},{id:"store",label:"Loja",icon:"üè™"},{id:"orders",label:"Pedidos",icon:"üì¶"},{id:"gestor_pedidos",label:"Gestor Completo",icon:"üöö"},{id:"delivery_zones",label:"Zonas de Entrega",icon:"üìç"},{id:"coupons",label:"Cupons",icon:"üéüÔ∏è"},{id:"promotions",label:"Promo√ß√µes",icon:"üéØ"},{id:"graficos",label:"Relat√≥rios",icon:"üìà"},{id:"financial",label:"Financeiro",icon:"üí∞"},{id:"whatsapp",label:"WhatsApp",icon:"üí¨"}],c=(m,j)=>{const v=(m.permissions||{})[j]||[];return v.length===0?"none":v.length===1&&v[0]==="view"?"view":v.includes("create")||v.includes("update")?"full":"limited"},g=(m,j)=>{switch(c(m,j)){case"none":return e.jsx($e,{className:"w-4 h-4 text-gray-300"});case"view":return e.jsx(L,{variant:"outline",className:"text-xs bg-gray-100",children:"Ver"});case"limited":return e.jsx(L,{variant:"outline",className:"text-xs bg-blue-100",children:"Limitado"});case"full":return e.jsx(qe,{className:"w-4 h-4 text-green-600"});default:return e.jsx($e,{className:"w-4 h-4 text-gray-300"})}};return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(xe,{className:"p-4",children:[e.jsx("h4",{className:"font-semibold text-lg mb-4",children:"Compara√ß√£o de Planos"}),e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2 text-sm font-medium text-gray-700",children:"Recurso"}),r.map(m=>e.jsxs("th",{className:me("text-center p-2 text-sm font-medium cursor-pointer transition-colors",l===m.slug?"bg-blue-100 text-blue-900":"hover:bg-gray-50"),onClick:()=>x?.(m.slug),children:[m.name,l===m.slug&&e.jsx(L,{variant:"secondary",className:"ml-2 text-xs",children:"Atual"})]},m.slug))]})}),e.jsx("tbody",{children:d.map(m=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsxs("td",{className:"p-2 text-sm",children:[e.jsx("span",{className:"mr-2",children:m.icon}),m.label]}),r.map(j=>e.jsx("td",{className:"text-center p-2",children:g(j,m.id)},j.slug))]},m.id))})]})]})})}const Os=[{id:"gestao",name:"üìä GEST√ÉO",modules:[{id:"dashboard",name:"Dashboard",actions:["view"]},{id:"financial",name:"Financeiro",actions:["view"]},{id:"caixa",name:"Caixa",actions:["view","create","update"]},{id:"pdv",name:"PDV",actions:["view","create","update"]},{id:"gestor_pedidos",name:"Gestor de Pedidos",actions:["view","create","update","delete"]}]},{id:"operacao",name:"üßæ OPERA√á√ÉO",modules:[{id:"orders",name:"Gestor de Pedidos (lista)",actions:["view","create","update","delete"]},{id:"history",name:"Hist√≥rico de Pedidos",actions:["view"]},{id:"clients",name:"Clientes",actions:["view","create","update","delete"]},{id:"whatsapp",name:"WhatsApp",actions:["view"]},{id:"inventory",name:"Gest√£o de Estoque",actions:["view","create","update","delete"]}]},{id:"cardapio",name:"üçΩÔ∏è CARD√ÅPIO",modules:[{id:"dishes",name:"Restaurante (pratos e bebidas)",actions:["view","create","update","delete"]},{id:"pizza_config",name:"Pizzaria",actions:["view","create","update","delete"]},{id:"theme",name:"Tema",actions:["view","update"]},{id:"store",name:"Loja",actions:["view","update"]}]},{id:"garcom",name:"üßë‚Äçüç≥ GAR√áOM",modules:[{id:"garcom",name:"App do Gar√ßom",actions:["view"]},{id:"comandas",name:"Comandas",actions:["view","create","update","close","history"]},{id:"tables",name:"Mesas e QR Code",actions:["view","create","update","delete"]}]},{id:"delivery",name:"üöö DELIVERY",modules:[{id:"delivery_zones",name:"Zonas de Entrega",actions:["view","create","update","delete"]},{id:"payments",name:"M√©todos de Pagamento",actions:["view","update"]}]},{id:"sistema",name:"‚öôÔ∏è SISTEMA",modules:[{id:"printer",name:"Impressora",actions:["view","update"]},{id:"colaboradores",name:"Colaboradores",actions:["view","create","update","delete"]},{id:"2fa",name:"Autentica√ß√£o 2FA",actions:["view","update"]},{id:"lgpd",name:"Conformidade LGPD",actions:["view","update"]}]},{id:"marketing",name:"üí∞ MARKETING",modules:[{id:"promotions",name:"Promo√ß√µes",actions:["view","create","update","delete"]},{id:"coupons",name:"Cupons",actions:["view","create","update","delete"]},{id:"affiliates",name:"Programa de Afiliados",actions:["view","create","update","delete"]}]},{id:"graficos_section",name:"Gr√°ficos",modules:[{id:"graficos",name:"Gr√°ficos",actions:["view"]}]},{id:"mais_funcoes",name:"Mais Fun√ß√µes",modules:[{id:"mais",name:"Mais Fun√ß√µes",actions:["view"]}]}],lt={view:"Ver",create:"Criar",update:"Editar",delete:"Excluir"};function zs({permissions:r,onChange:l,selectedPlan:x="basic",onPlanChange:d}){const[c,g]=N.useState(new Set(["gestao","operacao","cardapio","garcom","delivery","sistema","marketing"])),[m,j]=N.useState(new Set(["dashboard","dishes","orders","inventory","garcom","tables","affiliates"])),[p,v]=N.useState(!1),[E,B]=N.useState(!1),h=[{id:"free",slug:"free",name:"Gratuito",description:"Plano gratuito para uso pessoal",is_active:!0,order:0},{id:"basic",slug:"basic",name:"B√°sico",description:"Plano b√°sico com funcionalidades essenciais",is_active:!0,order:1},{id:"pro",slug:"pro",name:"Pro",description:"Plano profissional com recursos avan√ßados",is_active:!0,order:2},{id:"ultra",slug:"ultra",name:"Ultra",description:"Plano ultra com todos os recursos",is_active:!0,order:3}],{data:t=h,isLoading:y}=os({queryKey:["plans"],queryFn:async()=>{try{const _=await J.entities.Plan.list("order"),P=Array.isArray(_)?_.filter(D=>D.is_active!==!1):[];return console.log("üìã Planos carregados do banco:",P.length,P),P.length===0?(console.log("‚ö†Ô∏è Nenhum plano no banco, retornando planos padr√£o (PermissionsEditor)"),h):P}catch(_){return console.error("‚ùå Erro ao carregar planos:",_),h}},initialData:h,retry:1,staleTime:300*1e3}),T=x||"basic",S=N.useMemo(()=>{const _=t.find(P=>P.slug===T);return console.log("üîç PermissionsEditor - selectedPlanData:",_,"currentPlan:",T,"plans:",t),_},[t,T]),w=N.useMemo(()=>{if(T==="custom")return"Personalizado";const _=S?.name||T.charAt(0).toUpperCase()+T.slice(1);return console.log("üè∑Ô∏è PermissionsEditor - displayName:",_,"currentPlan:",T),_},[T,S]),V=ka(r),K=(r?.pizza_config?.length||0)>0?"pizzas":"pratos",W=_=>{if(d&&d(_),_==="custom")return;const P={...Oe(_)||{},store:["view","update"]};l(P)},ae=_=>{const P={...r,store:r?.store?.length?r.store:["view","update"]};_==="pizzas"?(P.pizza_config=["view","create","update","delete"],P.dishes=[]):(P.pizza_config=[],P.dishes=["view","create","update","delete"]),l(P)},te=_=>{g(P=>{const D=new Set(P);return D.has(_)?D.delete(_):D.add(_),D})},be=_=>{j(P=>{const D=new Set(P);return D.has(_)?D.delete(_):D.add(_),D})},ie=_=>{const P=Os.find(z=>z.id===_);if(!P)return;const D=P.modules.map(z=>z.id),G=D.some(z=>r?.[z]?.length>0),$={...r};G?D.forEach(z=>{$[z]=[]}):P.modules.forEach(z=>{$[z.id]=[...z.actions]}),l($)},re=(_,P)=>{const D=r?.[_]||[],G=P.every(z=>D.includes(z)),$={...r};G?$[_]=[]:$[_]=[...P],l($)},we=(_,P,D)=>{const G={...r},$=G[_]||[];D?$.includes(P)||(G[_]=[...$,P]):G[_]=$.filter(z=>z!==P),l(G)},ge=st(r),de=(_,P)=>ge.hasPermission(_,P);return y?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(ue,{className:"w-6 h-6 animate-spin text-orange-500"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{className:"mb-1 block",children:"Plano"}),e.jsxs(ne,{value:T,onValueChange:W,children:[e.jsx(le,{className:"w-full",children:e.jsx(oe,{placeholder:"Selecione um plano",children:w})}),e.jsxs(ce,{children:[(t||[]).map(_=>e.jsx(M,{value:_.slug,children:_.name},_.id||_.slug)),e.jsx(M,{value:"custom",children:"Personalizado"})]})]},T)]}),T==="basic"&&e.jsxs("div",{className:"flex flex-col gap-2 p-3 rounded-lg bg-amber-50 dark:bg-amber-950/30 border border-amber-200 dark:border-amber-800",children:[e.jsx(R,{className:"text-sm font-medium",children:"Plano B√°sico: tipo de estabelecimento"}),e.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-400",children:["No plano B√°sico o card√°pio √© apenas ",e.jsx("strong",{children:"Restaurante (pratos)"})," ou ",e.jsx("strong",{children:"Pizzaria (pizzas)"}),". Nos planos Pro e Ultra os dois est√£o dispon√≠veis."]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(f,{type:"button",size:"sm",variant:K==="pratos"?"default":"outline",className:K==="pratos"?"bg-orange-500 hover:bg-orange-600":"",onClick:()=>ae("pratos"),children:[e.jsx(ga,{className:"w-4 h-4 mr-1"})," Restaurante (pratos)"]}),e.jsxs(f,{type:"button",size:"sm",variant:K==="pizzas"?"default":"outline",className:K==="pizzas"?"bg-orange-500 hover:bg-orange-600":"",onClick:()=>ae("pizzas"),children:[e.jsx(ja,{className:"w-4 h-4 mr-1"})," Pizzaria (pizzas)"]})]})]}),V.length>0&&e.jsxs(Me,{variant:"destructive",className:"py-2",children:[e.jsx(Ye,{className:"h-4 w-4"}),e.jsx(Fe,{children:e.jsx("ul",{className:"list-disc list-inside text-sm",children:V.map((_,P)=>e.jsx("li",{children:_.message},P))})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(R,{children:"M√≥dulos"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{type:"button",variant:"ghost",size:"sm",onClick:()=>B(!E),children:[E?e.jsx(Ea,{className:"w-4 h-4"}):e.jsx(Pa,{className:"w-4 h-4"})," Resumo"]}),t.length>=2&&T!=="custom"&&e.jsxs(f,{type:"button",variant:"ghost",size:"sm",onClick:()=>v(!p),children:[p?"Ocultar":"Comparar"," planos"]})]})]}),E&&e.jsx("div",{className:"mb-3 p-3 rounded-lg border bg-gray-50",children:e.jsx(it,{permissions:r})}),p&&t.length>=2&&T!=="custom"&&e.jsx("div",{className:"mb-3",children:e.jsx(nt,{plans:t.map(_=>({..._,permissions:_.permissions||Oe(_.slug)})),currentPlan:T,onSelectPlan:W})}),e.jsx("div",{className:"border rounded-lg divide-y",children:Os.map(_=>{const P=c.has(_.id);return e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer flex-1",onClick:()=>te(_.id),children:[e.jsx("span",{className:`transform transition-transform ${P?"rotate-90":""}`,children:"‚ñ∏"}),e.jsx("span",{className:"font-bold text-base",children:_.name})]}),e.jsx("button",{onClick:D=>{D.stopPropagation(),ie(_.id)},className:"px-3 py-1 rounded-lg text-sm font-medium transition-colors hover:bg-gray-100",children:_.modules.some(D=>r?.[D.id]?.length>0)?"üîì Ativo":"üîí Inativo"})]}),P&&e.jsx("div",{className:"ml-6 space-y-3 mt-3",children:_.modules.map(D=>{const G=m.has(D.id),$=r?.[D.id]||[];return e.jsxs("div",{className:"border-l-2 border-gray-200 pl-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer flex-1",onClick:z=>{z.stopPropagation(),be(D.id)},children:[e.jsx("span",{className:`transform transition-transform ${G?"rotate-90":""}`,children:"‚ñ∏"}),e.jsx("span",{className:"font-medium",children:D.name}),$.length>0&&e.jsxs(L,{variant:"outline",className:"text-xs bg-green-50 text-green-700",children:[$.length," ativa",$.length===1?"":"s"]})]}),e.jsx("button",{onClick:z=>{z.stopPropagation(),re(D.id,D.actions)},className:"px-2 py-1 rounded text-xs font-medium transition-colors hover:bg-gray-100",children:$.length===D.actions.length?"üîì":"üîí"})]}),G&&e.jsx("div",{className:"mt-3 ml-6 space-y-2",children:D.actions.map(z=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded",children:[e.jsx(Bs,{checked:!!de(D.id,z),onCheckedChange:U=>we(D.id,z,U)}),e.jsx("span",{className:"text-sm",children:lt[z]})]},z))})]},D.id)})})]},_.id)})})]})]})}function ot({isOpen:r,onClose:l,onSubmit:x,combo:d,dishes:c=[]}){const g=Array.isArray(c)?c:[],[m,j]=N.useState(d||{name:"",description:"",image:"",type:"bundle_discount",dishes:[],original_price:0,combo_price:0,discount_type:"percentage",discount_value:0,buy_quantity:3,pay_quantity:2,is_active:!0,is_highlight:!1,valid_until:""}),p=t=>{t.preventDefault(),x(m)},v=t=>{if(!g.find(S=>S.id===t))return;const T=m.dishes.find(S=>S.dish_id===t);j(T?S=>({...S,dishes:S.dishes.map(w=>w.dish_id===t?{...w,quantity:w.quantity+1}:w)}):S=>({...S,dishes:[...S.dishes,{dish_id:t,quantity:1}]})),B(m.dishes,t)},E=t=>{j(y=>({...y,dishes:y.dishes.filter(T=>T.dish_id!==t)}))},B=(t,y=null)=>{const S=(y?[...t,{dish_id:y,quantity:1}]:t).reduce((w,V)=>{const K=g.find(W=>W.id===V.dish_id);return w+(K?.price||0)*V.quantity},0);j(w=>({...w,original_price:S}))},h=t=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t||0);return e.jsx(ve,{open:r,onOpenChange:l,children:e.jsxs(fe,{className:"sm:max-w-3xl max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsx(ye,{children:e.jsx(Ne,{children:d?"Editar Combo":"Criar Combo"})}),e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(R,{children:"Nome do Combo *"}),e.jsx(F,{value:m.name,onChange:t=>j(y=>({...y,name:t.target.value})),placeholder:"Ex: Combo Executivo",required:!0})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(R,{children:"Tipo de Combo *"}),e.jsxs(ne,{value:m.type,onValueChange:t=>j(y=>({...y,type:t})),children:[e.jsx(le,{children:e.jsx(oe,{})}),e.jsxs(ce,{children:[e.jsx(M,{value:"bundle_discount",children:"üéÅ Desconto no Combo"}),e.jsx(M,{value:"buy_x_pay_y",children:"üî• Leve X Pague Y"}),e.jsx(M,{value:"percentage_off",children:"üí∞ Percentual de Desconto"}),e.jsx(M,{value:"fixed_discount",children:"üíµ Desconto Fixo"})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[m.type==="bundle_discount"&&"Junte pratos e ofere√ßa por um pre√ßo especial",m.type==="buy_x_pay_y"&&"Leve mais, pague menos (ex: Leve 3, Pague 2)",m.type==="percentage_off"&&"Desconto em % sobre o total",m.type==="fixed_discount"&&"Desconto em R$ sobre o total"]})]})]}),e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[e.jsx(R,{className:"mb-3 block",children:"Pratos do Combo *"}),e.jsxs(ne,{onValueChange:v,children:[e.jsx(le,{children:e.jsx(oe,{placeholder:"Adicionar prato ao combo"})}),e.jsx(ce,{children:g.filter(t=>t.is_active!==!1).map(t=>e.jsxs(M,{value:t.id,children:[t.name," - ",h(t.price)]},t.id))})]}),e.jsx("div",{className:"mt-3 space-y-2",children:m.dishes.map(t=>{const y=g.find(T=>T.id===t.dish_id);return y?e.jsxs("div",{className:"flex items-center justify-between bg-white p-2 rounded border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[y.image&&e.jsx("img",{src:y.image,alt:"",className:"w-10 h-10 rounded object-cover"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:y.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[h(y.price)," x ",t.quantity]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{type:"button",size:"sm",variant:"outline",onClick:()=>j(T=>({...T,dishes:T.dishes.map(S=>S.dish_id===t.dish_id?{...S,quantity:Math.max(1,S.quantity-1)}:S)})),children:"-"}),e.jsx("span",{className:"w-8 text-center",children:t.quantity}),e.jsx(f,{type:"button",size:"sm",variant:"outline",onClick:()=>j(T=>({...T,dishes:T.dishes.map(S=>S.dish_id===t.dish_id?{...S,quantity:S.quantity+1}:S)})),children:"+"}),e.jsx(f,{type:"button",size:"sm",variant:"ghost",onClick:()=>E(t.dish_id),children:e.jsx($e,{className:"w-4 h-4 text-red-500"})})]})]},t.dish_id):null})})]}),m.type==="buy_x_pay_y"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Leve (quantidade)"}),e.jsx(F,{type:"number",min:"2",value:m.buy_quantity,onChange:t=>j(y=>({...y,buy_quantity:parseInt(t.target.value)||2}))})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Pague (quantidade)"}),e.jsx(F,{type:"number",min:"1",value:m.pay_quantity,onChange:t=>j(y=>({...y,pay_quantity:parseInt(t.target.value)||1}))})]})]}),(m.type==="percentage_off"||m.type==="fixed_discount")&&e.jsxs("div",{children:[e.jsx(R,{children:"Valor do Desconto"}),e.jsx(F,{type:"number",step:"0.01",value:m.discount_value,onChange:t=>j(y=>({...y,discount_value:parseFloat(t.target.value)||0})),placeholder:m.type==="percentage_off"?"Ex: 20 (para 20%)":"Ex: 10.00"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Pre√ßo Original (autom√°tico)"}),e.jsx(F,{type:"number",step:"0.01",value:m.original_price,onChange:t=>j(y=>({...y,original_price:parseFloat(t.target.value)||0}))})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Pre√ßo do Combo *"}),e.jsx(F,{type:"number",step:"0.01",value:m.combo_price,onChange:t=>j(y=>({...y,combo_price:parseFloat(t.target.value)||0})),required:!0})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Descri√ß√£o"}),e.jsx(js,{value:m.description,onChange:t=>j(y=>({...y,description:t.target.value})),rows:2,placeholder:"Descreva o combo..."})]}),e.jsxs("div",{children:[e.jsx(R,{children:"V√°lido at√©"}),e.jsx(F,{type:"date",value:m.valid_until,onChange:t=>j(y=>({...y,valid_until:t.target.value}))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded",children:[e.jsx(R,{children:"Destacar no card√°pio"}),e.jsx(Ae,{checked:m.is_highlight,onCheckedChange:t=>j(y=>({...y,is_highlight:t}))})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(f,{type:"button",variant:"outline",onClick:l,className:"flex-1",children:"Cancelar"}),e.jsx(f,{type:"submit",className:"flex-1 bg-orange-500",children:d?"Salvar":"Criar Combo"})]})]})]})})}function ct({open:r,onOpenChange:l,onSuccess:x}){const[d,c]=N.useState(null),[g,m]=N.useState(null),[j,p]=N.useState(null),[v,E]=N.useState(!1),[B,h]=N.useState("merge"),t=S=>{S||(c(null),m(null),p(null),E(!1)),l(S)},y=async S=>{const w=S.target.files?.[0];if(w){if(!w.name.endsWith(".json")){Te.error("Arquivo inv√°lido. Selecione um arquivo .json");return}c(w),p(null),m(null);try{const V=await w.text(),K=JSON.parse(V);m(K);const W=await Cs.post("/api/subscriber-backup/validate",{backupData:K});p(W.data),W.data.valid?Te.success("Arquivo validado com sucesso!"):Te.error(W.data.error||"Arquivo de backup inv√°lido")}catch(V){Te.error("Erro ao ler arquivo: "+(V.message||"Arquivo JSON inv√°lido")),c(null),m(null)}}},T=async()=>{if(!g||!j?.valid){Te.error("Selecione um arquivo v√°lido primeiro");return}E(!0);try{const S=await Cs.post("/api/subscriber-backup/import",{backupData:g,mode:B}),{results:w}=S.data;Te.success(`Importa√ß√£o conclu√≠da! ${w.dishes.created+w.dishes.updated} pratos, ${w.categories.created+w.categories.updated} categorias.`,{duration:5e3}),x&&x(w),t(!1)}catch(S){Te.error("Erro ao importar: "+(S.response?.data?.error||S.message))}finally{E(!1)}};return e.jsx(ve,{open:r,onOpenChange:t,children:e.jsxs(fe,{className:"sm:max-w-[600px] max-w-[95vw]",children:[e.jsxs(ye,{children:[e.jsxs(Ne,{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"w-5 h-5"}),"Importar Backup"]}),e.jsx($s,{children:"Restaure seus pratos, categorias, complementos e configura√ß√µes a partir de um arquivo de backup."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"backup-file",className:"block text-sm font-medium",children:"Selecionar arquivo de backup (.json)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(f,{variant:"outline",onClick:()=>document.getElementById("backup-file").click(),className:"w-full",children:[e.jsx(Ya,{className:"w-4 h-4 mr-2"}),d?d.name:"Escolher arquivo"]}),e.jsx("input",{id:"backup-file",type:"file",accept:".json",onChange:y,className:"hidden"})]})]}),j&&e.jsxs(Me,{variant:j.valid?"default":"destructive",children:[e.jsx(Ye,{className:"w-4 h-4"}),e.jsx(Fe,{children:j.valid?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium",children:"‚úÖ Arquivo v√°lido!"}),e.jsxs("ul",{className:"text-sm space-y-1",children:[e.jsxs("li",{children:["üìÇ ",j.stats.categories," categorias"]}),e.jsxs("li",{children:["üçΩÔ∏è ",j.stats.dishes," pratos"]}),e.jsxs("li",{children:["üçî ",j.stats.complement_groups," grupos de complementos"]}),j.stats.has_store&&e.jsx("li",{children:"üè™ Configura√ß√µes da loja"})]}),j.warnings.length>0&&e.jsxs("div",{className:"mt-2 p-2 bg-yellow-50 dark:bg-yellow-900/20 rounded",children:[e.jsx("p",{className:"text-xs font-medium mb-1",children:"‚ö†Ô∏è Avisos:"}),e.jsx("ul",{className:"text-xs space-y-1",children:j.warnings.map((S,w)=>e.jsxs("li",{children:["‚Ä¢ ",S]},w))})]})]}):e.jsx("p",{children:j.error||"Arquivo inv√°lido"})})]}),j?.valid&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Modo de importa√ß√£o"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(f,{variant:B==="merge"?"default":"outline",onClick:()=>h("merge"),className:"justify-start",children:[e.jsx(Oa,{className:"w-4 h-4 mr-2"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"Mesclar"}),e.jsx("div",{className:"text-xs opacity-70",children:"Adiciona novos dados"})]})]}),e.jsxs(f,{variant:B==="replace"?"default":"outline",onClick:()=>h("replace"),className:"justify-start",children:[e.jsx(Ye,{className:"w-4 h-4 mr-2"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"Substituir"}),e.jsx("div",{className:"text-xs opacity-70",children:"Sempre cria novos"})]})]})]}),e.jsxs(Me,{children:[e.jsx(va,{className:"w-4 h-4"}),e.jsx(Fe,{className:"text-xs",children:B==="merge"?"‚úÖ Dados existentes ser√£o mantidos. Novos itens ser√£o adicionados e itens com mesmo ID ser√£o atualizados.":"‚ö†Ô∏è Todos os itens do backup ser√£o criados como novos, mesmo que j√° existam similares."})]})]})]}),e.jsxs(Ze,{children:[e.jsx(f,{variant:"outline",onClick:()=>t(!1),disabled:v,children:"Cancelar"}),e.jsx(f,{onClick:T,disabled:!j?.valid||v,children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Importando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Xe,{className:"w-4 h-4 mr-2"}),"Importar"]})})]})]})})}function dt({subscriber:r,onBack:l}){const x=Ls(),[d,c]=N.useState(!1),[g,m]=N.useState(null),[j,p]=N.useState(!1),[v,E]=N.useState(null),[B,h]=N.useState(!1),[t,y]=N.useState({name:"",category_id:"",price:"",original_price:"",description:"",is_active:!0,complement_groups:[],stock:"",portion:"",is_highlight:!1,is_new:!1,is_popular:!1,prep_time:"",internal_notes:""}),[T,S]=N.useState(!1),[w,V]=N.useState(!1),[K,W]=N.useState(!1),[ae,te]=N.useState(null),[be,ie]=N.useState(!1),[re,we]=N.useState(null),[ge,de]=N.useState({name:"",is_required:!1,max_selection:1}),[_,P]=N.useState(!1),[D,G]=N.useState(null),[$,z]=N.useState({group_id:"",name:"",price:"",is_active:!0}),{data:U,isLoading:Ve}=os({queryKey:["subscriberProfile",r.email],queryFn:async()=>await J.functions.invoke("getFullSubscriberProfile",{subscriber_email:r.email}),enabled:!!r.email});if(Ve)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ue,{className:"w-8 h-8 animate-spin text-gray-400"})});if(!U)return e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"Erro ao carregar dados do assinante"})});const{data:b={},stats:Pe={}}=U,Z={as_subscriber:r.email},ee=()=>x.invalidateQueries({queryKey:["subscriberProfile",r.email]}),Q=async a=>{S(!0);try{g?(await J.entities.Category.update(g.id,a,Z),k.success("Categoria atualizada")):(await J.entities.Category.create({...a,as_subscriber:r.email}),k.success("Categoria criada")),ee(),c(!1),m(null)}catch(o){k.error(o?.message||"Erro ao salvar categoria")}finally{S(!1)}},pe=async a=>{if(window.confirm(`Excluir a categoria "${a.name}"?`))try{await J.entities.Category.delete(a.id,Z),k.success("Categoria exclu√≠da"),ee()}catch(o){k.error(o?.message||"Erro ao excluir")}},ds=async a=>{S(!0);try{const o={name:a.name,category_id:a.category_id||null,price:parseFloat(a.price)||0,original_price:a.original_price?parseFloat(a.original_price):void 0,description:a.description||"",is_active:a.is_active!==!1,complement_groups:Array.isArray(a.complement_groups)?a.complement_groups:[],stock:a.stock===""||a.stock==null?void 0:a.stock,portion:a.portion||void 0,is_highlight:!!a.is_highlight,is_new:!!a.is_new,is_popular:!!a.is_popular,prep_time:a.prep_time||void 0,internal_notes:a.internal_notes||void 0};v?(await J.entities.Dish.update(v.id,o,Z),k.success("Prato atualizado")):(await J.entities.Dish.create({...o,as_subscriber:r.email}),k.success("Prato criado")),ee(),p(!1),E(null)}catch(o){k.error(o?.message||"Erro ao salvar prato")}finally{S(!1)}},Re=async a=>{if(window.confirm(`Excluir o prato "${a.name}"?`))try{await J.entities.Dish.delete(a.id,Z),k.success("Prato exclu√≠do"),ee()}catch(o){k.error(o?.message||"Erro ao excluir")}},_e=async()=>{S(!0);try{const a={name:ge.name.trim(),is_required:!!ge.is_required,max_selection:Math.max(1,parseInt(ge.max_selection,10)||1),options:re?re.options||[]:[],order:re!=null?re.order??(b.complement_groups||[]).length:(b.complement_groups||[]).length};re?(await J.entities.ComplementGroup.update(re.id,a,Z),k.success("Grupo atualizado")):(await J.entities.ComplementGroup.create({...a,as_subscriber:r.email}),k.success("Grupo criado")),ee(),ie(!1),we(null),de({name:"",is_required:!1,max_selection:1})}catch(a){k.error(a?.message||"Erro ao salvar grupo")}finally{S(!1)}},ss=async a=>{if(window.confirm(`Excluir o grupo "${a.name}" e suas op√ß√µes?`))try{await J.entities.ComplementGroup.delete(a.id,Z),k.success("Grupo exclu√≠do"),ee()}catch(o){k.error(o?.message||"Erro ao excluir")}},Ie=async()=>{S(!0);try{const a=b.complement_groups||[];if(D){const o=a.find(I=>String(I.id)===String(D.groupId));if(!o){k.error("Grupo n√£o encontrado");return}const X=(o.options||[]).map(I=>String(I.id)===String(D.optionId)?{...I,name:$.name.trim(),price:parseFloat($.price)||0,is_active:$.is_active!==!1}:I);await J.entities.ComplementGroup.update(o.id,{options:X},Z),k.success("Complemento atualizado")}else{const o=a.find(H=>String(H.id)===String($.group_id));if(!o){k.error("Selecione um grupo");return}const X={id:Date.now().toString(),name:$.name.trim(),price:parseFloat($.price)||0,is_active:!0},I=[...o.options||[],X];await J.entities.ComplementGroup.update(o.id,{options:I},Z),k.success("Complemento criado")}ee(),P(!1),G(null),z({group_id:"",name:"",price:"",is_active:!0})}catch(a){k.error(a?.message||"Erro ao salvar complemento")}finally{S(!1)}},ms=async(a,o,X)=>{if(window.confirm(`Excluir o complemento "${X}"?`))try{const I=(b.complement_groups||[]).find(Y=>String(Y.id)===String(a));if(!I)return;const H=(I.options||[]).filter(Y=>String(Y.id)!==String(o));await J.entities.ComplementGroup.update(I.id,{options:H},Z),k.success("Complemento exclu√≠do"),ee()}catch(I){k.error(I?.message||"Erro ao excluir")}},xs=async a=>{S(!0);try{for(const o of a.categories||[])await J.entities.Category.update(o.id,{order:o.order},Z);for(const o of a.dishes||[]){const X={order:o.order};Array.isArray(o.complement_groups)&&(X.complement_groups=o.complement_groups),await J.entities.Dish.update(o.id,X,Z)}for(const o of a.groups||[])await J.entities.ComplementGroup.update(o.id,{order:o.order},Z);for(const[o,X]of Object.entries(a.groupOptions||{})){const I=(b.complement_groups||[]).find(H=>String(H.id)===String(o));I&&await J.entities.ComplementGroup.update(o,{...I,options:X},Z)}k.success("Ordem atualizada"),V(!1),ee()}catch(o){k.error(o?.message||"Erro ao reordenar")}finally{S(!1)}},De=async a=>{S(!0);try{ae?(await J.entities.Combo.update(ae.id,a,Z),k.success("Combo atualizado")):(await J.entities.Combo.create({...a,as_subscriber:r.email}),k.success("Combo criado")),ee(),W(!1),te(null)}catch(o){k.error(o?.message||"Erro ao salvar combo")}finally{S(!1)}},as=async a=>{if(window.confirm(`Excluir o combo "${a.name}"?`))try{await J.entities.Combo.delete(a.id,Z),k.success("Combo exclu√≠do"),ee()}catch(o){k.error(o?.message||"Erro ao excluir")}},Ce=a=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a||0),ps=()=>{if(!U)return;const a={subscriber:{...r,plan:r.plan,permissions:r.permissions||{},status:r.status,expires_at:r.expires_at},data:{dishes:b.dishes||[],categories:b.categories||[],complement_groups:b.complement_groups||[],combos:b.combos||[],orders:b.orders||[],caixas:b.caixas||[],store:b.store||null},stats:Pe||{},exported_at:new Date().toISOString(),exported_by:"admin"},o=JSON.stringify(a,null,2),X=new Blob([o],{type:"application/json"}),I=window.URL.createObjectURL(X),H=document.createElement("a");H.href=I;const Y=new Date().toISOString().split("T")[0];H.download=`backup-${r.email}-${Y}.json`,H.click(),window.URL.revokeObjectURL(I)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(f,{variant:"ghost",size:"icon",onClick:l,children:e.jsx(Qs,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-2xl font-bold",children:r.name}),e.jsx("p",{className:"text-gray-500",children:r.email})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(f,{variant:"outline",onClick:ps,children:[e.jsx(ws,{className:"w-4 h-4 mr-2"}),"Exportar Backup"]}),e.jsxs(f,{variant:"outline",onClick:()=>h(!0),children:[e.jsx(Xe,{className:"w-4 h-4 mr-2"}),"Importar Backup"]}),e.jsx(L,{className:r.status==="active"?"bg-green-500":r.status==="expired"?"bg-red-500":"bg-yellow-500",children:r.status})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(xe,{children:[e.jsxs(He,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(Je,{className:"text-sm font-medium",children:"Pratos"}),e.jsx(qs,{className:"w-4 h-4 text-gray-500"})]}),e.jsx(Ke,{children:e.jsx("div",{className:"text-2xl font-bold",children:Pe.total_dishes})})]}),e.jsxs(xe,{children:[e.jsxs(He,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(Je,{className:"text-sm font-medium",children:"Pedidos"}),e.jsx(za,{className:"w-4 h-4 text-gray-500"})]}),e.jsx(Ke,{children:e.jsx("div",{className:"text-2xl font-bold",children:Pe.total_orders})})]}),e.jsxs(xe,{children:[e.jsxs(He,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(Je,{className:"text-sm font-medium",children:"Faturamento"}),e.jsx(Hs,{className:"w-4 h-4 text-gray-500"})]}),e.jsx(Ke,{children:e.jsx("div",{className:"text-2xl font-bold",children:Ce(Pe.total_revenue)})})]}),e.jsxs(xe,{children:[e.jsxs(He,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(Je,{className:"text-sm font-medium",children:"Caixas Abertos"}),e.jsx(Js,{className:"w-4 h-4 text-gray-500"})]}),e.jsx(Ke,{children:e.jsx("div",{className:"text-2xl font-bold",children:Pe.active_caixas})})]})]}),e.jsxs(Da,{defaultValue:"dishes",className:"w-full",children:[e.jsxs(Ta,{children:[e.jsxs(Se,{value:"dishes",children:["Pratos (",(b.dishes||[]).length,")"]}),e.jsxs(Se,{value:"categories",children:["Categorias (",(b.categories||[]).length,")"]}),e.jsxs(Se,{value:"groups",children:["Grupos de Complementos (",(b.complement_groups||[]).length,")"]}),e.jsxs(Se,{value:"complements",children:["Complementos (",(b.complement_groups||[]).reduce((a,o)=>a+(o.options||[]).length,0),")"]}),e.jsxs(Se,{value:"combos",children:["Combos (",(b.combos||[]).length,")"]}),e.jsxs(Se,{value:"orders",children:["Pedidos (",(b.orders||[]).length,")"]}),e.jsx(Se,{value:"store",children:"Loja"}),e.jsxs(Se,{value:"caixas",children:["Caixas (",(b.caixas||[]).length,")"]})]}),e.jsxs(ke,{value:"dishes",className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2",children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>V(!0),children:[e.jsx(fa,{className:"w-4 h-4 mr-2"}),"Reordenar"]}),e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>{te(null),W(!0)},children:[e.jsx(Ma,{className:"w-4 h-4 mr-2"}),"Criar combo"]}),e.jsxs(f,{size:"sm",onClick:()=>{E(null),y({name:"",category_id:b.categories&&b.categories[0]?.id||"",price:"",original_price:"",description:"",is_active:!0,complement_groups:[],stock:"",portion:"",is_highlight:!1,is_new:!1,is_popular:!1,prep_time:"",internal_notes:""}),p(!0)},children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Adicionar prato"]})]}),e.jsx("div",{className:"bg-white rounded-lg border overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Nome"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Categoria"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Pre√ßo"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Complementos"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-gray-700",children:"A√ß√µes"})]})}),e.jsx("tbody",{className:"divide-y",children:(Array.isArray(b?.dishes)?b.dishes:[]).map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:a.name}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:(b.categories||[]).find(o=>o.id===a.category_id)?.name||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:Ce(a.price)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:(a.complement_groups||[]).length}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx(L,{variant:a.is_active!==!1?"default":"secondary",children:a.is_active!==!1?"Ativo":"Inativo"})}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx(f,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{E(a),y({name:a.name,category_id:a.category_id||"",price:a.price??"",original_price:a.original_price??"",description:a.description||"",is_active:a.is_active!==!1,complement_groups:(a.complement_groups||[]).map(o=>({group_id:o.group_id,is_required:!!o.is_required})),stock:a.stock??"",portion:a.portion||"",is_highlight:!!a.is_highlight,is_new:!!a.is_new,is_popular:!!a.is_popular,prep_time:a.prep_time??"",internal_notes:a.internal_notes||""}),p(!0)},children:e.jsx(Ge,{className:"w-4 h-4"})}),e.jsx(f,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-600",onClick:()=>Re(a),children:e.jsx(ze,{className:"w-4 h-4"})})]})]},a.id))})]})})]}),e.jsxs(ke,{value:"categories",className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(f,{size:"sm",onClick:()=>{m(null),c(!0)},children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Adicionar categoria"]})}),e.jsx("div",{className:"bg-white rounded-lg border",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Nome"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Ordem"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-gray-700",children:"A√ß√µes"})]})}),e.jsx("tbody",{className:"divide-y",children:(Array.isArray(b?.categories)?b.categories:[]).map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:a.name}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:a.order??"-"}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx(f,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{m(a),c(!0)},children:e.jsx(Ge,{className:"w-4 h-4"})}),e.jsx(f,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-600",onClick:()=>pe(a),children:e.jsx(ze,{className:"w-4 h-4"})})]})]},a.id))})]})})]}),e.jsxs(ke,{value:"groups",className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(f,{size:"sm",onClick:()=>{we(null),de({name:"",is_required:!1,max_selection:1}),ie(!0)},children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Adicionar grupo"]})}),e.jsx("div",{className:"bg-white rounded-lg border",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Nome"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Obrigat√≥rio"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"M√°x. sele√ß√£o"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Op√ß√µes"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-gray-700",children:"A√ß√µes"})]})}),e.jsx("tbody",{className:"divide-y",children:(Array.isArray(b?.complement_groups)?b.complement_groups:[]).map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:a.name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:a.is_required?"Sim":"N√£o"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:a.max_selection??1}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:(a.options||[]).length}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx(f,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{we(a),de({name:a.name||"",is_required:!!a.is_required,max_selection:a.max_selection??1}),ie(!0)},children:e.jsx(Ge,{className:"w-4 h-4"})}),e.jsx(f,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-600",onClick:()=>ss(a),children:e.jsx(ze,{className:"w-4 h-4"})})]})]},a.id))})]})})]}),e.jsxs(ke,{value:"complements",className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(f,{size:"sm",disabled:(b.complement_groups||[]).length===0,onClick:()=>{G(null),z({group_id:b.complement_groups&&b.complement_groups[0]?.id||"",name:"",price:"",is_active:!0}),P(!0)},title:(b.complement_groups||[]).length===0?"Crie primeiro um grupo na aba Grupos de Complementos":"",children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Adicionar complemento"]})}),e.jsxs("div",{className:"bg-white rounded-lg border",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Grupo"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Nome"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Pre√ßo"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-gray-700",children:"A√ß√µes"})]})}),e.jsx("tbody",{className:"divide-y",children:(Array.isArray(b?.complement_groups)?b.complement_groups:[]).flatMap(a=>(a.options||[]).map(o=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:a.name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:o.name}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:Ce(o.price)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx(L,{variant:o.is_active!==!1?"default":"secondary",children:o.is_active!==!1?"Ativo":"Inativo"})}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx(f,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{G({optionId:o.id,groupId:a.id}),z({group_id:a.id,name:o.name||"",price:o.price??"",is_active:o.is_active!==!1}),P(!0)},children:e.jsx(Ge,{className:"w-4 h-4"})}),e.jsx(f,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-600",onClick:()=>ms(a.id,o.id,o.name),children:e.jsx(ze,{className:"w-4 h-4"})})]})]},`${a.id}-${o.id}`)))})]}),(b.complement_groups||[]).reduce((a,o)=>a+(o.options||[]).length,0)===0&&e.jsx("div",{className:"px-4 py-8 text-center text-gray-500",children:"Nenhum complemento cadastrado. Crie grupos e adicione op√ß√µes na aba Grupos de Complementos."})]})]}),e.jsxs(ke,{value:"combos",className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(f,{size:"sm",onClick:()=>{te(null),W(!0)},children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Adicionar combo"]})}),e.jsxs("div",{className:"bg-white rounded-lg border",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Nome"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Tipo"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Pre√ßo"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-gray-700",children:"A√ß√µes"})]})}),e.jsx("tbody",{className:"divide-y",children:(Array.isArray(b?.combos)?b.combos:[]).map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:a.name}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:a.type||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:Ce(a.combo_price)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx(L,{variant:a.is_active!==!1?"default":"secondary",children:a.is_active!==!1?"Ativo":"Inativo"})}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx(f,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{te(a),W(!0)},children:e.jsx(Ge,{className:"w-4 h-4"})}),e.jsx(f,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-600",onClick:()=>as(a),children:e.jsx(ze,{className:"w-4 h-4"})})]})]},a.id))})]}),(b.combos||[]).length===0&&e.jsx("div",{className:"px-4 py-8 text-center text-gray-500",children:'Nenhum combo. Use "Criar combo" em Promo√ß√µes.'})]})]}),e.jsx(ke,{value:"orders",className:"space-y-4",children:e.jsx("div",{className:"bg-white rounded-lg border",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"C√≥digo"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Cliente"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Data"})]})}),e.jsx("tbody",{className:"divide-y",children:b.orders.slice(0,50).map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:a.order_code}),e.jsx("td",{className:"px-4 py-3 text-sm",children:a.customer_name}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:Ce(a.total)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx(L,{children:a.status})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:new Date(a.created_date).toLocaleDateString("pt-BR")})]},a.id))})]})})}),e.jsx(ke,{value:"store",children:b.store?e.jsxs(xe,{children:[e.jsx(He,{children:e.jsx(Je,{children:"Configura√ß√µes da Loja"})}),e.jsx(Ke,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Nome"}),e.jsx("p",{className:"text-base",children:b.store.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"WhatsApp"}),e.jsx("p",{className:"text-base",children:b.store.whatsapp||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Endere√ßo"}),e.jsx("p",{className:"text-base",children:b.store.address||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Taxa de Entrega"}),e.jsx("p",{className:"text-base",children:Ce(b.store.delivery_fee)})]})]})})]}):e.jsx("p",{className:"text-gray-500 text-center py-12",children:"Nenhuma loja configurada"})}),e.jsx(ke,{value:"caixas",className:"space-y-4",children:e.jsx("div",{className:"bg-white rounded-lg border",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Abertura"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Fechamento"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Aberto por"})]})}),e.jsx("tbody",{className:"divide-y",children:(b.caixas||[]).map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(a.opening_date).toLocaleString("pt-BR")}),e.jsx("td",{className:"px-4 py-3 text-sm",children:a.closing_date?new Date(a.closing_date).toLocaleString("pt-BR"):"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx(L,{variant:a.status==="open"?"default":"secondary",children:a.status==="open"?"Aberto":"Fechado"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:a.opened_by})]},a.id))})]})})})]}),e.jsx(ya,{isOpen:d,onClose:()=>{c(!1),m(null)},onSubmit:Q,category:g,categoriesCount:(b.categories||[]).length},g?g.id:"new"),e.jsx(ve,{open:j,onOpenChange:a=>{a||(p(!1),E(null))},children:e.jsxs(fe,{className:"sm:max-w-2xl max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsx(ye,{children:e.jsx(Ne,{children:v?"Editar prato":"Novo prato"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome *"}),e.jsx(F,{value:t.name,onChange:a=>y(o=>({...o,name:a.target.value})),placeholder:"Ex: Alcatra",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Categoria *"}),e.jsxs(ne,{value:String(t.category_id||""),onValueChange:a=>y(o=>({...o,category_id:a||null})),children:[e.jsx(le,{children:e.jsx(oe,{placeholder:"Selecione"})}),e.jsx(ce,{children:(b.categories||[]).map(a=>e.jsx(M,{value:String(a.id),children:a.name},a.id))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Pre√ßo de (R$) ‚Äî original"}),e.jsx(F,{type:"number",step:"0.01",value:t.original_price,onChange:a=>y(o=>({...o,original_price:a.target.value})),placeholder:"Ex: 25,00"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Por (R$) *"}),e.jsx(F,{type:"number",step:"0.01",value:t.price,onChange:a=>y(o=>({...o,price:a.target.value})),placeholder:"0,00",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Estoque (vazio = ilimitado)"}),e.jsx(F,{type:"number",value:t.stock,onChange:a=>y(o=>({...o,stock:a.target.value})),placeholder:"Ex: 10"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Por√ß√£o"}),e.jsx(F,{value:t.portion,onChange:a=>y(o=>({...o,portion:a.target.value})),placeholder:"Ex: 180g, 500ml"})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Descri√ß√£o"}),e.jsx(js,{value:t.description,onChange:a=>y(o=>({...o,description:a.target.value})),rows:2,placeholder:"Opcional"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Tempo de preparo (min)"}),e.jsx(F,{type:"number",value:t.prep_time,onChange:a=>y(o=>({...o,prep_time:a.target.value})),placeholder:"Ex: 30"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Observa√ß√µes internas (n√£o vis√≠veis ao cliente)"}),e.jsx(js,{value:t.internal_notes,onChange:a=>y(o=>({...o,internal_notes:a.target.value})),rows:1,placeholder:"Opcional"})]}),e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[e.jsx(R,{className:"mb-3 block",children:"Grupos de complementos no prato"}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Marque os grupos que o cliente poder√° escolher ao pedir este prato. Obrigat√≥rio = cliente deve escolher."}),(b.complement_groups||[]).length===0?e.jsx("p",{className:"text-sm text-gray-500",children:'Nenhum grupo. Crie na aba "Grupos de Complementos".'}):e.jsx("div",{className:"space-y-2",children:(b.complement_groups||[]).map(a=>{const o=(t.complement_groups||[]).find(I=>String(I.group_id)===String(a.id)),X=!!o;return e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx(Bs,{checked:X,onCheckedChange:I=>{y(I?H=>({...H,complement_groups:[...H.complement_groups||[],{group_id:a.id,is_required:!1}]}):H=>({...H,complement_groups:(H.complement_groups||[]).filter(Y=>String(Y.group_id)!==String(a.id))}))}}),e.jsx("span",{className:"text-sm font-medium",children:a.name}),X&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Obrigat√≥rio"}),e.jsx(Ae,{checked:!!o?.is_required,onCheckedChange:I=>y(H=>({...H,complement_groups:(H.complement_groups||[]).map(Y=>String(Y.group_id)===String(a.id)?{...Y,is_required:I}:Y)}))})]})]},a.id)})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded",children:[e.jsx(R,{className:"text-sm",children:"‚≠ê Destaque"}),e.jsx(Ae,{checked:t.is_highlight,onCheckedChange:a=>y(o=>({...o,is_highlight:a}))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded",children:[e.jsx(R,{className:"text-sm",children:"‚ú® Novo"}),e.jsx(Ae,{checked:t.is_new,onCheckedChange:a=>y(o=>({...o,is_new:a}))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded",children:[e.jsx(R,{className:"text-sm",children:"üî• Mais vendido"}),e.jsx(Ae,{checked:t.is_popular,onCheckedChange:a=>y(o=>({...o,is_popular:a}))})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded",children:[e.jsx(R,{children:"Ativo"}),e.jsx(Ae,{checked:t.is_active,onCheckedChange:a=>y(o=>({...o,is_active:a}))})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(f,{variant:"outline",className:"flex-1",onClick:()=>{p(!1),E(null)},children:"Cancelar"}),e.jsx(f,{className:"flex-1",disabled:T,onClick:()=>ds(t),children:T?e.jsx(ue,{className:"w-4 h-4 animate-spin"}):v?"Salvar":"Criar"})]})]})]})}),e.jsx(ve,{open:be,onOpenChange:a=>{a||(ie(!1),we(null))},children:e.jsxs(fe,{className:"sm:max-w-md max-w-[95vw]",children:[e.jsx(ye,{children:e.jsx(Ne,{children:re?"Editar grupo":"Novo grupo de complementos"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome *"}),e.jsx(F,{value:ge.name,onChange:a=>de(o=>({...o,name:a.target.value})),placeholder:"Ex: Guarni√ß√µes, Bebidas",required:!0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(R,{children:"Obrigat√≥rio"}),e.jsx(Ae,{checked:ge.is_required,onCheckedChange:a=>de(o=>({...o,is_required:a}))})]}),e.jsxs("div",{children:[e.jsx(R,{children:"M√°ximo de sele√ß√µes"}),e.jsx(F,{type:"number",min:1,value:ge.max_selection,onChange:a=>de(o=>({...o,max_selection:parseInt(a.target.value,10)||1}))})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(f,{variant:"outline",className:"flex-1",onClick:()=>{ie(!1),we(null)},children:"Cancelar"}),e.jsx(f,{className:"flex-1",disabled:T,onClick:_e,children:T?e.jsx(ue,{className:"w-4 h-4 animate-spin"}):re?"Salvar":"Criar"})]})]})]})}),e.jsx(ve,{open:_,onOpenChange:a=>{a||(P(!1),G(null))},children:e.jsxs(fe,{className:"sm:max-w-md max-w-[95vw]",children:[e.jsx(ye,{children:e.jsx(Ne,{children:D?"Editar complemento":"Novo complemento"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Grupo *"}),e.jsxs(ne,{value:String($.group_id||""),onValueChange:a=>z(o=>({...o,group_id:a})),disabled:!!D,children:[e.jsx(le,{children:e.jsx(oe,{placeholder:"Selecione o grupo"})}),e.jsx(ce,{children:(b.complement_groups||[]).map(a=>e.jsx(M,{value:String(a.id),children:a.name},a.id))})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Nome *"}),e.jsx(F,{value:$.name,onChange:a=>z(o=>({...o,name:a.target.value})),placeholder:"Ex: Arroz, Refrigerante",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Pre√ßo (R$)"}),e.jsx(F,{type:"number",step:"0.01",value:$.price,onChange:a=>z(o=>({...o,price:a.target.value})),placeholder:"0,00"})]}),D&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(R,{children:"Ativo"}),e.jsx(Ae,{checked:$.is_active,onCheckedChange:a=>z(o=>({...o,is_active:a}))})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(f,{variant:"outline",className:"flex-1",onClick:()=>{P(!1),G(null)},children:"Cancelar"}),e.jsx(f,{className:"flex-1",disabled:T,onClick:Ie,children:T?e.jsx(ue,{className:"w-4 h-4 animate-spin"}):D?"Salvar":"Criar"})]})]})]})}),e.jsx(Na,{isOpen:w,onClose:()=>V(!1),categories:b.categories||[],dishes:b.dishes||[],complementGroups:b.complement_groups||[],onSave:xs}),e.jsx(ot,{isOpen:K,onClose:()=>{W(!1),te(null)},onSubmit:De,combo:ae,dishes:b.dishes||[]},ae?.id??"new"),e.jsx(ct,{open:B,onOpenChange:h,onSuccess:a=>{k.success("Backup importado com sucesso!"),x.invalidateQueries({queryKey:["profile",r.slug]})}})]})}function _s(r,l){const x=vs(r),d=vs(l),c=Ms(x,d),g=Math.abs(Fa(x,d));x.setDate(x.getDate()-c*g);const m=+(Ms(x,d)===-c),j=c*(g-m);return j===0?0:j}function Ms(r,l){const x=r.getFullYear()-l.getFullYear()||r.getMonth()-l.getMonth()||r.getDate()-l.getDate()||r.getHours()-l.getHours()||r.getMinutes()-l.getMinutes()||r.getSeconds()-l.getSeconds()||r.getMilliseconds()-l.getMilliseconds();return x<0?-1:x>0?1:x}function Ns(r){return+vs(r)<Date.now()}function mt({expiresAt:r,className:l}){if(!r)return e.jsxs(L,{variant:"outline",className:me("bg-green-50 text-green-700 border-green-200",l),children:[e.jsx(bs,{className:"w-3 h-3 mr-1"}),"Sem expira√ß√£o"]});const x=new Date(r),c=_s(x,new Date),g=Ns(x),m=c<=30&&c>7,j=c<=7&&c>0,v=Math.min(c/90*100,100);return g?e.jsx("div",{className:me("space-y-1",l),children:e.jsxs(L,{variant:"outline",className:"bg-red-50 text-red-700 border-red-200",children:[e.jsx(cs,{className:"w-3 h-3 mr-1"}),"Expirado ",Math.abs(c)," dias atr√°s"]})}):j?e.jsxs("div",{className:me("space-y-1",l),children:[e.jsxs(L,{variant:"outline",className:"bg-red-50 text-red-700 border-red-200 animate-pulse",children:[e.jsx(cs,{className:"w-3 h-3 mr-1"}),"Expira em ",c," dias"]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:"bg-red-500 h-1.5 rounded-full transition-all duration-300",style:{width:`${Math.max(v,5)}%`}})})]}):m?e.jsxs("div",{className:me("space-y-1",l),children:[e.jsxs(L,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200",children:[e.jsx(fs,{className:"w-3 h-3 mr-1"}),"Expira em ",c," dias"]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:"bg-yellow-500 h-1.5 rounded-full transition-all duration-300",style:{width:`${v}%`}})})]}):e.jsxs("div",{className:me("space-y-1",l),children:[e.jsxs(L,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:[e.jsx(fs,{className:"w-3 h-3 mr-1"}),"Expira em ",c," dias"]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:"bg-green-500 h-1.5 rounded-full transition-all duration-300",style:{width:`${Math.min(v,100)}%`}})})]})}function Zs(r){if(!r||r.length===0)return"";const l=["Email","Nome","Plano","Status","Data de Expira√ß√£o","Email de Acesso","Telefone","CNPJ_CPF","Origem","Tags","Slug","Observa√ß√µes"],x=r.map(d=>{const c=Array.isArray(d.tags)?d.tags.join(";"):"";return[d.email||"",d.name||"",d.plan||"basic",d.status||"active",d.expires_at||"",d.linked_user_email||"",d.phone||"",d.cnpj_cpf||"",d.origem||"",c,d.slug||"",(d.notes||"").replace(/"/g,'""')].map(g=>`"${String(g)}"`).join(",")});return[l.map(d=>`"${d}"`).join(","),...x].join(`
`)}function Xs(r,l="assinantes.csv"){const x=new Blob(["\uFEFF"+r],{type:"text/csv;charset=utf-8;"}),d=window.URL.createObjectURL(x),c=document.createElement("a");c.href=d,c.download=l,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(d)}function ea(r){const l=r.split(`
`).filter(w=>w.trim());if(l.length<2)throw new Error("CSV inv√°lido: deve ter pelo menos cabe√ßalho e uma linha de dados");const x=l[0],d=Fs(x),c=d.findIndex(w=>/^email$/i.test(w)||/email/i.test(w)&&!/acesso/i.test(w)),g=d.findIndex(w=>/nome/i.test(w)),m=d.findIndex(w=>/plano/i.test(w)),j=d.findIndex(w=>/status/i.test(w)),p=d.findIndex(w=>/expira/i.test(w)),v=d.findIndex(w=>/acesso/i.test(w)),E=d.findIndex(w=>/telefone|phone/i.test(w)),B=d.findIndex(w=>/cnpj|cpf/i.test(w)),h=d.findIndex(w=>/origem/i.test(w)),t=d.findIndex(w=>/tags/i.test(w)),y=d.findIndex(w=>/slug|link/i.test(w)),T=d.findIndex(w=>/observa|note/i.test(w)),S=[];for(let w=1;w<l.length;w++){const V=Fs(l[w]),K=V[c]?.trim();if(!K){console.warn(`Linha ${w+1}: Email n√£o encontrado, pulando...`);continue}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(K)){console.warn(`Linha ${w+1}: Email inv√°lido (${K}), pulando...`);continue}const ae=V[t]?.trim(),te=ae?ae.split(/[;,]/).map(be=>be.trim()).filter(Boolean):[];S.push({email:K.toLowerCase(),name:V[g]?.trim()||"",plan:V[m]?.trim()||"basic",status:V[j]?.trim()||"active",expires_at:V[p]?.trim()||"",linked_user_email:V[v]?.trim()||"",phone:V[E]?.trim()||"",cnpj_cpf:V[B]?.trim()||"",origem:V[h]?.trim()||"import",tags:te.length?te:void 0,slug:V[y]?.trim()||"",notes:V[T]?.trim()||""})}return S}function Fs(r){const l=[];let x="",d=!1;for(let c=0;c<r.length;c++){const g=r[c],m=r[c+1];g==='"'?d&&m==='"'?(x+='"',c++):d=!d:g===","&&!d?(l.push(x.trim()),x=""):x+=g}return l.push(x.trim()),l}const xt=Object.freeze(Object.defineProperty({__proto__:null,downloadCSV:Xs,exportSubscribersToCSV:Zs,importCSVToSubscribers:ea},Symbol.toStringTag,{value:"Module"}));function pt({subscribers:r,disabled:l=!1}){const x=()=>{try{if(!r||r.length===0){k.error("Nenhum assinante para exportar");return}const d=Zs(r),g=`assinantes_${new Date().toISOString().split("T")[0]}.csv`;Xs(d,g),k.success(`${r.length} assinante(s) exportado(s) com sucesso!`)}catch(d){console.error("Erro ao exportar CSV:",d),k.error("Erro ao exportar CSV: "+d.message)}};return e.jsxs(f,{variant:"outline",onClick:x,disabled:l||!r||r.length===0,className:"gap-2",children:[e.jsx(ws,{className:"w-4 h-4"}),"Exportar CSV"]})}function ut({onImport:r,disabled:l=!1}){const[x,d]=N.useState(!1),[c,g]=N.useState(null),[m,j]=N.useState(null),[p,v]=N.useState(null),E=h=>{const t=h.target.files?.[0];if(!t)return;if(!t.name.endsWith(".csv")){v("Por favor, selecione um arquivo CSV");return}g(t),v(null);const y=new FileReader;y.onload=T=>{try{const S=T.target.result,w=ea(S);j(w),v(null)}catch(S){v(S.message||"Erro ao processar CSV"),j(null)}},y.readAsText(t,"UTF-8")},B=()=>{if(!m||m.length===0){k.error("Nenhum assinante v√°lido para importar");return}try{r(m),k.success(`${m.length} assinante(s) importado(s) com sucesso!`),d(!1),g(null),j(null),v(null)}catch(h){console.error("Erro ao importar:",h),k.error("Erro ao importar assinantes: "+h.message)}};return e.jsxs(e.Fragment,{children:[e.jsxs(f,{variant:"outline",onClick:()=>d(!0),disabled:l,className:"gap-2",children:[e.jsx(Xe,{className:"w-4 h-4"}),"Importar CSV"]}),e.jsx(ve,{open:x,onOpenChange:d,children:e.jsxs(fe,{className:"sm:max-w-2xl max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsx(ye,{children:e.jsxs(Ne,{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"w-5 h-5 text-orange-500"}),"Importar Assinantes (CSV)"]})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Selecione o arquivo CSV"}),e.jsx(F,{type:"file",accept:".csv",onChange:E,className:"cursor-pointer"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Colunas: Email, Nome, Plano, Status, Data de Expira√ß√£o, Email de Acesso, Telefone, CNPJ_CPF, Origem, Tags, Slug, Observa√ß√µes"})]}),p&&e.jsxs(Me,{variant:"destructive",children:[e.jsx(cs,{className:"h-4 w-4"}),e.jsx(Fe,{children:p})]}),m&&m.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(bs,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"text-sm font-medium text-green-700",children:[m.length," assinante(s) v√°lido(s) encontrado(s)"]})]}),e.jsx("div",{className:"border rounded-lg p-3 bg-gray-50 max-h-60 overflow-y-auto",children:e.jsxs("div",{className:"space-y-2",children:[m.slice(0,5).map((h,t)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(L,{variant:"outline",className:"text-xs",children:t+1}),e.jsx("span",{className:"font-medium",children:h.email}),h.name&&e.jsxs("span",{className:"text-gray-500",children:["- ",h.name]}),e.jsx(L,{variant:"outline",className:"ml-auto text-xs",children:h.plan})]},t)),m.length>5&&e.jsxs("p",{className:"text-xs text-gray-500 text-center pt-2",children:["... e mais ",m.length-5," assinante(s)"]})]})})]}),c&&!m&&!p&&e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(Us,{className:"w-8 h-8 text-gray-400 animate-pulse"})})]}),e.jsxs(Ze,{children:[e.jsx(f,{variant:"outline",onClick:()=>d(!1),children:"Cancelar"}),e.jsxs(f,{onClick:B,disabled:!m||m.length===0,className:"bg-orange-500 hover:bg-orange-600",children:["Importar ",m?`(${m.length})`:""]})]})]})})]})}function ht({subscribers:r=[],onFilterChange:l}){const[x,d]=N.useState(!1),[c,g]=N.useState({status:[],plan:[],expires_soon:!1,has_password:null,search:""}),m=v=>{const E={...c,...v};g(E);const B=r.filter(h=>{if(E.status.length>0&&!E.status.includes(h.status)||E.plan.length>0&&!E.plan.includes(h.plan))return!1;if(E.expires_soon){if(!h.expires_at)return!1;const t=_s(new Date(h.expires_at),new Date);if(t>30||t<0)return!1}return!(E.has_password!==null&&!!h.has_password!==E.has_password)});l?.(B)},j=()=>{g({status:[],plan:[],expires_soon:!1,has_password:null,search:""}),l?.(r)},p=[c.status.length,c.plan.length,c.expires_soon,c.has_password!==null].filter(Boolean).reduce((v,E)=>v+(typeof E=="number"?E:1),0);return e.jsxs(Ra,{open:x,onOpenChange:d,children:[e.jsx(La,{asChild:!0,children:e.jsxs(f,{variant:"outline",className:"gap-2 relative",children:[e.jsx($a,{className:"w-4 h-4"}),"Filtros",p>0&&e.jsx(L,{variant:"secondary",className:"ml-1 h-5 min-w-5 px-1.5 text-xs",children:p})]})}),e.jsx(qa,{className:"w-80",align:"start",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Filtros Avan√ßados"}),p>0&&e.jsxs(f,{variant:"ghost",size:"sm",onClick:j,className:"h-7 text-xs",children:[e.jsx($e,{className:"w-3 h-3 mr-1"}),"Limpar"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"Status"}),e.jsxs(ne,{value:c.status[0]||"all",onValueChange:v=>{m({status:v==="all"?[]:[v]})},children:[e.jsx(le,{className:"h-8 text-xs",children:e.jsx(oe,{})}),e.jsxs(ce,{children:[e.jsx(M,{value:"all",children:"Todos"}),e.jsx(M,{value:"active",children:"Ativo"}),e.jsx(M,{value:"inactive",children:"Inativo"}),e.jsx(M,{value:"pending",children:"Pendente"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"Plano"}),e.jsxs(ne,{value:c.plan[0]||"all",onValueChange:v=>{m({plan:v==="all"?[]:[v]})},children:[e.jsx(le,{className:"h-8 text-xs",children:e.jsx(oe,{})}),e.jsxs(ce,{children:[e.jsx(M,{value:"all",children:"Todos"}),e.jsx(M,{value:"free",children:"Gratuito"}),e.jsx(M,{value:"basic",children:"B√°sico"}),e.jsx(M,{value:"pro",children:"Pro"}),e.jsx(M,{value:"ultra",children:"Ultra"}),e.jsx(M,{value:"custom",children:"Personalizado"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Expira em < 30 dias"}),e.jsx(f,{variant:c.expires_soon?"default":"outline",size:"sm",className:"h-7 text-xs",onClick:()=>m({expires_soon:!c.expires_soon}),children:c.expires_soon?"Sim":"N√£o"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"Senha Definida"}),e.jsxs(ne,{value:c.has_password===null?"all":c.has_password?"yes":"no",onValueChange:v=>{m({has_password:v==="all"?null:v==="yes"})},children:[e.jsx(le,{className:"h-8 text-xs",children:e.jsx(oe,{})}),e.jsxs(ce,{children:[e.jsx(M,{value:"all",children:"Todos"}),e.jsx(M,{value:"yes",children:"Sim"}),e.jsx(M,{value:"no",children:"N√£o"})]})]})]}),p>0&&e.jsx("div",{className:"pt-2 border-t",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[c.status.length>0&&e.jsxs(L,{variant:"secondary",className:"text-xs",children:["Status: ",c.status.join(", ")]}),c.plan.length>0&&e.jsxs(L,{variant:"secondary",className:"text-xs",children:["Plano: ",c.plan.join(", ")]}),c.expires_soon&&e.jsx(L,{variant:"secondary",className:"text-xs",children:"Expira em < 30 dias"}),c.has_password!==null&&e.jsxs(L,{variant:"secondary",className:"text-xs",children:["Senha: ",c.has_password?"Sim":"N√£o"]})]})})]})})]})}function gt({subscribers:r=[],selectedIds:l=[],onSelectionChange:x,onBulkAction:d,disabled:c=!1}){const g=r.length>0&&l.length===r.length,m=l.length>0&&!g,j=()=>{x?.(g?[]:r.map(v=>v.id))},p=async v=>{if(!l.length)return;const E=r.filter(B=>l.includes(B.id));switch(v){case"activate":await d?.("activate",E);break;case"deactivate":await d?.("deactivate",E);break;case"delete":confirm(`Tem certeza que deseja excluir ${l.length} assinante(s)?`)&&await d?.("delete",E);break;case"export":await d?.("export",E);break}};return r.length===0?null:e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-200 bg-gray-50 px-4 rounded-t-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(f,{variant:"ghost",size:"sm",onClick:j,className:"gap-2 h-8",disabled:c,children:[g?e.jsx(Ws,{className:"w-4 h-4"}):m?e.jsx("div",{className:"w-4 h-4 border-2 border-gray-400 rounded bg-white",children:e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded m-0.5"})}):e.jsx(Ys,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:g?"Desmarcar todos":"Selecionar todos"})]}),l.length>0&&e.jsxs(L,{variant:"secondary",className:"gap-1",children:[l.length," selecionado",l.length>1?"s":""]})]}),l.length>0&&e.jsxs(Vs,{children:[e.jsx(Is,{asChild:!0,children:e.jsxs(f,{variant:"outline",size:"sm",className:"gap-2 h-8",children:["A√ß√µes em Lote",e.jsx(L,{variant:"secondary",className:"ml-1 h-4 min-w-4 px-1 text-xs",children:l.length})]})}),e.jsxs(Gs,{align:"end",children:[e.jsxs(he,{onClick:()=>p("activate"),children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Ativar ",l.length," assinante(s)"]}),e.jsxs(he,{onClick:()=>p("deactivate"),children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Desativar ",l.length," assinante(s)"]}),e.jsx(ks,{}),e.jsxs(he,{onClick:()=>p("export"),children:[e.jsx(ws,{className:"w-4 h-4 mr-2"}),"Exportar ",l.length," assinante(s)"]}),e.jsx(ks,{}),e.jsxs(he,{onClick:()=>p("delete"),className:"text-red-600",children:[e.jsx(ze,{className:"w-4 h-4 mr-2"}),"Excluir ",l.length," assinante(s)"]})]})]})]})}function jt({open:r,onClose:l,setupUrl:x,subscriberName:d}){const[c,g]=N.useState(!1),m=async()=>{if(x)try{await navigator.clipboard.writeText(x),g(!0),setTimeout(()=>g(!1),2e3)}catch(j){console.error("Erro ao copiar:",j)}};return e.jsx(ve,{open:r,onOpenChange:l,children:e.jsxs(fe,{className:"sm:max-w-md max-w-[95vw]",children:[e.jsx(ye,{children:e.jsx(Ne,{className:"text-green-700 dark:text-green-400",children:"Assinante criado com sucesso!"})}),e.jsxs("div",{className:"space-y-4 py-2",children:[d&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("strong",{children:d})," foi cadastrado. Envie o link abaixo para que defina a senha."]}),x?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",readOnly:!0,value:x,className:"flex-1 px-3 py-2 text-sm border rounded-lg bg-gray-50 dark:bg-gray-800 font-mono truncate","aria-label":"Link de defini√ß√£o de senha"}),e.jsx(f,{variant:"outline",size:"icon",onClick:m,className:"shrink-0",title:"Copiar link",children:c?e.jsx(qe,{className:"w-4 h-4 text-green-600"}):e.jsx(Ks,{className:"w-4 h-4"})})]}):e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:'Link de defini√ß√£o de senha n√£o foi gerado. Verifique os logs do backend ou use "Resetar Senha" na lista.'})]}),e.jsx(Ze,{children:e.jsx(f,{onClick:l,children:"Fechar"})})]})})}function vt({subscribers:r=[]}){const l=Array.isArray(r)?r:[],x=N.useMemo(()=>{const d=new Date,c=new Date;c.setDate(c.getDate()+30);const g=l.filter(t=>t.status==="active"),m=l.filter(t=>t.status==="inactive"),j=l.filter(t=>t.expires_at?Ns(new Date(t.expires_at)):!1),p=l.filter(t=>{if(!t.expires_at)return!1;const y=_s(new Date(t.expires_at),d);return y<=30&&y>0}),v={basic:l.filter(t=>t.plan==="basic").length,pro:l.filter(t=>t.plan==="pro").length,premium:l.filter(t=>t.plan==="premium").length,custom:l.filter(t=>t.plan==="custom").length},E=l.filter(t=>t.has_password).length,B=l.filter(t=>!t.has_password).length,h=l.filter(t=>t.status==="active"&&(!t.expires_at||!Ns(new Date(t.expires_at))));return{total:l.length,active:g.length,inactive:m.length,expired:j.length,expiringSoon:p.length,plans:v,withPassword:E,withoutPassword:B,recent:h.length,activeRate:l.length>0?(g.length/l.length*100).toFixed(1):0}},[l]);return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(xe,{className:"p-4 bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ys,{className:"w-8 h-8 text-blue-600"}),e.jsx(L,{variant:"secondary",className:"bg-blue-200 text-blue-800",children:"Total"})]}),e.jsx("div",{className:"text-3xl font-bold text-blue-900",children:x.total}),e.jsx("div",{className:"text-sm text-blue-700 mt-1",children:"Assinantes cadastrados"})]}),e.jsxs(xe,{className:"p-4 bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ia,{className:"w-8 h-8 text-green-600"}),e.jsxs(L,{variant:"secondary",className:"bg-green-200 text-green-800",children:[x.activeRate,"%"]})]}),e.jsx("div",{className:"text-3xl font-bold text-green-900",children:x.active}),e.jsx("div",{className:"text-sm text-green-700 mt-1",children:"Assinantes ativos"}),x.inactive>0&&e.jsxs("div",{className:"text-xs text-green-600 mt-1",children:[x.inactive," inativo(s)"]})]}),e.jsxs(xe,{className:"p-4 bg-gradient-to-br from-yellow-50 to-yellow-100 border-yellow-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Js,{className:"w-8 h-8 text-yellow-600"}),e.jsx(L,{variant:"secondary",className:"bg-yellow-200 text-yellow-800",children:"Aten√ß√£o"})]}),e.jsx("div",{className:"text-3xl font-bold text-yellow-900",children:x.expiringSoon}),e.jsx("div",{className:"text-sm text-yellow-700 mt-1",children:"Expirando em < 30 dias"}),x.expired>0&&e.jsxs("div",{className:"text-xs text-red-600 mt-1",children:[x.expired," j√° expirado(s)"]})]}),e.jsxs(xe,{className:"p-4 bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Hs,{className:"w-8 h-8 text-purple-600"}),e.jsx(L,{variant:"secondary",className:"bg-purple-200 text-purple-800",children:"Planos"})]}),e.jsxs("div",{className:"space-y-1 mt-2",children:[x.plans.basic>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"B√°sico:"}),e.jsx("span",{className:"font-semibold",children:x.plans.basic})]}),x.plans.pro>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"Pro:"}),e.jsx("span",{className:"font-semibold",children:x.plans.pro})]}),x.plans.premium>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"Premium:"}),e.jsx("span",{className:"font-semibold",children:x.plans.premium})]}),x.plans.custom>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-700",children:"Custom:"}),e.jsx("span",{className:"font-semibold",children:x.plans.custom})]})]})]}),x.withoutPassword>0&&e.jsxs(xe,{className:"p-4 bg-gradient-to-br from-red-50 to-red-100 border-red-200 md:col-span-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(cs,{className:"w-6 h-6 text-red-600"}),e.jsx("span",{className:"font-semibold text-red-900",children:"Aten√ß√£o: Senhas n√£o definidas"})]}),e.jsx("div",{className:"text-2xl font-bold text-red-900",children:x.withoutPassword}),e.jsxs("div",{className:"text-sm text-red-700 mt-1",children:[x.withoutPassword," assinante(s) ainda n√£o definiram senha"]})]})]})}const ft={restaurant_basic:{name:"Restaurante B√°sico",description:"Plano ideal para restaurantes que precisam gerenciar card√°pio e pedidos",permissions:{dashboard:["view"],dishes:["view","create","update"],orders:["view","create","update"],history:["view"],clients:["view"],store:["view","update"],theme:["view","update"]}},delivery_pro:{name:"Delivery Profissional",description:"Plano completo para empresas de delivery com gest√£o de entregas",permissions:{dashboard:["view"],dishes:["view","create","update","delete"],delivery_zones:["view","create","update","delete"],gestor_pedidos:["view","create","update","delete"],orders:["view","create","update"],history:["view"],clients:["view","create","update"],graficos:["view"],store:["view","update"],theme:["view","update"],payments:["view"]}},pizzaria_premium:{name:"Pizzaria Premium",description:"Plano completo para pizzarias com sistema de montagem de pizzas",permissions:{dashboard:["view"],dishes:["view","create","update","delete"],pdv:["view","create","update"],gestor_pedidos:["view","create","update","delete"],orders:["view","create","update","delete"],history:["view"],clients:["view","create","update","delete"],coupons:["view","create","update","delete"],promotions:["view","create","update","delete"],graficos:["view"],financial:["view"],store:["view","update"],theme:["view","update"],payments:["view"]}},cafe_basic:{name:"Cafeteria B√°sico",description:"Plano simples para cafeterias e lanchonetes",permissions:{dashboard:["view"],dishes:["view","create","update"],orders:["view","create"],history:["view"],store:["view","update"]}},marketplace_full:{name:"Marketplace Completo",description:"Acesso total para marketplaces e e-commerces",permissions:{dashboard:["view"],pdv:["view","create","update"],gestor_pedidos:["view","create","update","delete"],caixa:["view","create","update"],dishes:["view","create","update","delete"],delivery_zones:["view","create","update","delete"],coupons:["view","create","update","delete"],promotions:["view","create","update","delete"],theme:["view","update"],store:["view","update"],payments:["view","update"],graficos:["view"],orders:["view","create","update","delete"],history:["view"],clients:["view","create","update","delete"],financial:["view"],printer:["view","update"],whatsapp:["view"],mais:["view"]}}};function yt(){return Object.entries(ft).map(([r,l])=>({id:r,...l}))}function Rs({onSelectTemplate:r}){const l=yt(),x=d=>{const c=l.find(g=>g.id===d);c&&r&&r(c)};return e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 block",children:"Templates R√°pidos (opcional)"}),e.jsxs(ne,{onValueChange:x,children:[e.jsx(le,{className:"w-full",children:e.jsx(oe,{placeholder:"Escolher template para preencher automaticamente"})}),e.jsx(ce,{children:l.map(d=>e.jsx(M,{value:d.id,children:e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Us,{className:"w-4 h-4 text-orange-500"}),e.jsx("span",{className:"font-medium",children:d.name})]}),e.jsx("span",{className:"text-xs text-gray-500 mt-0.5",children:d.description})]})},d.id))})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Templates preenchem automaticamente as permiss√µes. Voc√™ pode ajustar depois."})]})}function gs({className:r,...l}){return e.jsx("div",{className:me("animate-pulse rounded-md bg-muted",r),...l})}function Nt({count:r=4}){return e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Array.from({length:r}).map((l,x)=>e.jsxs("div",{className:"rounded-2xl bg-card p-6 shadow-md border border-border",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx(gs,{className:"w-14 h-14 rounded-xl"})}),e.jsx(gs,{className:"h-10 w-20 mb-2"}),e.jsx(gs,{className:"h-4 w-16"})]},x))})}function kr(){const[r,l]=N.useState(null),[x,d]=N.useState(!0),[c,g]=N.useState(!1),[m,j]=N.useState(!1),[p,v]=N.useState(null),[E,B]=N.useState(""),[h,t]=N.useState({email:"",linked_user_email:"",name:"",slug:"",plan:"basic",status:"active",expires_at:"",permissions:Oe("basic"),phone:"",cnpj_cpf:"",origem:"manual",tags:[],notes:""}),[y,T]=N.useState(null),[S,w]=N.useState(null),[V,K]=N.useState({}),[W,ae]=N.useState(new Set),[te,be]=N.useState({open:!1,url:null,name:null}),[ie,re]=N.useState(null),[we,ge]=N.useState(!1),[de,_]=N.useState(!1),[P,D]=N.useState(!0),[G,$]=N.useState(1),[z]=N.useState(50),U=Ls();N.useEffect(()=>{(async()=>{try{C.log("üî• Aquecendo servidor...");const n="https://digimenu-backend-3m6t.onrender.com/api".replace("/api","");await fetch(n,{method:"GET",signal:AbortSignal.timeout(6e4)}),C.log("‚úÖ Servidor aquecido!"),D(!1)}catch(i){C.warn("‚ö†Ô∏è Warmup falhou, mas continuando...",i.message),D(!1)}})()},[]),N.useEffect(()=>{(async()=>{try{const i=await je.auth.me();l(i),i.is_master||(window.location.href=us("Admin"))}catch{je.auth.redirectToLogin()}finally{d(!1)}})()},[]);const{data:Ve,isLoading:b,isError:Pe,error:Z,refetch:ee}=os({queryKey:["subscribers",G,z],queryFn:async({signal:s})=>{C.log("üîÑ Buscando assinantes...");const i=async(n=12e4,u=1)=>{const A=new AbortController;let q;s&&s.addEventListener("abort",()=>{q&&clearTimeout(q),A.abort()},{once:!0}),q=setTimeout(()=>{C.warn(`‚è±Ô∏è Timeout de ${n/1e3}s atingido (tentativa ${u})`),A.abort()},n);try{C.log(`üì° Tentativa ${u} - Iniciando requisi√ß√£o (timeout: ${n/1e3}s)...`);const O=await je.get("/establishments/subscribers",{page:G,limit:z},{signal:A.signal});return clearTimeout(q),C.log(`‚úÖ Resposta recebida com sucesso na tentativa ${u}!`),O}catch(O){throw clearTimeout(q),C.error(`‚ùå Erro na tentativa ${u}:`,O.name,O.message),O}};try{try{const n=await i(12e4,1);if(n==null||typeof n=="object"&&n.data===void 0&&!Array.isArray(n)&&!n.subscribers)throw new Error("Resposta inv√°lida do servidor (sem data). Tentando novamente...");let u=[],A=null;if(n?.data?.subscribers)u=n.data.subscribers,A=n.data.pagination??null;else if(n?.data&&Array.isArray(n.data))u=n.data;else if(Array.isArray(n))u=n;else{if(n?.data?.error)throw new Error(n.data.error);if(n?.subscribers)u=n.subscribers,A=n.pagination??null;else{const O=n?Object.keys(n):[];if(C.warn("‚ö†Ô∏è Formato de resposta inesperado:",{keys:O,hasData:!!n?.data}),n?.data&&typeof n.data=="object"&&!Array.isArray(n.data)&&!n.data.subscribers)throw new Error("Resposta do servidor sem lista de assinantes. Tentando novamente...");u=[]}}C.log("üìã Assinantes retornados:",u.length,A?`(p√°gina ${A.page}/${A.totalPages})`:"");const q={};return u.forEach(O=>{(O.setup_url||O.password_token)&&(q[O.id||O.email]={token:O.password_token,setup_url:O.setup_url,expires_at:O.token_expires_at})}),K(q),{subscribers:u,pagination:A}}catch(n){C.warn("‚ö†Ô∏è Primeira tentativa falhou, aguardando 3s para retry...",n.message),await new Promise(se=>setTimeout(se,3e3)),C.log("üîÑ Tentativa 2...");const u=await i(9e4,2);if(u==null||typeof u=="object"&&u.data===void 0&&!Array.isArray(u)&&!u.subscribers)throw new Error("Resposta inv√°lida do servidor ap√≥s retry. Tente recarregar a p√°gina.");let A=[],q=null;u?.data?.subscribers?(A=u.data.subscribers,q=u.data.pagination??null):u?.data&&Array.isArray(u.data)?A=u.data:Array.isArray(u)?A=u:u?.subscribers?(A=u.subscribers,q=u.pagination??null):A=[],C.log("‚úÖ Retry bem-sucedido! Assinantes:",A.length);const O={};return A.forEach(se=>{(se.setup_url||se.password_token)&&(O[se.id||se.email]={token:se.password_token,setup_url:se.setup_url,expires_at:se.token_expires_at})}),K(O),{subscribers:A,pagination:q}}}catch(n){throw C.error("‚ùå Erro final ao buscar assinantes:",n),n?.name==="AbortError"?new Error('Servidor n√£o respondeu ap√≥s 2 minutos. O servidor pode estar inativo (cold start) ou com problema. Aguarde alguns instantes e clique em "Tentar novamente".'):n}},enabled:!!r?.is_master&&!P,refetchOnWindowFocus:!1,refetchOnMount:!0,retry:0,refetchInterval:!1,staleTime:3e4}),Q=N.useMemo(()=>{const s=Ve;return s?Array.isArray(s)?s:s.subscribers??[]:[]},[Ve]),pe=Ve?.pagination??null;N.useEffect(()=>{if(!b){_(!1);return}const s=setTimeout(()=>_(!0),8e4);return()=>clearTimeout(s)},[b]);const{data:ds=[]}=os({queryKey:["plans"],queryFn:async()=>{try{const i=(await je.entities.Plan.list("order")).filter(n=>n.is_active!==!1);return i.length===0?(console.log("‚ö†Ô∏è Nenhum plano no banco, retornando planos padr√£o (Assinantes)"),[{id:"free",slug:"free",name:"Gratuito",description:"Teste de 10 dias",is_active:!0,order:0},{id:"basic",slug:"basic",name:"B√°sico",description:"Funcionalidades essenciais",is_active:!0,order:1},{id:"pro",slug:"pro",name:"Pro",description:"Recursos avan√ßados",is_active:!0,order:2},{id:"ultra",slug:"ultra",name:"Ultra",description:"Todos os recursos",is_active:!0,order:3}]):i}catch(s){return console.error("‚ùå Erro ao carregar planos, retornando padr√£o:",s),[{id:"free",slug:"free",name:"Gratuito",description:"Teste de 10 dias",is_active:!0,order:0},{id:"basic",slug:"basic",name:"B√°sico",description:"Funcionalidades essenciais",is_active:!0,order:1},{id:"pro",slug:"pro",name:"Pro",description:"Recursos avan√ßados",is_active:!0,order:2},{id:"ultra",slug:"ultra",name:"Ultra",description:"Todos os recursos",is_active:!0,order:3}]}},enabled:!!r?.is_master}),Re=ls({onMutate:async s=>{const i=["subscribers",G,z];await U.cancelQueries({queryKey:["subscribers"]});const n=U.getQueryData(i),u={id:`temp-${Date.now()}`,...s,status:s.status||"active",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),_optimistic:!0};return U.setQueryData(i,A=>({subscribers:[...Array.isArray(A)?A:A?.subscribers??[],u],pagination:A?.pagination??null})),{previousData:n}},mutationFn:async s=>{C.log("üì§ [FRONTEND] Enviando dados para criar assinante:",JSON.stringify(s,null,2));try{const i=await je.post("/establishments/subscribers",s);if(C.log("üì• [FRONTEND] Resposta RAW recebida:",i),C.log("üì• [FRONTEND] Tipo da resposta:",typeof i),C.log("üì• [FRONTEND] response √© objeto?",typeof i=="object"),C.log("üì• [FRONTEND] response.data existe?",!!i?.data),C.log("üì• [FRONTEND] response.data:",i?.data),C.log("üì• [FRONTEND] response.data?.subscriber existe?",!!i?.data?.subscriber),C.log("üì• [FRONTEND] response.data?.subscriber:",i?.data?.subscriber),C.log("üì• [FRONTEND] Resposta completa (stringified):",JSON.stringify(i,null,2)),i?.data?.error)throw C.error("‚ùå [FRONTEND] Erro na resposta:",i.data.error),new Error(i.data.error);if(!i)throw C.error("‚ùå [FRONTEND] Resposta √© null ou undefined"),new Error("Resposta inv√°lida do servidor: resposta vazia");if(!i.data)throw C.error("‚ùå [FRONTEND] response.data n√£o existe. Resposta completa:",i),new Error("Resposta inv√°lida do servidor: campo data n√£o encontrado");if(!i.data.subscriber)throw C.error("‚ùå [FRONTEND] response.data.subscriber n√£o existe"),C.error("‚ùå [FRONTEND] response.data completo:",JSON.stringify(i.data,null,2)),C.error("‚ùå [FRONTEND] Chaves de response.data:",Object.keys(i.data||{})),new Error("Resposta inv√°lida do servidor. Subscriber n√£o encontrado na resposta.");return C.log("‚úÖ [FRONTEND] Subscriber encontrado:",i.data.subscriber),{...i.data.subscriber,setup_url:i.data.setup_url,password_token:i.data.password_token}}catch(i){throw C.error("‚ùå [FRONTEND] Erro na mutationFn:",i),C.error("‚ùå [FRONTEND] Stack trace:",i.stack),i}},onSuccess:async s=>{C.log("‚úÖ [FRONTEND] Assinante criado com sucesso - dados completos:",JSON.stringify(s,null,2)),C.log("‚úÖ [FRONTEND] data.setup_url:",s.setup_url),C.log("‚úÖ [FRONTEND] data.password_token:",s.password_token),g(!1),t({email:"",linked_user_email:"",name:"",slug:"",plan:"basic",status:"active",expires_at:"",permissions:Oe("basic"),phone:"",cnpj_cpf:"",origem:"manual",tags:[],notes:""});const i=window.location.origin;let n=s.setup_url;!n&&s.password_token&&(n=`${i}/definir-senha?token=${s.password_token}`);try{n&&await navigator.clipboard.writeText(n)}catch(u){C.error("Erro ao copiar link:",u)}k.success(n?"Assinante criado! Link copiado.":"Assinante criado com sucesso!"),be({open:!0,url:n,name:s.name||s.email})},onError:(s,i,n)=>{n?.previousData!=null&&U.setQueryData(["subscribers",G,z],n.previousData),C.error("‚ùå Erro completo ao criar assinante:",s);const u=s?.message||s?.toString()||"Erro desconhecido";k.error(`Erro ao adicionar assinante: ${u}`)},onSettled:()=>{U.invalidateQueries({queryKey:["subscribers"]})}}),_e=ls({onMutate:async({id:s,data:i})=>{const n=["subscribers",G,z];await U.cancelQueries({queryKey:["subscribers"]});const u=U.getQueryData(n);return U.setQueryData(n,A=>({subscribers:(Array.isArray(A)?A:A?.subscribers??[]).map(se=>se.id===s?{...se,...i,_optimistic:!0}:se),pagination:A?.pagination??null})),{previousData:u}},mutationFn:async({id:s,data:i,originalData:n})=>{const u=await je.functions.invoke("updateSubscriber",{id:s,data:i,originalData:n});if(u.data?.error)throw new Error(u.data.error);return u.data?.subscriber??u.data},onError:(s,i,n)=>{n?.previousData!=null&&U.setQueryData(["subscribers",G,z],n.previousData);const u=s?.message||s?.toString()||"Erro ao atualizar assinante";k.error(u)},onSettled:()=>{U.invalidateQueries({queryKey:["subscribers"]})}}),ss=ls({onMutate:async s=>{const i=["subscribers",G,z];await U.cancelQueries({queryKey:["subscribers"]});const n=U.getQueryData(i);return U.setQueryData(i,u=>({subscribers:(Array.isArray(u)?u:u?.subscribers??[]).filter(O=>O.id!==s),pagination:u?.pagination??null})),{previousData:n}},mutationFn:async s=>{const i=await je.functions.invoke("deleteSubscriber",{id:s});if(i.data.error)throw new Error(i.data.error);return i.data},onError:(s,i,n)=>{n?.previousData!=null&&U.setQueryData(["subscribers",G,z],n.previousData),k.error("Erro ao excluir assinante")},onSettled:()=>{U.invalidateQueries({queryKey:["subscribers"]})}}),Ie=ls({mutationFn:async({subscriber_id:s,email:i})=>{const n=await je.functions.invoke("generatePasswordTokenForSubscriber",{subscriber_id:s,email:i});if(n.data.error)throw new Error(n.data.error);return C.log("‚úÖ [FRONTEND] Token gerado com sucesso:",n.data),n.data},onSuccess:async(s,i)=>{C.log("‚úÖ [FRONTEND] onSuccess - Token gerado:",s),C.log("‚úÖ [FRONTEND] setup_url recebido:",s.setup_url),C.log("‚úÖ [FRONTEND] token recebido:",s.token);const n=i.subscriber_id||i.email,u={token:s.token||s.data?.token,setup_url:s.setup_url||s.data?.setup_url,expires_at:s.expires_at||s.data?.expires_at};C.log("üíæ [FRONTEND] Salvando no cache local:",{key:n,tokenInfo:u}),K(q=>({...q,[n]:u}));const A=s.setup_url||s.data?.setup_url;if(A)try{await navigator.clipboard.writeText(A),k.success("Token gerado! Link copiado para a √°rea de transfer√™ncia.",{duration:5e3})}catch{k.success("Token de senha gerado com sucesso!")}else k.success("Token de senha gerado com sucesso!")},onError:s=>{C.error("‚ùå Erro ao gerar token:",s),k.error(s.message||"Erro ao gerar token de senha")}}),ms=s=>{Ie.mutate({subscriber_id:s.id,email:s.email})},xs=s=>{if(!s)return{valid:!1,error:"Email √© obrigat√≥rio"};const i=s.trim().toLowerCase();return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i)?Q.some(A=>A.email?.toLowerCase()===i&&A.id!==h.id)?{valid:!1,error:"Este email j√° est√° cadastrado"}:{valid:!0,email:i}:{valid:!1,error:"Formato de email inv√°lido"}},De=s=>(s||"").trim().toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")||"",as=s=>{if(!s)return{valid:!0,slug:""};const i=De(s);return/^[a-z0-9]+(?:-[a-z0-9]+)*$/.test(i)?{valid:!0,slug:i}:{valid:!1,error:"Use apenas letras min√∫sculas, n√∫meros e h√≠fen"}},Ce=()=>{const s=xs(h.email);if(!s.valid){k.error(s.error);return}const n=String(h.plan||"basic");let u=h.permissions||{};n!=="custom"&&(!u||Object.keys(u).length===0)&&(u=Oe(n));const A=as(h.slug);if(!A.valid){k.error(A.error);return}const q={email:s.email,name:(h.name||"").trim(),plan:n,status:String(h.status||"active")};h.expires_at&&(q.expires_at=h.expires_at),A.slug&&(q.slug=A.slug),h.linked_user_email!=null&&String(h.linked_user_email||"").trim()&&(q.linked_user_email=String(h.linked_user_email).trim()),u&&Object.keys(u).length>0&&(q.permissions=u),h.phone?.trim()&&(q.phone=h.phone.trim()),h.cnpj_cpf?.trim()&&(q.cnpj_cpf=h.cnpj_cpf.trim()),h.notes?.trim()&&(q.notes=h.notes.trim()),h.origem?.trim()&&(q.origem=h.origem.trim()),Array.isArray(h.tags)&&h.tags.length>0&&(q.tags=h.tags.filter(O=>O&&String(O).trim())),C.log("Criando assinante:",JSON.stringify(q,null,2));try{Re.mutate(q)}catch(O){C.error("Erro ao criar assinante:",O),alert("Erro ao criar assinante: "+O.message)}},ps=s=>{const i=s.status==="active"?"inactive":"active";_e.mutate({id:s.id,data:{...s,status:i},originalData:s})},[a,o]=N.useState([]),X=async s=>{C.log("üìÇ Abrindo modal para:",s);const i={...s,permissions:s.permissions||{},plan:s.plan||"basic",status:s.status||"active"};C.log("üìÇ Estado inicial editingSubscriber:",i),v(i),j(!0);try{const n=await je.entities.PermissionLog.filter({subscriber_email:s.email},"-created_date",10);o(n)}catch(n){C.error("Erro ao carregar logs:",n),o([])}},I=()=>{if(!p)return;const s=Q.find(u=>u.id===p.id);C.log("üíæ SALVANDO - editingSubscriber completo:",JSON.stringify(p,null,2));const i=as(p.slug);if(!i.valid){k.error(i.error);return}const n={id:p.id,email:p.email,linked_user_email:p.linked_user_email||p.email,name:p.name||"",plan:p.plan,status:p.status||"active",expires_at:p.expires_at||"",permissions:p.permissions||{},notes:p.notes||"",slug:i.slug??"",phone:p.phone||"",cnpj_cpf:p.cnpj_cpf||"",origem:p.origem||"",tags:Array.isArray(p.tags)?p.tags:[]};C.log("üíæ SALVANDO - editingSubscriber.id:",p.id),C.log("üíæ SALVANDO - originalData:",s),C.log("üíæ SALVANDO - dataToUpdate completo:",JSON.stringify(n,null,2)),_e.mutate({id:p.id,data:n,originalData:s}),j(!1),v(null),o([])},H=s=>{C.log("üß† Assinantes.jsx - Recebido plano:",s);const i=s!=="custom"?Oe(s):{};p?v(n=>{const u={...n,plan:s,permissions:s!=="custom"?i:n.permissions||{}};return C.log("üß† Assinantes.jsx - editingSubscriber atualizado:",u.plan,u.permissions),u}):t(n=>{const u={...n,plan:s,permissions:s!=="custom"?i:{}};return C.log("üß† Assinantes.jsx - newSubscriber atualizado:",u.plan,u.permissions),u})},Y=la(E,300);N.useMemo(()=>{if(!Y)return Q;const s=Y.toLowerCase();return Q.filter(i=>i.email?.toLowerCase().includes(s)||i.name?.toLowerCase().includes(s))},[Q,Y]);const[ts,rs]=N.useState(null),is=N.useMemo(()=>{const s=ts!==null?ts:Q;if(!Y)return s;const i=Y.toLowerCase();return s.filter(n=>n.email?.toLowerCase().includes(i)||n.name?.toLowerCase().includes(i))},[Q,Y,ts]),sa=s=>{rs(s)},aa=s=>s==="custom"?"Personalizado":ds.find(n=>n.slug===s)?.name||s,ta=s=>s==="custom"?"bg-orange-100 text-orange-700":s==="free"?"bg-emerald-100 text-emerald-700":s==="basic"?"bg-blue-100 text-blue-700":s==="pro"?"bg-orange-100 text-orange-700":s==="ultra"?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-700";return x?e.jsx("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:e.jsx(ue,{className:"w-8 h-8 animate-spin text-orange-500"})}):r?.is_master?y?e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx(dt,{subscriber:y,onBack:()=>T(null)})})}):e.jsxs("div",{className:"min-h-screen min-h-screen-mobile bg-gray-50",children:[e.jsx("header",{className:"bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900 text-white shadow-xl",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 py-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ss,{to:us("Admin"),children:e.jsx(f,{variant:"ghost",size:"icon",className:"text-white hover:bg-white/10","aria-label":"Voltar para Admin",children:e.jsx(Qs,{className:"w-5 h-5"})})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Le.div,{whileHover:{rotate:360},transition:{duration:.5},className:"w-12 h-12 bg-gradient-to-br from-orange-400 to-orange-600 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx(ys,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-xl tracking-tight",children:"Gest√£o de Assinantes"}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Gerencie quem tem acesso ao sistema"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ss,{to:us("AdminMasterDashboard"),children:e.jsxs(f,{variant:"ghost",className:"text-white hover:bg-white/10 font-medium",children:[e.jsx(Ba,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Dashboard"})]})}),e.jsx(ut,{onImport:async s=>{let i=0,n=0;for(const u of s)try{await Re.mutateAsync(u),i++}catch(A){C.error("Erro ao importar assinante:",u.email,A),n++}n>0&&k.error(`${n} assinante(s) n√£o puderam ser importado(s)`),i>0&&k.success(`${i} assinante(s) importado(s) com sucesso!`)}}),e.jsx(pt,{subscribers:Q}),e.jsx(Le.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsxs(f,{onClick:()=>g(!0),className:"relative overflow-hidden bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white font-semibold shadow-lg hover:shadow-xl transition-all duration-200",children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Novo Assinante"]})}),e.jsx(Ga,{className:"text-white hover:bg-gray-700"}),e.jsx(Sa,{className:"text-white"})]})]})})}),e.jsx("div",{className:"max-w-6xl mx-auto px-4 -mt-4",children:b&&!de?e.jsx(Nt,{count:4}):b&&de?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4 text-center bg-amber-50 rounded-xl border-2 border-amber-200",children:[e.jsx("p",{className:"text-amber-800 font-medium mb-2",children:"Carregando demorou mais do que o esperado"}),e.jsx("p",{className:"text-amber-700 text-sm mb-4",children:"O servidor pode estar em cold start (at√© 2 min). Aguarde ou tente novamente."}),e.jsxs(f,{onClick:()=>{_(!1),ee()},variant:"outline",className:"gap-2 border-amber-400",children:[e.jsx(ns,{className:"w-4 h-4"}),"Tentar novamente"]})]}):e.jsx(vt,{subscribers:Q})}),e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs(Le.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{delay:.2},className:"relative flex-1 min-w-[250px] max-w-md",children:[e.jsx(Ua,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(F,{placeholder:"Buscar por email ou nome...",value:E,onChange:s=>B(s.target.value),"aria-label":"Buscar assinantes por email ou nome",className:"pl-11 h-11 border-gray-300 focus:border-orange-500 focus:ring-orange-500 transition-all duration-200"})]}),e.jsx(ht,{subscribers:Q,onFilterChange:sa})]}),e.jsxs(Le.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{delay:.3},className:"flex items-center gap-2 flex-wrap bg-white rounded-xl p-3 border-2 border-gray-200 shadow-sm",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 mr-2",children:"Filtro R√°pido:"}),[{label:"Todos",count:Q.length,filter:null,color:"gray"},{label:"Ativos",count:Q.filter(s=>s.status==="active").length,filter:"active",color:"green"},{label:"Inativos",count:Q.filter(s=>s.status==="inactive").length,filter:"inactive",color:"red"},{label:"Gratuitos",count:Q.filter(s=>s.plan==="free"&&s.status==="active").length,filter:"free",color:"green"},{label:"B√°sico",count:Q.filter(s=>s.plan==="basic"&&s.status==="active").length,filter:"basic",color:"blue"},{label:"Pro",count:Q.filter(s=>s.plan==="pro"&&s.status==="active").length,filter:"pro",color:"orange"},{label:"Ultra",count:Q.filter(s=>s.plan==="ultra"&&s.status==="active").length,filter:"ultra",color:"purple"}].map(s=>{const i=ts===null&&s.filter===null,n={gray:"bg-gray-100 text-gray-700 hover:bg-gray-200 border-gray-300",green:"bg-green-50 text-green-700 hover:bg-green-100 border-green-200",red:"bg-red-50 text-red-700 hover:bg-red-100 border-red-200",blue:"bg-blue-50 text-blue-700 hover:bg-blue-100 border-blue-200",orange:"bg-orange-50 text-orange-700 hover:bg-orange-100 border-orange-200",purple:"bg-purple-50 text-purple-700 hover:bg-purple-100 border-purple-200"};return e.jsxs(f,{variant:"outline",size:"sm",className:me("text-xs font-medium transition-all duration-200",n[s.color],i&&"ring-2 ring-offset-2 ring-orange-500"),onClick:()=>{s.filter===null?rs(null):s.filter==="active"||s.filter==="inactive"?rs(Q.filter(u=>u.status===s.filter)):rs(Q.filter(u=>u.plan===s.filter&&u.status==="active"))},children:[s.label,e.jsx(L,{className:"ml-1.5 bg-white/50 text-current border-current/20",children:s.count})]},s.label)})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-md border border-gray-200 overflow-hidden",children:[!b&&is.length>0&&e.jsx(gt,{subscribers:is,selectedIds:Array.from(W),onSelectionChange:s=>ae(new Set(s)),onBulkAction:async(s,i)=>{try{switch(s){case"activate":await Promise.all(i.map(O=>_e.mutateAsync({id:O.id,data:{...O,status:"active"},originalData:O}))),k.success(`${i.length} assinante(s) ativado(s)!`);break;case"deactivate":await Promise.all(i.map(O=>_e.mutateAsync({id:O.id,data:{...O,status:"inactive"},originalData:O}))),k.success(`${i.length} assinante(s) desativado(s)!`);break;case"delete":await Promise.all(i.map(O=>ss.mutateAsync(O.id))),k.success(`${i.length} assinante(s) exclu√≠do(s)!`);break;case"export":const{exportSubscribersToCSV:n,downloadCSV:u}=await ia(async()=>{const{exportSubscribersToCSV:O,downloadCSV:se}=await Promise.resolve().then(()=>xt);return{exportSubscribersToCSV:O,downloadCSV:se}},void 0),A=n(i),q=new Date().toISOString().split("T")[0];u(A,`assinantes_selecionados_${q}.csv`),k.success(`${i.length} assinante(s) exportado(s)!`);break}ae(new Set)}catch(n){C.error("Erro na a√ß√£o em lote:",n),k.error("Erro ao executar a√ß√£o em lote")}}}),Pe?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4 text-center",children:[e.jsx("p",{className:"text-red-600 font-medium mb-2",children:"Erro ao carregar assinantes"}),e.jsx("p",{className:"text-gray-500 text-sm mb-4 max-w-md",children:(()=>{const s=String(Z?.message??"");return s.includes("Acesso negado")||s.includes("MASTER_ONLY")||s.includes("administradores master")?"Acesso negado. Verifique se sua conta possui permiss√£o de Admin Master.":s||"Verifique sua conex√£o ou tente novamente em instantes."})()}),e.jsxs(f,{onClick:()=>ee(),variant:"outline",className:"gap-2",children:[e.jsx(ns,{className:"w-4 h-4"}),"Tentar novamente"]})]}):P?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx(ue,{className:"w-12 h-12 text-blue-500 animate-spin mb-4"}),e.jsx("p",{className:"text-blue-600 font-medium",children:"Iniciando servidor..."}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Aguarde, isso pode levar at√© 60 segundos na primeira vez"})]}):b&&de?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4 text-center",children:[e.jsx(ue,{className:"w-12 h-12 text-orange-500 animate-spin mb-4"}),e.jsx("p",{className:"text-amber-700 font-medium mb-2",children:"Aguardando resposta do servidor..."}),e.jsx("p",{className:"text-gray-500 text-sm mb-4",children:"O servidor est√° iniciando (cold start). Isso pode demorar at√© 2 minutos na primeira vez. Aguarde ou clique abaixo."}),e.jsxs(f,{onClick:()=>{_(!1),ee()},variant:"outline",className:"gap-2",children:[e.jsx(ns,{className:"w-4 h-4"}),"Tentar novamente"]})]}):b?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx(ue,{className:"w-12 h-12 text-orange-500 animate-spin mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando assinantes..."}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Aguarde at√© 2 minutos (cold start do servidor)"})]}):is.length===0?e.jsx(ba,{icon:ys,title:"Nenhum assinante encontrado",description:E?`N√£o encontramos assinantes com "${E}". Tente buscar com outros termos.`:"Adicione seu primeiro assinante para come√ßar a gerenciar o acesso ao sistema.",action:()=>g(!0),actionLabel:"Adicionar Assinante"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"divide-y divide-gray-100",children:is.map((s,i)=>{const n=W.has(s.id);return e.jsx(Le.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:i*.05,duration:.3},className:`p-5 hover:bg-gradient-to-r hover:from-gray-50 hover:to-white transition-all duration-200 ${n?"bg-blue-50 border-l-4 border-blue-500":""}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(f,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>{const u=new Set(W);n?u.delete(s.id):u.add(s.id),ae(u)},children:n?e.jsx(Ws,{className:"w-5 h-5 text-blue-600"}):e.jsx(Ys,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(Le.div,{whileHover:{scale:1.1},className:`relative w-12 h-12 rounded-full flex items-center justify-center shadow-md ${s.status==="active"?"bg-gradient-to-br from-green-400 to-green-600":"bg-gradient-to-br from-gray-300 to-gray-400"}`,children:[s.name?e.jsx("span",{className:"text-white font-semibold text-sm",children:s.name.charAt(0).toUpperCase()}):e.jsx(Qa,{className:"w-6 h-6 text-white"}),s.status==="active"&&e.jsx("span",{className:"absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 bg-green-500 border-2 border-white rounded-full"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:s.name||s.email}),e.jsx(L,{className:`text-xs font-medium px-2 py-0.5 ${ta(s.plan)} shadow-sm`,children:aa(s.plan)})]}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),s.phone&&e.jsxs("p",{className:"text-xs text-gray-500 flex items-center gap-1 mt-0.5",children:[e.jsx(hs,{className:"w-3 h-3"})," ",s.phone]}),Array.isArray(s.tags)&&s.tags.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[s.tags.slice(0,3).map(u=>e.jsx(L,{variant:"outline",className:"text-[10px] py-0 px-1.5",children:u},u)),s.tags.length>3&&e.jsxs("span",{className:"text-xs text-gray-400",children:["+",s.tags.length-3]})]}),s.linked_user_email&&e.jsxs("p",{className:"text-xs text-blue-600 flex items-center gap-1 mt-1",children:["üîó Acesso: ",s.linked_user_email]}),s.expires_at&&e.jsxs("div",{className:"mt-2",children:[e.jsx(mt,{expiresAt:s.expires_at}),e.jsxs("p",{className:"text-xs text-gray-400 flex items-center gap-1 mt-1",children:[e.jsx(fs,{className:"w-3 h-3"}),"Renova√ß√£o: ",Va(s.expires_at)]})]}),e.jsx("div",{className:"mt-2 space-y-1",children:s.has_password?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-green-50 border border-green-200 rounded px-2 py-1",children:[e.jsx(qe,{className:"w-3 h-3 text-green-600"}),e.jsx("span",{className:"text-xs text-green-700",children:"Senha j√° definida"})]}),e.jsxs(f,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs bg-orange-500 text-white hover:bg-orange-600",onClick:()=>ms(s),disabled:Ie.isPending,children:[e.jsx(ns,{className:`w-3 h-3 mr-1 ${Ie.isPending?"animate-spin":""}`}),"Resetar Senha"]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-yellow-50 border border-yellow-200 rounded px-2 py-1",children:[e.jsx(na,{className:"w-3 h-3 text-yellow-600"}),e.jsx("span",{className:"text-xs text-yellow-700",children:"Senha pendente"})]}),e.jsx("span",{className:"text-xs text-gray-500 italic",children:"(Link enviado por e-mail)"})]})})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:me("font-medium px-3 py-1 shadow-sm",s.status==="active"?"bg-gradient-to-r from-green-500 to-green-600 text-white":"bg-gradient-to-r from-red-500 to-red-600 text-white"),children:s.status==="active"?"Ativo":"Inativo"}),e.jsxs(Vs,{children:[e.jsx(Is,{asChild:!0,children:e.jsx(f,{variant:"ghost",size:"icon",className:"h-8 w-8","aria-label":"Menu de op√ß√µes",children:e.jsx(wa,{className:"w-4 h-4"})})}),e.jsxs(Gs,{align:"end",children:[s.slug&&e.jsxs(he,{onClick:()=>window.open(`/s/${s.slug}`,"_blank","noopener"),children:[e.jsx(_a,{className:"w-4 h-4 mr-2"}),"Abrir card√°pio"]}),e.jsxs(he,{onClick:()=>T(s),children:[e.jsx(qs,{className:"w-4 h-4 mr-2"}),"Ver Dados Completos"]}),e.jsxs(he,{onClick:()=>X(s),children:[e.jsx(Es,{className:"w-4 h-4 mr-2"}),"Editar Assinatura"]}),e.jsx(he,{onClick:()=>ps(s),children:s.status==="active"?e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Desativar Assinatura"]}):e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Ativar Assinatura"]})}),e.jsxs(he,{onClick:()=>{t({email:"",linked_user_email:s.linked_user_email||"",name:s.name?`${s.name} (c√≥pia)`:"",slug:"",plan:s.plan||"basic",status:s.status||"active",expires_at:s.expires_at||"",permissions:s.permissions||Oe(s.plan||"basic"),phone:s.phone||"",cnpj_cpf:s.cnpj_cpf||"",origem:s.origem||"manual",tags:Array.isArray(s.tags)?[...s.tags]:[],notes:s.notes||""}),g(!0),k.success("Dados copiados. Informe um novo email e salve.")},children:[e.jsx(Ks,{className:"w-4 h-4 mr-2"}),"Duplicar"]}),e.jsxs(he,{onClick:()=>re(s),className:"text-red-600","aria-label":`Excluir assinante ${s.name||s.email}`,children:[e.jsx(ze,{className:"w-4 h-4 mr-2"}),"Excluir"]})]})]})]})]})},s.id)})}),pe&&pe.totalPages>1&&e.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-t border-gray-200 bg-gray-50/50",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["P√°gina ",pe.page," de ",pe.totalPages," (",pe.total," assinantes)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>$(s=>Math.max(1,s-1)),disabled:pe.page<=1||b,"aria-label":"P√°gina anterior",children:[e.jsx(Ha,{className:"w-4 h-4"}),"Anterior"]}),e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>$(s=>Math.min(pe.totalPages,s+1)),disabled:pe.page>=pe.totalPages||b,"aria-label":"Pr√≥xima p√°gina",children:["Pr√≥xima",e.jsx(Ja,{className:"w-4 h-4"})]})]})]})]})]})]}),e.jsx(ve,{open:c,onOpenChange:g,children:e.jsxs(fe,{className:"sm:max-w-md max-h-[90vh] overflow-y-auto animate-in fade-in-0 zoom-in-95 duration-200",children:[e.jsx(ye,{children:e.jsxs(Ne,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-5 h-5 text-orange-500"}),"Adicionar Assinante"]})}),e.jsx(Ca,{children:e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Email da Assinatura *"}),e.jsxs(Be,{children:[e.jsx(Ue,{asChild:!0,children:e.jsx(We,{className:"w-4 h-4 text-gray-400 cursor-help"})}),e.jsx(Qe,{children:e.jsx("p",{className:"max-w-xs",children:"Email principal do titular da assinatura. Ser√° usado para login e identifica√ß√£o."})})]})]}),e.jsx(F,{type:"email",placeholder:"email@exemplo.com",value:h.email,onChange:s=>t({...h,email:s.target.value}),autoFocus:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Email do titular da assinatura"})]}),e.jsxs("div",{"data-field":"email-acesso",className:"border-l-2 border-orange-200 pl-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",htmlFor:"linked_user_email",children:"Email de Acesso / Email personalizado (opcional)"}),e.jsxs(Be,{children:[e.jsx(Ue,{asChild:!0,children:e.jsx(We,{className:"w-4 h-4 text-gray-400 cursor-help"})}),e.jsx(Qe,{children:e.jsx("p",{className:"max-w-xs",children:"Se diferente do email da assinatura, informe aqui o email que ter√° acesso ao painel. Deixe vazio para usar o mesmo email."})})]})]}),e.jsx(F,{id:"linked_user_email",type:"email",placeholder:"email@exemplo.com",value:h.linked_user_email||"",onChange:s=>t({...h,linked_user_email:s.target.value})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Se diferente, informe o email do usu√°rio que ter√° acesso ao painel"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Nome"}),e.jsxs(Be,{children:[e.jsx(Ue,{asChild:!0,children:e.jsx(We,{className:"w-4 h-4 text-gray-400 cursor-help"})}),e.jsx(Qe,{children:e.jsx("p",{children:"Nome completo ou comercial do assinante. Ser√° exibido no dashboard e relat√≥rios."})})]})]}),e.jsx(F,{placeholder:"Nome do assinante",value:h.name,onChange:s=>t({...h,name:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Status"}),e.jsxs(ne,{value:h.status,onValueChange:s=>t({...h,status:s}),children:[e.jsx(le,{children:e.jsx(oe,{})}),e.jsxs(ce,{children:[e.jsx(M,{value:"active",children:"Ativo"}),e.jsx(M,{value:"inactive",children:"Inativo"}),e.jsx(M,{value:"pending",children:"Pendente"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 mb-1 block flex items-center gap-1",children:[e.jsx(hs,{className:"w-4 h-4 text-orange-500"}),"Telefone"]}),e.jsx(F,{placeholder:"(00) 00000-0000",value:h.phone||"",onChange:s=>t({...h,phone:s.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 mb-1 block flex items-center gap-1",children:[e.jsx(Ps,{className:"w-4 h-4 text-orange-500"}),"CNPJ/CPF"]}),e.jsx(F,{placeholder:"00.000.000/0001-00",value:h.cnpj_cpf||"",onChange:s=>t({...h,cnpj_cpf:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Origem"}),e.jsxs(ne,{value:h.origem||"manual",onValueChange:s=>t({...h,origem:s}),children:[e.jsx(le,{children:e.jsx(oe,{})}),e.jsxs(ce,{children:[e.jsx(M,{value:"manual",children:"Manual"}),e.jsx(M,{value:"import",children:"Importa√ß√£o CSV"}),e.jsx(M,{value:"landing",children:"Landing Page"}),e.jsx(M,{value:"indicacao",children:"Indica√ß√£o"}),e.jsx(M,{value:"outro",children:"Outro"})]})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 flex items-center gap-1",children:[e.jsx(As,{className:"w-4 h-4 text-orange-500"}),"Link do card√°pio"]}),e.jsxs(Be,{children:[e.jsx(Ue,{asChild:!0,children:e.jsx(We,{className:"w-4 h-4 text-gray-400 cursor-help"})}),e.jsx(Qe,{children:e.jsx("p",{className:"max-w-xs",children:"Parte final da URL do card√°pio: /s/meu-restaurante. Apenas letras min√∫sculas, n√∫meros e h√≠fen. Deixe vazio para o assinante definir depois em Loja."})})]})]}),e.jsx(F,{placeholder:"ex: meu-restaurante",value:h.slug||"",onChange:s=>t({...h,slug:s.target.value}),onBlur:s=>t(i=>({...i,slug:De(i.slug)})),className:"font-mono"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["URL: /s/",e.jsx("span",{className:"font-mono",children:De(h.slug)||"..."})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 mb-1 block flex items-center gap-1",children:[e.jsx(Ds,{className:"w-4 h-4 text-orange-500"}),"Tags (separadas por v√≠rgula)"]}),e.jsx(F,{placeholder:"ex: beta, parceiro, vip",value:Array.isArray(h.tags)?h.tags.join(", "):"",onChange:s=>{const i=(s.target.value||"").split(",").map(n=>n.trim()).filter(Boolean);t({...h,tags:i})}})]}),e.jsx(Rs,{onSelectTemplate:s=>{t({...h,permissions:s.permissions,plan:"custom"}),k.success(`Template "${s.name}" aplicado!`)}}),e.jsx(zs,{permissions:h.permissions,onChange:s=>t({...h,permissions:s}),selectedPlan:h.plan,onPlanChange:H}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Data de Expira√ß√£o"}),e.jsxs(Be,{children:[e.jsx(Ue,{asChild:!0,children:e.jsx(We,{className:"w-4 h-4 text-gray-400 cursor-help"})}),e.jsx(Qe,{children:e.jsx("p",{className:"max-w-xs",children:"Data em que a assinatura expira. Deixe vazio para permanente."})})]})]}),e.jsx(F,{type:"date",value:h.expires_at,onChange:s=>t({...h,expires_at:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Observa√ß√µes"}),e.jsx(F,{placeholder:"Notas internas...",value:h.notes||"",onChange:s=>t({...h,notes:s.target.value})})]})]})]})}),e.jsxs(Ze,{children:[e.jsx(f,{variant:"outline",onClick:()=>g(!1),children:"Cancelar"}),e.jsxs(f,{onClick:Ce,disabled:!h.email||Re.isPending,className:"bg-orange-500 hover:bg-orange-600",children:[Re.isPending?e.jsx(ue,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Adicionar"]})]})]})}),e.jsx(ve,{open:m,onOpenChange:j,children:e.jsxs(fe,{size:"large",className:"max-h-[90vh] overflow-y-auto",children:[e.jsxs(ye,{children:[e.jsxs(Ne,{className:"flex items-center gap-2",children:[e.jsx(Es,{className:"w-5 h-5 text-orange-500"}),"Editar Assinante"]}),e.jsx($s,{children:"Edite as informa√ß√µes e permiss√µes do assinante"})]}),p&&e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Email da Assinatura"}),e.jsx(F,{type:"email",value:p.email,disabled:!0,className:"bg-gray-50"})]}),e.jsxs("div",{"data-field":"email-acesso",className:"border-l-2 border-orange-200 pl-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",htmlFor:"edit-linked_user_email",children:"Email de Acesso / Email personalizado"}),e.jsx(F,{id:"edit-linked_user_email",type:"email",placeholder:"Se diferente do email da assinatura",value:p.linked_user_email||"",onChange:s=>v({...p,linked_user_email:s.target.value})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Email do usu√°rio que ter√° acesso ao painel (deixe vazio se for o mesmo da assinatura)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Nome"}),e.jsx(F,{value:p.name||"",onChange:s=>v({...p,name:s.target.value})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 mb-1 block flex items-center gap-1",children:[e.jsx(As,{className:"w-4 h-4 text-orange-500"}),"Link do card√°pio"]}),e.jsx(F,{placeholder:"ex: meu-restaurante",value:p.slug||"",onChange:s=>v({...p,slug:s.target.value}),onBlur:s=>v(i=>({...i,slug:De(i.slug)})),className:"font-mono"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["URL: /s/",e.jsx("span",{className:"font-mono",children:De(p.slug)||"..."})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 mb-1 block flex items-center gap-1",children:[e.jsx(hs,{className:"w-4 h-4 text-orange-500"}),"Telefone"]}),e.jsx(F,{placeholder:"(00) 00000-0000",value:p.phone||"",onChange:s=>v({...p,phone:s.target.value})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 mb-1 block flex items-center gap-1",children:[e.jsx(Ps,{className:"w-4 h-4 text-orange-500"}),"CNPJ/CPF"]}),e.jsx(F,{placeholder:"00.000.000/0001-00",value:p.cnpj_cpf||"",onChange:s=>v({...p,cnpj_cpf:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Origem"}),e.jsxs(ne,{value:p.origem||"manual",onValueChange:s=>v({...p,origem:s}),children:[e.jsx(le,{children:e.jsx(oe,{})}),e.jsxs(ce,{children:[e.jsx(M,{value:"manual",children:"Manual"}),e.jsx(M,{value:"import",children:"Importa√ß√£o CSV"}),e.jsx(M,{value:"landing",children:"Landing Page"}),e.jsx(M,{value:"indicacao",children:"Indica√ß√£o"}),e.jsx(M,{value:"outro",children:"Outro"})]})]})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 mb-1 block flex items-center gap-1",children:[e.jsx(Ds,{className:"w-4 h-4 text-orange-500"}),"Tags (separadas por v√≠rgula)"]}),e.jsx(F,{placeholder:"ex: beta, parceiro",value:Array.isArray(p.tags)?p.tags.join(", "):"",onChange:s=>{const i=(s.target.value||"").split(",").map(n=>n.trim()).filter(Boolean);v({...p,tags:i})}})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Status"}),e.jsxs(ne,{value:p.status,onValueChange:s=>v({...p,status:s}),children:[e.jsx(le,{children:e.jsx(oe,{})}),e.jsxs(ce,{children:[e.jsx(M,{value:"active",children:"Ativo"}),e.jsx(M,{value:"inactive",children:"Inativo"}),e.jsx(M,{value:"pending",children:"Pendente"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Data de Expira√ß√£o"}),e.jsx(F,{type:"date",value:p.expires_at||"",onChange:s=>v({...p,expires_at:s.target.value})})]})]}),e.jsx(Rs,{onSelectTemplate:s=>{v({...p,permissions:s.permissions,plan:"custom"}),k.success(`Template "${s.name}" aplicado!`)}}),e.jsx(zs,{permissions:p.permissions,onChange:s=>{C.log("üîÑ Permissions onChange - Antes:",p.plan),v(i=>{C.log("üîÑ Permissions onChange - Prev plan:",i.plan);const n={...i,permissions:s};return C.log("üîÑ Permissions onChange - Depois:",n.plan),n})},selectedPlan:p.plan,onPlanChange:H}),a.length>0&&e.jsxs("div",{className:"space-y-2 pt-4 border-t",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Hist√≥rico de Altera√ß√µes"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-3 max-h-40 overflow-y-auto space-y-2",children:a.map(s=>e.jsxs("div",{className:"text-xs bg-white p-2 rounded border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-medium text-gray-700",children:s.description}),e.jsx("span",{className:"text-gray-400",children:(()=>{const i=new Date(s.created_date),n=String(i.getDate()).padStart(2,"0"),u=String(i.getMonth()+1).padStart(2,"0"),A=i.getFullYear(),q=String(i.getHours()).padStart(2,"0"),O=String(i.getMinutes()).padStart(2,"0");return`${n}/${u}/${A} ${q}:${O}`})()})]}),e.jsxs("p",{className:"text-gray-500",children:["Por: ",s.changed_by]})]},s.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Observa√ß√µes"}),e.jsx("textarea",{value:p.notes||"",onChange:s=>v({...p,notes:s.target.value}),className:"w-full border rounded-lg p-2 text-sm",rows:3,placeholder:"Notas internas sobre o assinante..."})]})]}),e.jsxs(Ze,{children:[e.jsx(f,{variant:"outline",onClick:()=>j(!1),children:"Cancelar"}),e.jsxs(f,{onClick:I,disabled:_e.isPending,className:"bg-orange-500 hover:bg-orange-600",children:[_e.isPending?e.jsx(ue,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Salvar"]})]})]})}),e.jsx(jt,{open:te.open,onClose:()=>be({open:!1,url:null,name:null}),setupUrl:te.url,subscriberName:te.name}),e.jsx(oa,{open:!!ie,onOpenChange:s=>!s&&re(null),children:e.jsxs(ca,{children:[e.jsxs(da,{children:[e.jsx(ma,{children:"Excluir assinante?"}),e.jsxs(xa,{children:["Esta a√ß√£o √© irrevers√≠vel. O assinante ",e.jsx("strong",{children:ie?.name||ie?.email})," e todos os dados associados ser√£o removidos. Considerar desativar em vez de excluir para preservar o hist√≥rico."]})]}),e.jsxs(pa,{children:[e.jsx(ua,{children:"Cancelar"}),e.jsx(ha,{className:"bg-red-600 hover:bg-red-700",onClick:()=>{ie&&(ss.mutate(ie.id),re(null))},children:"Excluir"})]})]})})]}):null}export{kr as default};
