var dt=e=>{throw TypeError(e)};var $=(e,t,s)=>t.has(e)||dt("Cannot "+s);var r=(e,t,s)=>($(e,t,"read from private field"),s?s.call(e):t.get(e)),f=(e,t,s)=>t.has(e)?dt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),c=(e,t,s,i)=>($(e,t,"write to private field"),i?i.call(e,s):t.set(e,s),s),u=(e,t,s)=>($(e,t,"access private method"),s);import{M as Ct,Z as ft,$ as g,N as G,a0 as B,V as J,a1 as X,a2 as pt,a3 as It,a4 as W,a5 as Tt,a6 as wt,a7 as bt,U as yt,r as E,W as St,u as Mt}from"./main-BRmc9wuQ.js";var v,a,A,R,M,U,O,C,j,F,D,Q,x,I,k,n,N,Y,q,tt,et,st,rt,it,Ot,gt,Qt=(gt=class extends Ct{constructor(t,s){super();f(this,n);f(this,v);f(this,a);f(this,A);f(this,R);f(this,M);f(this,U);f(this,O);f(this,C);f(this,j);f(this,F);f(this,D);f(this,Q);f(this,x);f(this,I);f(this,k,new Set);this.options=s,c(this,v,t),c(this,C,null),c(this,O,ft()),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(r(this,a).addObserver(this),Rt(r(this,a),this.options)?u(this,n,N).call(this):this.updateResult(),u(this,n,et).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return at(r(this,a),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return at(r(this,a),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,u(this,n,st).call(this),u(this,n,rt).call(this),r(this,a).removeObserver(this)}setOptions(t){const s=this.options,i=r(this,a);if(this.options=r(this,v).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof g(this.options.enabled,r(this,a))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");u(this,n,it).call(this),r(this,a).setOptions(this.options),s._defaulted&&!G(this.options,s)&&r(this,v).getQueryCache().notify({type:"observerOptionsUpdated",query:r(this,a),observer:this});const o=this.hasListeners();o&&vt(r(this,a),i,this.options,s)&&u(this,n,N).call(this),this.updateResult(),o&&(r(this,a)!==i||g(this.options.enabled,r(this,a))!==g(s.enabled,r(this,a))||B(this.options.staleTime,r(this,a))!==B(s.staleTime,r(this,a)))&&u(this,n,Y).call(this);const l=u(this,n,q).call(this);o&&(r(this,a)!==i||g(this.options.enabled,r(this,a))!==g(s.enabled,r(this,a))||l!==r(this,I))&&u(this,n,tt).call(this,l)}getOptimisticResult(t){const s=r(this,v).getQueryCache().build(r(this,v),t),i=this.createResult(s,t);return _t(this,i)&&(c(this,R,i),c(this,U,this.options),c(this,M,r(this,a).state)),i}getCurrentResult(){return r(this,R)}trackResult(t,s){return new Proxy(t,{get:(i,o)=>(this.trackProp(o),s?.(o),o==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&r(this,O).status==="pending"&&r(this,O).reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(i,o))})}trackProp(t){r(this,k).add(t)}getCurrentQuery(){return r(this,a)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const s=r(this,v).defaultQueryOptions(t),i=r(this,v).getQueryCache().build(r(this,v),s);return i.fetch().then(()=>this.createResult(i,s))}fetch(t){return u(this,n,N).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),r(this,R)))}createResult(t,s){const i=r(this,a),o=this.options,l=r(this,R),h=r(this,M),T=r(this,U),p=t!==i?t.state:r(this,A),{state:y}=t;let d={...y},L=!1,b;if(s._optimisticResults){const m=this.hasListeners(),H=!m&&Rt(t,s),P=m&&vt(t,i,s,o);(H||P)&&(d={...d,...wt(y.data,t.options)}),s._optimisticResults==="isRestoring"&&(d.fetchStatus="idle")}let{error:ot,errorUpdatedAt:ht,status:w}=d;b=d.data;let ct=!1;if(s.placeholderData!==void 0&&b===void 0&&w==="pending"){let m;l?.isPlaceholderData&&s.placeholderData===T?.placeholderData?(m=l.data,ct=!0):m=typeof s.placeholderData=="function"?s.placeholderData(r(this,D)?.state.data,r(this,D)):s.placeholderData,m!==void 0&&(w="success",b=bt(l?.data,m,s),L=!0)}if(s.select&&b!==void 0&&!ct)if(l&&b===h?.data&&s.select===r(this,j))b=r(this,F);else try{c(this,j,s.select),b=s.select(b),b=bt(l?.data,b,s),c(this,F,b),c(this,C,null)}catch(m){c(this,C,m)}r(this,C)&&(ot=r(this,C),b=r(this,F),ht=Date.now(),w="error");const z=d.fetchStatus==="fetching",K=w==="pending",Z=w==="error",ut=K&&z,lt=b!==void 0,S={status:w,fetchStatus:d.fetchStatus,isPending:K,isSuccess:w==="success",isError:Z,isInitialLoading:ut,isLoading:ut,data:b,dataUpdatedAt:d.dataUpdatedAt,error:ot,errorUpdatedAt:ht,failureCount:d.fetchFailureCount,failureReason:d.fetchFailureReason,errorUpdateCount:d.errorUpdateCount,isFetched:d.dataUpdateCount>0||d.errorUpdateCount>0,isFetchedAfterMount:d.dataUpdateCount>p.dataUpdateCount||d.errorUpdateCount>p.errorUpdateCount,isFetching:z,isRefetching:z&&!K,isLoadingError:Z&&!lt,isPaused:d.fetchStatus==="paused",isPlaceholderData:L,isRefetchError:Z&&lt,isStale:nt(t,s),refetch:this.refetch,promise:r(this,O),isEnabled:g(s.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const m=V=>{S.status==="error"?V.reject(S.error):S.data!==void 0&&V.resolve(S.data)},H=()=>{const V=c(this,O,S.promise=ft());m(V)},P=r(this,O);switch(P.status){case"pending":t.queryHash===i.queryHash&&m(P);break;case"fulfilled":(S.status==="error"||S.data!==P.value)&&H();break;case"rejected":(S.status!=="error"||S.error!==P.reason)&&H();break}}return S}updateResult(){const t=r(this,R),s=this.createResult(r(this,a),this.options);if(c(this,M,r(this,a).state),c(this,U,this.options),r(this,M).data!==void 0&&c(this,D,r(this,a)),G(s,t))return;c(this,R,s);const i=()=>{if(!t)return!0;const{notifyOnChangeProps:o}=this.options,l=typeof o=="function"?o():o;if(l==="all"||!l&&!r(this,k).size)return!0;const h=new Set(l??r(this,k));return this.options.throwOnError&&h.add("error"),Object.keys(r(this,R)).some(T=>{const _=T;return r(this,R)[_]!==t[_]&&h.has(_)})};u(this,n,Ot).call(this,{listeners:i()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&u(this,n,et).call(this)}},v=new WeakMap,a=new WeakMap,A=new WeakMap,R=new WeakMap,M=new WeakMap,U=new WeakMap,O=new WeakMap,C=new WeakMap,j=new WeakMap,F=new WeakMap,D=new WeakMap,Q=new WeakMap,x=new WeakMap,I=new WeakMap,k=new WeakMap,n=new WeakSet,N=function(t){u(this,n,it).call(this);let s=r(this,a).fetch(this.options,t);return t?.throwOnError||(s=s.catch(J)),s},Y=function(){u(this,n,st).call(this);const t=B(this.options.staleTime,r(this,a));if(X||r(this,R).isStale||!pt(t))return;const i=It(r(this,R).dataUpdatedAt,t)+1;c(this,Q,W.setTimeout(()=>{r(this,R).isStale||this.updateResult()},i))},q=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(r(this,a)):this.options.refetchInterval)??!1},tt=function(t){u(this,n,rt).call(this),c(this,I,t),!(X||g(this.options.enabled,r(this,a))===!1||!pt(r(this,I))||r(this,I)===0)&&c(this,x,W.setInterval(()=>{(this.options.refetchIntervalInBackground||Tt.isFocused())&&u(this,n,N).call(this)},r(this,I)))},et=function(){u(this,n,Y).call(this),u(this,n,tt).call(this,u(this,n,q).call(this))},st=function(){r(this,Q)&&(W.clearTimeout(r(this,Q)),c(this,Q,void 0))},rt=function(){r(this,x)&&(W.clearInterval(r(this,x)),c(this,x,void 0))},it=function(){const t=r(this,v).getQueryCache().build(r(this,v),this.options);if(t===r(this,a))return;const s=r(this,a);c(this,a,t),c(this,A,t.state),this.hasListeners()&&(s?.removeObserver(this),t.addObserver(this))},Ot=function(t){yt.batch(()=>{t.listeners&&this.listeners.forEach(s=>{s(r(this,R))}),r(this,v).getQueryCache().notify({query:r(this,a),type:"observerResultsUpdated"})})},gt);function xt(e,t){return g(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function Rt(e,t){return xt(e,t)||e.state.data!==void 0&&at(e,t,t.refetchOnMount)}function at(e,t,s){if(g(t.enabled,e)!==!1&&B(t.staleTime,e)!=="static"){const i=typeof s=="function"?s(e):s;return i==="always"||i!==!1&&nt(e,t)}return!1}function vt(e,t,s,i){return(e!==t||g(i.enabled,e)===!1)&&(!s.suspense||e.state.status!=="error")&&nt(e,s)}function nt(e,t){return g(t.enabled,e)!==!1&&e.isStaleByTime(B(t.staleTime,e))}function _t(e,t){return!G(e.getCurrentResult(),t)}var Et=E.createContext(!1),Pt=()=>E.useContext(Et);Et.Provider;function Ut(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var Ft=E.createContext(Ut()),Dt=()=>E.useContext(Ft),kt=(e,t,s)=>{const i=s?.state.error&&typeof e.throwOnError=="function"?St(e.throwOnError,[s.state.error,s]):e.throwOnError;(e.suspense||e.experimental_prefetchInRender||i)&&(t.isReset()||(e.retryOnMount=!1))},Lt=e=>{E.useEffect(()=>{e.clearReset()},[e])},Nt=({result:e,errorResetBoundary:t,throwOnError:s,query:i,suspense:o})=>e.isError&&!t.isReset()&&!e.isFetching&&i&&(o&&e.data===void 0||St(s,[e.error,i])),Bt=e=>{if(e.suspense){const s=o=>o==="static"?o:Math.max(o??1e3,1e3),i=e.staleTime;e.staleTime=typeof i=="function"?(...o)=>s(i(...o)):s(i),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},At=(e,t)=>e.isLoading&&e.isFetching&&!t,jt=(e,t)=>e?.suspense&&t.isPending,mt=(e,t,s)=>t.fetchOptimistic(e).catch(()=>{s.clearReset()});function Ht(e,t,s){const i=Pt(),o=Dt(),l=Mt(),h=l.defaultQueryOptions(e);l.getDefaultOptions().queries?._experimental_beforeQuery?.(h);const T=l.getQueryCache().get(h.queryHash);h._optimisticResults=i?"isRestoring":"optimistic",Bt(h),kt(h,o,T),Lt(o);const _=!l.getQueryCache().get(h.queryHash),[p]=E.useState(()=>new t(l,h)),y=p.getOptimisticResult(h),d=!i&&e.subscribed!==!1;if(E.useSyncExternalStore(E.useCallback(L=>{const b=d?p.subscribe(yt.batchCalls(L)):J;return p.updateResult(),b},[p,d]),()=>p.getCurrentResult(),()=>p.getCurrentResult()),E.useEffect(()=>{p.setOptions(h)},[h,p]),jt(h,y))throw mt(h,p,o);if(Nt({result:y,errorResetBoundary:o,throwOnError:h.throwOnError,query:T,suspense:h.suspense}))throw y.error;return l.getDefaultOptions().queries?._experimental_afterQuery?.(h,y),h.experimental_prefetchInRender&&!X&&At(y,i)&&(_?mt(h,p,o):T?.promise)?.catch(J).finally(()=>{p.updateResult()}),h.notifyOnChangeProps?y:p.trackResult(y)}function Kt(e,t){return Ht(e,Qt)}export{Kt as u};
