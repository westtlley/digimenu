import{c as x,r as p,u as m,z as y,j as c}from"./main-AonIQAES.js";import{l as g}from"./index-CL3SdtP1.js";import{B as v}from"./bell-VrVpKCOv.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],h=x("Pen",j),S="wss://digimenu-backend.onrender.com";function w({subscriberEmail:t=null,customerEmail:s=null,customerPhone:a=null,tableId:r=null,tableNumber:l=null,onComandaUpdate:i=null,onComandaCreated:u=null,enableNotifications:f=!0}){const e=p.useRef(null),d=m();return p.useEffect(()=>{if(!t&&!s&&!a&&!r&&!l)return;e.current=g(S,{transports:["websocket","polling"],reconnection:!0,reconnectionDelay:2e3,reconnectionAttempts:5});const n=e.current;return n.on("connect",()=>{console.log("âœ… WebSocket Comandas conectado:",n.id),n.emit("subscribe:comandas",{subscriberEmail:t,customerEmail:s,customerPhone:a,tableId:r,tableNumber:l})}),n.on("disconnect",()=>{console.log("âŒ WebSocket Comandas desconectado")}),n.on("connect_error",()=>{console.warn("âš ï¸ WebSocket Comandas indisponÃ­vel â€” usando polling como fallback.")}),n.on("comanda:updated",o=>{if(console.log("ðŸ“‹ Comanda atualizada via WebSocket:",o),d.invalidateQueries({queryKey:["Comanda"]}),i&&i(o),f&&s){const k=Array.isArray(o.items)?o.items.length:0;y.success(c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(v,{className:"w-5 h-5"}),c.jsxs("div",{children:[c.jsx("p",{className:"font-bold",children:"Comanda atualizada!"}),c.jsxs("p",{className:"text-sm",children:["Total de itens: ",k]})]})]}),{duration:3e3})}}),n.on("comanda:created",o=>{console.log("ðŸ“‹ Nova comanda via WebSocket:",o),d.invalidateQueries({queryKey:["Comanda"]}),u&&u(o)}),()=>{e.current&&(e.current.emit("unsubscribe:comandas",{subscriberEmail:t,customerEmail:s,customerPhone:a,tableId:r,tableNumber:l}),e.current.disconnect(),e.current=null)}},[t,s,a,r,l,i,u,f,d]),e.current}export{h as P,w as u};
