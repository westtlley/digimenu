import{P as l,j as e,B as k,r as g,L as P,d as v}from"./main-5wCJ0shd.js";import{u as C}from"./useQuery-TBRlwA9F.js";import{T as h}from"./truck-BfUKktyx.js";import{S as E}from"./store-DBfh0a_B.js";import{M as f}from"./map-pin-Cc9ILfAa.js";import{C as x}from"./circle-check-big-C21gM6y_.js";import{C as j}from"./clock-8p17jiPd.js";import{m as _}from"./proxy-CaN4jGBq.js";import{B}from"./badge-tC6tpDVj.js";import{P as $}from"./phone-DEvhMYo9.js";const w=[{key:"going_to_store",label:"Indo ao Restaurante",icon:h,color:"blue"},{key:"arrived_at_store",label:"No Restaurante",icon:E,color:"yellow"},{key:"picked_up",label:"Pedido Coletado",icon:l,color:"green"},{key:"out_for_delivery",label:"A Caminho",icon:h,color:"blue"},{key:"arrived_at_customer",label:"Chegou",icon:f,color:"green"},{key:"delivered",label:"Entregue",icon:x,color:"green"}];function S({currentStatus:s,eta:r,distance:t}){const i=w.findIndex(o=>o.key===s),n=()=>{switch(s){case"going_to_store":return r?`Entregador chegando ao restaurante em ~${r} minutos`:"Entregador indo buscar seu pedido";case"arrived_at_store":return"Entregador aguardando coleta no restaurante";case"picked_up":return"Pedido coletado! Entregador saindo para entrega";case"out_for_delivery":return r?`Entregador chegando em ~${r} minutos`:"Entregador a caminho do endere√ßo de entrega";case"arrived_at_customer":return"Entregador chegou! Prepare-se para receber o pedido";case"delivered":return"Pedido entregue com sucesso!";default:return"Acompanhando entrega..."}};return e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 border",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${s==="delivered"?"bg-green-500":"bg-blue-500"}`,children:e.jsx(j,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-900",children:n()}),t&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Dist√¢ncia: ",t]})]})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-6 top-0 bottom-0 w-0.5 bg-gray-200"}),e.jsx(_.div,{className:"absolute left-6 top-0 w-0.5 bg-blue-500",initial:{height:0},animate:{height:`${i/(w.length-1)*100}%`},transition:{duration:.5}}),e.jsx("div",{className:"relative space-y-6",children:w.map((o,c)=>{const d=o.icon,m=c<=i,u=c===i;return e.jsxs(_.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:c*.1},className:"flex items-center gap-4",children:[e.jsx("div",{className:`relative z-10 w-12 h-12 rounded-full flex items-center justify-center border-4 border-white ${m?o.color==="green"?"bg-green-500":o.color==="yellow"?"bg-yellow-500":"bg-blue-500":"bg-gray-200"} ${u?"ring-4 ring-blue-200 animate-pulse":""}`,children:e.jsx(d,{className:`w-5 h-5 ${m?"text-white":"text-gray-400"}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`font-semibold ${m?"text-gray-900":"text-gray-400"}`,children:o.label}),u&&r&&e.jsxs("p",{className:"text-sm text-blue-600 font-medium",children:["~",r," minutos"]})]})]},o.key)})})]}),r&&s!=="delivered"&&e.jsx(_.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Tempo estimado"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["~",r," min"]})]}),e.jsx("div",{className:"w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx(h,{className:"w-8 h-8 text-white animate-bounce"})})]})})]})}function I({order:s,entregador:r,eta:t,distance:i}){const o=(()=>{switch(s.status){case"going_to_store":return{icon:h,title:"Entregador Indo ao Restaurante",subtitle:t?`Chegando em ~${t} minutos`:"Buscando seu pedido",color:"from-blue-500 to-blue-600",iconBg:"bg-blue-100",iconColor:"text-blue-600"};case"arrived_at_store":return{icon:E,title:"Entregador no Restaurante",subtitle:"Aguardando coleta do pedido",color:"from-yellow-500 to-yellow-600",iconBg:"bg-yellow-100",iconColor:"text-yellow-600"};case"picked_up":return{icon:l,title:"Pedido Coletado!",subtitle:"Entregador saindo para entrega",color:"from-green-500 to-green-600",iconBg:"bg-green-100",iconColor:"text-green-600"};case"out_for_delivery":return{icon:h,title:"Pedido a Caminho",subtitle:t?`Chegando em ~${t} minutos`:"Indo para o endere√ßo de entrega",color:"from-blue-500 to-blue-600",iconBg:"bg-blue-100",iconColor:"text-blue-600"};case"arrived_at_customer":return{icon:f,title:"Entregador Chegou!",subtitle:"Prepare-se para receber o pedido",color:"from-green-500 to-green-600",iconBg:"bg-green-100",iconColor:"text-green-600"};case"delivered":return{icon:x,title:"Pedido Entregue",subtitle:"Obrigado pela prefer√™ncia!",color:"from-green-600 to-green-700",iconBg:"bg-green-100",iconColor:"text-green-600"};default:return{icon:j,title:"Preparando Pedido",subtitle:"Aguarde...",color:"from-gray-500 to-gray-600",iconBg:"bg-gray-100",iconColor:"text-gray-600"}}})(),c=o.icon;return e.jsxs("div",{className:`bg-gradient-to-r ${o.color} text-white rounded-2xl shadow-lg p-6`,children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:`w-16 h-16 ${o.iconBg} rounded-2xl flex items-center justify-center`,children:e.jsx(c,{className:`w-8 h-8 ${o.iconColor}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"font-bold text-xl mb-1",children:o.title}),e.jsx("p",{className:"text-sm opacity-90",children:o.subtitle}),i&&e.jsxs("p",{className:"text-xs opacity-75 mt-1",children:["üìç ",i]})]})]}),r&&["going_to_store","arrived_at_store","picked_up","out_for_delivery","arrived_at_customer"].includes(s.status)&&e.jsxs("div",{className:"bg-white/20 backdrop-blur-sm rounded-xl p-4 mt-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[r.photo?e.jsx("img",{src:r.photo,alt:r.name,className:"w-12 h-12 rounded-full object-cover border-2 border-white"}):e.jsx("div",{className:"w-12 h-12 bg-white/30 rounded-full flex items-center justify-center",children:e.jsx(l,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-bold text-white",children:r.name}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsxs(B,{className:"bg-white/30 text-white border-0",children:["‚≠ê ",r.rating?.toFixed(1)||"5.0"]}),e.jsx("span",{className:"text-white/90",children:r.vehicle_type==="bike"?"üö¥ Bicicleta":r.vehicle_type==="motorcycle"?"üèçÔ∏è Moto":r.vehicle_type==="car"?"üöó Carro":"Ve√≠culo"})]})]})]}),e.jsxs(k,{onClick:()=>{const d=r.phone?.replace(/\D/g,"");window.open(`https://wa.me/55${d}?text=Ol√°! Sou o cliente do pedido ${s.order_code}`,"_blank")},className:"w-full bg-white text-blue-600 hover:bg-white/90",size:"sm",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Entrar em Contato"]})]})]})}function K(){const[s,r]=g.useState(null);g.useEffect(()=>{const y=new URLSearchParams(window.location.search).get("order_id");r(y)},[]);const{data:t,isLoading:i}=C({queryKey:["customerOrder",s],queryFn:async()=>{const a=await v.entities.Order.filter({id:s});return console.log("Order fetched:",a[0]?.status,a[0]?.pickup_code,a[0]?.delivery_code),a[0]},enabled:!!s,refetchInterval:2e3}),{data:n}=C({queryKey:["orderEntregador",t?.entregador_id],queryFn:()=>v.entities.Entregador.filter({id:t.entregador_id}).then(a=>a[0]),enabled:!!t?.entregador_id,refetchInterval:3e3}),[o,c]=g.useState(null),[d,m]=g.useState(null);if(g.useEffect(()=>{if(!t||!n||!["going_to_store","out_for_delivery"].includes(t.status)){c(null),m(null);return}const a=async()=>{try{const b={lat:n.current_latitude,lng:n.current_longitude},N=t.status==="going_to_store"?{lat:t.store_latitude,lng:t.store_longitude}:{lat:t.customer_latitude,lng:t.customer_longitude};if(!b.lat||!N.lat)return;const p=await v.functions.invoke("getGoogleMapsRoute",{origin:b,destination:N});p.data&&!p.data.error&&(c(Math.ceil(p.data.duration/60)),m(p.data.distanceText))}catch(b){console.error("Erro ao buscar ETA:",b)}};a();const y=setInterval(a,3e4);return()=>clearInterval(y)},[t,n]),i)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx(P,{className:"w-8 h-8 animate-spin text-blue-500"})});if(!t)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8 max-w-md text-center",children:[e.jsx(l,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Pedido n√£o encontrado"}),e.jsx("p",{className:"text-gray-600",children:"N√£o foi poss√≠vel localizar este pedido. Verifique o link de rastreamento."})]})});const u={new:{label:"Pedido Recebido",color:"bg-blue-500",icon:l},accepted:{label:"Pedido Aceito",color:"bg-yellow-500",icon:j},preparing:{label:"Em Preparo",color:"bg-orange-500",icon:j},ready:{label:"Pronto para Retirada",color:"bg-green-500",icon:x},going_to_store:{label:"Entregador indo ao Restaurante",color:"bg-blue-400",icon:l},arrived_at_store:{label:"Entregador no Restaurante",color:"bg-blue-500",icon:x},picked_up:{label:"Pedido Coletado",color:"bg-green-500",icon:l},out_for_delivery:{label:"Saiu para Entrega",color:"bg-blue-600",icon:l},arrived_at_customer:{label:"Entregador Chegou",color:"bg-green-500",icon:f},delivered:{label:"Entregue",color:"bg-green-600",icon:x}};return(u[t.status]||u.new).icon,e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-4",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx(l,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-xl",children:"Rastreio do Pedido"}),e.jsxs("p",{className:"text-sm text-blue-100",children:["#",t.order_code]})]})]})})}),e.jsxs("div",{className:"max-w-4xl mx-auto p-4 space-y-4",children:[e.jsx(I,{order:t,entregador:n,eta:o,distance:d}),["going_to_store","arrived_at_store","picked_up","out_for_delivery","arrived_at_customer","delivered"].includes(t.status)&&e.jsx(S,{currentStatus:t.status,eta:o,distance:d}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border p-6",children:[e.jsx("h3",{className:"font-bold text-lg mb-3",children:"Endere√ßo de Entrega"}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(f,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.address}),t.address_complement&&e.jsx("p",{className:"text-sm text-gray-600",children:t.address_complement})]})]})]}),t.delivery_code&&t.status==="arrived_at_customer"&&e.jsxs("div",{className:"bg-gradient-to-br from-yellow-50 to-amber-50 border-2 border-yellow-300 rounded-2xl p-6",children:[e.jsx("h3",{className:"font-bold text-lg mb-2 text-yellow-900",children:"C√≥digo de Valida√ß√£o"}),e.jsx("p",{className:"text-sm text-yellow-700 mb-4",children:"Forne√ßa este c√≥digo ao entregador para confirmar o recebimento:"}),e.jsxs("div",{className:"bg-white rounded-xl p-6 text-center",children:[e.jsx("p",{className:"text-5xl font-bold text-yellow-600 tracking-[0.5em] mb-2",children:t.delivery_code}),e.jsx("p",{className:"text-xs text-gray-500",children:"C√≥digo de 4 d√≠gitos"})]})]})]})]})}export{K as default};
