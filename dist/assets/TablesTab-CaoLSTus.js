const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/cloudinaryUpload-vqCefYaz.js","assets/main-5wCJ0shd.js","assets/main-BtcpJIrZ.css"])))=>i.map(i=>d[i]);
import{c as vs,p as ae,s as Br,r as b,j as e,a as Ze,x as hn,q as So,y as Fe,D as Pt,f as Ns,P as Ss,e as Wr,B as A,u as ts,z as K,d as _e,X as Ds,F as Hr,_ as lt,R as Yl,h as Do,T as Fm,w as Rm,G as Lm,L as sr,C as us,o as Im}from"./main-5wCJ0shd.js";import{b as se}from"./base44Client-BjweZdup.js";import{u as ke}from"./useQuery-TBRlwA9F.js";import{C as Q,a as he,b as xe,c as Z,d as xs}from"./card-co3zywKC.js";import{B as ye}from"./badge-tC6tpDVj.js";import{I as B,L as R}from"./label-BGurCIwA.js";import{f as Xt,L as Mo,S as qm}from"./useDocumentHead-nN5iF5wF.js";import{m as Qe}from"./proxy-CaN4jGBq.js";import{S as Fs}from"./star-BGayr--b.js";import{Z as $m,_ as Ym,$ as Gm,q as Es,a0 as Vm,a1 as Um,i as dt,z as Gl,a2 as Ao,a3 as Po,a4 as Eo,a5 as Oo,f as Hs,D as zo,v as Bm,a6 as Wm,L as Pa,C as $r,A as To,n as Ks,o as yi,k as lr,a7 as Fo,s as Ro,l as Kr,u as Lo,G as Io,a8 as Qr,a9 as Er,aa as Hm,B as qo,X as Ea,Y as Oa,ab as $o,H as Km,R as Qm,F as ei,I as si,K as vi,M as Yo,U as Go,p as bi,ac as Zm,g as Jm,P as Xm}from"./LimitBlockModal-CxIjaPQ-.js";import{S as Se,a as De,b as Me,c as Ae,d as X}from"./select-D68HeZiV.js";import{D as $a}from"./dollar-sign-BdBkW913.js";import{T as $s}from"./trending-up-8OxCq5vE.js";import{T as eu}from"./target-DVKGgDzt.js";import{C as $t}from"./credit-card-DjT0Ipnr.js";import{C as Vo}from"./chart-column-Da9oBHTD.js";import{C as xn}from"./clock-8p17jiPd.js";import{C as Rt}from"./calendar-Bijjub7E.js";import{u as as}from"./usePermission-CvwVjOfT.js";import{u as Uo}from"./useSlugContext-DE6V1uue.js";import{S as or}from"./shopping-cart-BukW6CqG.js";import{D as pn}from"./download-DOPNSAwp.js";import{g as qi,I as Bo,U as na,P as Wo,h as gn,C as mt,G as cr,E as jr,b as qs,c as su,R as au,L as Ho,T as ai,d as ti,e as ri,f as ni,M as Ma,F as Vl}from"./EmptyState-DwIWL_NX.js";import{C as ma}from"./circle-check-big-C21gM6y_.js";import{C as Js}from"./copy-DcaS5Ul6.js";import{S as tu,b as fn,f as jn,c as yn,d as $i,e as Yi,P as ru,W as nu,B as iu,I as lu,F as ou,M as cu,a as Ul,w as du}from"./whatsappService-DTdPogZi.js";import{U as ar}from"./users-BsPmyBXt.js";import{u as de}from"./useMutation-CfjUJVgq.js";import{C as Ko}from"./calculator-CLN8Z376.js";import{S as ut}from"./settings-CVkD5Rnm.js";import{B as mu,f as Et}from"./format-D5amLcIy.js";import{C as Gi}from"./chef-hat-Tma-MV-q.js";import{M as Ra}from"./menu-RhFNat6_.js";import{A as ht}from"./index-BrRbWNqX.js";import{D as Re,a as Le,b as Ie,c as qe,d as Zr,e as Qs,f as uu}from"./dialog-BQt4A9EY.js";import"./planLimits-Asbb4bbl.js";import{T as Os}from"./textarea-BBItVPmi.js";import{S as Ve}from"./switch-CiXzU0WK.js";import{e as dr,C as mr,P as ur,D as xt,a as pt,b as gt,c as ps,d as Ni,t as Bs}from"./index-DxdNJ03y.js";import{S as Ms}from"./search-C1Oe3veH.js";import{C as ia}from"./check-b5qncWl4.js";import{P as $e}from"./plus-DJfFeu4q.js";import{P as vn,u as hu}from"./useComandaWebSocket-DLthfoyN.js";import{T as Xe}from"./trash-2-CxXzmM5w.js";import{S as Lt}from"./differenceInCalendarDays-DQNRMz4Z.js";import{C as Ot}from"./index-DJsYT-OT.js";import{C as La}from"./chevron-down-LYt6GC0H.js";import{F as ua}from"./filter-BiXx4-4p.js";import{G as tr}from"./gift-XBKin6Vd.js";import{u as Qo,P as Vi}from"./useManagerialAuth-SxIBd_kH.js";import{uploadToCloudinary as Bl}from"./cloudinaryUpload-vqCefYaz.js";import{f as va}from"./formatters-CvOEClq0.js";import{T as Ui,a as Bi,b as la,c as oa}from"./tabs-DLr74N5K.js";import{c as Zo,u as Wi,b as Jo,P as yr,a as Xo,d as xu,e as Jr,f as pu}from"./index-XPl2RJU8.js";import{c as gu,u as fu}from"./index-DBH5IvqS.js";import{S as rr}from"./sparkles-DNoIDe0Q.js";import{Z as Xr}from"./zap-BFRB5ZLZ.js";import{C as Yt}from"./circle-alert-CSoTi2zi.js";import{P as Ja}from"./phone-DEvhMYo9.js";import{M as za}from"./map-pin-Cc9ILfAa.js";import{a as Ya,E as ju}from"./eye-CkTGamEz.js";import{M as ec}from"./mail-CqIb88cT.js";import{B as sc,T as ii}from"./ticket-B7bgD8TJ.js";import{A as yu,a as vu,b as bu,c as Nu,d as wu,e as _u,f as Cu,g as ku}from"./alert-dialog-CsqCNnx-.js";import{M as Su,S as Du}from"./sun-DNFYo3QJ.js";import{S as Hi}from"./save-CE2DQko5.js";import{R as Ia}from"./receipt-DLhuB_An.js";import{C as Xa}from"./circle-x-C3c2vtU6.js";import{H as Yr}from"./history-Cqrz1KjB.js";import{C as ot}from"./circle-check-B4wdpzyW.js";import{S as Wl}from"./separator-CYlVdodZ.js";import{S as li}from"./store-DBfh0a_B.js";import{C as oi}from"./circle-help-BqbVHdsR.js";import{M as Mu}from"./message-square-rxsYttZX.js";import{A as Au}from"./arrow-left-nPuylZ-_.js";import{T as Hl}from"./trending-down-BL8QcX6r.js";import{M as Kl}from"./message-circle-CIMJfci3.js";import{B as Pu}from"./bell-BP42pcPs.js";import"./index-BjH-urEE.js";import{T as ac}from"./truck-BfUKktyx.js";import{U as Eu}from"./user-SYMNLJbz.js";import{C as Ou}from"./ColaboradorProfile-hI86Ih0T.js";import{L as zu}from"./layout-dashboard-DOJuJQFu.js";import{U as Tu}from"./user-plus-Cpsd25vN.js";import{S as wi}from"./shield-DAgABFti.js";import{S as Fu}from"./smartphone-DTStAEkb.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ru=[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]],Lu=vs("ArrowDownRight",Ru);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Iu=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],qu=vs("ArrowUpRight",Iu);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $u=[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]],Yu=vs("Banknote",$u);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gu=[["path",{d:"m9.06 11.9 8.07-8.06a2.85 2.85 0 1 1 4.03 4.03l-8.06 8.08",key:"1styjt"}],["path",{d:"M7.07 14.94c-1.66 0-3 1.35-3 3.02 0 1.33-2.5 1.52-2 2.02 1.08 1.1 2.49 2.02 4 2.02 2.2 0 4-1.8 4-4.04a3.01 3.01 0 0 0-3-3.02z",key:"z0l1mu"}]],Vu=vs("Brush",Gu);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uu=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],xv=vs("ClipboardList",Uu);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bu=[["path",{d:"M20 7h-3a2 2 0 0 1-2-2V2",key:"x099mo"}],["path",{d:"M9 18a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h7l4 4v10a2 2 0 0 1-2 2Z",key:"18t6ie"}],["path",{d:"M3 7.6v12.8A1.6 1.6 0 0 0 4.6 22h9.8",key:"1nja0z"}]],tc=vs("Files",Bu);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wu=[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]],Hu=vs("Flame",Wu);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ku=[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],en=vs("FolderPlus",Ku);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qu=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],sn=vs("Image",Qu);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zu=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],et=vs("Layers",Zu);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ju=[["path",{d:"m3 11 18-5v12L3 14v-3z",key:"n962bs"}],["path",{d:"M11.6 16.8a3 3 0 1 1-5.8-1.6",key:"1yl0tm"}]],pv=vs("Megaphone",Ju);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xu=[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]],Ql=vs("Palette",Xu);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eh=[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Zl=vs("PowerOff",eh);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sh=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],ah=vs("QrCode",sh);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const th=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Jl=vs("RotateCcw",th);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rh=[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2",key:"125lnx"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]],nh=vs("TestTube",rh);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ih=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]],lh=vs("UserCheck",ih);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oh=[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]],Or=vs("UserCog",oh);var ch=["x1","y1","x2","y2","key"],dh=["offset"];function ft(s){"@babel/helpers - typeof";return ft=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},ft(s)}function Xl(s,a){var t=Object.keys(s);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(s);a&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),t.push.apply(t,r)}return t}function ws(s){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?Xl(Object(t),!0).forEach(function(r){mh(s,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(t)):Xl(Object(t)).forEach(function(r){Object.defineProperty(s,r,Object.getOwnPropertyDescriptor(t,r))})}return s}function mh(s,a,t){return a=uh(a),a in s?Object.defineProperty(s,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[a]=t,s}function uh(s){var a=hh(s,"string");return ft(a)=="symbol"?a:a+""}function hh(s,a){if(ft(s)!="object"||!s)return s;var t=s[Symbol.toPrimitive];if(t!==void 0){var r=t.call(s,a);if(ft(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}function st(){return st=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(s[r]=t[r])}return s},st.apply(this,arguments)}function eo(s,a){if(s==null)return{};var t=xh(s,a),r,n;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(s);for(n=0;n<l.length;n++)r=l[n],!(a.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(s,r)&&(t[r]=s[r])}return t}function xh(s,a){if(s==null)return{};var t={};for(var r in s)if(Object.prototype.hasOwnProperty.call(s,r)){if(a.indexOf(r)>=0)continue;t[r]=s[r]}return t}var ph=function(a){var t=a.fill;if(!t||t==="none")return null;var r=a.fillOpacity,n=a.x,l=a.y,c=a.width,d=a.height,i=a.ry;return ae.createElement("rect",{x:n,y:l,ry:i,width:c,height:d,stroke:"none",fill:t,fillOpacity:r,className:"recharts-cartesian-grid-bg"})};function rc(s,a){var t;if(ae.isValidElement(s))t=ae.cloneElement(s,a);else if(dt(s))t=s(a);else{var r=a.x1,n=a.y1,l=a.x2,c=a.y2,d=a.key,i=eo(a,ch),o=Hs(i,!1);o.offset;var m=eo(o,dh);t=ae.createElement("line",st({},m,{x1:r,y1:n,x2:l,y2:c,fill:"none",key:d}))}return t}function gh(s){var a=s.x,t=s.width,r=s.horizontal,n=r===void 0?!0:r,l=s.horizontalPoints;if(!n||!l||!l.length)return null;var c=l.map(function(d,i){var o=ws(ws({},s),{},{x1:a,y1:d,x2:a+t,y2:d,key:"line-".concat(i),index:i});return rc(n,o)});return ae.createElement("g",{className:"recharts-cartesian-grid-horizontal"},c)}function fh(s){var a=s.y,t=s.height,r=s.vertical,n=r===void 0?!0:r,l=s.verticalPoints;if(!n||!l||!l.length)return null;var c=l.map(function(d,i){var o=ws(ws({},s),{},{x1:d,y1:a,x2:d,y2:a+t,key:"line-".concat(i),index:i});return rc(n,o)});return ae.createElement("g",{className:"recharts-cartesian-grid-vertical"},c)}function jh(s){var a=s.horizontalFill,t=s.fillOpacity,r=s.x,n=s.y,l=s.width,c=s.height,d=s.horizontalPoints,i=s.horizontal,o=i===void 0?!0:i;if(!o||!a||!a.length)return null;var m=d.map(function(x){return Math.round(x+n-n)}).sort(function(x,g){return x-g});n!==m[0]&&m.unshift(0);var p=m.map(function(x,g){var f=!m[g+1],y=f?n+c-x:m[g+1]-x;if(y<=0)return null;var v=g%a.length;return ae.createElement("rect",{key:"react-".concat(g),y:x,x:r,height:y,width:l,stroke:"none",fill:a[v],fillOpacity:t,className:"recharts-cartesian-grid-bg"})});return ae.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},p)}function yh(s){var a=s.vertical,t=a===void 0?!0:a,r=s.verticalFill,n=s.fillOpacity,l=s.x,c=s.y,d=s.width,i=s.height,o=s.verticalPoints;if(!t||!r||!r.length)return null;var m=o.map(function(x){return Math.round(x+l-l)}).sort(function(x,g){return x-g});l!==m[0]&&m.unshift(0);var p=m.map(function(x,g){var f=!m[g+1],y=f?l+d-x:m[g+1]-x;if(y<=0)return null;var v=g%r.length;return ae.createElement("rect",{key:"react-".concat(g),x,y:c,width:y,height:i,stroke:"none",fill:r[v],fillOpacity:n,className:"recharts-cartesian-grid-bg"})});return ae.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},p)}var vh=function(a,t){var r=a.xAxis,n=a.width,l=a.height,c=a.offset;return Ao(Po(ws(ws(ws({},Oo.defaultProps),r),{},{ticks:Eo(r,!0),viewBox:{x:0,y:0,width:n,height:l}})),c.left,c.left+c.width,t)},bh=function(a,t){var r=a.yAxis,n=a.width,l=a.height,c=a.offset;return Ao(Po(ws(ws(ws({},Oo.defaultProps),r),{},{ticks:Eo(r,!0),viewBox:{x:0,y:0,width:n,height:l}})),c.top,c.top+c.height,t)},wt={horizontal:!0,vertical:!0,stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function at(s){var a,t,r,n,l,c,d=$m(),i=Ym(),o=Gm(),m=ws(ws({},s),{},{stroke:(a=s.stroke)!==null&&a!==void 0?a:wt.stroke,fill:(t=s.fill)!==null&&t!==void 0?t:wt.fill,horizontal:(r=s.horizontal)!==null&&r!==void 0?r:wt.horizontal,horizontalFill:(n=s.horizontalFill)!==null&&n!==void 0?n:wt.horizontalFill,vertical:(l=s.vertical)!==null&&l!==void 0?l:wt.vertical,verticalFill:(c=s.verticalFill)!==null&&c!==void 0?c:wt.verticalFill,x:Es(s.x)?s.x:o.left,y:Es(s.y)?s.y:o.top,width:Es(s.width)?s.width:o.width,height:Es(s.height)?s.height:o.height}),p=m.x,x=m.y,g=m.width,f=m.height,y=m.syncWithTicks,v=m.horizontalValues,P=m.verticalValues,M=Vm(),O=Um();if(!Es(g)||g<=0||!Es(f)||f<=0||!Es(p)||p!==+p||!Es(x)||x!==+x)return null;var E=m.verticalCoordinatesGenerator||vh,u=m.horizontalCoordinatesGenerator||bh,_=m.horizontalPoints,$=m.verticalPoints;if((!_||!_.length)&&dt(u)){var j=v&&v.length,D=u({yAxis:O?ws(ws({},O),{},{ticks:j?v:O.ticks}):void 0,width:d,height:i,offset:o},j?!0:y);Gl(Array.isArray(D),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(ft(D),"]")),Array.isArray(D)&&(_=D)}if((!$||!$.length)&&dt(E)){var V=P&&P.length,T=E({xAxis:M?ws(ws({},M),{},{ticks:V?P:M.ticks}):void 0,width:d,height:i,offset:o},V?!0:y);Gl(Array.isArray(T),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(ft(T),"]")),Array.isArray(T)&&($=T)}return ae.createElement("g",{className:"recharts-cartesian-grid"},ae.createElement(ph,{fill:m.fill,fillOpacity:m.fillOpacity,x:m.x,y:m.y,width:m.width,height:m.height,ry:m.ry}),ae.createElement(gh,st({},m,{offset:o,horizontalPoints:_,xAxis:M,yAxis:O})),ae.createElement(fh,st({},m,{offset:o,verticalPoints:$,xAxis:M,yAxis:O})),ae.createElement(jh,st({},m,{horizontalPoints:_})),ae.createElement(yh,st({},m,{verticalPoints:$})))}at.displayName="CartesianGrid";var Nh=["type","layout","connectNulls","ref"],wh=["key"];function It(s){"@babel/helpers - typeof";return It=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},It(s)}function so(s,a){if(s==null)return{};var t=_h(s,a),r,n;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(s);for(n=0;n<l.length;n++)r=l[n],!(a.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(s,r)&&(t[r]=s[r])}return t}function _h(s,a){if(s==null)return{};var t={};for(var r in s)if(Object.prototype.hasOwnProperty.call(s,r)){if(a.indexOf(r)>=0)continue;t[r]=s[r]}return t}function nr(){return nr=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(s[r]=t[r])}return s},nr.apply(this,arguments)}function ao(s,a){var t=Object.keys(s);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(s);a&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),t.push.apply(t,r)}return t}function Ts(s){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?ao(Object(t),!0).forEach(function(r){Ws(s,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(t)):ao(Object(t)).forEach(function(r){Object.defineProperty(s,r,Object.getOwnPropertyDescriptor(t,r))})}return s}function _t(s){return Dh(s)||Sh(s)||kh(s)||Ch()}function Ch(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kh(s,a){if(s){if(typeof s=="string")return _i(s,a);var t=Object.prototype.toString.call(s).slice(8,-1);if(t==="Object"&&s.constructor&&(t=s.constructor.name),t==="Map"||t==="Set")return Array.from(s);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return _i(s,a)}}function Sh(s){if(typeof Symbol<"u"&&s[Symbol.iterator]!=null||s["@@iterator"]!=null)return Array.from(s)}function Dh(s){if(Array.isArray(s))return _i(s)}function _i(s,a){(a==null||a>s.length)&&(a=s.length);for(var t=0,r=new Array(a);t<a;t++)r[t]=s[t];return r}function Mh(s,a){if(!(s instanceof a))throw new TypeError("Cannot call a class as a function")}function to(s,a){for(var t=0;t<a.length;t++){var r=a[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(s,ic(r.key),r)}}function Ah(s,a,t){return a&&to(s.prototype,a),t&&to(s,t),Object.defineProperty(s,"prototype",{writable:!1}),s}function Ph(s,a,t){return a=an(a),Eh(s,nc()?Reflect.construct(a,t||[],an(s).constructor):a.apply(s,t))}function Eh(s,a){if(a&&(It(a)==="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Oh(s)}function Oh(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function nc(){try{var s=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(nc=function(){return!!s})()}function an(s){return an=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},an(s)}function zh(s,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(a&&a.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),Object.defineProperty(s,"prototype",{writable:!1}),a&&Ci(s,a)}function Ci(s,a){return Ci=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},Ci(s,a)}function Ws(s,a,t){return a=ic(a),a in s?Object.defineProperty(s,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[a]=t,s}function ic(s){var a=Th(s,"string");return It(a)=="symbol"?a:a+""}function Th(s,a){if(It(s)!="object"||!s)return s;var t=s[Symbol.toPrimitive];if(t!==void 0){var r=t.call(s,a);if(It(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}var Gt=(function(s){function a(){var t;Mh(this,a);for(var r=arguments.length,n=new Array(r),l=0;l<r;l++)n[l]=arguments[l];return t=Ph(this,a,[].concat(n)),Ws(t,"state",{isAnimationFinished:!0,totalLength:0}),Ws(t,"generateSimpleStrokeDasharray",function(c,d){return"".concat(d,"px ").concat(c-d,"px")}),Ws(t,"getStrokeDasharray",function(c,d,i){var o=i.reduce(function(P,M){return P+M});if(!o)return t.generateSimpleStrokeDasharray(d,c);for(var m=Math.floor(c/o),p=c%o,x=d-c,g=[],f=0,y=0;f<i.length;y+=i[f],++f)if(y+i[f]>p){g=[].concat(_t(i.slice(0,f)),[p-y]);break}var v=g.length%2===0?[0,x]:[x];return[].concat(_t(a.repeat(i,m)),_t(g),v).map(function(P){return"".concat(P,"px")}).join(", ")}),Ws(t,"id",Lo("recharts-line-")),Ws(t,"pathRef",function(c){t.mainCurve=c}),Ws(t,"handleAnimationEnd",function(){t.setState({isAnimationFinished:!0}),t.props.onAnimationEnd&&t.props.onAnimationEnd()}),Ws(t,"handleAnimationStart",function(){t.setState({isAnimationFinished:!1}),t.props.onAnimationStart&&t.props.onAnimationStart()}),t}return zh(a,s),Ah(a,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var r=this.getTotalLength();this.setState({totalLength:r})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var r=this.getTotalLength();r!==this.state.totalLength&&this.setState({totalLength:r})}}},{key:"getTotalLength",value:function(){var r=this.mainCurve;try{return r&&r.getTotalLength&&r.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(r,n){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var l=this.props,c=l.points,d=l.xAxis,i=l.yAxis,o=l.layout,m=l.children,p=Bm(m,Wm);if(!p)return null;var x=function(y,v){return{x:y.x,y:y.y,value:y.value,errorVal:Kr(y.payload,v)}},g={clipPath:r?"url(#clipPath-".concat(n,")"):null};return ae.createElement(Pa,g,p.map(function(f){return ae.cloneElement(f,{key:"bar-".concat(f.props.dataKey),data:c,xAxis:d,yAxis:i,layout:o,dataPointFormatter:x})}))}},{key:"renderDots",value:function(r,n,l){var c=this.props.isAnimationActive;if(c&&!this.state.isAnimationFinished)return null;var d=this.props,i=d.dot,o=d.points,m=d.dataKey,p=Hs(this.props,!1),x=Hs(i,!0),g=o.map(function(y,v){var P=Ts(Ts(Ts({key:"dot-".concat(v),r:3},p),x),{},{index:v,cx:y.x,cy:y.y,value:y.value,dataKey:m,payload:y.payload,points:o});return a.renderDotItem(i,P)}),f={clipPath:r?"url(#clipPath-".concat(n?"":"dots-").concat(l,")"):null};return ae.createElement(Pa,nr({className:"recharts-line-dots",key:"dots"},f),g)}},{key:"renderCurveStatically",value:function(r,n,l,c){var d=this.props,i=d.type,o=d.layout,m=d.connectNulls;d.ref;var p=so(d,Nh),x=Ts(Ts(Ts({},Hs(p,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:n?"url(#clipPath-".concat(l,")"):null,points:r},c),{},{type:i,layout:o,connectNulls:m});return ae.createElement($r,nr({},x,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(r,n){var l=this,c=this.props,d=c.points,i=c.strokeDasharray,o=c.isAnimationActive,m=c.animationBegin,p=c.animationDuration,x=c.animationEasing,g=c.animationId,f=c.animateNewValues,y=c.width,v=c.height,P=this.state,M=P.prevPoints,O=P.totalLength;return ae.createElement(To,{begin:m,duration:p,isActive:o,easing:x,from:{t:0},to:{t:1},key:"line-".concat(g),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(E){var u=E.t;if(M){var _=M.length/d.length,$=d.map(function(N,z){var k=Math.floor(z*_);if(M[k]){var h=M[k],F=Ks(h.x,N.x),S=Ks(h.y,N.y);return Ts(Ts({},N),{},{x:F(u),y:S(u)})}if(f){var q=Ks(y*2,N.x),J=Ks(v/2,N.y);return Ts(Ts({},N),{},{x:q(u),y:J(u)})}return Ts(Ts({},N),{},{x:N.x,y:N.y})});return l.renderCurveStatically($,r,n)}var j=Ks(0,O),D=j(u),V;if(i){var T="".concat(i).split(/[,\s]+/gim).map(function(N){return parseFloat(N)});V=l.getStrokeDasharray(D,O,T)}else V=l.generateSimpleStrokeDasharray(O,D);return l.renderCurveStatically(d,r,n,{strokeDasharray:V})})}},{key:"renderCurve",value:function(r,n){var l=this.props,c=l.points,d=l.isAnimationActive,i=this.state,o=i.prevPoints,m=i.totalLength;return d&&c&&c.length&&(!o&&m>0||!yi(o,c))?this.renderCurveWithAnimation(r,n):this.renderCurveStatically(c,r,n)}},{key:"render",value:function(){var r,n=this.props,l=n.hide,c=n.dot,d=n.points,i=n.className,o=n.xAxis,m=n.yAxis,p=n.top,x=n.left,g=n.width,f=n.height,y=n.isAnimationActive,v=n.id;if(l||!d||!d.length)return null;var P=this.state.isAnimationFinished,M=d.length===1,O=Br("recharts-line",i),E=o&&o.allowDataOverflow,u=m&&m.allowDataOverflow,_=E||u,$=lr(v)?this.id:v,j=(r=Hs(c,!1))!==null&&r!==void 0?r:{r:3,strokeWidth:2},D=j.r,V=D===void 0?3:D,T=j.strokeWidth,N=T===void 0?2:T,z=Fo(c)?c:{},k=z.clipDot,h=k===void 0?!0:k,F=V*2+N;return ae.createElement(Pa,{className:O},E||u?ae.createElement("defs",null,ae.createElement("clipPath",{id:"clipPath-".concat($)},ae.createElement("rect",{x:E?x:x-g/2,y:u?p:p-f/2,width:E?g:g*2,height:u?f:f*2})),!h&&ae.createElement("clipPath",{id:"clipPath-dots-".concat($)},ae.createElement("rect",{x:x-F/2,y:p-F/2,width:g+F,height:f+F}))):null,!M&&this.renderCurve(_,$),this.renderErrorBar(_,$),(M||c)&&this.renderDots(_,h,$),(!y||P)&&Ro.renderCallByParent(this.props,d))}}],[{key:"getDerivedStateFromProps",value:function(r,n){return r.animationId!==n.prevAnimationId?{prevAnimationId:r.animationId,curPoints:r.points,prevPoints:n.curPoints}:r.points!==n.curPoints?{curPoints:r.points}:null}},{key:"repeat",value:function(r,n){for(var l=r.length%2!==0?[].concat(_t(r),[0]):r,c=[],d=0;d<n;++d)c=[].concat(_t(c),_t(l));return c}},{key:"renderDotItem",value:function(r,n){var l;if(ae.isValidElement(r))l=ae.cloneElement(r,n);else if(dt(r))l=r(n);else{var c=n.key,d=so(n,wh),i=Br("recharts-line-dot",typeof r!="boolean"?r.className:"");l=ae.createElement(zo,nr({key:c},d,{className:i}))}return l}}])})(b.PureComponent);Ws(Gt,"displayName","Line");Ws(Gt,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!Io.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});Ws(Gt,"getComposedData",function(s){var a=s.props,t=s.xAxis,r=s.yAxis,n=s.xAxisTicks,l=s.yAxisTicks,c=s.dataKey,d=s.bandSize,i=s.displayedData,o=s.offset,m=a.layout,p=i.map(function(x,g){var f=Kr(x,c);return m==="horizontal"?{x:Qr({axis:t,ticks:n,bandSize:d,entry:x,index:g}),y:lr(f)?null:r.scale(f),value:f,payload:x}:{x:lr(f)?null:t.scale(f),y:Qr({axis:r,ticks:l,bandSize:d,entry:x,index:g}),value:f,payload:x}});return Ts({points:p,layout:m},o)});var Fh=["layout","type","stroke","connectNulls","isRange","ref"],Rh=["key"],lc;function qt(s){"@babel/helpers - typeof";return qt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},qt(s)}function oc(s,a){if(s==null)return{};var t=Lh(s,a),r,n;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(s);for(n=0;n<l.length;n++)r=l[n],!(a.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(s,r)&&(t[r]=s[r])}return t}function Lh(s,a){if(s==null)return{};var t={};for(var r in s)if(Object.prototype.hasOwnProperty.call(s,r)){if(a.indexOf(r)>=0)continue;t[r]=s[r]}return t}function tt(){return tt=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(s[r]=t[r])}return s},tt.apply(this,arguments)}function ro(s,a){var t=Object.keys(s);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(s);a&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(s,n).enumerable})),t.push.apply(t,r)}return t}function Aa(s){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?ro(Object(t),!0).forEach(function(r){da(s,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(t)):ro(Object(t)).forEach(function(r){Object.defineProperty(s,r,Object.getOwnPropertyDescriptor(t,r))})}return s}function Ih(s,a){if(!(s instanceof a))throw new TypeError("Cannot call a class as a function")}function no(s,a){for(var t=0;t<a.length;t++){var r=a[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(s,dc(r.key),r)}}function qh(s,a,t){return a&&no(s.prototype,a),t&&no(s,t),Object.defineProperty(s,"prototype",{writable:!1}),s}function $h(s,a,t){return a=tn(a),Yh(s,cc()?Reflect.construct(a,t||[],tn(s).constructor):a.apply(s,t))}function Yh(s,a){if(a&&(qt(a)==="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Gh(s)}function Gh(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function cc(){try{var s=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(cc=function(){return!!s})()}function tn(s){return tn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tn(s)}function Vh(s,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(a&&a.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),Object.defineProperty(s,"prototype",{writable:!1}),a&&ki(s,a)}function ki(s,a){return ki=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},ki(s,a)}function da(s,a,t){return a=dc(a),a in s?Object.defineProperty(s,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[a]=t,s}function dc(s){var a=Uh(s,"string");return qt(a)=="symbol"?a:a+""}function Uh(s,a){if(qt(s)!="object"||!s)return s;var t=s[Symbol.toPrimitive];if(t!==void 0){var r=t.call(s,a);if(qt(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}var Ga=(function(s){function a(){var t;Ih(this,a);for(var r=arguments.length,n=new Array(r),l=0;l<r;l++)n[l]=arguments[l];return t=$h(this,a,[].concat(n)),da(t,"state",{isAnimationFinished:!0}),da(t,"id",Lo("recharts-area-")),da(t,"handleAnimationEnd",function(){var c=t.props.onAnimationEnd;t.setState({isAnimationFinished:!0}),dt(c)&&c()}),da(t,"handleAnimationStart",function(){var c=t.props.onAnimationStart;t.setState({isAnimationFinished:!1}),dt(c)&&c()}),t}return Vh(a,s),qh(a,[{key:"renderDots",value:function(r,n,l){var c=this.props.isAnimationActive,d=this.state.isAnimationFinished;if(c&&!d)return null;var i=this.props,o=i.dot,m=i.points,p=i.dataKey,x=Hs(this.props,!1),g=Hs(o,!0),f=m.map(function(v,P){var M=Aa(Aa(Aa({key:"dot-".concat(P),r:3},x),g),{},{index:P,cx:v.x,cy:v.y,dataKey:p,value:v.value,payload:v.payload,points:m});return a.renderDotItem(o,M)}),y={clipPath:r?"url(#clipPath-".concat(n?"":"dots-").concat(l,")"):null};return ae.createElement(Pa,tt({className:"recharts-area-dots"},y),f)}},{key:"renderHorizontalRect",value:function(r){var n=this.props,l=n.baseLine,c=n.points,d=n.strokeWidth,i=c[0].x,o=c[c.length-1].x,m=r*Math.abs(i-o),p=Er(c.map(function(x){return x.y||0}));return Es(l)&&typeof l=="number"?p=Math.max(l,p):l&&Array.isArray(l)&&l.length&&(p=Math.max(Er(l.map(function(x){return x.y||0})),p)),Es(p)?ae.createElement("rect",{x:i<o?i:i-m,y:0,width:m,height:Math.floor(p+(d?parseInt("".concat(d),10):1))}):null}},{key:"renderVerticalRect",value:function(r){var n=this.props,l=n.baseLine,c=n.points,d=n.strokeWidth,i=c[0].y,o=c[c.length-1].y,m=r*Math.abs(i-o),p=Er(c.map(function(x){return x.x||0}));return Es(l)&&typeof l=="number"?p=Math.max(l,p):l&&Array.isArray(l)&&l.length&&(p=Math.max(Er(l.map(function(x){return x.x||0})),p)),Es(p)?ae.createElement("rect",{x:0,y:i<o?i:i-m,width:p+(d?parseInt("".concat(d),10):1),height:Math.floor(m)}):null}},{key:"renderClipRect",value:function(r){var n=this.props.layout;return n==="vertical"?this.renderVerticalRect(r):this.renderHorizontalRect(r)}},{key:"renderAreaStatically",value:function(r,n,l,c){var d=this.props,i=d.layout,o=d.type,m=d.stroke,p=d.connectNulls,x=d.isRange;d.ref;var g=oc(d,Fh);return ae.createElement(Pa,{clipPath:l?"url(#clipPath-".concat(c,")"):null},ae.createElement($r,tt({},Hs(g,!0),{points:r,connectNulls:p,type:o,baseLine:n,layout:i,stroke:"none",className:"recharts-area-area"})),m!=="none"&&ae.createElement($r,tt({},Hs(this.props,!1),{className:"recharts-area-curve",layout:i,type:o,connectNulls:p,fill:"none",points:r})),m!=="none"&&x&&ae.createElement($r,tt({},Hs(this.props,!1),{className:"recharts-area-curve",layout:i,type:o,connectNulls:p,fill:"none",points:n})))}},{key:"renderAreaWithAnimation",value:function(r,n){var l=this,c=this.props,d=c.points,i=c.baseLine,o=c.isAnimationActive,m=c.animationBegin,p=c.animationDuration,x=c.animationEasing,g=c.animationId,f=this.state,y=f.prevPoints,v=f.prevBaseLine;return ae.createElement(To,{begin:m,duration:p,isActive:o,easing:x,from:{t:0},to:{t:1},key:"area-".concat(g),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(P){var M=P.t;if(y){var O=y.length/d.length,E=d.map(function(j,D){var V=Math.floor(D*O);if(y[V]){var T=y[V],N=Ks(T.x,j.x),z=Ks(T.y,j.y);return Aa(Aa({},j),{},{x:N(M),y:z(M)})}return j}),u;if(Es(i)&&typeof i=="number"){var _=Ks(v,i);u=_(M)}else if(lr(i)||Hm(i)){var $=Ks(v,0);u=$(M)}else u=i.map(function(j,D){var V=Math.floor(D*O);if(v[V]){var T=v[V],N=Ks(T.x,j.x),z=Ks(T.y,j.y);return Aa(Aa({},j),{},{x:N(M),y:z(M)})}return j});return l.renderAreaStatically(E,u,r,n)}return ae.createElement(Pa,null,ae.createElement("defs",null,ae.createElement("clipPath",{id:"animationClipPath-".concat(n)},l.renderClipRect(M))),ae.createElement(Pa,{clipPath:"url(#animationClipPath-".concat(n,")")},l.renderAreaStatically(d,i,r,n)))})}},{key:"renderArea",value:function(r,n){var l=this.props,c=l.points,d=l.baseLine,i=l.isAnimationActive,o=this.state,m=o.prevPoints,p=o.prevBaseLine,x=o.totalLength;return i&&c&&c.length&&(!m&&x>0||!yi(m,c)||!yi(p,d))?this.renderAreaWithAnimation(r,n):this.renderAreaStatically(c,d,r,n)}},{key:"render",value:function(){var r,n=this.props,l=n.hide,c=n.dot,d=n.points,i=n.className,o=n.top,m=n.left,p=n.xAxis,x=n.yAxis,g=n.width,f=n.height,y=n.isAnimationActive,v=n.id;if(l||!d||!d.length)return null;var P=this.state.isAnimationFinished,M=d.length===1,O=Br("recharts-area",i),E=p&&p.allowDataOverflow,u=x&&x.allowDataOverflow,_=E||u,$=lr(v)?this.id:v,j=(r=Hs(c,!1))!==null&&r!==void 0?r:{r:3,strokeWidth:2},D=j.r,V=D===void 0?3:D,T=j.strokeWidth,N=T===void 0?2:T,z=Fo(c)?c:{},k=z.clipDot,h=k===void 0?!0:k,F=V*2+N;return ae.createElement(Pa,{className:O},E||u?ae.createElement("defs",null,ae.createElement("clipPath",{id:"clipPath-".concat($)},ae.createElement("rect",{x:E?m:m-g/2,y:u?o:o-f/2,width:E?g:g*2,height:u?f:f*2})),!h&&ae.createElement("clipPath",{id:"clipPath-dots-".concat($)},ae.createElement("rect",{x:m-F/2,y:o-F/2,width:g+F,height:f+F}))):null,M?null:this.renderArea(_,$),(c||M)&&this.renderDots(_,h,$),(!y||P)&&Ro.renderCallByParent(this.props,d))}}],[{key:"getDerivedStateFromProps",value:function(r,n){return r.animationId!==n.prevAnimationId?{prevAnimationId:r.animationId,curPoints:r.points,curBaseLine:r.baseLine,prevPoints:n.curPoints,prevBaseLine:n.curBaseLine}:r.points!==n.curPoints||r.baseLine!==n.curBaseLine?{curPoints:r.points,curBaseLine:r.baseLine}:null}}])})(b.PureComponent);lc=Ga;da(Ga,"displayName","Area");da(Ga,"defaultProps",{stroke:"#3182bd",fill:"#3182bd",fillOpacity:.6,xAxisId:0,yAxisId:0,legendType:"line",connectNulls:!1,points:[],dot:!1,activeDot:!0,hide:!1,isAnimationActive:!Io.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"});da(Ga,"getBaseValue",function(s,a,t,r){var n=s.layout,l=s.baseValue,c=a.props.baseValue,d=c??l;if(Es(d)&&typeof d=="number")return d;var i=n==="horizontal"?r:t,o=i.scale.domain();if(i.type==="number"){var m=Math.max(o[0],o[1]),p=Math.min(o[0],o[1]);return d==="dataMin"?p:d==="dataMax"||m<0?m:Math.max(Math.min(o[0],o[1]),0)}return d==="dataMin"?o[0]:d==="dataMax"?o[1]:o[0]});da(Ga,"getComposedData",function(s){var a=s.props,t=s.item,r=s.xAxis,n=s.yAxis,l=s.xAxisTicks,c=s.yAxisTicks,d=s.bandSize,i=s.dataKey,o=s.stackedData,m=s.dataStartIndex,p=s.displayedData,x=s.offset,g=a.layout,f=o&&o.length,y=lc.getBaseValue(a,t,r,n),v=g==="horizontal",P=!1,M=p.map(function(E,u){var _;f?_=o[m+u]:(_=Kr(E,i),Array.isArray(_)?P=!0:_=[y,_]);var $=_[1]==null||f&&Kr(E,i)==null;return v?{x:Qr({axis:r,ticks:l,bandSize:d,entry:E,index:u}),y:$?null:n.scale(_[1]),value:_,payload:E}:{x:$?null:r.scale(_[1]),y:Qr({axis:n,ticks:c,bandSize:d,entry:E,index:u}),value:_,payload:E}}),O;return f||P?O=M.map(function(E){var u=Array.isArray(E.value)?E.value[0]:null;return v?{x:E.x,y:u!=null&&E.y!=null?n.scale(u):null}:{x:u!=null?r.scale(u):null,y:E.y}}):O=v?n.scale(y):r.scale(y),Aa({points:M,baseLine:O,layout:g,isRange:P},x)});da(Ga,"renderDotItem",function(s,a){var t;if(ae.isValidElement(s))t=ae.cloneElement(s,a);else if(dt(s))t=s(a);else{var r=Br("recharts-area-dot",typeof s!="boolean"?s.className:""),n=a.key,l=oc(a,Rh);t=ae.createElement(zo,tt({},l,{key:n,className:r}))}return t});var mc=qo({chartName:"LineChart",GraphicalChild:Gt,axisComponents:[{axisType:"xAxis",AxisComp:Ea},{axisType:"yAxis",AxisComp:Oa}],formatAxisMap:$o}),Bh=qo({chartName:"AreaChart",GraphicalChild:Ga,axisComponents:[{axisType:"xAxis",AxisComp:Ea},{axisType:"yAxis",AxisComp:Oa}],formatAxisMap:$o});function Wh(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}//! moment.js
//! version : 2.30.1
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
var uc;function ee(){return uc.apply(null,arguments)}function Hh(s){uc=s}function Xs(s){return s instanceof Array||Object.prototype.toString.call(s)==="[object Array]"}function ct(s){return s!=null&&Object.prototype.toString.call(s)==="[object Object]"}function He(s,a){return Object.prototype.hasOwnProperty.call(s,a)}function Ki(s){if(Object.getOwnPropertyNames)return Object.getOwnPropertyNames(s).length===0;var a;for(a in s)if(He(s,a))return!1;return!0}function As(s){return s===void 0}function Ca(s){return typeof s=="number"||Object.prototype.toString.call(s)==="[object Number]"}function vr(s){return s instanceof Date||Object.prototype.toString.call(s)==="[object Date]"}function hc(s,a){var t=[],r,n=s.length;for(r=0;r<n;++r)t.push(a(s[r],r));return t}function Ta(s,a){for(var t in a)He(a,t)&&(s[t]=a[t]);return He(a,"toString")&&(s.toString=a.toString),He(a,"valueOf")&&(s.valueOf=a.valueOf),s}function xa(s,a,t,r){return Fc(s,a,t,r,!0).utc()}function Kh(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}}function Oe(s){return s._pf==null&&(s._pf=Kh()),s._pf}var Si;Array.prototype.some?Si=Array.prototype.some:Si=function(s){var a=Object(this),t=a.length>>>0,r;for(r=0;r<t;r++)if(r in a&&s.call(this,a[r],r,a))return!0;return!1};function Qi(s){var a=null,t=!1,r=s._d&&!isNaN(s._d.getTime());if(r&&(a=Oe(s),t=Si.call(a.parsedDateParts,function(n){return n!=null}),r=a.overflow<0&&!a.empty&&!a.invalidEra&&!a.invalidMonth&&!a.invalidWeekday&&!a.weekdayMismatch&&!a.nullInput&&!a.invalidFormat&&!a.userInvalidated&&(!a.meridiem||a.meridiem&&t),s._strict&&(r=r&&a.charsLeftOver===0&&a.unusedTokens.length===0&&a.bigHour===void 0)),Object.isFrozen==null||!Object.isFrozen(s))s._isValid=r;else return r;return s._isValid}function bn(s){var a=xa(NaN);return s!=null?Ta(Oe(a),s):Oe(a).userInvalidated=!0,a}var io=ee.momentProperties=[],ci=!1;function Zi(s,a){var t,r,n,l=io.length;if(As(a._isAMomentObject)||(s._isAMomentObject=a._isAMomentObject),As(a._i)||(s._i=a._i),As(a._f)||(s._f=a._f),As(a._l)||(s._l=a._l),As(a._strict)||(s._strict=a._strict),As(a._tzm)||(s._tzm=a._tzm),As(a._isUTC)||(s._isUTC=a._isUTC),As(a._offset)||(s._offset=a._offset),As(a._pf)||(s._pf=Oe(a)),As(a._locale)||(s._locale=a._locale),l>0)for(t=0;t<l;t++)r=io[t],n=a[r],As(n)||(s[r]=n);return s}function br(s){Zi(this,s),this._d=new Date(s._d!=null?s._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),ci===!1&&(ci=!0,ee.updateOffset(this),ci=!1)}function ea(s){return s instanceof br||s!=null&&s._isAMomentObject!=null}function xc(s){ee.suppressDeprecationWarnings===!1&&typeof console<"u"&&console.warn&&console.warn("Deprecation warning: "+s)}function Ys(s,a){var t=!0;return Ta(function(){if(ee.deprecationHandler!=null&&ee.deprecationHandler(null,s),t){var r=[],n,l,c,d=arguments.length;for(l=0;l<d;l++){if(n="",typeof arguments[l]=="object"){n+=`
[`+l+"] ";for(c in arguments[0])He(arguments[0],c)&&(n+=c+": "+arguments[0][c]+", ");n=n.slice(0,-2)}else n=arguments[l];r.push(n)}xc(s+`
Arguments: `+Array.prototype.slice.call(r).join("")+`
`+new Error().stack),t=!1}return a.apply(this,arguments)},a)}var lo={};function pc(s,a){ee.deprecationHandler!=null&&ee.deprecationHandler(s,a),lo[s]||(xc(a),lo[s]=!0)}ee.suppressDeprecationWarnings=!1;ee.deprecationHandler=null;function pa(s){return typeof Function<"u"&&s instanceof Function||Object.prototype.toString.call(s)==="[object Function]"}function Qh(s){var a,t;for(t in s)He(s,t)&&(a=s[t],pa(a)?this[t]=a:this["_"+t]=a);this._config=s,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function Di(s,a){var t=Ta({},s),r;for(r in a)He(a,r)&&(ct(s[r])&&ct(a[r])?(t[r]={},Ta(t[r],s[r]),Ta(t[r],a[r])):a[r]!=null?t[r]=a[r]:delete t[r]);for(r in s)He(s,r)&&!He(a,r)&&ct(s[r])&&(t[r]=Ta({},t[r]));return t}function Ji(s){s!=null&&this.set(s)}var Mi;Object.keys?Mi=Object.keys:Mi=function(s){var a,t=[];for(a in s)He(s,a)&&t.push(a);return t};var Zh={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function Jh(s,a,t){var r=this._calendar[s]||this._calendar.sameElse;return pa(r)?r.call(a,t):r}function ha(s,a,t){var r=""+Math.abs(s),n=a-r.length,l=s>=0;return(l?t?"+":"":"-")+Math.pow(10,Math.max(0,n)).toString().substr(1)+r}var Xi=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,zr=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,di={},zt={};function be(s,a,t,r){var n=r;typeof r=="string"&&(n=function(){return this[r]()}),s&&(zt[s]=n),a&&(zt[a[0]]=function(){return ha(n.apply(this,arguments),a[1],a[2])}),t&&(zt[t]=function(){return this.localeData().ordinal(n.apply(this,arguments),s)})}function Xh(s){return s.match(/\[[\s\S]/)?s.replace(/^\[|\]$/g,""):s.replace(/\\/g,"")}function ex(s){var a=s.match(Xi),t,r;for(t=0,r=a.length;t<r;t++)zt[a[t]]?a[t]=zt[a[t]]:a[t]=Xh(a[t]);return function(n){var l="",c;for(c=0;c<r;c++)l+=pa(a[c])?a[c].call(n,s):a[c];return l}}function Gr(s,a){return s.isValid()?(a=gc(a,s.localeData()),di[a]=di[a]||ex(a),di[a](s)):s.localeData().invalidDate()}function gc(s,a){var t=5;function r(n){return a.longDateFormat(n)||n}for(zr.lastIndex=0;t>=0&&zr.test(s);)s=s.replace(zr,r),zr.lastIndex=0,t-=1;return s}var sx={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function ax(s){var a=this._longDateFormat[s],t=this._longDateFormat[s.toUpperCase()];return a||!t?a:(this._longDateFormat[s]=t.match(Xi).map(function(r){return r==="MMMM"||r==="MM"||r==="DD"||r==="dddd"?r.slice(1):r}).join(""),this._longDateFormat[s])}var tx="Invalid date";function rx(){return this._invalidDate}var nx="%d",ix=/\d{1,2}/;function lx(s){return this._ordinal.replace("%d",s)}var ox={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function cx(s,a,t,r){var n=this._relativeTime[t];return pa(n)?n(s,a,t,r):n.replace(/%d/i,s)}function dx(s,a){var t=this._relativeTime[s>0?"future":"past"];return pa(t)?t(a):t.replace(/%s/i,a)}var oo={D:"date",dates:"date",date:"date",d:"day",days:"day",day:"day",e:"weekday",weekdays:"weekday",weekday:"weekday",E:"isoWeekday",isoweekdays:"isoWeekday",isoweekday:"isoWeekday",DDD:"dayOfYear",dayofyears:"dayOfYear",dayofyear:"dayOfYear",h:"hour",hours:"hour",hour:"hour",ms:"millisecond",milliseconds:"millisecond",millisecond:"millisecond",m:"minute",minutes:"minute",minute:"minute",M:"month",months:"month",month:"month",Q:"quarter",quarters:"quarter",quarter:"quarter",s:"second",seconds:"second",second:"second",gg:"weekYear",weekyears:"weekYear",weekyear:"weekYear",GG:"isoWeekYear",isoweekyears:"isoWeekYear",isoweekyear:"isoWeekYear",w:"week",weeks:"week",week:"week",W:"isoWeek",isoweeks:"isoWeek",isoweek:"isoWeek",y:"year",years:"year",year:"year"};function Gs(s){return typeof s=="string"?oo[s]||oo[s.toLowerCase()]:void 0}function el(s){var a={},t,r;for(r in s)He(s,r)&&(t=Gs(r),t&&(a[t]=s[r]));return a}var mx={date:9,day:11,weekday:11,isoWeekday:11,dayOfYear:4,hour:13,millisecond:16,minute:14,month:8,quarter:7,second:15,weekYear:1,isoWeekYear:1,week:5,isoWeek:5,year:1};function ux(s){var a=[],t;for(t in s)He(s,t)&&a.push({unit:t,priority:mx[t]});return a.sort(function(r,n){return r.priority-n.priority}),a}var fc=/\d/,Rs=/\d\d/,jc=/\d{3}/,sl=/\d{4}/,Nn=/[+-]?\d{6}/,ns=/\d\d?/,yc=/\d\d\d\d?/,vc=/\d\d\d\d\d\d?/,wn=/\d{1,3}/,al=/\d{1,4}/,_n=/[+-]?\d{1,6}/,Vt=/\d+/,Cn=/[+-]?\d+/,hx=/Z|[+-]\d\d:?\d\d/gi,kn=/Z|[+-]\d\d(?::?\d\d)?/gi,xx=/[+-]?\d+(\.\d{1,3})?/,Nr=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,Ut=/^[1-9]\d?/,tl=/^([1-9]\d|\d)/,rn;rn={};function pe(s,a,t){rn[s]=pa(a)?a:function(r,n){return r&&t?t:a}}function px(s,a){return He(rn,s)?rn[s](a._strict,a._locale):new RegExp(gx(s))}function gx(s){return wa(s.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(a,t,r,n,l){return t||r||n||l}))}function wa(s){return s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function Is(s){return s<0?Math.ceil(s)||0:Math.floor(s)}function Ye(s){var a=+s,t=0;return a!==0&&isFinite(a)&&(t=Is(a)),t}var Ai={};function es(s,a){var t,r=a,n;for(typeof s=="string"&&(s=[s]),Ca(a)&&(r=function(l,c){c[a]=Ye(l)}),n=s.length,t=0;t<n;t++)Ai[s[t]]=r}function wr(s,a){es(s,function(t,r,n,l){n._w=n._w||{},a(t,n._w,n,l)})}function fx(s,a,t){a!=null&&He(Ai,s)&&Ai[s](a,t._a,t,s)}function Sn(s){return s%4===0&&s%100!==0||s%400===0}var Cs=0,ba=1,ca=2,fs=3,Zs=4,Na=5,rt=6,jx=7,yx=8;be("Y",0,0,function(){var s=this.year();return s<=9999?ha(s,4):"+"+s});be(0,["YY",2],0,function(){return this.year()%100});be(0,["YYYY",4],0,"year");be(0,["YYYYY",5],0,"year");be(0,["YYYYYY",6,!0],0,"year");pe("Y",Cn);pe("YY",ns,Rs);pe("YYYY",al,sl);pe("YYYYY",_n,Nn);pe("YYYYYY",_n,Nn);es(["YYYYY","YYYYYY"],Cs);es("YYYY",function(s,a){a[Cs]=s.length===2?ee.parseTwoDigitYear(s):Ye(s)});es("YY",function(s,a){a[Cs]=ee.parseTwoDigitYear(s)});es("Y",function(s,a){a[Cs]=parseInt(s,10)});function ir(s){return Sn(s)?366:365}ee.parseTwoDigitYear=function(s){return Ye(s)+(Ye(s)>68?1900:2e3)};var bc=Bt("FullYear",!0);function vx(){return Sn(this.year())}function Bt(s,a){return function(t){return t!=null?(Nc(this,s,t),ee.updateOffset(this,a),this):hr(this,s)}}function hr(s,a){if(!s.isValid())return NaN;var t=s._d,r=s._isUTC;switch(a){case"Milliseconds":return r?t.getUTCMilliseconds():t.getMilliseconds();case"Seconds":return r?t.getUTCSeconds():t.getSeconds();case"Minutes":return r?t.getUTCMinutes():t.getMinutes();case"Hours":return r?t.getUTCHours():t.getHours();case"Date":return r?t.getUTCDate():t.getDate();case"Day":return r?t.getUTCDay():t.getDay();case"Month":return r?t.getUTCMonth():t.getMonth();case"FullYear":return r?t.getUTCFullYear():t.getFullYear();default:return NaN}}function Nc(s,a,t){var r,n,l,c,d;if(!(!s.isValid()||isNaN(t))){switch(r=s._d,n=s._isUTC,a){case"Milliseconds":return void(n?r.setUTCMilliseconds(t):r.setMilliseconds(t));case"Seconds":return void(n?r.setUTCSeconds(t):r.setSeconds(t));case"Minutes":return void(n?r.setUTCMinutes(t):r.setMinutes(t));case"Hours":return void(n?r.setUTCHours(t):r.setHours(t));case"Date":return void(n?r.setUTCDate(t):r.setDate(t));case"FullYear":break;default:return}l=t,c=s.month(),d=s.date(),d=d===29&&c===1&&!Sn(l)?28:d,n?r.setUTCFullYear(l,c,d):r.setFullYear(l,c,d)}}function bx(s){return s=Gs(s),pa(this[s])?this[s]():this}function Nx(s,a){if(typeof s=="object"){s=el(s);var t=ux(s),r,n=t.length;for(r=0;r<n;r++)this[t[r].unit](s[t[r].unit])}else if(s=Gs(s),pa(this[s]))return this[s](a);return this}function wx(s,a){return(s%a+a)%a}var hs;Array.prototype.indexOf?hs=Array.prototype.indexOf:hs=function(s){var a;for(a=0;a<this.length;++a)if(this[a]===s)return a;return-1};function rl(s,a){if(isNaN(s)||isNaN(a))return NaN;var t=wx(a,12);return s+=(a-t)/12,t===1?Sn(s)?29:28:31-t%7%2}be("M",["MM",2],"Mo",function(){return this.month()+1});be("MMM",0,0,function(s){return this.localeData().monthsShort(this,s)});be("MMMM",0,0,function(s){return this.localeData().months(this,s)});pe("M",ns,Ut);pe("MM",ns,Rs);pe("MMM",function(s,a){return a.monthsShortRegex(s)});pe("MMMM",function(s,a){return a.monthsRegex(s)});es(["M","MM"],function(s,a){a[ba]=Ye(s)-1});es(["MMM","MMMM"],function(s,a,t,r){var n=t._locale.monthsParse(s,r,t._strict);n!=null?a[ba]=n:Oe(t).invalidMonth=s});var _x="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),wc="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),_c=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,Cx=Nr,kx=Nr;function Sx(s,a){return s?Xs(this._months)?this._months[s.month()]:this._months[(this._months.isFormat||_c).test(a)?"format":"standalone"][s.month()]:Xs(this._months)?this._months:this._months.standalone}function Dx(s,a){return s?Xs(this._monthsShort)?this._monthsShort[s.month()]:this._monthsShort[_c.test(a)?"format":"standalone"][s.month()]:Xs(this._monthsShort)?this._monthsShort:this._monthsShort.standalone}function Mx(s,a,t){var r,n,l,c=s.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],r=0;r<12;++r)l=xa([2e3,r]),this._shortMonthsParse[r]=this.monthsShort(l,"").toLocaleLowerCase(),this._longMonthsParse[r]=this.months(l,"").toLocaleLowerCase();return t?a==="MMM"?(n=hs.call(this._shortMonthsParse,c),n!==-1?n:null):(n=hs.call(this._longMonthsParse,c),n!==-1?n:null):a==="MMM"?(n=hs.call(this._shortMonthsParse,c),n!==-1?n:(n=hs.call(this._longMonthsParse,c),n!==-1?n:null)):(n=hs.call(this._longMonthsParse,c),n!==-1?n:(n=hs.call(this._shortMonthsParse,c),n!==-1?n:null))}function Ax(s,a,t){var r,n,l;if(this._monthsParseExact)return Mx.call(this,s,a,t);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),r=0;r<12;r++){if(n=xa([2e3,r]),t&&!this._longMonthsParse[r]&&(this._longMonthsParse[r]=new RegExp("^"+this.months(n,"").replace(".","")+"$","i"),this._shortMonthsParse[r]=new RegExp("^"+this.monthsShort(n,"").replace(".","")+"$","i")),!t&&!this._monthsParse[r]&&(l="^"+this.months(n,"")+"|^"+this.monthsShort(n,""),this._monthsParse[r]=new RegExp(l.replace(".",""),"i")),t&&a==="MMMM"&&this._longMonthsParse[r].test(s))return r;if(t&&a==="MMM"&&this._shortMonthsParse[r].test(s))return r;if(!t&&this._monthsParse[r].test(s))return r}}function Cc(s,a){if(!s.isValid())return s;if(typeof a=="string"){if(/^\d+$/.test(a))a=Ye(a);else if(a=s.localeData().monthsParse(a),!Ca(a))return s}var t=a,r=s.date();return r=r<29?r:Math.min(r,rl(s.year(),t)),s._isUTC?s._d.setUTCMonth(t,r):s._d.setMonth(t,r),s}function kc(s){return s!=null?(Cc(this,s),ee.updateOffset(this,!0),this):hr(this,"Month")}function Px(){return rl(this.year(),this.month())}function Ex(s){return this._monthsParseExact?(He(this,"_monthsRegex")||Sc.call(this),s?this._monthsShortStrictRegex:this._monthsShortRegex):(He(this,"_monthsShortRegex")||(this._monthsShortRegex=Cx),this._monthsShortStrictRegex&&s?this._monthsShortStrictRegex:this._monthsShortRegex)}function Ox(s){return this._monthsParseExact?(He(this,"_monthsRegex")||Sc.call(this),s?this._monthsStrictRegex:this._monthsRegex):(He(this,"_monthsRegex")||(this._monthsRegex=kx),this._monthsStrictRegex&&s?this._monthsStrictRegex:this._monthsRegex)}function Sc(){function s(i,o){return o.length-i.length}var a=[],t=[],r=[],n,l,c,d;for(n=0;n<12;n++)l=xa([2e3,n]),c=wa(this.monthsShort(l,"")),d=wa(this.months(l,"")),a.push(c),t.push(d),r.push(d),r.push(c);a.sort(s),t.sort(s),r.sort(s),this._monthsRegex=new RegExp("^("+r.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+t.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+a.join("|")+")","i")}function zx(s,a,t,r,n,l,c){var d;return s<100&&s>=0?(d=new Date(s+400,a,t,r,n,l,c),isFinite(d.getFullYear())&&d.setFullYear(s)):d=new Date(s,a,t,r,n,l,c),d}function xr(s){var a,t;return s<100&&s>=0?(t=Array.prototype.slice.call(arguments),t[0]=s+400,a=new Date(Date.UTC.apply(null,t)),isFinite(a.getUTCFullYear())&&a.setUTCFullYear(s)):a=new Date(Date.UTC.apply(null,arguments)),a}function nn(s,a,t){var r=7+a-t,n=(7+xr(s,0,r).getUTCDay()-a)%7;return-n+r-1}function Dc(s,a,t,r,n){var l=(7+t-r)%7,c=nn(s,r,n),d=1+7*(a-1)+l+c,i,o;return d<=0?(i=s-1,o=ir(i)+d):d>ir(s)?(i=s+1,o=d-ir(s)):(i=s,o=d),{year:i,dayOfYear:o}}function pr(s,a,t){var r=nn(s.year(),a,t),n=Math.floor((s.dayOfYear()-r-1)/7)+1,l,c;return n<1?(c=s.year()-1,l=n+_a(c,a,t)):n>_a(s.year(),a,t)?(l=n-_a(s.year(),a,t),c=s.year()+1):(c=s.year(),l=n),{week:l,year:c}}function _a(s,a,t){var r=nn(s,a,t),n=nn(s+1,a,t);return(ir(s)-r+n)/7}be("w",["ww",2],"wo","week");be("W",["WW",2],"Wo","isoWeek");pe("w",ns,Ut);pe("ww",ns,Rs);pe("W",ns,Ut);pe("WW",ns,Rs);wr(["w","ww","W","WW"],function(s,a,t,r){a[r.substr(0,1)]=Ye(s)});function Tx(s){return pr(s,this._week.dow,this._week.doy).week}var Fx={dow:0,doy:6};function Rx(){return this._week.dow}function Lx(){return this._week.doy}function Ix(s){var a=this.localeData().week(this);return s==null?a:this.add((s-a)*7,"d")}function qx(s){var a=pr(this,1,4).week;return s==null?a:this.add((s-a)*7,"d")}be("d",0,"do","day");be("dd",0,0,function(s){return this.localeData().weekdaysMin(this,s)});be("ddd",0,0,function(s){return this.localeData().weekdaysShort(this,s)});be("dddd",0,0,function(s){return this.localeData().weekdays(this,s)});be("e",0,0,"weekday");be("E",0,0,"isoWeekday");pe("d",ns);pe("e",ns);pe("E",ns);pe("dd",function(s,a){return a.weekdaysMinRegex(s)});pe("ddd",function(s,a){return a.weekdaysShortRegex(s)});pe("dddd",function(s,a){return a.weekdaysRegex(s)});wr(["dd","ddd","dddd"],function(s,a,t,r){var n=t._locale.weekdaysParse(s,r,t._strict);n!=null?a.d=n:Oe(t).invalidWeekday=s});wr(["d","e","E"],function(s,a,t,r){a[r]=Ye(s)});function $x(s,a){return typeof s!="string"?s:isNaN(s)?(s=a.weekdaysParse(s),typeof s=="number"?s:null):parseInt(s,10)}function Yx(s,a){return typeof s=="string"?a.weekdaysParse(s)%7||7:isNaN(s)?null:s}function nl(s,a){return s.slice(a,7).concat(s.slice(0,a))}var Gx="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),Mc="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),Vx="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),Ux=Nr,Bx=Nr,Wx=Nr;function Hx(s,a){var t=Xs(this._weekdays)?this._weekdays:this._weekdays[s&&s!==!0&&this._weekdays.isFormat.test(a)?"format":"standalone"];return s===!0?nl(t,this._week.dow):s?t[s.day()]:t}function Kx(s){return s===!0?nl(this._weekdaysShort,this._week.dow):s?this._weekdaysShort[s.day()]:this._weekdaysShort}function Qx(s){return s===!0?nl(this._weekdaysMin,this._week.dow):s?this._weekdaysMin[s.day()]:this._weekdaysMin}function Zx(s,a,t){var r,n,l,c=s.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],r=0;r<7;++r)l=xa([2e3,1]).day(r),this._minWeekdaysParse[r]=this.weekdaysMin(l,"").toLocaleLowerCase(),this._shortWeekdaysParse[r]=this.weekdaysShort(l,"").toLocaleLowerCase(),this._weekdaysParse[r]=this.weekdays(l,"").toLocaleLowerCase();return t?a==="dddd"?(n=hs.call(this._weekdaysParse,c),n!==-1?n:null):a==="ddd"?(n=hs.call(this._shortWeekdaysParse,c),n!==-1?n:null):(n=hs.call(this._minWeekdaysParse,c),n!==-1?n:null):a==="dddd"?(n=hs.call(this._weekdaysParse,c),n!==-1||(n=hs.call(this._shortWeekdaysParse,c),n!==-1)?n:(n=hs.call(this._minWeekdaysParse,c),n!==-1?n:null)):a==="ddd"?(n=hs.call(this._shortWeekdaysParse,c),n!==-1||(n=hs.call(this._weekdaysParse,c),n!==-1)?n:(n=hs.call(this._minWeekdaysParse,c),n!==-1?n:null)):(n=hs.call(this._minWeekdaysParse,c),n!==-1||(n=hs.call(this._weekdaysParse,c),n!==-1)?n:(n=hs.call(this._shortWeekdaysParse,c),n!==-1?n:null))}function Jx(s,a,t){var r,n,l;if(this._weekdaysParseExact)return Zx.call(this,s,a,t);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),r=0;r<7;r++){if(n=xa([2e3,1]).day(r),t&&!this._fullWeekdaysParse[r]&&(this._fullWeekdaysParse[r]=new RegExp("^"+this.weekdays(n,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[r]=new RegExp("^"+this.weekdaysShort(n,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[r]=new RegExp("^"+this.weekdaysMin(n,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[r]||(l="^"+this.weekdays(n,"")+"|^"+this.weekdaysShort(n,"")+"|^"+this.weekdaysMin(n,""),this._weekdaysParse[r]=new RegExp(l.replace(".",""),"i")),t&&a==="dddd"&&this._fullWeekdaysParse[r].test(s))return r;if(t&&a==="ddd"&&this._shortWeekdaysParse[r].test(s))return r;if(t&&a==="dd"&&this._minWeekdaysParse[r].test(s))return r;if(!t&&this._weekdaysParse[r].test(s))return r}}function Xx(s){if(!this.isValid())return s!=null?this:NaN;var a=hr(this,"Day");return s!=null?(s=$x(s,this.localeData()),this.add(s-a,"d")):a}function ep(s){if(!this.isValid())return s!=null?this:NaN;var a=(this.day()+7-this.localeData()._week.dow)%7;return s==null?a:this.add(s-a,"d")}function sp(s){if(!this.isValid())return s!=null?this:NaN;if(s!=null){var a=Yx(s,this.localeData());return this.day(this.day()%7?a:a-7)}else return this.day()||7}function ap(s){return this._weekdaysParseExact?(He(this,"_weekdaysRegex")||il.call(this),s?this._weekdaysStrictRegex:this._weekdaysRegex):(He(this,"_weekdaysRegex")||(this._weekdaysRegex=Ux),this._weekdaysStrictRegex&&s?this._weekdaysStrictRegex:this._weekdaysRegex)}function tp(s){return this._weekdaysParseExact?(He(this,"_weekdaysRegex")||il.call(this),s?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(He(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=Bx),this._weekdaysShortStrictRegex&&s?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)}function rp(s){return this._weekdaysParseExact?(He(this,"_weekdaysRegex")||il.call(this),s?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(He(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=Wx),this._weekdaysMinStrictRegex&&s?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)}function il(){function s(m,p){return p.length-m.length}var a=[],t=[],r=[],n=[],l,c,d,i,o;for(l=0;l<7;l++)c=xa([2e3,1]).day(l),d=wa(this.weekdaysMin(c,"")),i=wa(this.weekdaysShort(c,"")),o=wa(this.weekdays(c,"")),a.push(d),t.push(i),r.push(o),n.push(d),n.push(i),n.push(o);a.sort(s),t.sort(s),r.sort(s),n.sort(s),this._weekdaysRegex=new RegExp("^("+n.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+r.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+t.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+a.join("|")+")","i")}function ll(){return this.hours()%12||12}function np(){return this.hours()||24}be("H",["HH",2],0,"hour");be("h",["hh",2],0,ll);be("k",["kk",2],0,np);be("hmm",0,0,function(){return""+ll.apply(this)+ha(this.minutes(),2)});be("hmmss",0,0,function(){return""+ll.apply(this)+ha(this.minutes(),2)+ha(this.seconds(),2)});be("Hmm",0,0,function(){return""+this.hours()+ha(this.minutes(),2)});be("Hmmss",0,0,function(){return""+this.hours()+ha(this.minutes(),2)+ha(this.seconds(),2)});function Ac(s,a){be(s,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),a)})}Ac("a",!0);Ac("A",!1);function Pc(s,a){return a._meridiemParse}pe("a",Pc);pe("A",Pc);pe("H",ns,tl);pe("h",ns,Ut);pe("k",ns,Ut);pe("HH",ns,Rs);pe("hh",ns,Rs);pe("kk",ns,Rs);pe("hmm",yc);pe("hmmss",vc);pe("Hmm",yc);pe("Hmmss",vc);es(["H","HH"],fs);es(["k","kk"],function(s,a,t){var r=Ye(s);a[fs]=r===24?0:r});es(["a","A"],function(s,a,t){t._isPm=t._locale.isPM(s),t._meridiem=s});es(["h","hh"],function(s,a,t){a[fs]=Ye(s),Oe(t).bigHour=!0});es("hmm",function(s,a,t){var r=s.length-2;a[fs]=Ye(s.substr(0,r)),a[Zs]=Ye(s.substr(r)),Oe(t).bigHour=!0});es("hmmss",function(s,a,t){var r=s.length-4,n=s.length-2;a[fs]=Ye(s.substr(0,r)),a[Zs]=Ye(s.substr(r,2)),a[Na]=Ye(s.substr(n)),Oe(t).bigHour=!0});es("Hmm",function(s,a,t){var r=s.length-2;a[fs]=Ye(s.substr(0,r)),a[Zs]=Ye(s.substr(r))});es("Hmmss",function(s,a,t){var r=s.length-4,n=s.length-2;a[fs]=Ye(s.substr(0,r)),a[Zs]=Ye(s.substr(r,2)),a[Na]=Ye(s.substr(n))});function ip(s){return(s+"").toLowerCase().charAt(0)==="p"}var lp=/[ap]\.?m?\.?/i,op=Bt("Hours",!0);function cp(s,a,t){return s>11?t?"pm":"PM":t?"am":"AM"}var Ec={calendar:Zh,longDateFormat:sx,invalidDate:tx,ordinal:nx,dayOfMonthOrdinalParse:ix,relativeTime:ox,months:_x,monthsShort:wc,week:Fx,weekdays:Gx,weekdaysMin:Vx,weekdaysShort:Mc,meridiemParse:lp},is={},Zt={},gr;function dp(s,a){var t,r=Math.min(s.length,a.length);for(t=0;t<r;t+=1)if(s[t]!==a[t])return t;return r}function co(s){return s&&s.toLowerCase().replace("_","-")}function mp(s){for(var a=0,t,r,n,l;a<s.length;){for(l=co(s[a]).split("-"),t=l.length,r=co(s[a+1]),r=r?r.split("-"):null;t>0;){if(n=Dn(l.slice(0,t).join("-")),n)return n;if(r&&r.length>=t&&dp(l,r)>=t-1)break;t--}a++}return gr}function up(s){return!!(s&&s.match("^[^/\\\\]*$"))}function Dn(s){var a=null,t;if(is[s]===void 0&&typeof module<"u"&&module&&module.exports&&up(s))try{a=gr._abbr,t=Wh,t("./locale/"+s),qa(a)}catch{is[s]=null}return is[s]}function qa(s,a){var t;return s&&(As(a)?t=ka(s):t=ol(s,a),t?gr=t:typeof console<"u"&&console.warn&&console.warn("Locale "+s+" not found. Did you forget to load it?")),gr._abbr}function ol(s,a){if(a!==null){var t,r=Ec;if(a.abbr=s,is[s]!=null)pc("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),r=is[s]._config;else if(a.parentLocale!=null)if(is[a.parentLocale]!=null)r=is[a.parentLocale]._config;else if(t=Dn(a.parentLocale),t!=null)r=t._config;else return Zt[a.parentLocale]||(Zt[a.parentLocale]=[]),Zt[a.parentLocale].push({name:s,config:a}),null;return is[s]=new Ji(Di(r,a)),Zt[s]&&Zt[s].forEach(function(n){ol(n.name,n.config)}),qa(s),is[s]}else return delete is[s],null}function hp(s,a){if(a!=null){var t,r,n=Ec;is[s]!=null&&is[s].parentLocale!=null?is[s].set(Di(is[s]._config,a)):(r=Dn(s),r!=null&&(n=r._config),a=Di(n,a),r==null&&(a.abbr=s),t=new Ji(a),t.parentLocale=is[s],is[s]=t),qa(s)}else is[s]!=null&&(is[s].parentLocale!=null?(is[s]=is[s].parentLocale,s===qa()&&qa(s)):is[s]!=null&&delete is[s]);return is[s]}function ka(s){var a;if(s&&s._locale&&s._locale._abbr&&(s=s._locale._abbr),!s)return gr;if(!Xs(s)){if(a=Dn(s),a)return a;s=[s]}return mp(s)}function xp(){return Mi(is)}function cl(s){var a,t=s._a;return t&&Oe(s).overflow===-2&&(a=t[ba]<0||t[ba]>11?ba:t[ca]<1||t[ca]>rl(t[Cs],t[ba])?ca:t[fs]<0||t[fs]>24||t[fs]===24&&(t[Zs]!==0||t[Na]!==0||t[rt]!==0)?fs:t[Zs]<0||t[Zs]>59?Zs:t[Na]<0||t[Na]>59?Na:t[rt]<0||t[rt]>999?rt:-1,Oe(s)._overflowDayOfYear&&(a<Cs||a>ca)&&(a=ca),Oe(s)._overflowWeeks&&a===-1&&(a=jx),Oe(s)._overflowWeekday&&a===-1&&(a=yx),Oe(s).overflow=a),s}var pp=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,gp=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,fp=/Z|[+-]\d\d(?::?\d\d)?/,Tr=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],mi=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],jp=/^\/?Date\((-?\d+)/i,yp=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,vp={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function Oc(s){var a,t,r=s._i,n=pp.exec(r)||gp.exec(r),l,c,d,i,o=Tr.length,m=mi.length;if(n){for(Oe(s).iso=!0,a=0,t=o;a<t;a++)if(Tr[a][1].exec(n[1])){c=Tr[a][0],l=Tr[a][2]!==!1;break}if(c==null){s._isValid=!1;return}if(n[3]){for(a=0,t=m;a<t;a++)if(mi[a][1].exec(n[3])){d=(n[2]||" ")+mi[a][0];break}if(d==null){s._isValid=!1;return}}if(!l&&d!=null){s._isValid=!1;return}if(n[4])if(fp.exec(n[4]))i="Z";else{s._isValid=!1;return}s._f=c+(d||"")+(i||""),ml(s)}else s._isValid=!1}function bp(s,a,t,r,n,l){var c=[Np(s),wc.indexOf(a),parseInt(t,10),parseInt(r,10),parseInt(n,10)];return l&&c.push(parseInt(l,10)),c}function Np(s){var a=parseInt(s,10);return a<=49?2e3+a:a<=999?1900+a:a}function wp(s){return s.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function _p(s,a,t){if(s){var r=Mc.indexOf(s),n=new Date(a[0],a[1],a[2]).getDay();if(r!==n)return Oe(t).weekdayMismatch=!0,t._isValid=!1,!1}return!0}function Cp(s,a,t){if(s)return vp[s];if(a)return 0;var r=parseInt(t,10),n=r%100,l=(r-n)/100;return l*60+n}function zc(s){var a=yp.exec(wp(s._i)),t;if(a){if(t=bp(a[4],a[3],a[2],a[5],a[6],a[7]),!_p(a[1],t,s))return;s._a=t,s._tzm=Cp(a[8],a[9],a[10]),s._d=xr.apply(null,s._a),s._d.setUTCMinutes(s._d.getUTCMinutes()-s._tzm),Oe(s).rfc2822=!0}else s._isValid=!1}function kp(s){var a=jp.exec(s._i);if(a!==null){s._d=new Date(+a[1]);return}if(Oc(s),s._isValid===!1)delete s._isValid;else return;if(zc(s),s._isValid===!1)delete s._isValid;else return;s._strict?s._isValid=!1:ee.createFromInputFallback(s)}ee.createFromInputFallback=Ys("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(s){s._d=new Date(s._i+(s._useUTC?" UTC":""))});function St(s,a,t){return s??a??t}function Sp(s){var a=new Date(ee.now());return s._useUTC?[a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate()]:[a.getFullYear(),a.getMonth(),a.getDate()]}function dl(s){var a,t,r=[],n,l,c;if(!s._d){for(n=Sp(s),s._w&&s._a[ca]==null&&s._a[ba]==null&&Dp(s),s._dayOfYear!=null&&(c=St(s._a[Cs],n[Cs]),(s._dayOfYear>ir(c)||s._dayOfYear===0)&&(Oe(s)._overflowDayOfYear=!0),t=xr(c,0,s._dayOfYear),s._a[ba]=t.getUTCMonth(),s._a[ca]=t.getUTCDate()),a=0;a<3&&s._a[a]==null;++a)s._a[a]=r[a]=n[a];for(;a<7;a++)s._a[a]=r[a]=s._a[a]==null?a===2?1:0:s._a[a];s._a[fs]===24&&s._a[Zs]===0&&s._a[Na]===0&&s._a[rt]===0&&(s._nextDay=!0,s._a[fs]=0),s._d=(s._useUTC?xr:zx).apply(null,r),l=s._useUTC?s._d.getUTCDay():s._d.getDay(),s._tzm!=null&&s._d.setUTCMinutes(s._d.getUTCMinutes()-s._tzm),s._nextDay&&(s._a[fs]=24),s._w&&typeof s._w.d<"u"&&s._w.d!==l&&(Oe(s).weekdayMismatch=!0)}}function Dp(s){var a,t,r,n,l,c,d,i,o;a=s._w,a.GG!=null||a.W!=null||a.E!=null?(l=1,c=4,t=St(a.GG,s._a[Cs],pr(rs(),1,4).year),r=St(a.W,1),n=St(a.E,1),(n<1||n>7)&&(i=!0)):(l=s._locale._week.dow,c=s._locale._week.doy,o=pr(rs(),l,c),t=St(a.gg,s._a[Cs],o.year),r=St(a.w,o.week),a.d!=null?(n=a.d,(n<0||n>6)&&(i=!0)):a.e!=null?(n=a.e+l,(a.e<0||a.e>6)&&(i=!0)):n=l),r<1||r>_a(t,l,c)?Oe(s)._overflowWeeks=!0:i!=null?Oe(s)._overflowWeekday=!0:(d=Dc(t,r,n,l,c),s._a[Cs]=d.year,s._dayOfYear=d.dayOfYear)}ee.ISO_8601=function(){};ee.RFC_2822=function(){};function ml(s){if(s._f===ee.ISO_8601){Oc(s);return}if(s._f===ee.RFC_2822){zc(s);return}s._a=[],Oe(s).empty=!0;var a=""+s._i,t,r,n,l,c,d=a.length,i=0,o,m;for(n=gc(s._f,s._locale).match(Xi)||[],m=n.length,t=0;t<m;t++)l=n[t],r=(a.match(px(l,s))||[])[0],r&&(c=a.substr(0,a.indexOf(r)),c.length>0&&Oe(s).unusedInput.push(c),a=a.slice(a.indexOf(r)+r.length),i+=r.length),zt[l]?(r?Oe(s).empty=!1:Oe(s).unusedTokens.push(l),fx(l,r,s)):s._strict&&!r&&Oe(s).unusedTokens.push(l);Oe(s).charsLeftOver=d-i,a.length>0&&Oe(s).unusedInput.push(a),s._a[fs]<=12&&Oe(s).bigHour===!0&&s._a[fs]>0&&(Oe(s).bigHour=void 0),Oe(s).parsedDateParts=s._a.slice(0),Oe(s).meridiem=s._meridiem,s._a[fs]=Mp(s._locale,s._a[fs],s._meridiem),o=Oe(s).era,o!==null&&(s._a[Cs]=s._locale.erasConvertYear(o,s._a[Cs])),dl(s),cl(s)}function Mp(s,a,t){var r;return t==null?a:s.meridiemHour!=null?s.meridiemHour(a,t):(s.isPM!=null&&(r=s.isPM(t),r&&a<12&&(a+=12),!r&&a===12&&(a=0)),a)}function Ap(s){var a,t,r,n,l,c,d=!1,i=s._f.length;if(i===0){Oe(s).invalidFormat=!0,s._d=new Date(NaN);return}for(n=0;n<i;n++)l=0,c=!1,a=Zi({},s),s._useUTC!=null&&(a._useUTC=s._useUTC),a._f=s._f[n],ml(a),Qi(a)&&(c=!0),l+=Oe(a).charsLeftOver,l+=Oe(a).unusedTokens.length*10,Oe(a).score=l,d?l<r&&(r=l,t=a):(r==null||l<r||c)&&(r=l,t=a,c&&(d=!0));Ta(s,t||a)}function Pp(s){if(!s._d){var a=el(s._i),t=a.day===void 0?a.date:a.day;s._a=hc([a.year,a.month,t,a.hour,a.minute,a.second,a.millisecond],function(r){return r&&parseInt(r,10)}),dl(s)}}function Ep(s){var a=new br(cl(Tc(s)));return a._nextDay&&(a.add(1,"d"),a._nextDay=void 0),a}function Tc(s){var a=s._i,t=s._f;return s._locale=s._locale||ka(s._l),a===null||t===void 0&&a===""?bn({nullInput:!0}):(typeof a=="string"&&(s._i=a=s._locale.preparse(a)),ea(a)?new br(cl(a)):(vr(a)?s._d=a:Xs(t)?Ap(s):t?ml(s):Op(s),Qi(s)||(s._d=null),s))}function Op(s){var a=s._i;As(a)?s._d=new Date(ee.now()):vr(a)?s._d=new Date(a.valueOf()):typeof a=="string"?kp(s):Xs(a)?(s._a=hc(a.slice(0),function(t){return parseInt(t,10)}),dl(s)):ct(a)?Pp(s):Ca(a)?s._d=new Date(a):ee.createFromInputFallback(s)}function Fc(s,a,t,r,n){var l={};return(a===!0||a===!1)&&(r=a,a=void 0),(t===!0||t===!1)&&(r=t,t=void 0),(ct(s)&&Ki(s)||Xs(s)&&s.length===0)&&(s=void 0),l._isAMomentObject=!0,l._useUTC=l._isUTC=n,l._l=t,l._i=s,l._f=a,l._strict=r,Ep(l)}function rs(s,a,t,r){return Fc(s,a,t,r,!1)}var zp=Ys("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var s=rs.apply(null,arguments);return this.isValid()&&s.isValid()?s<this?this:s:bn()}),Tp=Ys("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var s=rs.apply(null,arguments);return this.isValid()&&s.isValid()?s>this?this:s:bn()});function Rc(s,a){var t,r;if(a.length===1&&Xs(a[0])&&(a=a[0]),!a.length)return rs();for(t=a[0],r=1;r<a.length;++r)(!a[r].isValid()||a[r][s](t))&&(t=a[r]);return t}function Fp(){var s=[].slice.call(arguments,0);return Rc("isBefore",s)}function Rp(){var s=[].slice.call(arguments,0);return Rc("isAfter",s)}var Lp=function(){return Date.now?Date.now():+new Date},Jt=["year","quarter","month","week","day","hour","minute","second","millisecond"];function Ip(s){var a,t=!1,r,n=Jt.length;for(a in s)if(He(s,a)&&!(hs.call(Jt,a)!==-1&&(s[a]==null||!isNaN(s[a]))))return!1;for(r=0;r<n;++r)if(s[Jt[r]]){if(t)return!1;parseFloat(s[Jt[r]])!==Ye(s[Jt[r]])&&(t=!0)}return!0}function qp(){return this._isValid}function $p(){return sa(NaN)}function Mn(s){var a=el(s),t=a.year||0,r=a.quarter||0,n=a.month||0,l=a.week||a.isoWeek||0,c=a.day||0,d=a.hour||0,i=a.minute||0,o=a.second||0,m=a.millisecond||0;this._isValid=Ip(a),this._milliseconds=+m+o*1e3+i*6e4+d*1e3*60*60,this._days=+c+l*7,this._months=+n+r*3+t*12,this._data={},this._locale=ka(),this._bubble()}function Vr(s){return s instanceof Mn}function Pi(s){return s<0?Math.round(-1*s)*-1:Math.round(s)}function Yp(s,a,t){var r=Math.min(s.length,a.length),n=Math.abs(s.length-a.length),l=0,c;for(c=0;c<r;c++)Ye(s[c])!==Ye(a[c])&&l++;return l+n}function Lc(s,a){be(s,0,0,function(){var t=this.utcOffset(),r="+";return t<0&&(t=-t,r="-"),r+ha(~~(t/60),2)+a+ha(~~t%60,2)})}Lc("Z",":");Lc("ZZ","");pe("Z",kn);pe("ZZ",kn);es(["Z","ZZ"],function(s,a,t){t._useUTC=!0,t._tzm=ul(kn,s)});var Gp=/([\+\-]|\d\d)/gi;function ul(s,a){var t=(a||"").match(s),r,n,l;return t===null?null:(r=t[t.length-1]||[],n=(r+"").match(Gp)||["-",0,0],l=+(n[1]*60)+Ye(n[2]),l===0?0:n[0]==="+"?l:-l)}function hl(s,a){var t,r;return a._isUTC?(t=a.clone(),r=(ea(s)||vr(s)?s.valueOf():rs(s).valueOf())-t.valueOf(),t._d.setTime(t._d.valueOf()+r),ee.updateOffset(t,!1),t):rs(s).local()}function Ei(s){return-Math.round(s._d.getTimezoneOffset())}ee.updateOffset=function(){};function Vp(s,a,t){var r=this._offset||0,n;if(!this.isValid())return s!=null?this:NaN;if(s!=null){if(typeof s=="string"){if(s=ul(kn,s),s===null)return this}else Math.abs(s)<16&&!t&&(s=s*60);return!this._isUTC&&a&&(n=Ei(this)),this._offset=s,this._isUTC=!0,n!=null&&this.add(n,"m"),r!==s&&(!a||this._changeInProgress?$c(this,sa(s-r,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,ee.updateOffset(this,!0),this._changeInProgress=null)),this}else return this._isUTC?r:Ei(this)}function Up(s,a){return s!=null?(typeof s!="string"&&(s=-s),this.utcOffset(s,a),this):-this.utcOffset()}function Bp(s){return this.utcOffset(0,s)}function Wp(s){return this._isUTC&&(this.utcOffset(0,s),this._isUTC=!1,s&&this.subtract(Ei(this),"m")),this}function Hp(){if(this._tzm!=null)this.utcOffset(this._tzm,!1,!0);else if(typeof this._i=="string"){var s=ul(hx,this._i);s!=null?this.utcOffset(s):this.utcOffset(0,!0)}return this}function Kp(s){return this.isValid()?(s=s?rs(s).utcOffset():0,(this.utcOffset()-s)%60===0):!1}function Qp(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function Zp(){if(!As(this._isDSTShifted))return this._isDSTShifted;var s={},a;return Zi(s,this),s=Tc(s),s._a?(a=s._isUTC?xa(s._a):rs(s._a),this._isDSTShifted=this.isValid()&&Yp(s._a,a.toArray())>0):this._isDSTShifted=!1,this._isDSTShifted}function Jp(){return this.isValid()?!this._isUTC:!1}function Xp(){return this.isValid()?this._isUTC:!1}function Ic(){return this.isValid()?this._isUTC&&this._offset===0:!1}var eg=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,sg=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function sa(s,a){var t=s,r=null,n,l,c;return Vr(s)?t={ms:s._milliseconds,d:s._days,M:s._months}:Ca(s)||!isNaN(+s)?(t={},a?t[a]=+s:t.milliseconds=+s):(r=eg.exec(s))?(n=r[1]==="-"?-1:1,t={y:0,d:Ye(r[ca])*n,h:Ye(r[fs])*n,m:Ye(r[Zs])*n,s:Ye(r[Na])*n,ms:Ye(Pi(r[rt]*1e3))*n}):(r=sg.exec(s))?(n=r[1]==="-"?-1:1,t={y:Ua(r[2],n),M:Ua(r[3],n),w:Ua(r[4],n),d:Ua(r[5],n),h:Ua(r[6],n),m:Ua(r[7],n),s:Ua(r[8],n)}):t==null?t={}:typeof t=="object"&&("from"in t||"to"in t)&&(c=ag(rs(t.from),rs(t.to)),t={},t.ms=c.milliseconds,t.M=c.months),l=new Mn(t),Vr(s)&&He(s,"_locale")&&(l._locale=s._locale),Vr(s)&&He(s,"_isValid")&&(l._isValid=s._isValid),l}sa.fn=Mn.prototype;sa.invalid=$p;function Ua(s,a){var t=s&&parseFloat(s.replace(",","."));return(isNaN(t)?0:t)*a}function mo(s,a){var t={};return t.months=a.month()-s.month()+(a.year()-s.year())*12,s.clone().add(t.months,"M").isAfter(a)&&--t.months,t.milliseconds=+a-+s.clone().add(t.months,"M"),t}function ag(s,a){var t;return s.isValid()&&a.isValid()?(a=hl(a,s),s.isBefore(a)?t=mo(s,a):(t=mo(a,s),t.milliseconds=-t.milliseconds,t.months=-t.months),t):{milliseconds:0,months:0}}function qc(s,a){return function(t,r){var n,l;return r!==null&&!isNaN(+r)&&(pc(a,"moment()."+a+"(period, number) is deprecated. Please use moment()."+a+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),l=t,t=r,r=l),n=sa(t,r),$c(this,n,s),this}}function $c(s,a,t,r){var n=a._milliseconds,l=Pi(a._days),c=Pi(a._months);s.isValid()&&(r=r??!0,c&&Cc(s,hr(s,"Month")+c*t),l&&Nc(s,"Date",hr(s,"Date")+l*t),n&&s._d.setTime(s._d.valueOf()+n*t),r&&ee.updateOffset(s,l||c))}var tg=qc(1,"add"),rg=qc(-1,"subtract");function Yc(s){return typeof s=="string"||s instanceof String}function ng(s){return ea(s)||vr(s)||Yc(s)||Ca(s)||lg(s)||ig(s)||s===null||s===void 0}function ig(s){var a=ct(s)&&!Ki(s),t=!1,r=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],n,l,c=r.length;for(n=0;n<c;n+=1)l=r[n],t=t||He(s,l);return a&&t}function lg(s){var a=Xs(s),t=!1;return a&&(t=s.filter(function(r){return!Ca(r)&&Yc(s)}).length===0),a&&t}function og(s){var a=ct(s)&&!Ki(s),t=!1,r=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"],n,l;for(n=0;n<r.length;n+=1)l=r[n],t=t||He(s,l);return a&&t}function cg(s,a){var t=s.diff(a,"days",!0);return t<-6?"sameElse":t<-1?"lastWeek":t<0?"lastDay":t<1?"sameDay":t<2?"nextDay":t<7?"nextWeek":"sameElse"}function dg(s,a){arguments.length===1&&(arguments[0]?ng(arguments[0])?(s=arguments[0],a=void 0):og(arguments[0])&&(a=arguments[0],s=void 0):(s=void 0,a=void 0));var t=s||rs(),r=hl(t,this).startOf("day"),n=ee.calendarFormat(this,r)||"sameElse",l=a&&(pa(a[n])?a[n].call(this,t):a[n]);return this.format(l||this.localeData().calendar(n,this,rs(t)))}function mg(){return new br(this)}function ug(s,a){var t=ea(s)?s:rs(s);return this.isValid()&&t.isValid()?(a=Gs(a)||"millisecond",a==="millisecond"?this.valueOf()>t.valueOf():t.valueOf()<this.clone().startOf(a).valueOf()):!1}function hg(s,a){var t=ea(s)?s:rs(s);return this.isValid()&&t.isValid()?(a=Gs(a)||"millisecond",a==="millisecond"?this.valueOf()<t.valueOf():this.clone().endOf(a).valueOf()<t.valueOf()):!1}function xg(s,a,t,r){var n=ea(s)?s:rs(s),l=ea(a)?a:rs(a);return this.isValid()&&n.isValid()&&l.isValid()?(r=r||"()",(r[0]==="("?this.isAfter(n,t):!this.isBefore(n,t))&&(r[1]===")"?this.isBefore(l,t):!this.isAfter(l,t))):!1}function pg(s,a){var t=ea(s)?s:rs(s),r;return this.isValid()&&t.isValid()?(a=Gs(a)||"millisecond",a==="millisecond"?this.valueOf()===t.valueOf():(r=t.valueOf(),this.clone().startOf(a).valueOf()<=r&&r<=this.clone().endOf(a).valueOf())):!1}function gg(s,a){return this.isSame(s,a)||this.isAfter(s,a)}function fg(s,a){return this.isSame(s,a)||this.isBefore(s,a)}function jg(s,a,t){var r,n,l;if(!this.isValid())return NaN;if(r=hl(s,this),!r.isValid())return NaN;switch(n=(r.utcOffset()-this.utcOffset())*6e4,a=Gs(a),a){case"year":l=Ur(this,r)/12;break;case"month":l=Ur(this,r);break;case"quarter":l=Ur(this,r)/3;break;case"second":l=(this-r)/1e3;break;case"minute":l=(this-r)/6e4;break;case"hour":l=(this-r)/36e5;break;case"day":l=(this-r-n)/864e5;break;case"week":l=(this-r-n)/6048e5;break;default:l=this-r}return t?l:Is(l)}function Ur(s,a){if(s.date()<a.date())return-Ur(a,s);var t=(a.year()-s.year())*12+(a.month()-s.month()),r=s.clone().add(t,"months"),n,l;return a-r<0?(n=s.clone().add(t-1,"months"),l=(a-r)/(r-n)):(n=s.clone().add(t+1,"months"),l=(a-r)/(n-r)),-(t+l)||0}ee.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";ee.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";function yg(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function vg(s){if(!this.isValid())return null;var a=s!==!0,t=a?this.clone().utc():this;return t.year()<0||t.year()>9999?Gr(t,a?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):pa(Date.prototype.toISOString)?a?this.toDate().toISOString():new Date(this.valueOf()+this.utcOffset()*60*1e3).toISOString().replace("Z",Gr(t,"Z")):Gr(t,a?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")}function bg(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var s="moment",a="",t,r,n,l;return this.isLocal()||(s=this.utcOffset()===0?"moment.utc":"moment.parseZone",a="Z"),t="["+s+'("]',r=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",n="-MM-DD[T]HH:mm:ss.SSS",l=a+'[")]',this.format(t+r+n+l)}function Ng(s){s||(s=this.isUtc()?ee.defaultFormatUtc:ee.defaultFormat);var a=Gr(this,s);return this.localeData().postformat(a)}function wg(s,a){return this.isValid()&&(ea(s)&&s.isValid()||rs(s).isValid())?sa({to:this,from:s}).locale(this.locale()).humanize(!a):this.localeData().invalidDate()}function _g(s){return this.from(rs(),s)}function Cg(s,a){return this.isValid()&&(ea(s)&&s.isValid()||rs(s).isValid())?sa({from:this,to:s}).locale(this.locale()).humanize(!a):this.localeData().invalidDate()}function kg(s){return this.to(rs(),s)}function Gc(s){var a;return s===void 0?this._locale._abbr:(a=ka(s),a!=null&&(this._locale=a),this)}var Vc=Ys("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(s){return s===void 0?this.localeData():this.locale(s)});function Uc(){return this._locale}var ln=1e3,Tt=60*ln,on=60*Tt,Bc=(365*400+97)*24*on;function Ft(s,a){return(s%a+a)%a}function Wc(s,a,t){return s<100&&s>=0?new Date(s+400,a,t)-Bc:new Date(s,a,t).valueOf()}function Hc(s,a,t){return s<100&&s>=0?Date.UTC(s+400,a,t)-Bc:Date.UTC(s,a,t)}function Sg(s){var a,t;if(s=Gs(s),s===void 0||s==="millisecond"||!this.isValid())return this;switch(t=this._isUTC?Hc:Wc,s){case"year":a=t(this.year(),0,1);break;case"quarter":a=t(this.year(),this.month()-this.month()%3,1);break;case"month":a=t(this.year(),this.month(),1);break;case"week":a=t(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":a=t(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":a=t(this.year(),this.month(),this.date());break;case"hour":a=this._d.valueOf(),a-=Ft(a+(this._isUTC?0:this.utcOffset()*Tt),on);break;case"minute":a=this._d.valueOf(),a-=Ft(a,Tt);break;case"second":a=this._d.valueOf(),a-=Ft(a,ln);break}return this._d.setTime(a),ee.updateOffset(this,!0),this}function Dg(s){var a,t;if(s=Gs(s),s===void 0||s==="millisecond"||!this.isValid())return this;switch(t=this._isUTC?Hc:Wc,s){case"year":a=t(this.year()+1,0,1)-1;break;case"quarter":a=t(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":a=t(this.year(),this.month()+1,1)-1;break;case"week":a=t(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":a=t(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":a=t(this.year(),this.month(),this.date()+1)-1;break;case"hour":a=this._d.valueOf(),a+=on-Ft(a+(this._isUTC?0:this.utcOffset()*Tt),on)-1;break;case"minute":a=this._d.valueOf(),a+=Tt-Ft(a,Tt)-1;break;case"second":a=this._d.valueOf(),a+=ln-Ft(a,ln)-1;break}return this._d.setTime(a),ee.updateOffset(this,!0),this}function Mg(){return this._d.valueOf()-(this._offset||0)*6e4}function Ag(){return Math.floor(this.valueOf()/1e3)}function Pg(){return new Date(this.valueOf())}function Eg(){var s=this;return[s.year(),s.month(),s.date(),s.hour(),s.minute(),s.second(),s.millisecond()]}function Og(){var s=this;return{years:s.year(),months:s.month(),date:s.date(),hours:s.hours(),minutes:s.minutes(),seconds:s.seconds(),milliseconds:s.milliseconds()}}function zg(){return this.isValid()?this.toISOString():null}function Tg(){return Qi(this)}function Fg(){return Ta({},Oe(this))}function Rg(){return Oe(this).overflow}function Lg(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}be("N",0,0,"eraAbbr");be("NN",0,0,"eraAbbr");be("NNN",0,0,"eraAbbr");be("NNNN",0,0,"eraName");be("NNNNN",0,0,"eraNarrow");be("y",["y",1],"yo","eraYear");be("y",["yy",2],0,"eraYear");be("y",["yyy",3],0,"eraYear");be("y",["yyyy",4],0,"eraYear");pe("N",xl);pe("NN",xl);pe("NNN",xl);pe("NNNN",Kg);pe("NNNNN",Qg);es(["N","NN","NNN","NNNN","NNNNN"],function(s,a,t,r){var n=t._locale.erasParse(s,r,t._strict);n?Oe(t).era=n:Oe(t).invalidEra=s});pe("y",Vt);pe("yy",Vt);pe("yyy",Vt);pe("yyyy",Vt);pe("yo",Zg);es(["y","yy","yyy","yyyy"],Cs);es(["yo"],function(s,a,t,r){var n;t._locale._eraYearOrdinalRegex&&(n=s.match(t._locale._eraYearOrdinalRegex)),t._locale.eraYearOrdinalParse?a[Cs]=t._locale.eraYearOrdinalParse(s,n):a[Cs]=parseInt(s,10)});function Ig(s,a){var t,r,n,l=this._eras||ka("en")._eras;for(t=0,r=l.length;t<r;++t){switch(typeof l[t].since){case"string":n=ee(l[t].since).startOf("day"),l[t].since=n.valueOf();break}switch(typeof l[t].until){case"undefined":l[t].until=1/0;break;case"string":n=ee(l[t].until).startOf("day").valueOf(),l[t].until=n.valueOf();break}}return l}function qg(s,a,t){var r,n,l=this.eras(),c,d,i;for(s=s.toUpperCase(),r=0,n=l.length;r<n;++r)if(c=l[r].name.toUpperCase(),d=l[r].abbr.toUpperCase(),i=l[r].narrow.toUpperCase(),t)switch(a){case"N":case"NN":case"NNN":if(d===s)return l[r];break;case"NNNN":if(c===s)return l[r];break;case"NNNNN":if(i===s)return l[r];break}else if([c,d,i].indexOf(s)>=0)return l[r]}function $g(s,a){var t=s.since<=s.until?1:-1;return a===void 0?ee(s.since).year():ee(s.since).year()+(a-s.offset)*t}function Yg(){var s,a,t,r=this.localeData().eras();for(s=0,a=r.length;s<a;++s)if(t=this.clone().startOf("day").valueOf(),r[s].since<=t&&t<=r[s].until||r[s].until<=t&&t<=r[s].since)return r[s].name;return""}function Gg(){var s,a,t,r=this.localeData().eras();for(s=0,a=r.length;s<a;++s)if(t=this.clone().startOf("day").valueOf(),r[s].since<=t&&t<=r[s].until||r[s].until<=t&&t<=r[s].since)return r[s].narrow;return""}function Vg(){var s,a,t,r=this.localeData().eras();for(s=0,a=r.length;s<a;++s)if(t=this.clone().startOf("day").valueOf(),r[s].since<=t&&t<=r[s].until||r[s].until<=t&&t<=r[s].since)return r[s].abbr;return""}function Ug(){var s,a,t,r,n=this.localeData().eras();for(s=0,a=n.length;s<a;++s)if(t=n[s].since<=n[s].until?1:-1,r=this.clone().startOf("day").valueOf(),n[s].since<=r&&r<=n[s].until||n[s].until<=r&&r<=n[s].since)return(this.year()-ee(n[s].since).year())*t+n[s].offset;return this.year()}function Bg(s){return He(this,"_erasNameRegex")||pl.call(this),s?this._erasNameRegex:this._erasRegex}function Wg(s){return He(this,"_erasAbbrRegex")||pl.call(this),s?this._erasAbbrRegex:this._erasRegex}function Hg(s){return He(this,"_erasNarrowRegex")||pl.call(this),s?this._erasNarrowRegex:this._erasRegex}function xl(s,a){return a.erasAbbrRegex(s)}function Kg(s,a){return a.erasNameRegex(s)}function Qg(s,a){return a.erasNarrowRegex(s)}function Zg(s,a){return a._eraYearOrdinalRegex||Vt}function pl(){var s=[],a=[],t=[],r=[],n,l,c,d,i,o=this.eras();for(n=0,l=o.length;n<l;++n)c=wa(o[n].name),d=wa(o[n].abbr),i=wa(o[n].narrow),a.push(c),s.push(d),t.push(i),r.push(c),r.push(d),r.push(i);this._erasRegex=new RegExp("^("+r.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+a.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+s.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+t.join("|")+")","i")}be(0,["gg",2],0,function(){return this.weekYear()%100});be(0,["GG",2],0,function(){return this.isoWeekYear()%100});function An(s,a){be(0,[s,s.length],0,a)}An("gggg","weekYear");An("ggggg","weekYear");An("GGGG","isoWeekYear");An("GGGGG","isoWeekYear");pe("G",Cn);pe("g",Cn);pe("GG",ns,Rs);pe("gg",ns,Rs);pe("GGGG",al,sl);pe("gggg",al,sl);pe("GGGGG",_n,Nn);pe("ggggg",_n,Nn);wr(["gggg","ggggg","GGGG","GGGGG"],function(s,a,t,r){a[r.substr(0,2)]=Ye(s)});wr(["gg","GG"],function(s,a,t,r){a[r]=ee.parseTwoDigitYear(s)});function Jg(s){return Kc.call(this,s,this.week(),this.weekday()+this.localeData()._week.dow,this.localeData()._week.dow,this.localeData()._week.doy)}function Xg(s){return Kc.call(this,s,this.isoWeek(),this.isoWeekday(),1,4)}function ef(){return _a(this.year(),1,4)}function sf(){return _a(this.isoWeekYear(),1,4)}function af(){var s=this.localeData()._week;return _a(this.year(),s.dow,s.doy)}function tf(){var s=this.localeData()._week;return _a(this.weekYear(),s.dow,s.doy)}function Kc(s,a,t,r,n){var l;return s==null?pr(this,r,n).year:(l=_a(s,r,n),a>l&&(a=l),rf.call(this,s,a,t,r,n))}function rf(s,a,t,r,n){var l=Dc(s,a,t,r,n),c=xr(l.year,0,l.dayOfYear);return this.year(c.getUTCFullYear()),this.month(c.getUTCMonth()),this.date(c.getUTCDate()),this}be("Q",0,"Qo","quarter");pe("Q",fc);es("Q",function(s,a){a[ba]=(Ye(s)-1)*3});function nf(s){return s==null?Math.ceil((this.month()+1)/3):this.month((s-1)*3+this.month()%3)}be("D",["DD",2],"Do","date");pe("D",ns,Ut);pe("DD",ns,Rs);pe("Do",function(s,a){return s?a._dayOfMonthOrdinalParse||a._ordinalParse:a._dayOfMonthOrdinalParseLenient});es(["D","DD"],ca);es("Do",function(s,a){a[ca]=Ye(s.match(ns)[0])});var Qc=Bt("Date",!0);be("DDD",["DDDD",3],"DDDo","dayOfYear");pe("DDD",wn);pe("DDDD",jc);es(["DDD","DDDD"],function(s,a,t){t._dayOfYear=Ye(s)});function lf(s){var a=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return s==null?a:this.add(s-a,"d")}be("m",["mm",2],0,"minute");pe("m",ns,tl);pe("mm",ns,Rs);es(["m","mm"],Zs);var of=Bt("Minutes",!1);be("s",["ss",2],0,"second");pe("s",ns,tl);pe("ss",ns,Rs);es(["s","ss"],Na);var cf=Bt("Seconds",!1);be("S",0,0,function(){return~~(this.millisecond()/100)});be(0,["SS",2],0,function(){return~~(this.millisecond()/10)});be(0,["SSS",3],0,"millisecond");be(0,["SSSS",4],0,function(){return this.millisecond()*10});be(0,["SSSSS",5],0,function(){return this.millisecond()*100});be(0,["SSSSSS",6],0,function(){return this.millisecond()*1e3});be(0,["SSSSSSS",7],0,function(){return this.millisecond()*1e4});be(0,["SSSSSSSS",8],0,function(){return this.millisecond()*1e5});be(0,["SSSSSSSSS",9],0,function(){return this.millisecond()*1e6});pe("S",wn,fc);pe("SS",wn,Rs);pe("SSS",wn,jc);var Fa,Zc;for(Fa="SSSS";Fa.length<=9;Fa+="S")pe(Fa,Vt);function df(s,a){a[rt]=Ye(("0."+s)*1e3)}for(Fa="S";Fa.length<=9;Fa+="S")es(Fa,df);Zc=Bt("Milliseconds",!1);be("z",0,0,"zoneAbbr");be("zz",0,0,"zoneName");function mf(){return this._isUTC?"UTC":""}function uf(){return this._isUTC?"Coordinated Universal Time":""}var le=br.prototype;le.add=tg;le.calendar=dg;le.clone=mg;le.diff=jg;le.endOf=Dg;le.format=Ng;le.from=wg;le.fromNow=_g;le.to=Cg;le.toNow=kg;le.get=bx;le.invalidAt=Rg;le.isAfter=ug;le.isBefore=hg;le.isBetween=xg;le.isSame=pg;le.isSameOrAfter=gg;le.isSameOrBefore=fg;le.isValid=Tg;le.lang=Vc;le.locale=Gc;le.localeData=Uc;le.max=Tp;le.min=zp;le.parsingFlags=Fg;le.set=Nx;le.startOf=Sg;le.subtract=rg;le.toArray=Eg;le.toObject=Og;le.toDate=Pg;le.toISOString=vg;le.inspect=bg;typeof Symbol<"u"&&Symbol.for!=null&&(le[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"});le.toJSON=zg;le.toString=yg;le.unix=Ag;le.valueOf=Mg;le.creationData=Lg;le.eraName=Yg;le.eraNarrow=Gg;le.eraAbbr=Vg;le.eraYear=Ug;le.year=bc;le.isLeapYear=vx;le.weekYear=Jg;le.isoWeekYear=Xg;le.quarter=le.quarters=nf;le.month=kc;le.daysInMonth=Px;le.week=le.weeks=Ix;le.isoWeek=le.isoWeeks=qx;le.weeksInYear=af;le.weeksInWeekYear=tf;le.isoWeeksInYear=ef;le.isoWeeksInISOWeekYear=sf;le.date=Qc;le.day=le.days=Xx;le.weekday=ep;le.isoWeekday=sp;le.dayOfYear=lf;le.hour=le.hours=op;le.minute=le.minutes=of;le.second=le.seconds=cf;le.millisecond=le.milliseconds=Zc;le.utcOffset=Vp;le.utc=Bp;le.local=Wp;le.parseZone=Hp;le.hasAlignedHourOffset=Kp;le.isDST=Qp;le.isLocal=Jp;le.isUtcOffset=Xp;le.isUtc=Ic;le.isUTC=Ic;le.zoneAbbr=mf;le.zoneName=uf;le.dates=Ys("dates accessor is deprecated. Use date instead.",Qc);le.months=Ys("months accessor is deprecated. Use month instead",kc);le.years=Ys("years accessor is deprecated. Use year instead",bc);le.zone=Ys("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",Up);le.isDSTShifted=Ys("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",Zp);function hf(s){return rs(s*1e3)}function xf(){return rs.apply(null,arguments).parseZone()}function Jc(s){return s}var Ke=Ji.prototype;Ke.calendar=Jh;Ke.longDateFormat=ax;Ke.invalidDate=rx;Ke.ordinal=lx;Ke.preparse=Jc;Ke.postformat=Jc;Ke.relativeTime=cx;Ke.pastFuture=dx;Ke.set=Qh;Ke.eras=Ig;Ke.erasParse=qg;Ke.erasConvertYear=$g;Ke.erasAbbrRegex=Wg;Ke.erasNameRegex=Bg;Ke.erasNarrowRegex=Hg;Ke.months=Sx;Ke.monthsShort=Dx;Ke.monthsParse=Ax;Ke.monthsRegex=Ox;Ke.monthsShortRegex=Ex;Ke.week=Tx;Ke.firstDayOfYear=Lx;Ke.firstDayOfWeek=Rx;Ke.weekdays=Hx;Ke.weekdaysMin=Qx;Ke.weekdaysShort=Kx;Ke.weekdaysParse=Jx;Ke.weekdaysRegex=ap;Ke.weekdaysShortRegex=tp;Ke.weekdaysMinRegex=rp;Ke.isPM=ip;Ke.meridiem=cp;function cn(s,a,t,r){var n=ka(),l=xa().set(r,a);return n[t](l,s)}function Xc(s,a,t){if(Ca(s)&&(a=s,s=void 0),s=s||"",a!=null)return cn(s,a,t,"month");var r,n=[];for(r=0;r<12;r++)n[r]=cn(s,r,t,"month");return n}function gl(s,a,t,r){typeof s=="boolean"?(Ca(a)&&(t=a,a=void 0),a=a||""):(a=s,t=a,s=!1,Ca(a)&&(t=a,a=void 0),a=a||"");var n=ka(),l=s?n._week.dow:0,c,d=[];if(t!=null)return cn(a,(t+l)%7,r,"day");for(c=0;c<7;c++)d[c]=cn(a,(c+l)%7,r,"day");return d}function pf(s,a){return Xc(s,a,"months")}function gf(s,a){return Xc(s,a,"monthsShort")}function ff(s,a,t){return gl(s,a,t,"weekdays")}function jf(s,a,t){return gl(s,a,t,"weekdaysShort")}function yf(s,a,t){return gl(s,a,t,"weekdaysMin")}qa("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(s){var a=s%10,t=Ye(s%100/10)===1?"th":a===1?"st":a===2?"nd":a===3?"rd":"th";return s+t}});ee.lang=Ys("moment.lang is deprecated. Use moment.locale instead.",qa);ee.langData=Ys("moment.langData is deprecated. Use moment.localeData instead.",ka);var fa=Math.abs;function vf(){var s=this._data;return this._milliseconds=fa(this._milliseconds),this._days=fa(this._days),this._months=fa(this._months),s.milliseconds=fa(s.milliseconds),s.seconds=fa(s.seconds),s.minutes=fa(s.minutes),s.hours=fa(s.hours),s.months=fa(s.months),s.years=fa(s.years),this}function ed(s,a,t,r){var n=sa(a,t);return s._milliseconds+=r*n._milliseconds,s._days+=r*n._days,s._months+=r*n._months,s._bubble()}function bf(s,a){return ed(this,s,a,1)}function Nf(s,a){return ed(this,s,a,-1)}function uo(s){return s<0?Math.floor(s):Math.ceil(s)}function wf(){var s=this._milliseconds,a=this._days,t=this._months,r=this._data,n,l,c,d,i;return s>=0&&a>=0&&t>=0||s<=0&&a<=0&&t<=0||(s+=uo(Oi(t)+a)*864e5,a=0,t=0),r.milliseconds=s%1e3,n=Is(s/1e3),r.seconds=n%60,l=Is(n/60),r.minutes=l%60,c=Is(l/60),r.hours=c%24,a+=Is(c/24),i=Is(sd(a)),t+=i,a-=uo(Oi(i)),d=Is(t/12),t%=12,r.days=a,r.months=t,r.years=d,this}function sd(s){return s*4800/146097}function Oi(s){return s*146097/4800}function _f(s){if(!this.isValid())return NaN;var a,t,r=this._milliseconds;if(s=Gs(s),s==="month"||s==="quarter"||s==="year")switch(a=this._days+r/864e5,t=this._months+sd(a),s){case"month":return t;case"quarter":return t/3;case"year":return t/12}else switch(a=this._days+Math.round(Oi(this._months)),s){case"week":return a/7+r/6048e5;case"day":return a+r/864e5;case"hour":return a*24+r/36e5;case"minute":return a*1440+r/6e4;case"second":return a*86400+r/1e3;case"millisecond":return Math.floor(a*864e5)+r;default:throw new Error("Unknown unit "+s)}}function Sa(s){return function(){return this.as(s)}}var ad=Sa("ms"),Cf=Sa("s"),kf=Sa("m"),Sf=Sa("h"),Df=Sa("d"),Mf=Sa("w"),Af=Sa("M"),Pf=Sa("Q"),Ef=Sa("y"),Of=ad;function zf(){return sa(this)}function Tf(s){return s=Gs(s),this.isValid()?this[s+"s"]():NaN}function yt(s){return function(){return this.isValid()?this._data[s]:NaN}}var Ff=yt("milliseconds"),Rf=yt("seconds"),Lf=yt("minutes"),If=yt("hours"),qf=yt("days"),$f=yt("months"),Yf=yt("years");function Gf(){return Is(this.days()/7)}var ya=Math.round,Dt={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function Vf(s,a,t,r,n){return n.relativeTime(a||1,!!t,s,r)}function Uf(s,a,t,r){var n=sa(s).abs(),l=ya(n.as("s")),c=ya(n.as("m")),d=ya(n.as("h")),i=ya(n.as("d")),o=ya(n.as("M")),m=ya(n.as("w")),p=ya(n.as("y")),x=l<=t.ss&&["s",l]||l<t.s&&["ss",l]||c<=1&&["m"]||c<t.m&&["mm",c]||d<=1&&["h"]||d<t.h&&["hh",d]||i<=1&&["d"]||i<t.d&&["dd",i];return t.w!=null&&(x=x||m<=1&&["w"]||m<t.w&&["ww",m]),x=x||o<=1&&["M"]||o<t.M&&["MM",o]||p<=1&&["y"]||["yy",p],x[2]=a,x[3]=+s>0,x[4]=r,Vf.apply(null,x)}function Bf(s){return s===void 0?ya:typeof s=="function"?(ya=s,!0):!1}function Wf(s,a){return Dt[s]===void 0?!1:a===void 0?Dt[s]:(Dt[s]=a,s==="s"&&(Dt.ss=a-1),!0)}function Hf(s,a){if(!this.isValid())return this.localeData().invalidDate();var t=!1,r=Dt,n,l;return typeof s=="object"&&(a=s,s=!1),typeof s=="boolean"&&(t=s),typeof a=="object"&&(r=Object.assign({},Dt,a),a.s!=null&&a.ss==null&&(r.ss=a.s-1)),n=this.localeData(),l=Uf(this,!t,r,n),t&&(l=n.pastFuture(+this,l)),n.postformat(l)}var ui=Math.abs;function Ct(s){return(s>0)-(s<0)||+s}function Pn(){if(!this.isValid())return this.localeData().invalidDate();var s=ui(this._milliseconds)/1e3,a=ui(this._days),t=ui(this._months),r,n,l,c,d=this.asSeconds(),i,o,m,p;return d?(r=Is(s/60),n=Is(r/60),s%=60,r%=60,l=Is(t/12),t%=12,c=s?s.toFixed(3).replace(/\.?0+$/,""):"",i=d<0?"-":"",o=Ct(this._months)!==Ct(d)?"-":"",m=Ct(this._days)!==Ct(d)?"-":"",p=Ct(this._milliseconds)!==Ct(d)?"-":"",i+"P"+(l?o+l+"Y":"")+(t?o+t+"M":"")+(a?m+a+"D":"")+(n||r||s?"T":"")+(n?p+n+"H":"")+(r?p+r+"M":"")+(s?p+c+"S":"")):"P0D"}var Ue=Mn.prototype;Ue.isValid=qp;Ue.abs=vf;Ue.add=bf;Ue.subtract=Nf;Ue.as=_f;Ue.asMilliseconds=ad;Ue.asSeconds=Cf;Ue.asMinutes=kf;Ue.asHours=Sf;Ue.asDays=Df;Ue.asWeeks=Mf;Ue.asMonths=Af;Ue.asQuarters=Pf;Ue.asYears=Ef;Ue.valueOf=Of;Ue._bubble=wf;Ue.clone=zf;Ue.get=Tf;Ue.milliseconds=Ff;Ue.seconds=Rf;Ue.minutes=Lf;Ue.hours=If;Ue.days=qf;Ue.weeks=Gf;Ue.months=$f;Ue.years=Yf;Ue.humanize=Hf;Ue.toISOString=Pn;Ue.toString=Pn;Ue.toJSON=Pn;Ue.locale=Gc;Ue.localeData=Uc;Ue.toIsoString=Ys("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Pn);Ue.lang=Vc;be("X",0,0,"unix");be("x",0,0,"valueOf");pe("x",Cn);pe("X",xx);es("X",function(s,a,t){t._d=new Date(parseFloat(s)*1e3)});es("x",function(s,a,t){t._d=new Date(Ye(s))});//! moment.js
ee.version="2.30.1";Hh(rs);ee.fn=le;ee.min=Fp;ee.max=Rp;ee.now=Lp;ee.utc=xa;ee.unix=hf;ee.months=pf;ee.isDate=vr;ee.locale=qa;ee.invalid=bn;ee.duration=sa;ee.isMoment=ea;ee.weekdays=ff;ee.parseZone=xf;ee.localeData=ka;ee.isDuration=Vr;ee.monthsShort=gf;ee.weekdaysMin=yf;ee.defineLocale=ol;ee.updateLocale=hp;ee.locales=xp;ee.weekdaysShort=jf;ee.normalizeUnits=Gs;ee.relativeTimeRounding=Bf;ee.relativeTimeThreshold=Wf;ee.calendarFormat=cg;ee.prototype=le;ee.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"};function Fr({icon:s,value:a,label:t,trend:r,trendValue:n,color:l="primary",className:c,delay:d=0}){const i={primary:{bg:"bg-gradient-to-br from-orange-400 to-orange-600",text:"text-orange-600",bgLight:"bg-orange-50",border:"border-orange-200",gradient:"from-orange-400/20 to-orange-600/20"},success:{bg:"bg-gradient-to-br from-green-400 to-green-600",text:"text-green-600",bgLight:"bg-green-50",border:"border-green-200",gradient:"from-green-400/20 to-green-600/20"},error:{bg:"bg-gradient-to-br from-red-400 to-red-600",text:"text-red-600",bgLight:"bg-red-50",border:"border-red-200",gradient:"from-red-400/20 to-red-600/20"},warning:{bg:"bg-gradient-to-br from-amber-400 to-amber-600",text:"text-amber-600",bgLight:"bg-amber-50",border:"border-amber-200",gradient:"from-amber-400/20 to-amber-600/20"},info:{bg:"bg-gradient-to-br from-blue-400 to-blue-600",text:"text-blue-600",bgLight:"bg-blue-50",border:"border-blue-200",gradient:"from-blue-400/20 to-blue-600/20"}},o=i[l]||i.primary;return e.jsxs(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:d,duration:.3},className:Ze("group relative overflow-hidden rounded-2xl","bg-gradient-to-br dark:from-slate-800 dark:to-slate-900 from-white to-gray-50","p-6 shadow-md border","dark:border-slate-700 border-gray-200","hover:shadow-xl hover:-translate-y-1","transition-all duration-300",c),children:[e.jsx("div",{className:Ze("absolute top-0 right-0 w-32 h-32 rounded-full -mr-16 -mt-16 blur-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500",`bg-gradient-to-br ${o.gradient}`)}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(Qe.div,{whileHover:{scale:1.1},whileTap:{scale:.95},className:Ze("w-14 h-14 rounded-xl flex items-center justify-center shadow-lg",o.bg),children:s&&e.jsx(s,{className:"w-7 h-7 text-white"})}),r&&n&&e.jsxs("div",{className:Ze("flex items-center gap-1 px-2 py-1 rounded-lg text-xs font-semibold",r==="up"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:[r==="up"?"":""," ",n]})]}),e.jsxs("div",{children:[e.jsx(Qe.p,{initial:{scale:.8},animate:{scale:1},transition:{delay:d+.1,duration:.3},className:"text-4xl font-bold dark:text-slate-100 text-gray-900 mb-1",children:a}),e.jsx("p",{className:"text-sm font-semibold dark:text-slate-400 text-gray-600 uppercase tracking-wide",children:t})]})]})]})}function Kf({orders:s=[],dishes:a=[],pdvSales:t=[]}){const r=b.useMemo(()=>{const c=ee().startOf("day"),d=ee().startOf("day").subtract(1,"day"),i=ee().startOf("week"),o=ee().startOf("week").subtract(1,"week"),m=ee().startOf("month"),p=ee().startOf("month").subtract(1,"month"),x=W=>W.status!=="cancelled",g=W=>W.status==="delivered",f=(s||[]).filter(W=>ee(W.created_date).isSame(c,"day")&&x(W)),y=f.filter(g).reduce((W,C)=>W+(C.total||0),0),v=(s||[]).filter(W=>ee(W.created_date).isSame(d,"day")&&x(W)),P=v.filter(g).reduce((W,C)=>W+(C.total||0),0),M=(s||[]).filter(W=>ee(W.created_date).isSameOrAfter(i)&&x(W)),O=M.filter(g).reduce((W,C)=>W+(C.total||0),0),u=(s||[]).filter(W=>{const C=ee(W.created_date);return C.isSameOrAfter(o)&&C.isBefore(i)&&x(W)}).filter(g).reduce((W,C)=>W+(C.total||0),0),_=(s||[]).filter(W=>ee(W.created_date).isSameOrAfter(m)&&x(W)),$=_.filter(g).reduce((W,C)=>W+(C.total||0),0),D=(s||[]).filter(W=>{const C=ee(W.created_date);return C.isSameOrAfter(p)&&C.isBefore(m)&&x(W)}).filter(g).reduce((W,C)=>W+(C.total||0),0),V=f.length>0?y/f.length:0,T=v.length>0?P/v.length:0,N=(W,C)=>C===0?W>0?100:0:(W-C)/C*100,z=N(y,P),k=N(f.length,v.length),h=N(O,u),F=N($,D),S=N(V,T),q={};(s||[]).filter(x).forEach(W=>{W.items&&W.items.forEach(C=>{const Y=C.dish_id||C.dish?.id;Y&&(q[Y]=(q[Y]||0)+(C.quantity||1))})});const J=Object.entries(q).sort(([,W],[,C])=>C-W).slice(0,3).map(([W,C])=>({dish:a.find(L=>L.id===W),count:C})).filter(W=>W.dish);return{today:{orders:f.length,revenue:y,avgTicket:V,growth:{revenue:z,orders:k,avgTicket:S}},week:{orders:M.length,revenue:O,growth:h},month:{orders:_.length,revenue:$,growth:F},topProducts:J}},[s,a,t]),n=c=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(c||0),l=({value:c})=>{if(c===0)return null;const d=c>0,i=d?qu:Lu,o=d?"text-green-600 dark:text-green-300":"text-red-600 dark:text-red-300",m=d?"bg-green-50 dark:bg-green-950/50":"bg-red-50 dark:bg-red-950/50";return e.jsxs("div",{className:`flex items-center gap-1 text-xs ${o} ${m} px-2 py-1 rounded-full`,children:[e.jsx(i,{className:"w-3 h-3"}),e.jsxs("span",{className:"font-semibold",children:[Math.abs(c).toFixed(1),"%"]})]})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs(Q,{className:"bg-card border-border border-l-4 border-l-blue-500",children:[e.jsx(he,{className:"py-2 px-4 pb-0",children:e.jsxs(xe,{className:"text-xs font-medium text-muted-foreground flex items-center justify-between",children:["Faturamento Hoje",e.jsx(l,{value:r.today.growth.revenue})]})}),e.jsxs(Z,{className:"pt-2 px-4 pb-3",children:[e.jsx("div",{className:"text-xl font-bold text-foreground",children:n(r.today.revenue)}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-0.5",children:[r.today.orders," pedido(s)"]})]})]}),e.jsxs(Q,{className:"bg-card border-border border-l-4 border-l-green-500",children:[e.jsx(he,{className:"py-2 px-4 pb-0",children:e.jsxs(xe,{className:"text-xs font-medium text-muted-foreground flex items-center justify-between",children:["Ticket Mdio",e.jsx(l,{value:r.today.growth.avgTicket})]})}),e.jsxs(Z,{className:"pt-2 px-4 pb-3",children:[e.jsx("div",{className:"text-xl font-bold text-foreground",children:n(r.today.avgTicket)}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:"Por pedido hoje"})]})]}),e.jsxs(Q,{className:"bg-card border-border border-l-4 border-l-violet-500",children:[e.jsx(he,{className:"py-2 px-4 pb-0",children:e.jsxs(xe,{className:"text-xs font-medium text-muted-foreground flex items-center justify-between",children:["Pedidos Hoje",e.jsx(l,{value:r.today.growth.orders})]})}),e.jsxs(Z,{className:"pt-2 px-4 pb-3",children:[e.jsx("div",{className:"text-xl font-bold text-foreground",children:r.today.orders}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:"Recebidos hoje"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs(Q,{className:"bg-card border-border",children:[e.jsx(he,{className:"py-2 px-4 pb-0",children:e.jsxs(xe,{className:"text-xs font-medium text-muted-foreground flex items-center justify-between",children:[e.jsx("span",{children:"Faturamento da Semana"}),e.jsx(l,{value:r.week.growth})]})}),e.jsxs(Z,{className:"pt-2 px-4 pb-3",children:[e.jsx("div",{className:"text-lg font-bold text-foreground",children:n(r.week.revenue)}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-0.5",children:[r.week.orders," pedidos nesta semana"]})]})]}),e.jsxs(Q,{className:"bg-card border-border",children:[e.jsx(he,{className:"py-2 px-4 pb-0",children:e.jsxs(xe,{className:"text-xs font-medium text-muted-foreground flex items-center justify-between",children:[e.jsx("span",{children:"Faturamento do Ms"}),e.jsx(l,{value:r.month.growth})]})}),e.jsxs(Z,{className:"pt-2 px-4 pb-3",children:[e.jsx("div",{className:"text-lg font-bold text-foreground",children:n(r.month.revenue)}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-0.5",children:[r.month.orders," pedidos neste ms"]})]})]})]}),r.topProducts.length>0&&e.jsxs(Q,{className:"bg-card border-border",children:[e.jsx(he,{className:"py-2 px-4",children:e.jsxs(xe,{className:"text-sm font-semibold text-foreground flex items-center gap-1.5",children:[e.jsx(Fs,{className:"w-4 h-4 text-primary"}),"Produtos Mais Vendidos"]})}),e.jsx(Z,{className:"pt-0 px-4 pb-3",children:e.jsx("div",{className:"space-y-2",children:r.topProducts.map((c,d)=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary/20 text-primary flex items-center justify-center font-bold text-xs",children:d+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-xs text-foreground",children:c.dish?.name||"Produto"}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:[c.count," venda(s)"]})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["#",c.count]})]},c.dish?.id||d))})})]})]})}const Qf={light:"",dark:".dark"},td=b.createContext(null);function rd(){const s=b.useContext(td);if(!s)throw new Error("useChart must be used within a <ChartContainer />");return s}const nt=b.forwardRef(({id:s,className:a,children:t,config:r,...n},l)=>{const c=b.useId(),d=`chart-${s||c.replace(/:/g,"")}`;return e.jsx(td.Provider,{value:{config:r},children:e.jsxs("div",{"data-chart":d,ref:l,className:Ze("flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",a),...n,children:[e.jsx(Zf,{id:d,config:r}),e.jsx(Qm,{children:t})]})})});nt.displayName="Chart";const Zf=({id:s,config:a})=>{const t=Object.entries(a).filter(([,r])=>r.theme||r.color);return t.length?e.jsx("style",{dangerouslySetInnerHTML:{__html:Object.entries(Qf).map(([r,n])=>`
${n} [data-chart=${s}] {
${t.map(([l,c])=>{const d=c.theme?.[r]||c.color;return d?`  --color-${l}: ${d};`:null}).join(`
`)}
}
`).join(`
`)}}):null},Mt=Km,it=b.forwardRef(({active:s,payload:a,className:t,indicator:r="dot",hideLabel:n=!1,hideIndicator:l=!1,label:c,labelFormatter:d,labelClassName:i,formatter:o,color:m,nameKey:p,labelKey:x},g)=>{const{config:f}=rd(),y=b.useMemo(()=>{if(n||!a?.length)return null;const[P]=a,M=`${x||P.dataKey||P.name||"value"}`,O=zi(f,P,M),E=!x&&typeof c=="string"?f[c]?.label||c:O?.label;return d?e.jsx("div",{className:Ze("font-medium",i),children:d(E,a)}):E?e.jsx("div",{className:Ze("font-medium",i),children:E}):null},[c,d,a,n,i,f,x]);if(!s||!a?.length)return null;const v=a.length===1&&r!=="dot";return e.jsxs("div",{ref:g,className:Ze("grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",t),children:[v?null:y,e.jsx("div",{className:"grid gap-1.5",children:a.map((P,M)=>{const O=`${p||P.name||P.dataKey||"value"}`,E=zi(f,P,O),u=m||P.payload.fill||P.color;return e.jsx("div",{className:Ze("flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground",r==="dot"&&"items-center"),children:o&&P?.value!==void 0&&P.name?o(P.value,P.name,P,M,P.payload):e.jsxs(e.Fragment,{children:[E?.icon?e.jsx(E.icon,{}):!l&&e.jsx("div",{className:Ze("shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",{"h-2.5 w-2.5":r==="dot","w-1":r==="line","w-0 border-[1.5px] border-dashed bg-transparent":r==="dashed","my-0.5":v&&r==="dashed"}),style:{"--color-bg":u,"--color-border":u}}),e.jsxs("div",{className:Ze("flex flex-1 justify-between leading-none",v?"items-end":"items-center"),children:[e.jsxs("div",{className:"grid gap-1.5",children:[v?y:null,e.jsx("span",{className:"text-muted-foreground",children:E?.label||P.name})]}),P.value&&e.jsx("span",{className:"font-mono font-medium tabular-nums text-foreground",children:P.value.toLocaleString()})]})]})},P.dataKey)})})]})});it.displayName="ChartTooltip";const Jf=b.forwardRef(({className:s,hideIcon:a=!1,payload:t,verticalAlign:r="bottom",nameKey:n},l)=>{const{config:c}=rd();return t?.length?e.jsx("div",{ref:l,className:Ze("flex items-center justify-center gap-4",r==="top"?"pb-3":"pt-3",s),children:t.map(d=>{const i=`${n||d.dataKey||"value"}`,o=zi(c,d,i);return e.jsxs("div",{className:Ze("flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"),children:[o?.icon&&!a?e.jsx(o.icon,{}):e.jsx("div",{className:"h-2 w-2 shrink-0 rounded-[2px]",style:{backgroundColor:d.color}}),o?.label]},d.value)})}):null});Jf.displayName="ChartLegend";function zi(s,a,t){if(typeof a!="object"||a===null)return;const r="payload"in a&&typeof a.payload=="object"&&a.payload!==null?a.payload:void 0;let n=t;return t in a&&typeof a[t]=="string"?n=a[t]:r&&t in r&&typeof r[t]=="string"&&(n=r[t]),n in s?s[n]:s[t]}const ho=[{value:"7",label:"7 dias"},{value:"30",label:"30 dias"},{value:"12m",label:"12 meses"}];function Xf(s,a=5){return(Array.isArray(s)?s:[]).filter(n=>n!=null&&!Number.isNaN(n)&&Number(n)!==0).length>=a}function e0(s,a=.8){const t=Array.isArray(s)?s:[];return t.length===0?!0:t.filter(n=>n==null||Number(n)===0).length/t.length>=a}function s0(s,a=.001){const r=(Array.isArray(s)?s:[]).map(i=>Number(i)).filter(i=>!Number.isNaN(i));if(r.length<2)return!0;const n=Math.min(...r),l=Math.max(...r),c=l-n,d=Math.max(Math.abs(l),Math.abs(n),1);return c/d<a}function xo(s,a=5){return!s||s.length<a?!1:Xf(s,a)&&!e0(s,.8)&&!s0(s,.001)}function a0({orders:s=[],pdvSales:a=[]}){const[t,r]=b.useState("7"),{isDark:n}=hn(),l=b.useMemo(()=>{const E=t==="12m",u=E?12:t==="7"?7:30,_=Array.from({length:u},(D,V)=>{if(E){const N=ee().subtract(11-V,"months");return{date:N.format("MMM/YY"),fullDate:N.toDate(),revenue:0,orders:0}}const T=ee().subtract(u-1-V,"days");return{date:T.format("DD/MM"),fullDate:T.toDate(),revenue:0,orders:0}}),$=(D,V)=>E?D.isSame(V.fullDate,"month"):D.isSame(V.fullDate,"day");return(s||[]).filter(D=>D.status!=="cancelled").forEach(D=>{const V=ee(D.created_date),T=_.findIndex(N=>$(V,N));T!==-1&&(D.status==="delivered"&&(_[T].revenue+=D.total||0),_[T].orders+=1)}),_},[s,a,t]),c=b.useMemo(()=>(l||[]).map(E=>E.revenue),[l]),d=b.useMemo(()=>(l||[]).map(E=>E.orders),[l]),i=xo(c,5),o=xo(d,5),m=b.useMemo(()=>c.reduce((E,u)=>E+(Number(u)||0),0),[c]),p=b.useMemo(()=>d.reduce((E,u)=>E+(Number(u)||0),0),[d]),x=b.useMemo(()=>{const E=l.length;if(E<2)return 0;const u=Math.floor(E/2);return l.slice(0,u).reduce((_,$)=>_+(Number($.revenue)||0),0)},[l]),g=b.useMemo(()=>{const E=(s||[]).filter(u=>u.status!=="cancelled");return E.length===0?null:E.sort((u,_)=>new Date(_.created_date)-new Date(u.created_date))[0]},[s]),f={revenue:{label:"Faturamento",color:"hsl(var(--chart-1))"},orders:{label:"Pedidos",color:"hsl(var(--chart-2))"}},y=E=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0,maximumFractionDigits:0}).format(E||0),v=n?"#475569":"#e5e7eb",P=n?"#94a3b8":"#6b7280",M=ho.find(E=>E.value===t)?.label||"7 dias",O=x>0?((m-x)/x*100).toFixed(1):m>0?"100":"0";return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3",children:[e.jsxs(Q,{className:"overflow-hidden bg-card border-border",children:[e.jsxs(he,{className:"flex flex-row items-center justify-between space-y-0 py-2 px-3 pb-1",children:[e.jsxs(xe,{className:"text-sm font-semibold flex items-center gap-1.5 text-foreground",children:[e.jsx($a,{className:"w-4 h-4 text-green-500"}),"Faturamento"]}),e.jsxs(Se,{value:t,onValueChange:r,children:[e.jsx(De,{className:"w-[90px] h-6 text-xs",children:e.jsx(Me,{})}),e.jsx(Ae,{children:ho.map(E=>e.jsx(X,{value:E.value,children:E.label},E.value))})]})]}),e.jsx(Z,{className:"pt-0 px-3 pb-3",children:i?e.jsx(nt,{config:f,className:"h-[120px]",children:e.jsxs(Bh,{data:l,margin:{top:8,right:8,left:0,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorRevenue",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#22c55e",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#22c55e",stopOpacity:0})]})}),e.jsx(at,{strokeDasharray:"3 3",stroke:v}),e.jsx(Ea,{dataKey:"date",stroke:P,fontSize:11,tickLine:!1,axisLine:!1}),e.jsx(Oa,{stroke:P,fontSize:11,tickLine:!1,axisLine:!1,tickFormatter:E=>E>=1e3?`R$ ${(E/1e3).toFixed(1)}k`:`R$ ${E}`}),e.jsx(Mt,{content:e.jsx(it,{formatter:E=>y(E)})}),e.jsx(Ga,{type:"monotone",dataKey:"revenue",stroke:"#22c55e",fillOpacity:1,fill:"url(#colorRevenue)",strokeWidth:2})]})}):e.jsxs("div",{className:"py-2",children:[e.jsx("p",{className:"text-lg font-bold text-foreground",children:y(m)}),e.jsxs("p",{className:"text-xs mt-0.5 text-muted-foreground",children:[M,x>0&&e.jsxs("span",{className:Number(O)>=0?" text-green-500":" text-destructive",children:[" "," ",Number(O)>=0?"+":"",O,"% vs anterior"]})]})]})})]}),e.jsxs(Q,{className:"overflow-hidden bg-card border-border",children:[e.jsxs(he,{className:"flex flex-row items-center justify-between space-y-0 py-2 px-3 pb-1",children:[e.jsxs(xe,{className:"text-sm font-semibold flex items-center gap-1.5 text-foreground",children:[e.jsx($s,{className:"w-4 h-4 text-primary"}),"Pedidos"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:M})]}),e.jsx(Z,{className:"pt-0 px-3 pb-3",children:o?e.jsx(nt,{config:f,className:"h-[120px]",children:e.jsxs(mc,{data:l,margin:{top:8,right:8,left:0,bottom:0},children:[e.jsx(at,{strokeDasharray:"3 3",stroke:v}),e.jsx(Ea,{dataKey:"date",stroke:P,fontSize:11,tickLine:!1,axisLine:!1}),e.jsx(Oa,{stroke:P,fontSize:11,tickLine:!1,axisLine:!1}),e.jsx(Mt,{content:e.jsx(it,{})}),e.jsx(Gt,{type:"monotone",dataKey:"orders",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:3},activeDot:{r:5}})]})}):e.jsxs("div",{className:"py-2",children:[e.jsx("p",{className:"text-lg font-bold text-foreground",children:p}),e.jsx("p",{className:"text-xs mt-0.5 text-muted-foreground",children:g?`ltimo s ${ee(g.created_date).format("HH:mm")}`:"Sem dados no perodo"})]})})]})]})}var En="Collapsible",[t0,nd]=Zo(En),[r0,fl]=t0(En),id=b.forwardRef((s,a)=>{const{__scopeCollapsible:t,open:r,defaultOpen:n,disabled:l,onOpenChange:c,...d}=s,[i,o]=Wi({prop:r,defaultProp:n??!1,onChange:c,caller:En});return e.jsx(r0,{scope:t,disabled:l,contentId:Jo(),open:i,onOpenToggle:b.useCallback(()=>o(m=>!m),[o]),children:e.jsx(yr.div,{"data-state":yl(i),"data-disabled":l?"":void 0,...d,ref:a})})});id.displayName=En;var ld="CollapsibleTrigger",od=b.forwardRef((s,a)=>{const{__scopeCollapsible:t,...r}=s,n=fl(ld,t);return e.jsx(yr.button,{type:"button","aria-controls":n.contentId,"aria-expanded":n.open||!1,"data-state":yl(n.open),"data-disabled":n.disabled?"":void 0,disabled:n.disabled,...r,ref:a,onClick:Xo(s.onClick,n.onOpenToggle)})});od.displayName=ld;var jl="CollapsibleContent",cd=b.forwardRef((s,a)=>{const{forceMount:t,...r}=s,n=fl(jl,s.__scopeCollapsible);return e.jsx(xu,{present:t||n.open,children:({present:l})=>e.jsx(n0,{...r,ref:a,present:l})})});cd.displayName=jl;var n0=b.forwardRef((s,a)=>{const{__scopeCollapsible:t,present:r,children:n,...l}=s,c=fl(jl,t),[d,i]=b.useState(r),o=b.useRef(null),m=So(a,o),p=b.useRef(0),x=p.current,g=b.useRef(0),f=g.current,y=c.open||d,v=b.useRef(y),P=b.useRef(void 0);return b.useEffect(()=>{const M=requestAnimationFrame(()=>v.current=!1);return()=>cancelAnimationFrame(M)},[]),Jr(()=>{const M=o.current;if(M){P.current=P.current||{transitionDuration:M.style.transitionDuration,animationName:M.style.animationName},M.style.transitionDuration="0s",M.style.animationName="none";const O=M.getBoundingClientRect();p.current=O.height,g.current=O.width,v.current||(M.style.transitionDuration=P.current.transitionDuration,M.style.animationName=P.current.animationName),i(r)}},[c.open,r]),e.jsx(yr.div,{"data-state":yl(c.open),"data-disabled":c.disabled?"":void 0,id:c.contentId,hidden:!y,...l,ref:m,style:{"--radix-collapsible-content-height":x?`${x}px`:void 0,"--radix-collapsible-content-width":f?`${f}px`:void 0,...s.style},children:y&&n})});function yl(s){return s?"open":"closed"}var i0=id,l0=od,o0=cd,aa="Accordion",c0=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[vl,d0,m0]=gu(aa),[On]=Zo(aa,[m0,nd]),bl=nd(),dd=ae.forwardRef((s,a)=>{const{type:t,...r}=s,n=r,l=r;return e.jsx(vl.Provider,{scope:s.__scopeAccordion,children:t==="multiple"?e.jsx(p0,{...l,ref:a}):e.jsx(x0,{...n,ref:a})})});dd.displayName=aa;var[md,u0]=On(aa),[ud,h0]=On(aa,{collapsible:!1}),x0=ae.forwardRef((s,a)=>{const{value:t,defaultValue:r,onValueChange:n=()=>{},collapsible:l=!1,...c}=s,[d,i]=Wi({prop:t,defaultProp:r??"",onChange:n,caller:aa});return e.jsx(md,{scope:s.__scopeAccordion,value:ae.useMemo(()=>d?[d]:[],[d]),onItemOpen:i,onItemClose:ae.useCallback(()=>l&&i(""),[l,i]),children:e.jsx(ud,{scope:s.__scopeAccordion,collapsible:l,children:e.jsx(hd,{...c,ref:a})})})}),p0=ae.forwardRef((s,a)=>{const{value:t,defaultValue:r,onValueChange:n=()=>{},...l}=s,[c,d]=Wi({prop:t,defaultProp:r??[],onChange:n,caller:aa}),i=ae.useCallback(m=>d((p=[])=>[...p,m]),[d]),o=ae.useCallback(m=>d((p=[])=>p.filter(x=>x!==m)),[d]);return e.jsx(md,{scope:s.__scopeAccordion,value:c,onItemOpen:i,onItemClose:o,children:e.jsx(ud,{scope:s.__scopeAccordion,collapsible:!0,children:e.jsx(hd,{...l,ref:a})})})}),[g0,zn]=On(aa),hd=ae.forwardRef((s,a)=>{const{__scopeAccordion:t,disabled:r,dir:n,orientation:l="vertical",...c}=s,d=ae.useRef(null),i=So(d,a),o=d0(t),p=fu(n)==="ltr",x=Xo(s.onKeyDown,g=>{if(!c0.includes(g.key))return;const f=g.target,y=o().filter(j=>!j.ref.current?.disabled),v=y.findIndex(j=>j.ref.current===f),P=y.length;if(v===-1)return;g.preventDefault();let M=v;const O=0,E=P-1,u=()=>{M=v+1,M>E&&(M=O)},_=()=>{M=v-1,M<O&&(M=E)};switch(g.key){case"Home":M=O;break;case"End":M=E;break;case"ArrowRight":l==="horizontal"&&(p?u():_());break;case"ArrowDown":l==="vertical"&&u();break;case"ArrowLeft":l==="horizontal"&&(p?_():u());break;case"ArrowUp":l==="vertical"&&_();break}const $=M%P;y[$].ref.current?.focus()});return e.jsx(g0,{scope:t,disabled:r,direction:n,orientation:l,children:e.jsx(vl.Slot,{scope:t,children:e.jsx(yr.div,{...c,"data-orientation":l,ref:i,onKeyDown:r?void 0:x})})})}),dn="AccordionItem",[f0,Nl]=On(dn),xd=ae.forwardRef((s,a)=>{const{__scopeAccordion:t,value:r,...n}=s,l=zn(dn,t),c=u0(dn,t),d=bl(t),i=Jo(),o=r&&c.value.includes(r)||!1,m=l.disabled||s.disabled;return e.jsx(f0,{scope:t,open:o,disabled:m,triggerId:i,children:e.jsx(i0,{"data-orientation":l.orientation,"data-state":vd(o),...d,...n,ref:a,disabled:m,open:o,onOpenChange:p=>{p?c.onItemOpen(r):c.onItemClose(r)}})})});xd.displayName=dn;var pd="AccordionHeader",gd=ae.forwardRef((s,a)=>{const{__scopeAccordion:t,...r}=s,n=zn(aa,t),l=Nl(pd,t);return e.jsx(yr.h3,{"data-orientation":n.orientation,"data-state":vd(l.open),"data-disabled":l.disabled?"":void 0,...r,ref:a})});gd.displayName=pd;var Ti="AccordionTrigger",fd=ae.forwardRef((s,a)=>{const{__scopeAccordion:t,...r}=s,n=zn(aa,t),l=Nl(Ti,t),c=h0(Ti,t),d=bl(t);return e.jsx(vl.ItemSlot,{scope:t,children:e.jsx(l0,{"aria-disabled":l.open&&!c.collapsible||void 0,"data-orientation":n.orientation,id:l.triggerId,...d,...r,ref:a})})});fd.displayName=Ti;var jd="AccordionContent",yd=ae.forwardRef((s,a)=>{const{__scopeAccordion:t,...r}=s,n=zn(aa,t),l=Nl(jd,t),c=bl(t);return e.jsx(o0,{role:"region","aria-labelledby":l.triggerId,"data-orientation":n.orientation,...c,...r,ref:a,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...s.style}})});yd.displayName=jd;function vd(s){return s?"open":"closed"}var j0=dd,y0=xd,v0=gd,bd=fd,Nd=yd;const wd=j0,Ka=b.forwardRef(({className:s,...a},t)=>e.jsx(y0,{ref:t,className:Ze("border-b",s),...a}));Ka.displayName="AccordionItem";const Qa=b.forwardRef(({className:s,children:a,...t},r)=>e.jsx(v0,{className:"flex",children:e.jsxs(bd,{ref:r,className:Ze("flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline text-left [&[data-state=open]>svg]:rotate-180",s),...t,children:[a,e.jsx(La,{className:"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200"})]})}));Qa.displayName=bd.displayName;const Za=b.forwardRef(({className:s,children:a,...t},r)=>e.jsx(Nd,{ref:r,className:"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...t,children:e.jsx("div",{className:Ze("pb-4 pt-0",s),children:a})}));Za.displayName=Nd.displayName;const po=["#22c55e","#3b82f6","#f59e0b","#ef4444","#8b5cf6","#ec4899","#06b6d4"];function b0({orders:s=[],dishes:a=[],categories:t=[]}){const[r,n]=b.useState("7"),[l,c]=b.useState(()=>{const h=localStorage.getItem("dashboard_revenue_target");return h?parseFloat(h):0}),{isDark:d}=hn();b.useEffect(()=>{l>0&&localStorage.setItem("dashboard_revenue_target",l.toString())},[l]);const i=b.useMemo(()=>{const h=Array.from({length:24},(S,q)=>({hour:q,orders:0,revenue:0}));return(s||[]).filter(S=>S.status!=="cancelled").forEach(S=>{const q=ee(S.created_date).hour();h[q].orders+=1,S.status==="delivered"&&(h[q].revenue+=S.total||0)}),h.map(S=>({...S,label:`${S.hour.toString().padStart(2,"0")}:00`}))},[s]),o=b.useMemo(()=>{const h={};return(s||[]).filter(S=>S.status==="delivered").forEach(S=>{const q=S.payment_method||"No informado";h[q]||(h[q]={name:q,count:0,revenue:0}),h[q].count+=1,h[q].revenue+=S.total||0}),Object.values(h).sort((S,q)=>q.revenue-S.revenue)},[s]),m=b.useMemo(()=>{const h={};return(s||[]).filter(S=>S.status!=="cancelled").forEach(S=>{S.items&&S.items.forEach(q=>{const J=a.find(W=>W.id===(q.dish_id||q.dish?.id));if(J&&J.category_id){const C=t.find(L=>L.id===J.category_id)?.name||"Sem categoria";h[C]||(h[C]={name:C,count:0,revenue:0});const Y=q.quantity||1;h[C].count+=Y,S.status==="delivered"&&(h[C].revenue+=(q.unit_price||J.price||0)*Y)}})}),Object.values(h).sort((S,q)=>q.revenue-S.revenue).slice(0,5)},[s,a,t]),p=b.useMemo(()=>{const F=["Dom","Seg","Ter","Qua","Qui","Sex","Sb"].map((q,J)=>({day:q,orders:0,revenue:0}));return(s||[]).filter(q=>q.status!=="cancelled").forEach(q=>{const J=ee(q.created_date).day();F[J].orders+=1,q.status==="delivered"&&(F[J].revenue+=q.total||0)}),F},[s]),x=b.useMemo(()=>{const h=s.length,F=s.filter(S=>S.status==="cancelled").length;return h>0?(F/h*100).toFixed(1):0},[s]),g=b.useMemo(()=>{const h=s.filter(S=>S.status==="delivered"&&S.created_date&&S.delivered_date);if(h.length===0)return null;const F=h.reduce((S,q)=>{const J=ee(q.created_date),W=ee(q.delivered_date);return S+W.diff(J,"minutes")},0);return Math.round(F/h.length)},[s]),f=b.useMemo(()=>{const h={};(s||[]).filter(J=>J.status!=="cancelled").forEach(J=>{const W=J.customer_phone||J.customer_name||"unknown";h[W]||(h[W]=0),h[W]+=1});const S=Object.values(h).filter(J=>J>1).length,q=Object.keys(h).length;return{count:S,percentage:q>0?(S/q*100).toFixed(1):0,total:q}},[s]),y=b.useMemo(()=>{const h=ee().startOf("month"),S=(s||[]).filter(J=>ee(J.created_date).isSameOrAfter(h)&&J.status==="delivered").reduce((J,W)=>J+(W.total||0),0),q=l>0?S/l*100:0;return{target:l,actual:S,progress:Math.min(q,100),remaining:Math.max(0,l-S)}},[s,l]),v=b.useMemo(()=>{let h=0,F=0;try{for(let J=0;J<localStorage.length;J++){const W=localStorage.key(J);if(W&&W.startsWith("cardapio_cart_")){const C=localStorage.getItem(W);if(C)try{const Y=JSON.parse(C);Y&&Y.length>0&&h++}catch{}}}}catch(J){console.warn("Erro ao calcular carrinhos abandonados:",J)}F=(s||[]).filter(J=>J.status==="delivered").length;const S=h+F,q=S>0?(h/S*100).toFixed(1):0;return{abandoned:h,completed:F,rate:parseFloat(q),total:S}},[s]),P=b.useMemo(()=>{const F={},S=(s||[]).filter(C=>C.status==="delivered");for(let C=0;C<7;C++){const Y=ee().subtract(C,"days").startOf("day"),oe=S.filter(Pe=>ee(Pe.created_date).isSame(Y,"day")).reduce((Pe,ve)=>Pe+(ve.total||0),0);F[Y.format("YYYY-MM-DD")]=oe}const q=Object.values(F),J=q.length>0?q.reduce((C,Y)=>C+Y,0)/q.length:0,W=[];for(let C=1;C<=7;C++){const Y=ee().add(C,"days");W.push({date:Y.format("DD/MM"),predicted:J*(1+C*.02),confidence:Math.max(60,100-C*5)})}return{avgDailyRevenue:J,forecast:W,trend:q.length>=2?q[0]>q[q.length-1]?"up":"down":"stable"}},[s]),M=b.useMemo(()=>{const h=(s||[]).filter(q=>q.status!=="cancelled"),F=h.filter(q=>q.status==="delivered"),S=h.filter(q=>q.delivery_type==="delivery"||q.delivery_type==="entrega");return{total:h.length,delivered:F.length,delivery:S.length,rate:h.length>0?(F.length/h.length*100).toFixed(1):0,deliveryPercentage:h.length>0?(S.length/h.length*100).toFixed(1):0}},[s]),O=h=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0,maximumFractionDigits:0}).format(h||0),E=d?"#475569":"#e5e7eb",u=d?"#94a3b8":"#6b7280",$=(s||[]).filter(h=>h.status==="delivered").length>=10,j=o.length===1,D=o.reduce((h,F)=>h+F.revenue,0),V=b.useMemo(()=>i.filter(h=>h.orders>0).sort((h,F)=>F.orders-h.orders).slice(0,3),[i]),N=p.filter(h=>h.orders>0).length>=3,z=m.reduce((h,F)=>h+F.revenue,0),k=m.length>=3&&z>0;return e.jsxs("div",{className:"space-y-4",children:[l>0&&e.jsxs(Q,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(he,{className:"py-2 px-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(xe,{className:"text-sm font-semibold flex items-center gap-1.5",style:{color:"var(--text-primary)"},children:[e.jsx(eu,{className:"w-4 h-4 text-blue-500"}),"Meta de Faturamento do Ms"]}),e.jsx(B,{type:"number",value:l,onChange:h=>c(parseFloat(h.target.value)||0),className:"w-32",placeholder:"Meta (R$)"})]})}),e.jsx(Z,{className:"pt-0 px-4 pb-3",children:e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",style:{color:"var(--text-secondary)"},children:[e.jsxs("span",{children:["Realizado: ",O(y.actual)]}),e.jsxs("span",{children:["Meta: ",O(y.target)]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${y.progress>=100?"bg-green-500":y.progress>=75?"bg-blue-500":"bg-orange-500"}`,style:{width:`${Math.min(y.progress,100)}%`}})}),e.jsxs("div",{className:"text-xs mt-1",style:{color:"var(--text-secondary)"},children:[y.progress.toFixed(1),"% da meta",y.remaining>0&&e.jsxs("span",{className:"ml-2",children:[" Faltam ",O(y.remaining)]})]})]})})})]}),e.jsxs(Q,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(he,{className:"py-1.5 px-3 pb-0",children:e.jsx(xe,{className:"text-xs font-medium",style:{color:"var(--text-primary)"},children:"Indicadores"})}),e.jsx(Z,{className:"py-1.5 px-3 pb-2",children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-x-4 gap-y-1.5 text-xs",children:[e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx("span",{style:{color:"var(--text-secondary)"},children:"Cancelamento"}),e.jsx("span",{style:{color:"var(--text-primary)"},children:s.length?`${x}%`:""})]}),e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx("span",{style:{color:"var(--text-secondary)"},children:"Tempo mdio"}),e.jsx("span",{style:{color:"var(--text-primary)"},children:g!=null?`${g} min`:""})]}),e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx("span",{style:{color:"var(--text-secondary)"},children:"Recorrentes"}),e.jsx("span",{style:{color:"var(--text-primary)"},children:f.total?`${f.percentage}%`:""})]}),e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx("span",{style:{color:"var(--text-secondary)"},children:"Abandono"}),e.jsx("span",{style:{color:"var(--text-primary)"},children:v.total?`${v.rate}%`:""})]}),e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx("span",{style:{color:"var(--text-secondary)"},children:"Taxa entrega"}),e.jsx("span",{style:{color:"var(--text-primary)"},children:M.total?`${M.rate}%`:""})]}),e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx("span",{style:{color:"var(--text-secondary)"},children:"Mtodo mais usado"}),e.jsx("span",{className:"truncate max-w-[80px]",style:{color:"var(--text-primary)"},title:o[0]?.name,children:o[0]?.name||""})]})]})})]}),o.length>0&&e.jsxs(Q,{className:"overflow-hidden",style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(he,{className:"py-2 px-3 pb-0",children:e.jsxs(xe,{className:"text-sm font-semibold flex items-center gap-1.5",style:{color:"var(--text-primary)"},children:[e.jsx($t,{className:"w-4 h-4 text-green-500"}),"Mtodos de Pagamento"]})}),e.jsx(Z,{className:"pt-1 px-3 pb-3",children:j?e.jsxs("p",{className:"text-base font-bold",style:{color:"var(--text-primary)"},children:["100% ",o[0].name]}):e.jsx("ul",{className:"space-y-1 text-sm",children:o.slice(0,3).map((h,F)=>{const S=D>0?(h.revenue/D*100).toFixed(0):0;return e.jsxs("li",{className:"flex justify-between items-center",children:[e.jsx("span",{style:{color:"var(--text-primary)"},children:h.name}),e.jsxs("span",{style:{color:"var(--text-secondary)"},children:[S,"%  ",O(h.revenue)]})]},h.name)})})})]}),e.jsx(wd,{type:"single",collapsible:!0,defaultValue:"",children:e.jsxs(Ka,{value:"insights",className:"border rounded-lg px-3",style:{borderColor:"var(--border-color)"},children:[e.jsx(Qa,{className:"py-2 text-sm hover:no-underline",children:e.jsxs("span",{className:"flex items-center gap-2",style:{color:"var(--text-primary)"},children:[e.jsx(Vo,{className:"w-4 h-4"}),"Insights Avanados"]})}),e.jsx(Za,{className:"pb-3 pt-0",children:e.jsxs("div",{className:"space-y-4",children:[$&&e.jsxs(Q,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(he,{className:"py-2 px-3 pb-0",children:e.jsxs(xe,{className:"text-sm font-semibold flex items-center gap-1.5",style:{color:"var(--text-primary)"},children:[e.jsx($s,{className:"w-4 h-4 text-green-500"}),"Previso de Demanda (7 dias)"]})}),e.jsxs(Z,{className:"pt-1 px-3 pb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-2",children:[e.jsx("span",{className:"text-sm font-bold",style:{color:"var(--text-primary)"},children:O(P.avgDailyRevenue)}),e.jsx(ye,{variant:P.trend==="up"?"default":"secondary",className:"text-xs",children:P.trend==="up"?"Alta":"Baixa"})]}),e.jsx(nt,{config:{predicted:{label:"Previso",color:"#22c55e"}},className:"h-[100px]",children:e.jsxs(mc,{data:P.forecast,margin:{top:5,right:5,left:0,bottom:0},children:[e.jsx(at,{strokeDasharray:"3 3",stroke:E}),e.jsx(Ea,{dataKey:"date",stroke:u,fontSize:10,tickLine:!1,axisLine:!1}),e.jsx(Oa,{stroke:u,fontSize:10,tickLine:!1,axisLine:!1,tickFormatter:h=>O(h)}),e.jsx(Mt,{content:e.jsx(it,{formatter:h=>O(h)})}),e.jsx(Gt,{type:"monotone",dataKey:"predicted",stroke:"#22c55e",strokeWidth:2,dot:{fill:"#22c55e",r:2}})]})})]})]}),e.jsxs(Q,{className:"overflow-hidden",style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(he,{className:"py-2 px-3 pb-0",children:e.jsxs(xe,{className:"text-sm font-semibold flex items-center gap-1.5",style:{color:"var(--text-primary)"},children:[e.jsx(xn,{className:"w-4 h-4 text-orange-500"}),"Horrios de Pico"]})}),e.jsxs(Z,{className:"pt-1 px-3 pb-3",children:[V.length>0&&e.jsxs("p",{className:"text-xs mb-2",style:{color:"var(--text-secondary)"},children:["Top 3: ",V.map(h=>h.label).join(", ")]}),e.jsx(nt,{config:{orders:{label:"Pedidos",color:"#f97316"}},className:"h-[100px]",children:e.jsxs(ei,{data:i,margin:{top:5,right:5,left:0,bottom:0},children:[e.jsx(at,{strokeDasharray:"3 3",stroke:E}),e.jsx(Ea,{dataKey:"label",stroke:u,fontSize:10,tickLine:!1,axisLine:!1}),e.jsx(Oa,{stroke:u,fontSize:10,tickLine:!1,axisLine:!1}),e.jsx(Mt,{content:e.jsx(it,{})}),e.jsx(si,{dataKey:"orders",fill:"#f97316",radius:[4,4,0,0]})]})})]})]}),e.jsxs(Q,{className:"overflow-hidden",style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(he,{className:"py-2 px-3 pb-0",children:e.jsxs(xe,{className:"text-sm font-semibold flex items-center gap-1.5",style:{color:"var(--text-primary)"},children:[e.jsx($s,{className:"w-4 h-4 text-blue-500"}),"Categorias Mais Vendidas"]})}),e.jsx(Z,{className:"pt-1 px-3 pb-3",children:k?e.jsx(nt,{config:{revenue:{label:"Faturamento",color:"#3b82f6"}},className:"h-[120px]",children:e.jsxs(ei,{data:m,layout:"vertical",margin:{top:5,right:5,left:50,bottom:0},children:[e.jsx(at,{strokeDasharray:"3 3",stroke:E}),e.jsx(Ea,{type:"number",stroke:u,fontSize:10,tickLine:!1,axisLine:!1,tickFormatter:h=>O(h)}),e.jsx(Oa,{type:"category",dataKey:"name",stroke:u,fontSize:10,tickLine:!1,axisLine:!1,width:48}),e.jsx(Mt,{content:e.jsx(it,{formatter:h=>O(h)})}),e.jsx(si,{dataKey:"revenue",fill:"#3b82f6",radius:[0,4,4,0]})]})}):e.jsxs("ul",{className:"space-y-1 text-sm",children:[m.slice(0,3).map(h=>e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{style:{color:"var(--text-primary)"},children:h.name}),e.jsx("span",{style:{color:"var(--text-secondary)"},children:O(h.revenue)})]},h.name)),m.length===0&&e.jsx("p",{className:"text-xs",style:{color:"var(--text-secondary)"},children:"Sem dados"})]})})]}),e.jsxs(Q,{className:"overflow-hidden",style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(he,{className:"py-2 px-3 pb-0",children:e.jsxs(xe,{className:"text-sm font-semibold flex items-center gap-1.5",style:{color:"var(--text-primary)"},children:[e.jsx(Rt,{className:"w-4 h-4 text-purple-500"}),"Performance por Dia da Semana"]})}),e.jsx(Z,{className:"pt-1 px-3 pb-3",children:N?e.jsx(nt,{config:{orders:{label:"Pedidos",color:"#8b5cf6"}},className:"h-[100px]",children:e.jsxs(ei,{data:p,margin:{top:5,right:5,left:0,bottom:0},children:[e.jsx(at,{strokeDasharray:"3 3",stroke:E}),e.jsx(Ea,{dataKey:"day",stroke:u,fontSize:10,tickLine:!1,axisLine:!1}),e.jsx(Oa,{stroke:u,fontSize:10,tickLine:!1,axisLine:!1}),e.jsx(Mt,{content:e.jsx(it,{})}),e.jsx(si,{dataKey:"orders",fill:"#8b5cf6",radius:[4,4,0,0]})]})}):e.jsxs("ul",{className:"space-y-1 text-sm",children:[p.filter(h=>h.orders>0).sort((h,F)=>F.orders-h.orders).slice(0,3).map(h=>e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{style:{color:"var(--text-primary)"},children:h.day}),e.jsxs("span",{style:{color:"var(--text-secondary)"},children:[h.orders," pedidos"]})]},h.day)),p.every(h=>h.orders===0)&&e.jsx("p",{className:"text-xs",style:{color:"var(--text-secondary)"},children:"Sem dados"})]})})]}),o.length>1&&e.jsxs(Q,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(he,{className:"py-2 px-3 pb-0",children:e.jsx(xe,{className:"text-sm font-semibold",style:{color:"var(--text-primary)"},children:"Detalhamento Mtodos de Pagamento"})}),e.jsx(Z,{className:"pt-1 px-3 pb-3",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottomColor:"var(--border-color)"},children:[e.jsx("th",{className:"text-left py-1 px-2 font-semibold",style:{color:"var(--text-primary)"},children:"Mtodo"}),e.jsx("th",{className:"text-right py-1 px-2 font-semibold",style:{color:"var(--text-primary)"},children:"Pedidos"}),e.jsx("th",{className:"text-right py-1 px-2 font-semibold",style:{color:"var(--text-primary)"},children:"Faturamento"}),e.jsx("th",{className:"text-right py-1 px-2 font-semibold",style:{color:"var(--text-primary)"},children:"%"})]})}),e.jsx("tbody",{children:o.map((h,F)=>{const S=D>0?(h.revenue/D*100).toFixed(1):0;return e.jsxs("tr",{style:{borderBottomColor:"var(--border-color)"},children:[e.jsxs("td",{className:"py-1 px-2 flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full",style:{backgroundColor:po[F%po.length]}}),e.jsx("span",{style:{color:"var(--text-primary)"},children:h.name})]}),e.jsx("td",{className:"text-right py-1 px-2",style:{color:"var(--text-primary)"},children:h.count}),e.jsx("td",{className:"text-right py-1 px-2 font-medium",style:{color:"var(--text-primary)"},children:O(h.revenue)}),e.jsx("td",{className:"text-right py-1 px-2",children:e.jsxs(ye,{variant:"outline",className:"text-[10px] px-1 py-0",children:[S,"%"]})})]},h.name)})})]})})})]})]})})]})})]})}async function Tn(s,a=8e3,t="Timeout ao buscar dados"){const r=new Promise((n,l)=>setTimeout(()=>l(new Error(t)),a));try{return await Promise.race([s,r])}catch(n){throw console.error("[safeFetch] Erro:",n),n}}function _s(s,a=[]){return Array.isArray(s)?s:a}function Wt(s={}){const{menuContext:a,loading:t}=as(),{orderBy:r="-created_date",filters:n={},...l}=s;return!t&&a&&l.enabled,ke({queryKey:["orders",a?.type,a?.value,r,n],queryFn:async()=>{try{const c={};a?.type==="subscriber"&&a?.value&&(c.as_subscriber=a.value);const d=se.entities.Order.list(r,c),i=await Tn(d,1e4,"Timeout ao buscar pedidos");let o=_s(i);Object.keys(n).length>0&&(o=o.filter(p=>Object.entries(n).every(([x,g])=>g==null?!0:p[x]===g)));const m=p=>new Date(p?.created_date||p?.created_at||0).getTime();return o.sort((p,x)=>m(x)-m(p)),log.menu.log(" [useOrders] Pedidos recebidos:",o.length),o}catch(c){return log.menu.error(" [useOrders] Erro ao buscar pedidos:",c),[]}},enabled:!t&&!!a&&l.enabled!==!1,initialData:[],retry:2,refetchOnMount:!0,staleTime:30*1e3,gcTime:300*1e3,...l})}async function fr(s){const a=await se.auth.me();let t=null;try{const n=sessionStorage.getItem("userContext");n&&(t=JSON.parse(n)?.subscriberData?.slug||null)}catch{}let r=null;if(t)r=t,Fe.menu.debug(" [getReliableSlug] Usando slug do subscriberData:",r);else if(a?.slug)r=a.slug,Fe.menu.debug(" [getReliableSlug] Usando slug do user:",r);else if(s?.type==="slug"&&s.value)r=s.value,Fe.menu.debug(" [getReliableSlug] Usando slug do menuContext:",r);else{const n=window.location.pathname.match(/\/s\/([^/]+)/);n&&(r=n[1],Fe.menu.debug(" [getReliableSlug] Usando slug da URL (ltimo recurso):",r))}return r}async function wl(s){try{Fe.menu.debug(" [adminMenuService] Buscando pratos admin...",s);const a={};s.type==="subscriber"&&s.value&&(a.as_subscriber=s.value,Fe.menu.debug(" [adminMenuService] Passando as_subscriber:",s.value)),Fe.menu.debug(" [adminMenuService] Chamando Dish.list com opts:",a);try{const t=se.entities.Dish.list("order",a),r=await Tn(t,1e4,"Timeout ao buscar pratos");if(Fe.menu.debug(" [adminMenuService] Pratos recebidos:",_s(r).length,"pratos"),Fe.menu.debug(" [adminMenuService] Amostra:",_s(r).slice(0,3).map(n=>n.name)),_s(r).length===0){Fe.menu.warn(" [adminMenuService] Rota admin retornou 0 pratos, tentando fallback pblico");const n=await fr(s);if(n)try{const l=await se.get(`/public/cardapio/${n}`);return Fe.menu.log(" [adminMenuService] Dados pblicos como fallback:",l.dishes?.length||0,"pratos"),_s(l.dishes)}catch(l){Fe.menu.error(" [adminMenuService] Fallback pblico tambm falhou:",l)}else Fe.menu.error(" [adminMenuService] Sem slug disponvel para fallback")}return _s(r)}catch(t){return Fe.menu.error(" [adminMenuService] Erro na rota admin:",t),[]}}catch(a){return Fe.menu.error(" [adminMenuService] Erro ao buscar pratos:",a),[]}}async function _d(s){try{Fe.menu.debug(" [adminMenuService] Buscando categorias admin...",s);const a={};s.type==="subscriber"&&s.value&&(a.as_subscriber=s.value);try{const t=se.entities.Category.list("order",a),r=await Tn(t,1e4,"Timeout ao buscar categorias");if(Fe.menu.debug(" [adminMenuService] Categorias recebidas:",_s(r).length),_s(r).length===0){Fe.menu.warn(" [adminMenuService] Rota admin retornou 0 categorias, tentando fallback pblico");const n=await fr(s);if(n){const l=await se.get(`/public/cardapio/${n}`);return _s(l.categories)}}return _s(r)}catch(t){Fe.menu.warn(" [adminMenuService] Rota admin falhou, tentando fallback pblico");const r=await fr(s);if(r){const n=await se.get(`/public/cardapio/${r}`);return _s(n.categories)}throw t}}catch(a){return Fe.menu.error(" [adminMenuService] Erro ao buscar categorias:",a),[]}}async function N0(s){try{Fe.menu.debug(" [adminMenuService] Buscando grupos de complementos admin...",s);const a={};s.type==="subscriber"&&s.value&&(a.as_subscriber=s.value);try{const t=se.entities.ComplementGroup.list("order",a),r=await Tn(t,1e4,"Timeout ao buscar grupos de complementos");if(Fe.menu.debug(" [adminMenuService] Grupos recebidos:",_s(r).length),_s(r).length===0){Fe.menu.warn(" [adminMenuService] Rota admin retornou 0 grupos, tentando fallback pblico");const n=await fr(s);if(n){const l=await se.get(`/public/cardapio/${n}`);return _s(l.complementGroups)}}return _s(r)}catch(t){Fe.menu.warn(" [adminMenuService] Rota admin falhou, tentando fallback pblico");const r=await fr(s);if(r){const n=await se.get(`/public/cardapio/${r}`);return _s(n.complementGroups)}throw t}}catch(a){return Fe.menu.error(" [adminMenuService] Erro ao buscar grupos:",a),[]}}function _r(s={}){const{menuContext:a}=as();return ke({queryKey:["dishes",a?.type,a?.value],queryFn:async()=>a?await wl(a):(Fe.menu.warn(" [useMenuDishes] menuContext no disponvel"),[]),enabled:!!a&&s.enabled!==!1,initialData:[],placeholderData:Pt,retry:1,refetchOnMount:!0,refetchOnWindowFocus:!1,staleTime:3e4,gcTime:6e4,...s})}function Cd(s={}){const{menuContext:a}=as();return ke({queryKey:["categories",a?.type,a?.value],queryFn:async()=>a?await _d(a):(Fe.menu.warn(" [useMenuCategories] menuContext no disponvel"),[]),enabled:!!a&&s.enabled!==!1,initialData:[],placeholderData:Pt,retry:1,refetchOnMount:!1,refetchOnWindowFocus:!1,staleTime:3e4,gcTime:6e4,...s})}function gv({user:s,subscriberData:a,onNavigateToTab:t}){const[r,n]=b.useState(!1),{menuContext:l}=as(),{data:c=[]}=ke({queryKey:["store",l?.type,l?.value],queryFn:async()=>{if(!l)return[];const h={};return l.type==="subscriber"&&l.value&&(h.as_subscriber=l.value),se.entities.Store.list(null,h)},enabled:!!l}),d=c[0],{data:i=[]}=Wt({orderBy:"-created_date"}),{data:o=[]}=ke({queryKey:["dashboardPDVSales",l?.type,l?.value],queryFn:async()=>{if(!l)return[];const h={};return l.type==="subscriber"&&l.value&&(h.as_subscriber=l.value),se.entities.PedidoPDV.list("-created_date",h)},enabled:!!l}),{data:m=[]}=_r(),{data:p=[]}=Cd(),x=ee().startOf("day"),g=(i||[]).filter(h=>ee(h.created_date).isSame(x,"day")&&h.status!=="cancelled");g.filter(h=>h.status==="delivered").reduce((h,F)=>h+(F.total||0),0);const f=ee().startOf("month"),v=(i||[]).filter(h=>ee(h.created_date).isSameOrAfter(f)&&h.status!=="cancelled").filter(h=>h.status==="delivered").reduce((h,F)=>h+(F.total||0),0),P=i.filter(h=>h.status==="new").length,M=i.filter(h=>["accepted","preparing"].includes(h.status)).length,O=i.filter(h=>h.status==="ready").length,E=i.filter(h=>h.status==="out_for_delivery").length,u=m.filter(h=>h.is_active!==!1).length;m.filter(h=>h.is_active===!1).length;const _=a?.expires_at?ee(a.expires_at).diff(ee(),"days"):null,$=h=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(h||0),{slug:j}=Uo(),D=j||(s?.is_master?s?.slug:a?.slug),V=D?`${window.location.origin}/s/${D}`:`${window.location.origin}${Ns("Cardapio")}`,T=()=>{navigator.clipboard.writeText(V),n(!0),setTimeout(()=>n(!1),2e3)},N=()=>{window.open(`https://wa.me/?text=Confira nosso cardpio digital: ${V}`,"_blank")},z=h=>({new:"Novo",accepted:"Aceito",preparing:"Preparando",ready:"Pronto",out_for_delivery:"Em Rota",delivered:"Entregue",cancelled:"Cancelado"})[h]||h,k=()=>{const h=["Data","Cdigo","Cliente","Status","Pagamento","Total"],F=i.map(C=>[Xt(C.created_date),C.order_code||C.id?.toString().slice(-6),C.customer_name||"",z(C.status),C.payment_method||"",(C.total||0).toFixed(2)]),S=[h,...F].map(C=>C.join(";")).join(`
`),q="\uFEFF",J=new Blob([q+S],{type:"text/csv;charset=utf-8"}),W=document.createElement("a");W.href=URL.createObjectURL(J),W.download=`pedidos-${ee().format("DD-MM-YYYY")}.csv`,W.click(),URL.revokeObjectURL(W.href)};return e.jsxs("div",{className:"space-y-3 sm:space-y-4 p-4 sm:p-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h2",{className:"text-xl sm:text-2xl font-bold truncate",style:{color:"var(--text-primary)"},children:["Boa ",ee().hour()<12?"dia":ee().hour()<18?"tarde":"noite",", ",a?.name?.split(" ")[0]||s?.full_name?.split(" ")[0]||"Usurio","!"]}),e.jsx("p",{className:"text-sm sm:text-base truncate",style:{color:"var(--text-secondary)"},children:d?.name||"Sua Loja"})]}),_!==null&&e.jsx(ye,{className:`px-2 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm font-semibold ${_<=7?"bg-red-500":"bg-green-500"} text-white flex-shrink-0`,children:_>0?`${_} dias restantes`:"Assinatura Expirada"})]}),e.jsx(Kf,{orders:i,dishes:m,pdvSales:o}),(i.length>0||o.length>0)&&e.jsx(a0,{orders:i,pdvSales:o}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-4 gap-2 sm:gap-3",children:[e.jsx(Fr,{icon:or,value:g.length,label:"Pedidos Hoje",color:"info",delay:0}),e.jsx(Fr,{icon:$a,value:$(v),label:"Faturamento Ms",color:"success",delay:.1}),e.jsx(Fr,{icon:xn,value:P,label:"Novos Pedidos",color:"warning",delay:.2}),e.jsx(Fr,{icon:Ss,value:u,label:"Pratos Ativos",color:"primary",delay:.3})]}),e.jsxs(Q,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(he,{className:"py-2 px-4",children:e.jsxs(xe,{className:"flex items-center gap-1.5 text-base",style:{color:"var(--text-primary)"},children:[e.jsx(Ss,{className:"w-4 h-4"}),"Pedidos em Andamento"]})}),e.jsxs(Z,{className:"pt-0 px-4 pb-3",children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:[e.jsxs("div",{className:"rounded-lg p-2.5 text-center",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("p",{className:"text-xl font-bold text-blue-600",children:P}),e.jsx("p",{className:"text-xs mt-0.5",style:{color:"var(--text-secondary)"},children:"Novos"})]}),e.jsxs("div",{className:"rounded-lg p-2.5 text-center",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("p",{className:"text-xl font-bold text-yellow-600",children:M}),e.jsx("p",{className:"text-xs mt-0.5",style:{color:"var(--text-secondary)"},children:"Preparando"})]}),e.jsxs("div",{className:"rounded-lg p-2.5 text-center",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("p",{className:"text-xl font-bold text-green-600",children:O}),e.jsx("p",{className:"text-xs mt-0.5",style:{color:"var(--text-secondary)"},children:"Prontos"})]}),e.jsxs("div",{className:"rounded-lg p-2.5 text-center",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("p",{className:"text-xl font-bold text-purple-600",children:E}),e.jsx("p",{className:"text-xs mt-0.5",style:{color:"var(--text-secondary)"},children:"Em Entrega"})]})]}),e.jsxs("div",{className:"mt-3 flex flex-col sm:flex-row gap-2",children:[e.jsx(Wr,{to:Ns("GestorPedidos"),className:"flex-1",children:e.jsx(A,{className:"w-full min-h-touch",children:"Ver Todos os Pedidos"})}),e.jsxs(A,{variant:"outline",onClick:k,className:"flex-1 min-h-touch",children:[e.jsx(pn,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Exportar CSV"}),e.jsx("span",{className:"sm:hidden",children:"Exportar"})]})]})]})]}),i.length>0&&e.jsx(b0,{orders:i,dishes:m,categories:p}),e.jsxs(Q,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsxs(he,{className:"flex flex-row items-center justify-between space-y-0 py-2 px-4 pb-1",children:[e.jsx(xe,{className:"text-base font-medium",style:{color:"var(--text-primary)"},children:"Cardpio Digital"}),e.jsx(Wr,{to:D?`/s/${D}`:Ns("Cardapio"),target:"_blank",children:e.jsxs(A,{variant:"outline",size:"sm",children:[e.jsx(qi,{className:"w-4 h-4 mr-2"}),"Visualizar"]})})]}),e.jsxs(Z,{className:"pt-0 px-4 pb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(B,{value:V,readOnly:!0,className:"flex-1 text-xs sm:text-sm min-h-touch",style:{backgroundColor:"var(--bg-tertiary)",borderColor:"var(--border-color)",color:"var(--text-primary)"}}),e.jsx(A,{variant:"outline",size:"icon",onClick:T,className:"min-h-touch min-w-touch flex-shrink-0",children:r?e.jsx(ma,{className:"w-4 h-4 text-green-500"}):e.jsx(Js,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(A,{variant:"outline",size:"sm",onClick:N,className:"flex-1 min-h-touch",children:[e.jsx(tu,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Compartilhar no WhatsApp"}),e.jsx("span",{className:"sm:hidden",children:"WhatsApp"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2 sm:gap-3",children:[e.jsx(Q,{className:"hover:shadow-lg transition-shadow cursor-pointer",onClick:()=>t?t("dishes"):window.location.href=Ns("Admin")+"?tab=dishes",style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:e.jsxs(Z,{className:"p-3 sm:p-4 flex items-center gap-2 sm:gap-3 min-h-touch",children:[e.jsx("div",{className:"w-9 h-9 sm:w-10 sm:h-10 rounded-lg flex items-center justify-center flex-shrink-0",style:{backgroundColor:"var(--bg-tertiary)"},children:e.jsx(Ss,{className:"w-4 h-4 sm:w-5 sm:h-5 text-orange-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-sm truncate",style:{color:"var(--text-primary)"},children:"Gerenciar Cardpio"}),e.jsx("p",{className:"text-xs truncate",style:{color:"var(--text-secondary)"},children:"Pratos, categorias e mais"})]})]})}),e.jsx(Q,{className:"hover:shadow-lg transition-shadow cursor-pointer",onClick:()=>t?t("history"):window.location.href=Ns("Admin")+"?tab=history",style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:e.jsxs(Z,{className:"p-3 sm:p-4 flex items-center gap-2 sm:gap-3 min-h-touch",children:[e.jsx("div",{className:"w-9 h-9 sm:w-10 sm:h-10 rounded-lg flex items-center justify-center flex-shrink-0",style:{backgroundColor:"var(--bg-tertiary)"},children:e.jsx(or,{className:"w-4 h-4 sm:w-5 sm:h-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-sm truncate",style:{color:"var(--text-primary)"},children:"Ver Pedidos"}),e.jsx("p",{className:"text-xs truncate",style:{color:"var(--text-secondary)"},children:"Histrico completo"})]})]})}),e.jsx(Q,{className:"hover:shadow-lg transition-shadow cursor-pointer",onClick:()=>t?t("store"):window.location.href=Ns("Admin")+"?tab=store",style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:e.jsxs(Z,{className:"p-3 sm:p-4 flex items-center gap-2 sm:gap-3 min-h-touch",children:[e.jsx("div",{className:"w-9 h-9 sm:w-10 sm:h-10 rounded-lg flex items-center justify-center flex-shrink-0",style:{backgroundColor:"var(--bg-tertiary)"},children:e.jsx(ar,{className:"w-4 h-4 sm:w-5 sm:h-5 text-green-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-sm truncate",style:{color:"var(--text-primary)"},children:"Configuraes"}),e.jsx("p",{className:"text-xs truncate",style:{color:"var(--text-secondary)"},children:"Loja e pagamentos"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3",children:[e.jsxs(Q,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsxs(he,{className:"flex flex-row items-center gap-1.5 space-y-0 py-2 px-4 pb-0",children:[e.jsx(Bo,{className:"w-4 h-4 text-blue-500"}),e.jsx(xe,{className:"text-base font-medium",style:{color:"var(--text-primary)"},children:"Ajuda - Manual"})]}),e.jsxs(Z,{className:"pt-2 px-4 pb-3",children:[e.jsx("p",{className:"text-xs sm:text-sm mb-2",style:{color:"var(--text-secondary)"},children:"Est com alguma dvida sobre como usar?"}),e.jsx(A,{variant:"outline",className:"w-full min-h-touch text-xs",children:"ACESSAR MANUAL"})]})]}),e.jsxs(Q,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsxs(he,{className:"flex flex-row items-center gap-1.5 space-y-0 py-2 px-4 pb-0",children:[e.jsx(ma,{className:"w-4 h-4 text-green-500"}),e.jsx(xe,{className:"text-base font-medium",style:{color:"var(--text-primary)"},children:"Suporte"})]}),e.jsxs(Z,{className:"pt-2 px-4 pb-3",children:[e.jsx("p",{className:"text-xs sm:text-sm mb-2",style:{color:"var(--text-secondary)"},children:"Abra um chamado e receber um contato"}),e.jsx("a",{href:"https://wa.me/5586988196114",target:"_blank",rel:"noopener noreferrer",className:"block",children:e.jsx(A,{className:"w-full bg-green-600 hover:bg-green-700 min-h-touch text-xs",children:"ABRIR CHAMADO"})})]})]})]})]})}function go({className:s="w-5 h-5",...a}){return e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:s,xmlns:"http://www.w3.org/2000/svg",...a,children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"})})}function fv({store:s,subscriber:a,compact:t=!1}){const r=ts(),n=!!s?.id,l=!!a?.id&&!n,c=n?s?.send_whatsapp_commands!==!1:(a?.send_whatsapp_commands??a?.whatsapp_auto_enabled)!==!1,[d,i]=b.useState(c);b.useEffect(()=>{const g=n?s?.send_whatsapp_commands!==!1:(a?.send_whatsapp_commands??a?.whatsapp_auto_enabled)!==!1;i(g)},[n,s?.send_whatsapp_commands,a?.send_whatsapp_commands,a?.whatsapp_auto_enabled]);const o=de({mutationFn:async g=>s?.id?await _e.entities.Store.update(s.id,{send_whatsapp_commands:g}):Promise.reject(new Error("Loja no carregada.")),onSuccess:(g,f)=>{r.invalidateQueries({queryKey:["store"]}),r.invalidateQueries({queryKey:["stores"]}),K.success(f?"Comanda WhatsApp ativada!":"Comanda WhatsApp desativada!")},onError:()=>{i(g=>!g),K.error("Erro ao atualizar")}}),m=de({mutationFn:async g=>a?.id?await _e.entities.Subscriber.update(a.id,{send_whatsapp_commands:g}):Promise.reject(new Error("Assinante no carregado.")),onSuccess:(g,f)=>{r.invalidateQueries({queryKey:["subscriber"]}),r.invalidateQueries({queryKey:["permissions"]}),r.invalidateQueries({queryKey:["store"]}),K.success(f?"Comanda WhatsApp ativada!":"Comanda WhatsApp desativada!")},onError:()=>{i(g=>!g),K.error("Erro ao atualizar")}}),p=n?o:m,x=()=>{const g=!d;i(g),p.mutate(g)};return!n&&!l?null:t?e.jsx(A,{variant:"ghost",size:"icon",onClick:x,disabled:p.isPending,className:`min-h-touch min-w-touch ${d?"text-white bg-green-600/80 hover:bg-green-600":"text-white bg-gray-600/80 hover:bg-gray-600"}`,title:d?"Comanda WhatsApp: Ligado":"Comanda WhatsApp: Desligado",children:d?e.jsx(go,{className:"w-5 h-5"}):e.jsx(Zl,{className:"w-4 h-4"})}):e.jsx(A,{variant:"ghost",size:"sm",onClick:x,disabled:p.isPending,className:`min-h-touch ${d?"text-white bg-green-600/80 hover:bg-green-600":"text-white bg-gray-600/80 hover:bg-gray-600"}`,title:d?"Desativar Comanda WhatsApp":"Ativar Comanda WhatsApp",children:d?e.jsxs(e.Fragment,{children:[e.jsx(go,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"WhatsApp ON"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Zl,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"WhatsApp OFF"})]})})}const hi=768;function Fn(){const[s,a]=b.useState(void 0);return b.useEffect(()=>{const t=window.matchMedia(`(max-width: ${hi-1}px)`),r=()=>{a(window.innerWidth<hi)};return t.addEventListener("change",r),a(window.innerWidth<hi),()=>t.removeEventListener("change",r)},[]),!!s}function jv({isMaster:s,hasGestorAccess:a,hasModuleAccess:t,slug:r,plan:n,className:l=""}){const[c,d]=b.useState(!1),i=Fn(),m=(n||"basic").toString().toLowerCase()==="basic",p=g=>typeof t=="function"?t(g):!0,x=[...s?[{id:"dashboard",label:"Dashboard",icon:Vo,to:Ns("AdminMasterDashboard"),color:"from-orange-500 to-orange-600",hoverColor:"hover:from-orange-600 hover:to-orange-700"},{id:"assinantes",label:"Assinantes",icon:ar,to:Ns("Assinantes"),color:"from-purple-600 to-purple-700",hoverColor:"hover:from-purple-700 hover:to-purple-800"}]:[],{id:"cardapio",label:"Cardpio",icon:na,to:r?Ns("Cardapio",r):Ns("Cardapio"),color:"from-green-600 to-green-700",hoverColor:"hover:from-green-700 hover:to-green-800"},...p("pdv")?[{id:"pdv",label:"PDV",icon:Ko,to:Ns("PDV"),color:"from-blue-600 to-blue-700",hoverColor:"hover:from-blue-700 hover:to-blue-800"}]:[],...a&&(!m||s)?[{id:"gestor",label:"Gestor de Pedidos",icon:ut,to:Ns("GestorPedidos"),color:"from-orange-600 to-orange-700",hoverColor:"hover:from-orange-700 hover:to-orange-800"}]:[],...p("orders")&&(!m||s)?[{id:"entregador",label:"Entregador",icon:mu,to:Ns("Entregador"),color:"from-cyan-600 to-cyan-700",hoverColor:"hover:from-cyan-700 hover:to-cyan-800"}]:[],...p("garcom")?[{id:"garcom",label:"Garom",icon:lh,to:Ns("Garcom"),color:"from-indigo-600 to-indigo-700",hoverColor:"hover:from-indigo-700 hover:to-indigo-800"}]:[],...(p("orders")||p("cozinha"))&&(!m||s)?[{id:"cozinha",label:"Cozinha",icon:Gi,to:Ns("Cozinha"),color:"from-orange-500 to-orange-600",hoverColor:"hover:from-orange-600 hover:to-orange-700"}]:[]];return x.length===0?null:i?e.jsxs(fn,{open:c,onOpenChange:d,children:[e.jsx(jn,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",className:`text-white bg-white/10 hover:bg-white/20 backdrop-blur-sm min-h-touch min-w-touch ${l}`,title:"Menu Rpido",children:e.jsx(Ra,{className:"w-5 h-5"})})}),e.jsx(yn,{side:"bottom",className:"h-auto max-h-[85vh] rounded-t-3xl p-0 bg-gray-900/95 dark:bg-gray-900/95 backdrop-blur-xl border-t border-white/10 dark:border-gray-700/50 pb-[max(1rem,env(safe-area-inset-bottom,0px))] overflow-hidden",children:e.jsxs(Qe.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:50},transition:{type:"spring",damping:25,stiffness:300},className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 pb-3 border-b border-white/10",children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:"Menu Rpido"}),e.jsx(A,{variant:"ghost",size:"icon",onClick:()=>d(!1),className:"text-white hover:bg-white/10 min-h-touch min-w-touch",children:e.jsx(Ds,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:x.map((g,f)=>{const y=g.icon;return e.jsx(Qe.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:f*.05,type:"spring",damping:20},children:e.jsx(Wr,{to:g.to,onClick:()=>d(!1),className:"block",children:e.jsxs(A,{variant:"ghost",className:`w-full h-20 sm:h-24 flex flex-col items-center justify-center gap-2 bg-gradient-to-br ${g.color} ${g.hoverColor} text-white shadow-lg transition-all min-h-touch active:scale-95 hover:scale-105 rounded-xl backdrop-blur-sm`,children:[e.jsx(y,{className:"w-6 h-6 sm:w-7 sm:h-7"}),e.jsx("span",{className:"text-xs sm:text-sm font-medium",children:g.label})]})})},g.id)})})]})})]}):e.jsxs("div",{className:"relative",children:[e.jsx(A,{variant:"ghost",size:"icon",onClick:()=>d(!c),className:`text-white bg-white/10 hover:bg-white/20 backdrop-blur-sm ${l}`,title:"Menu Rpido",children:e.jsx(Ra,{className:"w-5 h-5"})}),e.jsx(ht,{children:c&&e.jsxs(e.Fragment,{children:[e.jsx(Qe.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>d(!1),className:"fixed inset-0 z-40 bg-black/20 backdrop-blur-sm"}),e.jsxs(Qe.div,{initial:{opacity:0,scale:.9,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:-10},transition:{type:"spring",damping:25,stiffness:300},className:"fixed top-16 right-4 z-50 w-80 bg-white/95 dark:bg-gray-900/95 backdrop-blur-xl rounded-2xl shadow-2xl border border-white/20 dark:border-gray-700/50 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 pb-3 border-b border-gray-200/50 dark:border-gray-700/50",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Menu Rpido"}),e.jsx(A,{variant:"ghost",size:"icon",onClick:()=>d(!1),className:"h-8 w-8 text-gray-500 hover:text-gray-900 dark:hover:text-white",children:e.jsx(Ds,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:x.map((g,f)=>{const y=g.icon;return e.jsx(Qe.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:f*.05},children:e.jsx(Wr,{to:g.to,onClick:()=>d(!1),className:"block",children:e.jsxs(A,{variant:"ghost",className:`w-full h-20 flex flex-col items-center justify-center gap-2 bg-gradient-to-br ${g.color} ${g.hoverColor} text-white shadow-lg transition-all hover:scale-105 active:scale-95 rounded-xl`,children:[e.jsx(y,{className:"w-6 h-6"}),e.jsx("span",{className:"text-xs font-medium",children:g.label})]})})},g.id)})})]})]})})]})}function w0({isOpen:s,onClose:a,onSelect:t,availableGroups:r,allDishes:n,currentDish:l}){const[c,d]=b.useState(""),[i,o]=b.useState([]),p=l?.complement_groups?l.complement_groups.map(f=>f.group_id):[],x=f=>n.filter(y=>y.complement_groups?.some(v=>v.group_id===f)),g=r.filter(f=>f.name.toLowerCase().includes(c.toLowerCase()));return e.jsx(Re,{open:s,onOpenChange:a,children:e.jsxs(Le,{className:"sm:max-w-2xl max-w-[95vw] max-h-[80vh] flex flex-col",children:[e.jsxs(Ie,{children:[e.jsx(qe,{children:"Copiar grupo"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Selecione um ou mais grupos para reutilizar"})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Ms,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(B,{placeholder:"Buscar grupos de complementos",value:c,onChange:f=>d(f.target.value),className:"pl-10"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-2",children:g.length===0?e.jsx("div",{className:"text-center py-8 text-gray-400",children:"Nenhum grupo encontrado"}):g.map(f=>{const y=x(f.id),v=i.includes(f.id),P=p.includes(f.id);return e.jsx("button",{onClick:()=>{P||o(v?M=>M.filter(O=>O!==f.id):M=>[...M,f.id])},disabled:P,className:`w-full p-4 border rounded-lg text-left transition-colors ${P?"bg-gray-100 border-gray-300 opacity-60 cursor-not-allowed":v?"bg-orange-50 border-orange-300":"hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-5 h-5 mt-0.5 border-2 rounded flex items-center justify-center flex-shrink-0 ${P?"bg-gray-400 border-gray-400":v?"bg-orange-500 border-orange-500":"border-gray-300"}`,children:P?e.jsx(ia,{className:"w-3 h-3 text-white"}):v?e.jsx(ia,{className:"w-3 h-3 text-white"}):null}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-base",children:f.name}),P&&e.jsx(ye,{variant:"outline",className:"text-xs bg-green-50 text-green-700 border-green-300",children:"J adicionado"})]}),e.jsx("p",{className:"text-sm text-gray-500",children:P?"Este grupo j est adicionado a este prato":y.length>0?`Disponvel em: ${y.map(M=>M.name).join(", ")}`:"Grupo disponvel para uso"})]}),e.jsxs(ye,{variant:"outline",className:"ml-2 flex-shrink-0",children:[(f.options||[]).length," opes"]})]})},f.id)})}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsx("p",{className:"text-sm text-gray-600",children:i.length>0?`${i.length} grupo(s) selecionado(s)`:"Nenhum grupo selecionado"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(A,{variant:"outline",onClick:a,children:"Voltar"}),e.jsxs(A,{onClick:()=>{i.forEach(f=>t(f)),o([]),a()},disabled:i.length===0,className:"bg-orange-500 hover:bg-orange-600",children:["Confirmar ",i.length>0&&`(${i.length})`]})]})]})]})})}function _0({template:s,displayName:a,onUse:t,onDelete:r,onEdit:n}){const[l,c]=b.useState(!1),[d,i]=b.useState(a),o=()=>{d.trim()&&d.trim()!==a&&n(d.trim()),c(!1)},m=()=>{i(a),c(!1)};return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"flex-1",children:l?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{value:d,onChange:p=>i(p.target.value),className:"flex-1 h-8",autoFocus:!0,onKeyDown:p=>{p.key==="Enter"&&o(),p.key==="Escape"&&m()}}),e.jsx(A,{size:"sm",variant:"ghost",onClick:o,className:"h-8 w-8 p-0",children:e.jsx(ia,{className:"w-4 h-4 text-green-600"})}),e.jsx(A,{size:"sm",variant:"ghost",onClick:m,className:"h-8 w-8 p-0",children:e.jsx(Ds,{className:"w-4 h-4 text-gray-500"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium text-sm",children:a}),e.jsxs("p",{className:"text-xs text-gray-500",children:[s.options?.length||0," opes"]})]})}),!l&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{size:"sm",variant:"outline",onClick:()=>c(!0),title:"Editar nome",children:e.jsx(vn,{className:"w-4 h-4"})}),e.jsxs(A,{size:"sm",variant:"outline",onClick:t,children:[e.jsx(Js,{className:"w-4 h-4 mr-1"}),"Usar"]}),e.jsx(A,{size:"sm",variant:"ghost",onClick:r,className:"text-red-500",children:e.jsx(Xe,{className:"w-4 h-4"})})]})]})}function C0({isOpen:s,onClose:a,onUseTemplate:t}){const[r,n]=b.useState(""),[l,c]=b.useState([]),d=ts(),{menuContext:i}=as(),{data:o=[]}=ke({queryKey:["complementGroups",i?.type,i?.value],queryFn:async()=>{if(!i)return[];const v={};return i.type==="subscriber"&&i.value&&(v.as_subscriber=i.value),se.entities.ComplementGroup.list("order",v)},enabled:!!i,refetchOnMount:"always"}),m=o.filter(v=>v.is_template===!0||v.name.includes("[TEMPLATE]")),p=o.filter(v=>!v.is_template&&!v.name.includes("[TEMPLATE]")),x=de({mutationFn:async v=>{const M=o.filter(O=>v.includes(O.id)).map(O=>se.entities.ComplementGroup.create({...O,name:O.name,is_template:!0,id:void 0,created_date:void 0,updated_date:void 0}));return Promise.all(M)},onSuccess:()=>{d.invalidateQueries({queryKey:["complementGroups"]}),K.success("Template salvo com sucesso!"),c([])}}),g=de({mutationFn:v=>se.entities.ComplementGroup.delete(v),onSuccess:()=>{d.invalidateQueries({queryKey:["complementGroups"]}),K.success("Template excludo")}}),f=de({mutationFn:async v=>{const P=o.find(O=>O.id===v);return P?await se.entities.ComplementGroup.create({...P,name:P.name.replace("[TEMPLATE]","").trim(),is_template:!1,id:void 0,created_date:void 0,updated_date:void 0}):void 0},onSuccess:v=>{d.invalidateQueries({queryKey:["complementGroups"]}),K.success("Template aplicado!"),t(v),a()}}),y=de({mutationFn:async({id:v,name:P})=>{const M=o.find(O=>O.id===v);if(M)return se.entities.ComplementGroup.update(v,{...M,name:P.trim()})},onSuccess:()=>{d.invalidateQueries({queryKey:["complementGroups"]}),K.success("Nome do template atualizado!")}});return e.jsx(Re,{open:s,onOpenChange:a,children:e.jsxs(Le,{className:"sm:max-w-2xl max-w-[95vw] max-h-[80vh] overflow-y-auto",children:[e.jsx(Ie,{children:e.jsxs(qe,{className:"flex items-center gap-2",children:[e.jsx(vi,{className:"w-5 h-5 text-orange-500"}),"Templates de Complementos"]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Templates Salvos"}),m.length===0?e.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:[e.jsx(vi,{className:"w-8 h-8 text-gray-300 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Nenhum template salvo ainda"})]}):e.jsx("div",{className:"space-y-2",children:m.map(v=>{const P=v.name.replace("[TEMPLATE]","").trim();return e.jsx(_0,{template:v,displayName:P,onUse:()=>f.mutate(v.id),onDelete:()=>{confirm("Excluir este template?")&&g.mutate(v.id)},onEdit:M=>{y.mutate({id:v.id,name:M})}},v.id)})})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Criar Novo Template"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Selecione grupos de complementos existentes para salvar como template:"}),e.jsx("div",{className:"space-y-2 mb-4 max-h-48 overflow-y-auto",children:p.map(v=>e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.includes(v.id),onChange:P=>{P.target.checked?c(M=>[...M,v.id]):c(M=>M.filter(O=>O!==v.id))},className:"w-4 h-4"}),e.jsx("span",{className:"text-sm flex-1",children:v.name}),e.jsxs(ye,{variant:"outline",className:"text-xs",children:[v.options?.length||0," opes"]})]},v.id))}),e.jsxs(A,{onClick:()=>x.mutate(l),disabled:l.length===0||x.isPending,className:"w-full bg-orange-500 hover:bg-orange-600",children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Salvar como Template (",l.length," selecionados)"]})]})]})]})})}function k0({isOpen:s,onClose:a,group:t,onUpdate:r}){const[n,l]=b.useState([]),[c,d]=b.useState({type:"add",value:0}),i=()=>{n.length===t.options.length?l([]):l(t.options.map(p=>p.id))},o=()=>{const p=t.options.map(x=>{if(n.includes(x.id)){let g=x.price||0;return c.type==="add"?g+=parseFloat(c.value)||0:c.type==="multiply"?g*=parseFloat(c.value)||1:c.type==="set"&&(g=parseFloat(c.value)||0),{...x,price:Math.max(0,g)}}return x});r({...t,options:p}),K.success(`${n.length} opes atualizadas`),a()},m=p=>{const x=t.options.map(g=>n.includes(g.id)?{...g,is_active:p}:g);r({...t,options:x}),K.success(`${n.length} opes ${p?"ativadas":"desativadas"}`),a()};return e.jsx(Re,{open:s,onOpenChange:a,children:e.jsxs(Le,{className:"sm:max-w-2xl max-w-[95vw] max-h-[80vh] overflow-y-auto",children:[e.jsx(Ie,{children:e.jsxs(qe,{className:"flex items-center gap-2",children:[e.jsx(Lt,{className:"w-5 h-5 text-orange-500"}),"Edio em Massa - ",t?.name]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(R,{children:"Selecione as opes para editar:"}),e.jsx(A,{size:"sm",variant:"outline",onClick:i,children:n.length===t?.options?.length?"Desmarcar Todas":"Selecionar Todas"})]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto bg-gray-50 rounded-lg p-3",children:t?.options?.map(p=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-white rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.includes(p.id),onChange:x=>{x.target.checked?l(g=>[...g,p.id]):l(g=>g.filter(f=>f!==p.id))},className:"w-4 h-4"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm font-medium",children:p.name}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["R$ ",(p.price||0).toFixed(2)]})]}),e.jsx(ye,{variant:p.is_active!==!1?"default":"outline",className:"text-xs",children:p.is_active!==!1?"Ativo":"Inativo"})]},p.id))}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:[n.length," de ",t?.options?.length||0," opes selecionadas"]})]}),n.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-t pt-4",children:[e.jsx(R,{className:"mb-3 block",children:"Ajustar Preos"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("div",{children:e.jsxs("select",{value:c.type,onChange:p=>d(x=>({...x,type:p.target.value})),className:"w-full border rounded-lg px-3 py-2 text-sm",children:[e.jsx("option",{value:"add",children:"Adicionar"}),e.jsx("option",{value:"multiply",children:"Multiplicar por"}),e.jsx("option",{value:"set",children:"Definir como"})]})}),e.jsx("div",{children:e.jsx(B,{type:"number",step:"0.01",value:c.value,onChange:p=>d(x=>({...x,value:p.target.value})),placeholder:c.type==="multiply"?"1.10 (aumentar 10%)":"5.00"})})]}),e.jsxs(A,{onClick:o,className:"w-full mt-3 bg-blue-500 hover:bg-blue-600",children:[e.jsx($a,{className:"w-4 h-4 mr-2"}),"Aplicar Ajuste de Preo"]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx(R,{className:"mb-3 block",children:"Alterar Status"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(A,{onClick:()=>m(!0),variant:"outline",className:"border-green-500 text-green-600 hover:bg-green-50",children:[e.jsx(ia,{className:"w-4 h-4 mr-2"}),"Ativar Selecionadas"]}),e.jsxs(A,{onClick:()=>m(!1),variant:"outline",className:"border-red-500 text-red-600 hover:bg-red-50",children:[e.jsx(Ds,{className:"w-4 h-4 mr-2"}),"Desativar Selecionadas"]})]})]})]})]})]})})}function S0({isOpen:s,onClose:a,onSelectType:t,categoryId:r,categoryDishes:n=[],onRedirectToPizzas:l,hasPizzaService:c=!1,subscriberName:d="",onRequestPizzaService:i}){n.some(v=>!v.product_type||v.product_type==="preparado");const[o,m]=b.useState(!1),[p,x]=b.useState(!1),g=[{type:"preparado",icon:na,title:"Preparado",description:"Produtos produzidos pela sua loja, como marmitas, bolos, lanches e etc.",available:!0},{type:"industrializado",icon:Ss,title:"Industrializado",description:"Produtos prontos que sua loja no produz, como chocolates, chicletes, refrigerantes e etc.",available:!0},{type:"pizza",icon:Wo,title:"Pizza",description:c?'As pizzas so gerenciadas na aba "Pizzas". Clique aqui para ir at l.':"O servio de Pizza no faz parte do seu plano. Clique para solicitar.",available:!0}],f=(v,P)=>{if(P){if(v==="pizza"){if(!c){m(!0);return}a(),l&&l();return}t(v),a()}},y=async()=>{x(!0);try{i?await i():await se.entities.ServiceRequest.create({type:"add_pizza_service",subscriber_name:d||"Assinante",status:"pending",requested_at:new Date().toISOString()}),K.success("Solicitao enviada! Entraremos em contato em breve."),m(!1),a()}catch{K.error("Erro ao enviar solicitao. Tente novamente.")}finally{x(!1)}};return e.jsx(Re,{open:s,onOpenChange:a,children:e.jsxs(Le,{className:"sm:max-w-2xl max-w-[95vw]",children:[e.jsx(Ie,{children:e.jsx(qe,{children:"Escolha um tipo de produto"})}),e.jsx("div",{className:"space-y-3",children:g.map(v=>{const P=v.icon,M=!v.available;return e.jsxs(Qe.button,{whileHover:M?{}:{scale:1.02},whileTap:M?{}:{scale:.98},onClick:()=>f(v.type,v.available),disabled:M,className:`w-full flex items-start gap-4 p-4 rounded-xl border-2 text-left transition-all ${M?"bg-gray-100 border-gray-200 cursor-not-allowed opacity-60":"bg-white border-gray-200 hover:border-orange-500 hover:shadow-md cursor-pointer"}`,children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${M?"bg-gray-200":"bg-orange-50"}`,children:e.jsx(P,{className:`w-6 h-6 ${M?"text-gray-400":"text-orange-600"}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`font-semibold text-base mb-1 ${M?"text-gray-500":"text-gray-900"}`,children:v.title}),e.jsx("p",{className:`text-sm ${M?"text-gray-400":"text-gray-600"}`,children:v.description})]}),!M&&e.jsx("div",{className:"flex items-center justify-center w-6 h-6 rounded-full border-2 border-orange-500",children:e.jsx("div",{className:"w-3 h-3 rounded-full bg-orange-500"})})]},v.type)})}),e.jsx("div",{className:"flex justify-end gap-3 pt-4 border-t",children:e.jsx("button",{onClick:a,className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:"Cancelar"})}),o&&e.jsxs("div",{className:"mt-4 p-4 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-amber-800 font-medium mb-2",children:"O servio de Pizza no faz parte do seu plano atual."}),e.jsx("p",{className:"text-sm text-amber-700 mb-4",children:"Deseja solicitar a incluso deste servio? Enviaremos sua solicitao para anlise."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>m(!1),className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:y,disabled:p,className:"px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 disabled:opacity-50",children:p?"Enviando...":"Sim, solicitar servio"})]})]})]})})}function D0(){const[s,a]=ae.useState(null),[t,r]=b.useState(!1),[n,l]=b.useState(""),[c,d]=b.useState(""),i=ts(),{menuContext:o}=as();ae.useEffect(()=>{(async()=>{try{const _=await se.auth.me();a(_)}catch(_){console.error("Error loading user:",_)}})()},[]);const{data:m=[]}=Cd({refetchOnMount:"always"}),{data:p=[]}=_r(),x=(Array.isArray(p)?p:[]).filter(u=>u.product_type!=="pizza"),g=b.useMemo(()=>{const u=Array.isArray(m)?m:[];return c?u.filter(_=>_.name?.toLowerCase().includes(c.toLowerCase())):u},[m,c]),f=b.useMemo(()=>{const u=Array.isArray(m)?m:[],_=Array.isArray(x)?x:[],$=u.length,j=_.length,D=u.map(N=>({category:N,count:_.filter(z=>z.category_id===N.id).length})),V=D.filter(N=>N.count>0).length,T=$-V;return{totalCategories:$,totalDishes:j,categoriesWithDishes:V,emptyCategories:T,dishesByCategory:D}},[m,x]),y=de({mutationFn:async u=>{const _={...u,owner_email:s?.subscriber_email||s?.email};return o?.type==="subscriber"&&o?.value&&(_.as_subscriber=o.value),se.entities.Category.create(_)},onSuccess:()=>{i.invalidateQueries({queryKey:["categories"]}),i.invalidateQueries({queryKey:["dishes"]}),r(!1),l(""),K.success(" Categoria criada!")},onError:u=>{K.error(u?.message||"Erro ao criar categoria")}}),v=()=>o?.type==="subscriber"&&o?.value?{as_subscriber:o.value}:{},P=de({mutationFn:({id:u,data:_})=>se.entities.Category.update(u,_,v()),onSuccess:()=>i.invalidateQueries({queryKey:["categories"]})}),M=de({mutationFn:u=>se.entities.Category.delete(u,v()),onSuccess:()=>i.invalidateQueries({queryKey:["categories"]})}),O=u=>{u.preventDefault(),n.trim()&&y.mutate({name:n.trim(),order:m.length})},E=(u,_)=>{const $=u+_;if($<0||$>=m.length)return;const j=m[u],D=m[$];P.mutate({id:j.id,data:{...j,order:$}}),P.mutate({id:D.id,data:{...D,order:u}})};return e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(Q,{children:e.jsx(Z,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total de Categorias"}),e.jsx("p",{className:"text-2xl font-bold",children:f.totalCategories})]}),e.jsx(Ra,{className:"w-8 h-8 text-orange-500"})]})})}),e.jsx(Q,{children:e.jsx(Z,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Com Pratos"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:f.categoriesWithDishes})]}),e.jsx(Ss,{className:"w-8 h-8 text-green-500"})]})})}),e.jsx(Q,{children:e.jsx(Z,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Vazias"}),e.jsx("p",{className:"text-2xl font-bold text-gray-400",children:f.emptyCategories})]}),e.jsx(en,{className:"w-8 h-8 text-gray-400"})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ms,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(B,{placeholder:"Buscar categoria...",value:c,onChange:u=>d(u.target.value),className:"pl-10"})]}),e.jsxs(A,{onClick:()=>r(!0),className:"bg-orange-500 hover:bg-orange-600",children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Adicionar Categoria"]})]}),e.jsx("div",{className:"max-w-xl mx-auto space-y-3",children:g.length===0?e.jsx(gn,{icon:en,title:c?"Nenhuma categoria encontrada":"Organize melhor seu cardpio criando categorias",description:c?"Tente buscar com outro termo":"Categorias ajudam seus clientes a encontrar pratos mais facilmente",actionLabel:c?void 0:"Criar categoria",onAction:c?void 0:()=>r(!0)}):g.map((u,_)=>{const $=x.filter(j=>j.category_id===u.id).length;return e.jsxs("div",{className:"bg-white rounded-xl p-3 sm:p-4 shadow-sm flex items-center gap-2 sm:gap-4",children:[e.jsx(Ra,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("input",{type:"text",value:u.name||"",onChange:j=>P.mutate({id:u.id,data:{...u,name:j.target.value}}),className:"w-full font-medium bg-transparent border-b border-transparent hover:border-gray-300 focus:border-orange-500 focus:outline-none",placeholder:"Nome da categoria"}),e.jsxs(ye,{variant:"outline",className:"mt-1 text-xs",children:[$," ",$===1?"prato":"pratos"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>E(_,-1),disabled:_===0,className:"p-1 hover:bg-gray-100 rounded disabled:opacity-30",children:e.jsx(Ot,{className:"w-4 h-4 text-gray-400"})}),e.jsx("button",{onClick:()=>E(_,1),disabled:_===m.length-1,className:"p-1 hover:bg-gray-100 rounded disabled:opacity-30",children:e.jsx(La,{className:"w-4 h-4 text-gray-400"})})]}),e.jsx(A,{size:"icon",variant:"ghost",className:"text-red-500 hover:text-red-700 hover:bg-red-50",onClick:()=>{$>0&&!confirm(`Esta categoria tem ${$} prato(s). Deseja realmente excluir?`)||(M.mutate(u.id),K.success("Categoria excluda"))},children:e.jsx(Xe,{className:"w-4 h-4"})})]},u.id)})}),e.jsx(Re,{open:t,onOpenChange:r,children:e.jsxs(Le,{className:"sm:max-w-sm max-w-[95vw]",children:[e.jsxs(Ie,{children:[e.jsx(qe,{children:"Adicionar Categoria"}),e.jsx(Zr,{className:"sr-only",children:"Formulrio para criar uma nova categoria de produtos."})]}),e.jsxs("form",{onSubmit:O,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome da Categoria"}),e.jsx(B,{value:n,onChange:u=>l(u.target.value),placeholder:"Ex: Tradicionais",required:!0})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(A,{type:"button",variant:"outline",onClick:()=>r(!1),className:"flex-1",children:"Cancelar"}),e.jsx(A,{type:"submit",className:"flex-1 bg-orange-500 hover:bg-orange-600",children:"Adicionar"})]})]})]})})]})}function M0({option:s,group:a,optionIndex:t,provided:r,snapshot:n,onUpdate:l,onToggle:c,onRemove:d,canEdit:i}){const[o,m]=b.useState(s.name||""),[p,x]=b.useState(s.price?.toString()||"0"),g=()=>{o!==s.name&&l(a,s.id,"name",o)},f=()=>{const y=parseFloat(p)||0;y!==s.price&&l(a,s.id,"price",y)};return e.jsxs("div",{ref:r.innerRef,...r.draggableProps,...r.dragHandleProps,className:Ze("flex flex-wrap items-center gap-2 p-2 rounded-lg border transition-all",n.isDragging?"shadow-lg":"",s.is_active?"bg-white border-gray-200":"bg-gray-50 border-gray-100 opacity-60"),children:[e.jsx(cr,{className:"w-4 h-4 text-gray-400 flex-shrink-0 cursor-grab active:cursor-grabbing"}),e.jsx(B,{value:o,onChange:y=>m(y.target.value),onBlur:g,className:"flex-1 min-w-[120px] h-8 border-0 bg-transparent hover:bg-gray-50 focus:bg-white",placeholder:"Nome da opo"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xs text-gray-400",children:"R$"}),e.jsx(B,{type:"number",step:"0.01",value:p,onChange:y=>x(y.target.value),onBlur:f,className:"w-16 h-8 text-center"})]}),e.jsx(A,{size:"sm",variant:s.is_active?"default":"outline",className:Ze("h-7 text-xs",s.is_active?"bg-green-500 hover:bg-green-600":""),onClick:()=>c(a,s.id),disabled:!i,children:s.is_active?"ON":"OFF"}),e.jsx("button",{onClick:()=>d(a,s.id),className:"p-1 text-red-400 hover:text-red-600",disabled:!i,children:e.jsx(Ds,{className:"w-4 h-4"})})]})}function A0({group:s,groupIndex:a,provided:t,snapshot:r,updateMutation:n,deleteMutation:l,onAddOption:c,onToggleOption:d,onRemoveOption:i,onUpdateOption:o,onDragEndOptions:m,canEdit:p}){const[x,g]=b.useState(s.name||""),[f,y]=b.useState(s.max_selection?.toString()||"1"),v=()=>{x!==s.name&&n.mutate({id:s.id,data:{name:x}})},P=()=>{const M=parseInt(f)||1;M!==s.max_selection&&n.mutate({id:s.id,data:{max_selection:M}})};return e.jsxs("div",{ref:t.innerRef,...t.draggableProps,className:Ze("bg-white rounded-xl p-4 sm:p-5 shadow-sm border transition-all",r.isDragging?"shadow-2xl":""),children:[e.jsxs("div",{className:"flex items-start justify-between mb-4 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("div",{...t.dragHandleProps,className:"cursor-grab active:cursor-grabbing",children:e.jsx(cr,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("input",{type:"text",value:x,onChange:M=>g(M.target.value),onBlur:v,className:"font-bold text-lg bg-transparent border-b border-transparent hover:border-gray-300 focus:border-orange-500 focus:outline-none w-full",placeholder:"Nome do grupo"}),e.jsxs(ye,{variant:"outline",className:"text-xs mt-1",children:[(s.options||[]).length," itens"]})]})]}),e.jsx(A,{size:"icon",variant:"ghost",className:"text-red-500 hover:text-red-700 flex-shrink-0",onClick:()=>{const M=dishes.filter(O=>O.complement_groups?.some(E=>E.group_id===s.id));if(M.length>0){if(!confirm(`Este grupo est sendo usado em ${M.length} prato(s). Deseja realmente excluir?`))return}else if(!confirm("Excluir este grupo?"))return;l.mutate(s.id),K.success("Grupo excludo")},children:e.jsx(Xe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-4 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx(mt,{checked:s.is_required,onCheckedChange:M=>n.mutate({id:s.id,data:{is_required:M}})}),e.jsx("span",{children:"Obrigatrio?"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-500",children:"Mx:"}),e.jsx(B,{type:"number",min:"1",value:f,onChange:M=>y(M.target.value),onBlur:P,className:"w-16 h-8 text-center"})]})]}),e.jsx(dr,{onDragEnd:M=>m(M,s),children:e.jsx(mr,{droppableId:`options-${s.id}`,children:M=>e.jsxs("div",{...M.droppableProps,ref:M.innerRef,className:"space-y-2",children:[(s.options||[]).map((O,E)=>e.jsx(ur,{draggableId:O.id,index:E,children:(u,_)=>e.jsx(M0,{option:O,group:s,optionIndex:E,provided:u,snapshot:_,onUpdate:o,onToggle:d,onRemove:i,canEdit:p})},O.id)),M.placeholder]})})}),e.jsx("button",{onClick:()=>c(s),className:"w-full mt-3 py-2 border-2 border-dashed border-orange-300 rounded-lg text-orange-500 hover:bg-orange-50 text-sm font-medium",children:"+ Adicionar Opo"})]})}function P0(){const[s,a]=ae.useState(null),[t,r]=b.useState(!1),[n,l]=b.useState(""),[c,d]=b.useState("all"),[i,o]=b.useState({name:"",is_required:!0,max_selection:1}),m=ts();ae.useEffect(()=>{(async()=>{try{const N=await se.auth.me();a(N)}catch(N){console.error("Error loading user:",N)}})()},[]);const{menuContext:p}=as(),{data:x=[]}=ke({queryKey:["complementGroups",p?.type,p?.value],queryFn:async()=>{if(!p)return[];try{const T={};p.type==="subscriber"&&p.value&&(T.as_subscriber=p.value);const N=await se.entities.ComplementGroup.list("order",T);return Array.isArray(N)?N:[]}catch(T){return console.error("Erro ao buscar grupos:",T),[]}},enabled:!!p,initialData:[],refetchOnMount:"always"}),{data:g=[]}=_r(),f=b.useMemo(()=>Array.isArray(x)?x.filter(N=>{const z=!n||N.name?.toLowerCase().includes(n.toLowerCase())||(N.options||[]).some(h=>h.name?.toLowerCase().includes(n.toLowerCase())),k=c==="all"||c==="required"&&N.is_required||c==="optional"&&!N.is_required;return z&&k}):[],[x,n,c]),y=b.useMemo(()=>{const T=Array.isArray(x)?x:[],N=Array.isArray(g)?g:[],z=T.length,k=T.reduce((S,q)=>S+(q.options?.length||0),0),h=T.reduce((S,q)=>S+(q.options?.filter(J=>J.is_active!==!1).length||0),0),F=T.filter(S=>N.some(q=>q.complement_groups?.some(J=>J.group_id===S.id))).length;return{totalGroups:z,totalOptions:k,activeOptions:h,groupsInUse:F}},[x,g]),v=de({mutationFn:async T=>{const N={...T,owner_email:s?.subscriber_email||s?.email};return se.entities.ComplementGroup.create(N)},onSuccess:()=>{m.invalidateQueries({queryKey:["complementGroups"]}),r(!1),o({name:"",is_required:!0,max_selection:1}),K.success(" Grupo criado!")}}),P=de({mutationFn:({id:T,data:N})=>se.entities.ComplementGroup.update(T,N),onSuccess:()=>{m.invalidateQueries({queryKey:["complementGroups"]}),K.success(" Salvo!")}}),M=de({mutationFn:T=>se.entities.ComplementGroup.delete(T),onSuccess:()=>m.invalidateQueries({queryKey:["complementGroups"]})}),O=T=>{T.preventDefault(),v.mutate({...i,options:[],order:x.length})},E=async T=>{if(!V||!T.destination||T.source.index===T.destination.index)return;const N=Array.from(x),[z]=N.splice(T.source.index,1);N.splice(T.destination.index,0,z),m.setQueryData(["complementGroups"],N.map((h,F)=>({...h,order:F})));const k=N.map((h,F)=>se.entities.ComplementGroup.update(h.id,{order:F}));try{await Promise.all(k),m.invalidateQueries({queryKey:["complementGroups"]}),K.success(" Ordem atualizada!")}catch(h){console.error("Erro ao reordenar grupos:",h),m.invalidateQueries({queryKey:["complementGroups"]})}},u=(T,N)=>{if(!T.destination)return;const z=Array.from(N.options||[]),[k]=z.splice(T.source.index,1);z.splice(T.destination.index,0,k),P.mutate({id:N.id,data:{options:z}})},_=T=>{const N=prompt("Nome da opo:");if(!N)return;const z=parseFloat(prompt("Preo (0 para grtis):","0"))||0,k={id:Date.now().toString(),name:N,price:z,is_active:!0};P.mutate({id:T.id,data:{options:[...T.options||[],k]}})},$=(T,N)=>{const z=(T.options||[]).map(k=>k.id===N?{...k,is_active:!k.is_active}:k);P.mutate({id:T.id,data:{options:z}})},j=(T,N)=>{if(!confirm("Remover esta opo?"))return;const z=(T.options||[]).filter(k=>k.id!==N);P.mutate({id:T.id,data:{options:z}})},D=(T,N,z,k)=>{const h=(T.options||[]).map(F=>F.id===N?{...F,[z]:k}:F);P.mutate({id:T.id,data:{options:h}})},V=s?.is_master||s?.can_edit;return e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(Q,{children:e.jsx(Z,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Grupos"}),e.jsx("p",{className:"text-2xl font-bold",children:y.totalGroups})]}),e.jsx(Ss,{className:"w-8 h-8 text-gray-500"})]})})}),e.jsx(Q,{children:e.jsx(Z,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Opes"}),e.jsx("p",{className:"text-2xl font-bold",children:y.totalOptions})]}),e.jsx(Ss,{className:"w-8 h-8 text-blue-500"})]})})}),e.jsx(Q,{children:e.jsx(Z,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Ativas"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:y.activeOptions})]}),e.jsx(Ss,{className:"w-8 h-8 text-green-500"})]})})}),e.jsx(Q,{children:e.jsx(Z,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Em Uso"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:y.groupsInUse})]}),e.jsx(Ss,{className:"w-8 h-8 text-orange-500"})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ms,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(B,{placeholder:"Buscar grupo ou opo...",value:n,onChange:T=>l(T.target.value),className:"pl-10"})]}),e.jsxs(Se,{value:c,onValueChange:d,children:[e.jsxs(De,{className:"w-[180px]",children:[e.jsx(ua,{className:"w-4 h-4 mr-2"}),e.jsx(Me,{})]}),e.jsxs(Ae,{children:[e.jsx(X,{value:"all",children:"Todos"}),e.jsx(X,{value:"required",children:"Obrigatrios"}),e.jsx(X,{value:"optional",children:"Opcionais"})]})]}),e.jsxs(A,{onClick:()=>r(!0),className:"bg-gray-800 hover:bg-gray-900",children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Criar Novo Grupo"]})]}),e.jsx(dr,{onDragEnd:E,children:e.jsx(mr,{droppableId:"groups",children:T=>e.jsxs("div",{...T.droppableProps,ref:T.innerRef,className:"grid gap-6",children:[f.length===0?e.jsx("div",{className:"text-center py-12 text-gray-400 border-2 border-dashed rounded-xl",children:n||c!=="all"?"Nenhum grupo encontrado com os filtros aplicados":"Nenhum grupo de complementos cadastrado ainda."}):f.map((N,z)=>{const k=x.findIndex(h=>h.id===N.id);return e.jsx(ur,{draggableId:N.id,index:z,children:(h,F)=>e.jsx(A0,{group:N,groupIndex:k,provided:h,snapshot:F,updateMutation:P,deleteMutation:M,onAddOption:_,onToggleOption:$,onRemoveOption:j,onUpdateOption:D,onDragEndOptions:u,canEdit:V})},N.id)}),T.placeholder]})})}),e.jsx(Re,{open:t,onOpenChange:r,children:e.jsxs(Le,{className:"sm:max-w-sm max-w-[95vw]",children:[e.jsx(Ie,{children:e.jsx(qe,{children:"Criar Novo Grupo"})}),e.jsxs("form",{onSubmit:O,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome do Grupo"}),e.jsx(B,{value:i.name,onChange:T=>o(N=>({...N,name:T.target.value})),placeholder:"Ex: Arroz, Feijo, Guarnies...",required:!0})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx(mt,{checked:i.is_required,onCheckedChange:T=>o(N=>({...N,is_required:T}))}),e.jsx("span",{children:"Obrigatrio"})]})}),e.jsxs("div",{children:[e.jsx(R,{children:"Mximo de selees"}),e.jsx(B,{type:"number",min:"1",value:i.max_selection,onChange:T=>o(N=>({...N,max_selection:parseInt(T.target.value)||1}))})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(A,{type:"button",variant:"outline",onClick:()=>r(!1),className:"flex-1",children:"Cancelar"}),e.jsx(A,{type:"submit",className:"flex-1 bg-gray-800 hover:bg-gray-900",children:"Criar Grupo"})]})]})]})})]})}function fo({dish:s,onEdit:a,onDuplicate:t,onDelete:r,onToggleActive:n,onToggleHighlight:l,onToggleComplements:c,complementGroupsCount:d=0,formatCurrency:i,canEdit:o=!0}){const m=s.stock!==null&&s.stock!==void 0&&s.stock<=0,p=s.original_price&&s.original_price>s.price;return e.jsx("div",{className:"bg-white rounded-2xl overflow-hidden shadow-sm border border-gray-100 active:scale-[0.98] transition-transform",children:e.jsxs("div",{className:"flex items-center gap-3 p-3",children:[e.jsxs("div",{className:"relative w-20 h-20 flex-shrink-0 rounded-xl overflow-hidden bg-gray-100",children:[s.image?e.jsx("img",{src:s.image,alt:s.name,className:"w-full h-full object-cover",loading:"lazy"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-300 text-2xl",children:""}),m&&e.jsx("div",{className:"absolute inset-0 bg-red-500/90 flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"Esgotado"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-sm leading-tight line-clamp-1 flex-1",children:s.name}),e.jsx("button",{onClick:x=>{x.stopPropagation(),o&&l(!s.is_highlight)},disabled:!o,className:`p-1.5 rounded-lg transition-colors flex-shrink-0 disabled:opacity-50 ${s.is_highlight?"bg-amber-100 text-amber-600":"bg-gray-100 text-gray-400 hover:bg-gray-200"}`,children:e.jsx(Fs,{className:`w-4 h-4 ${s.is_highlight?"fill-amber-600":""}`})})]}),s.description&&e.jsx("p",{className:"text-xs text-gray-500 line-clamp-1 mb-2",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[p&&e.jsx("span",{className:"text-xs text-gray-400 line-through block",children:i(s.original_price)}),e.jsx("span",{className:`font-bold text-base ${p?"text-green-600":"text-gray-900"}`,children:i(s.price)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{checked:s.is_active!==!1,onCheckedChange:x=>{o&&n(x)},disabled:!o,className:"data-[state=checked]:bg-green-500"}),e.jsxs(xt,{children:[e.jsx(pt,{asChild:!0,children:e.jsx("button",{className:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-100 active:bg-gray-200 transition-colors",children:e.jsx(jr,{className:"w-4 h-4 text-gray-600"})})}),e.jsxs(gt,{align:"end",className:"w-48",children:[e.jsxs(ps,{onClick:a,children:[e.jsx(qs,{className:"w-4 h-4 mr-2"}),"Editar"]}),e.jsxs(ps,{onClick:t,children:[e.jsx(Js,{className:"w-4 h-4 mr-2"}),"Duplicar"]}),e.jsxs(ps,{onClick:r,className:"text-red-600",children:[e.jsx(Xe,{className:"w-4 h-4 mr-2"}),"Excluir"]})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1.5",children:[(s.portion||s.prep_time)&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[s.portion&&e.jsx("span",{children:s.portion}),s.prep_time&&e.jsxs("span",{children:[" ",s.prep_time,"min"]})]}),c&&e.jsxs("button",{onClick:c,className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg bg-gray-100 hover:bg-gray-200 active:bg-gray-300 transition-colors ml-auto",children:[e.jsx(Ss,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:d})]})]})]})]})})}function jo({category:s,dishCount:a,isExpanded:t,onToggle:r,onAddDish:n,onEdit:l,onDuplicate:c,onDelete:d,children:i}){return e.jsxs("div",{className:"bg-white rounded-2xl overflow-hidden shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"w-full flex items-center justify-between p-4 active:bg-gray-50 transition-colors",children:[e.jsxs("button",{onClick:r,className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-orange-100 to-orange-50 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-lg",children:""})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("h3",{className:"font-bold text-base text-gray-900 truncate",children:s.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[a," ",a===1?"item":"itens"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs(xt,{children:[e.jsx(pt,{asChild:!0,onClick:o=>o.stopPropagation(),children:e.jsx("button",{className:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-100 active:bg-gray-200 transition-colors",children:e.jsx(jr,{className:"w-4 h-4 text-gray-600"})})}),e.jsxs(gt,{align:"end",className:"w-48",children:[e.jsxs(ps,{onClick:n,children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Adicionar prato"]}),e.jsxs(ps,{onClick:l,children:[e.jsx(qs,{className:"w-4 h-4 mr-2"}),"Editar categoria"]}),e.jsxs(ps,{onClick:c,children:[e.jsx(Js,{className:"w-4 h-4 mr-2"}),"Duplicar categoria"]}),e.jsxs(ps,{onClick:d,className:"text-red-600",children:[e.jsx(Xe,{className:"w-4 h-4 mr-2"}),"Excluir categoria"]})]})]}),e.jsx("button",{onClick:r,className:"flex items-center justify-center",children:e.jsx(Qe.div,{animate:{rotate:t?180:0},transition:{duration:.2},children:e.jsx(La,{className:"w-5 h-5 text-gray-400"})})})]})]}),e.jsx(ht,{children:t&&e.jsx(Qe.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:e.jsx("div",{className:"p-3 pt-0 space-y-2",children:i})})})]})}function E0({onAddDish:s,onAddCategory:a,onAddCombo:t}){const[r,n]=b.useState(!1),l=[{icon:na,label:"Novo Prato",onClick:()=>{s?.(),n(!1)},color:"bg-orange-500"},{icon:en,label:"Nova Categoria",onClick:()=>{a?.(),n(!1)},color:"bg-blue-500"},...t?[{icon:tr,label:"Novo Combo",onClick:()=>{t(),n(!1)},color:"bg-purple-500"}]:[]];return e.jsxs(e.Fragment,{children:[e.jsx(ht,{children:r&&e.jsx(Qe.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/40 z-40",onClick:()=>n(!1)})}),e.jsxs("div",{className:"fixed bottom-6 right-6 z-50",children:[e.jsx(ht,{children:r&&e.jsx(Qe.div,{className:"flex flex-col-reverse gap-3 mb-3",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},children:l.map((c,d)=>e.jsxs(Qe.button,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{delay:d*.05},onClick:c.onClick,className:`${c.color} text-white shadow-lg rounded-full flex items-center gap-3 pr-5 pl-4 py-3 active:scale-95 transition-transform`,children:[e.jsx(c.icon,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium text-sm whitespace-nowrap",children:c.label})]},c.label))})}),e.jsx(Qe.button,{whileTap:{scale:.9},onClick:()=>n(!r),className:`w-14 h-14 rounded-full shadow-lg flex items-center justify-center transition-all ${r?"bg-gray-800 rotate-45":"bg-gradient-to-br from-orange-500 to-orange-600"}`,children:e.jsx($e,{className:"w-6 h-6 text-white"})})]})]})}function O0({filters:s,onRemoveFilter:a,onClearAll:t}){return s.length===0?null:e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto scrollbar-hide pb-2",children:[s.map((r,n)=>e.jsxs(Qe.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{delay:n*.05},className:"flex items-center gap-1.5 bg-orange-100 text-orange-700 px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap flex-shrink-0",children:[e.jsx("span",{children:r.label}),e.jsx("button",{onClick:()=>a(r.key),className:"w-4 h-4 flex items-center justify-center rounded-full hover:bg-orange-200 transition-colors",children:e.jsx(Ds,{className:"w-3 h-3"})})]},r.key)),s.length>1&&e.jsx("button",{onClick:t,className:"text-xs text-gray-500 px-3 py-1.5 hover:text-gray-700 whitespace-nowrap flex-shrink-0",children:"Limpar tudo"})]})}function z0({isOpen:s,onClose:a,title:t,children:r}){return e.jsx(ht,{children:s&&e.jsxs(e.Fragment,{children:[e.jsx(Qe.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50",onClick:a}),e.jsxs(Qe.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:30,stiffness:300},className:"fixed inset-x-0 bottom-0 z-50 bg-white rounded-t-3xl shadow-2xl max-h-[85vh] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"flex justify-center pt-3 pb-2",children:e.jsx("div",{className:"w-10 h-1 bg-gray-300 rounded-full"})}),e.jsxs("div",{className:"flex items-center justify-between px-6 py-3 border-b border-gray-100",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:t}),e.jsx("button",{onClick:a,className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 active:bg-gray-200 transition-colors",children:e.jsx(Ds,{className:"w-5 h-5 text-gray-600"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:r})]})]})})}function T0({isOpen:s,onClose:a,availableGroups:t,onConfirm:r,currentDish:n=null}){const[l,c]=b.useState(""),[d,i]=b.useState([]);n?.complement_groups?n.complement_groups.map(f=>f.group_id):[];const m=t.filter(f=>f.name?.toLowerCase().includes(l.toLowerCase())),p=f=>{i(y=>y.includes(f)?y.filter(v=>v!==f):[...y,f])},x=()=>{r(d),i([]),c(""),a()},g=()=>{i([]),c(""),a()};return s?e.jsx(ht,{children:e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx(Qe.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:g,className:"absolute inset-0 bg-black/50"}),e.jsxs(Qe.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"relative w-full max-w-md bg-white rounded-2xl shadow-xl overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Copiar grupo"}),e.jsx("button",{onClick:g,className:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(Ds,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Selecione um ou mais grupos para reutilizar"})]}),e.jsx("div",{className:"px-6 py-4 border-b border-gray-100",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ms,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(B,{placeholder:"Buscar grupos de complementos",value:l,onChange:f=>c(f.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"px-6 py-4 max-h-96 overflow-y-auto",children:m.length===0?e.jsx("div",{className:"text-center py-8 text-gray-400",children:e.jsx("p",{className:"text-sm",children:"Nenhum grupo encontrado"})}):e.jsx("div",{className:"space-y-2",children:m.map(f=>{const y=d.includes(f.id),v=f.options?.length||0;return e.jsx("button",{onClick:()=>p(f.id),className:`w-full p-4 rounded-xl border-2 transition-all text-left ${y?"border-orange-500 bg-orange-50":"border-gray-200 bg-white hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center flex-shrink-0 mt-0.5 transition-colors ${y?"border-orange-500 bg-orange-500":"border-gray-300"}`,children:y&&e.jsx(ia,{className:"w-3 h-3 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm text-gray-900 mb-1",children:f.name}),e.jsx("p",{className:"text-xs text-gray-500",children:"Grupo disponvel para uso"})]}),e.jsxs(ye,{variant:"outline",className:"text-xs flex-shrink-0",children:[v," ",v===1?"opo":"opes"]})]})},f.id)})})}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-100 bg-gray-50",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:d.length===0?"Nenhum grupo selecionado":`${d.length} ${d.length===1?"grupo selecionado":"grupos selecionados"}`}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(A,{variant:"outline",onClick:g,className:"flex-1",children:"Voltar"}),e.jsx(A,{onClick:x,disabled:d.length===0,className:"flex-1 bg-orange-500 hover:bg-orange-600 disabled:opacity-50",children:"Confirmar"})]})]})]})]})}):null}function F0({option:s,groupId:a,onToggle:t,onRemove:r,onUpdateName:n,onUpdatePrice:l,onUpdateImage:c,formatCurrency:d}){const[i,o]=b.useState(!1),[m,p]=b.useState(!1),[x,g]=b.useState(s.name),[f,y]=b.useState(s.price?.toString()||"0"),v=()=>{x.trim()&&n(a,s.id,x),o(!1)},P=()=>{l(a,s.id,f),p(!1)};return e.jsxs("div",{className:`flex items-center gap-3 p-2 rounded-xl ${s.is_active!==!1?"bg-white":"bg-red-50"}`,children:[e.jsxs("label",{className:"cursor-pointer relative",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg overflow-hidden bg-gray-100 flex-shrink-0",children:s.image?e.jsx("img",{src:s.image,alt:s.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-300 text-xs",children:""})}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:M=>{const O=M.target.files?.[0];O&&c(a,s.id,O)}})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[i?e.jsx("input",{type:"text",value:x,onChange:M=>g(M.target.value),onBlur:v,onKeyDown:M=>{M.key==="Enter"&&v(),M.key==="Escape"&&o(!1)},className:"font-medium text-sm text-gray-900 w-full border rounded px-2 py-1",autoFocus:!0}):e.jsx("p",{className:"font-medium text-sm text-gray-900 truncate cursor-pointer hover:text-orange-600",onClick:()=>{g(s.name),o(!0)},children:s.name}),m?e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:f,onChange:M=>y(M.target.value),onBlur:P,onKeyDown:M=>{M.key==="Enter"&&P(),M.key==="Escape"&&p(!1)},className:"text-xs text-gray-500 w-20 border rounded px-1 py-0.5",autoFocus:!0})]}):e.jsx("p",{className:"text-xs text-gray-500 cursor-pointer hover:text-orange-600",onClick:()=>{y(s.price?.toString()||"0"),p(!0)},children:s.price>0?`+ ${d(s.price)}`:"Sem custo (clique para editar)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ve,{checked:s.is_active!==!1,onCheckedChange:()=>t(a,s.id,s.is_active!==!1),className:"data-[state=checked]:bg-green-500"}),e.jsx("button",{onClick:()=>{confirm("Remover este complemento?")&&r(a,s.id)},className:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-red-100 active:bg-red-200 transition-colors",children:e.jsx(Xe,{className:"w-4 h-4 text-red-600"})})]})]})}function R0({isOpen:s,onClose:a,dish:t,complementGroups:r,onAddOption:n,onToggleOption:l,onRemoveOption:c,onEditGroup:d,onRemoveGroup:i,onAddGroup:o,onReuseGroup:m,onToggleRequired:p,onUpdateOptionName:x,onUpdateOptionPrice:g,onUpdateOptionImage:f,onReorderGroups:y,onCopyGroups:v,formatCurrency:P}){const[M,O]=b.useState(!1),[E,u]=b.useState(!1),_=(t?.complement_groups||[]).map(j=>r.find(D=>D.id===j.group_id)).filter(Boolean);r.filter(j=>!t?.complement_groups?.some(D=>D.group_id===j.id));const $=j=>{if(!j.destination||j.source.index===j.destination.index)return;const D=Array.from(t.complement_groups||[]),[V]=D.splice(j.source.index,1);D.splice(j.destination.index,0,V),y(D)};return e.jsxs(ht,{children:[s&&e.jsxs(e.Fragment,{children:[e.jsx(Qe.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50",onClick:a}),e.jsxs(Qe.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:30,stiffness:300},className:"fixed inset-x-0 bottom-0 z-50 bg-white rounded-t-3xl shadow-2xl max-h-[85vh] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"flex justify-center pt-3 pb-2",children:e.jsx("div",{className:"w-10 h-1 bg-gray-300 rounded-full"})}),e.jsx("div",{className:"px-6 py-3 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Complementos"}),e.jsx("p",{className:"text-sm text-gray-500",children:t?.name})]}),e.jsx("button",{onClick:a,className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 active:bg-gray-200 transition-colors",children:e.jsx(Ds,{className:"w-5 h-5 text-gray-600"})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[_.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx($e,{className:"w-8 h-8 text-gray-400"})}),e.jsx("p",{className:"text-gray-500 text-sm mb-4",children:"Nenhum grupo de complementos"}),e.jsxs(A,{onClick:()=>o(t?.id),className:"bg-orange-500",children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Adicionar Grupo"]})]}):e.jsx(dr,{onDragEnd:$,children:e.jsx(mr,{droppableId:"mobile-complement-groups",children:j=>e.jsxs("div",{...j.droppableProps,ref:j.innerRef,className:"space-y-4",children:[_.map((D,V)=>{const T=t.complement_groups?.find(N=>N.group_id===D.id);return e.jsx(ur,{draggableId:D.id,index:V,children:(N,z)=>e.jsxs("div",{ref:N.innerRef,...N.draggableProps,className:`rounded-2xl p-4 border-2 transition-shadow ${z.isDragging?"shadow-lg":""} ${T?.is_required?"bg-red-50 border-red-200":"bg-blue-50 border-blue-200"}`,children:[e.jsxs("div",{className:"flex items-start gap-2 mb-3",children:[e.jsx("div",{...N.dragHandleProps,className:"pt-1",children:e.jsx(cr,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-bold text-sm text-gray-900",children:D.name}),e.jsx(ye,{className:`text-xs ${T?.is_required?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700"}`,children:T?.is_required?"Obrigatrio":"Opcional"})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Mximo: ",D.max_selection||1," ",D.max_selection===1?"opo":"opes"]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>d(D),className:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-200 active:bg-gray-300 transition-colors",children:e.jsx(ut,{className:"w-4 h-4 text-gray-600"})}),e.jsx("button",{onClick:()=>i(D.id),className:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-red-100 active:bg-red-200 transition-colors",children:e.jsx(Xe,{className:"w-4 h-4 text-red-600"})})]})]}),e.jsx("div",{className:"space-y-2",children:(D.options||[]).map(k=>e.jsx(F0,{option:k,groupId:D.id,onToggle:l,onRemove:c,onUpdateName:x,onUpdatePrice:g,onUpdateImage:f,formatCurrency:P},k.id))}),e.jsxs(A,{onClick:()=>n(D.id),variant:"outline",size:"sm",className:"w-full mt-3",children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Adicionar opo"]})]})},D.id)}),j.placeholder]})})}),_.length>0&&e.jsx("div",{className:"mt-4",children:e.jsxs(xt,{open:M,onOpenChange:O,children:[e.jsx(pt,{asChild:!0,children:e.jsxs(A,{variant:"outline",className:"w-full",children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Adicionar Grupo de Complementos"]})}),e.jsxs(gt,{className:"w-full",align:"center",children:[e.jsxs(ps,{onClick:()=>{o(t?.id),O(!1)},children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Criar novo grupo"]}),r.length>0&&e.jsxs(ps,{onClick:()=>{u(!0),O(!1)},children:[e.jsx(Js,{className:"w-4 h-4 mr-2"}),"Copiar grupo de complementos"]})]})]})})]})]})]}),e.jsx(T0,{isOpen:E,onClose:()=>u(!1),availableGroups:r,onConfirm:v,currentDish:t})]})}function Rr({icon:s,title:a,description:t,actionLabel:r,onAction:n}){return e.jsxs(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-gray-100 to-gray-200 rounded-full flex items-center justify-center mb-6",children:e.jsx(s,{className:"w-12 h-12 text-gray-400"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2 text-center",children:a}),t&&e.jsx("p",{className:"text-gray-500 text-center mb-6 max-w-md",children:t}),r&&n&&e.jsx(A,{onClick:n,className:"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700",children:r})]})}function L0(){return e.jsxs("div",{className:"px-6 pb-6 space-y-4",children:[e.jsxs("div",{className:"flex gap-3 mb-6 animate-pulse",children:[e.jsx("div",{className:"w-32 h-10 bg-gray-200 rounded"}),e.jsx("div",{className:"w-32 h-10 bg-gray-200 rounded"}),e.jsx("div",{className:"w-32 h-10 bg-gray-200 rounded"})]}),e.jsx("div",{className:"bg-white rounded-xl p-4 mb-6 animate-pulse",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"h-10 bg-gray-200 rounded"}),e.jsx("div",{className:"h-10 bg-gray-200 rounded"}),e.jsx("div",{className:"h-10 bg-gray-200 rounded"}),e.jsx("div",{className:"h-10 bg-gray-200 rounded"})]})}),[1,2,3].map(s=>e.jsxs(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:s*.1},className:"bg-gray-50 rounded-xl overflow-hidden animate-pulse",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded"}),e.jsx("div",{className:"w-32 h-6 bg-gray-200 rounded"}),e.jsx("div",{className:"w-16 h-5 bg-gray-200 rounded-full"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-32 h-9 bg-gray-200 rounded"}),e.jsx("div",{className:"w-9 h-9 bg-gray-200 rounded"})]})]}),e.jsx("div",{className:"p-4 space-y-3",children:[1,2].map(a=>e.jsx("div",{className:"bg-white border rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"w-40 h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"w-full h-3 bg-gray-200 rounded"}),e.jsx("div",{className:"w-24 h-3 bg-gray-200 rounded"})]}),e.jsx("div",{className:"w-20 h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"w-10 h-6 bg-gray-200 rounded-full"})]})},a))})]},s))]})}function yo({dish:s,complementGroups:a,expanded:t,onToggleExpand:r,onEdit:n,onDelete:l,onDuplicate:c,onUpdate:d,onToggleOption:i,onUpdateOptionName:o,onUpdateOptionImage:m,onUpdateOptionPrice:p,onRemoveOption:x,onAddOption:g,onAddGroup:f,onReuseGroup:y,onRemoveGroup:v,onOpenReuseModal:P,allComplementGroups:M,allDishes:O,onEditGroup:E,getGroupUsageInfo:u,formatCurrency:_,updateDishMutation:$,updateComplementGroupMutation:j,createComplementGroupMutation:D,isSelected:V,onToggleSelection:T,canEdit:N,canCreate:z,canDelete:k,setBulkEditGroup:h,setShowBulkEditModal:F}){const[S,q]=b.useState(null),[J,W]=b.useState(""),[C,Y]=b.useState(null),[L,oe]=b.useState(""),[Pe,ve]=b.useState(null),[G,ne]=b.useState(!1),[fe,ge]=b.useState(!1),[Ee,H]=b.useState(""),[ie,me]=b.useState(""),ze=Array.isArray(a)?a:[],Je=(s.complement_groups||[]).map(U=>ze.find(re=>re.id===U.group_id)).filter(Boolean),ce=s.stock!==null&&s.stock!==void 0&&s.stock!==""&&s.stock<=0,We=s.original_price&&s.original_price>s.price;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:`bg-white border rounded-lg overflow-hidden hover:shadow-sm transition-shadow ${V?"ring-2 ring-blue-500":""}`,children:[e.jsxs("div",{className:"flex items-center gap-3 p-3",children:[e.jsx("input",{type:"checkbox",checked:V,onChange:T,className:"w-4 h-4 rounded",onClick:U=>U.stopPropagation()}),e.jsxs("div",{className:"w-16 h-16 flex-shrink-0 bg-gray-100 rounded overflow-hidden relative",children:[s.image?e.jsx("img",{src:s.image,alt:s.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400 text-xs",children:"Sem foto"}),ce&&e.jsx("div",{className:"absolute inset-0 bg-red-500/80 flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"Esgotado"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start gap-2 mb-1",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("h3",{className:"font-medium text-sm",children:[s.name," ",s.portion&&e.jsxs("span",{className:"text-gray-400",children:["(",s.portion,")"]})]}),s.is_new&&e.jsx(ye,{variant:"outline",className:"text-xs bg-green-50 text-green-700",children:" Novo"}),s.is_popular&&e.jsx(ye,{variant:"outline",className:"text-xs bg-purple-50 text-purple-700",children:" Popular"})]}),e.jsx("p",{className:"text-xs text-gray-500 line-clamp-1",children:s.description}),s.tags&&s.tags.length>0&&e.jsxs("div",{className:"flex gap-1 mt-1",children:[s.tags.slice(0,3).map(U=>e.jsx("span",{className:"text-xs px-1 py-0.5 bg-gray-100 rounded",children:U},U)),s.tags.length>3&&e.jsxs("span",{className:"text-xs text-gray-400",children:["+",s.tags.length-3]})]}),s.internal_notes&&e.jsxs("p",{className:"text-xs text-orange-600 mt-1",children:[" ",s.internal_notes]})]}),e.jsx(ye,{className:`text-xs ${N?"cursor-pointer hover:bg-yellow-200":"cursor-default"} transition-all ${s.is_highlight?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-500"}`,onClick:U=>{U.stopPropagation(),N&&d({is_highlight:!s.is_highlight})},children:s.is_highlight?" Destaque":"Destaque"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[s.stock!==null&&s.stock!==void 0&&s.stock!==""&&e.jsxs("span",{children:["Estoque: ",s.stock]}),(s.stock===null||s.stock===void 0||s.stock==="")&&e.jsx("span",{className:"text-green-600",children:"Estoque: Ilimitado"}),s.prep_time&&e.jsxs("span",{children:[" ",s.prep_time,"min"]})]})]}),e.jsxs("button",{onClick:r,className:"flex items-center gap-1 px-2 sm:px-3 py-1.5 text-sm border rounded hover:bg-gray-50",children:[e.jsx(et,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline text-xs",children:"Complementos"}),e.jsx(ye,{variant:"outline",className:"text-xs",children:Je.length}),t?e.jsx(Ot,{className:"w-4 h-4"}):e.jsx(La,{className:"w-4 h-4"})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[We&&e.jsx("span",{className:"text-xs text-gray-400 line-through",children:_(s.original_price)}),G?e.jsx(B,{type:"number",step:"0.01",value:Ee,onChange:U=>H(U.target.value),onBlur:()=>{d({price:parseFloat(Ee)||s.price}),ne(!1)},onKeyDown:U=>{U.key==="Enter"&&(d({price:parseFloat(Ee)||s.price}),ne(!1)),U.key==="Escape"&&ne(!1)},className:"h-7 w-24 text-sm",autoFocus:!0}):e.jsx("span",{className:`font-semibold text-sm whitespace-nowrap ${N?"cursor-pointer hover:bg-gray-100":""} px-2 py-1 rounded ${We?"text-green-600":""}`,onClick:()=>{N&&(H(s.price?.toString()||"0"),ne(!0))},title:N?"Clique para editar":"",children:_(s.price)}),s.stock!==null&&s.stock!==void 0&&s.stock!==""&&(fe?e.jsx(B,{type:"number",value:ie,onChange:U=>me(U.target.value),onBlur:()=>{d({stock:parseFloat(ie)||0}),ge(!1)},onKeyDown:U=>{U.key==="Enter"&&(d({stock:parseFloat(ie)||0}),ge(!1)),U.key==="Escape"&&ge(!1)},className:"h-6 w-20 text-xs",autoFocus:!0}):e.jsxs("span",{className:`text-xs text-gray-500 ${N?"cursor-pointer hover:bg-gray-100":""} px-2 py-0.5 rounded`,onClick:()=>{N&&(me(s.stock?.toString()||"0"),ge(!0))},title:N?"Clique para editar estoque":"",children:["Est: ",s.stock]}))]}),e.jsx(Ve,{checked:s.is_active!==!1,onCheckedChange:U=>{N&&d({is_active:U})},disabled:!N}),e.jsxs(xt,{children:[e.jsx(pt,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(jr,{className:"w-4 h-4"})})}),e.jsxs(gt,{align:"end",children:[N&&e.jsxs(ps,{onClick:n,children:[e.jsx(qs,{className:"w-4 h-4 mr-2"}),"Editar item"]}),z&&e.jsxs(ps,{onClick:c,children:[e.jsx(tc,{className:"w-4 h-4 mr-2"}),"Duplicar item"]}),(N||z||k)&&e.jsx(Ni,{}),k&&e.jsxs(ps,{onClick:()=>confirm("Excluir?")&&l(),className:"text-red-600",children:[e.jsx(Xe,{className:"w-4 h-4 mr-2"}),"Remover item"]})]})]})]}),t&&e.jsxs("div",{className:"border-t bg-gray-50 p-4 space-y-3",children:[e.jsx(dr,{onDragEnd:U=>{if(!N||!U.destination||U.source.index===U.destination.index)return;const re=Array.from(s.complement_groups||[]),[ds]=re.splice(U.source.index,1);re.splice(U.destination.index,0,ds),$.mutate({id:s.id,data:{complement_groups:re}})},children:e.jsx(mr,{droppableId:`dish-groups-${s.id}`,children:U=>e.jsxs("div",{...U.droppableProps,ref:U.innerRef,className:"space-y-3",children:[Je.map((re,ds)=>{const ta=s.complement_groups?.find(zs=>zs.group_id===re.id),ls=u(re.id).firstDishId===s.id;return e.jsx(ur,{draggableId:`group-${s.id}-${re.id}`,index:ds,children:(zs,bs)=>e.jsxs("div",{ref:zs.innerRef,...zs.draggableProps,className:`bg-white rounded-lg p-3 border transition-all ${bs.isDragging?"shadow-lg ring-2 ring-orange-500":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[N&&e.jsx("div",{...zs.dragHandleProps,className:"cursor-grab active:cursor-grabbing",children:e.jsx(cr,{className:"w-5 h-5 text-gray-400"})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-sm",children:re.name}),e.jsx(ye,{variant:"outline",className:`text-xs ${N?"cursor-pointer hover:bg-red-200":"cursor-default"} transition-colors ${ta?.is_required?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"}`,onClick:Ge=>{if(!N)return;Ge.stopPropagation();const we=(s.complement_groups||[]).map(ms=>ms.group_id===re.id?{...ms,is_required:!ta?.is_required}:ms);$.mutate({id:s.id,data:{complement_groups:we}})},children:ta?.is_required?" Obrigatrio":"Opcional"}),ls?e.jsx(ye,{variant:"outline",className:"text-xs bg-green-50 text-green-700",children:"Original"}):e.jsx(ye,{variant:"outline",className:"text-xs bg-blue-50 text-blue-700",children:"Reutilizado"})]})}),e.jsxs("div",{className:"flex gap-1",children:[N&&e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>E(re),title:"Configuraes",children:e.jsx(ut,{className:"w-4 h-4"})}),N&&e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>{h(re),F(!0)},title:"Edio em massa",children:e.jsx(Lt,{className:"w-4 h-4"})}),z&&e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>g(re.id),title:"Adicionar opo",children:e.jsx($e,{className:"w-4 h-4"})}),z&&e.jsx(A,{variant:"ghost",size:"sm",onClick:async()=>{const Ge={name:`${re.name} (Cpia)`,is_required:re.is_required,max_selection:re.max_selection,options:re.options||[],order:M.length};await D.mutateAsync(Ge)},title:"Duplicar grupo",children:e.jsx(Js,{className:"w-4 h-4"})}),k&&e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>v(re.id),className:"text-red-500 hover:text-red-700",title:"Remover grupo",children:e.jsx(Xe,{className:"w-4 h-4"})})]})]}),e.jsx(dr,{onDragEnd:Ge=>{if(!N||!Ge.destination)return;const we=Array.from(re.options||[]),[ms]=we.splice(Ge.source.index,1);we.splice(Ge.destination.index,0,ms),j.mutate({id:re.id,data:{...re,options:we}})},children:e.jsx(mr,{droppableId:`options-${re.id}`,children:Ge=>e.jsxs("div",{...Ge.droppableProps,ref:Ge.innerRef,className:"space-y-2",children:[(re.options||[]).map((we,ms)=>e.jsx(ur,{draggableId:we.id,index:ms,children:(Da,Rn)=>e.jsxs("div",{ref:Da.innerRef,...Da.draggableProps,...Da.dragHandleProps,className:`flex items-center gap-3 p-2 rounded transition-all ${Rn.isDragging?"shadow-lg":""} ${we.is_active!==!1?"bg-white":"bg-red-50"}`,children:[N&&e.jsx(cr,{className:"w-4 h-4 text-gray-400 flex-shrink-0 cursor-grab active:cursor-grabbing"}),N?e.jsxs("label",{className:"cursor-pointer relative",children:[we.image?e.jsx("img",{src:we.image,alt:we.name,className:"w-12 h-12 rounded object-cover"}):e.jsx("div",{className:"w-12 h-12 rounded bg-gray-200 flex items-center justify-center text-gray-400 text-xs",children:"+"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:Vs=>{const Ne=Vs.target.files?.[0];Ne&&(ve(we.id),m(re.id,we.id,Ne).then(()=>{ve(null)}))}})]}):we.image?e.jsx("img",{src:we.image,alt:we.name,className:"w-12 h-12 rounded object-cover"}):e.jsx("div",{className:"w-12 h-12 rounded bg-gray-200 flex items-center justify-center text-gray-400 text-xs",children:"-"}),e.jsx("div",{className:"flex-1 min-w-0",children:S===we.id?e.jsx(B,{value:J,onChange:Vs=>W(Vs.target.value),onBlur:()=>{o(re.id,we.id,J),q(null)},onKeyDown:Vs=>{Vs.key==="Enter"&&(o(re.id,we.id,J),q(null))},className:"h-8 text-sm",autoFocus:!0}):e.jsxs("div",{children:[e.jsx("span",{className:`text-sm font-medium ${N?"cursor-pointer hover:text-blue-600":""} block`,onClick:()=>{N&&(q(we.id),W(we.name))},children:we.name}),C===we.id?e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"R$"}),e.jsx(B,{type:"number",step:"0.01",value:L,onChange:Vs=>oe(Vs.target.value),onBlur:()=>{p(re.id,we.id,L),Y(null)},onKeyDown:Vs=>{Vs.key==="Enter"&&(p(re.id,we.id,L),Y(null))},className:"h-6 w-20 text-xs",autoFocus:!0})]}):e.jsx("span",{className:`text-xs text-gray-500 ${N?"cursor-pointer hover:text-blue-600":""}`,onClick:()=>{N&&(Y(we.id),oe((we.price||0).toString()))},children:we.price>0?_(we.price):"+ Adicionar preo"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{checked:we.is_active!==!1,onCheckedChange:()=>{N&&i(re.id,we.id,we.is_active!==!1)},disabled:!N}),k&&e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>x(re.id,we.id),className:"text-red-500 hover:text-red-700 h-8 w-8 p-0",children:e.jsx(Ds,{className:"w-4 h-4"})})]})]})},we.id)),Ge.placeholder]})})})]})},re.id)}),U.placeholder]})})}),z&&e.jsxs(xt,{children:[e.jsx(pt,{asChild:!0,children:e.jsxs(A,{variant:"outline",className:"w-full",children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Adicionar Grupo de Complementos"]})}),e.jsxs(gt,{className:"w-56",children:[e.jsxs(ps,{onClick:f,children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Criar novo grupo"]}),e.jsx(Ni,{}),e.jsxs(ps,{onClick:P,children:[e.jsx(Js,{className:"w-4 h-4 mr-2"}),"Copiar grupo existente"]})]})]})]})]})})}function yv({onNavigateToPizzas:s,initialTab:a="dishes"}){Fe.admin.debug(" [DishesTab] Componente montado, initialTab:",a);const[t,r]=ae.useState(null),[n,l]=b.useState(!1),[c,d]=b.useState(!1),[i,o]=b.useState(!1),[m,p]=b.useState(!1),[x,g]=b.useState(!1),[f,y]=b.useState(null),[v,P]=b.useState(null),[M,O]=b.useState(!1),[E,u]=b.useState(null),[_,$]=b.useState(null),[j,D]=b.useState(null),[V,T]=b.useState({}),[N,z]=b.useState({}),[k,h]=b.useState({name:"",description:"",price:"",original_price:"",image:"",category_id:"",stock:"",portion:"",is_highlight:!1,is_active:!0,complement_groups:[],is_new:!1,is_popular:!1,prep_time:"",tags:[],internal_notes:"",product_type:"preparado",video_url:"",video_autoplay:!0}),[F,S]=b.useState(""),[q,J]=b.useState(null),[W,C]=b.useState(""),[Y,L]=b.useState(!1),[oe,Pe]=b.useState(null),[ve,G]=b.useState(null),[ne,fe]=b.useState(!1),[ge,Ee]=b.useState(""),[H,ie]=b.useState("all"),[me,ze]=b.useState("all"),[Je,ce]=b.useState("all"),[We,U]=b.useState(!1),[re,ds]=b.useState([]),[ta,ra]=b.useState(!1),[ls,zs]=b.useState(null),[bs,Ge]=b.useState(a);b.useEffect(()=>{a&&Ge(a)},[a]);const{canCreate:we,canUpdate:ms,canDelete:Da,hasModuleAccess:Rn,subscriberData:Vs,menuContext:Ne,user:Cr,loading:sm}=as(),{canAddProduct:am,plan:tm,effectiveLimits:rm,usage:nm}=Yo(),[im,Sl]=b.useState(!1),Dl=Rn("pizza_config"),lm=ms("dishes");Fe.admin.debug(" [DishesTab] Permisses:",{canCreate:we("dishes"),canUpdate:ms("dishes"),canDelete:Da("dishes"),hasPizzaService:Dl,canEdit:lm,menuContext:Ne}),ae.useEffect(()=>{Cr?(r(Cr),Fe.admin.debug(" [DishesTab] Usurio do usePermission:",Cr?.email)):(async()=>{try{Fe.admin.debug(" [DishesTab] Carregando usurio...");const I=await se.auth.me();Fe.admin.debug(" [DishesTab] Usurio carregado:",I?.email),r(I)}catch(I){Fe.admin.error(" [DishesTab] Error loading user:",I)}})()},[Cr]);const os=ts(),Be=Ne?.type==="slug"?Ne?.value:null,{data:vt,isLoading:Ln}=ke({queryKey:["publicCardapio",Be],queryFn:async()=>Be?await _e.get(`/public/cardapio/${Be}`):null,enabled:!!Be,staleTime:3e4,gcTime:6e4}),ks=()=>Ne?Ne.type==="subscriber"&&Ne.value?Ne.value:Ne.type==="slug"?null:t?.email||null:t?.email||null,{data:om=[],isLoading:Ml,error:In,refetch:cm}=ke({queryKey:["dishes",Ne?.type,Ne?.value],queryFn:async()=>Ne?await wl(Ne):[],enabled:!!Ne&&!Be,placeholderData:Pt,retry:1,refetchOnMount:!0,refetchOnWindowFocus:!1,staleTime:3e4,gcTime:6e4}),{data:dm=[],isLoading:mm,error:qn}=ke({queryKey:["categories",Ne?.type,Ne?.value],queryFn:async()=>Ne?await _d(Ne):[],enabled:!!Ne&&!Be,placeholderData:Pt,retry:1,refetchOnMount:!1,staleTime:6e4,gcTime:12e4}),{data:um=[],isLoading:hm,error:$n}=ke({queryKey:["complementGroups",Ne?.type,Ne?.value],queryFn:async()=>Ne?await N0(Ne):[],enabled:!!Ne&&!Be,placeholderData:Pt,retry:2,refetchOnMount:!1,staleTime:6e4,gcTime:12e4}),Yn=Be&&Array.isArray(vt?.dishes)?vt.dishes:om||[],Al=Be&&Array.isArray(vt?.categories)?vt.categories:dm||[],Pl=Be&&Array.isArray(vt?.complementGroups)?vt.complementGroups:um||[],xm=Be?Ln:Ml,pm=Be?Ln:mm,gm=Be?Ln:hm;b.useEffect(()=>{Ne&&!Be&&Yn.length===0&&!Ml&&cm()},[Ne?.type,Ne?.value,Be]);const El=de({mutationFn:async w=>{const I=ks(),te={...w,...I&&{as_subscriber:I,owner_email:I}};return se.entities.Dish.create(te)},onSuccess:()=>{os.invalidateQueries({queryKey:["dishes",Ne?.type,Ne?.value]}),Be&&os.invalidateQueries({queryKey:["publicCardapio",Be]}),K.success("Prato adicionado com sucesso!"),Vn()},onError:()=>{K.error("Erro ao adicionar prato")}}),js=de({mutationFn:({id:w,data:I})=>{const te=ks()?{as_subscriber:ks()}:{};return se.entities.Dish.update(w,I,te)},onMutate:async({id:w,data:I})=>{const te=["dishes",Ne?.type,Ne?.value];await os.cancelQueries({queryKey:te});const je=os.getQueryData(te);return os.setQueryData(te,ue=>Array.isArray(ue)?ue.map(Ce=>Ce.id===w||String(Ce.id)===String(w)?{...Ce,...I}:Ce):ue),{prev:je}},onError:(w,I,te)=>{te?.prev&&os.setQueryData(["dishes",Ne?.type,Ne?.value],te.prev),K.error("Erro ao atualizar prato")},onSuccess:()=>K.success("Prato atualizado!"),onSettled:()=>{os.invalidateQueries({queryKey:["dishes",Ne?.type,Ne?.value]}),Be&&os.invalidateQueries({queryKey:["publicCardapio",Be]})}}),Ol=de({mutationFn:w=>{const I=ks()?{as_subscriber:ks()}:{};return se.entities.Dish.delete(w,I)},onSuccess:()=>{os.invalidateQueries({queryKey:["dishes",Ne?.type,Ne?.value]}),Be&&os.invalidateQueries({queryKey:["publicCardapio",Be]}),K.success("Prato excludo")},onError:()=>K.error("Erro ao excluir prato")}),zl=de({mutationFn:async w=>{const I=ks();return se.entities.Category.create({...w,...I&&{as_subscriber:I,owner_email:I}})},onSuccess:()=>{os.invalidateQueries({queryKey:["categories",Ne?.type,Ne?.value]}),Be&&os.invalidateQueries({queryKey:["publicCardapio",Be]}),K.success("Categoria criada com sucesso!"),d(!1),D(null)},onError:()=>K.error("Erro ao criar categoria")}),bt=de({mutationFn:({id:w,data:I})=>{const te=ks()?{as_subscriber:ks()}:{};return se.entities.Category.update(w,I,te)},onSuccess:()=>{os.invalidateQueries({queryKey:["categories",Ne?.type,Ne?.value]}),Be&&os.invalidateQueries({queryKey:["publicCardapio",Be]}),K.success("Categoria atualizada!"),d(!1),D(null)},onError:()=>K.error("Erro ao atualizar categoria")}),fm=de({mutationFn:w=>{const I=ks()?{as_subscriber:ks()}:{};return se.entities.Category.delete(w,I)},onSuccess:()=>{os.invalidateQueries({queryKey:["categories",Ne?.type,Ne?.value]}),os.invalidateQueries({queryKey:["dishes",Ne?.type,Ne?.value]}),Be&&os.invalidateQueries({queryKey:["publicCardapio",Be]}),K.success("Categoria excluda")},onError:()=>K.error("Erro ao excluir categoria")}),{requireAuthorization:Gn,modal:jm}=Qo(),kr=w=>Gn("excluir",()=>{confirm("Excluir este prato?")&&Ol.mutate(w)}),Tl=w=>Gn("excluir",()=>{confirm("Excluir categoria e seus pratos?")&&fm.mutate(w)}),ym=()=>Gn("excluir",()=>{re.length!==0&&confirm(`Excluir ${re.length} pratos selecionados?`)&&(re.forEach(w=>Ol.mutate(w)),ds([]))}),Sr=de({mutationFn:async w=>{const I=ks();return se.entities.ComplementGroup.create({...w,...I&&{as_subscriber:I,owner_email:I}})},onSuccess:w=>(os.invalidateQueries({queryKey:["complementGroups",Ne?.type,Ne?.value]}),Be&&os.invalidateQueries({queryKey:["publicCardapio",Be]}),w)}),Ls=de({mutationFn:({id:w,data:I})=>{const te=ks()?{as_subscriber:ks()}:{};return se.entities.ComplementGroup.update(w,I,te)},onSuccess:()=>{os.invalidateQueries({queryKey:["complementGroups",Ne?.type,Ne?.value]}),Be&&os.invalidateQueries({queryKey:["publicCardapio",Be]})}}),gs=(Array.isArray(Yn)?Yn:[]).filter(w=>w.product_type!=="pizza"&&w.product_type!=="beverage"),ss=Array.isArray(Al)?Al:[],ys=Array.isArray(Pl)?Pl:[],Va=(w=null,I="",te="preparado")=>{w?(P(w),h({name:w.name||"",description:w.description||"",price:w.price?.toString()||"",original_price:w.original_price?.toString()||"",image:w.image||"",category_id:w.category_id||"",is_highlight:w.is_highlight||!1,is_active:w.is_active!==!1,complement_groups:w.complement_groups||[],stock:w.stock===null||w.stock===void 0?"":w.stock.toString(),portion:w.portion||"",is_new:w.is_new||!1,is_popular:w.is_popular||!1,prep_time:w.prep_time?.toString()||"",tags:w.tags||[],internal_notes:w.internal_notes||"",product_type:w.product_type||"preparado",video_url:w.video_url||"",video_autoplay:w.video_autoplay!==!1}),J(null)):(P(null),h({name:"",description:"",price:"",original_price:"",image:"",category_id:I,is_highlight:!1,is_active:!0,complement_groups:[],stock:"",portion:"",is_new:!1,is_popular:!1,prep_time:"",tags:[],internal_notes:"",product_type:te,video_url:"",video_autoplay:!0}),J(null),C("")),l(!0)},Ht=w=>{if(!am){Sl(!0);return}u(w),O(!0)},vm=w=>{O(!1),Va(null,E,w)},bm=()=>{s&&s()},Vn=()=>{l(!1),P(null),J(null),C("")},Nm=w=>{if(w.preventDefault(),!k.name.trim()){K.error("O nome do prato  obrigatrio");return}if(!k.price||parseFloat(k.price)<0){K.error("Informe um preo vlido");return}if(k.original_price&&parseFloat(k.original_price)<parseFloat(k.price)){K.error("O preo original no pode ser menor que o preo atual");return}let I=k.complement_groups;if(!v&&q==="copy"&&W){const je=gs.find(ue=>ue.id===W);je?.complement_groups&&(I=je.complement_groups)}const te={...k,price:parseFloat(k.price)||0,original_price:k.original_price?parseFloat(k.original_price):null,stock:k.stock===""?null:k.stock?parseFloat(k.stock):null,prep_time:k.prep_time?parseFloat(k.prep_time):null,complement_groups:I,video_url:k.video_url||"",video_autoplay:k.video_autoplay!==!1};v?(js.mutate({id:v.id,data:te}),Vn()):El.mutate(te)},wm=async w=>{const I=w.target.files?.[0];if(I)try{const te=await Bl(I,"dishes");h(je=>({...je,image:te})),K.success("Imagem enviada com sucesso!")}catch(te){console.error("Erro ao fazer upload:",te),K.error("Erro ao fazer upload da imagem")}},Dr=w=>{T(I=>({...I,[w]:!I[w]}))},Fl=w=>{z(I=>({...I,[w]:!I[w]}))},Un=(w,I,te)=>{const je=ys.find(Ce=>Ce.id===w);if(!je)return;const ue=(je.options||[]).map(Ce=>Ce.id===I?{...Ce,is_active:!te}:Ce);Ls.mutate({id:w,data:{...je,options:ue}})},Bn=(w,I,te)=>{const je=ys.find(Ce=>Ce.id===w);if(!je)return;const ue=(je.options||[]).map(Ce=>Ce.id===I?{...Ce,name:te}:Ce);Ls.mutate({id:w,data:{...je,options:ue}})},Wn=w=>{const I=prompt("Nome da opo:");if(!I)return;const te=prompt("Preo adicional (deixe em branco para R$ 0,00):","0"),je=parseFloat(te)||0,ue=ys.find(Us=>Us.id===w);if(!ue)return;const Ce={id:Date.now().toString(),name:I,price:je,image:"",is_active:!0};Ls.mutate({id:w,data:{...ue,options:[...ue.options||[],Ce]}})},Hn=async(w,I,te)=>{try{const je=await Bl(te,"complements"),ue=ys.find(Us=>Us.id===w);if(!ue)return;const Ce=(ue.options||[]).map(Us=>Us.id===I?{...Us,image:je}:Us);Ls.mutate({id:w,data:{...ue,options:Ce}}),K.success("Imagem atualizada!")}catch(je){console.error("Erro ao fazer upload:",je),K.error("Erro ao fazer upload da imagem")}},Kn=(w,I,te)=>{const je=ys.find(Ce=>Ce.id===w);if(!je)return;const ue=(je.options||[]).map(Ce=>Ce.id===I?{...Ce,price:parseFloat(te)||0}:Ce);Ls.mutate({id:w,data:{...je,options:ue}})},Rl=w=>{const I=gs.filter(je=>je.complement_groups?.some(ue=>ue.group_id===w));if(I.length===0)return{type:"original",count:0};const te=I.sort((je,ue)=>new Date(je.created_date)-new Date(ue.created_date))[0];return{type:I.length>1?"reused":"original",count:I.length,firstDishId:te.id}},Qn=async w=>{const I=prompt("Nome do grupo de complementos:");if(!I)return;const te={name:I,is_required:!1,max_selection:1,options:[],order:ys.length},je=await Sr.mutateAsync(te);setTimeout(()=>{const ue=gs.find(Ce=>Ce.id===w);if(ue&&je){const Ce=[...ue.complement_groups||[],{group_id:je.id,is_required:!1}];js.mutate({id:w,data:{...ue,complement_groups:Ce}})}},300)},Mr=(w,I)=>{const te=gs.find(Ce=>Ce.id===w);if(!te)return;if(te.complement_groups?.some(Ce=>Ce.group_id===I)){alert("Este grupo j est vinculado a este prato");return}const ue=[...te.complement_groups||[],{group_id:I,is_required:!1}];js.mutate({id:w,data:{...te,complement_groups:ue}},{onSettled:()=>{os.invalidateQueries({queryKey:["complementGroups",Ne?.type,Ne?.value]}),Be&&os.invalidateQueries({queryKey:["publicCardapio",Be]})}})},Zn=(w,I)=>{if(!confirm("Remover este grupo de complementos?"))return;const te=gs.find(ue=>ue.id===w);if(!te)return;const je=(te.complement_groups||[]).filter(ue=>ue.group_id!==I);js.mutate({id:w,data:{...te,complement_groups:je}})},Jn=(w,I)=>{if(!confirm("Remover este complemento?"))return;const te=ys.find(ue=>ue.id===w);if(!te)return;const je=(te.options||[]).filter(ue=>ue.id!==I);Ls.mutate({id:w,data:{...te,options:je}})},Xn=(w,I)=>{$({...w,dishId:I}),o(!0)},_m=()=>{if(_){if(Ls.mutate({id:_.id,data:{name:_.name,max_selection:_.max_selection,options:_.options,order:_.order}}),_.dishId){const w=gs.find(I=>I.id===_.dishId);if(w){const I=(w.complement_groups||[]).map(te=>te.group_id===_.id?{...te,is_required:_.is_required}:te);js.mutate({id:_.dishId,data:{...w,complement_groups:I}})}}o(!1),$(null)}},Ar=async w=>{const I=ks(),te={...w,name:`${w.name} (Cpia)`,...I&&{as_subscriber:I,owner_email:I},id:void 0,created_date:void 0,updated_date:void 0};El.mutate(te)},Ll=async w=>{const I=ks();zl.mutate({name:`${w.name} (Cpia)`,order:ss.length,...I&&{as_subscriber:I,owner_email:I}})},Il=w=>{D(w),d(!0)},Cm=w=>{j?bt.mutate({id:j.id,data:{...j,...w}}):zl.mutate(w)},Kt=gs.filter(w=>{const I=!ge||w.name?.toLowerCase().includes(ge.toLowerCase())||w.description?.toLowerCase().includes(ge.toLowerCase()),te=H==="all"||w.category_id===H,je=me==="all"||me==="active"&&w.is_active!==!1||me==="inactive"&&w.is_active===!1,ue=Je==="all"||Je==="highlight"&&w.is_highlight||Je==="new"&&w.is_new||Je==="popular"&&w.is_popular;return I&&te&&je&&ue}),Qt={};ss.forEach(w=>{Qt[w.id]=Kt.filter(I=>I.category_id===w.id)});const Nt=Kt.filter(w=>!w.category_id||!ss.some(I=>I.id===w.category_id)),ql=w=>{re.length!==0&&(re.forEach(I=>{const te=gs.find(je=>je.id===I);te&&js.mutate({id:I,data:{...te,is_active:w}})}),ds([]))},$l=w=>{ds(I=>I.includes(w)?I.filter(te=>te!==w):[...I,w])},km=w=>{h(I=>({...I,tags:I.tags.includes(w)?I.tags.filter(te=>te!==w):[...I.tags,w]}))},Sm=()=>{const w=[];if(ge&&w.push({key:"search",label:`"${ge}"`}),H!=="all"){const I=ss.find(te=>te.id===H);I&&w.push({key:"category",label:I.name})}if(me!=="all"&&w.push({key:"status",label:me==="active"?"Ativos":"Inativos"}),Je!=="all"){const I={highlight:"Destaques",new:"Novos",popular:"Populares"};w.push({key:"type",label:I[Je]})}return w},Dm=w=>{w==="search"&&Ee(""),w==="category"&&ie("all"),w==="status"&&ze("all"),w==="type"&&ce("all")},Mm=["vegetariano","vegano","sem_gluten","picante","fit"],Am={vegetariano:" Vegetariano",vegano:" Vegano",sem_gluten:" Sem Glten",picante:" Picante",fit:" Fit"},Pm=w=>{if(w===0)return;const I=ss[w],te=ss[w-1];I&&te&&(bt.mutate({id:I.id,data:{...I,order:w-1}}),bt.mutate({id:te.id,data:{...te,order:w}}))},Em=w=>{if(w===ss.length-1)return;const I=ss[w],te=ss[w+1];I&&te&&(bt.mutate({id:I.id,data:{...I,order:w+1}}),bt.mutate({id:te.id,data:{...te,order:w}}))},Pr=Sm(),Om=sm||!Ne||xm||pm||gm,zm=In||qn||$n;return Om?e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx(L0,{})}):zm?(Fe.admin.error(" [DishesTab] Erro ao carregar:",{dishesError:In,categoriesError:qn,groupsError:$n}),e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-500 mb-4",children:"Erro ao carregar dados"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:In?.message||qn?.message||$n?.message||"Erro desconhecido"}),e.jsx(A,{onClick:()=>window.location.reload(),children:"Recarregar pgina"})]})})):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(Hr,{position:"top-center"}),e.jsxs("div",{className:"lg:hidden sticky top-0 z-30 bg-white border-b border-gray-100 px-4 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Cardpio"}),e.jsxs("button",{onClick:()=>ra(!0),className:"flex items-center gap-2 px-3 py-2 rounded-xl bg-gray-100 active:bg-gray-200 transition-colors",children:[e.jsx(Ms,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Filtros"}),Pr.length>0&&e.jsx("span",{className:"w-5 h-5 bg-orange-500 text-white text-xs rounded-full flex items-center justify-center",children:Pr.length})]})]}),Pr.length>0&&e.jsx(O0,{filters:Pr,onRemoveFilter:Dm,onClearAll:()=>{Ee(""),ie("all"),ze("all"),ce("all")}})]}),e.jsx("div",{className:"hidden lg:block border-b bg-white",children:e.jsxs("div",{className:"px-6 flex gap-1",children:[e.jsxs("button",{onClick:()=>Ge("dishes"),className:`px-4 py-3 text-sm font-medium border-b-2 transition-colors ${bs==="dishes"?"border-orange-500 text-orange-500":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(na,{className:"w-4 h-4 inline mr-2"}),"Pratos"]}),e.jsxs("button",{onClick:()=>Ge("categories"),className:`px-4 py-3 text-sm font-medium border-b-2 transition-colors ${bs==="categories"?"border-orange-500 text-orange-500":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(et,{className:"w-4 h-4 inline mr-2"}),"Categorias"]}),e.jsxs("button",{onClick:()=>Ge("complements"),className:`px-4 py-3 text-sm font-medium border-b-2 transition-colors ${bs==="complements"?"border-orange-500 text-orange-500":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(Mo,{className:"w-4 h-4 inline mr-2"}),"Complementos"]})]})}),e.jsx("div",{className:"lg:hidden border-b bg-white sticky top-[73px] z-20",children:e.jsxs("div",{className:"flex overflow-x-auto scrollbar-hide",children:[e.jsx("button",{onClick:()=>Ge("dishes"),className:`px-4 py-3 text-xs font-medium border-b-2 transition-colors flex-shrink-0 ${bs==="dishes"?"border-orange-500 text-orange-500":"border-transparent text-gray-500"}`,children:"Pratos"}),e.jsx("button",{onClick:()=>Ge("categories"),className:`px-4 py-3 text-xs font-medium border-b-2 transition-colors flex-shrink-0 ${bs==="categories"?"border-orange-500 text-orange-500":"border-transparent text-gray-500"}`,children:"Categorias"}),e.jsx("button",{onClick:()=>Ge("complements"),className:`px-4 py-3 text-xs font-medium border-b-2 transition-colors flex-shrink-0 ${bs==="complements"?"border-orange-500 text-orange-500":"border-transparent text-gray-500"}`,children:"Complementos"})]})}),bs==="categories"?e.jsx(D0,{}):bs==="complements"?e.jsx(P0,{}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden lg:block p-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-3 mb-6",children:[we("dishes")&&e.jsxs(A,{onClick:()=>d(!0),variant:"outline",children:[e.jsx(en,{className:"w-4 h-4 mr-2"}),"Nova Categoria"]}),ms("dishes")&&e.jsxs(A,{onClick:()=>fe(!0),variant:"outline",children:[e.jsx(Ra,{className:"w-4 h-4 mr-2"}),"Reordenar"]}),we("dishes")&&e.jsxs(A,{onClick:()=>p(!0),variant:"outline",children:[e.jsx(vi,{className:"w-4 h-4 mr-2"}),"Templates"]}),we("dishes")&&e.jsxs(A,{variant:"outline",className:"ml-auto",onClick:()=>setShowComboModal(!0),children:[e.jsx(tr,{className:"w-4 h-4 mr-2"}),"Criar Combo"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(Q,{className:"border-l-4 border-l-blue-500",children:e.jsx(Z,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total de Pratos"}),e.jsx("p",{className:"text-2xl font-bold",children:gs.length})]}),e.jsx(Ss,{className:"w-8 h-8 text-blue-500"})]})})}),e.jsx(Q,{className:"border-l-4 border-l-green-500",children:e.jsx(Z,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Ativos"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:gs.filter(w=>w.is_active!==!1).length})]}),e.jsx(ma,{className:"w-8 h-8 text-green-500"})]})})}),e.jsx(Q,{className:"border-l-4 border-l-orange-500",children:e.jsx(Z,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Categorias"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:ss.length})]}),e.jsx(et,{className:"w-8 h-8 text-orange-500"})]})})}),e.jsx(Q,{className:"border-l-4 border-l-purple-500",children:e.jsx(Z,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Complementos"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:ys.length})]}),e.jsx(ut,{className:"w-8 h-8 text-purple-500"})]})})})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 mb-6 space-y-4 shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(B,{placeholder:" Buscar pratos...",value:ge,onChange:w=>Ee(w.target.value)}),e.jsxs(Se,{value:H,onValueChange:ie,children:[e.jsx(De,{children:e.jsx(Me,{placeholder:"Todas categorias"})}),e.jsxs(Ae,{children:[e.jsx(X,{value:"all",children:"Todas categorias"}),ss.map(w=>e.jsx(X,{value:w.id,children:w.name},w.id))]})]}),e.jsxs(Se,{value:me,onValueChange:ze,children:[e.jsx(De,{children:e.jsx(Me,{placeholder:"Status"})}),e.jsxs(Ae,{children:[e.jsx(X,{value:"all",children:"Todos os status"}),e.jsx(X,{value:"active",children:" Ativos"}),e.jsx(X,{value:"inactive",children:" Inativos"})]})]}),e.jsxs(Se,{value:Je,onValueChange:ce,children:[e.jsx(De,{children:e.jsx(Me,{placeholder:"Tipo"})}),e.jsxs(Ae,{children:[e.jsx(X,{value:"all",children:"Todos os tipos"}),e.jsx(X,{value:"highlight",children:" Destaques"}),e.jsx(X,{value:"new",children:" Novos"}),e.jsx(X,{value:"popular",children:" Populares"})]})]})]}),(ge||H!=="all"||me!=="all"||Je!=="all")&&e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:[Kt.length," prato",Kt.length!==1?"s":""," encontrado",Kt.length!==1?"s":""]}),e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>{Ee(""),ie("all"),ze("all"),ce("all")},children:"Limpar filtros"})]})]})]}),re.length>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-blue-900",children:[re.length," prato",re.length!==1?"s":""," selecionado",re.length!==1?"s":""]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:()=>ql(!0),children:"Ativar"}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>ql(!1),children:"Desativar"}),e.jsx(A,{variant:"outline",size:"sm",onClick:ym,className:"text-red-600",children:"Excluir"}),e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>ds([]),children:"Cancelar"})]})]}),e.jsxs("div",{className:"lg:hidden px-4 pb-24 space-y-3",children:[Nt.length>0&&e.jsx(jo,{category:{id:"__sem_categoria__",name:"Sem categoria"},dishCount:Nt.length,isExpanded:V.__sem_categoria__!==!1,onToggle:()=>Dr("__sem_categoria__"),onAddDish:()=>Ht(ss[0]?.id||""),onEdit:()=>{},onDuplicate:()=>{},onDelete:()=>{},children:Nt.map(w=>e.jsx(fo,{dish:w,onEdit:()=>Va(w),onDuplicate:()=>Ar(w),onDelete:()=>{kr(w.id)},onToggleActive:I=>{ms("dishes")&&js.mutate({id:w.id,data:{is_active:I}})},onToggleHighlight:I=>{ms("dishes")&&js.mutate({id:w.id,data:{is_highlight:I}})},onToggleComplements:()=>zs(w),complementGroupsCount:w.complement_groups?.length||0,formatCurrency:va,canEdit:ms("dishes")},w.id))},"__sem_categoria__"),ss.map(w=>{const I=Qt[w.id]||[],te=V[w.id]!==!1;return e.jsx(jo,{category:w,dishCount:I.length,isExpanded:te,onToggle:()=>Dr(w.id),onAddDish:()=>Ht(w.id),onEdit:()=>Il(w),onDuplicate:()=>Ll(w),onDelete:()=>Tl(w.id),children:I.length===0?e.jsx("div",{className:"text-center py-8 text-gray-400 text-sm",children:"Nenhum prato nesta categoria"}):I.map(je=>e.jsx(fo,{dish:je,onEdit:()=>Va(je),onDuplicate:()=>Ar(je),onDelete:()=>kr(je.id),onToggleActive:ue=>{ms("dishes")&&js.mutate({id:je.id,data:{is_active:ue}})},onToggleHighlight:ue=>{ms("dishes")&&js.mutate({id:je.id,data:{is_highlight:ue}})},onToggleComplements:()=>zs(je),complementGroupsCount:je.complement_groups?.length||0,formatCurrency:va,canEdit:ms("dishes")},je.id))},w.id)}),ss.length===0&&gs.length===0&&e.jsx(Rr,{icon:na,title:"Voc ainda no cadastrou nenhum prato",description:"Comece criando categorias e adicionando seus pratos ao cardpio",actionLabel:"Criar primeira categoria",onAction:()=>d(!0)}),ss.length>0&&gs.length===0&&e.jsx(Rr,{icon:na,title:"Voc ainda no cadastrou nenhum prato",description:"Adicione pratos s categorias criadas para comear a vender",actionLabel:"Cadastrar primeiro prato",onAction:()=>Va(null,ss[0]?.id||"")})]}),e.jsxs("div",{className:"hidden lg:block px-6 pb-6 space-y-4",children:[Nt.length>0&&e.jsxs("div",{className:"bg-gray-50 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white border-b cursor-pointer hover:bg-gray-50",onClick:()=>Dr("__sem_categoria__"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ra,{className:"w-5 h-5 text-gray-400"}),e.jsx("h2",{className:"font-bold text-lg",children:"Sem categoria"}),e.jsxs(ye,{variant:"secondary",className:"text-xs",children:[Nt.length," itens"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[we("dishes")&&e.jsxs(A,{variant:"outline",size:"sm",onClick:w=>{w.stopPropagation(),Ht(ss[0]?.id||"")},children:[e.jsx($e,{className:"w-4 h-4 mr-1"}),"Adicionar prato"]}),V.__sem_categoria__!==!1?e.jsx(Ot,{className:"w-5 h-5"}):e.jsx(La,{className:"w-5 h-5"})]})]}),V.__sem_categoria__!==!1&&e.jsx("div",{className:"p-4 space-y-3",children:Nt.map(w=>e.jsx(yo,{dish:w,isSelected:re.includes(w.id),onToggleSelection:()=>$l(w.id),complementGroups:ys,expanded:N[w.id],onToggleExpand:()=>Fl(w.id),onEdit:()=>Va(w),onDelete:()=>kr(w.id),onDuplicate:()=>Ar(w),onUpdate:I=>js.mutate({id:w.id,data:I}),onToggleOption:Un,onUpdateOptionName:Bn,onUpdateOptionPrice:Kn,onUpdateOptionImage:Hn,onRemoveOption:Jn,onAddOption:Wn,onAddGroup:()=>Qn(w.id),onReuseGroup:I=>Mr(w.id,I),onRemoveGroup:I=>Zn(w.id,I),onOpenReuseModal:()=>{Pe(w.id),L(!0)},allComplementGroups:ys,allDishes:gs,onEditGroup:I=>{const te=w.complement_groups?.find(je=>je.group_id===I.id);Xn({...I,is_required:te?.is_required||!1},w.id)},getGroupUsageInfo:Rl,formatCurrency:va,updateDishMutation:js,updateComplementGroupMutation:Ls,createComplementGroupMutation:Sr,canEdit:ms("dishes"),canCreate:we("dishes"),canDelete:Da("dishes"),setBulkEditGroup:y,setShowBulkEditModal:g},w.id))})]}),ss.map((w,I)=>{const te=Qt[w.id]||[],je=V[w.id]!==!1;return e.jsxs("div",{className:"bg-gray-50 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white border-b cursor-pointer hover:bg-gray-50",onClick:()=>Dr(w.id),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[ms("dishes")&&e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("button",{onClick:ue=>{ue.stopPropagation(),Pm(I)},disabled:I===0,className:"p-0.5 hover:bg-gray-200 rounded disabled:opacity-30",children:e.jsx(Ot,{className:"w-4 h-4"})}),e.jsx("button",{onClick:ue=>{ue.stopPropagation(),Em(I)},disabled:I===ss.length-1,className:"p-0.5 hover:bg-gray-200 rounded disabled:opacity-30",children:e.jsx(La,{className:"w-4 h-4"})})]}),e.jsx(Ra,{className:"w-5 h-5 text-gray-400"}),e.jsx("h2",{className:"font-bold text-lg",children:w.name}),e.jsxs(ye,{variant:"secondary",className:"text-xs",children:[te.length," itens"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[re.length>0&&e.jsxs(A,{variant:"outline",size:"sm",onClick:ue=>{ue.stopPropagation();const Ce=te.map(ga=>ga.id),Us=Ce.every(ga=>re.includes(ga));ds(Us?ga=>ga.filter(Tm=>!Ce.includes(Tm)):ga=>[...new Set([...ga,...Ce])])},children:[te.every(ue=>re.includes(ue.id))?"":""," Selecionar todos"]}),we("dishes")&&e.jsxs(A,{variant:"outline",size:"sm",onClick:ue=>{ue.stopPropagation(),Ht(w.id)},children:[e.jsx($e,{className:"w-4 h-4 mr-1"}),"Adicionar prato"]}),e.jsxs(xt,{children:[e.jsx(pt,{asChild:!0,onClick:ue=>ue.stopPropagation(),children:e.jsx(A,{variant:"ghost",size:"icon",children:e.jsx(jr,{className:"w-4 h-4"})})}),e.jsxs(gt,{align:"end",children:[ms("dishes")&&e.jsxs(ps,{onClick:()=>Il(w),children:[e.jsx(qs,{className:"w-4 h-4 mr-2"}),"Editar categoria"]}),we("dishes")&&e.jsxs(ps,{onClick:()=>Ll(w),children:[e.jsx(tc,{className:"w-4 h-4 mr-2"}),"Duplicar categoria"]}),Da("dishes")&&e.jsxs(e.Fragment,{children:[e.jsx(Ni,{}),e.jsxs(ps,{onClick:()=>Tl(w.id),className:"text-red-600",children:[e.jsx(Xe,{className:"w-4 h-4 mr-2"}),"Remover categoria"]})]})]})]}),je?e.jsx(Ot,{className:"w-5 h-5"}):e.jsx(La,{className:"w-5 h-5"})]})]}),je&&e.jsx("div",{className:"p-4 space-y-3",children:te.length===0?e.jsx("div",{className:"p-4 text-center text-gray-400 text-sm",children:"Nenhum prato nesta categoria"}):te.map(ue=>e.jsx(yo,{dish:ue,isSelected:re.includes(ue.id),onToggleSelection:()=>$l(ue.id),complementGroups:ys,expanded:N[ue.id],onToggleExpand:()=>Fl(ue.id),onEdit:()=>Va(ue),onDelete:()=>kr(ue.id),onDuplicate:()=>Ar(ue),onUpdate:Ce=>js.mutate({id:ue.id,data:Ce}),onToggleOption:Un,onUpdateOptionName:Bn,onUpdateOptionImage:Hn,onUpdateOptionPrice:Kn,onRemoveOption:Jn,onAddOption:Wn,onAddGroup:()=>Qn(ue.id),onReuseGroup:Ce=>Mr(ue.id,Ce),onRemoveGroup:Ce=>Zn(ue.id,Ce),onOpenReuseModal:()=>{Pe(ue.id),L(!0)},allComplementGroups:ys,allDishes:gs,onEditGroup:Ce=>{const Us=ue.complement_groups?.find(ga=>ga.group_id===Ce.id);Xn({...Ce,is_required:Us?.is_required||!1},ue.id)},getGroupUsageInfo:Rl,formatCurrency:va,updateDishMutation:js,updateComplementGroupMutation:Ls,createComplementGroupMutation:Sr,canEdit:ms("dishes"),canCreate:we("dishes"),canDelete:Da("dishes"),setBulkEditGroup:y,setShowBulkEditModal:g},ue.id))})]},w.id)}),ss.length===0&&gs.length===0&&e.jsx(Rr,{icon:na,title:"Voc ainda no cadastrou nenhum prato",description:"Comece criando categorias e adicionando seus pratos ao cardpio",actionLabel:"Criar primeira categoria",onAction:()=>d(!0)}),ss.length>0&&gs.length===0&&e.jsx(Rr,{icon:na,title:"Voc ainda no cadastrou nenhum prato",description:"Adicione pratos s categorias criadas para comear a vender",actionLabel:"Cadastrar primeiro prato",onAction:()=>Va(null,ss[0]?.id||"")})]}),we("dishes")&&e.jsx("div",{className:"lg:hidden",children:e.jsx(E0,{onAddDish:()=>Ht(ss[0]?.id||""),onAddCategory:()=>d(!0)})}),e.jsx(S0,{isOpen:M,onClose:()=>O(!1),onSelectType:vm,categoryId:E,categoryDishes:Array.isArray(Qt[E])?Qt[E]:[],onRedirectToPizzas:bm,hasPizzaService:Dl,subscriberName:Vs?.name||t?.full_name||""}),e.jsx(Go,{open:im,onOpenChange:Sl,type:"products",plan:tm,limit:rm?.products??0,used:nm?.productsCount??0,suggestion:"Pro libera at 800 produtos."}),e.jsx(R0,{isOpen:!!ls,onClose:()=>zs(null),dish:ls,complementGroups:ys,onAddOption:Wn,onToggleOption:Un,onRemoveOption:Jn,onEditGroup:w=>{const I=ls.complement_groups?.find(te=>te.group_id===w.id);Xn({...w,is_required:I?.is_required||!1},ls?.id)},onRemoveGroup:w=>Zn(ls?.id,w),onAddGroup:()=>Qn(ls?.id),onReuseGroup:w=>Mr(ls?.id,w),onToggleRequired:w=>{const I=(ls.complement_groups||[]).map(te=>te.group_id===w?{...te,is_required:!te.is_required}:te);js.mutate({id:ls.id,data:{complement_groups:I}})},onReorderGroups:w=>{js.mutate({id:ls.id,data:{complement_groups:w}})},onCopyGroups:async w=>{for(const I of w){const te=ys.find(je=>je.id===I);if(te){const je={name:`${te.name} (Cpia)`,is_required:te.is_required,max_selection:te.max_selection,options:te.options||[],order:ys.length},ue=await Sr.mutateAsync(je);if(ue&&ls){const Ce=[...ls.complement_groups||[],{group_id:ue.id,is_required:!1}];js.mutate({id:ls.id,data:{complement_groups:Ce}})}}}},onUpdateOptionName:Bn,onUpdateOptionPrice:Kn,onUpdateOptionImage:Hn,formatCurrency:va}),e.jsx(z0,{isOpen:ta,onClose:()=>ra(!1),title:"Filtros",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Buscar"}),e.jsx(B,{placeholder:"Digite para buscar...",value:ge,onChange:w=>Ee(w.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Categoria"}),e.jsxs(Se,{value:H,onValueChange:ie,children:[e.jsx(De,{children:e.jsx(Me,{placeholder:"Todas categorias"})}),e.jsxs(Ae,{children:[e.jsx(X,{value:"all",children:"Todas categorias"}),ss.map(w=>e.jsx(X,{value:w.id,children:w.name},w.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Status"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["all","active","inactive"].map(w=>e.jsx("button",{onClick:()=>ze(w),className:`py-2 px-3 rounded-xl text-sm font-medium transition-colors ${me===w?"bg-orange-500 text-white":"bg-gray-100 text-gray-700 active:bg-gray-200"}`,children:w==="all"?"Todos":w==="active"?"Ativos":"Inativos"},w))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Tipo"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{value:"all",label:"Todos"},{value:"highlight",label:" Destaques"},{value:"new",label:" Novos"},{value:"popular",label:" Populares"}].map(w=>e.jsx("button",{onClick:()=>ce(w.value),className:`py-2 px-3 rounded-xl text-sm font-medium transition-colors ${Je===w.value?"bg-orange-500 text-white":"bg-gray-100 text-gray-700 active:bg-gray-200"}`,children:w.label},w.value))})]}),e.jsx(A,{onClick:()=>ra(!1),className:"w-full bg-orange-500 hover:bg-orange-600",children:"Aplicar Filtros"})]})})]}),e.jsx(su,{isOpen:c,onClose:()=>{d(!1),D(null)},onSubmit:Cm,category:j,categoriesCount:ss.length}),e.jsx(Re,{open:n,onOpenChange:l,children:e.jsxs(Le,{className:"sm:max-w-2xl max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Ie,{children:[e.jsx(qe,{children:v?"Editar Prato":"Adicionar Prato"}),e.jsx(Zr,{className:"sr-only",children:"Formulrio para adicionar ou editar um prato do cardpio."})]}),e.jsxs("form",{onSubmit:Nm,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Nome *"}),e.jsx(B,{value:k.name,onChange:w=>h(I=>({...I,name:w.target.value})),required:!0,className:"min-h-touch"})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Categoria *"}),e.jsxs(Se,{value:k.category_id,onValueChange:w=>h(I=>({...I,category_id:w})),required:!0,children:[e.jsx(De,{className:"min-h-touch",children:e.jsx(Me,{placeholder:"Selecione"})}),e.jsx(Ae,{children:ss.map(w=>e.jsx(X,{value:w.id,children:w.name},w.id))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Preo de (R$)"}),e.jsx(B,{type:"number",step:"0.01",value:k.original_price,onChange:w=>h(I=>({...I,original_price:w.target.value})),placeholder:"Preo original",className:"min-h-touch"})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Por (R$) *"}),e.jsx(B,{type:"number",step:"0.01",value:k.price,onChange:w=>h(I=>({...I,price:w.target.value})),required:!0,placeholder:"Preo atual",className:"min-h-touch"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Estoque"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{type:"number",value:k.stock,onChange:w=>h(I=>({...I,stock:w.target.value})),placeholder:"Ex: 10",disabled:k.stock==="",className:`min-h-touch ${k.stock===""?"bg-gray-100":""}`}),e.jsxs("div",{className:"flex items-center gap-1 whitespace-nowrap",children:[e.jsx(Ve,{checked:k.stock==="",onCheckedChange:w=>h(I=>({...I,stock:w?"":"0"}))}),e.jsx("span",{className:"text-xs text-gray-600",children:"Ilimitado"})]})]})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Poro"}),e.jsx(B,{value:k.portion,onChange:w=>h(I=>({...I,portion:w.target.value})),placeholder:"Ex: 180g, 500ml",className:"min-h-touch"})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Tipo de Produto"}),e.jsx("div",{className:"flex gap-2 mt-2",children:e.jsx(ye,{variant:k.product_type==="preparado"?"default":"outline",className:"cursor-default",children:k.product_type==="preparado"?" Preparado":k.product_type==="industrializado"?" Industrializado":" Pizza"})})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Descrio"}),e.jsx(Os,{value:k.description,onChange:w=>h(I=>({...I,description:w.target.value})),rows:3,className:"min-h-[80px]"})]}),k.product_type!=="industrializado"&&e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Tempo de Preparo (minutos)"}),e.jsx(B,{type:"number",value:k.prep_time,onChange:w=>h(I=>({...I,prep_time:w.target.value})),placeholder:"Ex: 30",className:"min-h-touch"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:Mm.map(w=>e.jsx(ye,{variant:k.tags.includes(w)?"default":"outline",className:"cursor-pointer",onClick:()=>km(w),children:Am[w]},w))})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Observaes Internas (no visveis ao cliente)"}),e.jsx(Os,{value:k.internal_notes,onChange:w=>h(I=>({...I,internal_notes:w.target.value})),rows:3,placeholder:"Notas para a equipe...",className:"min-h-[80px]"})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Imagem"}),e.jsx(B,{type:"file",accept:"image/*",onChange:wm,className:"min-h-touch"}),k.image&&e.jsx("img",{src:k.image,alt:"",className:"mt-2 w-20 h-20 sm:w-24 sm:h-24 object-cover rounded"})]}),e.jsxs("div",{className:"p-4 border-2 border-orange-300 dark:border-orange-700 rounded-lg bg-orange-50 dark:bg-orange-900/30 shadow-sm",children:[e.jsx(R,{htmlFor:"video_url",className:"text-base font-semibold mb-2 block text-orange-700 dark:text-orange-300",children:" Link do Vdeo (YouTube ou Vimeo)"}),e.jsx(B,{id:"video_url",type:"url",value:k.video_url||"",onChange:w=>h(I=>({...I,video_url:w.target.value})),placeholder:"Ex: https://www.youtube.com/watch?v=...",className:"w-full bg-white dark:bg-gray-800"}),e.jsx("p",{className:"text-xs text-orange-600 dark:text-orange-400 mt-2",children:"O vdeo aparece no cardpio ao clicar na imagem do prato."}),k.video_url&&e.jsxs("div",{className:"mt-3 flex items-center justify-between p-3 bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx(R,{htmlFor:"video_autoplay",className:"cursor-pointer text-sm font-medium",children:"Reproduo automtica"}),e.jsx(Ve,{id:"video_autoplay",checked:k.video_autoplay!==!1,onCheckedChange:w=>h(I=>({...I,video_autoplay:w}))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4 bg-gray-50 rounded min-h-touch",children:[e.jsx(R,{className:"text-sm font-medium",children:" Destaque"}),e.jsx(Ve,{checked:k.is_highlight,onCheckedChange:w=>h(I=>({...I,is_highlight:w}))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4 bg-gray-50 rounded min-h-touch",children:[e.jsx(R,{className:"text-sm font-medium",children:" Novo"}),e.jsx(Ve,{checked:k.is_new,onCheckedChange:w=>h(I=>({...I,is_new:w}))})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4 bg-gray-50 rounded min-h-touch",children:[e.jsx(R,{className:"text-sm font-medium",children:" Mais Vendido"}),e.jsx(Ve,{checked:k.is_popular,onCheckedChange:w=>h(I=>({...I,is_popular:w}))})]}),k.image&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(R,{children:"Visualizao"}),e.jsx(A,{type:"button",variant:"outline",size:"sm",onClick:()=>U(!We),children:We?"Ocultar":"Ver como cliente"})]}),We&&e.jsx("div",{className:"border rounded-lg p-4 bg-gray-50",children:e.jsxs("div",{className:"max-w-sm mx-auto bg-white rounded-xl shadow-sm overflow-hidden",children:[e.jsx("img",{src:k.image,alt:k.name,className:"w-full h-48 object-cover"}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:k.name||"Nome do Prato"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:k.description||"Descrio..."}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xl font-bold text-orange-500",children:va(parseFloat(k.price)||0)}),e.jsx(A,{size:"sm",className:"bg-orange-500",children:"Adicionar"})]})]})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[e.jsx(A,{type:"button",variant:"outline",onClick:Vn,className:"flex-1 min-h-touch",children:"Cancelar"}),e.jsx(A,{type:"submit",className:"flex-1 min-h-touch bg-orange-500",children:v?"Salvar":"Adicionar"})]})]})]})}),e.jsx(w0,{isOpen:Y,onClose:()=>{L(!1),Pe(null)},currentDish:oe?gs.find(w=>w.id===oe):null,onSelect:w=>{oe&&Mr(oe,w)},availableGroups:ys,allDishes:gs}),e.jsx(Re,{open:i,onOpenChange:o,children:e.jsxs(Le,{className:"sm:max-w-md max-w-[95vw]",children:[e.jsxs(Ie,{children:[e.jsx(qe,{children:"Configuraes do Grupo"}),e.jsx(Zr,{className:"sr-only",children:"Configuraes do grupo de complementos."})]}),_&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome do Grupo"}),e.jsx(B,{value:_.name,onChange:w=>$(I=>({...I,name:w.target.value}))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx(R,{className:"font-medium",children:"Obrigatrio"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Cliente deve escolher este grupo"})]}),e.jsx(Ve,{checked:_.is_required,onCheckedChange:w=>$(I=>({...I,is_required:w}))})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Mximo de Selees"}),e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Quantas opes o cliente pode escolher"}),e.jsx(B,{type:"number",min:"1",value:_.max_selection||1,onChange:w=>$(I=>({...I,max_selection:parseInt(w.target.value)||1}))})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(A,{type:"button",variant:"outline",onClick:()=>o(!1),className:"flex-1",children:"Cancelar"}),e.jsx(A,{type:"button",onClick:_m,className:"flex-1 bg-orange-500",children:"Salvar"})]})]})]})}),e.jsx(au,{isOpen:ne,onClose:()=>fe(!1),categories:ss,dishes:gs,complementGroups:ys,onSave:w=>{w.categories.forEach(I=>{bt.mutate({id:I.id,data:I})}),w.dishes.forEach(I=>{js.mutate({id:I.id,data:I})}),w.groups.forEach(I=>{Ls.mutate({id:I.id,data:I})}),Object.entries(w.groupOptions).forEach(([I,te])=>{const je=ys.find(ue=>ue.id===I);je&&Ls.mutate({id:I,data:{...je,options:te}})}),K.success("Ordem atualizada com sucesso!"),fe(!1)}}),e.jsx(C0,{isOpen:m,onClose:()=>p(!1),onUseTemplate:w=>{}}),f&&e.jsx(k0,{isOpen:x,onClose:()=>{g(!1),y(null)},group:f,onUpdate:w=>{Ls.mutate({id:w.id,data:w})}})]}),jm]})}function I0(){const s=ts(),{menuContext:a}=as(),{data:t,isLoading:r}=ke({queryKey:["store",a?.type,a?.value],queryFn:async()=>{if(!a)return null;const i={};return a.type==="subscriber"&&a.value&&(i.as_subscriber=a.value),(await _e.entities.Store.list(null,i))[0]},enabled:!!a}),[n,l]=b.useState(!0);ae.useEffect(()=>{t!==void 0&&l(t?.enable_premium_pizza_visualization!==!1)},[t?.enable_premium_pizza_visualization]);const c=de({mutationFn:async i=>{if(!t?.id)throw new Error("Loja no encontrada");return await _e.entities.Store.update(t.id,{enable_premium_pizza_visualization:i})},onSuccess:()=>{s.invalidateQueries({queryKey:["store"]}),K.success("Configurao salva com sucesso!")},onError:i=>{K.error("Erro ao salvar configurao"),console.error(i)}}),d=i=>{l(i),c.mutate(i)};return r?e.jsx(Q,{className:"border-2 border-gray-200 dark:border-gray-700",children:e.jsx(he,{children:e.jsx(xe,{children:"Carregando..."})})}):e.jsxs(Q,{className:"border-2 border-orange-500/20 dark:border-orange-500/30 bg-gradient-to-br from-white to-orange-50/30 dark:from-gray-900 dark:to-orange-950/20",children:[e.jsx(he,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center shadow-lg",children:e.jsx(rr,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsxs(xe,{className:"text-xl flex items-center gap-2",children:["Visualizao Premium de Pizza",n&&e.jsx(Qe.span,{animate:{rotate:[0,10,-10,0]},transition:{duration:2,repeat:1/0},children:""})]}),e.jsx(xs,{className:"mt-1",children:"Ative animaes picas e efeitos especiais para impressionar seus clientes"})]})]})}),e.jsxs(Z,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-xl bg-white/50 dark:bg-gray-800/50 border-2 border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(R,{htmlFor:"premium-mode",className:"text-base font-semibold cursor-pointer",children:"Modo Premium"}),e.jsx(Bo,{className:"w-4 h-4 text-gray-500"})]}),e.jsx(Ve,{id:"premium-mode",checked:n,onCheckedChange:d,disabled:c.isPending})]}),e.jsx("div",{className:"p-4 rounded-xl bg-blue-50 dark:bg-blue-950/20 border-2 border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(sn,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-900 dark:text-blue-100 mb-1",children:"Imagem da Borda"}),e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:["Para adicionar imagem  borda, v em ",e.jsx("strong",{children:"Pizza  Sabores e Bordas"})," e edite a borda desejada. Cada borda pode ter sua prpria imagem que preencher o crculo da borda na pizza."]})]})]})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:`p-4 rounded-xl border-2 transition-all ${n?"border-gray-300 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-900/50":"border-green-500 bg-green-50/50 dark:bg-green-950/20"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gray-500 flex items-center justify-center text-white text-sm",children:""}),e.jsx("h4",{className:"font-semibold",children:"Modo Normal"})]}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-gray-400",children:""}),e.jsx("span",{children:"Animaes bsicas"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-gray-400",children:""}),e.jsx("span",{children:"Carregamento mais rpido"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-gray-400",children:""}),e.jsx("span",{children:"Funcional e limpo"})]})]})]}),e.jsxs("div",{className:`p-4 rounded-xl border-2 transition-all ${n?"border-orange-500 bg-gradient-to-br from-orange-50 to-yellow-50 dark:from-orange-950/30 dark:to-yellow-950/20":"border-gray-300 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-900/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center text-white text-sm shadow-lg",children:""}),e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:["Modo Premium",e.jsx(Fs,{className:"w-4 h-4 text-yellow-500 fill-current"})]})]}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Xr,{className:"w-4 h-4 text-orange-500 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Ingredientes caindo"})," ao montar"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Hu,{className:"w-4 h-4 text-orange-500 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Fumaa e vapor"})," na borda recheada"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(rr,{className:"w-4 h-4 text-yellow-500 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Sparkles e brilhos"})," animados"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Fs,{className:"w-4 h-4 text-yellow-500 flex-shrink-0 mt-0.5 fill-current"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Efeito de forno"})," com calor radiante"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-orange-500 font-bold",children:""}),e.jsxs("span",{children:[e.jsx("strong",{children:"Experincia premium"})," que vende mais"]})]})]})]})]}),e.jsx(Qe.div,{className:"p-4 rounded-xl bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-950/20 dark:to-purple-950/20 border-2 border-blue-200 dark:border-blue-800",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white flex-shrink-0",children:""}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-900 dark:text-white mb-1",children:"Dica de Especialista SaaS"}),e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Restaurantes que usam o ",e.jsx("strong",{children:"Modo Premium"})," reportam at ",e.jsx("strong",{className:"text-orange-600 dark:text-orange-400",children:"35% mais engajamento"})," dos clientes e ",e.jsx("strong",{className:"text-orange-600 dark:text-orange-400",children:"aumento de 20% no ticket mdio"}),". As animaes picas criam uma experincia memorvel que faz o cliente voltar!"]})]})]})}),e.jsx("div",{className:"flex justify-center pt-2",children:e.jsxs(A,{onClick:()=>window.open("/s/demo-pizzaria","_blank"),variant:"outline",className:"gap-2",children:[e.jsx(rr,{className:"w-4 h-4"}),"Ver Demo Interativa"]})})]})]})}const er=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s||0);function q0(){const[s,a]=b.useState(null),[t,r]=b.useState(!1),[n,l]=b.useState(null),c=ts(),{menuContext:d}=as();ae.useEffect(()=>{(async()=>{try{const F=await _e.auth.me();a(F)}catch(F){console.error("Error loading user:",F)}})()},[]);const i=d?.type==="slug"?d?.value:null,{data:o}=ke({queryKey:["publicCardapio",i],queryFn:async()=>i?await _e.get(`/public/cardapio/${i}`):null,enabled:!!i,staleTime:3e4,gcTime:6e4}),{data:m=[],refetch:p,isLoading:x}=ke({queryKey:["dishes",d?.type,d?.value],queryFn:async()=>d?await wl(d):[],enabled:!!d,placeholderData:Pt,refetchOnMount:"always",refetchOnWindowFocus:!1,staleTime:3e4,gcTime:6e4});ae.useEffect(()=>{d&&m.length===0&&!x&&!o?.dishes?.length&&p()},[d?.type,d?.value]);const f=((i&&o?.dishes?o.dishes:m||[])||[]).filter(h=>h.product_type==="pizza"),{data:y=[]}=ke({queryKey:["pizzaSizes",d?.type,d?.value],queryFn:async()=>{if(!d)return[];const h=d.type==="subscriber"&&d.value?{as_subscriber:d.value}:{};return _e.entities.PizzaSize.list("order",h)},enabled:!!d&&!i}),v=i&&o?.pizzaSizes?.length?o.pizzaSizes:y||[],{data:P=[]}=ke({queryKey:["pizzaFlavors",d?.type,d?.value],queryFn:async()=>{if(!d)return[];const h=d.type==="subscriber"&&d.value?{as_subscriber:d.value}:{};return _e.entities.PizzaFlavor.list("order",h)},enabled:!!d&&!i}),M=i&&o?.pizzaFlavors?.length?o.pizzaFlavors:P||[],{data:O=[]}=ke({queryKey:["pizzaEdges",d?.type,d?.value],queryFn:async()=>{if(!d)return[];const h=d.type==="subscriber"&&d.value?{as_subscriber:d.value}:{};return _e.entities.PizzaEdge.list("order",h)},enabled:!!d&&!i}),E=i&&o?.pizzaEdges?.length?o.pizzaEdges:O||[],{data:u=[]}=ke({queryKey:["pizzaExtras"],queryFn:()=>_e.entities.PizzaExtra.list("order"),enabled:!i}),_=i&&o?.pizzaExtras?.length?o.pizzaExtras:u||[],{data:$=[]}=ke({queryKey:["categories"],queryFn:()=>_e.entities.Category.list("order")}),{data:j=[]}=ke({queryKey:["pizzaCategories",d?.type,d?.value],queryFn:async()=>{if(!d)return[];const h=d.type==="subscriber"&&d.value?{as_subscriber:d.value}:{};return _e.entities.PizzaCategory.list("order",h)},enabled:!!d&&!i}),D=i&&o?.pizzaCategories?.length?o.pizzaCategories:j||[],V=de({mutationFn:h=>_e.entities.Dish.create({...h,product_type:"pizza",subscriber_email:s?.subscriber_email||s?.email}),onSuccess:()=>{c.invalidateQueries({queryKey:["pizzas"]}),c.invalidateQueries({queryKey:["dishes"]}),i&&c.invalidateQueries({queryKey:["publicCardapio",i]}),K.success("Pizza criada!"),r(!1),l(null)}}),T=de({mutationFn:({id:h,data:F})=>_e.entities.Dish.update(h,F),onSuccess:()=>{c.invalidateQueries({queryKey:["pizzas"]}),c.invalidateQueries({queryKey:["dishes"]}),i&&c.invalidateQueries({queryKey:["publicCardapio",i]}),K.success("Pizza atualizada!"),r(!1),l(null)}}),N=de({mutationFn:h=>_e.entities.Dish.delete(h),onSuccess:()=>{c.invalidateQueries({queryKey:["pizzas"]}),c.invalidateQueries({queryKey:["dishes"]}),i&&c.invalidateQueries({queryKey:["publicCardapio",i]}),K.success("Pizza excluda!")}}),z=v.length>0&&M.length>0,k=(h=null)=>{l(h||null),r(!0)};return e.jsxs("div",{className:"space-y-4",children:[!z&&e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-xl p-4 flex items-start gap-3",children:[e.jsx(Yt,{className:"w-5 h-5 text-orange-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-orange-900",children:"Configure os itens necessrios primeiro"}),e.jsx("p",{className:"text-sm text-orange-700 mt-1",children:"Para criar pizzas, voc precisa cadastrar pelo menos:"}),e.jsxs("ul",{className:"text-sm text-orange-700 mt-2 space-y-1",children:[v.length===0&&e.jsx("li",{children:" 1 Tamanho na seo Tamanhos ( direita)"}),M.length===0&&e.jsx("li",{children:" 1 Sabor na seo Sabores ( direita)"})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Minhas Pizzas"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Gerencie as pizzas do seu cardpio"})]}),e.jsxs(A,{onClick:()=>k(),className:"bg-orange-500",disabled:!z,children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Nova Pizza"]})]}),e.jsxs("div",{className:"space-y-6",children:[f.length>0&&(()=>{const h={},F=[...D||[]].sort((q,J)=>(q.order??999)-(J.order??999));return F.forEach(q=>{h[q.id]={category:q,pizzas:[]}}),h._sem_categoria={category:{name:"Sem categoria",id:"_sem_categoria"},pizzas:[]},f.forEach(q=>{const J=q.pizza_category_id||"_sem_categoria";h[J]||(h[J]={category:{name:"Outros",id:J},pizzas:[]}),h[J].pizzas.push(q)}),F.map(q=>h[q.id]).filter(Boolean).concat(h._sem_categoria.pizzas.length>0?[h._sem_categoria]:[]).map(({category:q,pizzas:J})=>e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-600 dark:text-gray-400 mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-1 h-4 rounded bg-orange-500"}),q.name,e.jsx(ye,{variant:"secondary",className:"text-xs",children:J.length})]}),e.jsx("div",{className:"grid gap-4",children:J.map(W=>e.jsx("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-xl border dark:border-gray-700",children:e.jsxs("div",{className:"flex items-start gap-4",children:[W.image&&e.jsx("img",{src:W.image,alt:W.name,className:"w-24 h-24 rounded-lg object-cover"}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:W.name}),W.description&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:W.description}),W.pizza_config?.sizes&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:W.pizza_config.sizes.map(C=>e.jsxs(ye,{variant:"outline",className:"text-xs",children:[C.name,": ",er(C.price_tradicional)]},C.id))}),W.is_highlight&&e.jsx(ye,{className:"mt-2 bg-yellow-100 text-yellow-700",children:" Destaque"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{checked:W.is_active!==!1,onCheckedChange:C=>T.mutate({id:W.id,data:{is_active:C}})}),e.jsx(A,{variant:"ghost",size:"icon",onClick:()=>k(W),children:e.jsx(qs,{className:"w-4 h-4"})}),e.jsx(A,{variant:"ghost",size:"icon",onClick:()=>{confirm("Excluir esta pizza?")&&N.mutate(W.id)},className:"text-red-500",children:e.jsx(Xe,{className:"w-4 h-4"})})]})]})})]})},W.id))})]},q.id))})(),f.length===0&&z&&e.jsxs("div",{className:"text-center py-12 text-gray-400",children:[e.jsx("p",{children:"Nenhuma pizza cadastrada ainda"}),e.jsx("p",{className:"text-sm mt-1",children:'Clique em "Nova Pizza" para comear'})]})]}),e.jsx($0,{isOpen:t,onClose:()=>{r(!1),l(null)},onSubmit:h=>{n?T.mutate({id:n.id,data:h}):V.mutate(h)},pizza:n,sizes:v,flavors:M,edges:E,extras:_,categories:$,pizzaCategories:D})]})}function $0({isOpen:s,onClose:a,onSubmit:t,pizza:r,sizes:n,flavors:l,edges:c,extras:d,categories:i,pizzaCategories:o=[]}){const[m,p]=b.useState(null),[x,g]=b.useState({name:"",description:"",image:"",category_id:"",pizza_category_id:"",default_flavor_id:"",division_mode:"slices",is_highlight:!1,is_active:!0,is_new:!1,is_popular:!1,pizza_config:{sizes:[],flavor_ids:[],edges:[],extras:[]}});ae.useEffect(()=>{if(r){const u=l.find(_=>_.id===r.default_flavor_id);p(u),g({name:r.name||"",description:r.description||"",image:r.image||"",category_id:r.category_id||"",pizza_category_id:r.pizza_category_id||"",default_flavor_id:r.default_flavor_id||"",division_mode:r.division_mode||"slices",is_highlight:r.is_highlight||!1,is_active:r.is_active!==!1,is_new:r.is_new||!1,is_popular:r.is_popular||!1,pizza_config:r.pizza_config||{sizes:[],flavor_ids:[],edges:[],extras:[]}})}else p(null),g({name:"",description:"",image:"",category_id:i[0]?.id||"",pizza_category_id:o[0]?.id||"",default_flavor_id:"",division_mode:"slices",is_highlight:!1,is_active:!0,is_new:!1,is_popular:!1,pizza_config:{sizes:n.map(u=>({id:u.id,name:u.name,slices:u.slices,max_flavors:u.max_flavors,price_tradicional:u.price_tradicional,price_premium:u.price_premium})),flavor_ids:l.filter(u=>u.is_active!==!1).map(u=>u.id),edges:c.filter(u=>u.is_active!==!1).map(u=>({id:u.id,name:u.name,price:u.price,is_active:u.is_active,is_popular:u.is_popular})),extras:d.filter(u=>u.is_active!==!1).map(u=>({id:u.id,name:u.name,price:u.price,is_active:u.is_active}))}})},[r,s,n,l,c,d,i,o]);const f=u=>{p(u),g(_=>({..._,name:`Pizza ${u.name}`,default_flavor_id:u.id,image:u.image||_.image,description:u.description||_.description}))},y=async u=>{const _=u.target.files?.[0];if(_)try{const{uploadToCloudinary:$}=await lt(async()=>{const{uploadToCloudinary:D}=await import("./cloudinaryUpload-vqCefYaz.js");return{uploadToCloudinary:D}},__vite__mapDeps([0,1,2])),j=await $(_,"dishes");if(!j){K.error("Erro ao obter URL da imagem");return}g(D=>({...D,image:j}))}catch($){console.error($),K.error("Falha ao enviar imagem")}},v=u=>{if(u.preventDefault(),!m&&!r){K.error("Selecione o sabor base da pizza");return}if(!x.pizza_config.sizes||x.pizza_config.sizes.length===0){K.error("Selecione pelo menos um tamanho");return}if(!x.pizza_config.flavor_ids||x.pizza_config.flavor_ids.length===0){K.error("Selecione pelo menos um sabor");return}const _={...x};if(o.length>0&&_.pizza_category_id&&!_.category_id){const $=i.find(j=>j.name?.toLowerCase().includes("pizza"))||i[0];_.category_id=$?.id||""}t(_)},P=u=>{const _=x.pizza_config.sizes||[],$=_.find(j=>j.id===u.id);g($?j=>({...j,pizza_config:{...j.pizza_config,sizes:_.filter(D=>D.id!==u.id)}}):j=>({...j,pizza_config:{...j.pizza_config,sizes:[..._,{id:u.id,name:u.name,slices:u.slices,max_flavors:u.max_flavors,price_tradicional:u.price_tradicional,price_premium:u.price_premium}]}}))},M=u=>{const _=x.pizza_config.flavor_ids||[];_.includes(u)?g($=>({...$,pizza_config:{...$.pizza_config,flavor_ids:_.filter(j=>j!==u)}})):g($=>({...$,pizza_config:{...$.pizza_config,flavor_ids:[..._,u]}}))},O=u=>{const _=x.pizza_config.edges||[],$=_.find(j=>j.id===u.id);g($?j=>({...j,pizza_config:{...j.pizza_config,edges:_.filter(D=>D.id!==u.id)}}):j=>({...j,pizza_config:{...j.pizza_config,edges:[..._,{id:u.id,name:u.name,price:u.price,is_active:u.is_active,is_popular:u.is_popular}]}}))},E=u=>{const _=x.pizza_config.extras||[],$=_.find(j=>j.id===u.id);g($?j=>({...j,pizza_config:{...j.pizza_config,extras:_.filter(D=>D.id!==u.id)}}):j=>({...j,pizza_config:{...j.pizza_config,extras:[..._,{id:u.id,name:u.name,price:u.price,is_active:u.is_active}]}}))};return e.jsx(Re,{open:s,onOpenChange:a,children:e.jsxs(Le,{className:"sm:max-w-3xl max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsx(Ie,{children:e.jsxs(qe,{children:[r?"Editar":"Nova"," Pizza"]})}),e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[!r&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-1 text-gray-900 dark:text-gray-100",children:"Sabor Padro da Pizza *"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-3",children:"Escolha qual sabor ser o base desta pizza"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:" Tradicionais"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:l.filter(u=>u.category==="tradicional"&&u.is_active).map(u=>e.jsx("button",{type:"button",onClick:()=>f(u),className:`p-3 rounded-lg border-2 text-left transition-all ${m?.id===u.id?"border-orange-500 bg-orange-50 dark:bg-orange-900/30 dark:border-orange-400":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 bg-white dark:bg-gray-800"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[u.image&&e.jsx("img",{src:u.image,alt:u.name,className:"w-12 h-12 rounded object-cover"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:u.name}),m?.id===u.id&&e.jsx(ye,{className:"text-xs mt-1 bg-orange-500 dark:bg-orange-600",children:"Selecionado"})]})]})},u.id))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:" Premium"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:l.filter(u=>u.category==="premium"&&u.is_active).map(u=>e.jsx("button",{type:"button",onClick:()=>f(u),className:`p-3 rounded-lg border-2 text-left transition-all ${m?.id===u.id?"border-orange-500 bg-orange-50 dark:bg-orange-900/30 dark:border-orange-400":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 bg-white dark:bg-gray-800"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[u.image&&e.jsx("img",{src:u.image,alt:u.name,className:"w-12 h-12 rounded object-cover"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:u.name}),m?.id===u.id&&e.jsx(ye,{className:"text-xs mt-1 bg-orange-500 dark:bg-orange-600",children:"Selecionado"})]})]})},u.id))})]})]}),m&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Informaes da Pizza"}),e.jsx("div",{className:"bg-orange-50 dark:bg-orange-900/30 border border-orange-200 dark:border-orange-800 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-orange-800 dark:text-orange-200",children:[" Sabor base: ",e.jsx("strong",{children:m.name})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Categoria *"}),e.jsxs(Se,{value:o.length>0?x.pizza_category_id||"":x.category_id||"",onValueChange:u=>g(_=>o.length>0?{..._,pizza_category_id:u}:{..._,category_id:u}),children:[e.jsx(De,{children:e.jsx(Me,{placeholder:o.length?"Ex: Pizza M 1 sabor":"Selecione"})}),e.jsx(Ae,{children:o.length>0?o.map(u=>{const _=n.find(j=>j.id===u.size_id),$=u.name||(_?`${_.name}  ${u.max_flavors||1} sabor(es)`:u.id);return e.jsx(X,{value:u.id,children:$},u.id)}):i.map(u=>e.jsx(X,{value:u.id,children:u.name},u.id))})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:o.length?"Por tamanho e quantidade de sabores (Configurao > Categorias)":"Sem categorias de pizza. Crie em Configurao > Categorias"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Modo de Diviso *"}),e.jsxs(Se,{value:x.division_mode,onValueChange:u=>g(_=>({..._,division_mode:u})),children:[e.jsx(De,{children:e.jsx(Me,{})}),e.jsxs(Ae,{children:[e.jsx(X,{value:"slices",children:" Por Fatias (Livre)"}),e.jsx(X,{value:"exact",children:" Diviso Exata (Automtica)"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:x.division_mode==="slices"?"Cliente escolhe quantas fatias de cada sabor":"Diviso automtica igual entre sabores"})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Descrio (opcional)"}),e.jsx(Os,{value:x.description,onChange:u=>g(_=>({..._,description:u.target.value})),placeholder:"Personalize a descrio...",rows:2})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Imagem (opcional)"}),e.jsx(B,{type:"file",accept:"image/*",onChange:y}),x.image&&e.jsx("img",{src:x.image,alt:"",className:"mt-2 w-20 h-20 object-cover rounded"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Se no enviar, ser usada a imagem do sabor base"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded",children:[e.jsx(R,{className:"text-gray-900 dark:text-gray-100",children:" Destaque"}),e.jsx(Ve,{checked:x.is_highlight,onCheckedChange:u=>g(_=>({..._,is_highlight:u}))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded",children:[e.jsx(R,{className:"text-gray-900 dark:text-gray-100",children:" Novo"}),e.jsx(Ve,{checked:x.is_new,onCheckedChange:u=>g(_=>({..._,is_new:u}))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded",children:[e.jsx(R,{className:"text-gray-900 dark:text-gray-100",children:" Popular"}),e.jsx(Ve,{checked:x.is_popular,onCheckedChange:u=>g(_=>({..._,is_popular:u}))})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Tamanhos Disponveis *"}),e.jsx("div",{className:"grid gap-2",children:n.map(u=>{const _=x.pizza_config.sizes?.some($=>$.id===u.id);return e.jsxs("label",{className:`flex items-center justify-between p-3 rounded-lg border-2 cursor-pointer transition-all ${_?"border-orange-500 bg-orange-50 dark:bg-orange-900/30 dark:border-orange-400":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 bg-white dark:bg-gray-800"}`,onClick:()=>P(u),children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:u.name}),e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:[u.slices," fatias  At ",u.max_flavors," sabores"]})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-green-600 dark:text-green-400 font-semibold",children:er(u.price_tradicional)}),e.jsx("p",{className:"text-orange-600 dark:text-orange-400 font-semibold",children:er(u.price_premium)})]})]},u.id)})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Sabores Disponveis *"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:l.map(u=>{const _=x.pizza_config.flavor_ids?.includes(u.id);return e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all ${_?"border-orange-500 bg-orange-50 dark:bg-orange-900/30 dark:border-orange-400":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 bg-white dark:bg-gray-800"}`,onClick:()=>M(u.id),children:[u.image&&e.jsx("img",{src:u.image,alt:u.name,className:"w-12 h-12 rounded object-cover"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:u.name}),e.jsx(ye,{variant:"outline",className:"text-xs mt-1 dark:border-gray-600 dark:text-gray-300",children:u.category==="premium"?" Premium":" Tradicional"})]})]},u.id)})})]}),c.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Bordas Disponveis (opcional)"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:c.map(u=>{const _=x.pizza_config.edges?.some($=>$.id===u.id);return e.jsxs("label",{className:`flex items-center justify-between p-3 rounded-lg border-2 cursor-pointer transition-all ${_?"border-orange-500 bg-orange-50 dark:bg-orange-900/30 dark:border-orange-400":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 bg-white dark:bg-gray-800"}`,onClick:()=>O(u),children:[e.jsx("p",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:u.name}),e.jsx("p",{className:"text-sm text-orange-600 dark:text-orange-400 font-semibold",children:er(u.price)})]},u.id)})})]}),d.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Extras Disponveis (opcional)"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:d.map(u=>{const _=x.pizza_config.extras?.some($=>$.id===u.id);return e.jsxs("label",{className:`flex items-center justify-between p-3 rounded-lg border-2 cursor-pointer transition-all ${_?"border-orange-500 bg-orange-50 dark:bg-orange-900/30 dark:border-orange-400":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 bg-white dark:bg-gray-800"}`,onClick:()=>E(u),children:[e.jsx("p",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:u.name}),e.jsx("p",{className:"text-sm text-orange-600 dark:text-orange-400 font-semibold",children:er(u.price)})]},u.id)})})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(A,{type:"button",variant:"outline",onClick:a,className:"flex-1 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700",children:"Cancelar"}),e.jsx(A,{type:"submit",className:"flex-1 bg-orange-500 hover:bg-orange-600 dark:bg-orange-600 dark:hover:bg-orange-700 text-white",children:r?"Salvar":"Criar Pizza"})]})]})]})})}const xi=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s||0);function vv(){const[s,a]=ae.useState(null),[t,r]=b.useState("pizzas"),[n,l]=b.useState(""),[c,d]=b.useState(!1),[i,o]=b.useState(!1),[m,p]=b.useState(!1),[x,g]=b.useState(!1),[f,y]=b.useState(!1),[v,P]=b.useState(null),[M,O]=b.useState(null),[E,u]=b.useState(null),[_,$]=b.useState(null),[j,D]=b.useState(null),V=ts(),{menuContext:T}=as(),N=T?.type==="slug"?T?.value:null;ae.useEffect(()=>{(async()=>{try{const re=await _e.auth.me();a(re)}catch(re){console.error("Error loading user:",re)}})()},[]);const{data:z}=ke({queryKey:["publicCardapio",N],queryFn:async()=>N?await _e.get(`/public/cardapio/${N}`):null,enabled:!!N,staleTime:3e4,gcTime:6e4}),{data:k=[]}=ke({queryKey:["pizzaSizes",T?.type,T?.value],queryFn:async()=>{if(!T)return[];const U=T.type==="subscriber"&&T.value?{as_subscriber:T.value}:{};return _e.entities.PizzaSize.list("order",U)},enabled:!!T&&!N}),h=N&&Array.isArray(z?.pizzaSizes)?z.pizzaSizes:k||[],{data:F=[]}=ke({queryKey:["pizzaFlavors",T?.type,T?.value],queryFn:async()=>{if(!T)return[];const U=T.type==="subscriber"&&T.value?{as_subscriber:T.value}:{};return _e.entities.PizzaFlavor.list("order",U)},enabled:!!T&&!N}),S=N&&Array.isArray(z?.pizzaFlavors)?z.pizzaFlavors:F||[],{data:q=[]}=ke({queryKey:["pizzaEdges",T?.type,T?.value],queryFn:async()=>{if(!T)return[];const U=T.type==="subscriber"&&T.value?{as_subscriber:T.value}:{};return _e.entities.PizzaEdge.list("order",U)},enabled:!!T&&!N}),J=N&&Array.isArray(z?.pizzaEdges)?z.pizzaEdges:q||[],{data:W=[]}=ke({queryKey:["pizzaExtras",T?.type,T?.value],queryFn:async()=>{if(!T)return[];const U=T.type==="subscriber"&&T.value?{as_subscriber:T.value}:{};return _e.entities.PizzaExtra.list("order",U)},enabled:!!T&&!N}),C=N&&Array.isArray(z?.pizzaExtras)?z.pizzaExtras:W||[],{data:Y=[]}=ke({queryKey:["pizzaCategories",T?.type,T?.value],queryFn:async()=>{if(!T)return[];const U=T.type==="subscriber"&&T.value?{as_subscriber:T.value}:{};return _e.entities.PizzaCategory.list("order",U)},enabled:!!T&&!N}),L=N&&Array.isArray(z?.pizzaCategories)?z.pizzaCategories:Y||[],oe=de({mutationFn:U=>_e.entities.PizzaSize.create({...U,subscriber_email:s?.subscriber_email||s?.email}),onSuccess:()=>{V.invalidateQueries({queryKey:["pizzaSizes"]}),N&&V.invalidateQueries({queryKey:["publicCardapio",N]}),K.success("Tamanho criado!"),d(!1),P(null)}}),Pe=de({mutationFn:({id:U,data:re})=>_e.entities.PizzaSize.update(U,re),onSuccess:()=>{V.invalidateQueries({queryKey:["pizzaSizes"]}),N&&V.invalidateQueries({queryKey:["publicCardapio",N]}),K.success("Tamanho atualizado!"),d(!1),P(null)}}),ve=de({mutationFn:U=>_e.entities.PizzaSize.delete(U),onSuccess:()=>{V.invalidateQueries({queryKey:["pizzaSizes"]}),N&&V.invalidateQueries({queryKey:["publicCardapio",N]}),K.success("Tamanho excludo!")}}),G=de({mutationFn:U=>_e.entities.PizzaFlavor.create({...U,subscriber_email:s?.subscriber_email||s?.email}),onSuccess:()=>{V.invalidateQueries({queryKey:["pizzaFlavors"]}),N&&V.invalidateQueries({queryKey:["publicCardapio",N]}),K.success("Sabor criado!"),o(!1),O(null)}}),ne=de({mutationFn:({id:U,data:re})=>_e.entities.PizzaFlavor.update(U,re),onSuccess:()=>{V.invalidateQueries({queryKey:["pizzaFlavors"]}),N&&V.invalidateQueries({queryKey:["publicCardapio",N]}),K.success("Sabor atualizado!"),o(!1),O(null)}}),fe=de({mutationFn:U=>_e.entities.PizzaFlavor.delete(U),onSuccess:()=>{V.invalidateQueries({queryKey:["pizzaFlavors"]}),N&&V.invalidateQueries({queryKey:["publicCardapio",N]}),K.success("Sabor excludo!")}}),ge=de({mutationFn:U=>_e.entities.PizzaEdge.create({...U,subscriber_email:s?.subscriber_email||s?.email}),onSuccess:()=>{V.invalidateQueries({queryKey:["pizzaEdges"]}),N&&V.invalidateQueries({queryKey:["publicCardapio",N]}),K.success("Borda criada!"),p(!1),u(null)}}),Ee=de({mutationFn:({id:U,data:re})=>_e.entities.PizzaEdge.update(U,re),onSuccess:()=>{V.invalidateQueries({queryKey:["pizzaEdges"]}),N&&V.invalidateQueries({queryKey:["publicCardapio",N]}),K.success("Borda atualizada!"),p(!1),u(null)}}),H=de({mutationFn:U=>_e.entities.PizzaEdge.delete(U),onSuccess:()=>{V.invalidateQueries({queryKey:["pizzaEdges"]}),N&&V.invalidateQueries({queryKey:["publicCardapio",N]}),K.success("Borda excluda!")}}),ie=de({mutationFn:U=>_e.entities.PizzaExtra.create({...U,subscriber_email:s?.subscriber_email||s?.email}),onSuccess:()=>{V.invalidateQueries({queryKey:["pizzaExtras"]}),N&&V.invalidateQueries({queryKey:["publicCardapio",N]}),K.success("Extra criado!"),g(!1),$(null)}}),me=de({mutationFn:({id:U,data:re})=>_e.entities.PizzaExtra.update(U,re),onSuccess:()=>{V.invalidateQueries({queryKey:["pizzaExtras"]}),N&&V.invalidateQueries({queryKey:["publicCardapio",N]}),K.success("Extra atualizado!"),g(!1),$(null)}}),ze=de({mutationFn:U=>_e.entities.PizzaExtra.delete(U),onSuccess:()=>{V.invalidateQueries({queryKey:["pizzaExtras"]}),N&&V.invalidateQueries({queryKey:["publicCardapio",N]}),K.success("Extra excludo!")}}),Je=de({mutationFn:U=>_e.entities.PizzaCategory.create({...U,subscriber_email:s?.subscriber_email||s?.email}),onSuccess:()=>{V.invalidateQueries({queryKey:["pizzaCategories"]}),N&&V.invalidateQueries({queryKey:["publicCardapio",N]}),K.success("Categoria criada!"),y(!1),D(null)}}),ce=de({mutationFn:({id:U,data:re})=>_e.entities.PizzaCategory.update(U,re),onSuccess:()=>{V.invalidateQueries({queryKey:["pizzaCategories"]}),N&&V.invalidateQueries({queryKey:["publicCardapio",N]}),K.success("Categoria atualizada!"),y(!1),D(null)}}),We=de({mutationFn:U=>_e.entities.PizzaCategory.delete(U),onSuccess:()=>{V.invalidateQueries({queryKey:["pizzaCategories"]}),N&&V.invalidateQueries({queryKey:["publicCardapio",N]}),K.success("Categoria excluda!")}});return e.jsxs("div",{className:"p-6",children:[e.jsx(Hr,{position:"top-center"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Configurao de Pizzas"}),e.jsx("p",{className:"text-gray-600",children:"Gerencie tamanhos, sabores, bordas e extras para suas pizzas"})]}),e.jsxs(Ui,{value:t,onValueChange:r,children:[e.jsxs(Bi,{className:"grid grid-cols-2 w-full max-w-xs",children:[e.jsx(la,{value:"pizzas",children:"Minhas Pizzas"}),e.jsxs(la,{value:"visual",children:[e.jsx(ut,{className:"w-4 h-4 mr-1"}),"Visual"]})]}),e.jsx(oa,{value:"pizzas",className:"mt-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1fr_300px] gap-4",children:[e.jsx(q0,{}),e.jsxs(Q,{className:"p-4 h-fit",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Configurao"}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Tamanhos, sabores, bordas e extras"}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ms,{className:"absolute left-2 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(B,{placeholder:"Buscar sabores, bordas ou extras...",value:n,onChange:U=>{l(U.target.value)},className:"pl-8 text-sm"})]})}),e.jsxs(wd,{type:"multiple",defaultValue:["categories","sizes","flavors"],className:"w-full",children:[e.jsxs(Ka,{value:"categories",className:"border rounded-lg px-2",children:[e.jsxs(Qa,{className:"py-2 text-sm font-medium hover:no-underline",children:["Categorias (",L.length,")  como em Pratos"]}),e.jsxs(Za,{className:"pb-2",children:[e.jsx("p",{className:"text-[10px] text-gray-500 mb-2",children:"Ex: Pizza M 1 sabor, Pizza G 2 sabores. Separam pizzas no cardpio. Reordene com as setas."}),e.jsxs(A,{size:"sm",onClick:()=>{D(null),y(!0)},className:"mb-2 w-full",children:[e.jsx($e,{className:"w-3 h-3 mr-1"}),"Nova Categoria"]}),e.jsx("div",{className:"space-y-1",children:L.map((U,re)=>{const ds=h.find(ra=>ra.id===U.size_id),ta=ra=>{const ls=ra==="up"?re-1:re+1;if(ls<0||ls>=L.length)return;const zs=L[re],bs=L[ls];ce.mutate({id:zs.id,data:{...zs,order:ls}}),ce.mutate({id:bs.id,data:{...bs,order:re}})};return e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded border text-xs group",children:[e.jsxs("div",{className:"flex flex-col opacity-60 group-hover:opacity-100",children:[e.jsx("button",{type:"button",onClick:()=>ta("up"),disabled:re===0,className:"p-0.5 disabled:opacity-30",children:e.jsx(Ot,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:()=>ta("down"),disabled:re===L.length-1,className:"p-0.5 disabled:opacity-30",children:e.jsx(La,{className:"w-4 h-4"})})]}),e.jsxs("span",{className:"flex-1 truncate",children:[U.name||"Sem nome"," ",ds&&`(${ds.name}  ${U.max_flavors||1} sabor${(U.max_flavors||1)>1?"es":""})`]}),e.jsx(A,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>{D(U),y(!0)},children:e.jsx(qs,{className:"w-3 h-3"})}),e.jsx(A,{variant:"ghost",size:"icon",className:"h-6 w-6 text-red-500",onClick:()=>{confirm("Excluir?")&&We.mutate(U.id)},children:e.jsx(Xe,{className:"w-3 h-3"})})]},U.id)})})]})]}),e.jsxs(Ka,{value:"sizes",className:"border rounded-lg px-2",children:[e.jsxs(Qa,{className:"py-2 text-sm font-medium hover:no-underline",children:["Tamanhos (",h.length,")"]}),e.jsxs(Za,{className:"pb-2",children:[e.jsx("p",{className:"text-[10px] text-gray-500 mb-2",children:"Base: P, M, G com preo e fatias. Usados pelas categorias."}),e.jsxs(A,{size:"sm",onClick:()=>{P(null),d(!0)},className:"mb-2 w-full",children:[e.jsx($e,{className:"w-3 h-3 mr-1"}),"Novo Tamanho"]}),e.jsx("div",{className:"space-y-1",children:h.map(U=>e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded border text-xs",children:[e.jsxs("span",{className:"flex-1 truncate",children:[U.name,"  ",U.slices,"f  ",xi(U.price_tradicional)]}),e.jsx(Ve,{checked:U.is_active,onCheckedChange:re=>Pe.mutate({id:U.id,data:{...U,is_active:re}}),className:"scale-75"}),e.jsx(A,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>{P(U),d(!0)},children:e.jsx(qs,{className:"w-3 h-3"})}),e.jsx(A,{variant:"ghost",size:"icon",className:"h-6 w-6 text-red-500",onClick:()=>{confirm("Excluir?")&&ve.mutate(U.id)},children:e.jsx(Xe,{className:"w-3 h-3"})})]},U.id))})]})]}),e.jsxs(Ka,{value:"flavors",className:"border rounded-lg px-2",children:[e.jsxs(Qa,{className:"py-2 text-sm font-medium hover:no-underline",children:["Sabores (",S.length,")"]}),e.jsxs(Za,{className:"pb-2",children:[e.jsxs(A,{size:"sm",onClick:()=>{O(null),o(!0)},className:"mb-2 w-full",children:[e.jsx($e,{className:"w-3 h-3 mr-1"}),"Novo"]}),e.jsx("div",{className:"space-y-1",children:S.map(U=>e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded border text-xs",children:[U.image&&e.jsx("img",{src:U.image,alt:"",className:"w-8 h-8 rounded object-cover flex-shrink-0"}),e.jsx("span",{className:"flex-1 truncate",children:U.name}),e.jsx(ye,{variant:"outline",className:"text-[10px]",children:U.category==="premium"?"":""}),e.jsx(Ve,{checked:U.is_active,onCheckedChange:re=>ne.mutate({id:U.id,data:{...U,is_active:re}}),className:"scale-75"}),e.jsx(A,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>{O(U),o(!0)},children:e.jsx(qs,{className:"w-3 h-3"})}),e.jsx(A,{variant:"ghost",size:"icon",className:"h-6 w-6 text-red-500",onClick:()=>{confirm("Excluir?")&&fe.mutate(U.id)},children:e.jsx(Xe,{className:"w-3 h-3"})})]},U.id))})]})]}),e.jsxs(Ka,{value:"edges",className:"border rounded-lg px-2",children:[e.jsxs(Qa,{className:"py-2 text-sm font-medium hover:no-underline",children:["Bordas (",J.length,")"]}),e.jsxs(Za,{className:"pb-2",children:[e.jsxs(A,{size:"sm",onClick:()=>{u(null),p(!0)},className:"mb-2 w-full",children:[e.jsx($e,{className:"w-3 h-3 mr-1"}),"Nova"]}),e.jsx("div",{className:"space-y-1",children:J.map(U=>e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded border text-xs",children:[U.image&&e.jsx("img",{src:U.image,alt:"",className:"w-8 h-8 rounded object-cover flex-shrink-0"}),e.jsxs("span",{className:"flex-1 truncate",children:[U.name," ",xi(U.price)]}),e.jsx(Ve,{checked:U.is_active,onCheckedChange:re=>Ee.mutate({id:U.id,data:{...U,is_active:re}}),className:"scale-75"}),e.jsx(A,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>{u(U),p(!0)},children:e.jsx(qs,{className:"w-3 h-3"})}),e.jsx(A,{variant:"ghost",size:"icon",className:"h-6 w-6 text-red-500",onClick:()=>{confirm("Excluir?")&&H.mutate(U.id)},children:e.jsx(Xe,{className:"w-3 h-3"})})]},U.id))})]})]}),e.jsxs(Ka,{value:"extras",className:"border rounded-lg px-2",children:[e.jsxs(Qa,{className:"py-2 text-sm font-medium hover:no-underline",children:["Extras (",C.length,")"]}),e.jsxs(Za,{className:"pb-2",children:[e.jsxs(A,{size:"sm",onClick:()=>{$(null),g(!0)},className:"mb-2 w-full",children:[e.jsx($e,{className:"w-3 h-3 mr-1"}),"Novo"]}),e.jsx("div",{className:"space-y-1 max-h-96 overflow-y-auto",children:(n&&searchType==="extras"?filteredExtras:C).map(U=>e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded border text-xs",children:[U.image&&e.jsx("img",{src:U.image,alt:"",className:"w-8 h-8 rounded object-cover flex-shrink-0"}),e.jsxs("span",{className:"flex-1 truncate",children:[U.name," ",xi(U.price)]}),e.jsx(Ve,{checked:U.is_active,onCheckedChange:re=>me.mutate({id:U.id,data:{...U,is_active:re}}),className:"scale-75"}),e.jsx(A,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>{$(U),g(!0)},children:e.jsx(qs,{className:"w-3 h-3"})}),e.jsx(A,{variant:"ghost",size:"icon",className:"h-6 w-6 text-red-500",onClick:()=>{confirm("Excluir?")&&ze.mutate(U.id)},children:e.jsx(Xe,{className:"w-3 h-3"})})]},U.id))})]})]})]})]})]})}),e.jsx(oa,{value:"visual",className:"mt-4",children:e.jsx(I0,{})})]}),e.jsx(Y0,{isOpen:c,onClose:()=>{d(!1),P(null)},onSubmit:U=>{v?Pe.mutate({id:v.id,data:U}):oe.mutate({...U,order:h.length})},size:v}),e.jsx(G0,{isOpen:i,onClose:()=>{o(!1),O(null)},onSubmit:U=>{M?ne.mutate({id:M.id,data:U}):G.mutate({...U,order:S.length})},flavor:M}),e.jsx(V0,{isOpen:m,onClose:()=>{p(!1),u(null)},onSubmit:U=>{E?Ee.mutate({id:E.id,data:U}):ge.mutate({...U,order:J.length})},edge:E}),e.jsx(U0,{isOpen:x,onClose:()=>{g(!1),$(null)},onSubmit:U=>{_?me.mutate({id:_.id,data:U}):ie.mutate({...U,order:C.length})},extra:_}),e.jsx(B0,{isOpen:f,onClose:()=>{y(!1),D(null)},onSubmit:U=>{j?ce.mutate({id:j.id,data:U}):Je.mutate({...U,order:L.length})},category:j,sizes:h})]})}function Y0({isOpen:s,onClose:a,onSubmit:t,size:r}){const[n,l]=b.useState({name:"",slices:"",max_flavors:"",max_extras:"3",diameter_cm:"",price_tradicional:"",price_premium:"",is_active:!0});ae.useEffect(()=>{l(r?{name:r.name||"",slices:r.slices?.toString()||"",max_flavors:r.max_flavors?.toString()||"",max_extras:r.max_extras?.toString()||"3",diameter_cm:r.diameter_cm?.toString()||"",price_tradicional:r.price_tradicional?.toString()||"",price_premium:r.price_premium?.toString()||"",is_active:r.is_active!==!1}:{name:"",slices:"",max_flavors:"",max_extras:"3",diameter_cm:"",price_tradicional:"",price_premium:"",is_active:!0})},[r,s]);const c=d=>{d.preventDefault(),t({...n,slices:parseInt(n.slices),max_flavors:parseInt(n.max_flavors),max_extras:parseInt(n.max_extras)||3,diameter_cm:parseFloat(n.diameter_cm),price_tradicional:parseFloat(n.price_tradicional),price_premium:parseFloat(n.price_premium)})};return e.jsx(Re,{open:s,onOpenChange:a,children:e.jsxs(Le,{className:"sm:max-w-md max-w-[95vw]",children:[e.jsx(Ie,{children:e.jsxs(qe,{children:[r?"Editar":"Novo"," Tamanho"]})}),e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome *"}),e.jsx(B,{value:n.name,onChange:d=>l(i=>({...i,name:d.target.value})),placeholder:"Ex: Pequena, Mdia, Grande",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Fatias *"}),e.jsx(B,{type:"number",value:n.slices,onChange:d=>l(i=>({...i,slices:d.target.value})),placeholder:"Ex: 4",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Mx. Sabores (1-4) *"}),e.jsx(B,{type:"number",min:1,max:4,value:n.max_flavors,onChange:d=>l(i=>({...i,max_flavors:d.target.value})),placeholder:"Ex: 2",required:!0})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Mx. Extras"}),e.jsx(B,{type:"number",min:0,max:10,value:n.max_extras,onChange:d=>l(i=>({...i,max_extras:d.target.value})),placeholder:"Ex: 3"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Dimetro (cm)"}),e.jsx(B,{type:"number",value:n.diameter_cm,onChange:d=>l(i=>({...i,diameter_cm:d.target.value})),placeholder:"Ex: 35"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Preo Tradicional *"}),e.jsx(B,{type:"number",step:"0.01",value:n.price_tradicional,onChange:d=>l(i=>({...i,price_tradicional:d.target.value})),placeholder:"0.00",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Preo Premium *"}),e.jsx(B,{type:"number",step:"0.01",value:n.price_premium,onChange:d=>l(i=>({...i,price_premium:d.target.value})),placeholder:"0.00",required:!0})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(A,{type:"button",variant:"outline",onClick:a,className:"flex-1",children:"Cancelar"}),e.jsx(A,{type:"submit",className:"flex-1 bg-orange-500",children:"Salvar"})]})]})]})})}function G0({isOpen:s,onClose:a,onSubmit:t,flavor:r}){const[n,l]=b.useState({name:"",description:"",image:"",category:"tradicional",prep_time:"",is_active:!0,is_popular:!1});ae.useEffect(()=>{l(r?{name:r.name||"",description:r.description||"",image:r.image||"",category:r.category||"tradicional",prep_time:r.prep_time?.toString()||"",is_active:r.is_active!==!1,is_popular:r.is_popular||!1}:{name:"",description:"",image:"",category:"tradicional",prep_time:"",is_active:!0,is_popular:!1})},[r,s]);const c=async i=>{console.log(" [PizzaConfigTab] handleImageUpload chamado:",{event:i,target:i.target,files:i.target.files,filesLength:i.target.files?.length});const o=i.target.files?.[0];if(console.log(" [PizzaConfigTab] Arquivo extrado:",{file:o,isFile:o instanceof File,fileName:o?.name,fileSize:o?.size,fileType:o?.type}),!o){console.error(" [PizzaConfigTab] Nenhum arquivo encontrado no evento"),alert("Nenhum arquivo selecionado");return}if(!(o instanceof File)){console.error(" [PizzaConfigTab] Arquivo no  instncia de File:",typeof o),alert("Arquivo invlido");return}try{console.log(" [PizzaConfigTab] Iniciando upload...");const{uploadToCloudinary:m}=await lt(async()=>{const{uploadToCloudinary:x}=await import("./cloudinaryUpload-vqCefYaz.js");return{uploadToCloudinary:x}},__vite__mapDeps([0,1,2])),p=await m(o,"pizza-config");console.log(" [PizzaConfigTab] Upload concludo, URL:",p),l(x=>({...x,image:p}))}catch(m){console.error(" [PizzaConfigTab] Erro ao fazer upload:",m),alert("Erro ao fazer upload da imagem: "+m.message)}},d=i=>{i.preventDefault(),t({...n,prep_time:n.prep_time?parseInt(n.prep_time):null})};return e.jsx(Re,{open:s,onOpenChange:a,children:e.jsxs(Le,{className:"sm:max-w-md max-w-[95vw]",children:[e.jsx(Ie,{children:e.jsxs(qe,{children:[r?"Editar":"Novo"," Sabor"]})}),e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome *"}),e.jsx(B,{value:n.name,onChange:i=>l(o=>({...o,name:i.target.value})),placeholder:"Ex: Calabresa, Marguerita",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Descrio"}),e.jsx(Os,{value:n.description,onChange:i=>l(o=>({...o,description:i.target.value})),placeholder:"Ingredientes do sabor...",rows:2})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Categoria *"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{type:"button",onClick:()=>l(i=>({...i,category:"tradicional"})),className:`flex-1 py-3 px-4 rounded-lg border-2 font-medium transition-all ${n.category==="tradicional"?"border-orange-500 bg-orange-50 text-orange-700":"border-gray-200 hover:border-gray-300"}`,children:" Tradicional"}),e.jsx("button",{type:"button",onClick:()=>l(i=>({...i,category:"premium"})),className:`flex-1 py-3 px-4 rounded-lg border-2 font-medium transition-all ${n.category==="premium"?"border-orange-500 bg-orange-50 text-orange-700":"border-gray-200 hover:border-gray-300"}`,children:" Premium"})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Tempo de Preparo (min)"}),e.jsx(B,{type:"number",value:n.prep_time,onChange:i=>l(o=>({...o,prep_time:i.target.value})),placeholder:"Ex: 20"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Imagem"}),e.jsx(B,{type:"file",accept:"image/*",onChange:c}),n.image&&e.jsx("img",{src:n.image,alt:"",className:"mt-2 w-20 h-20 object-cover rounded"})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx(Ve,{checked:n.is_popular,onCheckedChange:i=>l(o=>({...o,is_popular:i}))}),e.jsx("span",{className:"text-sm",children:" Popular"})]})}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(A,{type:"button",variant:"outline",onClick:a,className:"flex-1",children:"Cancelar"}),e.jsx(A,{type:"submit",className:"flex-1 bg-orange-500",children:"Salvar"})]})]})]})})}function V0({isOpen:s,onClose:a,onSubmit:t,edge:r}){const[n,l]=b.useState({name:"",description:"",price:"",image:"",is_active:!0,is_popular:!1});ae.useEffect(()=>{l(r?{name:r.name||"",description:r.description||"",price:r.price?.toString()||"",image:r.image||"",is_active:r.is_active!==!1,is_popular:r.is_popular||!1}:{name:"",description:"",price:"",image:"",is_active:!0,is_popular:!1})},[r,s]);const c=async i=>{console.log(" [PizzaConfigTab] handleImageUpload chamado:",{event:i,target:i.target,files:i.target.files,filesLength:i.target.files?.length});const o=i.target.files?.[0];if(console.log(" [PizzaConfigTab] Arquivo extrado:",{file:o,isFile:o instanceof File,fileName:o?.name,fileSize:o?.size,fileType:o?.type}),!o){console.error(" [PizzaConfigTab] Nenhum arquivo encontrado no evento"),alert("Nenhum arquivo selecionado");return}if(!(o instanceof File)){console.error(" [PizzaConfigTab] Arquivo no  instncia de File:",typeof o),alert("Arquivo invlido");return}try{console.log(" [PizzaConfigTab] Iniciando upload...");const{uploadToCloudinary:m}=await lt(async()=>{const{uploadToCloudinary:x}=await import("./cloudinaryUpload-vqCefYaz.js");return{uploadToCloudinary:x}},__vite__mapDeps([0,1,2])),p=await m(o,"pizza-config");console.log(" [PizzaConfigTab] Upload concludo, URL:",p),l(x=>({...x,image:p}))}catch(m){console.error(" [PizzaConfigTab] Erro ao fazer upload:",m),alert("Erro ao fazer upload da imagem: "+m.message)}},d=i=>{i.preventDefault(),t({...n,price:parseFloat(n.price)})};return e.jsx(Re,{open:s,onOpenChange:a,children:e.jsxs(Le,{className:"sm:max-w-md max-w-[95vw]",children:[e.jsx(Ie,{children:e.jsxs(qe,{children:[r?"Editar":"Nova"," Borda"]})}),e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome *"}),e.jsx(B,{value:n.name,onChange:i=>l(o=>({...o,name:i.target.value})),placeholder:"Ex: Catupiry, Cheddar",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Descrio"}),e.jsx(Os,{value:n.description,onChange:i=>l(o=>({...o,description:i.target.value})),placeholder:"Descrio da borda...",rows:2})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Preo *"}),e.jsx(B,{type:"number",step:"0.01",value:n.price,onChange:i=>l(o=>({...o,price:i.target.value})),placeholder:"0.00",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Imagem"}),e.jsx(B,{type:"file",accept:"image/*",onChange:c}),n.image&&e.jsx("img",{src:n.image,alt:"",className:"mt-2 w-20 h-20 object-cover rounded"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(A,{type:"button",variant:"outline",onClick:a,className:"flex-1",children:"Cancelar"}),e.jsx(A,{type:"submit",className:"flex-1 bg-orange-500",children:"Salvar"})]})]})]})})}function U0({isOpen:s,onClose:a,onSubmit:t,extra:r}){const[n,l]=b.useState({name:"",description:"",price:"",image:"",is_active:!0});ae.useEffect(()=>{l(r?{name:r.name||"",description:r.description||"",price:r.price?.toString()||"",image:r.image||"",is_active:r.is_active!==!1}:{name:"",description:"",price:"",image:"",is_active:!0})},[r,s]);const c=async i=>{console.log(" [PizzaConfigTab] handleImageUpload chamado:",{event:i,target:i.target,files:i.target.files,filesLength:i.target.files?.length});const o=i.target.files?.[0];if(console.log(" [PizzaConfigTab] Arquivo extrado:",{file:o,isFile:o instanceof File,fileName:o?.name,fileSize:o?.size,fileType:o?.type}),!o){console.error(" [PizzaConfigTab] Nenhum arquivo encontrado no evento"),alert("Nenhum arquivo selecionado");return}if(!(o instanceof File)){console.error(" [PizzaConfigTab] Arquivo no  instncia de File:",typeof o),alert("Arquivo invlido");return}try{console.log(" [PizzaConfigTab] Iniciando upload...");const{uploadToCloudinary:m}=await lt(async()=>{const{uploadToCloudinary:x}=await import("./cloudinaryUpload-vqCefYaz.js");return{uploadToCloudinary:x}},__vite__mapDeps([0,1,2])),p=await m(o,"pizza-config");console.log(" [PizzaConfigTab] Upload concludo, URL:",p),l(x=>({...x,image:p}))}catch(m){console.error(" [PizzaConfigTab] Erro ao fazer upload:",m),alert("Erro ao fazer upload da imagem: "+m.message)}},d=i=>{i.preventDefault(),t({...n,price:parseFloat(n.price)})};return e.jsx(Re,{open:s,onOpenChange:a,children:e.jsxs(Le,{className:"sm:max-w-md max-w-[95vw]",children:[e.jsx(Ie,{children:e.jsxs(qe,{children:[r?"Editar":"Novo"," Extra"]})}),e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome *"}),e.jsx(B,{value:n.name,onChange:i=>l(o=>({...o,name:i.target.value})),placeholder:"Ex: Azeitonas, Bacon",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Descrio"}),e.jsx(Os,{value:n.description,onChange:i=>l(o=>({...o,description:i.target.value})),placeholder:"Descrio do extra...",rows:2})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Preo *"}),e.jsx(B,{type:"number",step:"0.01",value:n.price,onChange:i=>l(o=>({...o,price:i.target.value})),placeholder:"0.00",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Imagem"}),e.jsx(B,{type:"file",accept:"image/*",onChange:c}),n.image&&e.jsx("img",{src:n.image,alt:"",className:"mt-2 w-20 h-20 object-cover rounded"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(A,{type:"button",variant:"outline",onClick:a,className:"flex-1",children:"Cancelar"}),e.jsx(A,{type:"submit",className:"flex-1 bg-orange-500",children:"Salvar"})]})]})]})})}function B0({isOpen:s,onClose:a,onSubmit:t,category:r,sizes:n=[]}){const[l,c]=b.useState({name:"",size_id:"",max_flavors:"1"});ae.useEffect(()=>{c(r?{name:r.name||"",size_id:r.size_id||"",max_flavors:(r.max_flavors||1).toString()}:{name:"",size_id:n[0]?.id||"",max_flavors:"1"})},[r,n,s]);const d=i=>{i.preventDefault(),t({...l,max_flavors:parseInt(l.max_flavors)||1})};return e.jsx(Re,{open:s,onOpenChange:a,children:e.jsxs(Le,{className:"sm:max-w-md max-w-[95vw]",children:[e.jsx(Ie,{children:e.jsxs(qe,{children:[r?"Editar":"Nova"," Categoria"]})}),e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome da categoria *"}),e.jsx(B,{value:l.name,onChange:i=>c(o=>({...o,name:i.target.value})),placeholder:"Ex: Pizza M 1 sabor, Pizza G 2 sabores",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Tamanho *"}),e.jsxs("select",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm",value:l.size_id,onChange:i=>c(o=>({...o,size_id:i.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"Selecione..."}),(n||[]).filter(i=>i&&i.is_active!==!1).map(i=>e.jsxs("option",{value:i.id,children:[i.name," - ",i.slices," fatias"]},i.id))]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Mx. sabores (1-4) *"}),e.jsx(B,{type:"number",min:1,max:4,value:l.max_flavors,onChange:i=>c(o=>({...o,max_flavors:i.target.value})),required:!0})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(A,{type:"button",variant:"outline",onClick:a,className:"flex-1",children:"Cancelar"}),e.jsx(A,{type:"submit",className:"flex-1 bg-orange-500",children:"Salvar"})]})]})]})})}function W0(){return e.jsxs("div",{className:"p-4 sm:p-6 space-y-3 sm:space-y-4",children:[e.jsx("div",{className:"bg-white p-3 sm:p-4 rounded-xl shadow-sm animate-pulse",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"w-24 h-10 bg-gray-200 rounded"}),e.jsx("div",{className:"w-32 h-10 bg-gray-200 rounded"})]})}),[1,2,3].map(s=>e.jsxs(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:s*.1},className:"bg-white rounded-xl p-3 sm:p-5 shadow-sm border animate-pulse",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start justify-between mb-3 sm:mb-4 gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-20 h-6 bg-gray-200 rounded"}),e.jsx("div",{className:"w-16 h-6 bg-gray-200 rounded-full"})]}),e.jsx("div",{className:"w-40 h-6 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"w-32 h-4 bg-gray-200 rounded"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded"}),e.jsx("div",{className:"w-32 h-10 bg-gray-200 rounded"}),e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-3 mb-4",children:[e.jsx("div",{className:"w-full h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"w-full h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"w-full h-4 bg-gray-200 rounded"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 mb-4 space-y-2",children:[e.jsx("div",{className:"w-32 h-4 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"w-full h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"w-full h-4 bg-gray-200 rounded"})]}),e.jsxs("div",{className:"flex justify-end gap-6",children:[e.jsx("div",{className:"w-32 h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"w-32 h-4 bg-gray-200 rounded"})]})]},s))]})}function _l(s,a={}){const{threshold:t=80,resistance:r=2.5,disabled:n=!1}=a,[l,c]=b.useState(!1),[d,i]=b.useState(0),[o,m]=b.useState(0),[p,x]=b.useState(!1);return b.useEffect(()=>{if(n||typeof window>"u")return;let g=0,f=0,y=!1;const v=O=>{window.scrollY>0||(g=O.touches[0].clientY,y=!0,i(g))},P=O=>{if(!y)return;f=O.touches[0].clientY;const E=f-g;E>0&&window.scrollY===0&&(O.preventDefault(),x(!0),m(E/r))},M=async()=>{if(!y)return;if(y=!1,f-g>t&&window.scrollY===0){c(!0),x(!1),m(0);try{await s()}finally{c(!1)}}else x(!1),m(0)};return document.addEventListener("touchstart",v,{passive:!1}),document.addEventListener("touchmove",P,{passive:!1}),document.addEventListener("touchend",M),()=>{document.removeEventListener("touchstart",v),document.removeEventListener("touchmove",P),document.removeEventListener("touchend",M)}},[s,t,r,n]),{isRefreshing:l,isPulling:p,pullDistance:o,canRefresh:o>t}}function vo({mutationFn:s,entityType:a,successMessage:t="Operao realizada com sucesso!",errorMessage:r="Erro ao realizar operao",onSuccess:n,onError:l,invalidateQueries:c=!0}){const d=ts(),{menuContext:i}=as();return de({mutationFn:async(...o)=>{try{Fe.api.log(` [useEntityMutation] Executando mutation para ${a}...`);const m=await s(...o);return Fe.api.log(` [useEntityMutation] Mutation bem-sucedida para ${a}`),m}catch(m){throw Fe.api.error(` [useEntityMutation] Erro na mutation para ${a}:`,m),m}},onSuccess:(o,m,p)=>{c&&(Array.isArray(a)?a:[a]).forEach(g=>{i&&d.invalidateQueries({queryKey:[g,i.type,i.value]}),d.invalidateQueries({queryKey:[g]})}),t&&K.success(t,{duration:3e3,position:"top-center"}),n&&n(o,m,p)},onError:(o,m,p)=>{const x=o?.message||r;K.error(x,{duration:5e3,position:"top-center"}),l&&l(o,m,p)}})}const kt={new:{label:"Novo",color:"bg-red-100 text-red-800"},accepted:{label:"Aceito",color:"bg-yellow-100 text-yellow-800"},preparing:{label:"Preparando",color:"bg-purple-100 text-purple-800"},ready:{label:"Pronto",color:"bg-green-100 text-green-800"},out_for_delivery:{label:"Em Entrega",color:"bg-blue-100 text-blue-800"},delivered:{label:"Entregue",color:"bg-gray-100 text-gray-800"},cancelled:{label:"Cancelado",color:"bg-gray-300 text-gray-600"}},bo={pix:"PIX",dinheiro:"Dinheiro",cartao_credito:"Carto de Crdito",cartao_debito:"Carto de Dbito"},pi=s=>!!(s?.order_code?.startsWith("PDV-")||s?.delivery_method==="balcao");function bv({isMaster:s,user:a,subscriberData:t}){const[r,n]=b.useState(""),[l,c]=b.useState("all"),[d,i]=b.useState(!1),o=ts(),m=Fn(),{subscriberData:p,isMaster:x,menuContext:g,loading:f}=as(),y=g?.type==="subscriber"&&g?.value?g.value:t?.email||p?.email||void 0,P=(t?.plan||p?.plan||"").toLowerCase(),M=s||x||["pro","ultra"].includes(P),{data:O=[],isLoading:E}=Wt({orderBy:"-created_date"}),u=f||E,{isRefreshing:_}=_l(()=>o.invalidateQueries({queryKey:["orders"]})),$=vo({mutationFn:({id:N,data:z})=>se.entities.Order.update(N,z,y?{as_subscriber:y}:{}),entityType:"orders",successMessage:"Pedido atualizado com sucesso!",errorMessage:"Erro ao atualizar pedido"}),j=vo({mutationFn:N=>se.entities.Order.delete(N,y?{as_subscriber:y}:{}),entityType:"orders",successMessage:"Pedido excludo com sucesso!",errorMessage:"Erro ao excluir pedido"}),D=N=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(N||0),V=N=>{const z=new Zm({unit:"mm",format:[80,297]}),k=5,h=70,F=4.5,S=(C,Y=!1)=>{if(!C)return;z.setFont("courier",Y?"bold":"normal"),z.splitTextToSize(String(C),h).forEach(oe=>{z.text(oe,k,q),q+=F})};let q=10;z.setFontSize(12),z.setFont("courier","bold"),z.text("COMANDA",40,q,{align:"center"}),q+=8,z.setFontSize(9),z.setFont("courier","normal"),S(`Pedido: #${N.order_code||N.id?.slice(-6).toUpperCase()}`);const J=N.created_at||N.created_date;S(`Data: ${J?Et(new Date(J),"dd/MM/yyyy HH:mm"):""}`),q+=2,S(`Cliente: ${N.customer_name||""}`),S(`Tel: ${N.customer_phone||""}`);const W=Jm(N);N.delivery_method==="delivery"&&W?S(`Entrega: ${W}`):N.delivery_method!=="delivery"&&S("Retirada no local"),S(`Pagamento: ${bo[N.payment_method]||N.payment_method}`),N.payment_method==="dinheiro"&&N.needs_change&&N.change_amount&&S(`Troco para: ${D(N.change_amount)}`),N.scheduled_date&&N.scheduled_time&&S(`AGENDADO: ${N.scheduled_date} s ${N.scheduled_time}`),q+=2,z.text("--------------------------------",k,q),q+=F,(N.items||[]).forEach((C,Y)=>{const L=C.dish?.product_type==="pizza",oe=C.size||C.selections?.size,Pe=C.flavors||C.selections?.flavors,ve=C.edge||C.selections?.edge,G=C.extras||C.selections?.extras;if(S(`${Y+1}. ${C.dish?.name||"Item"} x${C.quantity||1} - ${D((C.totalPrice||0)*(C.quantity||1))}`),L&&oe){if(S(`   ${oe.name} (${oe.slices||""} fatias)`),Pe?.length){const ne=Pe.reduce((fe,ge)=>(fe[ge.name]=(fe[ge.name]||0)+1,fe),{});Object.entries(ne).forEach(([fe,ge])=>S(`    ${ge}/${oe.slices||""} ${fe}`))}ve&&S(`   Borda: ${ve.name}`),G?.length&&G.forEach(ne=>S(`   + ${ne.name}`))}else C.selections&&Object.keys(C.selections).length>0&&Object.values(C.selections).forEach(ne=>{Array.isArray(ne)?ne.forEach(fe=>fe?.name&&S(`    ${fe.name}`)):ne?.name&&S(`    ${ne.name}`)});C.specifications&&S(`   Obs: ${C.specifications}`),C.observations&&S(`   Obs: ${C.observations}`)}),z.text("--------------------------------",k,q),q+=F,S(`Subtotal: ${D(N.subtotal)}`),N.delivery_fee>0&&S(`Taxa: ${D(N.delivery_fee)}`),N.discount>0&&S(`Desconto: -${D(N.discount)}`),z.setFont("courier","bold"),S(`TOTAL: ${D(N.total)}`,!0),z.save(`comanda-${N.order_code||N.id?.slice(-6)}.pdf`)},T=O.filter(N=>{const z=N.created_at||N.created_date,k=!r||z&&Et(new Date(z),"yyyy-MM-dd")===r,h=pi(N);return k&&(l==="all"||l==="pdv"&&h||l==="delivery"&&!h)});return u?e.jsx(W0,{}):O.length===0?e.jsx("div",{className:"p-6",children:e.jsx(gn,{icon:or,title:"Voc ainda no possui pedidos",description:"Os pedidos feitos pelos clientes aparecero aqui automaticamente",actionLabel:"Ir para o Cardpio",action:()=>{const N=a?.is_master?a?.slug:t?.slug,z=N?`/s/${N}`:Ns("Cardapio");window.open(z,"_blank")}})}):e.jsxs("div",{className:"p-4 sm:p-6 relative",children:[_&&e.jsxs("div",{className:"fixed top-20 left-1/2 -translate-x-1/2 z-50 bg-orange-500 text-white px-4 py-2 rounded-full shadow-lg flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm font-medium",children:"Atualizando..."})]}),m?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mb-4 flex items-center justify-between bg-white p-3 rounded-xl shadow-sm",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[T.length," pedido(s)"]})}),e.jsxs(fn,{open:d,onOpenChange:i,children:[e.jsx(jn,{asChild:!0,children:e.jsxs(A,{variant:"outline",size:"sm",className:"min-h-touch",children:[e.jsx(ua,{className:"w-4 h-4 mr-2"}),"Filtros"]})}),e.jsxs(yn,{side:"bottom",className:"h-auto max-h-[80vh] rounded-t-2xl",children:[e.jsx($i,{children:e.jsx(Yi,{children:"Filtros"})}),e.jsxs("div",{className:"space-y-4 mt-4 pb-safe",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Data"}),e.jsx(B,{type:"date",value:r,onChange:N=>n(N.target.value),className:"min-h-touch"}),r&&e.jsxs(A,{variant:"ghost",size:"sm",onClick:()=>n(""),className:"mt-2 w-full",children:[e.jsx(Ds,{className:"w-4 h-4 mr-2"}),"Limpar Data"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Tipo"}),e.jsxs(Se,{value:l,onValueChange:c,children:[e.jsx(De,{className:"min-h-touch",children:e.jsx(Me,{})}),e.jsxs(Ae,{children:[e.jsx(X,{value:"all",children:"Todos"}),e.jsx(X,{value:"delivery",children:"Delivery"}),e.jsx(X,{value:"pdv",children:"PDV"})]})]})]}),e.jsx(A,{onClick:()=>i(!1),className:"w-full min-h-touch",children:"Aplicar Filtros"})]})]})]})]})}):e.jsxs("div",{className:"mb-4 sm:mb-6 flex flex-wrap items-center gap-2 sm:gap-4 bg-white p-3 sm:p-4 rounded-xl shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ua,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-600",children:"Data:"})]}),e.jsx(B,{type:"date",value:r,onChange:N=>n(N.target.value),className:"w-auto text-sm"}),e.jsxs(Se,{value:l,onValueChange:c,children:[e.jsx(De,{className:"w-32",children:e.jsx(Me,{})}),e.jsxs(Ae,{children:[e.jsx(X,{value:"all",children:"Todos"}),e.jsx(X,{value:"delivery",children:"Delivery"}),e.jsx(X,{value:"pdv",children:"PDV"})]})]}),r&&e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>n(""),className:"text-xs",children:"Limpar"}),e.jsxs("span",{className:"text-xs sm:text-sm text-gray-400 ml-auto",children:[T.length," pedido(s)"]})]}),e.jsx("div",{className:"space-y-3 sm:space-y-4",children:T.map(N=>e.jsxs("div",{className:"bg-white rounded-xl p-3 sm:p-5 shadow-sm border hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start justify-between mb-3 sm:mb-4 gap-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-1",children:[e.jsxs("span",{className:"text-xs font-mono bg-gray-100 px-2 py-1 rounded",children:["#",N.order_code||N.id.slice(-6).toUpperCase()]}),e.jsx(ye,{variant:"outline",className:`text-xs ${pi(N)?"border-orange-300 text-orange-700":"border-blue-300 text-blue-700"}`,children:pi(N)?"PDV":"Delivery"}),e.jsx(ye,{className:(kt[N.status]||kt.new).color+" text-xs",children:(kt[N.status]||kt.new).label})]}),e.jsx("h3",{className:"font-bold text-base sm:text-lg",children:N.customer_name}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500",children:(N.created_at||N.created_date)&&Et(new Date(N.created_at||N.created_date),"dd/MM/yyyy 's' HH:mm",{locale:bi})})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(A,{size:"icon",variant:"outline",onClick:()=>V(N),title:"Imprimir Comanda",className:"min-h-touch min-w-touch",children:e.jsx(Vi,{className:"w-4 h-4"})}),e.jsxs(Se,{value:kt[N.status]?N.status:"new",onValueChange:z=>$.mutate({id:N.id,data:{...N,status:z}}),children:[e.jsx(De,{className:"w-28 sm:w-36 text-xs sm:text-sm min-h-touch",children:e.jsx(Me,{})}),e.jsx(Ae,{children:Object.entries(kt).map(([z,{label:k}])=>e.jsx(X,{value:z,children:k},z))})]}),M&&e.jsx(A,{size:"icon",variant:"ghost",className:"text-red-500 hover:text-red-700 min-h-touch min-w-touch",onClick:()=>{confirm("Excluir este pedido?")&&j.mutate(N.id)},title:"Excluir pedido (apenas Pro e Ultra)",children:e.jsx(Xe,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2 sm:gap-3 mb-4 text-xs sm:text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Ja,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:N.customer_phone})]}),N.address&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(za,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:N.address})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx($t,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:bo[N.payment_method]||N.payment_method})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 mb-4",children:[e.jsx("h4",{className:"font-medium text-sm mb-2 text-gray-700",children:"Itens do Pedido:"}),(N.items||[]).map((z,k)=>e.jsxs("div",{className:"text-sm py-2 border-b border-gray-100 last:border-0 border-l-2 border-gray-300 pl-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:z.dish?.name||"Item"}),e.jsxs("span",{className:"text-gray-500",children:[z.quantity>1&&e.jsxs("span",{className:"text-gray-400 mr-2",children:["x",z.quantity]}),D(z.totalPrice*(z.quantity||1))]})]}),z.selections&&Object.keys(z.selections).length>0&&e.jsx("div",{className:"text-xs text-gray-600 ml-3 mt-1 space-y-0.5",children:Object.entries(z.selections).map(([h,F])=>Array.isArray(F)?F.map((S,q)=>e.jsxs("p",{children:[" ",S.name]},q)):F?e.jsxs("p",{children:[" ",F.name]},h):null)})]},k))]}),e.jsx("div",{className:"flex flex-col sm:flex-row justify-end gap-2 sm:gap-6 text-xs sm:text-sm pt-3 border-t",children:e.jsxs("div",{className:"flex justify-between sm:justify-end gap-4 sm:gap-6",children:[e.jsxs("div",{className:"text-gray-500",children:["Subtotal: ",D(N.subtotal)]}),N.delivery_fee>0&&e.jsxs("div",{className:"text-gray-500",children:["Entrega: ",D(N.delivery_fee)]}),e.jsxs("div",{className:"font-bold text-green-600",children:["Total: ",D(N.total)]})]})})]},N.id))})]})}function H0(){return e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsx("div",{className:"bg-white rounded-xl p-4 mb-6 shadow-sm animate-pulse",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsx("div",{className:"w-40 h-10 bg-gray-200 rounded"}),e.jsx("div",{className:"w-40 h-10 bg-gray-200 rounded"}),e.jsx("div",{className:"w-32 h-10 bg-gray-200 rounded ml-auto"})]})}),e.jsx("div",{className:"space-y-3",children:[1,2,3,4,5].map(s=>e.jsx(Qe.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:s*.05},className:"bg-white rounded-xl p-4 shadow-sm border animate-pulse",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"w-48 h-5 bg-gray-200 rounded"}),e.jsx("div",{className:"w-24 h-4 bg-gray-200 rounded"})]}),e.jsx("div",{className:"w-full h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"w-3/4 h-4 bg-gray-200 rounded"})]})]})},s))})]})}const ja={new:{label:"Novo",color:"bg-blue-500"},accepted:{label:"Aceito",color:"bg-green-500"},preparing:{label:"Preparando",color:"bg-yellow-500"},ready:{label:"Pronto",color:"bg-purple-500"},out_for_delivery:{label:"Em Rota",color:"bg-indigo-500"},delivered:{label:"Entregue",color:"bg-green-600"},cancelled:{label:"Cancelado",color:"bg-red-500"}},Ba=s=>!!(s?.order_code?.startsWith("PDV-")||s?.delivery_method==="balcao");function Nv(){const{subscriberData:s,isMaster:a}=as(),[t,r]=b.useState(""),[n,l]=b.useState("all"),[c,d]=b.useState("all"),[i,o]=b.useState("all"),[m,p]=b.useState("today"),[x,g]=b.useState(""),[f,y]=b.useState(""),[v,P]=b.useState(null),[M,O]=b.useState(!1),[E,u]=b.useState(!1),_=ts(),$=Fn(),j=a||s?.plan&&["pro","ultra"].includes(s.plan.toLowerCase()),{data:D=[],isLoading:V}=Wt({orderBy:"-created_date"}),{isRefreshing:T}=_l(()=>_.invalidateQueries({queryKey:["orderHistory"]})),N=S=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(S||0),z=S=>{if(!S.created_date)return!1;const q=new Date(S.created_date),J=new Date;if(m==="custom"){if(!x||!f)return!1;const W=new Date(x),C=new Date(f);return C.setHours(23,59,59,999),q>=W&&q<=C}switch(m){case"today":return q.toDateString()===J.toDateString();case"week":const W=new Date(J);return W.setDate(J.getDate()-7),q>=W;case"month":const C=new Date(J);return C.setMonth(J.getMonth()-1),q>=C;case"all":return!0;default:return!0}},k=D.filter(S=>{const q=!t||S.customer_name?.toLowerCase().includes(t.toLowerCase())||S.order_code?.toLowerCase().includes(t.toLowerCase())||S.customer_phone?.includes(t),J=n==="all"||S.status===n,W=c==="all"||S.payment_method===c,C=z(S),Y=Ba(S);return q&&J&&W&&C&&(i==="all"||i==="pdv"&&Y||i==="delivery"&&!Y)}),h=k.filter(S=>S.status!=="cancelled").reduce((S,q)=>S+(q.total||0),0),F=()=>{const S=["Data","Cdigo","Cliente","Status","Pagamento","Total"],q=k.map(G=>[Xt(G.created_date),G.order_code||G.id?.slice(-6),G.customer_name,ja[G.status]?.label||G.status,G.payment_method,G.total]),J=[S,...q].map(G=>G.join(",")).join(`
`),W=new Blob([J],{type:"text/csv"}),C=URL.createObjectURL(W),Y=document.createElement("a");Y.href=C;const L=new Date,oe=String(L.getDate()).padStart(2,"0"),Pe=String(L.getMonth()+1).padStart(2,"0"),ve=L.getFullYear();Y.download=`pedidos-${oe}-${Pe}-${ve}.csv`,Y.click()};return V?e.jsx(H0,{}):e.jsxs("div",{className:"p-4 sm:p-6 space-y-4 sm:space-y-6 relative",children:[T&&e.jsxs("div",{className:"fixed top-20 left-1/2 -translate-x-1/2 z-50 bg-orange-500 text-white px-4 py-2 rounded-full shadow-lg flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm font-medium",children:"Atualizando..."})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold",children:"Histrico de Pedidos"}),j&&e.jsxs(A,{onClick:F,variant:"outline",size:"sm",className:"min-h-touch",title:"Exportar CSV (apenas Pro e Ultra)",children:[e.jsx(pn,{className:"w-4 h-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Exportar CSV"})]})]}),$?e.jsxs("div",{className:"flex items-center justify-between bg-white p-3 rounded-xl shadow-sm",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[k.length," pedido(s)"]})}),e.jsxs(fn,{open:E,onOpenChange:u,children:[e.jsx(jn,{asChild:!0,children:e.jsxs(A,{variant:"outline",size:"sm",className:"min-h-touch",children:[e.jsx(ua,{className:"w-4 h-4 mr-2"}),"Filtros"]})}),e.jsxs(yn,{side:"bottom",className:"h-auto max-h-[85vh] rounded-t-2xl overflow-y-auto",children:[e.jsx($i,{children:e.jsx(Yi,{children:"Filtros"})}),e.jsxs("div",{className:"space-y-4 mt-4 pb-safe",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Buscar"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ms,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(B,{placeholder:"Cliente, cdigo, telefone...",value:t,onChange:S=>r(S.target.value),className:"pl-10 min-h-touch"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Perodo"}),e.jsxs(Se,{value:m,onValueChange:p,children:[e.jsx(De,{className:"min-h-touch",children:e.jsx(Me,{})}),e.jsxs(Ae,{children:[e.jsx(X,{value:"today",children:"Hoje"}),e.jsx(X,{value:"week",children:"ltimos 7 dias"}),e.jsx(X,{value:"month",children:"ltimo ms"}),e.jsx(X,{value:"custom",children:"Perodo Customizado"}),e.jsx(X,{value:"all",children:"Todos"})]})]})]}),m==="custom"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Data Inicial"}),e.jsx(B,{type:"date",value:x,onChange:S=>g(S.target.value),className:"min-h-touch"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Data Final"}),e.jsx(B,{type:"date",value:f,onChange:S=>y(S.target.value),className:"min-h-touch"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Status"}),e.jsxs(Se,{value:n,onValueChange:l,children:[e.jsx(De,{className:"min-h-touch",children:e.jsx(Me,{})}),e.jsxs(Ae,{children:[e.jsx(X,{value:"all",children:"Todos"}),Object.entries(ja).map(([S,q])=>e.jsx(X,{value:S,children:q.label},S))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Pagamento"}),e.jsxs(Se,{value:c,onValueChange:d,children:[e.jsx(De,{className:"min-h-touch",children:e.jsx(Me,{})}),e.jsxs(Ae,{children:[e.jsx(X,{value:"all",children:"Todos"}),e.jsx(X,{value:"pix",children:"PIX"}),e.jsx(X,{value:"dinheiro",children:"Dinheiro"}),e.jsx(X,{value:"cartao_credito",children:"Carto de Crdito"}),e.jsx(X,{value:"cartao_debito",children:"Carto de Dbito"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Tipo"}),e.jsxs(Se,{value:i,onValueChange:o,children:[e.jsx(De,{className:"min-h-touch",children:e.jsx(Me,{})}),e.jsxs(Ae,{children:[e.jsx(X,{value:"all",children:"Todos"}),e.jsx(X,{value:"delivery",children:"Delivery"}),e.jsx(X,{value:"pdv",children:"PDV"})]})]})]}),e.jsx(A,{onClick:()=>u(!1),className:"w-full min-h-touch",children:"Aplicar Filtros"})]})]})]})]}):e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Buscar"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ms,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(B,{placeholder:"Cliente, cdigo, telefone...",value:t,onChange:S=>r(S.target.value),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Perodo"}),e.jsxs(Se,{value:m,onValueChange:p,children:[e.jsx(De,{children:e.jsx(Me,{})}),e.jsxs(Ae,{children:[e.jsx(X,{value:"today",children:"Hoje"}),e.jsx(X,{value:"week",children:"ltimos 7 dias"}),e.jsx(X,{value:"month",children:"ltimo ms"}),e.jsx(X,{value:"custom",children:"Perodo Customizado"}),e.jsx(X,{value:"all",children:"Todos"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Status"}),e.jsxs(Se,{value:n,onValueChange:l,children:[e.jsx(De,{children:e.jsx(Me,{})}),e.jsxs(Ae,{children:[e.jsx(X,{value:"all",children:"Todos"}),Object.entries(ja).map(([S,q])=>e.jsx(X,{value:S,children:q.label},S))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Pagamento"}),e.jsxs(Se,{value:c,onValueChange:d,children:[e.jsx(De,{children:e.jsx(Me,{})}),e.jsxs(Ae,{children:[e.jsx(X,{value:"all",children:"Todos"}),e.jsx(X,{value:"pix",children:"PIX"}),e.jsx(X,{value:"dinheiro",children:"Dinheiro"}),e.jsx(X,{value:"cartao_credito",children:"Carto de Crdito"}),e.jsx(X,{value:"cartao_debito",children:"Carto de Dbito"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Tipo"}),e.jsxs(Se,{value:i,onValueChange:o,children:[e.jsx(De,{children:e.jsx(Me,{})}),e.jsxs(Ae,{children:[e.jsx(X,{value:"all",children:"Todos"}),e.jsx(X,{value:"delivery",children:"Delivery"}),e.jsx(X,{value:"pdv",children:"PDV"})]})]})]})]}),m==="custom"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4 pt-4 border-t",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Data Inicial"}),e.jsx(B,{type:"date",value:x,onChange:S=>g(S.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Data Final"}),e.jsx(B,{type:"date",value:f,onChange:S=>y(S.target.value)})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-xl p-4 border border-blue-200",children:[e.jsx("p",{className:"text-sm text-blue-600 mb-1",children:"Total de Pedidos"}),e.jsx("p",{className:"text-3xl font-bold text-blue-700",children:k.length})]}),e.jsxs("div",{className:"bg-green-50 rounded-xl p-4 border border-green-200",children:[e.jsx("p",{className:"text-sm text-green-600 mb-1",children:"Faturamento"}),e.jsx("p",{className:"text-3xl font-bold text-green-700",children:N(h)})]}),e.jsxs("div",{className:"bg-purple-50 rounded-xl p-4 border border-purple-200",children:[e.jsx("p",{className:"text-sm text-purple-600 mb-1",children:"Ticket Mdio"}),e.jsx("p",{className:"text-3xl font-bold text-purple-700",children:N(k.length>0?h/k.length:0)})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border overflow-hidden",children:k.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ua,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-gray-500",children:"Nenhum pedido encontrado"})]}):$?e.jsx("div",{className:"p-3 sm:p-4 space-y-3",children:k.map(S=>e.jsx(Q,{className:"hover:shadow-md transition-shadow cursor-pointer",onClick:()=>{P(S),O(!0)},children:e.jsxs(Z,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3 gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-2",children:[e.jsxs("span",{className:"text-xs font-mono bg-gray-100 px-2 py-1 rounded",children:["#",S.order_code||S.id?.slice(-6)]}),e.jsx(ye,{variant:"outline",className:`text-xs ${Ba(S)?"border-orange-300 text-orange-700":"border-blue-300 text-blue-700"}`,children:Ba(S)?"PDV":"Delivery"}),e.jsx(ye,{className:`text-xs ${ja[S.status]?.color||"bg-gray-500"}`,children:ja[S.status]?.label||S.status})]}),e.jsx("h3",{className:"font-bold text-sm mb-1 truncate",children:S.customer_name}),e.jsx("p",{className:"text-xs text-gray-500",children:S.created_date&&Xt(S.created_date)})]}),e.jsx(A,{variant:"ghost",size:"icon",className:"flex-shrink-0 min-h-touch min-w-touch",onClick:q=>{q.stopPropagation(),P(S),O(!0)},children:e.jsx(Ya,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2 text-xs mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Ja,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:S.customer_phone||"-"})]}),S.address&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(za,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:S.address})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx($t,{className:"w-3 h-3"}),e.jsx("span",{className:"capitalize",children:S.payment_method?.replace("_"," ")})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:[(S.items||[]).length," item(ns)"]}),e.jsx("div",{className:"font-bold text-green-600 text-sm",children:N(S.total)})]})]})},S.id))}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Data"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Cdigo"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Cliente"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Itens"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Pagamento"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Aes"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:k.map(S=>e.jsxs("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>{P(S),O(!0)},children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:S.created_date&&Xt(S.created_date)}),e.jsxs("td",{className:"px-4 py-3 text-sm font-medium",children:["#",S.order_code||S.id?.slice(-6)]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(ye,{variant:"outline",className:Ba(S)?"border-orange-300 text-orange-700":"border-blue-300 text-blue-700",children:Ba(S)?"PDV":"Delivery"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:S.customer_name}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"text-sm space-y-2 max-w-xs",children:(S.items||[]).map((q,J)=>e.jsxs("div",{className:"border-l-2 border-gray-300 pl-2",children:[e.jsxs("div",{className:"font-medium text-gray-900 text-xs",children:[q.quantity||1,"x ",q.dish?.name]}),q.selections&&Object.keys(q.selections).length>0&&e.jsx("div",{className:"text-xs text-gray-600 ml-3 mt-1 space-y-0.5",children:Object.entries(q.selections).map(([W,C])=>Array.isArray(C)?C.map((Y,L)=>e.jsxs("p",{children:[" ",Y.name]},L)):C?e.jsxs("p",{children:[" ",C.name]},W):null)})]},J))})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx(ye,{className:ja[S.status]?.color||"bg-gray-500",children:ja[S.status]?.label||S.status})}),e.jsx("td",{className:"px-4 py-3 text-sm capitalize",children:S.payment_method?.replace("_"," ")}),e.jsx("td",{className:"px-4 py-3 text-sm font-bold text-green-600",children:N(S.total)}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(A,{variant:"ghost",size:"sm",onClick:q=>{q.stopPropagation(),P(S),O(!0)},children:e.jsx(Ya,{className:"w-4 h-4"})})})]},S.id))})]})})}),e.jsx(Re,{open:M,onOpenChange:O,children:e.jsxs(Le,{className:"sm:max-w-3xl max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsx(Ie,{children:e.jsxs(qe,{className:"flex items-center gap-2 text-base sm:text-lg",children:[e.jsx(Ss,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsxs("span",{className:"truncate",children:["Detalhes do Pedido #",v?.order_code||v?.id?.slice(-6)]})]})}),v&&e.jsxs("div",{className:"space-y-3 sm:space-y-4 py-2 sm:py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mb-1",children:"Cliente"}),e.jsx("p",{className:"font-semibold text-sm sm:text-base truncate",children:v.customer_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mb-1",children:"Telefone"}),e.jsx("p",{className:"font-semibold text-sm sm:text-base",children:v.customer_phone||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mb-1",children:"Data"}),e.jsx("p",{className:"font-semibold text-xs sm:text-sm",children:Xt(v.created_date)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mb-1",children:"Status"}),e.jsx(ye,{className:`text-xs ${ja[v.status]?.color||"bg-gray-500"}`,children:ja[v.status]?.label||v.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mb-1",children:"Pagamento"}),e.jsx("p",{className:"font-semibold text-sm sm:text-base capitalize",children:v.payment_method?.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mb-1",children:"Tipo"}),e.jsx(ye,{variant:"outline",className:`text-xs ${Ba(v)?"border-orange-300 text-orange-700":"border-blue-300 text-blue-700"}`,children:Ba(v)?"PDV":"Delivery"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm font-semibold mb-2",children:"Itens do Pedido"}),e.jsx("div",{className:"space-y-2",children:(v.items||[]).map((S,q)=>e.jsxs("div",{className:"border rounded-lg p-2 sm:p-3",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2 gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"font-semibold text-sm sm:text-base truncate",children:[S.quantity||1,"x ",S.dish?.name||S.dish_name]}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-600",children:[N(S.unit_price||S.total_price)," un."]})]}),e.jsx("p",{className:"font-bold text-green-600 text-sm sm:text-base flex-shrink-0",children:N((S.total_price||S.unit_price||0)*(S.quantity||1))})]}),S.selections&&Object.keys(S.selections).length>0&&e.jsx("div",{className:"text-xs text-gray-600 ml-3 mt-2 space-y-0.5",children:Object.entries(S.selections).map(([J,W])=>Array.isArray(W)?W.map((C,Y)=>e.jsxs("p",{children:[" ",C.name]},Y)):W?e.jsxs("p",{children:[" ",W.name]},J):null)}),S.observations&&e.jsxs("p",{className:"text-xs text-gray-600 italic mt-2",children:[" ",S.observations]})]},q))})]}),e.jsxs("div",{className:"border-t pt-3 sm:pt-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{className:"font-semibold",children:N(v.subtotal||v.total)})]}),v.delivery_fee>0&&e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm",children:[e.jsx("span",{children:"Taxa de Entrega"}),e.jsx("span",{className:"font-semibold",children:N(v.delivery_fee)})]}),v.discount>0&&e.jsxs("div",{className:"flex justify-between text-red-600 text-xs sm:text-sm",children:[e.jsx("span",{children:"Desconto"}),e.jsxs("span",{className:"font-semibold",children:["-",N(v.discount)]})]}),e.jsxs("div",{className:"flex justify-between text-base sm:text-lg font-bold border-t pt-2",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"text-green-600",children:N(v.total)})]})]}),v.delivery_method==="delivery"&&v.address&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm font-semibold mb-2",children:"Endereo de Entrega"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 break-words",children:v.address})]})]}),e.jsx(Qs,{className:"flex-col sm:flex-row gap-2",children:e.jsx(A,{variant:"outline",onClick:()=>O(!1),className:"w-full sm:w-auto min-h-touch",children:"Fechar"})})]})})]})}function K0(){return e.jsxs("div",{className:"p-4 sm:p-6 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center animate-pulse",children:[e.jsx("div",{className:"w-32 sm:w-48 h-6 sm:h-8 bg-gray-200 rounded"}),e.jsx("div",{className:"w-24 sm:w-32 h-8 sm:h-10 bg-gray-200 rounded"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[1,2,3].map(s=>e.jsxs("div",{className:"bg-white rounded-xl p-4 sm:p-6 shadow-sm border animate-pulse",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"w-20 sm:w-24 h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded"})]}),e.jsx("div",{className:"w-24 sm:w-32 h-8 sm:h-10 bg-gray-200 rounded"})]},s))}),e.jsx("div",{className:"bg-white p-3 sm:p-4 rounded-xl shadow-sm animate-pulse",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx("div",{className:"w-20 sm:w-32 h-10 bg-gray-200 rounded flex-1"}),e.jsx("div",{className:"w-24 sm:w-32 h-10 bg-gray-200 rounded"})]})}),e.jsx("div",{className:"space-y-3",children:[1,2,3,4,5].map(s=>e.jsxs(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:s*.05},className:"bg-white rounded-xl p-4 shadow-sm border animate-pulse",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"w-32 sm:w-40 h-5 bg-gray-200 rounded"}),e.jsx("div",{className:"w-24 sm:w-32 h-4 bg-gray-200 rounded"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"hidden sm:block space-y-1 text-right",children:[e.jsx("div",{className:"w-20 h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"w-24 h-4 bg-gray-200 rounded"})]}),e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded"})]})]}),e.jsxs("div",{className:"sm:hidden mt-3 pt-3 border-t flex items-center justify-between",children:[e.jsx("div",{className:"w-20 h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"w-24 h-4 bg-gray-200 rounded"})]})]},s))})]})}function wv(){const[s,a]=b.useState(""),[t,r]=b.useState("recent"),[n,l]=b.useState(null),[c,d]=b.useState(!1),[i,o]=b.useState(!1),m=ts(),p=Fn(),{data:x=[],isLoading:g}=Wt({orderBy:"-created_date"}),{isRefreshing:f}=_l(()=>m.invalidateQueries({queryKey:["clientOrders"]})),y=b.useMemo(()=>{const u={};return x.forEach(_=>{const $=_.customer_email||_.created_by||"sem-email",j=_.customer_name||"Cliente",D=_.customer_phone||"";u[$]||(u[$]={email:$,name:j,phone:D,orders:[],totalSpent:0,lastOrderDate:null}),u[$].orders.push(_),u[$].totalSpent+=_.total||0;const V=ee(_.created_date);(!u[$].lastOrderDate||V.isAfter(u[$].lastOrderDate))&&(u[$].lastOrderDate=V)}),Object.values(u)},[x]),v=b.useMemo(()=>{let u=y.filter(_=>_.name.toLowerCase().includes(s.toLowerCase())||_.email.toLowerCase().includes(s.toLowerCase())||_.phone.includes(s));return t==="spending"?u.sort((_,$)=>$.totalSpent-_.totalSpent):t==="frequency"?u.sort((_,$)=>$.orders.length-_.orders.length):u.sort((_,$)=>_.lastOrderDate?$.lastOrderDate?$.lastOrderDate.diff(_.lastOrderDate):-1:1),u},[y,s,t]),P=u=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(u||0),M=y.length,O=y.reduce((u,_)=>u+_.totalSpent,0),E=M>0?O/M:0;return g?e.jsx(K0,{}):e.jsxs("div",{className:"space-y-4 sm:space-y-6 relative",children:[f&&e.jsxs("div",{className:"fixed top-20 left-1/2 -translate-x-1/2 z-50 bg-orange-500 text-white px-4 py-2 rounded-full shadow-lg flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm font-medium",children:"Atualizando..."})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-800 mb-2",children:"Clientes"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600",children:"Gerencie seus clientes e veja estatsticas"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(Q,{children:e.jsxs(Z,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total de Clientes"}),e.jsx(ar,{className:"w-5 h-5 text-blue-500"})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:M})]})}),e.jsx(Q,{children:e.jsxs(Z,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Ticket Mdio"}),e.jsx($a,{className:"w-5 h-5 text-green-500"})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:P(E)})]})}),e.jsx(Q,{children:e.jsxs(Z,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Faturamento Total"}),e.jsx($s,{className:"w-5 h-5 text-purple-500"})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:P(O)})]})})]}),p?e.jsxs("div",{className:"flex items-center justify-between bg-white p-3 rounded-xl shadow-sm",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[v.length," cliente(s)"]})}),e.jsxs(fn,{open:i,onOpenChange:o,children:[e.jsx(jn,{asChild:!0,children:e.jsxs(A,{variant:"outline",size:"sm",className:"min-h-touch",children:[e.jsx(ua,{className:"w-4 h-4 mr-2"}),"Filtros"]})}),e.jsxs(yn,{side:"bottom",className:"h-auto max-h-[80vh] rounded-t-2xl",children:[e.jsx($i,{children:e.jsx(Yi,{children:"Filtros"})}),e.jsxs("div",{className:"space-y-4 mt-4 pb-safe",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Buscar"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ms,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(B,{placeholder:"Nome, email ou telefone...",value:s,onChange:u=>a(u.target.value),className:"pl-10 min-h-touch"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Ordenar por"}),e.jsxs(Se,{value:t,onValueChange:r,children:[e.jsx(De,{className:"min-h-touch",children:e.jsx(Me,{placeholder:"Ordenar por"})}),e.jsxs(Ae,{children:[e.jsx(X,{value:"recent",children:"Mais Recentes"}),e.jsx(X,{value:"spending",children:"Maior Gasto"}),e.jsx(X,{value:"frequency",children:"Mais Pedidos"})]})]})]}),e.jsx(A,{onClick:()=>o(!1),className:"w-full min-h-touch",children:"Aplicar Filtros"})]})]})]})]}):e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ms,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(B,{placeholder:"Buscar por nome, email ou telefone...",value:s,onChange:u=>a(u.target.value),className:"pl-10"})]}),e.jsxs(Se,{value:t,onValueChange:r,children:[e.jsx(De,{className:"w-full sm:w-48",children:e.jsx(Me,{placeholder:"Ordenar por"})}),e.jsxs(Ae,{children:[e.jsx(X,{value:"recent",children:"Mais Recentes"}),e.jsx(X,{value:"spending",children:"Maior Gasto"}),e.jsx(X,{value:"frequency",children:"Mais Pedidos"})]})]})]}),e.jsx("div",{className:"space-y-3",children:v.length===0?e.jsx(Q,{children:e.jsxs(Z,{className:"p-12 text-center",children:[e.jsx(ar,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-600 mb-2",children:"Nenhum cliente encontrado"}),e.jsx("p",{className:"text-gray-400",children:"Os clientes aparecero aqui aps o primeiro pedido"})]})}):v.map(u=>e.jsx(Q,{className:"hover:shadow-md transition-shadow",children:e.jsxs(Z,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center text-white font-bold text-lg flex-shrink-0",children:u.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-900 truncate",children:u.name}),e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-sm text-gray-500 mt-1",children:[u.phone&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ja,{className:"w-3 h-3"}),u.phone]}),u.email!=="sem-email"&&e.jsxs("span",{className:"flex items-center gap-1 truncate",children:[e.jsx(ec,{className:"w-3 h-3"}),u.email]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right hidden sm:block",children:[e.jsxs("div",{className:"flex items-center gap-2 justify-end mb-1",children:[e.jsx(or,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"font-semibold",children:[u.orders.length," pedidos"]})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx($a,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"font-bold text-green-600",children:P(u.totalSpent)})]}),u.lastOrderDate&&e.jsxs("div",{className:"flex items-center gap-1 justify-end mt-1 text-xs text-gray-400",children:[e.jsx(xn,{className:"w-3 h-3"}),u.lastOrderDate.fromNow()]})]}),e.jsxs(xt,{children:[e.jsx(pt,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",children:e.jsx(jr,{className:"w-4 h-4"})})}),e.jsxs(gt,{align:"end",children:[e.jsxs(ps,{onClick:()=>{l(u),d(!0)},children:[e.jsx(Ya,{className:"w-4 h-4 mr-2"}),"Ver Detalhes"]}),e.jsxs(ps,{onClick:()=>window.open(`https://wa.me/55${u.phone?.replace(/\D/g,"")}`,"_blank"),children:[e.jsx(Ja,{className:"w-4 h-4 mr-2"}),"WhatsApp"]}),e.jsxs(ps,{className:"text-red-600",children:[e.jsx(sc,{className:"w-4 h-4 mr-2"}),"Bloquear Cliente"]})]})]})]})]}),e.jsxs("div",{className:"sm:hidden mt-3 pt-3 border-t flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(or,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"font-semibold",children:[u.orders.length," pedidos"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"font-bold text-green-600",children:P(u.totalSpent)})})]})]})},u.email))}),e.jsx(Re,{open:c,onOpenChange:d,children:e.jsxs(Le,{className:"sm:max-w-4xl max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsx(Ie,{children:e.jsxs(qe,{className:"flex items-center gap-2 text-base sm:text-lg",children:[e.jsx(ar,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"truncate",children:n?.name})]})}),n&&e.jsxs("div",{className:"space-y-4 sm:space-y-6 py-2 sm:py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsx(Q,{children:e.jsxs(Z,{className:"p-3 sm:p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center text-white font-bold text-xl sm:text-2xl flex-shrink-0",children:n.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-base sm:text-lg truncate",children:n.name}),n.email!=="sem-email"&&e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 truncate",children:n.email})]})]}),n.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[e.jsx(Ja,{className:"w-3 h-3 sm:w-4 sm:h-4 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:n.phone})]})]})}),e.jsx(Q,{children:e.jsx(Z,{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-600",children:"Total Gasto"}),e.jsx("span",{className:"text-lg sm:text-2xl font-bold text-green-600",children:P(n.totalSpent)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-600",children:"Pedidos"}),e.jsx("span",{className:"text-base sm:text-xl font-semibold",children:n.orders.length})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-600",children:"Ticket Mdio"}),e.jsx("span",{className:"text-sm sm:text-lg font-semibold",children:P(n.orders.length>0?n.totalSpent/n.orders.length:0)})]}),n.lastOrderDate&&e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-600",children:"ltimo Pedido"}),e.jsx("span",{className:"text-xs sm:text-sm font-medium",children:n.lastOrderDate.fromNow()})]})]})})})]}),e.jsxs("div",{children:[e.jsx(he,{className:"p-3 sm:p-6",children:e.jsxs(xe,{className:"flex items-center gap-2 text-base sm:text-lg",children:[e.jsx(Ss,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"Histrico de Pedidos (",n.orders.length,")"]})}),e.jsx(Z,{className:"p-3 sm:p-6 pt-0",children:e.jsx("div",{className:"space-y-2 sm:space-y-3 max-h-64 sm:max-h-96 overflow-y-auto",children:n.orders.length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Nenhum pedido registrado"}):n.orders.sort((u,_)=>new Date(_.created_date)-new Date(u.created_date)).map(u=>e.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs(ye,{variant:"outline",className:"font-mono",children:["#",u.order_code||u.id?.slice(-6)]}),e.jsx(ye,{className:u.status==="delivered"?"bg-green-500":u.status==="cancelled"?"bg-red-500":"bg-yellow-500",children:u.status==="delivered"?"Entregue":u.status==="cancelled"?"Cancelado":u.status})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx(Rt,{className:"w-3 h-3 inline mr-1"}),ee(u.created_date).format("DD/MM/YYYY HH:mm")]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold text-green-600",children:P(u.total)}),e.jsx("p",{className:"text-xs text-gray-500 capitalize",children:u.payment_method?.replace("_"," ")})]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Itens:"})," ",(u.items||[]).length]}),u.delivery_method&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tipo:"})," ",u.delivery_method==="delivery"?"Entrega ":"Retirada "]})]})]},u.id))})})]})]}),e.jsxs(Qs,{children:[e.jsx(A,{variant:"outline",onClick:()=>d(!1),children:"Fechar"}),n?.phone&&e.jsxs(A,{onClick:()=>window.open(`https://wa.me/55${n.phone.replace(/\D/g,"")}`,"_blank"),children:[e.jsx(Ja,{className:"w-4 h-4 mr-2"}),"WhatsApp"]})]})]})})]})}function Q0(){return e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[1,2,3,4].map(s=>e.jsxs(Qe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:s*.05},className:"bg-white rounded-xl p-6 shadow-sm border animate-pulse",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-lg"}),e.jsx("div",{className:"w-12 h-5 bg-gray-200 rounded-full"})]}),e.jsx("div",{className:"w-24 h-8 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"w-32 h-4 bg-gray-200 rounded"})]},s))}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border mb-6 animate-pulse",children:[e.jsx("div",{className:"w-48 h-6 bg-gray-200 rounded mb-4"}),e.jsx("div",{className:"h-64 bg-gray-100 rounded"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b animate-pulse",children:e.jsx("div",{className:"w-48 h-6 bg-gray-200 rounded"})}),[1,2,3,4,5].map(s=>e.jsx(Qe.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:s*.05},className:"p-4 border-b last:border-b-0 animate-pulse",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-lg"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-40 h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"w-24 h-3 bg-gray-200 rounded"})]})]}),e.jsx("div",{className:"w-24 h-6 bg-gray-200 rounded"})]})},s))]})]})}function _v(){const{menuContext:s}=as(),{data:a=[],isLoading:t}=Wt({orderBy:"-created_date"}),{data:r=[],isLoading:n}=ke({queryKey:["pedidosPDV",s?.type,s?.value],queryFn:async()=>{if(!s)return[];const c={};return s.type==="subscriber"&&s.value&&(c.as_subscriber=s.value),se.entities.PedidoPDV.list("-created_date",c)},enabled:!!s});return t||n?e.jsx(Q0,{}):e.jsx(Xm,{orders:a,pdvSales:r})}function Cv(){const[s,a]=b.useState(!1),[t,r]=b.useState(""),[n,l]=b.useState("all"),[c,d]=b.useState({neighborhood:"",fee:"",is_active:!0}),[i,o]=b.useState({delivery_fee_mode:"zone",delivery_fee:0,min_order_value:0,latitude:null,longitude:null,delivery_base_fee:0,delivery_price_per_km:0,delivery_min_fee:0,delivery_max_fee:null,delivery_free_distance:null}),m=ts(),{menuContext:p}=as(),{data:x=[]}=ke({queryKey:["store",p?.type,p?.value],queryFn:async()=>{if(!p)return[];const j={};return p.type==="subscriber"&&p.value&&(j.as_subscriber=p.value),se.entities.Store.list(null,j)},enabled:!!p}),g=x[0];b.useEffect(()=>{g&&o({delivery_fee_mode:g.delivery_fee_mode||"zone",delivery_fee:g.delivery_fee||0,min_order_value:g.min_order_value||g.min_order_price||0,latitude:g.latitude||null,longitude:g.longitude||null,delivery_base_fee:g.delivery_base_fee||0,delivery_price_per_km:g.delivery_price_per_km||0,delivery_min_fee:g.delivery_min_fee||0,delivery_max_fee:g.delivery_max_fee??null,delivery_free_distance:g.delivery_free_distance??null})},[g]);const f=de({mutationFn:({data:j})=>se.entities.Store.update(g.id,j),onSuccess:()=>{m.invalidateQueries({queryKey:["store"]}),K.success("Configurao de entrega salva")},onError:j=>K.error(j?.message||"Erro ao salvar")}),{data:y=[]}=ke({queryKey:["deliveryZones",p?.type,p?.value],queryFn:async()=>{if(!p)return[];try{const j={};p.type==="subscriber"&&p.value&&(j.as_subscriber=p.value);const D=await se.entities.DeliveryZone.list("neighborhood",j);return Array.isArray(D)?D:[]}catch(j){return console.error("Erro ao buscar zonas:",j),[]}},enabled:!!p,initialData:[],refetchOnMount:"always"}),v=b.useMemo(()=>Array.isArray(y)?y.filter(j=>{const D=!t||j.neighborhood?.toLowerCase().includes(t.toLowerCase()),V=n==="all"||n==="active"&&j.is_active||n==="inactive"&&!j.is_active;return D&&V}):[],[y,t,n]),P=b.useMemo(()=>{const j=Array.isArray(y)?y:[],D=j.filter(z=>z.is_active).length,V=j.filter(z=>!z.is_active).length,T=j.reduce((z,k)=>{const h=parseFloat(k.fee||0);return z+(isNaN(h)?0:h)},0),N=D>0?T/D:0;return{total:j.length,active:D,inactive:V,avgFee:N}},[y]),M=de({mutationFn:j=>se.entities.DeliveryZone.create(j),onSuccess:()=>{m.invalidateQueries({queryKey:["deliveryZones"]}),u();const j=document.createElement("div");j.className="fixed top-4 right-4 z-[9999] bg-green-600 text-white px-6 py-4 rounded-xl shadow-2xl",j.innerHTML=" Zona criada!",document.body.appendChild(j),setTimeout(()=>j.remove(),2e3)}}),O=de({mutationFn:({id:j,data:D})=>se.entities.DeliveryZone.update(j,D),onSuccess:()=>{m.invalidateQueries({queryKey:["deliveryZones"]}),K.success(" Salvo!")}}),E=de({mutationFn:j=>se.entities.DeliveryZone.delete(j),onSuccess:()=>m.invalidateQueries({queryKey:["deliveryZones"]})}),u=()=>{a(!1),d({neighborhood:"",fee:"",is_active:!0})},_=j=>{j.preventDefault(),M.mutate({...c,fee:parseFloat(c.fee)||0})},$=j=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(j||0);return e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[g&&e.jsxs(Q,{children:[e.jsxs(he,{children:[e.jsx(xe,{children:"Configurao de entrega"}),e.jsx(xs,{children:"Modo de clculo, taxa padro e pedido mnimo. Taxas por bairro abaixo."})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{className:"mb-2 block",children:"Modo de clculo"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{type:"button",variant:i.delivery_fee_mode==="zone"?"default":"outline",size:"sm",onClick:()=>o(j=>({...j,delivery_fee_mode:"zone"})),children:"Por zona/bairro"}),e.jsx(A,{type:"button",variant:i.delivery_fee_mode==="distance"?"default":"outline",size:"sm",onClick:()=>o(j=>({...j,delivery_fee_mode:"distance"})),children:"Por distncia (km)"})]})]}),i.delivery_fee_mode==="zone"&&e.jsxs("div",{children:[e.jsx(R,{children:"Taxa padro (R$)"}),e.jsx(B,{type:"number",step:"0.01",value:i.delivery_fee,onChange:j=>o(D=>({...D,delivery_fee:parseFloat(j.target.value)||0}))})]}),i.delivery_fee_mode==="distance"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Latitude"}),e.jsx(B,{type:"number",step:"0.000001",value:i.latitude||"",onChange:j=>o(D=>({...D,latitude:j.target.value?parseFloat(j.target.value):null})),placeholder:"-5.08"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Longitude"}),e.jsx(B,{type:"number",step:"0.000001",value:i.longitude||"",onChange:j=>o(D=>({...D,longitude:j.target.value?parseFloat(j.target.value):null})),placeholder:"-42.80"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Taxa base (R$)"}),e.jsx(B,{type:"number",step:"0.01",value:i.delivery_base_fee,onChange:j=>o(D=>({...D,delivery_base_fee:parseFloat(j.target.value)||0}))})]}),e.jsxs("div",{children:[e.jsx(R,{children:"R$ por km"}),e.jsx(B,{type:"number",step:"0.01",value:i.delivery_price_per_km,onChange:j=>o(D=>({...D,delivery_price_per_km:parseFloat(j.target.value)||0}))})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Taxa mn (R$)"}),e.jsx(B,{type:"number",step:"0.01",value:i.delivery_min_fee,onChange:j=>o(D=>({...D,delivery_min_fee:parseFloat(j.target.value)||0}))})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Taxa mx (R$)"}),e.jsx(B,{type:"number",step:"0.01",value:i.delivery_max_fee??"",onChange:j=>o(D=>({...D,delivery_max_fee:j.target.value?parseFloat(j.target.value):null}))})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Grtis at (km)"}),e.jsx(B,{type:"number",step:"0.1",value:i.delivery_free_distance??"",onChange:j=>o(D=>({...D,delivery_free_distance:j.target.value?parseFloat(j.target.value):null}))})]})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Pedido mnimo (R$)"}),e.jsx(B,{type:"number",step:"0.01",value:i.min_order_value,onChange:j=>o(D=>({...D,min_order_value:parseFloat(j.target.value)||0}))})]}),e.jsx(A,{onClick:()=>f.mutate({data:i}),disabled:f.isPending,children:"Salvar configurao"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(Q,{children:e.jsx(Z,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total de Zonas"}),e.jsx("p",{className:"text-2xl font-bold",children:P.total})]}),e.jsx(za,{className:"w-8 h-8 text-blue-500"})]})})}),e.jsx(Q,{children:e.jsx(Z,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Ativas"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:P.active})]}),e.jsx($s,{className:"w-8 h-8 text-green-500"})]})})}),e.jsx(Q,{children:e.jsx(Z,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Inativas"}),e.jsx("p",{className:"text-2xl font-bold text-gray-400",children:P.inactive})]}),e.jsx(Ss,{className:"w-8 h-8 text-gray-400"})]})})}),e.jsx(Q,{children:e.jsx(Z,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Taxa Mdia"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:$(P.avgFee)})]}),e.jsx($s,{className:"w-8 h-8 text-orange-500"})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ms,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(B,{placeholder:"Buscar zona por bairro...",value:t,onChange:j=>r(j.target.value),className:"pl-10"})]}),e.jsxs(Se,{value:n,onValueChange:l,children:[e.jsxs(De,{className:"w-[140px]",children:[e.jsx(ua,{className:"w-4 h-4 mr-2"}),e.jsx(Me,{})]}),e.jsxs(Ae,{children:[e.jsx(X,{value:"all",children:"Todas"}),e.jsx(X,{value:"active",children:"Ativas"}),e.jsx(X,{value:"inactive",children:"Inativas"})]})]}),e.jsxs(A,{onClick:()=>a(!0),className:"bg-orange-500 hover:bg-orange-600",children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Nova Zona"]})]}),e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4",children:v.length===0?e.jsx("div",{className:"col-span-full",children:e.jsx(gn,{icon:za,title:"Defina as zonas de entrega para calcular taxas corretamente",description:"Configure taxas por bairro para cobrar valores justos e transparentes",actionLabel:"Criar zona de entrega",onAction:()=>a(!0)})}):y.map(j=>e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(za,{className:"w-5 h-5 text-blue-600"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("input",{type:"text",value:j.neighborhood,onChange:D=>O.mutate({id:j.id,data:{...j,neighborhood:D.target.value}}),className:"font-semibold text-base bg-transparent border-b border-transparent hover:border-gray-300 focus:border-orange-500 focus:outline-none w-full"})})]}),e.jsx(Ve,{checked:j.is_active,onCheckedChange:D=>O.mutate({id:j.id,data:{...j,is_active:D}})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(R,{className:"text-xs text-gray-500",children:"Taxa de Entrega"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"R$"}),e.jsx("input",{type:"number",step:"0.01",value:j.fee,onChange:D=>O.mutate({id:j.id,data:{...j,fee:parseFloat(D.target.value)||0}}),className:"flex-1 px-2 py-1 border rounded text-sm"})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t",children:[e.jsx("span",{className:"text-lg font-bold text-green-600",children:$(j.fee)}),e.jsx(A,{size:"icon",variant:"ghost",className:"h-8 w-8 text-red-500 hover:text-red-700",onClick:()=>{confirm(`Excluir a zona "${j.neighborhood}"?`)&&E.mutate(j.id)},children:e.jsx(Xe,{className:"w-4 h-4"})})]})]},j.id))}),e.jsx(Re,{open:s,onOpenChange:a,children:e.jsxs(Le,{className:"sm:max-w-sm max-w-[95vw]",children:[e.jsx(Ie,{children:e.jsxs(qe,{className:"flex items-center gap-2",children:[e.jsx(za,{className:"w-5 h-5"}),"Nova Zona de Entrega"]})}),e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome do Bairro"}),e.jsx(B,{value:c.neighborhood,onChange:j=>d(D=>({...D,neighborhood:j.target.value})),placeholder:"Ex: Centro, Jardins...",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Taxa de Entrega (R$)"}),e.jsx(B,{type:"number",step:"0.01",value:c.fee,onChange:j=>d(D=>({...D,fee:j.target.value})),placeholder:"0.00",required:!0})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx(R,{children:"Zona ativa"}),e.jsx(Ve,{checked:c.is_active,onCheckedChange:j=>d(D=>({...D,is_active:j}))})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(A,{type:"button",variant:"outline",onClick:u,className:"flex-1",children:"Cancelar"}),e.jsx(A,{type:"submit",className:"flex-1 bg-orange-500 hover:bg-orange-600",children:"Criar"})]})]})]})})]})}function kv(){const[s,a]=b.useState(!1),[t,r]=b.useState(""),[n,l]=b.useState("all"),[c,d]=b.useState("all"),[i,o]=b.useState({code:"",discount_type:"percentage",discount_value:"",min_order_value:"",max_uses:"",is_active:!0,expires_at:""}),m=ts(),{menuContext:p}=as(),{data:x=[]}=ke({queryKey:["coupons",p?.type,p?.value],queryFn:async()=>{if(!p)return[];const j={};return p.type==="subscriber"&&p.value&&(j.as_subscriber=p.value),se.entities.Coupon.list("-created_date",j)},enabled:!!p}),g=de({mutationFn:j=>se.entities.Coupon.create(j),onSuccess:()=>{m.invalidateQueries({queryKey:["coupons"]}),v(),Bs.success("Cupom criado com sucesso!")}}),f=de({mutationFn:({id:j,data:D})=>se.entities.Coupon.update(j,D),onSuccess:()=>m.invalidateQueries({queryKey:["coupons"]})}),y=de({mutationFn:j=>se.entities.Coupon.delete(j),onSuccess:()=>{m.invalidateQueries({queryKey:["coupons"]}),Bs.success("Cupom excludo!")}}),v=()=>{a(!1),o({code:"",discount_type:"percentage",discount_value:"",min_order_value:"",max_uses:"",is_active:!0,expires_at:""})},P=j=>{j.preventDefault(),g.mutate({...i,code:i.code.toUpperCase(),discount_value:parseFloat(i.discount_value)||0,min_order_value:parseFloat(i.min_order_value)||0,max_uses:parseInt(i.max_uses)||0,current_uses:0})},M=()=>{const j="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let D="";for(let V=0;V<8;V++)D+=j.charAt(Math.floor(Math.random()*j.length));o(V=>({...V,code:D}))},O=j=>{navigator.clipboard.writeText(j),Bs.success("Cdigo copiado!")},E=j=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(j||0),u=j=>{if(!j)return!1;try{const D=new Date(j);return!isNaN(D.getTime())&&D<new Date}catch{return!1}},_=b.useMemo(()=>Array.isArray(x)?x.filter(j=>{const D=!t||j.code?.toLowerCase().includes(t.toLowerCase()),V=u(j.expires_at),T=j.max_uses>0&&j.current_uses>=j.max_uses,N=j.is_active&&!V&&!T,z=n==="all"||n==="active"&&N||n==="inactive"&&!j.is_active||n==="expired"&&V||n==="exhausted"&&T,k=c==="all"||j.discount_type===c;return D&&z&&k}):[],[x,t,n,c]),$=b.useMemo(()=>{const D=(Array.isArray(x)?x:[]).filter(h=>{const F=u(h.expires_at),S=h.max_uses>0&&h.current_uses>=h.max_uses;return h.is_active&&!F&&!S}).length,V=x.filter(h=>u(h.expires_at)).length,T=x.filter(h=>h.max_uses>0&&h.current_uses>=h.max_uses).length,N=x.filter(h=>h.discount_type==="percentage").length,z=x.filter(h=>h.discount_type==="fixed").length,k=x.reduce((h,F)=>h+(F.current_uses||0),0);return{total:x.length,active:D,expired:V,exhausted:T,percentage:N,fixed:z,totalUses:k}},[x,u]);return e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Q,{children:e.jsx(Z,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold",children:$.total})]}),e.jsx(ii,{className:"w-8 h-8 text-orange-500"})]})})}),e.jsx(Q,{children:e.jsx(Z,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Ativos"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:$.active})]}),e.jsx($s,{className:"w-8 h-8 text-green-500"})]})})}),e.jsx(Q,{children:e.jsx(Z,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Expirados"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:$.expired})]}),e.jsx(Rt,{className:"w-8 h-8 text-red-500"})]})})}),e.jsx(Q,{children:e.jsx(Z,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Usos Totais"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:$.totalUses})]}),e.jsx($a,{className:"w-8 h-8 text-blue-500"})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ms,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(B,{placeholder:"Buscar cupom por cdigo...",value:t,onChange:j=>r(j.target.value),className:"pl-10 font-mono"})]}),e.jsxs(Se,{value:n,onValueChange:l,children:[e.jsxs(De,{className:"w-[140px]",children:[e.jsx(ua,{className:"w-4 h-4 mr-2"}),e.jsx(Me,{})]}),e.jsxs(Ae,{children:[e.jsx(X,{value:"all",children:"Todos"}),e.jsx(X,{value:"active",children:"Ativos"}),e.jsx(X,{value:"inactive",children:"Inativos"}),e.jsx(X,{value:"expired",children:"Expirados"}),e.jsx(X,{value:"exhausted",children:"Esgotados"})]})]}),e.jsxs(Se,{value:c,onValueChange:d,children:[e.jsx(De,{className:"w-[160px]",children:e.jsx(Me,{})}),e.jsxs(Ae,{children:[e.jsx(X,{value:"all",children:"Todos os tipos"}),e.jsx(X,{value:"percentage",children:"Porcentagem"}),e.jsx(X,{value:"fixed",children:"Valor Fixo"})]})]}),e.jsxs(A,{onClick:()=>a(!0),className:"bg-orange-500 hover:bg-orange-600",children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Novo Cupom"]})]}),e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4",children:_.length===0?e.jsxs("div",{className:"col-span-full text-center py-12 text-gray-400 border-2 border-dashed rounded-xl",children:[e.jsx(ii,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Nenhum cupom cadastrado ainda"})]}):_.map(j=>{const D=u(j.expires_at),V=j.max_uses>0&&j.current_uses>=j.max_uses,T=j.is_active&&!D&&!V;return e.jsxs("div",{className:`bg-white rounded-xl p-4 shadow-sm border-2 ${T?"border-green-200":"border-gray-200 opacity-60"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${j.discount_type==="percentage"?"bg-purple-100":"bg-green-100"}`,children:j.discount_type==="percentage"?e.jsx(ru,{className:"w-5 h-5 text-purple-600"}):e.jsx($a,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>O(j.code),className:"font-mono font-bold text-lg hover:text-orange-500 flex items-center gap-1",children:[j.code,e.jsx(Js,{className:"w-3 h-3"})]}),e.jsx("p",{className:"text-sm text-gray-500",children:j.discount_type==="percentage"?`${j.discount_value}% de desconto`:`${E(j.discount_value)} de desconto`})]})]}),e.jsx(Ve,{checked:j.is_active,onCheckedChange:N=>f.mutate({id:j.id,data:{...j,is_active:N}})})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[j.min_order_value>0&&e.jsxs("div",{className:"flex justify-between text-gray-500",children:[e.jsx("span",{children:"Pedido mnimo:"}),e.jsx("span",{children:E(j.min_order_value)})]}),j.max_uses>0&&e.jsxs("div",{className:"flex justify-between text-gray-500",children:[e.jsx("span",{children:"Usos:"}),e.jsxs("span",{children:[j.current_uses||0," / ",j.max_uses]})]}),j.expires_at&&e.jsxs("div",{className:"flex justify-between text-gray-500",children:[e.jsx("span",{children:"Expira em:"}),e.jsx("span",{className:D?"text-red-500":"",children:Et(new Date(j.expires_at),"dd/MM/yyyy")})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-3 border-t",children:[e.jsxs("div",{className:"flex gap-1",children:[!T&&e.jsx(ye,{variant:"outline",className:"text-xs text-red-500 border-red-200",children:D?"Expirado":V?"Esgotado":"Inativo"}),T&&e.jsx(ye,{className:"bg-green-100 text-green-700 text-xs",children:"Ativo"})]}),e.jsx(A,{size:"icon",variant:"ghost",className:"h-8 w-8 text-red-500 hover:text-red-700",onClick:()=>{confirm("Excluir este cupom?")&&y.mutate(j.id)},children:e.jsx(Xe,{className:"w-4 h-4"})})]})]},j.id)})}),e.jsx(Re,{open:s,onOpenChange:a,children:e.jsxs(Le,{className:"sm:max-w-md max-w-[95vw]",children:[e.jsx(Ie,{children:e.jsxs(qe,{className:"flex items-center gap-2",children:[e.jsx(ii,{className:"w-5 h-5"})," Criar Cupom"]})}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Cdigo do Cupom"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(B,{value:i.code,onChange:j=>o(D=>({...D,code:j.target.value.toUpperCase()})),placeholder:"Ex: DESCONTO10",className:"font-mono uppercase",required:!0}),e.jsx(A,{type:"button",variant:"outline",onClick:M,children:"Gerar"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Tipo de Desconto"}),e.jsxs(Se,{value:i.discount_type,onValueChange:j=>o(D=>({...D,discount_type:j})),children:[e.jsx(De,{children:e.jsx(Me,{})}),e.jsxs(Ae,{children:[e.jsx(X,{value:"percentage",children:"Porcentagem (%)"}),e.jsx(X,{value:"fixed",children:"Valor Fixo (R$)"})]})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Valor do Desconto"}),e.jsx(B,{type:"number",step:"0.01",value:i.discount_value,onChange:j=>o(D=>({...D,discount_value:j.target.value})),placeholder:i.discount_type==="percentage"?"10":"5.00",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Pedido Mnimo (R$)"}),e.jsx(B,{type:"number",step:"0.01",value:i.min_order_value,onChange:j=>o(D=>({...D,min_order_value:j.target.value})),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Limite de Usos"}),e.jsx(B,{type:"number",value:i.max_uses,onChange:j=>o(D=>({...D,max_uses:j.target.value})),placeholder:"Ilimitado"})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Data de Expirao"}),e.jsx(B,{type:"date",value:i.expires_at,onChange:j=>o(D=>({...D,expires_at:j.target.value}))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx(R,{children:"Ativar cupom"}),e.jsx(Ve,{checked:i.is_active,onCheckedChange:j=>o(D=>({...D,is_active:j}))})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(A,{type:"button",variant:"outline",onClick:v,className:"flex-1",children:"Cancelar"}),e.jsx(A,{type:"submit",className:"flex-1 bg-orange-500 hover:bg-orange-600",children:"Criar Cupom"})]})]})]})})]})}const Lr=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s||0);function Z0({isOpen:s,onClose:a,onSubmit:t,combo:r,dishes:n=[],pizzas:l=[],beverages:c=[]}){const d=(n||[]).filter(u=>u.product_type!=="pizza"&&u.product_type!=="beverage"),i=(l||[]).filter(u=>u.product_type==="pizza"),o=(c||[]).filter(u=>u.product_type==="beverage"),m=i.length>0,p=o.length>0,[x,g]=b.useState(r||{name:"",description:"",type:"bundle_discount",combo_mode:"dishes_beverages",combo_action:"add",dishes:[],beverages:[],original_price:0,combo_price:0,discount_type:"percentage",discount_value:0,buy_quantity:3,pay_quantity:2,is_active:!0,is_highlight:!1,valid_until:""});ae.useEffect(()=>{g(r?{...r,dishes:r.dishes||[],beverages:r.beverages||[],combo_mode:r.combo_mode||"dishes_beverages",combo_action:r.combo_action||"add"}:{name:"",description:"",type:"bundle_discount",combo_mode:m?"pizzas_beverages":"dishes_beverages",combo_action:"add",dishes:[],beverages:[],original_price:0,combo_price:0,discount_type:"percentage",discount_value:0,buy_quantity:3,pay_quantity:2,is_active:!0,is_highlight:!1,valid_until:""})},[r,s,m]);const f=x.combo_mode==="pizzas_beverages"?i:d,y=(u,_)=>{const $=x.combo_mode==="pizzas_beverages"?i:d,j=(u||[]).reduce((V,T)=>{const N=$.find(k=>k.id===T.dish_id),z=N?.pizza_config?.sizes?.[0]?.price_tradicional??N?.price??0;return V+(z||0)*T.quantity},0),D=(_||[]).reduce((V,T)=>{const N=o.find(z=>z.id===T.dish_id);return V+(N?.price||0)*T.quantity},0);g(V=>({...V,original_price:j+D}))},v=u=>{const _=x.dishes||[],$=_.find(D=>D.dish_id===u);let j;$?j=_.map(D=>D.dish_id===u?{...D,quantity:D.quantity+1}:D):j=[..._,{dish_id:u,quantity:1}],g(D=>({...D,dishes:j})),y(j,x.beverages)},P=u=>{const _=x.beverages||[],$=_.find(D=>D.dish_id===u);let j;$?j=_.map(D=>D.dish_id===u?{...D,quantity:D.quantity+1}:D):j=[..._,{dish_id:u,quantity:1}],g(D=>({...D,beverages:j})),y(x.dishes,j)},M=u=>{const _=(x.dishes||[]).filter($=>$.dish_id!==u);g($=>({...$,dishes:_})),y(_,x.beverages)},O=u=>{const _=(x.beverages||[]).filter($=>$.dish_id!==u);g($=>({...$,beverages:_})),y(x.dishes,_)},E=u=>{u.preventDefault(),t(x)};return e.jsx(Re,{open:s,onOpenChange:a,children:e.jsxs(Le,{className:"sm:max-w-3xl max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsx(Ie,{children:e.jsxs(qe,{className:"flex items-center gap-2",children:[e.jsx("span",{children:r?"Editar Combo":"Criar Combo"}),e.jsx(ye,{variant:"outline",children:"Promoes"})]})}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(R,{children:"Nome do Combo *"}),e.jsx(B,{value:x.name,onChange:u=>g(_=>({..._,name:u.target.value})),placeholder:"Ex: Combo Executivo",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Tipo de Combinao"}),e.jsxs(Se,{value:x.combo_mode,onValueChange:u=>g(_=>({..._,combo_mode:u,dishes:[]})),children:[e.jsx(De,{children:e.jsx(Me,{})}),e.jsxs(Ae,{children:[e.jsxs(X,{value:"dishes_beverages",children:[e.jsx(na,{className:"w-4 h-4 mr-2 inline"})," Pratos + Bebidas"]}),m&&e.jsxs(X,{value:"pizzas_beverages",children:[e.jsx(Wo,{className:"w-4 h-4 mr-2 inline"})," Pizzas + Bebidas"]})]})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Ao no Carrinho"}),e.jsxs(Se,{value:x.combo_action,onValueChange:u=>g(_=>({..._,combo_action:u})),children:[e.jsx(De,{children:e.jsx(Me,{})}),e.jsxs(Ae,{children:[e.jsx(X,{value:"add",children:"Adicionar combo ao pedido"}),e.jsx(X,{value:"replace",children:"Substituir item pelo combo"})]})]})]})]}),e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50 dark:bg-gray-800/50",children:[e.jsx(R,{className:"mb-2 block",children:x.combo_mode==="pizzas_beverages"?"Pizzas":"Pratos"}),e.jsxs(Se,{onValueChange:v,children:[e.jsx(De,{children:e.jsx(Me,{placeholder:`Adicionar ${x.combo_mode==="pizzas_beverages"?"pizza":"prato"}`})}),e.jsx(Ae,{children:f.filter(u=>u.is_active!==!1).map(u=>e.jsxs(X,{value:u.id,children:[u.name," - ",Lr(u.pizza_config?.sizes?.[0]?.price_tradicional??u.price)]},u.id))})]}),e.jsx("div",{className:"mt-2 space-y-2",children:(x.dishes||[]).map(u=>{const _=f.find(j=>j.id===u.dish_id);if(!_)return null;const $=_.pizza_config?.sizes?.[0]?.price_tradicional??_.price;return e.jsxs("div",{className:"flex items-center justify-between bg-white dark:bg-gray-900 p-2 rounded border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[_.image&&e.jsx("img",{src:_.image,alt:"",className:"w-10 h-10 rounded object-cover"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:_.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[Lr($)," x ",u.quantity]})]})]}),e.jsx(A,{type:"button",size:"sm",variant:"ghost",onClick:()=>M(u.dish_id),children:e.jsx(Ds,{className:"w-4 h-4 text-red-500"})})]},u.dish_id)})})]}),p&&e.jsxs("div",{className:"border rounded-lg p-4 bg-cyan-50/50 dark:bg-cyan-900/10",children:[e.jsxs(R,{className:"mb-2 block flex items-center gap-2",children:[e.jsx(nu,{className:"w-4 h-4"})," Bebidas"]}),e.jsxs(Se,{onValueChange:P,children:[e.jsx(De,{children:e.jsx(Me,{placeholder:"Adicionar bebida"})}),e.jsx(Ae,{children:o.filter(u=>u.is_active!==!1).map(u=>e.jsxs(X,{value:u.id,children:[u.name," ",u.volume_ml?`(${u.volume_ml}ml)`:""," - ",Lr(u.price)]},u.id))})]}),e.jsx("div",{className:"mt-2 space-y-2",children:(x.beverages||[]).map(u=>{const _=o.find($=>$.id===u.dish_id);return _?e.jsxs("div",{className:"flex items-center justify-between bg-white dark:bg-gray-900 p-2 rounded border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[_.image&&e.jsx("img",{src:_.image,alt:"",className:"w-10 h-10 rounded object-cover"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:_.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[Lr(_.price)," x ",u.quantity]})]})]}),e.jsx(A,{type:"button",size:"sm",variant:"ghost",onClick:()=>O(u.dish_id),children:e.jsx(Ds,{className:"w-4 h-4 text-red-500"})})]},u.dish_id):null})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Preo Original"}),e.jsx(B,{type:"number",step:"0.01",value:x.original_price,readOnly:!0,className:"bg-gray-100"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Preo do Combo *"}),e.jsx(B,{type:"number",step:"0.01",value:x.combo_price,onChange:u=>g(_=>({..._,combo_price:parseFloat(u.target.value)||0})),required:!0})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Descrio"}),e.jsx(Os,{value:x.description,onChange:u=>g(_=>({..._,description:u.target.value})),rows:2,placeholder:"Descreva o combo..."})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded",children:[e.jsx(R,{children:"Destacar no cardpio"}),e.jsx(Ve,{checked:x.is_highlight,onCheckedChange:u=>g(_=>({..._,is_highlight:u}))})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(A,{type:"button",variant:"outline",onClick:a,className:"flex-1",children:"Cancelar"}),e.jsx(A,{type:"submit",className:"flex-1 bg-orange-500",children:r?"Salvar":"Criar Combo"})]})]})]})})}const No={enabled:!0,beverage_offer:{enabled:!0,trigger_product_types:["pizza"],min_cart_value:0,dish_id:null,title:" Que tal uma bebida?",message:"Pizza sem bebida? Adicione {product_name} por apenas {product_price}",discount_percent:0},dessert_offer:{enabled:!0,min_cart_value:40,dish_id:null,title:" Que tal uma sobremesa?",message:"Complete seu pedido com {product_name} por apenas {product_price}",discount_percent:0},combo_offer:{enabled:!0,min_pizzas:2,dish_id:null,title:" Oferta Especial!",message:"Compre {min_pizzas} pizzas e ganhe {product_name} GRTIS!",discount_percent:100}};function Sv(){const[s,a]=b.useState(!1),[t,r]=b.useState(!1),[n,l]=b.useState(null),[c,d]=b.useState(""),[i,o]=b.useState("all"),[m,p]=b.useState("all"),[x,g]=b.useState({name:"",type:"add",trigger_min_value:"",offer_dish_id:"",offer_price:"",original_price:"",description:"",is_active:!0}),f=ts(),{menuContext:y}=as(),{data:v=[]}=ke({queryKey:["promotions",y?.type,y?.value],queryFn:async()=>{if(!y)return[];const C={};return y.type==="subscriber"&&y.value&&(C.as_subscriber=y.value),se.entities.Promotion.list(null,C)},enabled:!!y}),{data:P=[]}=_r(),{data:M=[]}=ke({queryKey:["combos",y?.type,y?.value],queryFn:async()=>{if(!y)return[];const C={};return y.type==="subscriber"&&y.value&&(C.as_subscriber=y.value),se.entities.Combo.list(null,C)},enabled:!!y}),{data:O=[]}=ke({queryKey:["store",y?.type,y?.value],queryFn:async()=>{if(!y)return[];const C={};return y.type==="subscriber"&&y.value&&(C.as_subscriber=y.value),se.entities.Store.list(null,C)},enabled:!!y}),E=O[0],[u,_]=b.useState(No);b.useEffect(()=>{E?.cross_sell_config&&_(C=>({...No,...E.cross_sell_config}))},[E?.id,E?.cross_sell_config]);const $=de({mutationFn:async C=>{if(!E?.id)throw new Error("Loja no encontrada");const Y=y?.type==="subscriber"&&y?.value?{as_subscriber:y.value}:{};return se.entities.Store.update(E.id,{cross_sell_config:C},Y)},onSuccess:()=>{f.invalidateQueries({queryKey:["store"]}),Bs.success("Ofertas Inteligentes salvas")},onError:C=>Bs.error(C?.message||"Erro ao salvar")}),j=de({mutationFn:C=>se.entities.Promotion.create(C),onSuccess:()=>{f.invalidateQueries({queryKey:["promotions"]}),k(),Bs.success("Promoo criada!")}}),D=de({mutationFn:({id:C,data:Y})=>se.entities.Promotion.update(C,Y),onSuccess:()=>{f.invalidateQueries({queryKey:["promotions"]}),Bs.success("Promoo atualizada!")}}),V=de({mutationFn:C=>se.entities.Promotion.delete(C),onSuccess:()=>{f.invalidateQueries({queryKey:["promotions"]}),Bs.success("Promoo excluda!")}}),T=de({mutationFn:C=>se.entities.Combo.create(C),onSuccess:()=>{f.invalidateQueries({queryKey:["combos"]}),r(!1),l(null),Bs.success("Combo criado!")}}),N=de({mutationFn:({id:C,data:Y})=>se.entities.Combo.update(C,Y),onSuccess:()=>{f.invalidateQueries({queryKey:["combos"]}),r(!1),l(null),Bs.success("Combo atualizado!")}}),z=de({mutationFn:C=>se.entities.Combo.delete(C),onSuccess:()=>{f.invalidateQueries({queryKey:["combos"]}),Bs.success("Combo excludo!")}}),k=()=>{a(!1),g({name:"",type:"add",trigger_min_value:"",offer_dish_id:"",offer_price:"",original_price:"",description:"",is_active:!0})},h=C=>{C.preventDefault(),j.mutate({...x,trigger_min_value:parseFloat(x.trigger_min_value)||0,offer_price:parseFloat(x.offer_price)||0,original_price:parseFloat(x.original_price)||0})},F=C=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(C||0),S=Array.isArray(P)?P:[],q=b.useMemo(()=>C=>S.find(Y=>Y.id===C)?.name||"Prato no encontrado",[S]),J=b.useMemo(()=>Array.isArray(v)?v.filter(C=>{const Y=!c||C.name?.toLowerCase().includes(c.toLowerCase())||q(C.offer_dish_id).toLowerCase().includes(c.toLowerCase()),L=i==="all"||i==="active"&&C.is_active||i==="inactive"&&!C.is_active,oe=m==="all"||C.type===m;return Y&&L&&oe}):[],[v,c,i,m,q]),W=b.useMemo(()=>{const C=Array.isArray(v)?v:[],Y=C.filter(ve=>ve.is_active).length,L=C.filter(ve=>!ve.is_active).length,oe=C.filter(ve=>ve.type==="add").length,Pe=C.filter(ve=>ve.type==="replace").length;return{total:C.length,active:Y,inactive:L,addType:oe,replaceType:Pe}},[v]);return e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[E&&e.jsxs(Q,{children:[e.jsxs(he,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(rr,{className:"w-5 h-5 text-orange-500"}),"Ofertas Inteligentes (Cross-sell)"]}),e.jsx(xs,{children:"Configure ofertas automticas que aparecem quando o cliente adiciona itens ao carrinho"})]}),e.jsxs(Z,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl",children:[e.jsx(Ve,{checked:u?.enabled!==!1,onCheckedChange:C=>_(Y=>({...Y,enabled:C}))}),e.jsxs("div",{className:"flex-1",children:[e.jsx(R,{className:"font-semibold cursor-pointer",children:"Ativar Ofertas Inteligentes"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:"Sugerir produtos complementares automaticamente para aumentar o ticket mdio"})]})]}),u?.enabled!==!1&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50 dark:bg-gray-800/50 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:""}),e.jsx(R,{className:"text-base font-semibold",children:"Oferta de Bebida"})]}),e.jsx(Ve,{checked:u?.beverage_offer?.enabled!==!1,onCheckedChange:C=>_(Y=>({...Y,beverage_offer:{...Y.beverage_offer,enabled:C}}))})]}),u?.beverage_offer?.enabled!==!1&&e.jsxs("div",{className:"space-y-4 pl-8 border-l-2 border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Produto a Sugerir"}),e.jsxs(Se,{value:u?.beverage_offer?.dish_id||"",onValueChange:C=>_(Y=>({...Y,beverage_offer:{...Y.beverage_offer,dish_id:C||null}})),children:[e.jsx(De,{children:e.jsx(Me,{placeholder:"Selecione uma bebida"})}),e.jsx(Ae,{children:P.filter(C=>C.product_type==="beverage"||C.category?.toLowerCase().includes("bebida")||C.name?.toLowerCase().match(/(coca|pepsi|refrigerante|suco|gua|bebida)/i)).map(C=>e.jsxs(X,{value:C.id,children:[C.name," - ",F(C.price||0)]},C.id))})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Quando o cliente adicionar pizza, esta bebida ser sugerida"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Ttulo da Oferta"}),e.jsx(B,{value:u?.beverage_offer?.title||"",onChange:C=>_(Y=>({...Y,beverage_offer:{...Y.beverage_offer,title:C.target.value}})),placeholder:"Ex:  Que tal uma bebida?"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Mensagem"}),e.jsx(Os,{value:u?.beverage_offer?.message||"",onChange:C=>_(Y=>({...Y,beverage_offer:{...Y.beverage_offer,message:C.target.value}})),placeholder:"Use {product_name} e {product_price} para valores dinmicos",rows:2}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Variveis disponveis: ","{product_name}",", ","{product_price}"]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx(R,{children:"Desconto (%)"}),e.jsx(B,{type:"number",min:"0",max:"100",value:u?.beverage_offer?.discount_percent||0,onChange:C=>_(Y=>({...Y,beverage_offer:{...Y.beverage_offer,discount_percent:parseInt(C.target.value)||0}}))})]})})]})]}),e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50 dark:bg-gray-800/50 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:""}),e.jsx(R,{className:"text-base font-semibold",children:"Oferta de Sobremesa"})]}),e.jsx(Ve,{checked:u?.dessert_offer?.enabled!==!1,onCheckedChange:C=>_(Y=>({...Y,dessert_offer:{...Y.dessert_offer,enabled:C}}))})]}),u?.dessert_offer?.enabled!==!1&&e.jsxs("div",{className:"space-y-4 pl-8 border-l-2 border-purple-200 dark:border-purple-800",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Produto a Sugerir"}),e.jsxs(Se,{value:u?.dessert_offer?.dish_id||"",onValueChange:C=>_(Y=>({...Y,dessert_offer:{...Y.dessert_offer,dish_id:C||null}})),children:[e.jsx(De,{children:e.jsx(Me,{placeholder:"Selecione uma sobremesa"})}),e.jsx(Ae,{children:P.filter(C=>C.category?.toLowerCase().includes("sobremesa")||C.tags?.includes("dessert")||C.name?.toLowerCase().match(/(pudim|brigadeiro|sorvete|aa|sobremesa)/i)).map(C=>e.jsxs(X,{value:C.id,children:[C.name," - ",F(C.price||0)]},C.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Valor Mnimo do Carrinho (R$)"}),e.jsx(B,{type:"number",step:"0.01",value:u?.dessert_offer?.min_cart_value||40,onChange:C=>_(Y=>({...Y,dessert_offer:{...Y.dessert_offer,min_cart_value:parseFloat(C.target.value)||0}}))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Oferta aparece quando carrinho  este valor"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Desconto (%)"}),e.jsx(B,{type:"number",min:"0",max:"100",value:u?.dessert_offer?.discount_percent||0,onChange:C=>_(Y=>({...Y,dessert_offer:{...Y.dessert_offer,discount_percent:parseInt(C.target.value)||0}}))})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Ttulo da Oferta"}),e.jsx(B,{value:u?.dessert_offer?.title||"",onChange:C=>_(Y=>({...Y,dessert_offer:{...Y.dessert_offer,title:C.target.value}})),placeholder:"Ex:  Que tal uma sobremesa?"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Mensagem"}),e.jsx(Os,{value:u?.dessert_offer?.message||"",onChange:C=>_(Y=>({...Y,dessert_offer:{...Y.dessert_offer,message:C.target.value}})),placeholder:"Use {product_name} e {product_price} para valores dinmicos",rows:2})]})]})]}),e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50 dark:bg-gray-800/50 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:""}),e.jsx(R,{className:"text-base font-semibold",children:"Oferta de Combo Especial"})]}),e.jsx(Ve,{checked:u?.combo_offer?.enabled!==!1,onCheckedChange:C=>_(Y=>({...Y,combo_offer:{...Y.combo_offer,enabled:C}}))})]}),u?.combo_offer?.enabled!==!1&&e.jsxs("div",{className:"space-y-4 pl-8 border-l-2 border-orange-200 dark:border-orange-800",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Produto Grtis"}),e.jsxs(Se,{value:u?.combo_offer?.dish_id||"",onValueChange:C=>_(Y=>({...Y,combo_offer:{...Y.combo_offer,dish_id:C||null}})),children:[e.jsx(De,{children:e.jsx(Me,{placeholder:"Selecione o produto grtis"})}),e.jsx(Ae,{children:P.filter(C=>C.is_active!==!1).map(C=>e.jsxs(X,{value:C.id,children:[C.name," - ",F(C.price||0)]},C.id))})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Produto que ser oferecido grtis no combo"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx(R,{children:"Mnimo de Pizzas"}),e.jsx(B,{type:"number",min:"1",value:u?.combo_offer?.min_pizzas||2,onChange:C=>_(Y=>({...Y,combo_offer:{...Y.combo_offer,min_pizzas:parseInt(C.target.value)||2}}))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Oferta aparece quando cliente tem esta quantidade de pizzas"})]})}),e.jsxs("div",{children:[e.jsx(R,{children:"Ttulo da Oferta"}),e.jsx(B,{value:u?.combo_offer?.title||"",onChange:C=>_(Y=>({...Y,combo_offer:{...Y.combo_offer,title:C.target.value}})),placeholder:"Ex:  Oferta Especial!"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Mensagem"}),e.jsx(Os,{value:u?.combo_offer?.message||"",onChange:C=>_(Y=>({...Y,combo_offer:{...Y.combo_offer,message:C.target.value}})),placeholder:"Use {product_name}, {min_pizzas} para valores dinmicos",rows:2}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Variveis: ","{product_name}",", ","{min_pizzas}"]})]})]})]})]}),e.jsx(A,{onClick:()=>$.mutate(u),disabled:$.isPending,children:$.isPending?"Salvando...":"Salvar Ofertas Inteligentes"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(Q,{children:e.jsx(Z,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold",children:W.total})]}),e.jsx(Xr,{className:"w-8 h-8 text-orange-500"})]})})}),e.jsx(Q,{children:e.jsx(Z,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Ativas"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:W.active})]}),e.jsx($s,{className:"w-8 h-8 text-green-500"})]})})}),e.jsx(Q,{children:e.jsx(Z,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Adicionar"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:W.addType})]}),e.jsx($e,{className:"w-8 h-8 text-blue-500"})]})})}),e.jsx(Q,{children:e.jsx(Z,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Substituir"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:W.replaceType})]}),e.jsx(Yl,{className:"w-8 h-8 text-purple-500"})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ms,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(B,{placeholder:"Buscar promoo ou prato...",value:c,onChange:C=>d(C.target.value),className:"pl-10"})]}),e.jsxs(Se,{value:i,onValueChange:o,children:[e.jsxs(De,{className:"w-[140px]",children:[e.jsx(ua,{className:"w-4 h-4 mr-2"}),e.jsx(Me,{})]}),e.jsxs(Ae,{children:[e.jsx(X,{value:"all",children:"Todos"}),e.jsx(X,{value:"active",children:"Ativas"}),e.jsx(X,{value:"inactive",children:"Inativas"})]})]}),e.jsxs(Se,{value:m,onValueChange:p,children:[e.jsx(De,{className:"w-[160px]",children:e.jsx(Me,{})}),e.jsxs(Ae,{children:[e.jsx(X,{value:"all",children:"Todos os tipos"}),e.jsx(X,{value:"add",children:"Adicionar"}),e.jsx(X,{value:"replace",children:"Substituir"})]})]}),e.jsxs(A,{onClick:()=>a(!0),className:"bg-orange-500 hover:bg-orange-600",children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Nova Promoo"]}),e.jsxs(A,{variant:"outline",onClick:()=>{l(null),r(!0)},className:"border-purple-300 text-purple-700 hover:bg-purple-50",children:[e.jsx(tr,{className:"w-4 h-4 mr-2"}),"Criar Combo"]})]}),e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4",children:J.length===0?e.jsxs("div",{className:"col-span-full text-center py-12 text-gray-400 border-2 border-dashed rounded-xl",children:[e.jsx(Xr,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Nenhuma promoo cadastrada"})]}):J.map(C=>e.jsxs("div",{className:`bg-white rounded-xl p-4 shadow-sm border-2 ${C.is_active?"border-green-200":"border-gray-200 opacity-60"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs(ye,{className:C.type==="add"?"bg-blue-500":"bg-purple-500",children:[C.type==="add"?e.jsx($e,{className:"w-3 h-3 mr-1"}):e.jsx(Yl,{className:"w-3 h-3 mr-1"}),C.type==="add"?"Adicionar":"Substituir"]}),e.jsx("h3",{className:"font-bold mt-2",children:C.name})]}),e.jsx(Ve,{checked:C.is_active,onCheckedChange:Y=>D.mutate({id:C.id,data:{...C,is_active:Y}})})]}),e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:q(C.offer_dish_id)}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[C.original_price>C.offer_price&&e.jsx("span",{className:"text-sm text-gray-400 line-through",children:F(C.original_price)}),e.jsx("span",{className:"font-bold text-green-600",children:F(C.offer_price)})]}),C.trigger_min_value>0&&e.jsxs("p",{className:"text-xs text-gray-400",children:["Pedido mnimo: ",F(C.trigger_min_value)]}),e.jsx("div",{className:"mt-3 pt-3 border-t flex justify-end",children:e.jsx(A,{size:"sm",variant:"ghost",className:"text-red-500 hover:text-red-700",onClick:()=>{confirm("Excluir esta promoo?")&&V.mutate(C.id)},children:e.jsx(Xe,{className:"w-4 h-4"})})})]},C.id))}),e.jsxs(Q,{className:"mt-8",children:[e.jsxs(he,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(tr,{className:"w-5 h-5"}),"Combos"]}),e.jsx(xs,{children:"Pratos + Bebidas ou Pizzas + Bebidas. Adicionar ao carrinho ou substituir item."})]}),e.jsx(Z,{children:e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4",children:Array.isArray(M)&&M.length===0?e.jsxs("div",{className:"col-span-full text-center py-8 text-gray-500 border-2 border-dashed rounded-xl",children:[e.jsx(tr,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Nenhum combo cadastrado"}),e.jsx(A,{variant:"outline",className:"mt-3",onClick:()=>r(!0),children:"Criar primeiro combo"})]}):(M||[]).map(C=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 border flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"font-bold",children:C.name}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(A,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{l(C),r(!0)},children:e.jsx(qs,{className:"w-4 h-4"})}),e.jsx(A,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-500",onClick:()=>confirm("Excluir combo?")&&z.mutate(C.id),children:e.jsx(Xe,{className:"w-4 h-4"})})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mb-2",children:[C.combo_mode==="pizzas_beverages"?"Pizzas + Bebidas":"Pratos + Bebidas","  ",C.combo_action==="replace"?"Substituir":"Adicionar"]}),e.jsx("p",{className:"font-bold text-green-600",children:F(C.combo_price)}),C.original_price>C.combo_price&&e.jsx("p",{className:"text-xs text-gray-400 line-through",children:F(C.original_price)})]},C.id))})})]}),e.jsx(Z0,{isOpen:t,onClose:()=>{r(!1),l(null)},onSubmit:C=>n?N.mutate({id:n.id,data:C}):T.mutate(C),combo:n,dishes:S,pizzas:(P||[]).filter(C=>C.product_type==="pizza"),beverages:(P||[]).filter(C=>C.product_type==="beverage")}),e.jsx(Re,{open:s,onOpenChange:a,children:e.jsxs(Le,{className:"sm:max-w-md max-w-[95vw]",children:[e.jsx(Ie,{children:e.jsx(qe,{children:"Nova Promoo Upsell"})}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome da Promoo"}),e.jsx(B,{value:x.name,onChange:C=>g(Y=>({...Y,name:C.target.value})),placeholder:"Ex: Adicione uma sobremesa!",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Tipo"}),e.jsxs(Se,{value:x.type,onValueChange:C=>g(Y=>({...Y,type:C})),children:[e.jsx(De,{children:e.jsx(Me,{})}),e.jsxs(Ae,{children:[e.jsx(X,{value:"add",children:"Adicionar ao pedido"}),e.jsx(X,{value:"replace",children:"Substituir item"})]})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Prato Oferecido"}),e.jsxs(Se,{value:x.offer_dish_id,onValueChange:C=>{const Y=S.find(L=>L.id===C);g(L=>({...L,offer_dish_id:C,original_price:Y?.price?.toString()||""}))},children:[e.jsx(De,{children:e.jsx(Me,{placeholder:"Selecione um prato"})}),e.jsx(Ae,{children:(Array.isArray(P)?P:[]).filter(C=>C.is_active!==!1).map(C=>e.jsxs(X,{value:C.id,children:[C.name," - ",F(C.price)]},C.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Preo Original"}),e.jsx(B,{type:"number",step:"0.01",value:x.original_price,onChange:C=>g(Y=>({...Y,original_price:C.target.value})),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Preo Promocional"}),e.jsx(B,{type:"number",step:"0.01",value:x.offer_price,onChange:C=>g(Y=>({...Y,offer_price:C.target.value})),placeholder:"0.00",required:!0})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Pedido Mnimo (opcional)"}),e.jsx(B,{type:"number",step:"0.01",value:x.trigger_min_value,onChange:C=>g(Y=>({...Y,trigger_min_value:C.target.value})),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Descrio"}),e.jsx(Os,{value:x.description,onChange:C=>g(Y=>({...Y,description:C.target.value})),placeholder:"Descrio opcional..."})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(A,{type:"button",variant:"outline",onClick:k,className:"flex-1",children:"Cancelar"}),e.jsx(A,{type:"submit",className:"flex-1 bg-orange-500 hover:bg-orange-600",children:"Criar"})]})]})]})})]})}async function kd(s){return new Promise((a,t)=>{const r=new Image;r.crossOrigin="anonymous",r.onload=()=>{try{const n=document.createElement("canvas"),l=n.getContext("2d"),c=200,d=Math.min(c/r.width,c/r.height,1);n.width=r.width*d,n.height=r.height*d,l.drawImage(r,0,0,n.width,n.height);const o=l.getImageData(0,0,n.width,n.height).data,m=new Map,p=4;for(let M=0;M<o.length;M+=p*4){const O=o[M],E=o[M+1],u=o[M+2];if(o[M+3]<128||O>250&&E>250&&u>250||O<5&&E<5&&u<5)continue;const $=Math.floor(O/32)*32,j=Math.floor(E/32)*32,D=Math.floor(u/32)*32,V=`${$},${j},${D}`;m.has(V)?m.set(V,m.get(V)+1):m.set(V,1)}const x=Array.from(m.entries()).sort((M,O)=>O[1]-M[1]).slice(0,10);if(x.length===0){a({primary:"#8b5cf6",secondary:"#1e1b4b",accent:"#a855f7"});return}const g=x.map(([M,O])=>{const[E,u,_]=M.split(",").map(Number);return{hex:`#${[E,u,_].map($=>{const j=$.toString(16);return j.length===1?"0"+j:j}).join("")}`,count:O}}),f=g[0].hex;let y=g[1]?.hex||g[0].hex;const v=mn(y);v&&v.r+v.g+v.b>500&&(y=X0(y,.6));let P=g.find(M=>{const O=mn(M.hex);return O?J0(O)>.5:!1})?.hex||f;P===f&&(P=ej(f,.2)),a({primary:f,secondary:y,accent:P})}catch(n){console.error("Erro ao extrair cores:",n),t(n)}},r.onerror=()=>{t(new Error("Erro ao carregar imagem"))},r.src=s})}function mn(s){const a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(s);return a?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null}function J0(s){const a=Math.max(s.r,s.g,s.b),t=Math.min(s.r,s.g,s.b),r=a-t;return a===0?0:r/a}function X0(s,a){const t=mn(s);return t?`#${[t.r,t.g,t.b].map(r=>Math.max(0,Math.floor(r*a))).map(r=>{const n=r.toString(16);return n.length===1?"0"+n:n}).join("")}`:s}function ej(s,a){const t=mn(s);return t?`#${[t.r,t.g,t.b].map(r=>Math.min(255,Math.floor(r+(255-r)*a))).map(r=>{const n=r.toString(16);return n.length===1?"0"+n:n}).join("")}`:s}const sj=[{name:"Laranja",primary:"#f97316",secondary:"#1f2937",accent:"#eab308"},{name:"Verde",primary:"#22c55e",secondary:"#1f2937",accent:"#10b981"},{name:"Azul",primary:"#3b82f6",secondary:"#1e293b",accent:"#0ea5e9"},{name:"Vermelho",primary:"#ef4444",secondary:"#1f2937",accent:"#f97316"},{name:"Roxo",primary:"#8b5cf6",secondary:"#1e1b4b",accent:"#a855f7"},{name:"Rosa",primary:"#ec4899",secondary:"#1f2937",accent:"#f472b6"}],aj=[{name:"Sunset",start:"#ff6b6b",end:"#ffd93d",direction:"to-br"},{name:"Ocean",start:"#667eea",end:"#764ba2",direction:"to-r"},{name:"Fire",start:"#ff416c",end:"#ff4b2b",direction:"to-r"},{name:"Forest",start:"#134e5e",end:"#71b280",direction:"to-br"},{name:"Aurora",start:"#a8edea",end:"#fed6e3",direction:"to-r"},{name:"Royal",start:"#141e30",end:"#243b55",direction:"to-br"}],tj={"to-r":" Horizontal","to-br":" Diagonal SE","to-b":" Vertical","to-bl":" Diagonal SO","to-l":" Horizontal Inv.","to-tl":" Diagonal NO","to-t":" Vertical Inv.","to-tr":" Diagonal NE"};function Dv(){const{currentTheme:s,activeTheme:a,customTheme:t,setTheme:r,setCustomThemeColors:n,resetToPreset:l,themes:c}=hn(),[d,i]=b.useState({theme_primary_color:"#f97316",theme_secondary_color:"#1f2937",theme_accent_color:"#eab308",theme_gradient_enabled:!1,theme_gradient_start:"#f97316",theme_gradient_end:"#ef4444",theme_gradient_direction:"to-r",theme_button_style:"rounded",theme_shadow_enabled:!0,menu_layout:"grid"}),[o,m]=b.useState({bgPrimary:a.colors.bgPrimary,bgSecondary:a.colors.bgSecondary,bgCard:a.colors.bgCard,textPrimary:a.colors.textPrimary,textSecondary:a.colors.textSecondary,borderColor:a.colors.borderColor,accent:a.colors.accent}),[p,x]=b.useState(!1),[g,f]=b.useState(!1),y=ts(),{menuContext:v}=as(),{data:P=[]}=ke({queryKey:["store",v?.type,v?.value],queryFn:async()=>{if(!v)return[];const h={};return v.type==="subscriber"&&v.value&&(h.as_subscriber=v.value),se.entities.Store.list(null,h)},enabled:!!v}),M=P[0];b.useEffect(()=>{M&&i({theme_primary_color:M.theme_primary_color||"#f97316",theme_secondary_color:M.theme_secondary_color||"#1f2937",theme_accent_color:M.theme_accent_color||"#eab308",theme_gradient_enabled:M.theme_gradient_enabled||!1,theme_gradient_start:M.theme_gradient_start||"#f97316",theme_gradient_end:M.theme_gradient_end||"#ef4444",theme_gradient_direction:M.theme_gradient_direction||"to-r",theme_button_style:M.theme_button_style||"rounded",theme_shadow_enabled:M.theme_shadow_enabled!==!1,menu_layout:M.menu_layout||"grid"})},[M]),b.useEffect(()=>{m({bgPrimary:a.colors.bgPrimary,bgSecondary:a.colors.bgSecondary,bgCard:a.colors.bgCard,textPrimary:a.colors.textPrimary,textSecondary:a.colors.textSecondary,borderColor:a.colors.borderColor,accent:a.colors.accent})},[a]);const O=de({mutationFn:h=>se.entities.Store.update(M.id,h),onSuccess:()=>{y.invalidateQueries({queryKey:["store"]}),f(!1),K.success("Tema salvo com sucesso!")}}),E=(h,F)=>{i(S=>({...S,[h]:F})),f(!0)},u=(h,F)=>{const S={...o,[h]:F};m(S),n(S),f(!0)},_=h=>{i(F=>({...F,theme_primary_color:h.primary,theme_secondary_color:h.secondary,theme_accent_color:h.accent})),f(!0)},$=h=>{i(F=>({...F,theme_gradient_start:h.start,theme_gradient_end:h.end,theme_gradient_direction:h.direction,theme_gradient_enabled:!0})),f(!0)},[j,D]=b.useState(!1),V=async()=>{if(!M?.logo){K.error("Por favor, adicione uma logo primeiro em Configuraes da Loja");return}D(!0);try{const h=await kd(M.logo);i(F=>({...F,theme_primary_color:h.primary,theme_secondary_color:h.secondary,theme_accent_color:h.accent})),f(!0),K.success("Cores extradas da logo com sucesso!")}catch(h){console.error("Erro ao extrair cores:",h),K.error("Erro ao extrair cores da logo. Verifique se a imagem est acessvel.")}finally{D(!1)}},T=()=>{x(!0)},N=()=>{O.mutate({...M,...d}),x(!1)},z=()=>d.theme_gradient_enabled?{background:`linear-gradient(${{"to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left","to-t":"to top","to-tr":"to top right"}[d.theme_gradient_direction]}, ${d.theme_gradient_start}, ${d.theme_gradient_end})`}:{backgroundColor:d.theme_primary_color},k=()=>{const h="px-4 py-2 text-white font-medium transition-all",F=d.theme_shadow_enabled?"shadow-lg hover:shadow-xl":"",S={rounded:"rounded-lg",square:"rounded-none",pill:"rounded-full"}[d.theme_button_style];return`${h} ${S} ${F}`};return e.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"relative rounded-2xl p-6 sm:p-8 overflow-hidden",style:{background:`linear-gradient(135deg, ${a.colors.accent}15, ${a.colors.accent}05)`,border:`1px solid ${a.colors.borderColor}`},children:[e.jsx("div",{className:"relative z-10",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg",style:{backgroundColor:`${a.colors.accent}20`},children:e.jsx(Ql,{className:"w-6 h-6",style:{color:a.colors.accent}})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",style:{color:a.colors.textPrimary},children:"Personalizao de Temas"}),e.jsx("p",{className:"text-sm",style:{color:a.colors.textSecondary},children:"Configure a aparncia do seu painel administrativo"})]})]})}),e.jsx("div",{className:"absolute inset-0 opacity-5",style:{backgroundImage:`radial-gradient(circle at 20% 50%, ${a.colors.accent} 0%, transparent 50%)`}})]}),e.jsxs(Ui,{defaultValue:"presets",className:"w-full",children:[e.jsxs(Bi,{className:"grid w-full grid-cols-5 mb-6",style:{backgroundColor:a.colors.bgSecondary},children:[e.jsxs(la,{value:"presets",className:"data-[state=active]:bg-white dark:data-[state=active]:bg-gray-800",children:[e.jsx(Fs,{className:"w-4 h-4 mr-2"}),"Temas"]}),e.jsxs(la,{value:"colors",className:"data-[state=active]:bg-white dark:data-[state=active]:bg-gray-800",children:[e.jsx(Ql,{className:"w-4 h-4 mr-2"}),"Cores"]}),e.jsxs(la,{value:"gradient",className:"data-[state=active]:bg-white dark:data-[state=active]:bg-gray-800",children:[e.jsx(rr,{className:"w-4 h-4 mr-2"}),"Gradientes"]}),e.jsxs(la,{value:"layout",className:"data-[state=active]:bg-white dark:data-[state=active]:bg-gray-800",children:[e.jsx(et,{className:"w-4 h-4 mr-2"}),"Layout"]}),e.jsxs(la,{value:"advanced",className:"data-[state=active]:bg-white dark:data-[state=active]:bg-gray-800",children:[e.jsx(ut,{className:"w-4 h-4 mr-2"}),"Avanado"]})]}),e.jsx(oa,{value:"presets",className:"space-y-6",children:e.jsxs(Q,{style:{backgroundColor:a.colors.bgCard,borderColor:a.colors.borderColor},children:[e.jsxs(he,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(et,{className:"w-5 h-5"}),"Temas Pr-definidos"]}),e.jsx(xs,{children:"Escolha um tema pronto ou personalize suas cores"})]}),e.jsxs(Z,{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(c).map(([h,F])=>e.jsxs("button",{onClick:()=>{r(h),l()},className:`relative p-4 rounded-xl border-2 transition-all text-left group ${s===h&&!t?"ring-2 ring-offset-2":"hover:border-opacity-60"}`,style:{backgroundColor:F.colors.bgCard,borderColor:s===h&&!t?a.colors.accent:a.colors.borderColor,ringColor:a.colors.accent},children:[s===h&&!t&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsxs(ye,{className:"bg-green-500 text-white",style:{backgroundColor:a.colors.accent},children:[e.jsx(ia,{className:"w-3 h-3 mr-1"}),"Ativo"]})}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[F.mode==="dark"?e.jsx(Su,{className:"w-5 h-5",style:{color:F.colors.accent}}):e.jsx(Du,{className:"w-5 h-5",style:{color:F.colors.accent}}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",style:{color:F.colors.textPrimary},children:F.name}),e.jsx("p",{className:"text-xs",style:{color:F.colors.textSecondary},children:F.mode==="dark"?"Modo Escuro":"Modo Claro"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg",style:{backgroundColor:F.colors.bgPrimary}}),e.jsx("div",{className:"w-8 h-8 rounded-lg",style:{backgroundColor:F.colors.bgSecondary}}),e.jsx("div",{className:"w-8 h-8 rounded-lg",style:{backgroundColor:F.colors.accent}})]})]},h))}),t&&e.jsx("div",{className:"mt-6 p-4 rounded-lg border-2 border-dashed",style:{borderColor:a.colors.borderColor},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",style:{color:a.colors.textPrimary},children:"Tema Personalizado"}),e.jsx("p",{className:"text-sm",style:{color:a.colors.textSecondary},children:"Voc est usando um tema customizado"})]}),e.jsxs(A,{variant:"outline",onClick:l,size:"sm",children:[e.jsx(Jl,{className:"w-4 h-4 mr-2"}),"Resetar"]})]})})]})]})}),e.jsxs(oa,{value:"colors",className:"space-y-6",children:[e.jsxs(Q,{style:{backgroundColor:a.colors.bgCard,borderColor:a.colors.borderColor},children:[e.jsx(he,{children:e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Ya,{className:"w-5 h-5"}),"Preview em Tempo Real"]})}),e.jsx(Z,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-3 items-center flex-wrap",children:[e.jsx("div",{className:k(),style:z(),children:"Boto Primrio"}),e.jsx("div",{className:"px-4 py-2 rounded-lg text-white font-medium",style:{backgroundColor:d.theme_secondary_color},children:"Secundrio"}),e.jsx("div",{className:"px-4 py-2 rounded-lg text-white font-medium",style:{backgroundColor:d.theme_accent_color},children:"Destaque"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:d.theme_primary_color},children:[e.jsx("p",{className:"text-white text-sm font-medium",children:"Primria"}),e.jsx("p",{className:"text-white text-xs opacity-80",children:d.theme_primary_color})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:d.theme_secondary_color},children:[e.jsx("p",{className:"text-white text-sm font-medium",children:"Secundria"}),e.jsx("p",{className:"text-white text-xs opacity-80",children:d.theme_secondary_color})]}),e.jsxs("div",{className:"p-4 rounded-lg",style:{backgroundColor:d.theme_accent_color},children:[e.jsx("p",{className:"text-white text-sm font-medium",children:"Destaque"}),e.jsx("p",{className:"text-white text-xs opacity-80",children:d.theme_accent_color})]})]})]})})]}),M?.logo&&e.jsxs(Q,{style:{backgroundColor:a.colors.bgCard,borderColor:a.colors.borderColor},children:[e.jsxs(he,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(sn,{className:"w-5 h-5"}),"Extrair Cores da Logo"]}),e.jsx(xs,{children:"Extrai automaticamente as cores principais da sua logo para usar como tema"})]}),e.jsx(Z,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-lg overflow-hidden border-2 flex-shrink-0",style:{borderColor:a.colors.borderColor},children:e.jsx("img",{src:M.logo,alt:"Logo",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm mb-3",style:{color:a.colors.textSecondary},children:"Clique no boto abaixo para extrair as cores dominantes da sua logo e aplic-las automaticamente como tema."}),e.jsx(A,{onClick:V,disabled:j,style:{backgroundColor:a.colors.accent},children:j?e.jsxs(e.Fragment,{children:[e.jsx(Xr,{className:"w-4 h-4 mr-2 animate-spin"}),"Extraindo cores..."]}):e.jsxs(e.Fragment,{children:[e.jsx(sn,{className:"w-4 h-4 mr-2"}),"Extrair Cores da Logo"]})})]})]})})]}),e.jsxs(Q,{style:{backgroundColor:a.colors.bgCard,borderColor:a.colors.borderColor},children:[e.jsxs(he,{children:[e.jsx(xe,{children:"Temas de Cores Prontos"}),e.jsx(xs,{children:"Escolha uma paleta de cores pr-definida"})]}),e.jsx(Z,{children:e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-6 gap-3",children:sj.map(h=>e.jsxs("button",{onClick:()=>_(h),className:`p-3 rounded-xl border-2 hover:border-opacity-60 transition-all text-center group ${d.theme_primary_color===h.primary?"ring-2 ring-offset-2":""}`,style:{borderColor:d.theme_primary_color===h.primary?a.colors.accent:a.colors.borderColor,ringColor:a.colors.accent},children:[e.jsxs("div",{className:"flex gap-1 justify-center mb-2",children:[e.jsx("div",{className:"w-5 h-5 rounded-full border-2 border-white shadow-sm",style:{backgroundColor:h.primary}}),e.jsx("div",{className:"w-5 h-5 rounded-full border-2 border-white shadow-sm",style:{backgroundColor:h.secondary}}),e.jsx("div",{className:"w-5 h-5 rounded-full border-2 border-white shadow-sm",style:{backgroundColor:h.accent}})]}),e.jsx("span",{className:"text-xs font-medium",children:h.name}),d.theme_primary_color===h.primary&&e.jsx(ia,{className:"w-3 h-3 mx-auto mt-1",style:{color:a.colors.accent}})]},h.name))})})]}),e.jsxs(Q,{style:{backgroundColor:a.colors.bgCard,borderColor:a.colors.borderColor},children:[e.jsxs(he,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Vu,{className:"w-5 h-5"}),"Cores Personalizadas"]}),e.jsx(xs,{children:"Ajuste cada cor individualmente"})]}),e.jsx(Z,{children:e.jsxs("div",{className:"grid sm:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Cor Primria"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:d.theme_primary_color,onChange:h=>E("theme_primary_color",h.target.value),className:"w-14 h-12 rounded-lg border-2 cursor-pointer",style:{borderColor:a.colors.borderColor}}),e.jsx(B,{value:d.theme_primary_color,onChange:h=>E("theme_primary_color",h.target.value),className:"font-mono uppercase text-sm"})]})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Cor Secundria"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:d.theme_secondary_color,onChange:h=>E("theme_secondary_color",h.target.value),className:"w-14 h-12 rounded-lg border-2 cursor-pointer",style:{borderColor:a.colors.borderColor}}),e.jsx(B,{value:d.theme_secondary_color,onChange:h=>E("theme_secondary_color",h.target.value),className:"font-mono uppercase text-sm"})]})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Cor de Destaque"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:d.theme_accent_color,onChange:h=>E("theme_accent_color",h.target.value),className:"w-14 h-12 rounded-lg border-2 cursor-pointer",style:{borderColor:a.colors.borderColor}}),e.jsx(B,{value:d.theme_accent_color,onChange:h=>E("theme_accent_color",h.target.value),className:"font-mono uppercase text-sm"})]})]})]})})]}),e.jsxs(Q,{style:{backgroundColor:a.colors.bgCard,borderColor:a.colors.borderColor},children:[e.jsxs(he,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(ut,{className:"w-5 h-5"}),"Cores Avanadas do Tema"]}),e.jsx(xs,{children:"Personalize cores de fundo, texto e bordas"})]}),e.jsx(Z,{children:e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-4 gap-4",children:Object.entries(o).map(([h,F])=>e.jsxs("div",{children:[e.jsx(R,{className:"text-xs font-medium mb-2 block capitalize",children:h.replace(/([A-Z])/g," $1").trim()}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:F,onChange:S=>u(h,S.target.value),className:"w-12 h-10 rounded-lg border-2 cursor-pointer",style:{borderColor:a.colors.borderColor}}),e.jsx(B,{value:F,onChange:S=>u(h,S.target.value),className:"font-mono text-xs"})]})]},h))})})]})]}),e.jsxs(oa,{value:"gradient",className:"space-y-6",children:[e.jsx(Q,{style:{backgroundColor:a.colors.bgCard,borderColor:a.colors.borderColor},children:e.jsx(he,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(xe,{children:"Habilitar Gradiente"}),e.jsx(xs,{children:"Aplica efeito de gradiente nos botes primrios"})]}),e.jsx(Ve,{checked:d.theme_gradient_enabled,onCheckedChange:h=>E("theme_gradient_enabled",h)})]})})}),d.theme_gradient_enabled&&e.jsxs(e.Fragment,{children:[e.jsxs(Q,{style:{backgroundColor:a.colors.bgCard,borderColor:a.colors.borderColor},children:[e.jsx(he,{children:e.jsx(xe,{children:"Preview do Gradiente"})}),e.jsx(Z,{children:e.jsx("div",{className:"w-full h-32 rounded-xl flex items-center justify-center text-white text-lg font-bold shadow-lg",style:z(),children:"Gradiente Aplicado"})})]}),e.jsxs(Q,{style:{backgroundColor:a.colors.bgCard,borderColor:a.colors.borderColor},children:[e.jsxs(he,{children:[e.jsx(xe,{children:"Gradientes Prontos"}),e.jsx(xs,{children:"Escolha um gradiente pr-definido"})]}),e.jsx(Z,{children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:aj.map(h=>e.jsxs("button",{onClick:()=>$(h),className:"group relative overflow-hidden rounded-xl border-2 transition-all",style:{borderColor:d.theme_gradient_start===h.start&&d.theme_gradient_end===h.end?a.colors.accent:a.colors.borderColor},children:[e.jsx("div",{className:"h-20 flex items-center justify-center text-white font-medium",style:{background:`linear-gradient(${h.direction==="to-r"?"to right":h.direction==="to-br"?"to bottom right":"to right"}, ${h.start}, ${h.end})`},children:h.name}),d.theme_gradient_start===h.start&&d.theme_gradient_end===h.end&&e.jsx("div",{className:"absolute top-2 right-2 bg-white rounded-full p-1",children:e.jsx(ia,{className:"w-3 h-3",style:{color:a.colors.accent}})})]},h.name))})})]}),e.jsxs(Q,{style:{backgroundColor:a.colors.bgCard,borderColor:a.colors.borderColor},children:[e.jsx(he,{children:e.jsx(xe,{children:"Gradiente Personalizado"})}),e.jsx(Z,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Cor Inicial"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:d.theme_gradient_start,onChange:h=>E("theme_gradient_start",h.target.value),className:"w-14 h-12 rounded-lg border-2 cursor-pointer",style:{borderColor:a.colors.borderColor}}),e.jsx(B,{value:d.theme_gradient_start,onChange:h=>E("theme_gradient_start",h.target.value),className:"font-mono uppercase text-sm"})]})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Cor Final"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:d.theme_gradient_end,onChange:h=>E("theme_gradient_end",h.target.value),className:"w-14 h-12 rounded-lg border-2 cursor-pointer",style:{borderColor:a.colors.borderColor}}),e.jsx(B,{value:d.theme_gradient_end,onChange:h=>E("theme_gradient_end",h.target.value),className:"font-mono uppercase text-sm"})]})]})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Direo do Gradiente"}),e.jsxs(Se,{value:d.theme_gradient_direction,onValueChange:h=>E("theme_gradient_direction",h),children:[e.jsx(De,{children:e.jsx(Me,{})}),e.jsx(Ae,{children:Object.entries(tj).map(([h,F])=>e.jsx(X,{value:h,children:F},h))})]})]})]})})]})]})]}),e.jsxs(oa,{value:"advanced",className:"space-y-6",children:[e.jsxs(Q,{style:{backgroundColor:a.colors.bgCard,borderColor:a.colors.borderColor},children:[e.jsx(he,{children:e.jsx(xe,{children:"Estilo dos Botes"})}),e.jsx(Z,{children:e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{value:"rounded",label:"Arredondado",class:"rounded-lg"},{value:"square",label:"Quadrado",class:"rounded-none"},{value:"pill",label:"Plula",class:"rounded-full"}].map(h=>e.jsxs("button",{onClick:()=>E("theme_button_style",h.value),className:`p-4 border-2 transition-all ${d.theme_button_style===h.value?"ring-2 ring-offset-2":""}`,style:{borderColor:d.theme_button_style===h.value?a.colors.accent:a.colors.borderColor,ringColor:a.colors.accent},children:[e.jsx("div",{className:`w-full h-10 ${h.class} mb-2 flex items-center justify-center text-white text-xs font-medium`,style:{backgroundColor:a.colors.accent},children:"Exemplo"}),e.jsx("span",{className:"text-xs font-medium",children:h.label}),d.theme_button_style===h.value&&e.jsx(ia,{className:"w-3 h-3 mx-auto mt-1",style:{color:a.colors.accent}})]},h.value))})})]}),e.jsxs(Q,{style:{backgroundColor:a.colors.bgCard,borderColor:a.colors.borderColor},children:[e.jsx(he,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(xe,{children:"Sombras nos Elementos"}),e.jsx(xs,{children:"Adiciona profundidade visual aos botes e cards"})]}),e.jsx(Ve,{checked:d.theme_shadow_enabled,onCheckedChange:h=>E("theme_shadow_enabled",h)})]})}),e.jsx(Z,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{className:`p-4 text-white rounded-lg text-center font-medium ${d.theme_shadow_enabled?"shadow-lg":""}`,style:{backgroundColor:a.colors.accent},children:"Com Sombra"}),e.jsx("div",{className:"p-4 text-white rounded-lg text-center font-medium",style:{backgroundColor:a.colors.accent},children:"Sem Sombra"})]})})]})]}),e.jsx(oa,{value:"layout",className:"space-y-6",children:e.jsxs(Q,{style:{backgroundColor:a.colors.bgCard,borderColor:a.colors.borderColor},children:[e.jsxs(he,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(et,{className:"w-5 h-5"}),"Layout do Cardpio"]}),e.jsx(xs,{children:"Escolha como os pratos sero exibidos no cardpio digital"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(R,{className:"mb-3 block",children:"Estilo de Apresentao"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("button",{onClick:()=>E("menu_layout","grid"),className:`p-4 rounded-xl border-2 transition-all text-left ${d.menu_layout==="grid"?"border-orange-500 bg-orange-50 dark:bg-orange-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Mo,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"Grid (Padro)"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Blocos lado a lado, ideal para visualizao rpida"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"h-16 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-16 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-16 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-16 bg-gray-200 dark:bg-gray-700 rounded"})]})]}),e.jsxs("button",{onClick:()=>E("menu_layout","list"),className:`p-4 rounded-xl border-2 transition-all text-left ${d.menu_layout==="list"?"border-orange-500 bg-orange-50 dark:bg-orange-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ra,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"Lista"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Lista horizontal com imagens, mais compacta"}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"h-12 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-12 bg-gray-200 dark:bg-gray-700 rounded"})]})]}),e.jsxs("button",{onClick:()=>E("menu_layout","carousel"),className:`p-4 rounded-xl border-2 transition-all text-left ${d.menu_layout==="carousel"?"border-orange-500 bg-orange-50 dark:bg-orange-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ya,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"Carrossel"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Deslize horizontalmente pelos pratos"}),e.jsxs("div",{className:"mt-3 flex gap-2 overflow-hidden",children:[e.jsx("div",{className:"h-20 w-32 bg-gray-200 dark:bg-gray-700 rounded flex-shrink-0"}),e.jsx("div",{className:"h-20 w-32 bg-gray-200 dark:bg-gray-700 rounded flex-shrink-0"})]})]}),e.jsxs("button",{onClick:()=>E("menu_layout","magazine"),className:`p-4 rounded-xl border-2 transition-all text-left ${d.menu_layout==="magazine"?"border-orange-500 bg-orange-50 dark:bg-orange-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(iu,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"Cardpio Impresso"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Como folhear um cardpio fsico, pgina por pgina"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"h-20 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-20 bg-gray-200 dark:bg-gray-700 rounded"})]})]}),e.jsxs("button",{onClick:()=>E("menu_layout","masonry"),className:`p-4 rounded-xl border-2 transition-all text-left ${d.menu_layout==="masonry"?"border-orange-500 bg-orange-50 dark:bg-orange-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(et,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"Masonry"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Layout estilo Pinterest, colunas com alturas variadas"}),e.jsxs("div",{className:"mt-3 columns-2 gap-2",children:[e.jsx("div",{className:"h-16 bg-gray-200 dark:bg-gray-700 rounded mb-2"}),e.jsx("div",{className:"h-24 bg-gray-200 dark:bg-gray-700 rounded mb-2"})]})]})]})]})})]})})]}),e.jsxs("div",{className:"flex gap-3 sticky bottom-0 bg-white dark:bg-gray-900 p-4 -mx-4 sm:-mx-6 border-t",style:{backgroundColor:a.colors.bgPrimary,borderColor:a.colors.borderColor},children:[e.jsxs(A,{onClick:()=>window.location.reload(),variant:"outline",className:"flex-1",children:[e.jsx(Jl,{className:"w-4 h-4 mr-2"}),"Resetar"]}),e.jsxs(A,{onClick:T,disabled:!g,className:"flex-1",style:{backgroundColor:g?a.colors.accent:void 0,opacity:g?1:.5},children:[e.jsx(Hi,{className:"w-4 h-4 mr-2"}),"Salvar Alteraes"]})]}),e.jsx(yu,{open:p,onOpenChange:x,children:e.jsxs(vu,{children:[e.jsxs(bu,{children:[e.jsx(Nu,{children:"Confirmar Alteraes"}),e.jsx(wu,{children:"Tem certeza que deseja salvar as novas configuraes de tema? As alteraes sero aplicadas imediatamente no cardpio."})]}),e.jsxs(_u,{children:[e.jsx(Cu,{children:"Cancelar"}),e.jsxs(ku,{onClick:N,style:{backgroundColor:a.colors.accent},children:[e.jsx(ia,{className:"w-4 h-4 mr-2"}),"Confirmar"]})]})]})})]})}const Sd=[{value:"pix",label:"PIX"},{value:"dinheiro",label:"Dinheiro"},{value:"cartao_credito",label:"Carto de Crdito"},{value:"cartao_debito",label:"Carto de Dbito"}],Ps=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s||0),rj=s=>s?new Date(s).toLocaleString("pt-BR",{dateStyle:"short",timeStyle:"short"}):"";function Mv({subscriberEmail:s=null}){const a=ts(),[t,r]=b.useState("all"),[n,l]=b.useState(""),[c,d]=b.useState(!1),[i,o]=b.useState(!1),[m,p]=b.useState(null),[x,g]=b.useState("create"),[f,y]=b.useState(!1),[v,P]=b.useState(null),[M,O]=b.useState(!1),[E,u]=b.useState(null),{menuContext:_}=as(),j=s||(_?.type==="subscriber"&&_.value?_.value:null);hu({subscriberEmail:j,onComandaUpdate:Y=>{a.setQueryData(["Comanda",_?.type,_?.value,t],L=>{if(!L)return[Y];const oe=L.findIndex(Pe=>Pe.id===Y.id);if(oe>=0){const Pe=[...L];return Pe[oe]=Y,Pe}return[...L,Y]})},onComandaCreated:Y=>{a.invalidateQueries({queryKey:["Comanda",_?.type,_?.value]})},enableNotifications:!1});const{data:D=[],isLoading:V}=ke({queryKey:["Comanda",_?.type,_?.value,t],queryFn:async()=>{if(!_)return[];const Y=t&&t!=="all"?{status:t}:{};return _.type==="subscriber"&&_.value&&(Y.as_subscriber=_.value),se.entities.Comanda.list("-created_at",Y)},enabled:!!_}),{data:T=[]}=_r(),N=Array.isArray(T)?T.filter(Y=>Y.is_active!==!1):[],z=de({mutationFn:Y=>se.entities.Comanda.create(Y),onSuccess:()=>{a.invalidateQueries({queryKey:["Comanda"]}),d(!1),p(null),K.success("Comanda criada")},onError:Y=>K.error(Y?.message||"Erro ao criar")}),k=de({mutationFn:({id:Y,data:L})=>se.entities.Comanda.update(Y,L),onSuccess:()=>{a.invalidateQueries({queryKey:["Comanda"]}),d(!1),p(null),K.success("Comanda atualizada")},onError:Y=>K.error(Y?.message||"Erro ao atualizar")}),h=()=>{p(null),g("create"),d(!0)},F=Y=>{p(Y),g("edit"),d(!0)},S=Y=>{P(Y),y(!0)},q=()=>{v&&(p(v),g("close"),d(!0),y(!1),P(null))},J=Y=>{p(Y),o(!0)},W=D.filter(Y=>t==="all"?!0:(Y.status||"open")===t),C=b.useMemo(()=>{const Y=Array.isArray(D)?D:[],L=Y.filter(ve=>(ve.status||"open")==="open").length,oe=Y.filter(ve=>ve.status==="closed").length,Pe=Y.reduce((ve,G)=>{const ne=parseFloat(G.total||G.total_value||0);return ve+(isNaN(ne)?0:ne)},0);return{open:L,closed:oe,totalValue:Pe}},[D]);return e.jsxs("div",{className:"space-y-6 p-4 md:p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",style:{color:"var(--text-primary)"},children:"Comandas"}),!V&&D.length>0&&e.jsxs("p",{className:"text-sm mt-1",style:{color:"var(--text-secondary)"},children:[C.open," abertas  ",C.closed," fechadas  Total: ",Ps(C.totalValue)]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(Se,{value:t,onValueChange:r,children:[e.jsx(De,{className:"w-[140px]",children:e.jsx(Me,{})}),e.jsxs(Ae,{children:[e.jsx(X,{value:"all",children:"Todas"}),e.jsx(X,{value:"open",children:"Abertas"}),e.jsx(X,{value:"closed",children:"Fechadas"}),e.jsx(X,{value:"cancelled",children:"Canceladas"})]})]}),e.jsxs(A,{onClick:h,children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Nova Comanda"]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ms,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx(B,{value:n,onChange:Y=>l(Y.target.value),placeholder:"Buscar por cdigo, mesa ou cliente...",className:"pl-10 pr-10",style:{backgroundColor:"var(--bg-input)",borderColor:"var(--border-color)",color:"var(--text-primary)"}}),n&&e.jsx("button",{onClick:()=>l(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(Ds,{className:"w-4 h-4"})})]}),V?e.jsx("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:"Carregando..."}):W.length===0?e.jsx(Q,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:e.jsxs(Z,{className:"py-12 text-center",children:[e.jsx(Ia,{className:"w-12 h-12 mx-auto mb-3 opacity-50",style:{color:"var(--text-muted)"}}),e.jsx("p",{className:"font-medium",style:{color:"var(--text-primary)"},children:"Nenhuma comanda encontrada"}),e.jsxs("p",{className:"text-sm mt-1",style:{color:"var(--text-secondary)"},children:[t!=="all"?"Altere o filtro ou":""," crie uma nova comanda."]}),e.jsxs(A,{onClick:h,className:"mt-4",children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Nova Comanda"]})]})}):e.jsx("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:W.map(Y=>{const L=Y.status||"open",oe=L==="open";return e.jsxs(Q,{className:"overflow-hidden",style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsxs(he,{className:"pb-2 flex flex-row items-center justify-between",children:[e.jsxs(xe,{className:"text-base flex items-center gap-2",children:[e.jsx(Ia,{className:"w-4 h-4"}),e.jsx("span",{style:{color:"var(--text-primary)"},children:Y.code||`#${Y.id}`})]}),e.jsx(ye,{variant:oe?"default":"secondary",className:oe?"bg-green-600":L==="cancelled"?"bg-red-600":"",children:L==="open"?"Aberta":L==="closed"?"Fechada":"Cancelada"})]}),e.jsxs(Z,{className:"space-y-1 text-sm",children:[e.jsxs("p",{style:{color:"var(--text-secondary)"},children:[Y.table_name?`Mesa ${Y.table_name}`:""," ",Y.customer_name?`  ${Y.customer_name}`:""]}),e.jsx("p",{className:"font-semibold",style:{color:"var(--text-primary)"},children:Ps(Y.total)}),e.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:rj(Y.created_at)}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2",children:[oe&&e.jsxs(e.Fragment,{children:[e.jsxs(A,{size:"sm",variant:"outline",onClick:()=>F(Y),children:[e.jsx(vn,{className:"w-3 h-3 mr-1"}),"Editar"]}),e.jsxs(A,{size:"sm",variant:"outline",onClick:()=>S(Y),children:[e.jsx(Xa,{className:"w-3 h-3 mr-1"}),"Fechar"]}),e.jsxs(A,{size:"sm",variant:"outline",onClick:()=>handleTransfer(Y),children:[e.jsx(Do,{className:"w-3 h-3 mr-1"}),"Transferir"]})]}),e.jsxs(A,{size:"sm",variant:"ghost",onClick:()=>J(Y),children:[e.jsx(Yr,{className:"w-3 h-3 mr-1"}),"Histrico"]}),oe&&e.jsxs(A,{size:"sm",variant:"ghost",onClick:()=>handlePrintComanda(Y),children:[e.jsx(Vi,{className:"w-3 h-3 mr-1"}),"Imprimir"]})]})]})]},Y.id)})}),e.jsx(nj,{open:c,onOpenChange:d,mode:x,comanda:m,dishes:N,onCreate:z.mutate,onUpdate:k.mutate,isCreating:z.isPending,isUpdating:k.isPending}),e.jsx(ij,{open:i,onOpenChange:o,comanda:m}),e.jsx(Re,{open:f,onOpenChange:y,children:e.jsxs(Le,{style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(Ie,{children:e.jsxs(qe,{style:{color:"var(--text-primary)"},className:"flex items-center gap-2",children:[e.jsx(Yt,{className:"w-5 h-5"}),"Confirmar fechamento"]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{style:{color:"var(--text-primary)"},children:["Tem certeza que deseja fechar a comanda ",e.jsx("strong",{children:v?.code||`#${v?.id}`}),"?"]}),v&&e.jsxs("div",{className:"p-3 rounded-lg",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsxs("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:[e.jsx("strong",{children:"Total:"})," ",Ps(v.total||0)]}),e.jsxs("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:[e.jsx("strong",{children:"Itens:"})," ",Array.isArray(v.items)?v.items.length:0]})]})]}),e.jsxs(Qs,{children:[e.jsx(A,{variant:"outline",onClick:()=>y(!1),children:"Cancelar"}),e.jsxs(A,{onClick:q,children:[e.jsx(ot,{className:"w-4 h-4 mr-2"}),"Confirmar"]})]})]})})]})}function nj({open:s,onOpenChange:a,mode:t,comanda:r,dishes:n,onCreate:l,onUpdate:c,isCreating:d,isUpdating:i}){const[o,m]=b.useState(""),[p,x]=b.useState(""),[g,f]=b.useState(""),[y,v]=b.useState([]),[P,M]=b.useState([{method:"pix",amount:""}]),[O,E]=b.useState({type:"none",value:""}),[u,_]=b.useState(1),[$,j]=b.useState(!1),D=JSON.parse(localStorage.getItem("user")||"{}");ae.useEffect(()=>{s&&(r?(m(r.table_name||""),x(r.customer_name||""),f(r.customer_phone||""),v(Array.isArray(r.items)?r.items:[]),M(Array.isArray(r.payments)&&r.payments.length?r.payments.map(G=>({method:G.method||"pix",amount:String(G.amount||"")})):[{method:"pix",amount:""}])):(m(""),x(""),f(""),v([]),M([{method:"pix",amount:""}])))},[s,r]);const V=y.reduce((G,ne)=>G+(Number(ne.quantity)||0)*(Number(ne.unit_price)||0),0),T=O.type==="percent"?V*(parseFloat(O.value)||0)/100:O.type==="fixed"&&parseFloat(O.value)||0,N=V+T,z=P.reduce((G,ne)=>G+(parseFloat(ne.amount)||0),0),k=z>=N&&N>0,h=$&&u>0?N/u:N,F=()=>{const G=n[0];v(ne=>[...ne,{dish_id:G?.id,dish_name:G?.name||"Item",quantity:1,unit_price:G?.price??G?.unit_price??0,observations:""}])},S=G=>{v(ne=>ne.filter((fe,ge)=>ge!==G))},q=(G,ne,fe)=>{v(ge=>{const Ee=[...ge];return Ee[G]={...Ee[G],[ne]:fe},Ee})},J=(G,ne)=>{const fe=n.find(ge=>ge.id===ne||String(ge.id)===String(ne));fe&&v(ge=>{const Ee=[...ge];return Ee[G]={...Ee[G],dish_id:fe.id,dish_name:fe.name,unit_price:fe.price??fe.unit_price??0},Ee})},W=()=>M(G=>[...G,{method:"pix",amount:""}]),C=G=>M(ne=>ne.filter((fe,ge)=>ge!==G)),Y=(G,ne,fe)=>{M(ge=>{const Ee=[...ge];return Ee[G]={...Ee[G],[ne]:fe},Ee})},L=(G,ne,fe)=>[...Array.isArray(G)?G:[],{at:new Date().toISOString(),by:D?.email||"sistema",action:ne,details:fe||{}}],oe=G=>{if(G.preventDefault(),t==="create"){const ne=L([],"created",{});l({code:void 0,status:"open",table_name:o.trim()||null,customer_name:p.trim()||null,customer_phone:g.trim()||null,items:y,payments:[],total:V,created_by:D?.email,history:ne})}else if(t==="close"&&r){const ne=P.filter(ge=>parseFloat(ge.amount)>0).map(ge=>({method:ge.method,amount:parseFloat(ge.amount),created_at:new Date().toISOString(),created_by:D?.email})),fe=L(r.history||[],"closed",{payments:ne,tip:T>0?O:null,tip_amount:T,split_count:$?u:null});c({id:r.id,data:{...r,status:"closed",closed_at:new Date().toISOString(),closed_by:D?.email,payments:ne,total:N,tip:T>0?O:null,tip_amount:T,split_count:$?u:null,history:fe}})}else if(t==="edit"&&r){const ne=L(r.history||[],"updated",{summary:"Alterao de itens ou dados"});c({id:r.id,data:{...r,table_name:o.trim()||null,customer_name:p.trim()||null,customer_phone:g.trim()||null,items:y,total:V,history:ne}})}},Pe=t==="close",ve=d||i;return e.jsx(Re,{open:s,onOpenChange:a,children:e.jsxs(Le,{className:"sm:max-w-lg max-w-[95vw] max-h-[85vh] overflow-y-auto",style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(Ie,{children:e.jsxs(qe,{style:{color:"var(--text-primary)"},children:[t==="create"&&"Nova Comanda",t==="edit"&&`Editar ${r?.code||""}`,t==="close"&&`Fechar Comanda ${r?.code||""}`]})}),e.jsxs("form",{onSubmit:oe,className:"space-y-4",children:[!Pe&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Mesa"}),e.jsx(B,{value:o,onChange:G=>m(G.target.value),placeholder:"Ex: 1",className:"min-h-touch",style:{backgroundColor:"var(--bg-input)",borderColor:"var(--border-color)",color:"var(--text-primary)"}})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Cliente"}),e.jsx(B,{value:p,onChange:G=>x(G.target.value),placeholder:"Nome",className:"min-h-touch",style:{backgroundColor:"var(--bg-input)",borderColor:"var(--border-color)",color:"var(--text-primary)"}})]})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-sm font-medium mb-2 block",children:"Telefone"}),e.jsx(B,{value:g,onChange:G=>f(G.target.value),placeholder:"(00) 00000-0000",className:"min-h-touch",style:{backgroundColor:"var(--bg-input)",borderColor:"var(--border-color)",color:"var(--text-primary)"}})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx(R,{children:"Itens"}),e.jsxs(A,{type:"button",variant:"outline",size:"sm",onClick:F,disabled:!n.length,children:[e.jsx($e,{className:"w-3 h-3 mr-1"})," Adicionar"]})]}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:y.length===0?e.jsx("div",{className:"text-center py-4 text-sm",style:{color:"var(--text-muted)"},children:'Nenhum item adicionado. Clique em "Adicionar" para comear.'}):y.map((G,ne)=>{const fe=(Number(G.quantity)||0)*(Number(G.unit_price)||0);return e.jsxs("div",{className:"flex gap-2 flex-wrap items-end p-3 rounded border hover:bg-gray-50 dark:hover:bg-gray-900/50 transition-colors",style:{borderColor:"var(--border-color)"},children:[e.jsxs(Se,{value:G.dish_id,onValueChange:ge=>J(ne,ge),children:[e.jsx(De,{className:"flex-1 min-w-[140px]",children:e.jsx(Me,{placeholder:"Selecione o prato"})}),e.jsx(Ae,{children:n.map(ge=>e.jsxs(X,{value:ge.id,children:[ge.name," ",ge.price?`- ${Ps(ge.price)}`:""]},ge.id))})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(R,{className:"text-xs",style:{color:"var(--text-muted)"},children:"Qtd:"}),e.jsx(B,{type:"number",min:1,value:G.quantity,onChange:ge=>q(ne,"quantity",parseInt(ge.target.value,10)||1),className:"w-16 text-center",style:{backgroundColor:"var(--bg-input)",borderColor:"var(--border-color)",color:"var(--text-primary)"}})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(R,{className:"text-xs",style:{color:"var(--text-muted)"},children:"R$:"}),e.jsx(B,{type:"number",step:"0.01",value:G.unit_price,onChange:ge=>q(ne,"unit_price",parseFloat(ge.target.value)||0),className:"w-24",style:{backgroundColor:"var(--bg-input)",borderColor:"var(--border-color)",color:"var(--text-primary)"}})]}),e.jsx("div",{className:"flex items-center gap-2 px-2 py-1 rounded",style:{backgroundColor:"var(--bg-secondary)"},children:e.jsx("span",{className:"text-xs font-medium",style:{color:"var(--text-primary)"},children:Ps(fe)})}),e.jsx(A,{type:"button",variant:"ghost",size:"icon",onClick:()=>S(ne),className:"text-red-500 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20",children:e.jsx(Xe,{className:"w-4 h-4"})})]},ne)})})]})]}),e.jsxs("div",{className:"p-3 rounded-lg border",style:{backgroundColor:"var(--bg-secondary)",borderColor:"var(--border-color)"},children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold text-lg",style:{color:"var(--text-primary)"},children:"Total:"}),e.jsx("span",{className:"font-bold text-xl",style:{color:"var(--text-primary)"},children:Ps(Pe?r?.total:V)})]}),!Pe&&y.length>0&&e.jsxs("p",{className:"text-xs mt-1",style:{color:"var(--text-muted)"},children:[y.length," ",y.length===1?"item":"itens","  ",y.reduce((G,ne)=>G+(Number(ne.quantity)||0),0)," unidades"]})]}),Pe&&e.jsxs("div",{children:[e.jsx(R,{children:"Pagamentos"}),e.jsxs("div",{className:"space-y-2 mt-2",children:[P.map((G,ne)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs(Se,{value:G.method,onValueChange:fe=>Y(ne,"method",fe),children:[e.jsx(De,{className:"w-[160px]",children:e.jsx(Me,{})}),e.jsx(Ae,{children:Sd.map(fe=>e.jsx(X,{value:fe.value,children:fe.label},fe.value))})]}),e.jsx(B,{type:"number",step:"0.01",placeholder:"0,00",value:G.amount,onChange:fe=>Y(ne,"amount",fe.target.value),style:{backgroundColor:"var(--bg-input)",borderColor:"var(--border-color)",color:"var(--text-primary)"}}),e.jsx(A,{type:"button",variant:"ghost",size:"icon",onClick:()=>C(ne),children:e.jsx(Xe,{className:"w-4 h-4"})})]},ne)),e.jsxs(A,{type:"button",variant:"outline",size:"sm",onClick:W,children:[e.jsx($e,{className:"w-3 h-3 mr-1"})," Forma de pagamento"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 rounded",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:"Subtotal:"}),e.jsx("span",{className:"text-sm font-bold",style:{color:"var(--text-primary)"},children:Ps(V)})]}),T>0&&e.jsxs("div",{className:"flex justify-between items-center p-2 rounded",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:"Gorjeta:"}),e.jsx("span",{className:"text-sm font-bold",style:{color:"var(--text-primary)"},children:Ps(T)})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 rounded border-t",style:{borderColor:"var(--border-color)"},children:[e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:"Total:"}),e.jsx("span",{className:"text-sm font-bold",style:{color:"var(--text-primary)"},children:Ps(N)})]}),$&&u>1&&e.jsxs("div",{className:"flex justify-between items-center p-2 rounded border border-blue-200 dark:border-blue-800",style:{backgroundColor:"rgba(59, 130, 246, 0.1)"},children:[e.jsxs("span",{className:"text-sm font-medium text-blue-700 dark:text-blue-300",children:["Por pessoa (",u,"):"]}),e.jsx("span",{className:"text-sm font-bold text-blue-700 dark:text-blue-300",children:Ps(h)})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 rounded",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:"Total pago:"}),e.jsx("span",{className:`text-sm font-bold ${z>=N?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:Ps(z)})]}),z>N&&e.jsxs("div",{className:"flex justify-between items-center p-2 rounded border border-green-200 dark:border-green-800",style:{backgroundColor:"rgba(34, 197, 94, 0.1)"},children:[e.jsx("span",{className:"text-sm font-medium text-green-700 dark:text-green-300",children:"Troco:"}),e.jsx("span",{className:"text-sm font-bold text-green-700 dark:text-green-300",children:Ps(z-N)})]}),!k&&N>0&&e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded border border-red-200 dark:border-red-800",style:{backgroundColor:"rgba(239, 68, 68, 0.1)"},children:[e.jsx(Yt,{className:"w-4 h-4 text-red-600 dark:text-red-400"}),e.jsxs("span",{className:"text-xs text-red-600 dark:text-red-400",children:["Valor pago insuficiente. Faltam ",Ps(N-z)]})]})]})]}),e.jsxs(Qs,{children:[e.jsx(A,{type:"button",variant:"outline",onClick:()=>a(!1),children:"Cancelar"}),e.jsx(A,{type:"submit",disabled:ve||Pe&&!k&&V>0,children:ve?"Salvando...":t==="create"?"Criar":t==="close"?"Fechar comanda":"Salvar"})]})]})]})})}function ij({open:s,onOpenChange:a,comanda:t}){const r=Array.isArray(t?.history)?t.history:[],n=d=>d?new Date(d).toLocaleString("pt-BR"):"",l=d=>{switch(d){case"created":return e.jsx($e,{className:"w-4 h-4 text-green-600 dark:text-green-400"});case"updated":return e.jsx(vn,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"});case"closed":return e.jsx(ot,{className:"w-4 h-4 text-teal-600 dark:text-teal-400"});case"cancelled":return e.jsx(Xa,{className:"w-4 h-4 text-red-600 dark:text-red-400"});default:return e.jsx(Yr,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"})}},c=d=>({created:"Criada",updated:"Atualizada",closed:"Fechada",cancelled:"Cancelada"})[d]||d;return e.jsx(Re,{open:s,onOpenChange:a,children:e.jsxs(Le,{className:"sm:max-w-md max-w-[95vw] max-h-[85vh] overflow-y-auto",style:{backgroundColor:"var(--bg-card)",borderColor:"var(--border-color)"},children:[e.jsx(Ie,{children:e.jsxs(qe,{style:{color:"var(--text-primary)"},className:"flex items-center gap-2",children:[e.jsx(Yr,{className:"w-5 h-5"}),"Histrico  ",t?.code||`#${t?.id}`]})}),e.jsx("div",{className:"space-y-3",children:r.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Yr,{className:"w-12 h-12 mx-auto mb-3 opacity-30",style:{color:"var(--text-muted)"}}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:"Nenhuma alterao registrada."})]}):r.map((d,i)=>e.jsxs("div",{className:"flex gap-3 p-3 rounded-lg border hover:bg-gray-50 dark:hover:bg-gray-900/50 transition-colors",style:{borderColor:"var(--border-color)"},children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:l(d.action)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:c(d.action)}),e.jsx("span",{className:"text-xs",style:{color:"var(--text-muted)"},children:n(d.at)})]}),e.jsxs("p",{className:"text-xs mb-1",style:{color:"var(--text-muted)"},children:["Por: ",d.by||"Sistema"]}),d.details&&Object.keys(d.details).length>0&&e.jsxs("div",{className:"mt-2 p-2 rounded text-xs overflow-x-auto",style:{backgroundColor:"var(--bg-secondary)",color:"var(--text-secondary)"},children:[d.details.payments&&Array.isArray(d.details.payments)&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:"Pagamentos:"}),d.details.payments.map((o,m)=>e.jsxs("p",{className:"pl-2",children:[Sd.find(p=>p.value===o.method)?.label||o.method,": ",Ps(o.amount)]},m))]}),d.details.summary&&e.jsx("p",{className:"italic",children:d.details.summary}),!d.details.payments&&!d.details.summary&&e.jsx("pre",{className:"text-xs",children:JSON.stringify(d.details,null,2)})]})]})]},i))})]})})}function lj({user:s}){const[a,t]=b.useState(""),[r,n]=b.useState(!1),l=ts();b.useEffect(()=>{s?.slug&&t(s.slug)},[s]);const c=de({mutationFn:async m=>{const p=String(m||"").trim().toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"");return await _e.functions.invoke("updateMasterSlug",{slug:p||null})},onSuccess:()=>{l.invalidateQueries(["user"]),K.success(" Link do cardpio atualizado!")},onError:m=>{K.error(m?.message||"Erro ao atualizar link")}}),d=()=>{if(!a.trim()){K.error("Digite um link vlido");return}c.mutate(a)},i=()=>{if(!a){K.error("Configure um link primeiro");return}const m=`${window.location.origin}/s/${a}`;navigator.clipboard.writeText(m),n(!0),K.success("Link copiado!"),setTimeout(()=>n(!1),2e3)},o=a?`${window.location.origin}/s/${a}`:null;return e.jsxs(Q,{children:[e.jsxs(he,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Ho,{className:"w-5 h-5 text-orange-500"}),"Meu Cardpio"]}),e.jsx(xs,{children:"Configure o link do seu cardpio para compartilhar com seus clientes"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"master-slug",children:"Link do Cardpio"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 flex items-center gap-2 px-3 py-2 border rounded-md bg-gray-50 dark:bg-gray-900",children:[e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[window.location.origin,"/s/"]}),e.jsx(B,{id:"master-slug",value:a,onChange:m=>t(m.target.value),placeholder:"meu-restaurante",className:"border-0 bg-transparent p-0 h-auto focus-visible:ring-0"})]}),e.jsx(A,{onClick:d,disabled:c.isPending,children:c.isPending?"Salvando...":"Salvar"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Use apenas letras minsculas, nmeros e hfens. Ex: meu-restaurante"})]}),o&&e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-green-900 dark:text-green-100",children:"Link do seu cardpio:"}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300 truncate font-mono",children:o})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:i,className:"flex-1",children:r?e.jsxs(e.Fragment,{children:[e.jsx(ot,{className:"w-4 h-4 mr-2"}),"Copiado!"]}):e.jsxs(e.Fragment,{children:[e.jsx(Js,{className:"w-4 h-4 mr-2"}),"Copiar Link"]})}),e.jsxs(A,{variant:"outline",size:"sm",onClick:()=>window.open(o,"_blank"),className:"flex-1",children:[e.jsx(qi,{className:"w-4 h-4 mr-2"}),"Visualizar"]})]})]})]})]})}const oj=[{value:0,label:"Dom"},{value:1,label:"Seg"},{value:2,label:"Ter"},{value:3,label:"Qua"},{value:4,label:"Qui"},{value:5,label:"Sex"},{value:6,label:"Sb"}];function Av(){const{subscriberData:s,isMaster:a,refresh:t,menuContext:r}=as(),[n,l]=ae.useState(null),[c,d]=b.useState(""),[i,o]=b.useState({name:"",logo:"",whatsapp:"",address:"",slogan:"",instagram:"",facebook:"",tiktok:"",theme_primary_color:"",theme_secondary_color:"",theme_accent_color:"",is_open:null,accepting_orders:!0,pause_message:"",opening_time:"08:00",closing_time:"18:00",working_days:[1,2,3,4,5],cross_sell_config:{enabled:!0,beverage_offer:{enabled:!0,trigger_product_types:["pizza"],min_cart_value:0,dish_id:null,title:" Que tal uma bebida?",message:"Pizza sem bebida? Adicione {product_name} por apenas {product_price}",discount_percent:0},dessert_offer:{enabled:!0,min_cart_value:40,dish_id:null,title:" Que tal uma sobremesa?",message:"Complete seu pedido com {product_name} por apenas {product_price}",discount_percent:0},combo_offer:{enabled:!0,min_pizzas:2,dish_id:null,title:" Oferta Especial!",message:"Compre {min_pizzas} pizzas e ganhe {product_name} GRTIS!",discount_percent:100}}}),m=ts();ae.useEffect(()=>{(async()=>{try{const h=await se.auth.me();l(h)}catch(h){console.error("Error loading user:",h)}})()},[]),b.useEffect(()=>{s?.slug!=null&&d(s.slug)},[s?.slug]);const p=de({mutationFn:async k=>{const h=String(k||"").trim().toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"");await se.put(`/subscribers/${s.id}`,{slug:h||null})},onSuccess:()=>{t(),K.success("Link do cardpio atualizado.")},onError:k=>K.error(k?.message||"Erro ao salvar link")}),{data:x=[]}=ke({queryKey:["store",r?.type,r?.value],queryFn:async()=>{if(!r)return[];const k={};return r.type==="subscriber"&&r.value&&(k.as_subscriber=r.value),se.entities.Store.list(null,k)},enabled:!!r}),g=x[0],f=Array.isArray(g?.banners)?g.banners:[],y=de({mutationFn:async k=>{if(!g?.id)throw new Error("Loja no encontrada");const h=r?.type==="subscriber"&&r?.value?{as_subscriber:r.value}:{};return se.entities.Store.update(g.id,k,h)},onSuccess:()=>{m.invalidateQueries({queryKey:["store"]}),m.invalidateQueries({queryKey:["store",r?.type,r?.value]}),K.success("Banners salvos")},onError:k=>K.error(k?.message||"Erro ao salvar banners")}),v=async k=>{const h=k.target.files?.[0];if(h)try{const{uploadToCloudinary:F}=await lt(async()=>{const{uploadToCloudinary:q}=await import("./cloudinaryUpload-vqCefYaz.js");return{uploadToCloudinary:q}},__vite__mapDeps([0,1,2])),S=await F(h,"store");y.mutate({banner_image:S})}catch{K.error("Erro no upload")}},P=()=>{const k=[...f,{image:"",title:"",subtitle:"",link:"",active:!0}];y.mutate({banners:k})},M=(k,h,F)=>{const S=f.map((q,J)=>J===k?{...q,[h]:F}:q);y.mutate({banners:S})},O=k=>{const h=f.filter((F,S)=>S!==k);y.mutate({banners:h})},E=async(k,h)=>{const F=k.target.files?.[0];if(F)try{const{uploadToCloudinary:S}=await lt(async()=>{const{uploadToCloudinary:J}=await import("./cloudinaryUpload-vqCefYaz.js");return{uploadToCloudinary:J}},__vite__mapDeps([0,1,2])),q=await S(F,"store");M(h,"image",q)}catch{K.error("Erro no upload")}};b.useEffect(()=>{g&&o(k=>({...k,name:g.name||"",logo:g.logo||"",whatsapp:g.whatsapp||"",address:g.address||"",slogan:g.slogan||"",instagram:g.instagram||"",facebook:g.facebook||"",theme_primary_color:g.theme_primary_color||"",theme_secondary_color:g.theme_secondary_color||"",theme_accent_color:g.theme_accent_color||"",is_open:g.is_open===null||g.is_open===void 0?null:g.is_open,accepting_orders:g.accepting_orders!==!1,pause_message:g.pause_message||"",opening_time:g.opening_time||"08:00",closing_time:g.closing_time||"18:00",working_days:g.working_days||[1,2,3,4,5],cross_sell_config:g.cross_sell_config||k.cross_sell_config}))},[g]);const u=de({mutationFn:async k=>{console.log("Criando loja:",k);const F={...Object.keys(k).reduce((S,q)=>{const J=k[q];return J===void 0||(Array.isArray(J)?S[q]=J.filter(W=>W!=null):S[q]=J),S},{}),owner_email:n?.subscriber_email||n?.email};console.log("Dados limpos a serem criados:",F);try{const S=await se.entities.Store.create(F);return console.log("Loja criada:",S),{success:!0,store:S}}catch(S){throw console.error("Erro ao criar loja:",S),console.error("Stack:",S.stack),S}},onSuccess:()=>{m.invalidateQueries({queryKey:["store"]}),m.invalidateQueries({queryKey:["stores"]}),m.refetchQueries({queryKey:["store"]}),K.success(" Loja criada com sucesso!",{duration:3e3,position:"top-center"}),setTimeout(()=>{window.location.reload()},1e3)},onError:k=>{console.error("Erro ao criar:",k),K.error(" Erro ao criar: "+(k?.message||"Desconhecido"),{duration:5e3,position:"top-center"})}}),_=de({mutationFn:async({data:k})=>{console.log(" [StoreTab] Salvando dados da loja:",k);const F={...Object.keys(k).reduce((S,q)=>{const J=k[q];return J===void 0||(Array.isArray(J)?S[q]=J.filter(W=>W!=null):S[q]=J),S},{}),owner_email:n?.subscriber_email||n?.email};console.log(" [StoreTab] Dados limpos a serem salvos:",JSON.stringify(F,null,2));try{const S=await se.entities.Store.list();if(console.log(" [StoreTab] Lojas encontradas:",S.length,S),S.length===0){console.log(" [StoreTab] Criando nova loja...");const q=await se.entities.Store.create(F);return console.log(" [StoreTab] Loja criada com sucesso:",q),{success:!0,store:q}}else{console.log(" [StoreTab] Atualizando loja existente (ID:",S[0].id,")..."),console.log(" [StoreTab] Enviando dados:",JSON.stringify(F,null,2));const q=await se.entities.Store.update(S[0].id,F);return console.log(" [StoreTab] Loja atualizada com sucesso:",q),{success:!0,store:q}}}catch(S){throw console.error(" [StoreTab] Erro ao salvar loja:",S),console.error(" [StoreTab] Detalhes do erro:",{message:S.message,stack:S.stack,response:S.response,data:S.data}),S}},onSuccess:k=>{console.log("Sucesso ao salvar:",k),m.invalidateQueries({queryKey:["store"]}),m.invalidateQueries({queryKey:["stores"]}),m.refetchQueries({queryKey:["store"]}),K.success(" Configuraes da loja salvas com sucesso!",{duration:3e3,position:"top-center"}),setTimeout(()=>{window.location.reload()},1e3)},onError:k=>{console.error(" Erro ao salvar loja:",k),console.error(" Erro detalhado:",{message:k?.message,stack:k?.stack,response:k?.response,data:k?.data});const h=k?.message||k?.response?.data?.message||k?.toString()||"Erro desconhecido";K.error(" Erro ao salvar as configuraes da loja. "+h,{duration:5e3,position:"top-center"})}}),$=k=>{k.preventDefault(),g?_.mutate({data:i}):u.mutate(i)},j=async k=>{const h=k.target.files?.[0];if(h)try{const{uploadToCloudinary:F}=await lt(async()=>{const{uploadToCloudinary:q}=await import("./cloudinaryUpload-vqCefYaz.js");return{uploadToCloudinary:q}},__vite__mapDeps([0,1,2])),S=await F(h,"store");o(q=>({...q,logo:S}));try{const q=await kd(S),J={theme_primary_color:q.primary,theme_secondary_color:q.secondary,theme_accent_color:q.accent};if(o(W=>({...W,logo:S,...J})),g?.id){const W=r?.type==="subscriber"&&r?.value?{as_subscriber:r.value}:{};await se.entities.Store.update(g.id,{logo:S,...J},W),m.invalidateQueries({queryKey:["store"]}),m.invalidateQueries({queryKey:["stores"]}),m.invalidateQueries({queryKey:["store",r?.type,r?.value]}),K.success("Logo e cores do tema atualizados a partir da logo.")}else K.success("Logo atualizada. Cores do tema sero aplicadas ao salvar.")}catch(q){console.warn("Extrao de cores da logo:",q),K.success("Logo atualizada! Ela ser exibida no cardpio digital.")}}catch(F){console.error("Erro ao fazer upload:",F),K.error("Erro ao fazer upload do logotipo")}},D=k=>{o(h=>{const F=h.working_days||[];return F.includes(k)?{...h,working_days:F.filter(S=>S!==k)}:{...h,working_days:[...F,k].sort()}})},V=()=>i.is_open===!0?"open":i.is_open===!1?"closed":"auto",T=k=>{o(k==="open"?h=>({...h,is_open:!0}):k==="closed"?h=>({...h,is_open:!1}):h=>({...h,is_open:null}))},N=V(),z=b.useMemo(()=>{const k=!!i.logo,h=!!i.name?.trim(),F=!!i.whatsapp?.trim(),S=!!i.address?.trim(),q=k&&h&&F,J=(i.working_days||[]).length,W=N==="open"||N==="auto"&&J>0;return{hasLogo:k,hasName:h,hasWhatsApp:F,hasAddress:S,isConfigured:q,workingDaysCount:J,isOpen:W}},[i,N]);return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-6 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Configuraes da Loja"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Gerencie as informaes e funcionamento do seu restaurante"})]}),a&&n&&e.jsx("div",{className:"mb-6",children:e.jsx(lj,{user:n})}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4 mb-4 sm:mb-6",children:[e.jsx(Q,{className:z.hasLogo?"border-green-200":"border-gray-200",children:e.jsx(Z,{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:"Logo"}),e.jsx("p",{className:"text-base sm:text-lg font-bold",children:z.hasLogo?"":""})]}),z.hasLogo?e.jsx(ot,{className:"w-5 h-5 sm:w-6 sm:h-6 text-green-500"}):e.jsx(Xa,{className:"w-5 h-5 sm:w-6 sm:h-6 text-gray-400"})]})})}),e.jsx(Q,{className:z.hasName?"border-green-200":"border-gray-200",children:e.jsx(Z,{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:"Nome"}),e.jsx("p",{className:"text-base sm:text-lg font-bold",children:z.hasName?"":""})]}),z.hasName?e.jsx(ot,{className:"w-5 h-5 sm:w-6 sm:h-6 text-green-500"}):e.jsx(Xa,{className:"w-5 h-5 sm:w-6 sm:h-6 text-gray-400"})]})})}),e.jsx(Q,{className:z.hasWhatsApp?"border-green-200":"border-gray-200",children:e.jsx(Z,{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:"WhatsApp"}),e.jsx("p",{className:"text-base sm:text-lg font-bold",children:z.hasWhatsApp?"":""})]}),z.hasWhatsApp?e.jsx(ot,{className:"w-5 h-5 sm:w-6 sm:h-6 text-green-500"}):e.jsx(Xa,{className:"w-5 h-5 sm:w-6 sm:h-6 text-gray-400"})]})})}),e.jsx(Q,{className:z.isOpen?"border-green-200":"border-red-200",children:e.jsx(Z,{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:"Status"}),e.jsx("p",{className:"text-xs sm:text-base font-bold",children:z.isOpen?"Aberta":"Fechada"})]}),z.isOpen?e.jsx($s,{className:"w-5 h-5 sm:w-6 sm:h-6 text-green-500"}):e.jsx(Xa,{className:"w-5 h-5 sm:w-6 sm:h-6 text-red-500"})]})})})]}),e.jsxs("form",{onSubmit:$,className:"space-y-6",children:[e.jsxs(Q,{children:[e.jsxs(he,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(li,{className:"w-5 h-5 text-orange-500"}),"Identidade da Loja"]}),e.jsx(xs,{children:"Nome, logo e informaes de contato"})]}),e.jsxs(Z,{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-32 h-32 bg-gray-100 rounded-xl flex items-center justify-center mb-3 overflow-hidden border-2 border-dashed border-gray-300 hover:border-orange-400 transition-colors",children:i.logo?e.jsx("img",{src:i.logo,alt:"Logo",className:"w-full h-full object-cover"}):e.jsx(li,{className:"w-12 h-12 text-gray-400"})}),e.jsxs("label",{className:"text-sm text-orange-600 cursor-pointer hover:text-orange-700 font-medium flex items-center gap-2",children:[e.jsx(sn,{className:"w-4 h-4"}),e.jsx("input",{type:"file",accept:"image/*",onChange:j,className:"hidden"}),"Alterar Logotipo"]}),e.jsx("span",{className:"text-xs text-gray-500 mt-1",children:"Recomendado: 500x500px"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Esta logo ser exibida no cardpio digital"})]}),e.jsx(Wl,{}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(R,{htmlFor:"store-name",className:"flex items-center gap-2 mb-2",children:[e.jsx(li,{className:"w-4 h-4 text-gray-500"}),"Nome da Loja *",e.jsx(ai,{children:e.jsxs(ti,{children:[e.jsx(ri,{asChild:!0,children:e.jsx(oi,{className:"w-4 h-4 text-gray-400 hover:text-gray-600 cursor-help"})}),e.jsx(ni,{className:"max-w-xs",children:e.jsx("p",{className:"text-xs",children:"Nome que aparecer no cardpio digital e nos pedidos dos clientes"})})]})})]}),e.jsx(Ma,{id:"store-name",value:i.name,onChange:k=>o(h=>({...h,name:k.target.value})),placeholder:"Ex: Restaurante Raiz",required:!0,className:i.name?.trim()?"":"border-red-300"}),!i.name?.trim()&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Nome da loja  obrigatrio"})]}),e.jsxs("div",{children:[e.jsxs(R,{htmlFor:"whatsapp",className:"flex items-center gap-2 mb-2",children:[e.jsx(Mu,{className:"w-4 h-4 text-gray-500"}),"WhatsApp",e.jsx(ai,{children:e.jsxs(ti,{children:[e.jsx(ri,{asChild:!0,children:e.jsx(oi,{className:"w-4 h-4 text-gray-400 hover:text-gray-600 cursor-help"})}),e.jsx(ni,{className:"max-w-xs",children:e.jsx("p",{className:"text-xs",children:"Nmero usado para receber pedidos via WhatsApp. Formato: DDD + nmero completo"})})]})})]}),e.jsx(Ma,{id:"whatsapp",value:i.whatsapp,onChange:k=>{const h=k.target.value.replace(/\D/g,"");o(F=>({...F,whatsapp:h}))},placeholder:"5586999999999",maxLength:15}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Formato: DDD + nmero (apenas nmeros)",i.whatsapp&&i.whatsapp.length<10&&e.jsx("span",{className:"text-red-500 ml-2",children:"Nmero muito curto"})]})]})]}),e.jsxs("div",{children:[e.jsxs(R,{htmlFor:"address",className:"flex items-center gap-2 mb-2",children:[e.jsx(za,{className:"w-4 h-4 text-gray-500"}),"Endereo"]}),e.jsx(Ma,{id:"address",value:i.address,onChange:k=>o(h=>({...h,address:k.target.value})),placeholder:"Rua, nmero, bairro, cidade"})]}),e.jsxs("div",{children:[e.jsxs(R,{htmlFor:"slogan",className:"mb-2 flex items-center gap-2",children:["Frase do Restaurante",e.jsx(ai,{children:e.jsxs(ti,{children:[e.jsx(ri,{asChild:!0,children:e.jsx(oi,{className:"w-4 h-4 text-gray-400 hover:text-gray-600 cursor-help"})}),e.jsx(ni,{className:"max-w-xs",children:e.jsx("p",{className:"text-xs",children:"Slogan ou frase que aparece no topo do cardpio digital para atrair clientes"})})]})})]}),e.jsx(Ma,{id:"slogan",value:i.slogan,onChange:k=>o(h=>({...h,slogan:k.target.value})),placeholder:"Ex: O melhor sabor da regio!"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs(R,{htmlFor:"instagram",className:"flex items-center gap-2 mb-2 text-sm font-medium",children:[e.jsx(lu,{className:"w-4 h-4 text-gray-500"}),"Instagram"]}),e.jsx(Ma,{id:"instagram",value:i.instagram,onChange:k=>o(h=>({...h,instagram:k.target.value})),placeholder:"@seurestaurante"})]}),e.jsxs("div",{children:[e.jsxs(R,{htmlFor:"facebook",className:"flex items-center gap-2 mb-2 text-sm font-medium",children:[e.jsx(ou,{className:"w-4 h-4 text-gray-500"}),"Facebook"]}),e.jsx(Ma,{id:"facebook",value:i.facebook,onChange:k=>o(h=>({...h,facebook:k.target.value})),placeholder:"Link da pgina"})]}),e.jsxs("div",{children:[e.jsxs(R,{htmlFor:"tiktok",className:"flex items-center gap-2 mb-2 text-sm font-medium",children:[e.jsx(cu,{className:"w-4 h-4 text-gray-500"}),"TikTok"]}),e.jsx(Ma,{id:"tiktok",value:i.tiktok,onChange:k=>o(h=>({...h,tiktok:k.target.value})),placeholder:"@seurestaurante"})]})]})]})]}),e.jsxs(Q,{children:[e.jsxs(he,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(xn,{className:"w-5 h-5 text-orange-500"}),"Funcionamento"]}),e.jsx(xs,{children:"Defina quando sua loja est aberta"})]}),e.jsxs(Z,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(R,{className:"mb-3 block font-semibold",children:"Modo de Funcionamento"}),e.jsxs("div",{className:"grid sm:grid-cols-3 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>T("auto"),className:`p-4 rounded-xl border-2 transition-all text-left ${N==="auto"?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${N==="auto"?"bg-blue-500":"bg-gray-300"}`}),e.jsx("span",{className:"font-semibold text-sm",children:" Automtico"})]}),e.jsx("p",{className:"text-xs text-gray-600",children:"Baseado em horrios e dias configurados"})]}),e.jsxs("button",{type:"button",onClick:()=>T("open"),className:`p-4 rounded-xl border-2 transition-all text-left ${N==="open"?"border-green-500 bg-green-50":"border-gray-200 hover:border-gray-300 bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${N==="open"?"bg-green-500":"bg-gray-300"}`}),e.jsx("span",{className:"font-semibold text-sm",children:" Sempre Aberta"})]}),e.jsx("p",{className:"text-xs text-gray-600",children:"Ignora horrios, aberto 24h"})]}),e.jsxs("button",{type:"button",onClick:()=>T("closed"),className:`p-4 rounded-xl border-2 transition-all text-left ${N==="closed"?"border-red-500 bg-red-50":"border-gray-200 hover:border-gray-300 bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${N==="closed"?"bg-red-500":"bg-gray-300"}`}),e.jsx("span",{className:"font-semibold text-sm",children:" Fechada"})]}),e.jsx("p",{className:"text-xs text-gray-600",children:"Loja fechada independente do horrio"})]})]})]}),N==="auto"&&e.jsxs(e.Fragment,{children:[e.jsx(Wl,{}),e.jsxs("div",{children:[e.jsx(R,{className:"mb-3 block font-semibold",children:"Horrio de Funcionamento"}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{htmlFor:"opening-time",className:"text-sm text-gray-600 mb-2 block",children:"Abertura"}),e.jsx(B,{id:"opening-time",type:"time",value:i.opening_time,onChange:k=>o(h=>({...h,opening_time:k.target.value}))})]}),e.jsxs("div",{children:[e.jsx(R,{htmlFor:"closing-time",className:"text-sm text-gray-600 mb-2 block",children:"Fechamento"}),e.jsx(B,{id:"closing-time",type:"time",value:i.closing_time,onChange:k=>o(h=>({...h,closing_time:k.target.value}))})]})]})]}),e.jsxs("div",{children:[e.jsx(R,{className:"mb-3 block font-semibold",children:"Dias de Funcionamento"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:oj.map(k=>e.jsx("button",{type:"button",onClick:()=>D(k.value),className:`w-14 h-12 rounded-lg border-2 font-semibold text-sm transition-all ${(i.working_days||[]).includes(k.value)?"bg-orange-500 border-orange-500 text-white":"bg-white border-gray-200 text-gray-600 hover:border-orange-300"}`,children:k.label},k.value))})]})]})]})]}),e.jsxs(Q,{children:[e.jsxs(he,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Yt,{className:"w-5 h-5 text-orange-500"}),"Pausa Temporria de Pedidos"]}),e.jsx(xs,{children:"Bloqueie pedidos sem fechar a loja"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-yellow-50 border border-yellow-200 rounded-xl",children:[e.jsx(mt,{id:"pause-orders",checked:i.accepting_orders===!1,onCheckedChange:k=>o(h=>({...h,accepting_orders:!k}))}),e.jsxs("div",{className:"flex-1",children:[e.jsx(R,{htmlFor:"pause-orders",className:"font-semibold cursor-pointer",children:"Pausar Pedidos Temporariamente"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"A loja continua visvel, mas os clientes no podero fazer pedidos"})]})]}),i.accepting_orders===!1&&e.jsxs("div",{className:"pl-7",children:[e.jsx(R,{htmlFor:"pause-message",className:"text-sm mb-2 block",children:"Mensagem para clientes"}),e.jsx(B,{id:"pause-message",value:i.pause_message||"",onChange:k=>o(h=>({...h,pause_message:k.target.value})),placeholder:"Ex: Voltamos em 30 minutos"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2 p-3 bg-gray-50 rounded-lg border",children:[e.jsx("strong",{children:"Prvia:"})," ",i.pause_message||"Voltamos em breve."]})]})]})]}),g&&e.jsxs(Q,{children:[e.jsxs(he,{children:[e.jsx(xe,{children:"Banners do cardpio"}),e.jsx(xs,{children:"Foto de capa e banners promocionais exibidos no cardpio"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Foto de capa (banner superior)"}),e.jsx("div",{className:"mt-1 w-full h-32 bg-gray-100 rounded-lg flex items-center justify-center overflow-hidden border-2 border-dashed",children:g.banner_image?e.jsx("img",{src:g.banner_image,alt:"Capa",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-gray-400 text-sm",children:"Nenhuma"})}),e.jsxs("label",{className:"mt-2 inline-block text-sm text-orange-600 cursor-pointer",children:["Alterar ",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:v})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx(R,{children:"Banners promocionais"}),e.jsx(A,{type:"button",size:"sm",variant:"outline",onClick:P,children:"+ Adicionar"})]}),(f||[]).map((k,h)=>e.jsxs("div",{className:"p-3 border rounded-lg mb-2 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-sm font-medium",children:["Banner ",h+1]}),e.jsx(A,{type:"button",variant:"ghost",size:"sm",className:"text-red-600",onClick:()=>O(h),children:"Remover"})]}),e.jsx("div",{className:"h-20 bg-gray-100 rounded flex items-center justify-center overflow-hidden",children:k.image?e.jsx("img",{src:k.image,alt:"",className:"max-h-full object-contain"}):e.jsx("span",{className:"text-gray-400 text-xs",children:"Sem imagem"})}),e.jsxs("label",{className:"text-xs text-orange-600 cursor-pointer",children:["Upload ",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:F=>E(F,h)})]}),e.jsx(B,{placeholder:"Ttulo",value:k.title||"",onChange:F=>M(h,"title",F.target.value)}),e.jsx(B,{placeholder:"Subttulo",value:k.subtitle||"",onChange:F=>M(h,"subtitle",F.target.value)}),e.jsx(B,{placeholder:"Link",value:k.link||"",onChange:F=>M(h,"link",F.target.value)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{checked:k.active!==!1,onCheckedChange:F=>M(h,"active",F)}),e.jsx(R,{className:"text-xs",children:"Ativo"})]})]},h))]})]})]}),!a&&s&&e.jsxs(Q,{children:[e.jsxs(he,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Ho,{className:"w-5 h-5"}),"Link do seu cardpio"]}),e.jsx(xs,{children:"Este  o link que seus clientes usam para ver o cardpio. Compartilhe no WhatsApp, redes sociais, etc."})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Seu link"}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx(B,{readOnly:!0,value:typeof window<"u"?`${window.location.origin}/s/${s?.slug||"..."}`:"",className:"font-mono text-xs sm:text-sm min-h-touch"}),e.jsx(A,{type:"button",variant:"outline",size:"icon",onClick:()=>{const k=`${window.location.origin}/s/${s?.slug||""}`;k&&navigator.clipboard&&navigator.clipboard.writeText(k).then(()=>K.success("Link copiado!"))},className:"min-h-touch min-w-touch",children:e.jsx(Js,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Personalize o final do link (ex: meu-restaurante)"}),e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Apenas letras minsculas, nmeros e hfen. Deixe em branco para remover."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ma,{placeholder:"ex: meu-restaurante",value:c,onChange:k=>d(k.target.value),className:"font-mono"}),e.jsx(A,{type:"button",onClick:()=>p.mutate(c),disabled:p.isPending,className:"min-h-touch",children:p.isPending?"Salvando":"Salvar"})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 pt-4 pb-6 bg-gray-50 z-10",children:e.jsxs(A,{type:"submit",size:"lg",className:"w-full bg-orange-500 hover:bg-orange-600 shadow-lg min-h-touch",disabled:_.isPending||u.isPending,children:[e.jsx(Hi,{className:`w-4 h-4 sm:w-5 sm:h-5 mr-2 ${_.isPending||u.isPending?"animate-spin":""}`}),e.jsx("span",{className:"text-sm sm:text-base",children:_.isPending||u.isPending?"Salvando...":"Salvar Alteraes"})]})})]})]})})}const cj=[{id:"dinheiro",name:"Dinheiro",icon:"",type:"presencial",active:!0},{id:"cartao_debito",name:"Carto de Dbito",icon:"",type:"presencial",active:!0},{id:"cartao_credito",name:"Carto de Crdito",icon:"",type:"presencial",active:!0},{id:"pix",name:"Pix",icon:"",type:"presencial",active:!0},{id:"picpay",name:"PicPay",icon:"",type:"presencial",active:!1},{id:"vale_refeicao",name:"Vale - Refeio",icon:"",type:"presencial",active:!1},{id:"vale_vale_card",name:"Vale - Vale Card",icon:"",type:"presencial",active:!1},{id:"vale_green_card",name:"Vale - Green Card",icon:"",type:"presencial",active:!1},{id:"vale_verocard",name:"Vale - Verocard",icon:"",type:"presencial",active:!1},{id:"vale_vr_smart",name:"Vale - VR Smart",icon:"",type:"presencial",active:!1},{id:"vale_cooper_card",name:"Vale - Cooper Card",icon:"",type:"presencial",active:!1},{id:"ben_visa_refeicao",name:"Ben Visa Refeio",icon:"",type:"presencial",active:!1},{id:"vale_sodexo",name:"Vale - Sodexo",icon:"",type:"presencial",active:!1},{id:"vale_alelo_refeicao",name:"Vale - Alelo Refeio",icon:"",type:"presencial",active:!1},{id:"vale_green_card_2",name:"Vale - Green Card",icon:"",type:"presencial",active:!1},{id:"visa_refeicao",name:"Visa Refeio",icon:"",type:"presencial",active:!1},{id:"nutricash_refeicao",name:"Nutricash Refeio",icon:"",type:"presencial",active:!1}];function Pv(){const[s,a]=b.useState(cj),[t,r]=b.useState(!1),[n,l]=b.useState(!1),[c,d]=b.useState(""),[i,o]=b.useState("all"),[m,p]=b.useState({name:"",icon:"",type:"presencial"}),[x,g]=b.useState({name:"",image:""}),f=ts(),{menuContext:y}=as(),{data:v=[]}=ke({queryKey:["store",y?.type,y?.value],queryFn:async()=>{if(!y)return[];const z={};return y.type==="subscriber"&&y.value&&(z.as_subscriber=y.value),se.entities.Store.list(null,z)},enabled:!!y}),P=v[0],M=Array.isArray(P?.payment_methods)?P.payment_methods:[],O=de({mutationFn:z=>se.entities.Store.update(P.id,{payment_methods:z}),onSuccess:()=>{f.invalidateQueries({queryKey:["store"]}),K.success("Formas de pagamento atualizadas")},onError:z=>K.error(z?.message||"Erro")}),E=()=>{x.name&&(O.mutate([...M,{name:x.name,image:x.image||""}]),g({name:"",image:""}))},u=z=>{const k=M.filter((h,F)=>F!==z);O.mutate(k)},_=de({mutationFn:z=>P?.id?se.entities.Store.update(P.id,{payment_methods_config:JSON.stringify(z)}):Promise.resolve(),onSuccess:()=>{f.invalidateQueries({queryKey:["store"]}),K.success("Mtodos de pagamento salvos")},onError:()=>K.error("Erro ao salvar mtodos")});b.useEffect(()=>{if(P?.payment_methods_config)try{const z=JSON.parse(P.payment_methods_config);Array.isArray(z)&&z.length>0&&a(z)}catch(z){console.error("Erro ao carregar mtodos salvos:",z)}},[P?.payment_methods_config]);const $=z=>{const k=s.map(h=>h.id===z?{...h,active:!h.active}:h);a(k),P?.id&&_.mutate(k)},j=()=>{const z=Date.now().toString(),k=[...s,{...m,id:z,active:!0}];a(k),r(!1),p({name:"",icon:"",type:"presencial"}),P?.id&&_.mutate(k)},D=z=>{const k=s.find(h=>h.id===z);if(confirm(`Remover forma de pagamento "${k?.name}"?`)){const h=s.filter(F=>F.id!==z);a(h),P?.id&&_.mutate(h),K.success("Mtodo removido")}},V=b.useMemo(()=>s.filter(z=>{if(z.type!=="presencial")return!1;const k=!c||z.name?.toLowerCase().includes(c.toLowerCase()),h=i==="all"||i==="active"&&z.active||i==="inactive"&&!z.active;return k&&h}),[s,c,i]),N=b.useMemo(()=>{const z=s.filter(S=>S.type==="presencial"),k=z.filter(S=>S.active).length,h=z.filter(S=>!S.active).length;return{total:z.length,active:k,inactive:h}},[s]).active;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Pagamentos"}),e.jsx("p",{className:"text-gray-600",children:"Defina as opes de pagamento que seu cliente poder escolher na hora de fazer o pedido."})]}),e.jsxs("div",{className:"flex gap-4 border-b",children:[e.jsx("button",{className:"px-4 py-2 font-medium border-b-2 border-red-500 text-red-500",children:"CONFIGURAES"}),e.jsx("button",{onClick:()=>l(!0),className:"px-4 py-2 font-medium text-gray-500 hover:text-gray-700",children:"EXTRATO PAGAMENTO ONLINE"})]}),P&&e.jsxs(Q,{children:[e.jsxs(he,{children:[e.jsx(xe,{children:"Formas de pagamento aceitas (cardpio)"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Exibidas no checkout. Nome e imagem da bandeira."})]}),e.jsxs(Z,{className:"space-y-3",children:[M.map((z,k)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 border rounded-lg",children:[z.image&&e.jsx("img",{src:z.image,alt:"",className:"h-8 object-contain"}),e.jsx("span",{className:"flex-1 font-medium",children:z.name}),e.jsx(A,{type:"button",variant:"ghost",size:"sm",className:"text-red-600",onClick:()=>u(k),children:"Remover"})]},k)),e.jsxs("div",{className:"p-3 border-2 border-dashed rounded-lg space-y-2",children:[e.jsx(B,{placeholder:"Nome (ex: PIX, Visa, Mastercard)",value:x.name,onChange:z=>g(k=>({...k,name:z.target.value}))}),e.jsx(B,{placeholder:"URL da imagem da bandeira",value:x.image,onChange:z=>g(k=>({...k,image:z.target.value}))}),e.jsx(A,{type:"button",onClick:E,disabled:!x.name||O.isPending,children:"Adicionar"})]})]})]}),e.jsxs(Q,{className:"bg-blue-50 border-blue-200",children:[e.jsx(he,{className:"pb-3",children:e.jsx(xe,{className:"text-sm",children:"Pagamento Online"})}),e.jsxs(Z,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{className:"bg-blue-500",children:"Recomendamos que use 2 dias teis"}),e.jsx("span",{className:"text-sm",children:"- Financeiro WhatsApp (19) 9 9736-0573"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[e.jsx("span",{className:"text-sm font-medium",children:"Pix Online"}),e.jsx(Ve,{})]})]})]}),e.jsxs(Q,{children:[e.jsxs(he,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(xe,{children:"Pagamento Presencial"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[N," formas de pagamento ativas"]})]}),e.jsxs(A,{onClick:()=>r(!0),className:"bg-green-600 hover:bg-green-700",children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"ADICIONAR NOVO TIPO DE PAGAMENTO"]})]}),e.jsx(Z,{children:N===0?e.jsx(gn,{icon:$t,title:"Configure mtodos de pagamento para comear a vender",description:"Ative pelo menos uma forma de pagamento para que seus clientes possam fazer pedidos",actionLabel:"Ativar pagamentos",onAction:()=>{const z=s.find(k=>k.type==="presencial");z&&$(z.id)}}):V.length===0?e.jsx("div",{className:"text-center py-12 text-gray-400 border-2 border-dashed rounded-xl",children:c||i!=="all"?"Nenhum mtodo encontrado com os filtros aplicados":"Nenhum mtodo de pagamento cadastrado"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:V.map(z=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:z.icon}),e.jsx("span",{className:"font-medium",children:z.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:z.active?"bg-green-100 text-green-700":"bg-red-100 text-red-700",children:z.active?"ATIVO":"PASSIVO"}),e.jsx(A,{size:"icon",variant:"ghost",onClick:()=>$(z.id),className:"h-8 w-8",children:e.jsx(Lt,{className:"w-4 h-4"})}),e.jsx(A,{size:"icon",variant:"ghost",onClick:()=>D(z.id),className:"h-8 w-8 text-red-500",children:e.jsx(Xe,{className:"w-4 h-4"})})]})]},z.id))})})]}),e.jsx(Re,{open:t,onOpenChange:r,children:e.jsxs(Le,{children:[e.jsx(Ie,{children:e.jsx(qe,{children:"Adicionar Forma de Pagamento"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome"}),e.jsx(B,{value:m.name,onChange:z=>p({...m,name:z.target.value}),placeholder:"Ex: Credicard"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"cone (Emoji)"}),e.jsx(B,{value:m.icon,onChange:z=>p({...m,icon:z.target.value}),placeholder:""})]})]}),e.jsxs(Qs,{children:[e.jsx(A,{variant:"outline",onClick:()=>r(!1),children:"Cancelar"}),e.jsx(A,{onClick:j,disabled:!m.name,className:"bg-green-600 hover:bg-green-700",children:"Adicionar"})]})]})}),e.jsx(Re,{open:n,onOpenChange:l,children:e.jsxs(Le,{className:"sm:max-w-2xl max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsx(Ie,{children:e.jsx(qe,{children:"Extrato Pagamento Online"})}),e.jsx("div",{className:"py-4",children:e.jsx("p",{className:"text-center text-gray-500",children:"Nenhuma transao encontrada"})})]})})]})}function Ev(){const[s,a]=b.useState(!1),t=ts(),{menuContext:r}=as(),{data:n=[]}=ke({queryKey:["printerConfig",r?.type,r?.value],queryFn:async()=>{if(!r)return[];const f={};return r.type==="subscriber"&&r.value&&(f.as_subscriber=r.value),se.entities.PrinterConfig.list(null,f)},enabled:!!r}),l=n[0]||{printer_name:"",printer_type:"termica",connection_type:"usb",paper_width:"80mm",margin_top:5,margin_bottom:5,margin_left:5,margin_right:5,line_spacing:1.5,font_size:12,auto_cut:!0,open_drawer:!1,print_method:"css"},[c,d]=b.useState(l),i=de({mutationFn:f=>l.id?se.entities.PrinterConfig.update(l.id,f):se.entities.PrinterConfig.create(f),onSuccess:()=>{t.invalidateQueries({queryKey:["printerConfig"]}),K.success(" Configurao salva com sucesso!")},onError:f=>K.error("Erro ao salvar: "+(f?.message||"Desconhecido"))}),o=()=>{i.mutate(c)},m=()=>{if(!c.printer_name?.trim()){K.error("Configure o nome da impressora antes de testar");return}const f=x();g(f),K.success("Enviando para impressora...",{duration:3e3,icon:""})},p=b.useMemo(()=>!!c.printer_name?.trim(),[c.printer_name]),x=()=>`
============================
       TESTE DE IMPRESSO
============================

Impressora: ${c.printer_name}
Tipo: ${c.printer_type}
Largura: ${c.paper_width}

--- Teste de Texto ---
Este  um teste de impresso.
Fonte: ${c.font_size}pt
Espaamento: ${c.line_spacing}

============================
       DATA/HORA TESTE
    ${new Date().toLocaleString("pt-BR")}
============================
`.trim(),g=f=>{const y=window.open("","_blank"),v=`
      <style>
        @page { 
          margin: ${c.margin_top}mm ${c.margin_right}mm ${c.margin_bottom}mm ${c.margin_left}mm; 
          size: ${c.paper_width==="58mm"?"58mm":c.paper_width==="80mm"?"80mm":"auto"} auto;
        }
        body { 
          font-family: 'Courier New', monospace; 
          font-size: ${c.font_size}pt;
          line-height: ${c.line_spacing};
          white-space: pre-wrap;
        }
      </style>
    `;y.document.write(v+"<pre>"+f+"</pre>"),y.document.close(),setTimeout(()=>{y.print(),c.auto_cut&&y.close()},250)};return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Vi,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Configurao de Impressora"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Configure sua impressora para receitas e comandas"})]})]}),e.jsx(Q,{children:e.jsx(Z,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Status da Configurao"}),e.jsx("p",{className:"text-lg font-bold",children:p?"Configurada":"No Configurada"})]}),p?e.jsx(ot,{className:"w-8 h-8 text-green-500"}):e.jsx(Yt,{className:"w-8 h-8 text-yellow-500"})]})})}),e.jsxs(Q,{children:[e.jsxs(he,{children:[e.jsx(xe,{children:"Configuraes Bsicas"}),e.jsx(xs,{children:"Informaes principais da impressora"})]}),e.jsxs(Z,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome da Impressora *"}),e.jsx(B,{value:c.printer_name,onChange:f=>d({...c,printer_name:f.target.value}),placeholder:"Ex: Epson TM-T20",required:!0,className:c.printer_name?.trim()?"":"border-red-300"}),!c.printer_name?.trim()&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Nome da impressora  obrigatrio"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Tipo de Impressora"}),e.jsxs(Se,{value:c.printer_type,onValueChange:f=>d({...c,printer_type:f}),children:[e.jsx(De,{children:e.jsx(Me,{})}),e.jsxs(Ae,{children:[e.jsx(X,{value:"termica",children:"Trmica"}),e.jsx(X,{value:"laser",children:"Laser"}),e.jsx(X,{value:"jato_tinta",children:"Jato de Tinta"})]})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Tipo de Conexo"}),e.jsxs(Se,{value:c.connection_type,onValueChange:f=>d({...c,connection_type:f}),children:[e.jsx(De,{children:e.jsx(Me,{})}),e.jsxs(Ae,{children:[e.jsx(X,{value:"usb",children:"USB"}),e.jsx(X,{value:"rede",children:"Rede"}),e.jsx(X,{value:"bluetooth",children:"Bluetooth"})]})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Mtodo de Impresso"}),e.jsxs(Se,{value:c.print_method||"css",onValueChange:f=>d({...c,print_method:f}),children:[e.jsx(De,{children:e.jsx(Me,{})}),e.jsxs(Ae,{children:[e.jsx(X,{value:"css",children:"CSS (window.print)"}),e.jsx(X,{value:"escpos",children:"ESC/POS (Web Serial)"}),e.jsx(X,{value:"hybrid",children:"Hbrido (tenta ESC/POS)"})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[c.print_method==="css"&&"Impresso via navegador (padro)",c.print_method==="escpos"&&"Comandos diretos via Web Serial API",c.print_method==="hybrid"&&"Tenta ESC/POS, fallback para CSS"]})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Largura do Papel"}),e.jsxs(Se,{value:c.paper_width,onValueChange:f=>d({...c,paper_width:f}),children:[e.jsx(De,{children:e.jsx(Me,{})}),e.jsxs(Ae,{children:[e.jsx(X,{value:"58mm",children:"58mm"}),e.jsx(X,{value:"80mm",children:"80mm"}),e.jsx(X,{value:"custom",children:"Personalizado"})]})]})]}),e.jsxs("div",{children:[e.jsx(R,{className:"mb-2 block",children:"Margens (mm)"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx(R,{className:"text-xs text-gray-500",children:"Superior"}),e.jsx(B,{type:"number",value:c.margin_top,onChange:f=>d({...c,margin_top:parseFloat(f.target.value)})})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-xs text-gray-500",children:"Inferior"}),e.jsx(B,{type:"number",value:c.margin_bottom,onChange:f=>d({...c,margin_bottom:parseFloat(f.target.value)})})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-xs text-gray-500",children:"Esquerda"}),e.jsx(B,{type:"number",value:c.margin_left,onChange:f=>d({...c,margin_left:parseFloat(f.target.value)})})]}),e.jsxs("div",{children:[e.jsx(R,{className:"text-xs text-gray-500",children:"Direita"}),e.jsx(B,{type:"number",value:c.margin_right,onChange:f=>d({...c,margin_right:parseFloat(f.target.value)})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Espaamento entre Linhas"}),e.jsx(B,{type:"number",step:"0.1",value:c.line_spacing,onChange:f=>d({...c,line_spacing:parseFloat(f.target.value)})})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Tamanho da Fonte (pt)"}),e.jsx(B,{type:"number",value:c.font_size,onChange:f=>d({...c,font_size:parseInt(f.target.value)})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(mt,{checked:c.auto_cut,onCheckedChange:f=>d({...c,auto_cut:f})}),e.jsx(R,{children:"Corte automtico do papel"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(mt,{checked:c.open_drawer,onCheckedChange:f=>d({...c,open_drawer:f})}),e.jsx(R,{children:"Abrir gaveta de dinheiro (se suportado)"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[e.jsxs(A,{onClick:o,className:"flex-1 bg-green-600 hover:bg-green-700",disabled:!p||i.isPending,children:[e.jsx(Hi,{className:"w-4 h-4 mr-2"}),i.isPending?"Salvando...":"Salvar Configurao"]}),e.jsxs(A,{onClick:()=>a(!0),variant:"outline",disabled:!p,children:[e.jsx(Ya,{className:"w-4 h-4 mr-2"}),"Visualizar"]}),e.jsxs(A,{onClick:m,variant:"outline",disabled:!p,children:[e.jsx(nh,{className:"w-4 h-4 mr-2"}),"Testar Impresso"]})]})]})]}),e.jsx(Re,{open:s,onOpenChange:a,children:e.jsxs(Le,{className:"max-w-md",children:[e.jsx(Ie,{children:e.jsx(qe,{children:"Preview da Comanda"})}),e.jsx("div",{className:"bg-white border-2 border-dashed p-4 font-mono text-xs overflow-auto max-h-96",style:{fontSize:`${c.font_size}pt`,lineHeight:c.line_spacing},children:e.jsx("pre",{children:x()})})]})})]})}function Ov(){const[s,a]=b.useState(!1),[t,r]=b.useState(!1),[n,l]=b.useState(!1),[c,d]=b.useState(!1),[i,o]=b.useState(null),[m,p]=b.useState(""),[x,g]=b.useState(""),[f,y]=b.useState({amount:"",reason:""}),[v,P]=b.useState({amount:"",reason:""}),[M,O]=b.useState(""),[E,u]=b.useState("all"),[_,$]=b.useState(""),j=ts(),{menuContext:D}=as(),{requireAuthorization:V,modal:T}=Qo(),{data:N=[]}=ke({queryKey:["caixas",D?.type,D?.value],queryFn:async()=>{if(!D)return[];const G={};return D.type==="subscriber"&&D.value&&(G.as_subscriber=D.value),se.entities.Caixa.list("-opening_date",G)},enabled:!!D}),{data:z=[]}=ke({queryKey:["caixaOperations",D?.type,D?.value],queryFn:async()=>{if(!D)return[];const G={};return D.type==="subscriber"&&D.value&&(G.as_subscriber=D.value),se.entities.CaixaOperation.list("-date",G)},enabled:!!D}),{data:k=[]}=ke({queryKey:["pdvSessions",D?.type,D?.value],queryFn:async()=>{if(!D)return[];const G={ended_at:"null"};return D.type==="subscriber"&&D.value&&(G.as_subscriber=D.value),se.entities.PDVSession.list("-created_at",G).catch(()=>[])},enabled:!!D}),h=Array.isArray(k)?k.filter(G=>!G.ended_at):[],F=de({mutationFn:async G=>{const ne=await se.auth.me();return se.entities.Caixa.create({...G,subscriber_email:ne.subscriber_email||ne.email,owner_email:ne.subscriber_email||ne.email,opened_by:ne.email})},onSuccess:()=>{j.invalidateQueries({queryKey:["caixas"]}),a(!1),p(""),K.success(" Caixa aberto com sucesso!")}}),S=de({mutationFn:async({id:G,freshCaixa:ne,totals:fe,closingCash:ge,closingNotes:Ee,opts:H})=>{const ie=await se.auth.me(),me={...ne,opening_amount_cash:Number(ne.opening_amount_cash)||0,status:"closed",total_cash:fe.cash,total_pix:fe.pix,total_debit:fe.debit,total_credit:fe.credit,total_other:fe.other,closing_amount_cash:Number(ge)||0,closing_notes:Ee||"",closed_by:ie.email,closing_date:new Date().toISOString()};return delete me.id,delete me.created_date,delete me.updated_date,delete me.created_by,se.entities.Caixa.update(G,me,H||{})},onSuccess:()=>{j.invalidateQueries({queryKey:["caixas"]}),r(!1),o(null),g(""),K.success(" Caixa fechado com sucesso!")},onError:G=>{console.error("Erro ao fechar caixa:",G),K.error("Erro ao fechar caixa: "+G.message)}}),q=de({mutationFn:async G=>{const ne=await se.auth.me();return se.entities.CaixaOperation.create({...G,operator:ne.email,date:new Date().toISOString()})},onSuccess:()=>{j.invalidateQueries({queryKey:["caixaOperations"]}),j.invalidateQueries({queryKey:["caixas"]})}}),J=()=>{if(N.filter(ne=>ne.status==="open").length>0){K.error(" J existe um caixa aberto!");return}F.mutate({opening_amount_cash:parseFloat(m)||0,opening_date:new Date().toISOString(),status:"open",total_cash:0,total_pix:0,total_debit:0,total_credit:0,total_other:0,withdrawals:0,supplies:0})},W=async()=>{if(!f.amount||!f.reason){K.error("Preencha todos os campos");return}const G=z.filter(re=>re.caixa_id===i.id),ne=G.filter(re=>re.type==="venda_pdv"),fe=G.filter(re=>re.type==="sangria"),ge=G.filter(re=>re.type==="suprimento"),Ee=ne.filter(re=>re.payment_method==="dinheiro").reduce((re,ds)=>re+ds.amount,0),H=fe.reduce((re,ds)=>re+ds.amount,0),ie=ge.reduce((re,ds)=>re+ds.amount,0),me=(i.opening_amount_cash||0)+Ee+ie-H;if(parseFloat(f.amount)>me){K.error(` Saldo insuficiente! Saldo atual: ${L(me)}`);return}await q.mutateAsync({caixa_id:i.id,type:"sangria",description:`Sangria: ${f.reason}`,amount:parseFloat(f.amount),payment_method:"dinheiro",reason:f.reason});const Je={};D?.type==="subscriber"&&D?.value&&(Je.as_subscriber=D.value);const We=(await se.entities.Caixa.list("-opening_date",Je)).find(re=>re.id===i.id);if(!We){K.error("Caixa no encontrado");return}const U={...We,withdrawals:(We.withdrawals||0)+parseFloat(f.amount)};delete U.id,delete U.created_date,delete U.updated_date,delete U.created_by,await se.entities.Caixa.update(i.id,U,Je),j.invalidateQueries({queryKey:["caixas"]}),l(!1),y({amount:"",reason:""}),K.success(" Sangria registrada")},C=async()=>{if(!v.amount||!v.reason){K.error("Preencha todos os campos");return}await q.mutateAsync({caixa_id:i.id,type:"suprimento",description:`Suprimento: ${v.reason}`,amount:parseFloat(v.amount),payment_method:"dinheiro",reason:v.reason});const G={};D?.type==="subscriber"&&D?.value&&(G.as_subscriber=D.value);const fe=(await se.entities.Caixa.list("-opening_date",G)).find(Ee=>Ee.id===i.id);if(!fe){K.error("Caixa no encontrado");return}const ge={...fe,supplies:(fe.supplies||0)+parseFloat(v.amount)};delete ge.id,delete ge.created_date,delete ge.updated_date,delete ge.created_by,await se.entities.Caixa.update(i.id,ge,G),j.invalidateQueries({queryKey:["caixas"]}),d(!1),P({amount:"",reason:""}),K.success(" Suprimento registrado")},Y=async()=>{if(!i||!_){K.error("Informe o valor em dinheiro fsico para fechamento");return}const G=z.filter(me=>me.caixa_id===i.id&&me.type==="venda_pdv"),ne={cash:G.filter(me=>me.payment_method==="dinheiro").reduce((me,ze)=>me+ze.amount,0),pix:G.filter(me=>me.payment_method==="pix").reduce((me,ze)=>me+ze.amount,0),debit:G.filter(me=>me.payment_method==="debito").reduce((me,ze)=>me+ze.amount,0),credit:G.filter(me=>me.payment_method==="credito").reduce((me,ze)=>me+ze.amount,0),other:G.filter(me=>me.payment_method==="outro").reduce((me,ze)=>me+ze.amount,0)},fe={};D?.type==="subscriber"&&D?.value&&(fe.as_subscriber=D.value);const Ee=(await se.entities.Caixa.list("-opening_date",fe)).find(me=>me.id===i.id);if(!Ee){K.error("Caixa no encontrado");return}const H=(Ee.opening_amount_cash||0)+ne.cash+(Ee.supplies||0)-(Ee.withdrawals||0),ie=parseFloat(_);S.mutate({id:i.id,freshCaixa:Ee,totals:ne,closingCash:ie,closingNotes:x+(ie!==H?`

Diferena: ${L(ie-H)}`:""),opts:fe})},L=G=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(G||0),oe=N.filter(G=>G.status==="open"),Pe=oe[0],ve=N.filter(G=>{const ne=!M||G.id?.toString().includes(M)||ee(G.opening_date).format("DD/MM/YYYY").includes(M),fe=E==="all"||E==="open"&&G.status==="open"||E==="closed"&&G.status==="closed";return ne&&fe});if(i){const G=z.filter(ce=>ce.caixa_id===i.id),ne=G.filter(ce=>ce.type==="venda_pdv"),fe=G.filter(ce=>ce.type==="sangria"),ge=G.filter(ce=>ce.type==="suprimento"),Ee=ne.reduce((ce,We)=>ce+We.amount,0),H=fe.reduce((ce,We)=>ce+We.amount,0),ie=ge.reduce((ce,We)=>ce+We.amount,0),me=ne.filter(ce=>ce.payment_method==="dinheiro").reduce((ce,We)=>ce+We.amount,0),ze=(i.opening_amount_cash||0)+me+ie-H,Je=i.status==="closed";return e.jsxs(e.Fragment,{children:[e.jsx(Hr,{position:"top-center"}),e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(A,{variant:"ghost",onClick:()=>o(null),children:[e.jsx(Au,{className:"w-4 h-4 mr-2"}),"Voltar"]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Detalhes do Caixa"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Aberto em ",ee(i.opening_date).format("DD/MM/YYYY HH:mm"),i.opened_by&&e.jsxs(e.Fragment,{children:[" por ",i.opened_by]})]}),Je&&i.closed_by&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Fechado por: ",i.closed_by]})]})]}),e.jsx(ye,{className:Je?"bg-gray-500":"bg-green-500",children:Je?" Fechado":" Aberto"})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs(Q,{children:[e.jsx(he,{className:"pb-3",children:e.jsx(xe,{className:"text-sm text-gray-600",children:" Dinheiro"})}),e.jsx(Z,{children:e.jsx("p",{className:"text-2xl font-bold",children:L(me)})})]}),e.jsxs(Q,{children:[e.jsx(he,{className:"pb-3",children:e.jsx(xe,{className:"text-sm text-gray-600",children:" PIX"})}),e.jsx(Z,{children:e.jsx("p",{className:"text-2xl font-bold",children:L(ne.filter(ce=>ce.payment_method==="pix").reduce((ce,We)=>ce+We.amount,0))})})]}),e.jsxs(Q,{children:[e.jsx(he,{className:"pb-3",children:e.jsx(xe,{className:"text-sm text-gray-600",children:" Dbito"})}),e.jsx(Z,{children:e.jsx("p",{className:"text-2xl font-bold",children:L(ne.filter(ce=>ce.payment_method==="debito").reduce((ce,We)=>ce+We.amount,0))})})]}),e.jsxs(Q,{children:[e.jsx(he,{className:"pb-3",children:e.jsx(xe,{className:"text-sm text-gray-600",children:" Crdito"})}),e.jsx(Z,{children:e.jsx("p",{className:"text-2xl font-bold",children:L(ne.filter(ce=>ce.payment_method==="credito").reduce((ce,We)=>ce+We.amount,0))})})]}),e.jsxs(Q,{children:[e.jsx(he,{className:"pb-3",children:e.jsx(xe,{className:"text-sm text-gray-600",children:" Outros"})}),e.jsx(Z,{children:e.jsx("p",{className:"text-2xl font-bold",children:L(ne.filter(ce=>ce.payment_method==="outro").reduce((ce,We)=>ce+We.amount,0))})})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs(Q,{className:"lg:col-span-2",children:[e.jsx(he,{children:e.jsx(xe,{children:"Controle de Dinheiro Fsico"})}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Fundo Inicial"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:L(i.opening_amount_cash)})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Vendas em Dinheiro"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:L(me)})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Suprimentos"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-600",children:["+",L(ie)]})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Sangrias"}),e.jsxs("p",{className:"text-2xl font-bold text-red-600",children:["-",L(H)]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-green-500 to-green-600 p-6 rounded-xl text-white",children:[e.jsx("p",{className:"text-sm opacity-90 mb-2",children:" Saldo Atual em Dinheiro"}),e.jsx("p",{className:"text-4xl font-bold",children:L(ze)})]}),!Je&&e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(A,{onClick:()=>V("suprimento",()=>d(!0)),className:"bg-orange-500 hover:bg-orange-600 h-12",children:[e.jsx($s,{className:"w-4 h-4 mr-2"}),"Suprimento"]}),e.jsxs(A,{onClick:()=>V("sangria",()=>l(!0)),className:"bg-red-500 hover:bg-red-600 h-12",children:[e.jsx(Hl,{className:"w-4 h-4 mr-2"}),"Sangria"]})]})]})]}),e.jsxs(Q,{children:[e.jsx(he,{children:e.jsx(xe,{children:"Total de Vendas"})}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"text-center py-6",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Total Geral"}),e.jsx("p",{className:"text-4xl font-bold text-green-600",children:L(Ee)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[ne.length," vendas registradas"]})]}),!Je&&e.jsx(A,{onClick:()=>V("fechar_caixa",()=>r(!0)),className:"w-full bg-gray-900 hover:bg-gray-800 h-14 text-lg",children:" Fechar Caixa"})]})]})]}),e.jsxs(Q,{children:[e.jsx(he,{children:e.jsx(xe,{children:"Histrico de Movimentaes"})}),e.jsx(Z,{children:G.length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Nenhuma movimentao registrada"}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:G.map(ce=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[ce.type==="venda_pdv"&&e.jsx(Yu,{className:"w-5 h-5 text-green-600"}),ce.type==="sangria"&&e.jsx(Hl,{className:"w-5 h-5 text-red-600"}),ce.type==="suprimento"&&e.jsx($s,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:ce.description}),e.jsxs("p",{className:"text-xs text-gray-500",children:[ee(ce.date).format("DD/MM HH:mm"),ce.operator&&e.jsxs(e.Fragment,{children:["  Operador: ",ce.operator]})]}),ce.type==="venda_pdv"&&e.jsxs("div",{className:"text-xs text-gray-600 mt-1 space-y-0.5",children:[e.jsxs("div",{children:[" ",ce.payment_method]}),ce.payment_amount&&e.jsxs("div",{children:[" Recebido: ",L(ce.payment_amount)]}),ce.change>0&&e.jsxs("div",{children:[" Troco: ",L(ce.change)]})]})]})]}),e.jsxs("span",{className:`font-bold ${ce.type==="sangria"?"text-red-600":"text-green-600"}`,children:[ce.type==="sangria"?"-":"+",L(ce.amount)]})]},ce.id))})})]})]}),e.jsx(Re,{open:t,onOpenChange:ce=>{r(ce),ce||($(""),g(""))},children:e.jsxs(Le,{children:[e.jsx(Ie,{children:e.jsx(qe,{children:"Confirmar Fechamento do Caixa"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 p-4 rounded-lg",children:e.jsx("p",{className:"text-sm text-yellow-800",children:" Aps o fechamento, o caixa no poder ser editado"})}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total em Vendas"}),e.jsx("span",{className:"font-bold",children:L(Ee)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Saldo Esperado em Dinheiro"}),e.jsx("span",{className:"font-bold text-blue-600",children:L(ze)})]})]}),e.jsxs("div",{children:[e.jsx(R,{className:"font-semibold",children:"Valor Real em Dinheiro Fsico (R$) *"}),e.jsx(B,{type:"number",step:"0.01",value:_,onChange:ce=>$(ce.target.value),placeholder:"0,00",className:"text-xl font-bold h-14 text-center border-2",autoFocus:!0}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Informe o valor fsico contado no caixa"}),_&&parseFloat(_)!==ze&&e.jsx("div",{className:`mt-2 p-3 rounded-lg ${parseFloat(_)>ze?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:e.jsxs("p",{className:`text-sm font-semibold ${parseFloat(_)>ze?"text-green-800":"text-red-800"}`,children:[parseFloat(_)>ze?"":""," Diferena: ",L(Math.abs(parseFloat(_)-ze)),parseFloat(_)>ze?" (Sobra)":" (Falta)"]})})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Observaes (opcional)"}),e.jsx(Os,{value:x,onChange:ce=>g(ce.target.value),placeholder:"Adicione observaes sobre o fechamento...",rows:3})]})]}),e.jsxs(Qs,{children:[e.jsx(A,{variant:"outline",onClick:()=>{r(!1),$(""),g("")},children:"Cancelar"}),e.jsx(A,{onClick:Y,disabled:!_,className:"bg-gray-900",children:"Confirmar Fechamento"})]})]})}),e.jsx(Re,{open:n,onOpenChange:l,children:e.jsxs(Le,{children:[e.jsx(Ie,{children:e.jsx(qe,{children:"Registrar Sangria"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Valor (R$)"}),e.jsx(B,{type:"number",step:"0.01",value:f.amount,onChange:ce=>y({...f,amount:ce.target.value}),placeholder:"0,00",className:"text-lg font-semibold"}),f.amount&&i&&(()=>{const ce=z.filter(Ge=>Ge.caixa_id===i.id),We=ce.filter(Ge=>Ge.type==="venda_pdv"),U=ce.filter(Ge=>Ge.type==="sangria"),re=ce.filter(Ge=>Ge.type==="suprimento"),ds=We.filter(Ge=>Ge.payment_method==="dinheiro").reduce((Ge,we)=>Ge+we.amount,0),ta=U.reduce((Ge,we)=>Ge+we.amount,0),ra=re.reduce((Ge,we)=>Ge+we.amount,0),ls=(i.opening_amount_cash||0)+ds+ra-ta,bs=parseFloat(f.amount)<=ls;return e.jsxs("div",{className:`mt-2 p-2 rounded text-xs ${bs?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:["Saldo disponvel: ",L(ls),!bs&&e.jsx("span",{className:"block font-semibold mt-1",children:" Valor excede o saldo disponvel!"})]})})()]}),e.jsxs("div",{children:[e.jsx(R,{children:"Motivo"}),e.jsx(B,{value:f.reason,onChange:ce=>y({...f,reason:ce.target.value}),placeholder:"Ex: Depsito bancrio, pagamento fornecedor..."})]})]}),e.jsxs(Qs,{children:[e.jsx(A,{variant:"outline",onClick:()=>l(!1),children:"Cancelar"}),e.jsx(A,{onClick:W,className:"bg-red-600",children:"Registrar Sangria"})]})]})}),e.jsx(Re,{open:c,onOpenChange:d,children:e.jsxs(Le,{children:[e.jsx(Ie,{children:e.jsx(qe,{children:"Registrar Suprimento"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Valor (R$)"}),e.jsx(B,{type:"number",step:"0.01",value:v.amount,onChange:ce=>P({...v,amount:ce.target.value}),placeholder:"0,00"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Motivo"}),e.jsx(B,{value:v.reason,onChange:ce=>P({...v,reason:ce.target.value}),placeholder:"Ex: Fundo adicional, reforo de caixa..."})]})]}),e.jsxs(Qs,{children:[e.jsx(A,{variant:"outline",onClick:()=>d(!1),children:"Cancelar"}),e.jsx(A,{onClick:C,className:"bg-orange-600",children:"Registrar Suprimento"})]})]})})]})}return e.jsxs(e.Fragment,{children:[e.jsx(Hr,{position:"top-center"}),e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:" Controle de Caixa"}),e.jsx("p",{className:"text-gray-600",children:"Gerencie abertura, fechamento e movimentaes dirias"})]}),e.jsxs(A,{onClick:()=>V("abrir_caixa",()=>a(!0)),disabled:oe.length>0,className:"bg-green-600 hover:bg-green-700 h-12",children:[e.jsx(ma,{className:"w-5 h-5 mr-2"}),"Abrir Caixa"]})]}),e.jsxs(Q,{children:[e.jsxs(he,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Ko,{className:"w-5 h-5"}),"Sesses PDV ativas"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Colaboradores logados em cada terminal PDV"})]}),e.jsx(Z,{children:h.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"Nenhuma sesso PDV ativa no momento."}):e.jsx("ul",{className:"space-y-2",children:h.map(G=>e.jsxs("li",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-0",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:G.terminal_name||G.terminal_id||"PDV"}),e.jsxs("span",{className:"text-gray-600 text-sm ml-2",children:[" ",G.operator_name||G.operator_email||"Operador"]})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["desde ",G.started_at?ee(G.started_at).format("DD/MM HH:mm"):"-"]})]},G.id))})})]}),oe.length>0&&e.jsx(Q,{className:"border-green-500 border-2 bg-green-50",children:e.jsx(Z,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-green-500 rounded-full flex items-center justify-center",children:e.jsx($a,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx(ye,{className:"bg-green-500 mb-2",children:" Caixa Aberto"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Aberto em ",ee(Pe.opening_date).format("DD/MM/YYYY HH:mm"),Pe.opened_by&&e.jsxs(e.Fragment,{children:[" por ",Pe.opened_by]})]}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["Fundo Inicial: ",L(Pe.opening_amount_cash)]})]})]}),e.jsxs(A,{onClick:()=>o(Pe),size:"lg",children:["Gerenciar Caixa",e.jsx(Do,{className:"w-4 h-4 ml-2"})]})]})})}),oe.length===0&&e.jsx(Q,{className:"border-gray-300 border-dashed border-2",children:e.jsxs(Z,{className:"p-12 text-center",children:[e.jsx(Fm,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-gray-600 mb-2",children:"Nenhum caixa aberto"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"Abra um caixa para comear a registrar vendas"})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Ms,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(B,{placeholder:"Buscar por data ou ID...",value:M,onChange:G=>O(G.target.value),className:"pl-10"})]}),e.jsxs(Se,{value:E,onValueChange:u,children:[e.jsxs(De,{className:"w-[180px]",children:[e.jsx(ua,{className:"w-4 h-4 mr-2"}),e.jsx(Me,{})]}),e.jsxs(Ae,{children:[e.jsx(X,{value:"all",children:"Todos"}),e.jsx(X,{value:"open",children:"Abertos"}),e.jsx(X,{value:"closed",children:"Fechados"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:" Histrico de Caixas"}),ve.filter(G=>G.status==="closed").length===0?e.jsx(Q,{children:e.jsx(Z,{className:"p-8 text-center text-gray-500",children:"Nenhum caixa fechado ainda"})}):e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:ve.filter(G=>G.status==="closed").slice(0,12).map(G=>e.jsx(Q,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>o(G),children:e.jsxs(Z,{className:"p-4",children:[e.jsx(ye,{className:"bg-gray-500 mb-3",children:" Fechado"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:ee(G.opening_date).format("DD/MM/YYYY")}),(G.opened_by||G.closed_by)&&e.jsxs("p",{className:"text-xs text-gray-500 mb-2",children:[G.opened_by&&e.jsxs(e.Fragment,{children:["Aberto por: ",G.opened_by]}),G.opened_by&&G.closed_by&&"  ",G.closed_by&&e.jsxs(e.Fragment,{children:["Fechado por: ",G.closed_by]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Vendas"}),e.jsx("span",{className:"font-bold",children:L((G.total_cash||0)+(G.total_pix||0)+(G.total_debit||0)+(G.total_credit||0)+(G.total_other||0))})]}),e.jsxs("div",{className:"flex justify-between text-sm pt-2 border-t",children:[e.jsx("span",{className:"font-medium",children:"Fechamento"}),e.jsx("span",{className:"font-bold text-green-600",children:L(G.closing_amount_cash)})]})]})]})},G.id))})]}),e.jsx(Re,{open:s,onOpenChange:a,children:e.jsxs(Le,{children:[e.jsx(Ie,{children:e.jsx(qe,{children:"Abrir Novo Caixa"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 p-4 rounded-lg",children:e.jsx("p",{className:"text-sm text-blue-800",children:" Informe o valor em dinheiro fsico que voc est colocando no caixa para comear o dia"})}),e.jsxs("div",{children:[e.jsx(R,{children:"Fundo de Caixa Inicial (R$)"}),e.jsx(B,{type:"number",step:"0.01",value:m,onChange:G=>p(G.target.value),placeholder:"0,00",className:"text-xl font-bold h-14",autoFocus:!0})]})]}),e.jsxs(Qs,{children:[e.jsx(A,{variant:"outline",onClick:()=>a(!1),children:"Cancelar"}),e.jsx(A,{onClick:J,disabled:!m,className:"bg-green-600",children:"Abrir Caixa"})]})]})})]}),T]})}function zv(){const[s,a]=b.useState("config"),[t,r]=b.useState(()=>{const i=localStorage.getItem("whatsapp_templates");return i?JSON.parse(i):[{id:1,name:"Pedido Confirmado",message:"Ol! Seu pedido foi confirmado e est sendo preparado. "},{id:2,name:"Pedido Pronto",message:"Seu pedido est pronto para retirada! "},{id:3,name:"Pedido em Rota",message:"Seu pedido saiu para entrega! "}]}),[n,l]=b.useState(null),[c,d]=b.useState({name:"",message:""});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"WhatsApp"}),e.jsx("p",{className:"text-gray-600",children:"Configuraes de notificaes e automao"})]}),e.jsxs("div",{className:"flex gap-2 border-b",children:[e.jsx("button",{onClick:()=>a("config"),className:`px-4 py-2 font-medium border-b-2 transition-colors ${s==="config"?"border-red-500 text-red-500":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"CONFIGURAO E PLANO"}),e.jsx("button",{onClick:()=>a("notifications"),className:`px-4 py-2 font-medium border-b-2 transition-colors ${s==="notifications"?"border-red-500 text-red-500":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"NOTIFICAES"}),e.jsx("button",{onClick:()=>a("auto"),className:`px-4 py-2 font-medium border-b-2 transition-colors ${s==="auto"?"border-red-500 text-red-500":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"RESPOSTA AUTOMTICA"}),e.jsx("button",{onClick:()=>a("summary"),className:`px-4 py-2 font-medium border-b-2 transition-colors ${s==="summary"?"border-red-500 text-red-500":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"RESUMO DIRIO E SEMANAL"})]}),s==="config"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(Q,{className:"bg-green-50 border-green-200",children:e.jsx(Z,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-green-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(Kl,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Pedido de Teste"}),e.jsx("p",{className:"text-gray-700 mb-4",children:"Quer receber uma notificao para testar? Faa um pedido de teste e receba as notificaes no teu celular."}),e.jsxs(A,{className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(Kl,{className:"w-4 h-4 mr-2"}),"PEDIDO DE TESTE"]})]})]})})}),e.jsxs(Q,{children:[e.jsx(he,{className:"bg-gradient-to-r from-yellow-400 to-orange-500 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ul,{className:"w-8 h-8"}),e.jsxs("div",{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:["Plano BeeBot",e.jsx(ye,{className:"bg-yellow-300 text-yellow-900",children:"WhatsApp Web Integrado"})]}),e.jsx("p",{className:"text-sm opacity-90 mt-1",children:"Envio de Notificaes e Resposta Automtica"})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fs,{className:"w-5 h-5"}),e.jsx(Fs,{className:"w-5 h-5"}),e.jsx(Fs,{className:"w-5 h-5"})]})})]})}),e.jsxs(Z,{className:"p-6",children:[e.jsxs("ul",{className:"space-y-3",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Fs,{className:"w-5 h-5 text-yellow-500 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Envio de Notificaes Automticas."})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Fs,{className:"w-5 h-5 text-yellow-500 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"As mensagens so enviadas por um nmero prprio."})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Fs,{className:"w-5 h-5 text-yellow-500 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:" possvel tambm responder os clientes atravs de um Chat."})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Fs,{className:"w-5 h-5 text-yellow-500 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Auto atendimento com todas informaes para o cliente."})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Fs,{className:"w-5 h-5 text-yellow-500 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Sinaliza quando uma conversa precisa de ateno."})]})]}),e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsxs(A,{className:"w-full bg-red-500 hover:bg-red-600 text-white",children:[e.jsx(qi,{className:"w-4 h-4 mr-2"}),"ACESSAR BEEBOT"]}),e.jsxs(A,{variant:"outline",className:"w-full",children:[e.jsx(Vl,{className:"w-4 h-4 mr-2"}),"MANUAL DE AJUDA"]})]})]})]})]}),s==="notifications"&&e.jsx("div",{className:"space-y-4",children:e.jsxs(Q,{children:[e.jsx(he,{children:e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(Pu,{className:"w-5 h-5"}),"Templates de Mensagens"]})}),e.jsxs(Z,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3",children:t.map(i=>e.jsx(Q,{className:"border-l-4 border-l-green-500",children:e.jsx(Z,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold mb-1",children:i.name}),e.jsx("p",{className:"text-sm text-gray-600 whitespace-pre-wrap",children:i.message})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>{const o=prompt("Digite o nmero do WhatsApp (apenas nmeros):");o&&(du.sendToWhatsApp(o,i.message),K.success("Abrindo WhatsApp..."))},children:e.jsx(qm,{className:"w-4 h-4"})}),e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>{navigator.clipboard.writeText(i.message),K.success("Mensagem copiada!")},children:e.jsx(Js,{className:"w-4 h-4"})}),e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>l(i),children:e.jsx(vn,{className:"w-4 h-4"})}),e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>{const o=t.filter(m=>m.id!==i.id);r(o),localStorage.setItem("whatsapp_templates",JSON.stringify(o)),K.success("Template removido")},children:e.jsx(Xe,{className:"w-4 h-4 text-red-500"})})]})]})})},i.id))}),!n&&e.jsx(Q,{className:"border-dashed",children:e.jsxs(Z,{className:"p-4",children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Adicionar Novo Template"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome do Template"}),e.jsx(B,{value:c.name,onChange:i=>d({...c,name:i.target.value}),placeholder:"Ex: Pedido Confirmado"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Mensagem"}),e.jsx(Os,{value:c.message,onChange:i=>d({...c,message:i.target.value}),placeholder:"Digite a mensagem do template...",rows:4})]}),e.jsxs(A,{onClick:()=>{if(!c.name||!c.message){K.error("Preencha todos os campos");return}const i=[...t,{id:Date.now(),...c}];r(i),localStorage.setItem("whatsapp_templates",JSON.stringify(i)),d({name:"",message:""}),K.success("Template adicionado!")},className:"w-full",children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Adicionar Template"]})]})]})}),n&&e.jsx(Q,{className:"border-2 border-blue-500",children:e.jsxs(Z,{className:"p-4",children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Editar Template"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome do Template"}),e.jsx(B,{value:n.name,onChange:i=>l({...n,name:i.target.value})})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Mensagem"}),e.jsx(Os,{value:n.message,onChange:i=>l({...n,message:i.target.value}),rows:4})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{onClick:()=>{const i=t.map(o=>o.id===n.id?n:o);r(i),localStorage.setItem("whatsapp_templates",JSON.stringify(i)),l(null),K.success("Template atualizado!")},className:"flex-1",children:"Salvar"}),e.jsx(A,{variant:"outline",onClick:()=>l(null),className:"flex-1",children:"Cancelar"})]})]})]})})]})]})}),s==="auto"&&e.jsx(Q,{children:e.jsxs(Z,{className:"p-12 text-center",children:[e.jsx(Ul,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-600 mb-2",children:"Resposta Automtica"}),e.jsx("p",{className:"text-gray-400",children:"Configure respostas automticas para seus clientes"})]})}),s==="summary"&&e.jsx(Q,{children:e.jsxs(Z,{className:"p-12 text-center",children:[e.jsx(Vl,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-600 mb-2",children:"Resumo Dirio"}),e.jsx("p",{className:"text-gray-400",children:"Receba resumos automticos de suas vendas"})]})})]})}function dj(s,a=[]){let t=[];function r(l,c){const d=b.createContext(c);d.displayName=l+"Context";const i=t.length;t=[...t,c];const o=p=>{const{scope:x,children:g,...f}=p,y=x?.[s]?.[i]||d,v=b.useMemo(()=>f,Object.values(f));return e.jsx(y.Provider,{value:v,children:g})};o.displayName=l+"Provider";function m(p,x){const g=x?.[s]?.[i]||d,f=b.useContext(g);if(f)return f;if(c!==void 0)return c;throw new Error(`\`${p}\` must be used within \`${l}\``)}return[o,m]}const n=()=>{const l=t.map(c=>b.createContext(c));return function(d){const i=d?.[s]||l;return b.useMemo(()=>({[`__scope${s}`]:{...d,[s]:i}}),[d,i])}};return n.scopeName=s,[r,mj(n,...a)]}function mj(...s){const a=s[0];if(s.length===1)return a;const t=()=>{const r=s.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(l){const c=r.reduce((d,{useScope:i,scopeName:o})=>{const p=i(l)[`__scope${o}`];return{...d,...p}},{});return b.useMemo(()=>({[`__scope${a.scopeName}`]:c}),[c])}};return t.scopeName=a.scopeName,t}var uj=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Cl=uj.reduce((s,a)=>{const t=Rm(`Primitive.${a}`),r=b.forwardRef((n,l)=>{const{asChild:c,...d}=n,i=c?t:a;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(i,{...d,ref:l})});return r.displayName=`Primitive.${a}`,{...s,[a]:r}},{}),gi={exports:{}},fi={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wo;function hj(){if(wo)return fi;wo=1;var s=Lm();function a(p,x){return p===x&&(p!==0||1/p===1/x)||p!==p&&x!==x}var t=typeof Object.is=="function"?Object.is:a,r=s.useState,n=s.useEffect,l=s.useLayoutEffect,c=s.useDebugValue;function d(p,x){var g=x(),f=r({inst:{value:g,getSnapshot:x}}),y=f[0].inst,v=f[1];return l(function(){y.value=g,y.getSnapshot=x,i(y)&&v({inst:y})},[p,g,x]),n(function(){return i(y)&&v({inst:y}),p(function(){i(y)&&v({inst:y})})},[p]),c(g),g}function i(p){var x=p.getSnapshot;p=p.value;try{var g=x();return!t(p,g)}catch{return!0}}function o(p,x){return x()}var m=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?o:d;return fi.useSyncExternalStore=s.useSyncExternalStore!==void 0?s.useSyncExternalStore:m,fi}var _o;function xj(){return _o||(_o=1,gi.exports=hj()),gi.exports}var pj=xj();function gj(){return pj.useSyncExternalStore(fj,()=>!0,()=>!1)}function fj(){return()=>{}}var kl="Avatar",[jj]=dj(kl),[yj,Dd]=jj(kl),Md=b.forwardRef((s,a)=>{const{__scopeAvatar:t,...r}=s,[n,l]=b.useState("idle");return e.jsx(yj,{scope:t,imageLoadingStatus:n,onImageLoadingStatusChange:l,children:e.jsx(Cl.span,{...r,ref:a})})});Md.displayName=kl;var Ad="AvatarImage",Pd=b.forwardRef((s,a)=>{const{__scopeAvatar:t,src:r,onLoadingStatusChange:n=()=>{},...l}=s,c=Dd(Ad,t),d=vj(r,l),i=pu(o=>{n(o),c.onImageLoadingStatusChange(o)});return Jr(()=>{d!=="idle"&&i(d)},[d,i]),d==="loaded"?e.jsx(Cl.img,{...l,ref:a,src:r}):null});Pd.displayName=Ad;var Ed="AvatarFallback",Od=b.forwardRef((s,a)=>{const{__scopeAvatar:t,delayMs:r,...n}=s,l=Dd(Ed,t),[c,d]=b.useState(r===void 0);return b.useEffect(()=>{if(r!==void 0){const i=window.setTimeout(()=>d(!0),r);return()=>window.clearTimeout(i)}},[r]),c&&l.imageLoadingStatus!=="loaded"?e.jsx(Cl.span,{...n,ref:a}):null});Od.displayName=Ed;function Co(s,a){return s?a?(s.src!==a&&(s.src=a),s.complete&&s.naturalWidth>0?"loaded":"loading"):"error":"idle"}function vj(s,{referrerPolicy:a,crossOrigin:t}){const r=gj(),n=b.useRef(null),l=r?(n.current||(n.current=new window.Image),n.current):null,[c,d]=b.useState(()=>Co(l,s));return Jr(()=>{d(Co(l,s))},[l,s]),Jr(()=>{const i=p=>()=>{d(p)};if(!l)return;const o=i("loaded"),m=i("error");return l.addEventListener("load",o),l.addEventListener("error",m),a&&(l.referrerPolicy=a),typeof t=="string"&&(l.crossOrigin=t),()=>{l.removeEventListener("load",o),l.removeEventListener("error",m)}},[l,t,a]),c}var zd=Md,Td=Pd,Fd=Od;const Rd=b.forwardRef(({className:s,...a},t)=>e.jsx(zd,{ref:t,className:Ze("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...a}));Rd.displayName=zd.displayName;const Ld=b.forwardRef(({className:s,...a},t)=>e.jsx(Td,{ref:t,className:Ze("aspect-square h-full w-full",s),...a}));Ld.displayName=Td.displayName;const Id=b.forwardRef(({className:s,...a},t)=>e.jsx(Fd,{ref:t,className:Ze("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...a}));Id.displayName=Fd.displayName;const bj={entregador:"Entregador",cozinha:"Cozinha",pdv:"PDV",garcom:"Garom"},Nj={entregador:ac,cozinha:Gi,pdv:$t,garcom:Ia};function wj({colaboradorEmail:s,onClose:a,onEdit:t}){const[r,n]=b.useState(null),[l,c]=b.useState(!0),{data:d=[]}=ke({queryKey:["colaboradores"],queryFn:()=>_e.get("/colaboradores").then(p=>Array.isArray(p)?p:p.data||[])}),i=d.find(p=>(p.email||"").toLowerCase().trim()===(s||"").toLowerCase().trim());if(b.useEffect(()=>{if(!s)return;(async()=>{c(!0);try{const[x,g]=await Promise.all([_e.entities.Order.list("-created_date").catch(()=>[]),_e.entities.Comanda.list("-created_at").catch(()=>[])]),f=s.toLowerCase().trim(),y=Array.isArray(x)?x.filter(j=>j.entregador_email?.toLowerCase().trim()===f||j.entregador_id):[],v=y.filter(j=>j.status==="delivered"||j.status==="out_for_delivery").length,P=y.filter(j=>j.status==="cancelled"&&j.cancelled_by?.toLowerCase().trim()===f).length,M=y.filter(j=>{const D=new Date().toDateString(),V=j.created_date||j.created_at;return V&&new Date(V).toDateString()===D}).length,O=Array.isArray(g)?g.filter(j=>j.created_by?.toLowerCase().trim()===f||j.closed_by?.toLowerCase().trim()===f):[],E=O.filter(j=>j.created_by?.toLowerCase().trim()===f).length,u=O.filter(j=>(Array.isArray(j.history)?j.history:[]).some(V=>V.by?.toLowerCase().trim()===f&&V.action==="updated")).length,_=O.filter(j=>j.status==="closed"&&j.closed_by?.toLowerCase().trim()===f).length,$=new Set(O.filter(j=>j.table_id||j.table_name).map(j=>j.table_id||j.table_name)).size;n({entregador:{totalEntregas:y.length,entregasAceitas:v,entregasCanceladas:P,entregasHoje:M,taxaSucesso:y.length>0?Math.round(v/y.length*100):0},garcom:{totalComandas:O.length,comandasCriadas:E,comandasEditadas:u,comandasFinalizadas:_,mesasGerenciadas:$}})}catch(x){console.error("Erro ao carregar estatsticas:",x)}finally{c(!1)}})()},[s]),!i)return e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(sr,{className:"w-8 h-8 animate-spin text-orange-500"})});const o=i.profile_roles||[i.profile_role].filter(Boolean),m=i.photo||i.google_photo;return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Q,{children:e.jsx(Z,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start gap-6",children:[e.jsxs(Rd,{className:"w-32 h-32 border-4 border-orange-500",children:[e.jsx(Ld,{src:m,alt:i.full_name}),e.jsx(Id,{className:"bg-gradient-to-br from-orange-400 to-orange-600 text-white text-4xl",children:i.full_name?.charAt(0)?.toUpperCase()||"U"})]}),e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:i.full_name||i.email}),e.jsx("div",{className:"flex flex-wrap items-center gap-2 justify-center md:justify-start mb-4",children:o.map(p=>{const x=Nj[p]||Eu;return e.jsxs(ye,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(x,{className:"w-3 h-3"}),bj[p]||p]},p)})}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-2 justify-center md:justify-start",children:[e.jsx(ec,{className:"w-4 h-4"}),e.jsx("span",{children:i.email})]}),i.phone&&e.jsxs("div",{className:"flex items-center gap-2 justify-center md:justify-start",children:[e.jsx(Ja,{className:"w-4 h-4"}),e.jsx("span",{children:i.phone})]}),i.address&&e.jsxs("div",{className:"flex items-center gap-2 justify-center md:justify-start",children:[e.jsx(za,{className:"w-4 h-4"}),e.jsxs("span",{children:[i.address,i.city?`, ${i.city}`:""]})]}),i.created_at&&e.jsxs("div",{className:"flex items-center gap-2 justify-center md:justify-start",children:[e.jsx(Rt,{className:"w-4 h-4"}),e.jsxs("span",{children:["Membro desde ",Et(new Date(i.created_at),"dd 'de' MMMM 'de' yyyy",{locale:bi})]})]})]})]}),t&&e.jsxs(A,{onClick:t,variant:"outline",size:"sm",children:[e.jsx(Lt,{className:"w-4 h-4 mr-2"}),"Editar"]})]})})}),l?e.jsx(Q,{children:e.jsxs(Z,{className:"p-8 text-center",children:[e.jsx(sr,{className:"w-8 h-8 animate-spin text-orange-500 mx-auto"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-2",children:"Carregando estatsticas..."})]})}):r&&e.jsxs(Ui,{defaultValue:o.includes("entregador")?"entregador":o[0]||"geral",children:[e.jsxs(Bi,{className:"grid w-full grid-cols-3",children:[o.includes("entregador")&&e.jsx(la,{value:"entregador",children:"Entregador"}),o.includes("garcom")&&e.jsx(la,{value:"garcom",children:"Garom"}),e.jsx(la,{value:"geral",children:"Geral"})]}),o.includes("entregador")&&e.jsxs(oa,{value:"entregador",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Q,{children:e.jsxs(Z,{className:"p-4 text-center",children:[e.jsx(Ss,{className:"w-8 h-8 text-blue-500 mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold",children:r.entregador.totalEntregas}),e.jsx("div",{className:"text-xs text-gray-500",children:"Total de Entregas"})]})}),e.jsx(Q,{children:e.jsxs(Z,{className:"p-4 text-center",children:[e.jsx(ma,{className:"w-8 h-8 text-green-500 mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold",children:r.entregador.entregasAceitas}),e.jsx("div",{className:"text-xs text-gray-500",children:"Aceitas"})]})}),e.jsx(Q,{children:e.jsxs(Z,{className:"p-4 text-center",children:[e.jsx(Xa,{className:"w-8 h-8 text-red-500 mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold",children:r.entregador.entregasCanceladas}),e.jsx("div",{className:"text-xs text-gray-500",children:"Canceladas"})]})}),e.jsx(Q,{children:e.jsxs(Z,{className:"p-4 text-center",children:[e.jsx($s,{className:"w-8 h-8 text-orange-500 mx-auto mb-2"}),e.jsxs("div",{className:"text-2xl font-bold",children:[r.entregador.taxaSucesso,"%"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Taxa de Sucesso"})]})})]}),e.jsxs(Q,{children:[e.jsx(he,{children:e.jsx(xe,{className:"text-lg",children:"Entregas de Hoje"})}),e.jsx(Z,{children:e.jsx("div",{className:"text-3xl font-bold text-orange-600",children:r.entregador.entregasHoje})})]})]}),o.includes("garcom")&&e.jsxs(oa,{value:"garcom",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Q,{children:e.jsxs(Z,{className:"p-4 text-center",children:[e.jsx(Ia,{className:"w-8 h-8 text-indigo-500 mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold",children:r.garcom.totalComandas}),e.jsx("div",{className:"text-xs text-gray-500",children:"Total de Comandas"})]})}),e.jsx(Q,{children:e.jsxs(Z,{className:"p-4 text-center",children:[e.jsx(na,{className:"w-8 h-8 text-green-500 mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold",children:r.garcom.comandasCriadas}),e.jsx("div",{className:"text-xs text-gray-500",children:"Criadas"})]})}),e.jsx(Q,{children:e.jsxs(Z,{className:"p-4 text-center",children:[e.jsx(Lt,{className:"w-8 h-8 text-blue-500 mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold",children:r.garcom.comandasEditadas}),e.jsx("div",{className:"text-xs text-gray-500",children:"Editadas"})]})}),e.jsx(Q,{children:e.jsxs(Z,{className:"p-4 text-center",children:[e.jsx(ma,{className:"w-8 h-8 text-orange-500 mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold",children:r.garcom.comandasFinalizadas}),e.jsx("div",{className:"text-xs text-gray-500",children:"Finalizadas"})]})})]}),e.jsxs(Q,{children:[e.jsx(he,{children:e.jsx(xe,{className:"text-lg",children:"Mesas Gerenciadas"})}),e.jsx(Z,{children:e.jsx("div",{className:"text-3xl font-bold text-indigo-600",children:r.garcom.mesasGerenciadas})})]})]}),e.jsx(oa,{value:"geral",className:"space-y-4",children:e.jsxs(Q,{children:[e.jsx(he,{children:e.jsx(xe,{className:"text-lg",children:"Informaes do Perfil"})}),e.jsxs(Z,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Email:"}),e.jsx("span",{className:"font-medium",children:i.email})]}),i.phone&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Telefone:"}),e.jsx("span",{className:"font-medium",children:i.phone})]}),i.document&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"CPF/CNPJ:"}),e.jsx("span",{className:"font-medium",children:i.document})]}),i.birth_date&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Data de Nascimento:"}),e.jsx("span",{className:"font-medium",children:Et(new Date(i.birth_date),"dd/MM/yyyy",{locale:bi})})]}),i.address&&e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Endereo:"}),e.jsxs("span",{className:"font-medium text-right max-w-xs",children:[i.address,i.city&&`, ${i.city}`,i.state&&` - ${i.state}`]})]})]})]})})]})]})}const Ir={entregador:"Entregador",cozinha:"Cozinha",pdv:"PDV",garcom:"Garom",gerente:"Gerente"},ji={entregador:ac,cozinha:Gi,pdv:$t,garcom:Ia,gerente:zu},Fi=["entregador","cozinha","pdv","garcom","gerente"],_j=Fi.filter(s=>s!=="gerente");function Tv({isGerentePanel:s=!1}){const[a,t]=b.useState(!1),[r,n]=b.useState(!1),[l,c]=b.useState(!1),[d,i]=b.useState(!1),[o,m]=b.useState(null),[p,x]=b.useState(null),[g,f]=b.useState(null),[y,v]=b.useState({name:"",email:"",password:"",roles:["pdv"]}),[P,M]=b.useState({roles:[]}),[O,E]=b.useState(!1),u=ts(),{menuContext:_,isMaster:$}=as(),{canAddCollaborator:j,plan:D,effectiveLimits:V,usage:T}=Yo(),[N,z]=b.useState(!1),k=s?null:_?.type==="subscriber"?_?.value:null,h=s?_j:Fi,{data:F=[],isLoading:S}=ke({queryKey:["colaboradores",k],queryFn:()=>_e.get("/colaboradores",k?{as_subscriber:k}:{}).then(H=>Array.isArray(H)?H:H.data||[])}),q=ae.useMemo(()=>{const H={};return F.forEach(ie=>{const me=(ie.email||"").toLowerCase().trim();if(!H[me])H[me]={email:ie.email,full_name:ie.full_name,roles:ie.profile_roles||[ie.profile_role].filter(Boolean),ids:ie.ids||[ie.id].filter(Boolean),created_at:ie.created_at,updated_at:ie.updated_at,active:ie.active!==!1,id:ie.id};else{const ze=H[me].roles;(ie.profile_roles||[ie.profile_role].filter(Boolean)).forEach(ce=>{ze.includes(ce)||ze.push(ce)}),ie.active===!1&&(H[me].active=!1),ie.active===!1&&(H[me].active=!1)}}),Object.values(H)},[F]),J=de({mutationFn:H=>{const ie=k?`/colaboradores?as_subscriber=${encodeURIComponent(k)}`:"/colaboradores";return _e.post(ie,H)},onSuccess:()=>{u.invalidateQueries({queryKey:["colaboradores"]}),t(!1),v({name:"",email:"",password:"",roles:["pdv"]}),x(null),K.success("Colaborador adicionado.")},onError:H=>K.error(H?.message||"Erro ao criar")}),W=de({mutationFn:({email:H,roles:ie})=>{const me=k?`?as_subscriber=${encodeURIComponent(k)}`:"";return _e.post(`/colaboradores/${encodeURIComponent(H)}/add-roles${me}`,{roles:ie})},onSuccess:()=>{u.invalidateQueries({queryKey:["colaboradores"]}),n(!1),f(null),M({roles:[]}),K.success("Perfis adicionados com sucesso.")},onError:H=>K.error(H?.message||"Erro ao adicionar perfis")}),C=de({mutationFn:({id:H,...ie})=>{const me={name:ie.name};return ie.role&&(me.role=ie.role),ie.newPassword&&(me.newPassword=ie.newPassword),_e.patch(`/colaboradores/${H}`,me)},onSuccess:()=>{u.invalidateQueries({queryKey:["colaboradores"]}),t(!1),v({name:"",email:"",password:"",roles:["pdv"]}),x(null),K.success("Colaborador atualizado.")},onError:H=>K.error(H?.message||"Erro ao atualizar")}),Y=de({mutationFn:H=>_e.delete(`/colaboradores/${H}`),onSuccess:()=>{u.invalidateQueries({queryKey:["colaboradores"]}),K.success("Colaborador removido.")},onError:H=>K.error(H?.message||"Erro ao remover")}),L=()=>{if(!j){z(!0);return}x(null),v({name:"",email:"",password:"",roles:["pdv"]}),E(!1),t(!0)},oe=H=>{x(H),v({name:H.full_name||"",email:H.email||"",password:"",roles:H.roles||[H.profile_role].filter(Boolean)}),E(!1),t(!0)},Pe=H=>{f(H);const ie=H.roles||[];Fi.filter(me=>!ie.includes(me)),M({roles:[]}),n(!0)},ve=H=>{t(H),H||(x(null),v({name:"",email:"",password:"",roles:["pdv"]}),E(!1))},G=H=>{n(H),H||(f(null),M({roles:[]}))},ne=()=>{if(p){const H={name:y.name};y.password&&(H.newPassword=y.password),y.roles&&y.roles.length>0&&(H.role=y.roles[0]),C.mutate({id:p.ids?.[0]||p.id,...H})}else{if(!y.email?.trim()){K.error("Email  obrigatrio");return}if(!y.password||y.password.length<6){K.error("Senha com no mnimo 6 caracteres");return}if(!y.roles||y.roles.length===0){K.error("Selecione pelo menos um perfil");return}J.mutate({name:y.name,email:y.email.trim(),password:y.password,roles:y.roles})}},fe=()=>{if(g){if(!P.roles||P.roles.length===0){K.error("Selecione pelo menos um perfil para adicionar");return}W.mutate({email:g.email,roles:P.roles})}},ge=H=>{v(ie=>({...ie,roles:ie.roles.includes(H)?ie.roles.filter(me=>me!==H):[...ie.roles,H]}))},Ee=H=>{M(ie=>({...ie,roles:ie.roles.includes(H)?ie.roles.filter(me=>me!==H):[...ie.roles,H]}))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Or,{className:"w-5 h-5 text-orange-500"}),"Colaboradores"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:"Perfis com acesso limitado: Entregador, Cozinha, PDV, Garom e Gerente. Apenas planos Pro e Ultra. Os colaboradores so sempre do estabelecimento (assinante) com seu slug  liberados pelo assinante."}),$&&!k&&e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400 mt-1",children:"Como master: selecione um estabelecimento em Assinantes (Ver dados completos ou editar) para listar e adicionar colaboradores desse estabelecimento."})]}),e.jsxs(A,{onClick:L,className:"bg-orange-500 hover:bg-orange-600",children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Adicionar"]})]}),S?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(sr,{className:"w-8 h-8 animate-spin text-orange-500"})}):F.length===0?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-8 text-center",children:[e.jsx(Or,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:$&&!k?"Selecione um estabelecimento em Assinantes para ver os colaboradores.":"Nenhum colaborador cadastrado."}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:$&&!k?"O acesso de colaboradores  liberado pelo assinante (estabelecimento) com seu slug.":"Adicione perfis para funcionrios acessarem Entregador, Cozinha, PDV, Garom ou Gerente."}),k&&e.jsxs(A,{onClick:L,className:"mt-4 bg-orange-500 hover:bg-orange-600",children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Adicionar colaborador"]})]}):e.jsx("div",{className:"grid gap-3",children:q.map(H=>e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 p-4 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center flex-shrink-0",children:e.jsx(Or,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:H.full_name||H.email}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:H.email}),e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-2",children:H.roles.map(ie=>{const me=ji[ie]||Or;return e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium px-2 py-0.5 rounded bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300",children:[e.jsx(me,{className:"w-3 h-3"}),Ir[ie]||ie]},ie)})})]})]}),e.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[e.jsxs(A,{variant:"outline",size:"sm",onClick:async()=>{try{const ie=await _e.get("/colaboradores"),me=Array.isArray(ie)?ie.find(ze=>(ze.email||"").toLowerCase().trim()===(H.email||"").toLowerCase().trim()):ie.data?.find(ze=>(ze.email||"").toLowerCase().trim()===(H.email||"").toLowerCase().trim());m(me||H),c(!0)}catch{m(H),c(!0)}},children:[e.jsx(Ya,{className:"w-4 h-4 mr-1"}),"Ver Perfil"]}),e.jsxs(A,{variant:"outline",size:"sm",onClick:()=>Pe(H),disabled:H.roles.length>=h.length,children:[e.jsx(Tu,{className:"w-4 h-4 mr-1"}),"Adicionar Perfis"]}),!(s&&H.roles.includes("gerente"))&&e.jsxs(e.Fragment,{children:[e.jsxs(A,{variant:"outline",size:"sm",onClick:()=>oe(H),children:[e.jsx(qs,{className:"w-4 h-4 mr-1"}),"Editar"]}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>{const ie=H.ids?.[0]||H.id;ie&&toggleActiveMu.mutate({id:ie,active:!H.active})},className:H.active?"text-orange-600 hover:text-orange-700":"text-green-600 hover:text-green-700",children:H.active?e.jsxs(e.Fragment,{children:[e.jsx(sc,{className:"w-4 h-4 mr-1"}),"Desativar"]}):e.jsxs(e.Fragment,{children:[e.jsx(ma,{className:"w-4 h-4 mr-1"}),"Ativar"]})}),e.jsxs(A,{variant:"outline",size:"sm",onClick:()=>{const ie=H.ids?.[0]||H.id;ie&&confirm(`Tem certeza que deseja excluir o acesso de ${H.full_name||H.email}? Esta ao no pode ser desfeita.`)&&Y.mutate(ie)},className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx(Xe,{className:"w-4 h-4 mr-1"}),"Excluir"]})]})]})]},H.email))}),e.jsx(Re,{open:a,onOpenChange:ve,children:e.jsxs(Le,{className:"sm:max-w-lg max-w-[90vw] max-h-[90vh] overflow-y-auto",children:[e.jsx(Ie,{children:e.jsx(qe,{children:p?"Editar colaborador":"Adicionar colaborador"})}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome"}),e.jsx(B,{value:y.name,onChange:H=>v(ie=>({...ie,name:H.target.value})),placeholder:"Nome do colaborador"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Email"}),e.jsx(B,{type:"email",value:y.email,onChange:H=>v(ie=>({...ie,email:H.target.value})),placeholder:"email@exemplo.com",disabled:!!p})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Perfis (selecione um ou mais)"}),e.jsx("div",{className:"space-y-2 mt-2",children:h.map(H=>{const ie=ji[H];return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(mt,{id:`role-${H}`,checked:y.roles.includes(H),onCheckedChange:()=>ge(H)}),e.jsxs(R,{htmlFor:`role-${H}`,className:"flex items-center gap-2 cursor-pointer flex-1",children:[e.jsx(ie,{className:"w-4 h-4"}),Ir[H]]})]},H)})}),y.roles.length===0&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:"Selecione pelo menos um perfil"})]}),e.jsxs("div",{children:[e.jsx(R,{children:p?"Nova senha (deixe em branco para no alterar)":"Senha (mn. 6)"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{type:O?"text":"password",value:y.password,onChange:H=>v(ie=>({...ie,password:H.target.value})),placeholder:p?"":"Senha de acesso"}),e.jsx("button",{type:"button",className:"absolute right-2.5 top-1/2 -translate-y-1/2 text-gray-500",onClick:()=>E(H=>!H),children:O?e.jsx(ju,{className:"w-4 h-4"}):e.jsx(Ya,{className:"w-4 h-4"})})]})]})]}),e.jsxs(Qs,{children:[e.jsx(A,{variant:"outline",onClick:()=>t(!1),children:"Cancelar"}),e.jsxs(A,{onClick:ne,disabled:J.isPending||C.isPending,className:"bg-orange-500 hover:bg-orange-600",children:[(J.isPending||C.isPending)&&e.jsx(sr,{className:"w-4 h-4 mr-2 animate-spin"}),p?"Salvar":"Adicionar"]})]})]})}),e.jsx(Re,{open:r,onOpenChange:G,children:e.jsxs(Le,{className:"sm:max-w-lg max-w-[90vw] max-h-[90vh] overflow-y-auto",children:[e.jsx(Ie,{children:e.jsxs(qe,{children:["Adicionar perfis a ",g?.full_name||g?.email]})}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Perfis atuais: ",g?.roles?.map(H=>Ir[H]||H).join(", ")||"Nenhum"]}),e.jsxs("div",{children:[e.jsx(R,{children:"Selecione os perfis para adicionar"}),e.jsx("div",{className:"space-y-2 mt-2",children:h.filter(H=>!g?.roles?.includes(H)).map(H=>{const ie=ji[H];return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(mt,{id:`add-role-${H}`,checked:P.roles.includes(H),onCheckedChange:()=>Ee(H)}),e.jsxs(R,{htmlFor:`add-role-${H}`,className:"flex items-center gap-2 cursor-pointer flex-1",children:[e.jsx(ie,{className:"w-4 h-4"}),Ir[H]]})]},H)})}),h.filter(H=>!g?.roles?.includes(H)).length===0&&e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Este colaborador j possui todos os perfis disponveis."})]})]}),e.jsxs(Qs,{children:[e.jsx(A,{variant:"outline",onClick:()=>n(!1),children:"Cancelar"}),e.jsxs(A,{onClick:fe,disabled:W.isPending||P.roles.length===0,className:"bg-orange-500 hover:bg-orange-600",children:[W.isPending&&e.jsx(sr,{className:"w-4 h-4 mr-2 animate-spin"}),"Adicionar Perfis"]})]})]})}),l&&o&&e.jsx(Re,{open:l,onOpenChange:c,children:e.jsxs(Le,{className:"sm:max-w-4xl max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[e.jsx(Ie,{children:e.jsx(qe,{children:"Perfil do Colaborador"})}),e.jsx(wj,{colaboradorEmail:o.email,onClose:()=>{c(!1),m(null)},onEdit:async()=>{try{const H=await _e.get("/colaboradores"),ie=Array.isArray(H)?H.find(me=>(me.email||"").toLowerCase().trim()===(o.email||"").toLowerCase().trim()):H.data?.find(me=>(me.email||"").toLowerCase().trim()===(o.email||"").toLowerCase().trim());if(ie?.id||ie?.ids?.[0]){const me=ie.id||ie.ids[0],ze=await _e.get("/colaboradores").then(Je=>(Array.isArray(Je)?Je:Je.data||[]).find(We=>String(We.id)===String(me)));m(ze||ie)}else m(ie||o);c(!1),i(!0)}catch{c(!1),i(!0)}}})]})}),d&&o&&e.jsx(Ou,{user:o,profileRole:o.profile_role||o.roles?.[0],onClose:()=>{i(!1),m(null),u.invalidateQueries({queryKey:["colaboradores"]})},onUpdate:H=>{m(H),u.invalidateQueries({queryKey:["colaboradores"]})}}),!$&&e.jsx(Go,{open:N,onOpenChange:z,type:"collaborators",plan:D,limit:V?.collaborators??0,used:T?.collaboratorsCount??0,suggestion:"Pro libera at 5 colaboradores."})]})}function Fv({user:s}){const a=ts(),[t,r]=b.useState(""),[n,l]=b.useState(null),[c,d]=b.useState([]),{data:i}=ke({queryKey:["user2FA",s?.email],queryFn:async()=>{try{return await se.entities.User2FA.filter({user_email:s?.email})}catch{return[]}},enabled:!!s?.email}),o=i?.[0]?.enabled||!1,m=()=>Array.from(crypto.getRandomValues(new Uint8Array(16))).map(y=>y.toString(16).padStart(2,"0")).join("").toUpperCase(),p=(y,v)=>/^\d{6}$/.test(y),x=de({mutationFn:async()=>{const y=m(),v=Im,P=s?.email||"user",M=`otpauth://totp/${v}:${P}?secret=${y}&issuer=${v}`,O=`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(M)}`;l(O),localStorage.setItem("temp_2fa_secret",y);const E=Array.from({length:10},()=>Math.random().toString(36).substring(2,8).toUpperCase());return d(E),{secret:y,qrCodeDataUrl:O,backupCodes:E}},onError:y=>{us.error("Erro ao gerar QR Code: "+y.message)}}),g=de({mutationFn:async({code:y})=>{const v=localStorage.getItem("temp_2fa_secret");if(!v)throw new Error("Secret no encontrado");if(!p(y))throw new Error("Cdigo invlido");return await se.entities.User2FA.create({user_email:s.email,secret:v,enabled:!0,backup_codes:c,created_at:new Date().toISOString()}),localStorage.removeItem("temp_2fa_secret"),!0},onSuccess:()=>{a.invalidateQueries(["user2FA"]),us.success("2FA ativado com sucesso!"),l(null),r("")},onError:y=>{us.error("Erro ao ativar 2FA: "+y.message)}}),f=de({mutationFn:async()=>(i?.[0]?.id&&await se.entities.User2FA.update(i[0].id,{enabled:!1}),!0),onSuccess:()=>{a.invalidateQueries(["user2FA"]),us.success("2FA desativado")},onError:y=>{us.error("Erro ao desativar 2FA: "+y.message)}});return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(wi,{className:"w-6 h-6"}),"Autenticao de Dois Fatores (2FA)"]}),e.jsx("p",{className:"text-gray-500",children:"Proteja sua conta com 2FA"})]})}),e.jsxs(Q,{children:[e.jsx(he,{children:e.jsxs(xe,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Status da Segurana"}),e.jsx(ye,{variant:o?"default":"secondary",children:o?e.jsxs(e.Fragment,{children:[e.jsx(ma,{className:"w-4 h-4 mr-1"}),"Ativo"]}):e.jsxs(e.Fragment,{children:[e.jsx(Yt,{className:"w-4 h-4 mr-1"}),"Inativo"]})})]})}),e.jsx(Z,{className:"space-y-4",children:o?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-900 mb-2",children:[e.jsx(ma,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"2FA est ativo"})]}),e.jsx("p",{className:"text-sm text-green-800",children:"Sua conta est protegida com autenticao de dois fatores."})]}),e.jsx(A,{variant:"destructive",onClick:()=>{window.confirm("Tem certeza que deseja desativar o 2FA? Isso reduzir a segurana da sua conta.")&&f.mutate()},disabled:f.isLoading,className:"w-full",children:"Desativar 2FA"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"O que  2FA?"}),e.jsx("p",{className:"text-sm text-blue-800",children:"A autenticao de dois fatores adiciona uma camada extra de segurana. Alm da senha, voc precisar de um cdigo do aplicativo autenticador."})]}),e.jsxs(A,{onClick:()=>x.mutate(),disabled:x.isLoading,className:"w-full",children:[e.jsx(Fu,{className:"w-4 h-4 mr-2"}),"Ativar 2FA"]}),n&&e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(R,{children:"1. Escaneie o QR Code com seu app autenticador"}),e.jsx("div",{className:"mt-2 flex justify-center",children:e.jsx("img",{src:n,alt:"QR Code 2FA",className:"border rounded"})})]}),e.jsxs("div",{children:[e.jsx(R,{children:"2. Digite o cdigo de 6 dgitos do app"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(B,{type:"text",value:t,onChange:y=>r(y.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",maxLength:6,className:"text-center text-2xl tracking-widest"}),e.jsx(A,{onClick:()=>g.mutate({code:t}),disabled:t.length!==6||g.isLoading,children:"Verificar"})]})]}),c.length>0&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx(R,{className:"text-yellow-900 font-semibold",children:" Cdigos de Backup (guarde em local seguro)"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2",children:c.map((y,v)=>e.jsx("code",{className:"text-sm bg-white p-2 rounded border",children:y},v))}),e.jsx("p",{className:"text-xs text-yellow-800 mt-2",children:"Use estes cdigos se perder acesso ao app autenticador"})]})]})]})})]}),e.jsxs(Q,{children:[e.jsx(he,{children:e.jsx(xe,{children:"Apps Autenticadores Recomendados"})}),e.jsx(Z,{children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[" ",e.jsx("strong",{children:"Google Authenticator"})," (iOS/Android)"]}),e.jsxs("p",{children:[" ",e.jsx("strong",{children:"Microsoft Authenticator"})," (iOS/Android)"]}),e.jsxs("p",{children:[" ",e.jsx("strong",{children:"Authy"})," (iOS/Android/Desktop)"]}),e.jsxs("p",{children:[" ",e.jsx("strong",{children:"1Password"})," (iOS/Android/Desktop)"]})]})})]})]})}const qd=b.forwardRef(({className:s,...a},t)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:t,className:Ze("w-full caption-bottom text-sm",s),...a})}));qd.displayName="Table";const $d=b.forwardRef(({className:s,...a},t)=>e.jsx("thead",{ref:t,className:Ze("[&_tr]:border-b",s),...a}));$d.displayName="TableHeader";const Yd=b.forwardRef(({className:s,...a},t)=>e.jsx("tbody",{ref:t,className:Ze("[&_tr:last-child]:border-0",s),...a}));Yd.displayName="TableBody";const Cj=b.forwardRef(({className:s,...a},t)=>e.jsx("tfoot",{ref:t,className:Ze("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...a}));Cj.displayName="TableFooter";const Ri=b.forwardRef(({className:s,...a},t)=>e.jsx("tr",{ref:t,className:Ze("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...a}));Ri.displayName="TableRow";const Wa=b.forwardRef(({className:s,...a},t)=>e.jsx("th",{ref:t,className:Ze("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...a}));Wa.displayName="TableHead";const Ha=b.forwardRef(({className:s,...a},t)=>e.jsx("td",{ref:t,className:Ze("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...a}));Ha.displayName="TableCell";const kj=b.forwardRef(({className:s,...a},t)=>e.jsx("caption",{ref:t,className:Ze("mt-4 text-sm text-muted-foreground",s),...a}));kj.displayName="TableCaption";function Rv(){const s=ts(),{menuContext:a}=as(),[t,r]=b.useState(null),{data:n=[]}=ke({queryKey:["customers",a?.type,a?.value],queryFn:async()=>{if(!a)return[];const o={};return a.type==="subscriber"&&a.value&&(o.as_subscriber=a.value),se.entities.Customer.list(null,o)},enabled:!!a}),{data:l=[]}=Wt(),c=de({mutationFn:async o=>{const m=n.find(v=>v.id===o);if(!m)throw new Error("Cliente no encontrado");const p=l.filter(v=>v.customer_email===m.email||v.customer_phone===m.phone),x={customer:{id:m.id,name:m.name,email:m.email,phone:m.phone,address:m.address,created_at:m.created_at},orders:p.map(v=>({id:v.id,order_code:v.order_code,total:v.total,status:v.status,created_date:v.created_date,items:v.items||[]})),exported_at:new Date().toISOString()},g=new Blob([JSON.stringify(x,null,2)],{type:"application/json"}),f=URL.createObjectURL(g),y=document.createElement("a");return y.href=f,y.download=`dados-cliente-${m.email||m.id}-${Date.now()}.json`,document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(f),x},onSuccess:()=>{us.success("Dados exportados com sucesso!")},onError:o=>{us.error("Erro ao exportar dados: "+o.message)}}),d=de({mutationFn:async o=>{const m=n.find(x=>x.id===o);if(!m)throw new Error("Cliente no encontrado");await se.entities.Customer.update(o,{name:"[Dados Removidos]",email:`removed_${Date.now()}@deleted.local`,phone:null,address:null,lgpd_deleted:!0,lgpd_deleted_at:new Date().toISOString()});const p=l.filter(x=>x.customer_email===m.email||x.customer_phone===m.phone);for(const x of p)await se.entities.Order.update(x.id,{customer_name:"[Dados Removidos]",customer_email:`removed_${Date.now()}@deleted.local`,customer_phone:null,customer_address:null});return!0},onSuccess:()=>{s.invalidateQueries(["customers"]),s.invalidateQueries(["orders"]),us.success("Dados removidos conforme LGPD")},onError:o=>{us.error("Erro ao remover dados: "+o.message)}}),i=o=>{window.confirm("Tem certeza? Esta ao ir anonimizar todos os dados do cliente conforme LGPD. Esta ao no pode ser desfeita.")&&d.mutate(o)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(wi,{className:"w-6 h-6"}),"Conformidade LGPD"]}),e.jsx("p",{className:"text-gray-500",children:"Gerencie direitos de dados dos clientes"})]})}),e.jsx(Q,{className:"bg-blue-50 border-blue-200",children:e.jsx(Z,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(wi,{className:"w-8 h-8 text-blue-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"Direitos do Cliente (LGPD)"}),e.jsxs("ul",{className:"space-y-1 text-sm text-blue-800",children:[e.jsxs("li",{children:[" ",e.jsx("strong",{children:"Acesso:"})," Cliente pode solicitar seus dados"]}),e.jsxs("li",{children:[" ",e.jsx("strong",{children:"Portabilidade:"})," Exportar dados em formato JSON"]}),e.jsxs("li",{children:[" ",e.jsx("strong",{children:"Esquecimento:"})," Solicitar remoo/anonymizao de dados"]}),e.jsxs("li",{children:[" ",e.jsx("strong",{children:"Correo:"})," Atualizar dados incorretos"]})]})]})]})})}),e.jsxs(Q,{children:[e.jsx(he,{children:e.jsx(xe,{children:"Clientes e Dados"})}),e.jsx(Z,{children:e.jsxs(qd,{children:[e.jsx($d,{children:e.jsxs(Ri,{children:[e.jsx(Wa,{children:"Nome"}),e.jsx(Wa,{children:"Email"}),e.jsx(Wa,{children:"Telefone"}),e.jsx(Wa,{children:"Pedidos"}),e.jsx(Wa,{children:"Status LGPD"}),e.jsx(Wa,{children:"Aes"})]})}),e.jsx(Yd,{children:n.map(o=>{const m=l.filter(x=>x.customer_email===o.email||x.customer_phone===o.phone),p=o.lgpd_deleted;return e.jsxs(Ri,{children:[e.jsx(Ha,{children:p?e.jsx("span",{className:"text-gray-400 italic",children:"[Dados Removidos]"}):o.name}),e.jsx(Ha,{children:p?e.jsx("span",{className:"text-gray-400 italic",children:"[Removido]"}):o.email}),e.jsx(Ha,{children:o.phone||""}),e.jsx(Ha,{children:m.length}),e.jsx(Ha,{children:p?e.jsxs(ye,{variant:"destructive",children:[e.jsx(Xe,{className:"w-3 h-3 mr-1"}),"Removido"]}):e.jsxs(ye,{variant:"default",children:[e.jsx(ma,{className:"w-3 h-3 mr-1"}),"Ativo"]})}),e.jsx(Ha,{children:e.jsx("div",{className:"flex gap-2",children:!p&&e.jsxs(e.Fragment,{children:[e.jsxs(A,{size:"sm",variant:"outline",onClick:()=>c.mutate(o.id),disabled:c.isLoading,children:[e.jsx(pn,{className:"w-4 h-4 mr-1"}),"Exportar"]}),e.jsxs(A,{size:"sm",variant:"destructive",onClick:()=>i(o.id),disabled:d.isLoading,children:[e.jsx(Xe,{className:"w-4 h-4 mr-1"}),"Remover"]})]})})})]},o.id)})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(Q,{children:[e.jsx(he,{className:"pb-2",children:e.jsx(xe,{className:"text-sm font-medium",children:"Total de Clientes"})}),e.jsx(Z,{children:e.jsx("div",{className:"text-2xl font-bold",children:n.length})})]}),e.jsxs(Q,{children:[e.jsx(he,{className:"pb-2",children:e.jsx(xe,{className:"text-sm font-medium",children:"Dados Removidos"})}),e.jsx(Z,{children:e.jsx("div",{className:"text-2xl font-bold text-red-600",children:n.filter(o=>o.lgpd_deleted).length})})]}),e.jsxs(Q,{children:[e.jsx(he,{className:"pb-2",children:e.jsx(xe,{className:"text-sm font-medium",children:"Exportaes"})}),e.jsx(Z,{children:e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:n.filter(o=>o.lgpd_exported).length})})]})]})]})}var Sj=Object.defineProperty,un=Object.getOwnPropertySymbols,Gd=Object.prototype.hasOwnProperty,Vd=Object.prototype.propertyIsEnumerable,ko=(s,a,t)=>a in s?Sj(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t,Li=(s,a)=>{for(var t in a||(a={}))Gd.call(a,t)&&ko(s,t,a[t]);if(un)for(var t of un(a))Vd.call(a,t)&&ko(s,t,a[t]);return s},Ii=(s,a)=>{var t={};for(var r in s)Gd.call(s,r)&&a.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&un)for(var r of un(s))a.indexOf(r)<0&&Vd.call(s,r)&&(t[r]=s[r]);return t};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var jt;(s=>{const a=class Te{constructor(i,o,m,p){if(this.version=i,this.errorCorrectionLevel=o,this.modules=[],this.isFunction=[],i<Te.MIN_VERSION||i>Te.MAX_VERSION)throw new RangeError("Version value out of range");if(p<-1||p>7)throw new RangeError("Mask value out of range");this.size=i*4+17;let x=[];for(let f=0;f<this.size;f++)x.push(!1);for(let f=0;f<this.size;f++)this.modules.push(x.slice()),this.isFunction.push(x.slice());this.drawFunctionPatterns();const g=this.addEccAndInterleave(m);if(this.drawCodewords(g),p==-1){let f=1e9;for(let y=0;y<8;y++){this.applyMask(y),this.drawFormatBits(y);const v=this.getPenaltyScore();v<f&&(p=y,f=v),this.applyMask(y)}}n(0<=p&&p<=7),this.mask=p,this.applyMask(p),this.drawFormatBits(p),this.isFunction=[]}static encodeText(i,o){const m=s.QrSegment.makeSegments(i);return Te.encodeSegments(m,o)}static encodeBinary(i,o){const m=s.QrSegment.makeBytes(i);return Te.encodeSegments([m],o)}static encodeSegments(i,o,m=1,p=40,x=-1,g=!0){if(!(Te.MIN_VERSION<=m&&m<=p&&p<=Te.MAX_VERSION)||x<-1||x>7)throw new RangeError("Invalid value");let f,y;for(f=m;;f++){const O=Te.getNumDataCodewords(f,o)*8,E=c.getTotalBits(i,f);if(E<=O){y=E;break}if(f>=p)throw new RangeError("Data too long")}for(const O of[Te.Ecc.MEDIUM,Te.Ecc.QUARTILE,Te.Ecc.HIGH])g&&y<=Te.getNumDataCodewords(f,O)*8&&(o=O);let v=[];for(const O of i){t(O.mode.modeBits,4,v),t(O.numChars,O.mode.numCharCountBits(f),v);for(const E of O.getData())v.push(E)}n(v.length==y);const P=Te.getNumDataCodewords(f,o)*8;n(v.length<=P),t(0,Math.min(4,P-v.length),v),t(0,(8-v.length%8)%8,v),n(v.length%8==0);for(let O=236;v.length<P;O^=253)t(O,8,v);let M=[];for(;M.length*8<v.length;)M.push(0);return v.forEach((O,E)=>M[E>>>3]|=O<<7-(E&7)),new Te(f,o,M,x)}getModule(i,o){return 0<=i&&i<this.size&&0<=o&&o<this.size&&this.modules[o][i]}getModules(){return this.modules}drawFunctionPatterns(){for(let m=0;m<this.size;m++)this.setFunctionModule(6,m,m%2==0),this.setFunctionModule(m,6,m%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const i=this.getAlignmentPatternPositions(),o=i.length;for(let m=0;m<o;m++)for(let p=0;p<o;p++)m==0&&p==0||m==0&&p==o-1||m==o-1&&p==0||this.drawAlignmentPattern(i[m],i[p]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(i){const o=this.errorCorrectionLevel.formatBits<<3|i;let m=o;for(let x=0;x<10;x++)m=m<<1^(m>>>9)*1335;const p=(o<<10|m)^21522;n(p>>>15==0);for(let x=0;x<=5;x++)this.setFunctionModule(8,x,r(p,x));this.setFunctionModule(8,7,r(p,6)),this.setFunctionModule(8,8,r(p,7)),this.setFunctionModule(7,8,r(p,8));for(let x=9;x<15;x++)this.setFunctionModule(14-x,8,r(p,x));for(let x=0;x<8;x++)this.setFunctionModule(this.size-1-x,8,r(p,x));for(let x=8;x<15;x++)this.setFunctionModule(8,this.size-15+x,r(p,x));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let i=this.version;for(let m=0;m<12;m++)i=i<<1^(i>>>11)*7973;const o=this.version<<12|i;n(o>>>18==0);for(let m=0;m<18;m++){const p=r(o,m),x=this.size-11+m%3,g=Math.floor(m/3);this.setFunctionModule(x,g,p),this.setFunctionModule(g,x,p)}}drawFinderPattern(i,o){for(let m=-4;m<=4;m++)for(let p=-4;p<=4;p++){const x=Math.max(Math.abs(p),Math.abs(m)),g=i+p,f=o+m;0<=g&&g<this.size&&0<=f&&f<this.size&&this.setFunctionModule(g,f,x!=2&&x!=4)}}drawAlignmentPattern(i,o){for(let m=-2;m<=2;m++)for(let p=-2;p<=2;p++)this.setFunctionModule(i+p,o+m,Math.max(Math.abs(p),Math.abs(m))!=1)}setFunctionModule(i,o,m){this.modules[o][i]=m,this.isFunction[o][i]=!0}addEccAndInterleave(i){const o=this.version,m=this.errorCorrectionLevel;if(i.length!=Te.getNumDataCodewords(o,m))throw new RangeError("Invalid argument");const p=Te.NUM_ERROR_CORRECTION_BLOCKS[m.ordinal][o],x=Te.ECC_CODEWORDS_PER_BLOCK[m.ordinal][o],g=Math.floor(Te.getNumRawDataModules(o)/8),f=p-g%p,y=Math.floor(g/p);let v=[];const P=Te.reedSolomonComputeDivisor(x);for(let O=0,E=0;O<p;O++){let u=i.slice(E,E+y-x+(O<f?0:1));E+=u.length;const _=Te.reedSolomonComputeRemainder(u,P);O<f&&u.push(0),v.push(u.concat(_))}let M=[];for(let O=0;O<v[0].length;O++)v.forEach((E,u)=>{(O!=y-x||u>=f)&&M.push(E[O])});return n(M.length==g),M}drawCodewords(i){if(i.length!=Math.floor(Te.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let o=0;for(let m=this.size-1;m>=1;m-=2){m==6&&(m=5);for(let p=0;p<this.size;p++)for(let x=0;x<2;x++){const g=m-x,y=(m+1&2)==0?this.size-1-p:p;!this.isFunction[y][g]&&o<i.length*8&&(this.modules[y][g]=r(i[o>>>3],7-(o&7)),o++)}}n(o==i.length*8)}applyMask(i){if(i<0||i>7)throw new RangeError("Mask value out of range");for(let o=0;o<this.size;o++)for(let m=0;m<this.size;m++){let p;switch(i){case 0:p=(m+o)%2==0;break;case 1:p=o%2==0;break;case 2:p=m%3==0;break;case 3:p=(m+o)%3==0;break;case 4:p=(Math.floor(m/3)+Math.floor(o/2))%2==0;break;case 5:p=m*o%2+m*o%3==0;break;case 6:p=(m*o%2+m*o%3)%2==0;break;case 7:p=((m+o)%2+m*o%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[o][m]&&p&&(this.modules[o][m]=!this.modules[o][m])}}getPenaltyScore(){let i=0;for(let x=0;x<this.size;x++){let g=!1,f=0,y=[0,0,0,0,0,0,0];for(let v=0;v<this.size;v++)this.modules[x][v]==g?(f++,f==5?i+=Te.PENALTY_N1:f>5&&i++):(this.finderPenaltyAddHistory(f,y),g||(i+=this.finderPenaltyCountPatterns(y)*Te.PENALTY_N3),g=this.modules[x][v],f=1);i+=this.finderPenaltyTerminateAndCount(g,f,y)*Te.PENALTY_N3}for(let x=0;x<this.size;x++){let g=!1,f=0,y=[0,0,0,0,0,0,0];for(let v=0;v<this.size;v++)this.modules[v][x]==g?(f++,f==5?i+=Te.PENALTY_N1:f>5&&i++):(this.finderPenaltyAddHistory(f,y),g||(i+=this.finderPenaltyCountPatterns(y)*Te.PENALTY_N3),g=this.modules[v][x],f=1);i+=this.finderPenaltyTerminateAndCount(g,f,y)*Te.PENALTY_N3}for(let x=0;x<this.size-1;x++)for(let g=0;g<this.size-1;g++){const f=this.modules[x][g];f==this.modules[x][g+1]&&f==this.modules[x+1][g]&&f==this.modules[x+1][g+1]&&(i+=Te.PENALTY_N2)}let o=0;for(const x of this.modules)o=x.reduce((g,f)=>g+(f?1:0),o);const m=this.size*this.size,p=Math.ceil(Math.abs(o*20-m*10)/m)-1;return n(0<=p&&p<=9),i+=p*Te.PENALTY_N4,n(0<=i&&i<=2568888),i}getAlignmentPatternPositions(){if(this.version==1)return[];{const i=Math.floor(this.version/7)+2,o=this.version==32?26:Math.ceil((this.version*4+4)/(i*2-2))*2;let m=[6];for(let p=this.size-7;m.length<i;p-=o)m.splice(1,0,p);return m}}static getNumRawDataModules(i){if(i<Te.MIN_VERSION||i>Te.MAX_VERSION)throw new RangeError("Version number out of range");let o=(16*i+128)*i+64;if(i>=2){const m=Math.floor(i/7)+2;o-=(25*m-10)*m-55,i>=7&&(o-=36)}return n(208<=o&&o<=29648),o}static getNumDataCodewords(i,o){return Math.floor(Te.getNumRawDataModules(i)/8)-Te.ECC_CODEWORDS_PER_BLOCK[o.ordinal][i]*Te.NUM_ERROR_CORRECTION_BLOCKS[o.ordinal][i]}static reedSolomonComputeDivisor(i){if(i<1||i>255)throw new RangeError("Degree out of range");let o=[];for(let p=0;p<i-1;p++)o.push(0);o.push(1);let m=1;for(let p=0;p<i;p++){for(let x=0;x<o.length;x++)o[x]=Te.reedSolomonMultiply(o[x],m),x+1<o.length&&(o[x]^=o[x+1]);m=Te.reedSolomonMultiply(m,2)}return o}static reedSolomonComputeRemainder(i,o){let m=o.map(p=>0);for(const p of i){const x=p^m.shift();m.push(0),o.forEach((g,f)=>m[f]^=Te.reedSolomonMultiply(g,x))}return m}static reedSolomonMultiply(i,o){if(i>>>8||o>>>8)throw new RangeError("Byte out of range");let m=0;for(let p=7;p>=0;p--)m=m<<1^(m>>>7)*285,m^=(o>>>p&1)*i;return n(m>>>8==0),m}finderPenaltyCountPatterns(i){const o=i[1];n(o<=this.size*3);const m=o>0&&i[2]==o&&i[3]==o*3&&i[4]==o&&i[5]==o;return(m&&i[0]>=o*4&&i[6]>=o?1:0)+(m&&i[6]>=o*4&&i[0]>=o?1:0)}finderPenaltyTerminateAndCount(i,o,m){return i&&(this.finderPenaltyAddHistory(o,m),o=0),o+=this.size,this.finderPenaltyAddHistory(o,m),this.finderPenaltyCountPatterns(m)}finderPenaltyAddHistory(i,o){o[0]==0&&(i+=this.size),o.pop(),o.unshift(i)}};a.MIN_VERSION=1,a.MAX_VERSION=40,a.PENALTY_N1=3,a.PENALTY_N2=3,a.PENALTY_N3=40,a.PENALTY_N4=10,a.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],a.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],s.QrCode=a;function t(d,i,o){if(i<0||i>31||d>>>i)throw new RangeError("Value out of range");for(let m=i-1;m>=0;m--)o.push(d>>>m&1)}function r(d,i){return(d>>>i&1)!=0}function n(d){if(!d)throw new Error("Assertion error")}const l=class cs{constructor(i,o,m){if(this.mode=i,this.numChars=o,this.bitData=m,o<0)throw new RangeError("Invalid argument");this.bitData=m.slice()}static makeBytes(i){let o=[];for(const m of i)t(m,8,o);return new cs(cs.Mode.BYTE,i.length,o)}static makeNumeric(i){if(!cs.isNumeric(i))throw new RangeError("String contains non-numeric characters");let o=[];for(let m=0;m<i.length;){const p=Math.min(i.length-m,3);t(parseInt(i.substring(m,m+p),10),p*3+1,o),m+=p}return new cs(cs.Mode.NUMERIC,i.length,o)}static makeAlphanumeric(i){if(!cs.isAlphanumeric(i))throw new RangeError("String contains unencodable characters in alphanumeric mode");let o=[],m;for(m=0;m+2<=i.length;m+=2){let p=cs.ALPHANUMERIC_CHARSET.indexOf(i.charAt(m))*45;p+=cs.ALPHANUMERIC_CHARSET.indexOf(i.charAt(m+1)),t(p,11,o)}return m<i.length&&t(cs.ALPHANUMERIC_CHARSET.indexOf(i.charAt(m)),6,o),new cs(cs.Mode.ALPHANUMERIC,i.length,o)}static makeSegments(i){return i==""?[]:cs.isNumeric(i)?[cs.makeNumeric(i)]:cs.isAlphanumeric(i)?[cs.makeAlphanumeric(i)]:[cs.makeBytes(cs.toUtf8ByteArray(i))]}static makeEci(i){let o=[];if(i<0)throw new RangeError("ECI assignment value out of range");if(i<128)t(i,8,o);else if(i<16384)t(2,2,o),t(i,14,o);else if(i<1e6)t(6,3,o),t(i,21,o);else throw new RangeError("ECI assignment value out of range");return new cs(cs.Mode.ECI,0,o)}static isNumeric(i){return cs.NUMERIC_REGEX.test(i)}static isAlphanumeric(i){return cs.ALPHANUMERIC_REGEX.test(i)}getData(){return this.bitData.slice()}static getTotalBits(i,o){let m=0;for(const p of i){const x=p.mode.numCharCountBits(o);if(p.numChars>=1<<x)return 1/0;m+=4+x+p.bitData.length}return m}static toUtf8ByteArray(i){i=encodeURI(i);let o=[];for(let m=0;m<i.length;m++)i.charAt(m)!="%"?o.push(i.charCodeAt(m)):(o.push(parseInt(i.substring(m+1,m+3),16)),m+=2);return o}};l.NUMERIC_REGEX=/^[0-9]*$/,l.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,l.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let c=l;s.QrSegment=l})(jt||(jt={}));(s=>{(a=>{const t=class{constructor(n,l){this.ordinal=n,this.formatBits=l}};t.LOW=new t(0,1),t.MEDIUM=new t(1,0),t.QUARTILE=new t(2,3),t.HIGH=new t(3,2),a.Ecc=t})(s.QrCode||(s.QrCode={}))})(jt||(jt={}));(s=>{(a=>{const t=class{constructor(n,l){this.modeBits=n,this.numBitsCharCount=l}numCharCountBits(n){return this.numBitsCharCount[Math.floor((n+7)/17)]}};t.NUMERIC=new t(1,[10,12,14]),t.ALPHANUMERIC=new t(2,[9,11,13]),t.BYTE=new t(4,[8,16,16]),t.KANJI=new t(8,[8,10,12]),t.ECI=new t(7,[0,0,0]),a.Mode=t})(s.QrSegment||(s.QrSegment={}))})(jt||(jt={}));var At=jt;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var Dj={L:At.QrCode.Ecc.LOW,M:At.QrCode.Ecc.MEDIUM,Q:At.QrCode.Ecc.QUARTILE,H:At.QrCode.Ecc.HIGH},Ud=128,Bd="L",Wd="#FFFFFF",Hd="#000000",Kd=!1,Qd=1,Mj=4,Aj=0,Pj=.1;function Zd(s,a=0){const t=[];return s.forEach(function(r,n){let l=null;r.forEach(function(c,d){if(!c&&l!==null){t.push(`M${l+a} ${n+a}h${d-l}v1H${l+a}z`),l=null;return}if(d===r.length-1){if(!c)return;l===null?t.push(`M${d+a},${n+a} h1v1H${d+a}z`):t.push(`M${l+a},${n+a} h${d+1-l}v1H${l+a}z`);return}c&&l===null&&(l=d)})}),t.join("")}function Jd(s,a){return s.slice().map((t,r)=>r<a.y||r>=a.y+a.h?t:t.map((n,l)=>l<a.x||l>=a.x+a.w?n:!1))}function Ej(s,a,t,r){if(r==null)return null;const n=s.length+t*2,l=Math.floor(a*Pj),c=n/a,d=(r.width||l)*c,i=(r.height||l)*c,o=r.x==null?s.length/2-d/2:r.x*c,m=r.y==null?s.length/2-i/2:r.y*c,p=r.opacity==null?1:r.opacity;let x=null;if(r.excavate){let f=Math.floor(o),y=Math.floor(m),v=Math.ceil(d+o-f),P=Math.ceil(i+m-y);x={x:f,y,w:v,h:P}}const g=r.crossOrigin;return{x:o,y:m,h:i,w:d,excavation:x,opacity:p,crossOrigin:g}}function Oj(s,a){return a!=null?Math.max(Math.floor(a),0):s?Mj:Aj}function Xd({value:s,level:a,minVersion:t,includeMargin:r,marginSize:n,imageSettings:l,size:c,boostLevel:d}){let i=ae.useMemo(()=>{const f=(Array.isArray(s)?s:[s]).reduce((y,v)=>(y.push(...At.QrSegment.makeSegments(v)),y),[]);return At.QrCode.encodeSegments(f,Dj[a],t,void 0,void 0,d)},[s,a,t,d]);const{cells:o,margin:m,numCells:p,calculatedImageSettings:x}=ae.useMemo(()=>{let g=i.getModules();const f=Oj(r,n),y=g.length+f*2,v=Ej(g,c,f,l);return{cells:g,margin:f,numCells:y,calculatedImageSettings:v}},[i,c,l,r,n]);return{qrcode:i,margin:m,cells:o,numCells:p,calculatedImageSettings:x}}var zj=(function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0})(),Tj=ae.forwardRef(function(a,t){const r=a,{value:n,size:l=Ud,level:c=Bd,bgColor:d=Wd,fgColor:i=Hd,includeMargin:o=Kd,minVersion:m=Qd,boostLevel:p,marginSize:x,imageSettings:g}=r,y=Ii(r,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:v}=y,P=Ii(y,["style"]),M=g?.src,O=ae.useRef(null),E=ae.useRef(null),u=ae.useCallback(k=>{O.current=k,typeof t=="function"?t(k):t&&(t.current=k)},[t]),[_,$]=ae.useState(!1),{margin:j,cells:D,numCells:V,calculatedImageSettings:T}=Xd({value:n,level:c,minVersion:m,boostLevel:p,includeMargin:o,marginSize:x,imageSettings:g,size:l});ae.useEffect(()=>{if(O.current!=null){const k=O.current,h=k.getContext("2d");if(!h)return;let F=D;const S=E.current,q=T!=null&&S!==null&&S.complete&&S.naturalHeight!==0&&S.naturalWidth!==0;q&&T.excavation!=null&&(F=Jd(D,T.excavation));const J=window.devicePixelRatio||1;k.height=k.width=l*J;const W=l/V*J;h.scale(W,W),h.fillStyle=d,h.fillRect(0,0,V,V),h.fillStyle=i,zj?h.fill(new Path2D(Zd(F,j))):D.forEach(function(C,Y){C.forEach(function(L,oe){L&&h.fillRect(oe+j,Y+j,1,1)})}),T&&(h.globalAlpha=T.opacity),q&&h.drawImage(S,T.x+j,T.y+j,T.w,T.h)}}),ae.useEffect(()=>{$(!1)},[M]);const N=Li({height:l,width:l},v);let z=null;return M!=null&&(z=ae.createElement("img",{src:M,key:M,style:{display:"none"},onLoad:()=>{$(!0)},ref:E,crossOrigin:T?.crossOrigin})),ae.createElement(ae.Fragment,null,ae.createElement("canvas",Li({style:N,height:l,width:l,ref:u,role:"img"},P)),z)});Tj.displayName="QRCodeCanvas";var em=ae.forwardRef(function(a,t){const r=a,{value:n,size:l=Ud,level:c=Bd,bgColor:d=Wd,fgColor:i=Hd,includeMargin:o=Kd,minVersion:m=Qd,boostLevel:p,title:x,marginSize:g,imageSettings:f}=r,y=Ii(r,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:v,cells:P,numCells:M,calculatedImageSettings:O}=Xd({value:n,level:c,minVersion:m,boostLevel:p,includeMargin:o,marginSize:g,imageSettings:f,size:l});let E=P,u=null;f!=null&&O!=null&&(O.excavation!=null&&(E=Jd(P,O.excavation)),u=ae.createElement("image",{href:f.src,height:O.h,width:O.w,x:O.x+v,y:O.y+v,preserveAspectRatio:"none",opacity:O.opacity,crossOrigin:O.crossOrigin}));const _=Zd(E,v);return ae.createElement("svg",Li({height:l,width:l,viewBox:`0 0 ${M} ${M}`,ref:t,role:"img"},y),!!x&&ae.createElement("title",null,x),ae.createElement("path",{fill:d,d:`M0,0 h${M}v${M}H0z`,shapeRendering:"crispEdges"}),ae.createElement("path",{fill:i,d:_,shapeRendering:"crispEdges"}),u)});em.displayName="QRCodeSVG";const qr={available:{label:"Disponvel",color:"bg-green-500"},occupied:{label:"Ocupada",color:"bg-yellow-500"},reserved:{label:"Reservada",color:"bg-blue-500"},cleaning:{label:"Limpeza",color:"bg-gray-500"}};function qv(){const{isDark:s}=hn(),a=ts(),{menuContext:t}=as(),{slug:r}=Uo(),[n,l]=b.useState(!1),[c,d]=b.useState(null),[i,o]=b.useState({table_number:"",capacity:4,status:"available",qr_code:"",location:""}),[m,p]=b.useState(null),[x,g]=b.useState(!1),[f,y]=b.useState(null),[v,P]=b.useState(!1),[M,O]=b.useState(null),[E,u]=b.useState({customer_name:"",customer_phone:"",reservation_date:"",reservation_time:"",guests:1}),{data:_=[]}=ke({queryKey:["tables",t?.type,t?.value],queryFn:async()=>{if(!t)return[];const L={};return t.type==="subscriber"&&t.value&&(L.as_subscriber=t.value),se.entities.Table.list(null,L)},enabled:!!t}),{data:$=[]}=ke({queryKey:["Comanda",t?.type,t?.value],queryFn:async()=>{if(!t)return[];const L={status:"open"};return t.type==="subscriber"&&t.value&&(L.as_subscriber=t.value),se.entities.Comanda.list("-created_at",L)},enabled:!!t}),j=r||"",D=de({mutationFn:async L=>{if(!L.qr_code){const oe=window.location.origin;L.qr_code=`${oe}/mesa/${L.table_number}${j?`?slug=${j}`:""}`}return se.entities.Table.create(L)},onSuccess:()=>{a.invalidateQueries(["tables"]),us.success("Mesa criada com sucesso!"),l(!1),h()},onError:L=>{us.error("Erro ao criar mesa: "+(L.message||"Erro desconhecido"))}}),V=de({mutationFn:async({id:L,data:oe})=>se.entities.Table.update(L,oe),onSuccess:()=>{a.invalidateQueries(["tables"]),us.success("Mesa atualizada com sucesso!"),l(!1),h()},onError:L=>{us.error("Erro ao atualizar mesa: "+(L.message||"Erro desconhecido"))}}),T=de({mutationFn:async L=>se.entities.Table.delete(L),onSuccess:()=>{a.invalidateQueries(["tables"]),us.success("Mesa deletada com sucesso!")},onError:L=>{us.error("Erro ao deletar mesa: "+(L.message||"Erro desconhecido"))}}),N=de({mutationFn:async({tableId:L,...oe})=>se.entities.Table.update(L,{status:"reserved",reservation_date:oe.reservation_date,reservation_time:oe.reservation_time,reservation_customer_name:oe.customer_name,reservation_customer_phone:oe.customer_phone||"",reservation_guests:oe.guests||1}),onSuccess:()=>{a.invalidateQueries(["tables"]),us.success("Reserva confirmada!"),P(!1),O(null),u({customer_name:"",customer_phone:"",reservation_date:"",reservation_time:"",guests:1})},onError:L=>{us.error("Erro ao criar reserva: "+(L.message||"Erro desconhecido"))}}),z=de({mutationFn:async L=>se.entities.Table.update(L.id,{status:"available",reservation_date:null,reservation_time:null,reservation_customer_name:null,reservation_customer_phone:null,reservation_guests:null}),onSuccess:()=>{a.invalidateQueries(["tables"]),us.success("Reserva cancelada.")},onError:L=>{us.error("Erro ao cancelar reserva: "+(L.message||"Erro desconhecido"))}}),k=L=>{O(L),u({customer_name:"",customer_phone:"",reservation_date:"",reservation_time:"",guests:1}),P(!0)},h=()=>{o({table_number:"",capacity:4,status:"available",qr_code:"",location:""}),d(null)},F=L=>{d(L),o({table_number:L.table_number||"",capacity:L.capacity||4,status:L.status||"available",qr_code:L.qr_code||"",location:L.location||""}),l(!0)},S=L=>{L.preventDefault(),c?V.mutate({id:c.id,data:i}):D.mutate(i)},q=L=>{window.confirm("Tem certeza que deseja deletar esta mesa?")&&T.mutate(L)},J=L=>{p(L)},W=L=>{const oe=document.getElementById(`qr-${L.id}`);if(oe){const Pe=oe.toDataURL("image/png"),ve=document.createElement("a");ve.download=`qr-mesa-${L.table_number}.png`,ve.href=Pe,ve.click()}},C=L=>{y(L),g(!0)},Y=L=>$.filter(oe=>oe.table_id&&String(oe.table_id)===String(L.id)||oe.table_number&&String(oe.table_number)===String(L.table_number)||oe.table_name&&String(oe.table_name)===String(L.table_number));return e.jsxs("div",{className:"space-y-6",children:[!j&&e.jsxs("div",{className:"rounded-lg bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 p-3 text-sm text-amber-800 dark:text-amber-200",children:[e.jsx("strong",{children:"Dica:"})," Para o QR Code abrir o cardpio correto, defina o ",e.jsx("strong",{children:"slug do estabelecimento"})," (ex.: link do cardpio /s/meu-restaurante) em Loja ou no seu perfil. Assim o link da mesa ficar: /mesa/N?slug=meu-restaurante"]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Gesto de Mesas"}),e.jsx("p",{className:"text-gray-500",children:"Gerencie mesas, QR Codes e status"})]}),e.jsxs(Re,{open:n,onOpenChange:l,children:[e.jsx(uu,{asChild:!0,children:e.jsxs(A,{onClick:h,children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Nova Mesa"]})}),e.jsxs(Le,{className:"sm:max-w-md max-w-[95vw]",children:[e.jsxs(Ie,{children:[e.jsx(qe,{children:c?"Editar Mesa":"Nova Mesa"}),e.jsx(Zr,{className:"sr-only",children:"Formulrio para criar ou editar uma mesa."})]}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nmero da Mesa *"}),e.jsx(B,{value:i.table_number,onChange:L=>o(oe=>({...oe,table_number:L.target.value})),placeholder:"Ex: 1, 2, 3...",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Capacidade"}),e.jsx(B,{type:"number",value:i.capacity,onChange:L=>o(oe=>({...oe,capacity:parseInt(L.target.value)||4})),min:"1"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Status"}),e.jsxs(Se,{value:i.status,onValueChange:L=>o(oe=>({...oe,status:L})),children:[e.jsx(De,{children:e.jsx(Me,{})}),e.jsx(Ae,{children:Object.entries(qr).map(([L,{label:oe}])=>e.jsx(X,{value:L,children:oe},L))})]})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Localizao (opcional)"}),e.jsx(B,{value:i.location,onChange:L=>o(oe=>({...oe,location:L.target.value})),placeholder:"Ex: Salo principal, Varanda..."})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(A,{type:"button",variant:"outline",onClick:()=>l(!1),children:"Cancelar"}),e.jsx(A,{type:"submit",disabled:D.isLoading||V.isLoading,children:c?"Atualizar":"Criar"})]})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:_.map(L=>{const oe=qr[L.status]||qr.available;return e.jsxs(Q,{children:[e.jsx(he,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs(xe,{className:"text-xl",children:["Mesa ",L.table_number]}),e.jsx(ye,{className:oe.color,children:oe.label})]})}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Capacidade:"})," ",L.capacity," pessoas"]}),L.location&&e.jsxs("div",{children:[e.jsx("strong",{children:"Localizao:"})," ",L.location]}),L.status==="reserved"&&L.reservation_date&&e.jsxs("div",{className:"p-2 rounded bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-700 dark:text-blue-300 text-xs",children:[e.jsx(Rt,{className:"w-3 h-3"}),e.jsx("span",{className:"font-medium",children:"Reservada"})]}),L.reservation_customer_name&&e.jsxs("p",{className:"text-xs mt-1 text-blue-600 dark:text-blue-400",children:["Cliente: ",L.reservation_customer_name]}),e.jsxs("p",{className:"text-xs text-blue-600 dark:text-blue-400",children:[new Date(L.reservation_date).toLocaleDateString("pt-BR")," s ",L.reservation_time||"--:--"]}),L.reservation_guests&&e.jsxs("p",{className:"text-xs text-blue-600 dark:text-blue-400",children:["Convidados: ",L.reservation_guests]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(A,{size:"sm",variant:"outline",onClick:()=>F(L),children:[e.jsx(Lt,{className:"w-4 h-4 mr-1"}),"Editar"]}),e.jsxs(A,{size:"sm",variant:"outline",onClick:()=>J(L),children:[e.jsx(ah,{className:"w-4 h-4 mr-1"}),"QR Code"]}),e.jsxs(A,{size:"sm",variant:"outline",onClick:()=>C(L),children:[e.jsx(Ia,{className:"w-4 h-4 mr-1"}),"Comandas"]}),L.status!=="reserved"&&e.jsxs(A,{size:"sm",variant:"outline",onClick:()=>k(L),children:[e.jsx(Rt,{className:"w-4 h-4 mr-1"}),"Reservar"]}),L.status==="reserved"&&e.jsxs(A,{size:"sm",variant:"outline",onClick:()=>{window.confirm("Cancelar reserva desta mesa?")&&z.mutate(L)},children:[e.jsx(Ds,{className:"w-4 h-4 mr-1"}),"Cancelar"]}),e.jsx(A,{size:"sm",variant:"destructive",onClick:()=>q(L.id),children:e.jsx(Xe,{className:"w-4 h-4"})})]})]})]},L.id)})}),m&&e.jsx(Re,{open:!!m,onOpenChange:()=>p(null),children:e.jsxs(Le,{className:"sm:max-w-sm max-w-[95vw]",children:[e.jsx(Ie,{children:e.jsxs(qe,{children:["QR Code - Mesa ",m.table_number]})}),e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg",children:e.jsx(em,{value:m.qr_code||`${window.location.origin}/mesa/${m.table_number}${j?`?slug=${j}`:""}`,size:200,level:"H"})}),e.jsxs(A,{onClick:()=>W(m),children:[e.jsx(pn,{className:"w-4 h-4 mr-2"}),"Baixar QR Code"]})]})]})}),e.jsx(Re,{open:x,onOpenChange:g,children:e.jsxs(Le,{className:"sm:max-w-2xl max-w-[95vw] max-h-[85vh] overflow-y-auto",children:[e.jsx(Ie,{children:e.jsxs(qe,{children:["Comandas - Mesa ",f?.table_number]})}),f&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-3 rounded-lg border bg-gray-50 dark:bg-gray-800",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",qr[f.status]?.label||f.status]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Capacidade:"})," ",f.capacity," pessoas"]}),f.location&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("strong",{children:"Localizao:"})," ",f.location]})]})}),(()=>{const L=Y(f),oe=L.reduce((ve,G)=>ve+(G.total||0),0),Pe=L.reduce((ve,G)=>ve+(Array.isArray(G.items)?G.items.length:0),0);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 p-3 rounded-lg border bg-blue-50 dark:bg-blue-900/20",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Comandas Abertas"}),e.jsx("p",{className:"text-lg font-bold",children:L.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Total de Itens"}),e.jsx("p",{className:"text-lg font-bold",children:Pe})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Valor Total"}),e.jsx("p",{className:"text-lg font-bold",children:va(oe)})]})]}),L.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Ia,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Nenhuma comanda aberta nesta mesa"})]}):e.jsx("div",{className:"space-y-3",children:L.map(ve=>e.jsxs(Q,{className:"border",children:[e.jsx(he,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(xe,{className:"text-base flex items-center gap-2",children:[e.jsx(Ia,{className:"w-4 h-4"}),ve.code||`#${ve.id}`]}),e.jsx(ye,{className:"bg-green-600",children:"Aberta"})]})}),e.jsxs(Z,{className:"space-y-2",children:[ve.customer_name&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Cliente: ",ve.customer_name]}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"font-medium",children:["Itens (",Array.isArray(ve.items)?ve.items.length:0,"):"]}),e.jsxs("ul",{className:"list-disc list-inside text-gray-600 dark:text-gray-400 mt-1",children:[Array.isArray(ve.items)&&ve.items.slice(0,3).map((G,ne)=>e.jsxs("li",{className:"text-xs",children:[G.quantity,"x ",G.dish_name||"Item"," - ",va((G.quantity||0)*(G.unit_price||0))]},ne)),ve.items.length>3&&e.jsxs("li",{className:"text-xs text-gray-500",children:["... e mais ",ve.items.length-3," item(ns)"]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total:"}),e.jsx("span",{className:"text-lg font-bold",children:va(ve.total||0)})]})]})]},ve.id))})]})})()]})]})}),e.jsx(Re,{open:v,onOpenChange:P,children:e.jsxs(Le,{className:"sm:max-w-md max-w-[95vw]",children:[e.jsx(Ie,{children:e.jsxs(qe,{children:["Reservar Mesa ",M?.table_number]})}),e.jsxs("form",{onSubmit:L=>{if(L.preventDefault(),!E.customer_name||!E.reservation_date||!E.reservation_time){us.error("Preencha todos os campos obrigatrios");return}if(!M?.id){us.error("Mesa no identificada.");return}N?.mutate?.({tableId:M.id,...E})},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(R,{children:"Nome do Cliente *"}),e.jsx(B,{value:E.customer_name,onChange:L=>u(oe=>({...oe,customer_name:L.target.value})),placeholder:"Nome completo",required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Telefone"}),e.jsx(B,{value:E.customer_phone,onChange:L=>u(oe=>({...oe,customer_phone:L.target.value})),placeholder:"(00) 00000-0000"})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Data da Reserva *"}),e.jsx(B,{type:"date",value:E.reservation_date,onChange:L=>u(oe=>({...oe,reservation_date:L.target.value})),min:new Date().toISOString().split("T")[0],required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Horrio *"}),e.jsx(B,{type:"time",value:E.reservation_time,onChange:L=>u(oe=>({...oe,reservation_time:L.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Nmero de Convidados"}),e.jsx(B,{type:"number",min:"1",max:M?.capacity||10,value:E.guests,onChange:L=>u(oe=>({...oe,guests:parseInt(L.target.value)||1}))})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(A,{type:"button",variant:"outline",onClick:()=>P(!1),children:"Cancelar"}),e.jsx(A,{type:"submit",disabled:N?.isPending,children:N?.isPending?"Salvando...":"Confirmar Reserva"})]})]})]})})]})}export{Tv as C,gv as D,_v as F,Rv as L,jv as M,Nv as O,Ev as P,ah as Q,Av as S,Fv as T,Or as U,fv as W,zv as a,Pv as b,Dv as c,qv as d,Mv as e,Sv as f,kv as g,Cv as h,vv as i,yv as j,wv as k,bv as l,Ov as m,xv as n,Ql as o,pv as p,qd as q,$d as r,Ri as s,Wa as t,_r as u,Yd as v,Ha as w,Wt as x};
