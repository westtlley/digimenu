import{r as a,k as O,i as J,j as e,g as m,B as f,L as G,l as p,d as H,z as j}from"./main-5wCJ0shd.js";import{L as v,I as y}from"./label-BGurCIwA.js";import{C as K}from"./circle-check-big-C21gM6y_.js";import{C as Q}from"./clock-8p17jiPd.js";import{E as N,a as S}from"./eye-CkTGamEz.js";import"./index-BjH-urEE.js";function $(){const[d,C]=a.useState(""),[x,E]=a.useState(""),[h,P]=a.useState(!1),[g,D]=a.useState(!1),[b,n]=a.useState(!1),[w,r]=a.useState(""),[L,T]=a.useState(!1),[u,k]=a.useState(null),[l,q]=a.useState(!1),[F]=O(),I=J(),o=F.get("token"),M=a.useRef(Date.now());a.useEffect(()=>{if(!o){r("Token n√£o fornecido. Verifique o link de acesso.");return}const t=()=>{const R=Date.now()-M.current,V=300*1e3,c=Math.max(0,V-R);if(c===0)q(!0),r("Token expirado! O link √© v√°lido por apenas 5 minutos. Solicite um novo link."),k(null);else{const A=Math.floor(c/6e4),B=Math.floor(c%6e4/1e3);k({minutes:A,seconds:B,total:c})}};t();const s=setInterval(t,1e3);return()=>clearInterval(s)},[o]);const z=async t=>{if(t.preventDefault(),r(""),n(!0),!o){r("Token n√£o fornecido."),n(!1);return}if(!d||!x){r("Por favor, preencha todos os campos"),n(!1);return}if(d.length<6){r("A senha deve ter no m√≠nimo 6 caracteres"),n(!1);return}if(d!==x){r("As senhas n√£o coincidem"),n(!1);return}try{p.log("üîê Enviando requisi√ß√£o para definir senha...");const s=await H.post("/auth/set-password",{token:o,password:d});if(p.log("üì• Resposta recebida"),s?.success||s?.data?.success)T(!0),j.success("Senha definida com sucesso!"),setTimeout(()=>{I("/login")},2e3);else{const i=s?.error||s?.data?.error||s?.message||"Erro ao definir senha";r(i),j.error(i)}}catch(s){p.error("‚ùå Erro ao definir senha:",s);const i=s?.response?.data?.error||s?.message||"Erro ao definir senha. Verifique o token.";r(i),j.error(i)}finally{n(!1)}};return L?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100 dark:bg-gray-900",children:e.jsx("div",{className:"w-full max-w-md p-8 space-y-6 bg-white rounded-lg shadow-md dark:bg-gray-800",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(K,{className:"w-8 h-8 text-green-500"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Senha Definida com Sucesso!"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Sua senha foi definida. Voc√™ ser√° redirecionado para a p√°gina de login..."})]})})}):o?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100 dark:bg-gray-900 p-4",children:e.jsxs("div",{className:"w-full max-w-md p-8 space-y-6 bg-white rounded-lg shadow-md dark:bg-gray-800",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-orange-100 dark:bg-orange-900/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(m,{className:"w-8 h-8 text-orange-500"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Definir Senha"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Defina uma senha para acessar sua conta"}),u&&!l&&e.jsxs("div",{className:"flex items-center justify-center gap-2 p-2 bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-md mb-2",children:[e.jsx(Q,{className:"w-4 h-4 text-orange-600 dark:text-orange-400"}),e.jsxs("span",{className:"text-sm font-semibold text-orange-700 dark:text-orange-300",children:["Tempo restante: ",String(u.minutes).padStart(2,"0"),":",String(u.seconds).padStart(2,"0")]})]}),l&&e.jsx("div",{className:"p-2 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md mb-2",children:e.jsx("p",{className:"text-xs text-red-700 dark:text-red-300 text-center",children:"‚è∞ Este link expirou. Solicite um novo link de defini√ß√£o de senha."})})]}),w&&e.jsx("div",{className:"p-3 text-sm text-red-700 bg-red-100 rounded-md dark:bg-red-900 dark:text-red-200",children:w}),e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(v,{htmlFor:"password",children:"Nova Senha"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(y,{id:"password",type:h?"text":"password",placeholder:"M√≠nimo 6 caracteres",value:d,onChange:t=>C(t.target.value),required:!0,className:"pr-10",minLength:6}),e.jsx(f,{type:"button",variant:"ghost",size:"sm",className:"absolute inset-y-0 right-0 flex items-center px-3 text-gray-500 dark:text-gray-400 hover:bg-transparent",onClick:()=>P(!h),children:h?e.jsx(N,{className:"w-4 h-4"}):e.jsx(S,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"confirmPassword",children:"Confirmar Senha"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(y,{id:"confirmPassword",type:g?"text":"password",placeholder:"Digite a senha novamente",value:x,onChange:t=>E(t.target.value),required:!0,className:"pr-10",minLength:6}),e.jsx(f,{type:"button",variant:"ghost",size:"sm",className:"absolute inset-y-0 right-0 flex items-center px-3 text-gray-500 dark:text-gray-400 hover:bg-transparent",onClick:()=>D(!g),children:g?e.jsx(N,{className:"w-4 h-4"}):e.jsx(S,{className:"w-4 h-4"})})]})]}),e.jsx(f,{type:"submit",className:"w-full",disabled:b||!o||l,children:b?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-4 h-4 animate-spin mr-2"}),"Definindo..."]}):l?e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"w-4 h-4 mr-2"}),"Link Expirado"]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"w-4 h-4 mr-2"}),"Definir Senha"]})})]}),e.jsxs("div",{className:"text-center text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("p",{children:"J√° tem uma senha?"}),e.jsx("a",{href:"/login",className:"text-blue-600 hover:underline dark:text-blue-400",children:"Fazer login"})]})]})}):e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100 dark:bg-gray-900",children:e.jsx("div",{className:"w-full max-w-md p-8 space-y-6 bg-white rounded-lg shadow-md dark:bg-gray-800",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 dark:bg-red-900/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(m,{className:"w-8 h-8 text-red-500"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Link Inv√°lido"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Token n√£o fornecido. Verifique o link de acesso."}),e.jsx("a",{href:"/login",className:"text-blue-600 hover:underline dark:text-blue-400",children:"Ir para login"})]})})})}export{$ as default};
